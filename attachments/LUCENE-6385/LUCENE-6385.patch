diff --git a/lucene/highlighter/src/java/org/apache/lucene/search/highlight/WeightedSpanTermExtractor.java b/lucene/highlighter/src/java/org/apache/lucene/search/highlight/WeightedSpanTermExtractor.java
index 80160ac..1768485 100644
--- a/lucene/highlighter/src/java/org/apache/lucene/search/highlight/WeightedSpanTermExtractor.java
+++ b/lucene/highlighter/src/java/org/apache/lucene/search/highlight/WeightedSpanTermExtractor.java
@@ -306,6 +306,9 @@ public class WeightedSpanTermExtractor {
       }
       Bits acceptDocs = context.reader().getLiveDocs();
       final Spans spans = q.getSpans(context, acceptDocs, termContexts);
+      if (spans == null) {
+        return;
+      }
 
       // collect span positions
       while (spans.nextDoc() != Spans.NO_MORE_DOCS) {
diff --git a/lucene/highlighter/src/test/org/apache/lucene/search/highlight/MissesTest.java b/lucene/highlighter/src/test/org/apache/lucene/search/highlight/MissesTest.java
new file mode 100644
index 0000000..98c799e
--- /dev/null
+++ b/lucene/highlighter/src/test/org/apache/lucene/search/highlight/MissesTest.java
@@ -0,0 +1,65 @@
+package org.apache.lucene.search.highlight;
+
+import java.io.IOException;
+
+import org.apache.lucene.analysis.Analyzer;
+import org.apache.lucene.analysis.MockAnalyzer;
+import org.apache.lucene.analysis.MockTokenizer;
+import org.apache.lucene.index.Term;
+import org.apache.lucene.search.BooleanClause.Occur;
+import org.apache.lucene.search.BooleanQuery;
+import org.apache.lucene.search.PhraseQuery;
+import org.apache.lucene.search.Query;
+import org.apache.lucene.search.TermQuery;
+import org.apache.lucene.search.spans.SpanNearQuery;
+import org.apache.lucene.search.spans.SpanQuery;
+import org.apache.lucene.search.spans.SpanTermQuery;
+import org.apache.lucene.util.LuceneTestCase;
+
+public class MissesTest extends LuceneTestCase {
+  public void testTermQuery() throws IOException, InvalidTokenOffsetsException {
+    try (Analyzer analyzer = new MockAnalyzer(random(), MockTokenizer.WHITESPACE, false)) {
+      final Query query = new TermQuery(new Term("test", "foo"));
+      final Highlighter highlighter = new Highlighter(new SimpleHTMLFormatter(), new QueryScorer(query));
+      assertEquals("this is a <B>foo</B> bar example",
+          highlighter.getBestFragment(analyzer, "test", "this is a foo bar example"));
+      assertNull(highlighter.getBestFragment(analyzer, "test", "this does not match"));
+    }
+  }
+
+  public void testBooleanQuery() throws IOException, InvalidTokenOffsetsException {
+    try (Analyzer analyzer = new MockAnalyzer(random(), MockTokenizer.WHITESPACE, false)) {
+      final BooleanQuery query = new BooleanQuery();
+      query.add(new TermQuery(new Term("test", "foo")), Occur.MUST);
+      query.add(new TermQuery(new Term("test", "bar")), Occur.MUST);
+      final Highlighter highlighter = new Highlighter(new SimpleHTMLFormatter(), new QueryScorer(query));
+      assertEquals("this is a <B>foo</B> <B>bar</B> example",
+          highlighter.getBestFragment(analyzer, "test", "this is a foo bar example"));
+      assertNull(highlighter.getBestFragment(analyzer, "test", "this does not match"));
+    }
+  }
+
+  public void testPhraseQuery() throws IOException, InvalidTokenOffsetsException {
+    try (Analyzer analyzer = new MockAnalyzer(random(), MockTokenizer.WHITESPACE, false)) {
+      final PhraseQuery query = new PhraseQuery();
+      query.add(new Term("test", "foo"));
+      query.add(new Term("test", "bar"));
+      final Highlighter highlighter = new Highlighter(new SimpleHTMLFormatter(), new QueryScorer(query));
+      assertEquals("this is a <B>foo</B> <B>bar</B> example",
+          highlighter.getBestFragment(analyzer, "test", "this is a foo bar example"));
+      assertNull(highlighter.getBestFragment(analyzer, "test", "this does not match"));
+    }
+  }
+
+  public void testSpanNearQuery() throws IOException, InvalidTokenOffsetsException {
+    try (Analyzer analyzer = new MockAnalyzer(random(), MockTokenizer.WHITESPACE, false)) {
+      final Query query = new SpanNearQuery(new SpanQuery[] {
+          new SpanTermQuery(new Term("test", "foo")),
+          new SpanTermQuery(new Term("test", "bar"))}, 0, true);
+      final Highlighter highlighter = new Highlighter(new SimpleHTMLFormatter(), new QueryScorer(query));
+      assertEquals("this is a <B>foo</B> <B>bar</B> example",
+          highlighter.getBestFragment(analyzer, "test", "this is a foo bar example"));
+      assertNull(highlighter.getBestFragment(analyzer, "test", "this does not match"));
+    }
+  }
+}
