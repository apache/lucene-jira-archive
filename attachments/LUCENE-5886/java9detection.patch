Index: lucene/common-build.xml
===================================================================
--- lucene/common-build.xml	(revision 1618149)
+++ lucene/common-build.xml	(working copy)
@@ -303,20 +303,47 @@
     </condition>
   </fail>
 
+  <fail message="Minimum supported Java version is 1.7.">
+    <condition>
+      <not><hasmethod classname="java.lang.Throwable" method="getSuppressed"/></not>
+    </condition>
+  </fail>
+
+  <!-- temporary for cleanup of java.specification.version, to be in format "x.y" -->
+  <loadresource property="-cleaned.specification.version">
+    <string value="${java.specification.version}"/>
+    <filterchain>
+      <tokenfilter>
+        <filetokenizer/>
+        <replaceregex pattern="^(\d+\.\d+)(|\..*)$" replace="\1" flags="s"/>
+      </tokenfilter>
+    </filterchain>
+  </loadresource>
+
   <!-- 
     the propery "ant.java.version" is not always correct, depending on used ANT version.
     E.g. Java 8 is only detected in ANT 1.8.3+.
-    Add newer Java version checks at beginning,
-    because ANT will nevert override existing properties!
+    
+    We want to detect here only a limited set of versions and placed in normalized form in ${build.java.runtime},
+    every other version is normalized to "unknown":
+    - To define a target to be only run on a specific version, add <equals/> condition to one of the supplied versions.
+    - To explicitely exclude specific versions (and unknown ones), add a condition to disallow "unknown" and some versions like "1.9"!
    -->
-  <condition property="build.java.runtime" value="1.8">
-    <hasmethod classname="java.util.Collections" method="emptySortedSet"/>
+  <condition property="build.java.runtime" value="${-cleaned.specification.version}">
+    <or>
+      <equals arg1="${-cleaned.specification.version}" arg2="1.7"/>
+      <equals arg1="${-cleaned.specification.version}" arg2="1.8"/>
+      <equals arg1="${-cleaned.specification.version}" arg2="1.9"/>
+    </or>
   </condition>
-  <condition property="build.java.runtime" value="1.7">
-    <hasmethod classname="java.lang.Throwable" method="getSuppressed"/>
-  </condition>
-  <fail message="Minimum supported Java version is 1.7." unless="build.java.runtime"/>
-
+  <!-- else set to unknown: -->
+  <property name="build.java.runtime" value="unknown"/>
+  
+  <!--
+  <echo message="DEBUG: Cleaned java.specification.version=${-cleaned.specification.version}"/>
+  <echo message="DEBUG: Detected runtime: ${build.java.runtime}"/>
+  -->
+  
   <condition property="documentation-lint.supported">
     <and>
       <or>
@@ -336,7 +363,9 @@
   <!-- workaround for https://issues.apache.org/bugzilla/show_bug.cgi?id=53347 -->
   <condition property="build.compiler" value="javac1.7">
     <and>
-      <equals arg1="${build.java.runtime}" arg2="1.8"/>
+      <not>
+        <equals arg1="${build.java.runtime}" arg2="1.7"/>
+      </not>
       <or>
         <antversion exactly="1.8.3" />
         <antversion exactly="1.8.4" />
@@ -353,9 +382,11 @@
     <echo level="warning" message="WARN: Linting documentation HTML is not supported on this Java version (${build.java.runtime}) / JVM (${java.vm.name}). NOTHING DONE!"/>
   </target>
 
-  <!-- for now disable doclint on JDK 8: -->
+  <!-- for now disable doclint on JDK 8+: -->
   <condition property="javadoc.args" value="-Xdoclint:none" else="">
-    <equals arg1="${build.java.runtime}" arg2="1.8"/>
+    <not>
+      <equals arg1="${build.java.runtime}" arg2="1.7"/>
+    </not>
   </condition>
 
   <!-- Import custom ANT tasks. -->
@@ -1798,7 +1829,10 @@
   <!-- ECJ Javadoc linting: -->
   
   <condition property="ecj-javadoc-lint.supported">
-    <not><equals arg1="${build.java.runtime}" arg2="1.9"/></not>
+    <or>
+      <equals arg1="${build.java.runtime}" arg2="1.7"/>
+      <equals arg1="${build.java.runtime}" arg2="1.8"/>
+    </or>
   </condition>
 
   <condition property="ecj-javadoc-lint-tests.supported">
Index: lucene/core/src/java/org/apache/lucene/util/Constants.java
===================================================================
--- lucene/core/src/java/org/apache/lucene/util/Constants.java	(revision 1618149)
+++ lucene/core/src/java/org/apache/lucene/util/Constants.java	(working copy)
@@ -18,7 +18,8 @@
  */
 
 import java.lang.reflect.Field;
-import java.util.Collections;
+import java.util.StringTokenizer;
+
 import org.apache.lucene.LucenePackage;
 
 /**
@@ -32,6 +33,7 @@
   public static final String JVM_VENDOR = System.getProperty("java.vm.vendor");
   public static final String JVM_VERSION = System.getProperty("java.vm.version");
   public static final String JVM_NAME = System.getProperty("java.vm.name");
+  public static final String JVM_SPEC_VERSION = System.getProperty("java.specification.version");
 
   /** The value of <tt>System.getProperty("java.version")</tt>. **/
   public static final String JAVA_VERSION = System.getProperty("java.version");
@@ -52,13 +54,21 @@
   public static final String OS_ARCH = System.getProperty("os.arch");
   public static final String OS_VERSION = System.getProperty("os.version");
   public static final String JAVA_VENDOR = System.getProperty("java.vendor");
-
-  public static final boolean JRE_IS_MINIMUM_JAVA8;
   
+  private static final int JVM_MAJOR_VERSION;
+  private static final int JVM_MINOR_VERSION;
+ 
   /** True iff running on a 64bit JVM */
   public static final boolean JRE_IS_64BIT;
   
   static {
+    final StringTokenizer st = new StringTokenizer(JVM_SPEC_VERSION, ".");
+    JVM_MAJOR_VERSION = Integer.parseInt(st.nextToken());
+    if (st.hasMoreTokens()) {
+      JVM_MINOR_VERSION = Integer.parseInt(st.nextToken());
+    } else {
+      JVM_MINOR_VERSION = 0;
+    }
     boolean is64Bit = false;
     try {
       final Class<?> unsafeClass = Class.forName("sun.misc.Unsafe");
@@ -82,16 +92,10 @@
       }
     }
     JRE_IS_64BIT = is64Bit;
-    
-    // this method only exists in Java 8:
-    boolean v8 = true;
-    try {
-      Collections.class.getMethod("emptySortedSet");
-    } catch (NoSuchMethodException nsme) {
-      v8 = false;
-    }
-    JRE_IS_MINIMUM_JAVA8 = v8;
   }
+  
+  public static final boolean JRE_IS_MINIMUM_JAVA8 = JVM_MAJOR_VERSION > 1 || (JVM_MAJOR_VERSION == 1 && JVM_MINOR_VERSION >= 8);
+  public static final boolean JRE_IS_MINIMUM_JAVA9 = JVM_MAJOR_VERSION > 1 || (JVM_MAJOR_VERSION == 1 && JVM_MINOR_VERSION >= 9);
 
   // this method prevents inlining the final version constant in compiled classes,
   // see: http://www.javaworld.com/community/node/3400
