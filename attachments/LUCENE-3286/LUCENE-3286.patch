Index: lucene/contrib/demo/src/java/org/apache/lucene/demo/xmlparser/FormBasedXmlQueryDemo.java
===================================================================
--- lucene/contrib/demo/src/java/org/apache/lucene/demo/xmlparser/FormBasedXmlQueryDemo.java	(revision 0)
+++ lucene/contrib/demo/src/java/org/apache/lucene/demo/xmlparser/FormBasedXmlQueryDemo.java	(working copy)
@@ -15,7 +15,7 @@
  * limitations under the License.
  */
 
-package org.apache.lucene.xmlparser.webdemo;
+package org.apache.lucene.demo.xmlparser;
 
 import org.apache.lucene.analysis.Analyzer;
 import org.apache.lucene.analysis.standard.StandardAnalyzer;
Index: lucene/contrib/demo/build.xml
===================================================================
--- lucene/contrib/demo/build.xml	(revision 1158088)
+++ lucene/contrib/demo/build.xml	(working copy)
@@ -17,7 +17,7 @@
     limitations under the License.
  -->
 
-<project name="demo" default="jar-core" xmlns:artifact="antlib:org.apache.maven.artifact.ant">
+<project name="demo" default="default" xmlns:artifact="antlib:org.apache.maven.artifact.ant">
 
   <description>
     Lucene Demo
@@ -33,7 +33,27 @@
 	 <pathelement path="${analyzers-common.jar}"/>
    <pathelement path="${queryparser.jar}"/>
    <pathelement path="${lucene-core.jar}"/>
+   <pathelement path="${xml-query-parser.jar}"/>
+   <pathelement location="lib/servlet-api-2.4.jar"/>
   </path>
 
-  <target name="compile-core" depends="jar-analyzers-common,jar-queryparser,common.compile-core" />
+  <target name="compile-core" depends="jar-analyzers-common,jar-queryparser,jar-xml-query-parser,common.compile-core" />
+
+  <target name="default" depends="jar-core,build-web-demo"/>
+
+  <target name="build-artifacts-and-tests" depends="jar, compile-test,build-web-demo" />
+
+  <target name="build-web-demo"  description="Compiles demo">
+    <echo>Compiling XML QueryParser Demo WAR</echo>
+
+    <war destfile="${build.dir}/xml-query-demo.war" webxml="src/resources/org/apache/lucene/demo/xmlparser/WEB-INF/web.xml">
+      <fileset dir="src/resources/org/apache/lucene/demo/xmlparser/"/>
+      <lib dir="${build.dir}">
+        <include name="${final.name}.jar"/>
+      </lib>
+      <lib file="${queries.jar}"/>
+      <lib file="${lucene-core.jar}"/>
+    </war>
+  </target>
+  
 </project>
Index: lucene/contrib/contrib-build.xml
===================================================================
--- lucene/contrib/contrib-build.xml	(revision 1158088)
+++ lucene/contrib/contrib-build.xml	(working copy)
@@ -284,4 +284,15 @@
     </ant>
     <property name="suggest.uptodate" value="true"/>
   </target>
+
+  <property name="xml-query-parser.jar" value="${common.dir}/build/contrib/xml-query-parser/lucene-xml-query-parser-${version}.jar"/>
+  <target name="check-xml-query-parser-uptodate" unless="xml-query-parser.uptodate">
+    <contrib-uptodate name="xml-query-parser" jarfile="${xml-query-parser.jar}" property="xml-query-parser.uptodate"/>
+  </target>
+  <target name="jar-xml-query-parser" unless="xml-query-parser.uptodate" depends="check-xml-query-parser-uptodate">
+    <ant dir="${common.dir}/contrib/xml-query-parser" target="jar-core" inheritall="false">
+      <propertyset refid="uptodate.and.compiled.properties"/>
+    </ant>
+    <property name="xml-query-parser.uptodate" value="true"/>
+  </target>
 </project>
\ No newline at end of file
Index: lucene/contrib/xml-query-parser/src/demo/java/org/apache/lucene/xmlparser/webdemo/FormBasedXmlQueryDemo.java (deleted)
===================================================================
Index: lucene/contrib/xml-query-parser/src/demo/WebContent/META-INF/MANIFEST.MF (deleted)
===================================================================
Index: lucene/contrib/xml-query-parser/src/demo/WebContent/stylesheet.css (deleted)
===================================================================
Index: lucene/contrib/xml-query-parser/src/demo/WebContent/index.jsp (deleted)
===================================================================
Index: lucene/contrib/xml-query-parser/src/demo/WebContent/WEB-INF/data.tsv (deleted)
===================================================================
Index: lucene/contrib/xml-query-parser/src/demo/WebContent/WEB-INF/query.xsl (deleted)
===================================================================
Index: lucene/contrib/xml-query-parser/src/demo/WebContent/WEB-INF/web.xml (deleted)
===================================================================
Index: lucene/contrib/xml-query-parser/build.xml
===================================================================
--- lucene/contrib/xml-query-parser/build.xml	(revision 1158088)
+++ lucene/contrib/xml-query-parser/build.xml	(working copy)
@@ -25,9 +25,6 @@
 
   <import file="../contrib-build.xml"/>
 
-  <property name="servlet.jar" location="${common.dir}/lib/servlet-api-2.4.jar"/>
-  <available property="servlet.jar.present" type="file" file="${servlet.jar}"/>
-
   <path id="classpath">
     <pathelement path="${queries-contrib.jar}"/>
     <pathelement path="${queryparser.jar}"/>
@@ -35,41 +32,5 @@
     <path refid="base.classpath"/>
   </path>
 
-  <path id="web-classpath">
-    <pathelement path="${queries-contrib.jar}"/>
-    <pathelement path="${queryparser.jar}"/>
-    <pathelement path="${queries.jar}"/>
-    <pathelement path="${servlet.jar}"/>
-    <pathelement path="${build.dir}/${final.name}.jar"/>
-    <path refid="base.classpath"/>
-  </path>
-
   <target name="compile-core" depends="jar-queries-contrib,jar-queryparser,jar-queries,common.compile-core" />
-
-  <!-- override contrib-build.xml target to also build web demo -->
-  <target name="build-artifacts-and-tests" depends="jar, compile-test,build-web-demo" />
-
-  <target name="default" depends="jar-lucene-core,jar-core,build-web-demo"/>
-
-  <target name="build-web-demo"  description="Compiles demo" if="servlet.jar.present">
-
-    <echo>XML Parser compiling web demo</echo>
-
-    <compile
-      srcdir="src/demo/java"
-      destdir="${build.dir}/classes/webdemo">
-      <classpath refid="web-classpath"/>
-    </compile>
-
-    <war destfile="${build.dir}/xml-query-demo.war" webxml="src/demo/WebContent/WEB-INF/web.xml">
-      <fileset dir="src/demo/WebContent"/>
-      <lib dir="${build.dir}">
-        <include name="${final.name}.jar"/>
-      </lib>
-      <lib file="${queries.jar}"/>
-      <lib file="${lucene-core.jar}"/>
-      <classes dir="${build.dir}/classes/webdemo"/>
-    </war>
-
-  </target>
 </project>
Index: dev-tools/idea/lucene/contrib/demo/demo.iml
===================================================================
--- dev-tools/idea/lucene/contrib/demo/demo.iml	(revision 1158088)
+++ dev-tools/idea/lucene/contrib/demo/demo.iml	(working copy)
@@ -6,12 +6,23 @@
     <exclude-output />
     <content url="file://$MODULE_DIR$">
       <sourceFolder url="file://$MODULE_DIR$/src/java" isTestSource="false" />
+      <sourceFolder url="file://$MODULE_DIR$/src/resources" isTestSource="false" />
       <sourceFolder url="file://$MODULE_DIR$/src/test" isTestSource="true" />
     </content>
     <orderEntry type="inheritedJdk" />
     <orderEntry type="sourceFolder" forTests="false" />
     <orderEntry type="library" scope="TEST" name="JUnit" level="project" />
+    <orderEntry type="module-library">
+      <library>
+        <CLASSES>
+          <root url="jar://$MODULE_DIR$/lib/servlet-api-2.4.jar!/" />
+        </CLASSES>
+        <JAVADOC />
+        <SOURCES />
+      </library>
+    </orderEntry>
     <orderEntry type="module" module-name="analysis-common" />
+    <orderEntry type="module" module-name="xml-query-parser" />
     <orderEntry type="module" module-name="lucene" />
     <orderEntry type="module" module-name="queryparser" />
   </component>
Index: dev-tools/idea/lucene/contrib/xml-query-parser/xml-query-parser.iml
===================================================================
--- dev-tools/idea/lucene/contrib/xml-query-parser/xml-query-parser.iml	(revision 1158088)
+++ dev-tools/idea/lucene/contrib/xml-query-parser/xml-query-parser.iml	(working copy)
@@ -6,14 +6,11 @@
     <exclude-output />
     <content url="file://$MODULE_DIR$">
       <sourceFolder url="file://$MODULE_DIR$/src/java" isTestSource="false" />
-      <sourceFolder url="file://$MODULE_DIR$/src/demo/java" isTestSource="false" />
-      <sourceFolder url="file://$MODULE_DIR$/src/demo/WebContent" isTestSource="false" />
       <sourceFolder url="file://$MODULE_DIR$/src/test" isTestSource="true" />
     </content>
     <orderEntry type="inheritedJdk" />
     <orderEntry type="sourceFolder" forTests="false" />
     <orderEntry type="library" scope="TEST" name="JUnit" level="project" />
-    <orderEntry type="library" name="Servlet API 2.4" level="project" />
     <orderEntry type="module" module-name="queries-contrib" />
     <orderEntry type="module" module-name="misc" />
     <orderEntry type="module" module-name="analysis-common" />
Index: dev-tools/eclipse/dot.classpath
===================================================================
--- dev-tools/eclipse/dot.classpath	(revision 1158088)
+++ dev-tools/eclipse/dot.classpath	(working copy)
@@ -4,6 +4,7 @@
 	<classpathentry kind="src" path="lucene/src/test-framework"/>
 	<classpathentry kind="src" path="lucene/src/test"/>
 	<classpathentry kind="src" path="lucene/contrib/demo/src/java"/>
+	<classpathentry kind="src" path="lucene/contrib/demo/src/resources"/>
 	<classpathentry kind="src" path="lucene/contrib/demo/src/test"/>
 	<classpathentry kind="src" path="lucene/contrib/highlighter/src/java"/>
 	<classpathentry kind="src" path="lucene/contrib/highlighter/src/test"/>
Index: dev-tools/maven/lucene/contrib/demo/pom.xml.template
===================================================================
--- dev-tools/maven/lucene/contrib/demo/pom.xml.template	(revision 1158088)
+++ dev-tools/maven/lucene/contrib/demo/pom.xml.template	(working copy)
@@ -58,6 +58,16 @@
       <version>${project.version}</version>
     </dependency>
     <dependency>
+      <groupId>${project.groupId}</groupId>
+      <artifactId>lucene-xml-query-parser</artifactId>
+      <version>${project.version}</version>
+    </dependency>
+    <dependency>
+      <groupId>javax.servlet</groupId>
+      <artifactId>servlet-api</artifactId>
+      <scope>provided</scope>
+    </dependency>
+    <dependency>
       <groupId>junit</groupId>
       <artifactId>junit</artifactId>
       <scope>test</scope>
Index: dev-tools/maven/lucene/contrib/xml-query-parser/pom.xml.template
===================================================================
--- dev-tools/maven/lucene/contrib/xml-query-parser/pom.xml.template	(revision 1158088)
+++ dev-tools/maven/lucene/contrib/xml-query-parser/pom.xml.template	(working copy)
@@ -63,11 +63,6 @@
       <version>${project.version}</version>
     </dependency>
     <dependency>
-      <groupId>javax.servlet</groupId>
-      <artifactId>servlet-api</artifactId>
-      <scope>provided</scope>
-    </dependency>
-    <dependency>
       <groupId>junit</groupId>
       <artifactId>junit</artifactId>
       <scope>test</scope>
