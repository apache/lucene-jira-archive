From 1154d8247463c4d9897c11f06652c699173d171f Mon Sep 17 00:00:00 2001
From: Martijn van Groningen <martijn.v.groningen@gmail.com>
Date: Fri, 22 Jul 2016 16:26:05 +0200
Subject: [PATCH] LUCENE-7383: Fix 'dimensionNumBytes' validation

---
 lucene/core/src/java/org/apache/lucene/document/FieldType.java    | 2 +-
 lucene/core/src/test/org/apache/lucene/index/TestPointValues.java | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/lucene/core/src/java/org/apache/lucene/document/FieldType.java b/lucene/core/src/java/org/apache/lucene/document/FieldType.java
index 2c0a62c..e0f058f 100644
--- a/lucene/core/src/java/org/apache/lucene/document/FieldType.java
+++ b/lucene/core/src/java/org/apache/lucene/document/FieldType.java
@@ -374,7 +374,7 @@ public class FieldType implements IndexableFieldType  {
     if (dimensionNumBytes < 0) {
       throw new IllegalArgumentException("dimensionNumBytes must be >= 0; got " + dimensionNumBytes);
     }
-    if (dimensionCount > PointValues.MAX_NUM_BYTES) {
+    if (dimensionNumBytes > PointValues.MAX_NUM_BYTES) {
       throw new IllegalArgumentException("dimensionNumBytes must be <= " + PointValues.MAX_NUM_BYTES + "; got " + dimensionNumBytes);
     }
     if (dimensionCount == 0) {
diff --git a/lucene/core/src/test/org/apache/lucene/index/TestPointValues.java b/lucene/core/src/test/org/apache/lucene/index/TestPointValues.java
index 9693c5c..055e93c 100644
--- a/lucene/core/src/test/org/apache/lucene/index/TestPointValues.java
+++ b/lucene/core/src/test/org/apache/lucene/index/TestPointValues.java
@@ -362,8 +362,8 @@ public class TestPointValues extends LuceneTestCase {
     IndexWriterConfig iwc = new IndexWriterConfig(new MockAnalyzer(random()));
     IndexWriter w = new IndexWriter(dir, iwc);
     Document doc = new Document();
-    doc.add(new BinaryPoint("dim", new byte[PointValues.MAX_NUM_BYTES+1]));
     expectThrows(IllegalArgumentException.class, () -> {
+      doc.add(new BinaryPoint("dim", new byte[PointValues.MAX_NUM_BYTES+1]));
       w.addDocument(doc);
     });
 
-- 
2.7.4 (Apple Git-66)

