Index: .
===================================================================
--- .	(revision 1576724)
+++ .	(working copy)

Property changes on: .
___________________________________________________________________
Modified: svn:mergeinfo
   Merged /lucene/dev/trunk:r1457734,1457751,1457868,1459437,1499935
Index: .gitignore
===================================================================
--- .gitignore	(revision 1576724)
+++ .gitignore	(working copy)
@@ -1,4 +1,5 @@
 # .
+/eclipse-build
 /classes
 **/build
 /idea-build
Index: build.xml
===================================================================
--- build.xml	(revision 1576724)
+++ build.xml	(working copy)
@@ -221,7 +221,7 @@
       <outputproperty name="indent" value="yes"/>
       <param name="netbeans.fileset.sourcefolders" expression="${netbeans.fileset.sourcefolders}"/>
       <param name="netbeans.path.libs" expression="${netbeans.path.libs}"/>
-      <param name="netbeans.source-level" expression="1.6"/>
+      <param name="netbeans.source-level" expression="1.7"/>
     </xslt>
   </target>
 
@@ -261,7 +261,7 @@
 
     <echo>
       SUCCESS: You must right-click your project and choose Refresh.
-               Your project must use a Java 6 JRE.
+               Your project must use a Java 7 JRE.
     </echo>
   </target>
 
@@ -300,7 +300,7 @@
 JDKs you have defined locally - see 
 File | Project Structure | Platform Settings | SDKs):
 
-    idea.jdk = project-jdk-name="1.6" project-jdk-type="JavaSDK"
+    idea.jdk = project-jdk-name="1.7" project-jdk-type="JavaSDK"
     </echo>
   </target>
 
@@ -359,16 +359,11 @@
      <property environment="env"/>
   </target>
   
-  <target name="-env-JAVA6_HOME" depends="-load-env" if="env.JAVA6_HOME">
-     <property name="JAVA6_HOME" value="${env.JAVA6_HOME}"/>
-  </target>
-  
   <target name="-env-JAVA7_HOME" depends="-load-env" if="env.JAVA7_HOME">
      <property name="JAVA7_HOME" value="${env.JAVA7_HOME}"/>
   </target>
   
-  <target name="nightly-smoke" description="Builds an unsigned release and smoke tests it" depends="clean,-env-JAVA6_HOME,-env-JAVA7_HOME">
-   <fail unless="JAVA6_HOME">JAVA6_HOME property or environment variable is not defined.</fail>
+  <target name="nightly-smoke" description="Builds an unsigned release and smoke tests it" depends="clean,-env-JAVA7_HOME">
    <fail unless="JAVA7_HOME">JAVA7_HOME property or environment variable is not defined.</fail>
    <exec executable="${python32.exe}" failonerror="true">
       <arg value="-V"/>
@@ -401,7 +396,6 @@
      <arg value="false"/>
      <arg value="-testArgs"/>
      <arg value="${smokeTestRelease.testArgs}"/>
-     <env key="JAVA6_HOME" file="${JAVA6_HOME}"/>
      <env key="JAVA7_HOME" file="${JAVA7_HOME}"/>
    </exec>
    <delete dir="${fakeRelease}"/>
Index: dev-tools
===================================================================
--- dev-tools	(revision 1576724)
+++ dev-tools	(working copy)

Property changes on: dev-tools
___________________________________________________________________
Modified: svn:mergeinfo
   Merged /lucene/dev/trunk/dev-tools:r1457734,1457868
Index: dev-tools/eclipse/dot.settings/org.eclipse.jdt.core.prefs
===================================================================
--- dev-tools/eclipse/dot.settings/org.eclipse.jdt.core.prefs	(revision 1576724)
+++ dev-tools/eclipse/dot.settings/org.eclipse.jdt.core.prefs	(working copy)
@@ -1,7 +1,7 @@
 #Sun Sep 23 13:02:27 EDT 2012
 eclipse.preferences.version=1
-org.eclipse.jdt.core.compiler.codegen.targetPlatform=1.6
-org.eclipse.jdt.core.compiler.compliance=1.6
+org.eclipse.jdt.core.compiler.codegen.targetPlatform=1.7
+org.eclipse.jdt.core.compiler.compliance=1.7
 org.eclipse.jdt.core.compiler.doc.comment.support=enabled
 org.eclipse.jdt.core.compiler.problem.assertIdentifier=error
 org.eclipse.jdt.core.compiler.problem.enumIdentifier=error
@@ -18,7 +18,7 @@
 org.eclipse.jdt.core.compiler.problem.missingJavadocTagsMethodTypeParameters=disabled
 org.eclipse.jdt.core.compiler.problem.missingJavadocTagsOverriding=disabled
 org.eclipse.jdt.core.compiler.problem.missingJavadocTagsVisibility=public
-org.eclipse.jdt.core.compiler.source=1.6
+org.eclipse.jdt.core.compiler.source=1.7
 org.eclipse.jdt.core.formatter.align_type_members_on_columns=false
 org.eclipse.jdt.core.formatter.alignment_for_arguments_in_allocation_expression=16
 org.eclipse.jdt.core.formatter.alignment_for_arguments_in_annotation=0
Index: dev-tools/idea/.idea/misc.xml
===================================================================
--- dev-tools/idea/.idea/misc.xml	(revision 1576724)
+++ dev-tools/idea/.idea/misc.xml	(working copy)
@@ -1,5 +1,5 @@
 <?xml version="1.0" encoding="UTF-8"?>
 <project version="4">
-  <component name="ProjectRootManager" version="2" languageLevel="JDK_1_6" subst.="idea.jdk" />
+  <component name="ProjectRootManager" version="2" languageLevel="JDK_1_7" subst.="idea.jdk" />
 </project>
 
Index: dev-tools/idea/lucene/core/src/test/lucene-core-tests.iml
===================================================================
--- dev-tools/idea/lucene/core/src/test/lucene-core-tests.iml	(revision 1576724)
+++ dev-tools/idea/lucene/core/src/test/lucene-core-tests.iml	(working copy)
@@ -11,8 +11,8 @@
     <orderEntry type="module" scope="TEST" module-name="lucene-test-framework" />
     <orderEntry type="sourceFolder" forTests="true" />
     <orderEntry type="library" scope="TEST" name="JUnit" level="project" />
+    <orderEntry type="module" scope="TEST" module-name="codecs" />
     <orderEntry type="module" scope="TEST" module-name="lucene-core" />
-    <orderEntry type="module" scope="TEST" module-name="codecs" />
   </component>
 </module>
 
Index: dev-tools/maven/pom.xml.template
===================================================================
--- dev-tools/maven/pom.xml.template	(revision 1576724)
+++ dev-tools/maven/pom.xml.template	(working copy)
@@ -43,7 +43,7 @@
     <vc-browse-base-url>http://svn.apache.org/viewvc/lucene/dev/branches/branch_4x</vc-browse-base-url>
     <base.specification.version>4.8.0</base.specification.version>
     <maven.build.timestamp.format>yyyy-MM-dd HH:mm:ss</maven.build.timestamp.format>
-    <java.compat.version>1.6</java.compat.version>
+    <java.compat.version>1.7</java.compat.version>
     <jetty.version>8.1.10.v20130312</jetty.version>
 
     <!-- RandomizedTesting library system properties -->
Index: dev-tools/maven/README.maven
===================================================================
--- dev-tools/maven/README.maven	(revision 1576724)
+++ dev-tools/maven/README.maven	(working copy)
@@ -36,7 +36,7 @@
 
 B. How to generate Lucene/Solr Maven artifacts
 
-   Prerequisites: JDK 1.6+ and Ant 1.8.2+
+   Prerequisites: JDK 1.7+ and Ant 1.8.2+
 
    Run 'ant generate-maven-artifacts' to create an internal Maven
    repository, including POMs, binary .jars, source .jars, and javadoc
@@ -50,7 +50,7 @@
 
 C. How to deploy Maven artifacts to a repository
 
-   Prerequisites: JDK 1.6+ and Ant 1.8.2+
+   Prerequisites: JDK 1.7+ and Ant 1.8.2+
 
    You can deploy targets for all of Lucene/Solr, only Lucene, or only Solr,
    as in B. above.  To deploy to a Maven repository, the command is the same
@@ -77,7 +77,7 @@
 
    The details, followed by some example Maven commands:
 
-   1. Prerequisites: JDK 1.6+ and Maven 2.2.1 or 3.X
+   1. Prerequisites: JDK 1.7+ and Maven 2.2.1 or 3.X
 
    2. Make sure your sources are up to date.  If you checked your sources out
       from the Apache Subversion repository, run "svn update" from the top
@@ -101,8 +101,8 @@
 
          ant -Dversion=my-special-version get-maven-poms
 
-      or to append "my-special-version" to the current base version, e.g. 4.7,
-      resulting in version "4.7-my-special-version":
+      or to append "my-special-version" to the current base version, e.g. 4.8,
+      resulting in version "4.8-my-special-version":
 
          ant -Ddev.version.suffix=my-special-version get-maven-poms
 
Index: dev-tools/scripts/diffSources.py
===================================================================
--- dev-tools/scripts/diffSources.py	(revision 1576724)
+++ dev-tools/scripts/diffSources.py	(working copy)
@@ -50,7 +50,7 @@
   elif l.endswith('\n'):
     l = l[:-1]
   if l.startswith('diff ') or l.startswith('Binary files '):
-    keep = not l.endswith('timehints.txt') and l.lower().find('/build/') == -1 and (l.lower().startswith('Only in') or ((l.lower().endswith('.java') or l.lower().endswith('.txt') or l.lower().endswith('.xml') or l.lower().endswith('.iml')) and l.find('/.svn/') == -1))
+    keep = not l.endswith('timehints.txt') and l.lower().find('/build/') == -1 and (l.lower().startswith('Only in') or ((l.lower().endswith('.java') or l.lower().endswith('.txt') or l.lower().endswith('.xml') or l.lower().endswith('.iml') or l.lower().endswith('.html') or l.lower().endswith('.template') or l.lower().endswith('.py') or l.lower().endswith('.g') or l.lower().endswith('.properties')) and l.find('/.svn/') == -1))
     if keep:
       print
       print
Index: dev-tools/scripts/smokeTestRelease.py
===================================================================
--- dev-tools/scripts/smokeTestRelease.py	(revision 1576724)
+++ dev-tools/scripts/smokeTestRelease.py	(working copy)
@@ -59,9 +59,7 @@
   return url  
 
 def javaExe(version):
-  if version == '1.6':
-    path = JAVA6_HOME
-  elif version == '1.7':
+  if version == '1.7':
     path = JAVA7_HOME
   else:
     raise RuntimeError("unknown Java version '%s'" % version)
@@ -77,18 +75,11 @@
 # http://s.apache.org/lusolr32rc2
 env = os.environ
 try:
-  JAVA6_HOME = env['JAVA6_HOME']
-except KeyError:
-  raise RuntimeError('please set JAVA6_HOME in the env before running smokeTestRelease')
-print('JAVA6_HOME is %s' % JAVA6_HOME)
-
-try:
   JAVA7_HOME = env['JAVA7_HOME']
 except KeyError:
   raise RuntimeError('please set JAVA7_HOME in the env before running smokeTestRelease')
 print('JAVA7_HOME is %s' % JAVA7_HOME)
 
-verifyJavaVersion('1.6')
 verifyJavaVersion('1.7')
 
 # TODO
@@ -201,15 +192,15 @@
     for verify in (
       'Specification-Vendor: The Apache Software Foundation',
       'Implementation-Vendor: The Apache Software Foundation',
-      # Make sure 1.6 compiler was used to build release bits:
-      'X-Compile-Source-JDK: 1.6',
+      # Make sure 1.7 compiler was used to build release bits:
+      'X-Compile-Source-JDK: 1.7',
       # Make sure 1.8 ant was used to build release bits: (this will match 1.8+)
       'Ant-Version: Apache Ant 1.8',
-      # Make sure .class files are 1.6 format:
-      'X-Compile-Target-JDK: 1.6',
+      # Make sure .class files are 1.7 format:
+      'X-Compile-Target-JDK: 1.7',
       'Specification-Version: %s' % version,
-      # Make sure the release was compiled with 1.6:
-      'Created-By: 1.6'):
+      # Make sure the release was compiled with 1.7:
+      'Created-By: 1.7'):
       if s.find(verify) == -1:
         raise RuntimeError('%s is missing "%s" inside its META-INF/MANIFEST.MF' % \
                            (desc, verify))
@@ -293,8 +284,8 @@
           if not identical:
             raise RuntimeError('Artifact %s is not identical to %s in Lucene binary distribution'
                                % (fullPath, luceneDistFilenames[jarFilename]))
-  
 
+
 def checkSolrWAR(warFileName, svnRevision, version, tmpDir, baseURL):
 
   """
@@ -331,8 +322,9 @@
             distJarContents = distJarFile.readall()
           if jarInsideWarContents != distJarContents:
             raise RuntimeError('Artifact %s in %s is not identical to %s in Lucene binary distribution'
-                              % (name, warFileName, distJarName)) 
-       
+                              % (name, warFileName, distJarName))
+          
+        
 def checkSigs(project, urlString, version, tmpDir, isSigned):
 
   print('  test basics...')
@@ -726,15 +718,6 @@
     run('%s; ant validate' % javaExe('1.7'), '%s/validate.log' % unpackPath)
 
     if project == 'lucene':
-      print("    run tests w/ Java 6 and testArgs='%s'..." % testArgs)
-      run('%s; ant test %s' % (javaExe('1.6'), testArgs), '%s/test.log' % unpackPath)
-      run('%s; ant jar' % javaExe('1.6'), '%s/compile.log' % unpackPath)
-      testDemo(isSrc, version, '1.6')
-      # test javadocs
-      print('    generate javadocs w/ Java 6...')
-      run('%s; ant javadocs' % javaExe('1.6'), '%s/javadocs.log' % unpackPath)
-      checkJavadocpath('%s/build/docs' % unpackPath)
-
       print("    run tests w/ Java 7 and testArgs='%s'..." % testArgs)
       run('%s; ant clean test %s' % (javaExe('1.7'), testArgs), '%s/test.log' % unpackPath)
       run('%s; ant jar' % javaExe('1.7'), '%s/compile.log' % unpackPath)
@@ -747,14 +730,6 @@
     else:
       os.chdir('solr')
 
-      print("    run tests w/ Java 6 and testArgs='%s'..." % testArgs)
-      run('%s; ant test -Dtests.slow=false %s' % (javaExe('1.6'), testArgs), '%s/test.log' % unpackPath)
-
-      # test javadocs
-      print('    generate javadocs w/ Java 6...')
-      run('%s; ant javadocs' % javaExe('1.6'), '%s/javadocs.log' % unpackPath)
-      checkJavadocpath('%s/solr/build/docs' % unpackPath, False)
-
       print("    run tests w/ Java 7 and testArgs='%s'..." % testArgs)
       run('%s; ant clean test -Dtests.slow=false %s' % (javaExe('1.7'), testArgs), '%s/test.log' % unpackPath)
  
@@ -763,10 +738,6 @@
       run('%s; ant clean javadocs' % javaExe('1.7'), '%s/javadocs.log' % unpackPath)
       checkJavadocpathFull('%s/solr/build/docs' % unpackPath, False)
 
-      print('    test solr example w/ Java 6...')
-      run('%s; ant clean example' % javaExe('1.6'), '%s/antexample.log' % unpackPath)
-      testSolrExample(unpackPath, JAVA6_HOME, True)
-
       print('    test solr example w/ Java 7...')
       run('%s; ant clean example' % javaExe('1.7'), '%s/antexample.log' % unpackPath)
       testSolrExample(unpackPath, JAVA7_HOME, True)
@@ -780,21 +751,11 @@
     checkAllJARs(os.getcwd(), project, svnRevision, version, tmpDir, baseURL)
     
     if project == 'lucene':
-      testDemo(isSrc, version, '1.6')
       testDemo(isSrc, version, '1.7')
 
     else:
       checkSolrWAR('%s/example/webapps/solr.war' % unpackPath, svnRevision, version, tmpDir, baseURL)
 
-      print('    copying unpacked distribution for Java 6 ...')
-      java6UnpackPath = '%s-java6' %unpackPath
-      if os.path.exists(java6UnpackPath):
-        shutil.rmtree(java6UnpackPath)
-      shutil.copytree(unpackPath, java6UnpackPath)
-      os.chdir(java6UnpackPath)
-      print('    test solr example w/ Java 6...')
-      testSolrExample(java6UnpackPath, JAVA6_HOME, False)
-
       print('    copying unpacked distribution for Java 7 ...')
       java7UnpackPath = '%s-java7' %unpackPath
       if os.path.exists(java7UnpackPath):
Index: lucene
===================================================================
--- lucene	(revision 1576724)
+++ lucene	(working copy)

Property changes on: lucene
___________________________________________________________________
Modified: svn:mergeinfo
   Reverse-merged /lucene/dev/trunk/lucene:r1450246,1466732
   Merged /lucene/dev/trunk/lucene:r1457734,1457751,1457868,1459437
Index: lucene/BUILD.txt
===================================================================
--- lucene/BUILD.txt	(revision 1576724)
+++ lucene/BUILD.txt	(working copy)
@@ -1,19 +1,19 @@
 Lucene Build Instructions
 
 Basic steps:
-  0) Install JDK 1.6 (or greater), Ant 1.8.2+, Ivy 2.2.0
+  0) Install JDK 1.7 (or greater), Ant 1.8.2+, Ivy 2.2.0
   1) Download Lucene from Apache and unpack it
   2) Connect to the top-level of your Lucene installation
   3) Install JavaCC (optional)
   4) Run ant
 
-Step 0) Set up your development environment (JDK 1.6 or greater,
+Step 0) Set up your development environment (JDK 1.7 or greater,
 Ant 1.8.2+, Ivy 2.2.0)
 
 We'll assume that you know how to get and set up the JDK - if you
 don't, then we suggest starting at http://java.sun.com and learning
 more about Java, before returning to this README. Lucene runs with
-JDK 1.6 and later.
+JDK 1.7 and later.
 
 Like many Open Source java projects, Lucene uses Apache Ant for build
 control.  Specifically, you MUST use Ant version 1.8.2+.
Index: lucene/BUILD.txt
===================================================================
--- lucene/BUILD.txt	(revision 1576724)
+++ lucene/BUILD.txt	(working copy)

Property changes on: lucene/BUILD.txt
___________________________________________________________________
Modified: svn:mergeinfo
   Merged /lucene/dev/trunk/lucene/BUILD.txt:r1457734,1457868
Index: lucene/build.xml
===================================================================
--- lucene/build.xml	(revision 1576724)
+++ lucene/build.xml	(working copy)
@@ -235,6 +235,7 @@
     <check-missing-javadocs dir="build/docs/analyzers-stempel" level="method"/>
     <!-- analyzers-uima: problems -->
     <!-- benchmark: problems -->
+    <check-missing-javadocs dir="build/docs/classification" level="method"/>
     <!-- codecs: problems -->
     <!-- core: problems -->
     <check-missing-javadocs dir="build/docs/demo" level="method"/>
@@ -258,7 +259,6 @@
     <check-missing-javadocs dir="build/docs/core/org/apache/lucene/search/similarities" level="method"/>
     <check-missing-javadocs dir="build/docs/core/org/apache/lucene/index" level="method"/>
     <check-missing-javadocs dir="build/docs/core/org/apache/lucene/codecs" level="method"/>
-    <check-missing-javadocs dir="build/docs/classification" level="method"/>
   </target>
   
   <target name="-ecj-javadoc-lint" depends="compile,compile-test,-ecj-javadoc-lint-unsupported,-ecj-resolve" if="ecj-javadoc-lint.supported">
@@ -423,7 +423,7 @@
     <svn-export-source source.dir="."/>
 
     <!-- Exclude javadoc package-list files under licenses incompatible with the ASL -->
-    <delete dir="${svn.export.dir}/tools/javadoc/java6"/>
+    <delete dir="${svn.export.dir}/tools/javadoc/java7"/>
     <!-- Exclude clover license files incompatible with the ASL -->
     <delete dir="${svn.export.dir}/tools/clover"/>
 
Index: lucene/build.xml
===================================================================
--- lucene/build.xml	(revision 1576724)
+++ lucene/build.xml	(working copy)

Property changes on: lucene/build.xml
___________________________________________________________________
Modified: svn:mergeinfo
   Merged /lucene/dev/trunk/lucene/build.xml:r1457734,1457868
Index: lucene/CHANGES.txt
===================================================================
--- lucene/CHANGES.txt	(revision 1576724)
+++ lucene/CHANGES.txt	(working copy)

Property changes on: lucene/CHANGES.txt
___________________________________________________________________
Modified: svn:mergeinfo
   Merged /lucene/dev/trunk/lucene/CHANGES.txt:r1457734,1457868,1459437
Index: lucene/common-build.xml
===================================================================
--- lucene/common-build.xml	(revision 1576724)
+++ lucene/common-build.xml	(working copy)
@@ -154,15 +154,15 @@
 
   <property name="javac.deprecation" value="off"/>
   <property name="javac.debug" value="on"/>
-  <property name="javac.source" value="1.6"/>
-  <property name="javac.target" value="1.6"/>
-  <property name="javac.source.backwards" value="1.6"/>
-  <property name="javac.target.backwards" value="1.6"/>
+  <property name="javac.source" value="1.7"/>
+  <property name="javac.target" value="1.7"/>
+  <property name="javac.source.backwards" value="1.7"/>
+  <property name="javac.target.backwards" value="1.7"/>
   <property name="javac.args" value="-Xlint -Xlint:-deprecation -Xlint:-serial -Xlint:-options"/>
-  <property name="javadoc.link" value="http://download.oracle.com/javase/6/docs/api/"/>
+  <property name="javadoc.link" value="http://download.oracle.com/javase/7/docs/api/"/>
   <property name="javadoc.link.junit" value="http://junit.sourceforge.net/javadoc/"/>
   <property name="javadoc.packagelist.dir" location="${common.dir}/tools/javadoc"/>
-  <available file="${javadoc.packagelist.dir}/java6/package-list" property="javadoc.java6.packagelist.exists"/>
+  <available file="${javadoc.packagelist.dir}/java7/package-list" property="javadoc.java7.packagelist.exists"/>
   <property name="javadoc.access" value="protected"/>
   <property name="javadoc.charset" value="utf-8"/>
   <property name="javadoc.dir" location="${common.dir}/build/docs"/>
@@ -285,7 +285,7 @@
   </propertyset>
 
   <patternset id="lucene.local.src.package.patterns"
-              excludes="**/pom.xml,**/*.iml,**/*.jar,build/**,dist/**,benchmark/work/**,benchmark/temp/**,tools/javadoc/java6/**,tools/clover/**"
+              excludes="**/pom.xml,**/*.iml,**/*.jar,build/**,dist/**,benchmark/work/**,benchmark/temp/**,tools/javadoc/java7/**,tools/clover/**"
   />
 
   <!-- Default exclude sources and javadoc jars from Ivy fetch to save time and bandwidth -->
@@ -314,10 +314,7 @@
   <condition property="build.java.runtime" value="1.7">
     <hasmethod classname="java.lang.Throwable" method="getSuppressed"/>
   </condition>
-  <condition property="build.java.runtime" value="1.6">
-    <hasmethod classname="java.lang.String" method="isEmpty"/>
-  </condition>
-  <fail message="Minimum supported Java version is 1.6." unless="build.java.runtime"/>
+  <fail message="Minimum supported Java version is 1.7." unless="build.java.runtime"/>
 
   <condition property="documentation-lint.supported">
     <and>
@@ -1842,7 +1839,7 @@
     <attribute name="overview" default="${src.dir}/overview.html"/>
     <attribute name="linksource" default="no"/>
     <sequential>
-      <antcall target="download-java6-javadoc-packagelist"/>
+      <antcall target="download-java7-javadoc-packagelist"/>
       <delete file="@{destdir}/stylesheet.css" failonerror="false"/>
       <copy todir="@{destdir}" file="${prettify.dir}/prettify.js" overwrite="false" />
       <record name="@{destdir}/log_javadoc.txt" action="start" append="no"/>
@@ -1871,8 +1868,8 @@
           description="WARNING: This API is experimental and might change in incompatible ways in the next release."/>
         <tag name="lucene.internal"
         description="NOTE: This API is for internal purposes only and might change in incompatible ways in the next release."/>
-          <link offline="true" packagelistLoc="${javadoc.dir}"/>
-        <link offline="true" href="${javadoc.link}" packagelistLoc="${javadoc.packagelist.dir}/java6"/>
+      	<link offline="true" packagelistLoc="${javadoc.dir}"/>
+        <link offline="true" href="${javadoc.link}" packagelistLoc="${javadoc.packagelist.dir}/java7"/>
         <bottom><![CDATA[
           <i>Copyright &copy; ${year} Apache Software Foundation.  All Rights Reserved.</i>
           <script src='{@docRoot}/prettify.js' type='text/javascript'></script>
@@ -2003,10 +2000,10 @@
     </sequential>
   </macrodef>
 
-  <target name="download-java6-javadoc-packagelist" unless="javadoc.java6.packagelist.exists">
-    <mkdir dir="${javadoc.packagelist.dir}/java6"/>
+  <target name="download-java7-javadoc-packagelist" unless="javadoc.java7.packagelist.exists">
+    <mkdir dir="${javadoc.packagelist.dir}/java7"/>
     <get src="${javadoc.link}/package-list"
-         dest="${javadoc.packagelist.dir}/java6/package-list" ignoreerrors="true"/>
+         dest="${javadoc.packagelist.dir}/java7/package-list" ignoreerrors="true"/>
   </target>
 
   <!-- VALIDATION work -->
Index: lucene/common-build.xml
===================================================================
--- lucene/common-build.xml	(revision 1576724)
+++ lucene/common-build.xml	(working copy)

Property changes on: lucene/common-build.xml
___________________________________________________________________
Modified: svn:mergeinfo
   Merged /lucene/dev/trunk/lucene/common-build.xml:r1457734,1457868
Index: lucene/core
===================================================================
--- lucene/core	(revision 1576724)
+++ lucene/core	(working copy)

Property changes on: lucene/core
___________________________________________________________________
Modified: svn:mergeinfo
   Reverse-merged /lucene/dev/trunk/lucene/core:r1466732
   Merged /lucene/dev/trunk/lucene/core:r1457734,1457751,1457868,1459437
Index: lucene/core/src/java/org/apache/lucene/index/IndexCommit.java
===================================================================
--- lucene/core/src/java/org/apache/lucene/index/IndexCommit.java	(revision 1576724)
+++ lucene/core/src/java/org/apache/lucene/index/IndexCommit.java	(working copy)
@@ -119,12 +119,6 @@
 
     long gen = getGeneration();
     long comgen = commit.getGeneration();
-    if (gen < comgen) {
-      return -1;
-    } else if (gen > comgen) {
-      return 1;
-    } else {
-      return 0;
-    }
+    return Long.compare(gen, comgen);
   }
 }
Index: lucene/core/src/java/org/apache/lucene/search/ConjunctionScorer.java
===================================================================
--- lucene/core/src/java/org/apache/lucene/search/ConjunctionScorer.java	(revision 1576724)
+++ lucene/core/src/java/org/apache/lucene/search/ConjunctionScorer.java	(working copy)
@@ -47,7 +47,7 @@
     ArrayUtil.timSort(docsAndFreqs, new Comparator<DocsAndFreqs>() {
       @Override
       public int compare(DocsAndFreqs o1, DocsAndFreqs o2) {
-        return Long.signum(o1.cost - o2.cost);
+        return Long.compare(o1.cost, o2.cost);
       }
     });
 
Index: lucene/core/src/java/org/apache/lucene/search/FieldComparator.java
===================================================================
--- lucene/core/src/java/org/apache/lucene/search/FieldComparator.java	(revision 1576724)
+++ lucene/core/src/java/org/apache/lucene/search/FieldComparator.java	(working copy)
@@ -268,7 +268,7 @@
 
     @Override
     public int compare(int slot1, int slot2) {
-      return values[slot1] - values[slot2];
+      return Byte.compare(values[slot1], values[slot2]);
     }
 
     @Override
@@ -280,7 +280,7 @@
         v2 = missingValue;
       }
 
-      return bottom - v2;
+      return Byte.compare(bottom, v2);
     }
 
     @Override
@@ -325,7 +325,7 @@
       if (docsWithField != null && docValue == 0 && !docsWithField.get(doc)) {
         docValue = missingValue;
       }
-      return topValue - docValue;
+      return Byte.compare(topValue, docValue);
     }
   }
 
@@ -506,7 +506,7 @@
 
     @Override
     public int compare(int slot1, int slot2) {
-      return values[slot1] - values[slot2];
+      return Short.compare(values[slot1], values[slot2]);
     }
 
     @Override
@@ -518,7 +518,7 @@
         v2 = missingValue;
       }
 
-      return bottom - v2;
+      return Short.compare(bottom, v2);
     }
 
     @Override
@@ -564,7 +564,7 @@
       if (docsWithField != null && docValue == 0 && !docsWithField.get(doc)) {
         docValue = missingValue;
       }
-      return topValue - docValue;
+      return Short.compare(topValue, docValue);
     }
   }
 
@@ -585,27 +585,11 @@
         
     @Override
     public int compare(int slot1, int slot2) {
-      // TODO: there are sneaky non-branch ways to compute
-      // -1/+1/0 sign
-      // Cannot return values[slot1] - values[slot2] because that
-      // may overflow
-      final int v1 = values[slot1];
-      final int v2 = values[slot2];
-      if (v1 > v2) {
-        return 1;
-      } else if (v1 < v2) {
-        return -1;
-      } else {
-        return 0;
-      }
+      return Integer.compare(values[slot1], values[slot2]);
     }
 
     @Override
     public int compareBottom(int doc) {
-      // TODO: there are sneaky non-branch ways to compute
-      // -1/+1/0 sign
-      // Cannot return bottom - values[slot2] because that
-      // may overflow
       int v2 = currentReaderValues.get(doc);
       // Test for v2 == 0 to save Bits.get method call for
       // the common case (doc has value and value is non-zero):
@@ -613,13 +597,7 @@
         v2 = missingValue;
       }
 
-      if (bottom > v2) {
-        return 1;
-      } else if (bottom < v2) {
-        return -1;
-      } else {
-        return 0;
-      }
+      return Integer.compare(bottom, v2);
     }
 
     @Override
@@ -665,14 +643,7 @@
       if (docsWithField != null && docValue == 0 && !docsWithField.get(doc)) {
         docValue = missingValue;
       }
-      // Cannot use Integer.compare (it's java 7)
-      if (topValue < docValue) {
-        return -1;
-      } else if (topValue > docValue) {
-        return 1;
-      } else {
-        return 0;
-      }
+      return Integer.compare(topValue, docValue);
     }
   }
 
@@ -693,16 +664,7 @@
 
     @Override
     public int compare(int slot1, int slot2) {
-      // In Java 6 there is no Long#compare(long,long):
-      final long v1 = values[slot1];
-      final long v2 = values[slot2];
-      if (v1 > v2) {
-        return 1;
-      } else if (v1 < v2) {
-        return -1;
-      } else {
-        return 0;
-      }
+      return Long.compare(values[slot1], values[slot2]);
     }
 
     @Override
@@ -716,14 +678,7 @@
         v2 = missingValue;
       }
 
-      // In Java 6 there is no Long#compare(long,long):
-      if (bottom > v2) {
-        return 1;
-      } else if (bottom < v2) {
-        return -1;
-      } else {
-        return 0;
-      }
+      return Long.compare(bottom, v2);
     }
 
     @Override
@@ -769,14 +724,7 @@
       if (docsWithField != null && docValue == 0 && !docsWithField.get(doc)) {
         docValue = missingValue;
       }
-      // Cannot use Long.compare (it's java 7)
-      if (topValue < docValue) {
-        return -1;
-      } else if (topValue > docValue) {
-        return 1;
-      } else {
-        return 0;
-      }
+      return Long.compare(topValue, docValue);
     }
   }
 
@@ -917,14 +865,7 @@
     @Override
     public int compareTop(int doc) {
       int docValue = docBase + doc;
-      // Cannot use Integer.compare (it's java 7)
-      if (topValue < docValue) {
-        return -1;
-      } else if (topValue > docValue) {
-        return 1;
-      } else {
-        return 0;
-      }
+      return Integer.compare(topValue, docValue);
     }
   }
   
Index: lucene/core/src/java/org/apache/lucene/store/FSDirectory.java
===================================================================
--- lucene/core/src/java/org/apache/lucene/store/FSDirectory.java	(revision 1576724)
+++ lucene/core/src/java/org/apache/lucene/store/FSDirectory.java	(working copy)
@@ -366,61 +366,6 @@
     return chunkSize;
   }
 
-  /** Base class for reading input from a RandomAccessFile */
-  protected abstract static class FSIndexInput extends BufferedIndexInput {
-    /** the underlying RandomAccessFile */
-    protected final RandomAccessFile file;
-    boolean isClone = false;
-    /** start offset: non-zero in the slice case */
-    protected final long off;
-    /** end offset (start+length) */
-    protected final long end;
-    
-    /** Create a new FSIndexInput, reading the entire file from <code>path</code> */
-    protected FSIndexInput(String resourceDesc, File path, IOContext context) throws IOException {
-      super(resourceDesc, context);
-      this.file = new RandomAccessFile(path, "r"); 
-      this.off = 0L;
-      this.end = file.length();
-    }
-    
-    /** Create a new FSIndexInput, representing a slice of an existing open <code>file</code> */
-    protected FSIndexInput(String resourceDesc, RandomAccessFile file, long off, long length, int bufferSize) {
-      super(resourceDesc, bufferSize);
-      this.file = file;
-      this.off = off;
-      this.end = off + length;
-      this.isClone = true; // well, we are sorta?
-    }
-    
-    @Override
-    public void close() throws IOException {
-      // only close the file if this is not a clone
-      if (!isClone) {
-        file.close();
-      }
-    }
-    
-    @Override
-    public FSIndexInput clone() {
-      FSIndexInput clone = (FSIndexInput)super.clone();
-      clone.isClone = true;
-      return clone;
-    }
-    
-    @Override
-    public final long length() {
-      return end - off;
-    }
-    
-    /** Method used for testing. Returns true if the underlying
-     *  file descriptor is valid.
-     */
-    boolean isFDValid() throws IOException {
-      return file.getFD().valid();
-    }
-  }
-  
   /**
    * Writes output with {@link RandomAccessFile#write(byte[], int, int)}
    */
Index: lucene/core/src/java/org/apache/lucene/store/MMapDirectory.java
===================================================================
--- lucene/core/src/java/org/apache/lucene/store/MMapDirectory.java	(revision 1576724)
+++ lucene/core/src/java/org/apache/lucene/store/MMapDirectory.java	(working copy)
@@ -19,11 +19,11 @@
  
 import java.io.IOException;
 import java.io.File;
-import java.io.RandomAccessFile;
 import java.nio.ByteBuffer;
 import java.nio.channels.ClosedChannelException; // javadoc @link
 import java.nio.channels.FileChannel;
 import java.nio.channels.FileChannel.MapMode;
+import java.nio.file.StandardOpenOption;
 
 import java.security.AccessController;
 import java.security.PrivilegedExceptionAction;
@@ -189,12 +189,9 @@
   @Override
   public IndexInput openInput(String name, IOContext context) throws IOException {
     ensureOpen();
-    File f = new File(getDirectory(), name);
-    RandomAccessFile raf = new RandomAccessFile(f, "r");
-    try {
-      return new MMapIndexInput("MMapIndexInput(path=\"" + f + "\")", raf);
-    } finally {
-      raf.close();
+    File file = new File(getDirectory(), name);
+    try (FileChannel c = FileChannel.open(file.toPath(), StandardOpenOption.READ)) {
+      return new MMapIndexInput("MMapIndexInput(path=\"" + file.toString() + "\")", c);
     }
   }
   
@@ -224,8 +221,8 @@
   private final class MMapIndexInput extends ByteBufferIndexInput {
     private final boolean useUnmapHack;
     
-    MMapIndexInput(String resourceDescription, RandomAccessFile raf) throws IOException {
-      super(resourceDescription, map(raf, 0, raf.length()), raf.length(), chunkSizePower, getUseUnmap());
+    MMapIndexInput(String resourceDescription, FileChannel fc) throws IOException {
+      super(resourceDescription, map(fc, 0, fc.size()), fc.size(), chunkSizePower, getUseUnmap());
       this.useUnmapHack = getUseUnmap();
     }
     
@@ -262,9 +259,9 @@
   }
   
   /** Maps a file into a set of buffers */
-  ByteBuffer[] map(RandomAccessFile raf, long offset, long length) throws IOException {
+  ByteBuffer[] map(FileChannel fc, long offset, long length) throws IOException {
     if ((length >>> chunkSizePower) >= Integer.MAX_VALUE)
-      throw new IllegalArgumentException("RandomAccessFile too big for chunk size: " + raf.toString());
+      throw new IllegalArgumentException("RandomAccessFile too big for chunk size: " + fc.toString());
     
     final long chunkSize = 1L << chunkSizePower;
     
@@ -274,13 +271,12 @@
     ByteBuffer buffers[] = new ByteBuffer[nrBuffers];
     
     long bufferStart = 0L;
-    FileChannel rafc = raf.getChannel();
     for (int bufNr = 0; bufNr < nrBuffers; bufNr++) { 
       int bufSize = (int) ( (length > (bufferStart + chunkSize))
           ? chunkSize
               : (length - bufferStart)
           );
-      buffers[bufNr] = rafc.map(MapMode.READ_ONLY, offset + bufferStart, bufSize);
+      buffers[bufNr] = fc.map(MapMode.READ_ONLY, offset + bufferStart, bufSize);
       bufferStart += bufSize;
     }
     
Index: lucene/core/src/java/org/apache/lucene/store/NIOFSDirectory.java
===================================================================
--- lucene/core/src/java/org/apache/lucene/store/NIOFSDirectory.java	(revision 1576724)
+++ lucene/core/src/java/org/apache/lucene/store/NIOFSDirectory.java	(working copy)
@@ -24,6 +24,7 @@
 import java.nio.ByteBuffer;
 import java.nio.channels.ClosedChannelException; // javadoc @link
 import java.nio.channels.FileChannel;
+import java.nio.file.StandardOpenOption;
 import java.util.concurrent.Future; // javadoc
 
 /**
@@ -77,7 +78,9 @@
   @Override
   public IndexInput openInput(String name, IOContext context) throws IOException {
     ensureOpen();
-    return new NIOFSIndexInput(new File(getDirectory(), name), context);
+    File path = new File(getDirectory(), name);
+    FileChannel fc = FileChannel.open(path.toPath(), StandardOpenOption.READ);
+    return new NIOFSIndexInput("NIOFSIndexInput(path=\"" + path + "\")", fc, context);
   }
   
   @Override
@@ -85,7 +88,7 @@
       final IOContext context) throws IOException {
     ensureOpen();
     final File path = new File(getDirectory(), name);
-    final RandomAccessFile descriptor = new RandomAccessFile(path, "r");
+    final FileChannel descriptor = FileChannel.open(path.toPath(), StandardOpenOption.READ);
     return new Directory.IndexInputSlicer() {
 
       @Override
@@ -95,14 +98,14 @@
 
       @Override
       public IndexInput openSlice(String sliceDescription, long offset, long length) {
-        return new NIOFSIndexInput(sliceDescription, path, descriptor, descriptor.getChannel(), offset,
+        return new NIOFSIndexInput("NIOFSIndexInput(" + sliceDescription + " in path=\"" + path + "\" slice=" + offset + ":" + (offset+length) + ")", descriptor, offset,
             length, BufferedIndexInput.bufferSize(context));
       }
 
       @Override
       public IndexInput openFullSlice() {
         try {
-          return openSlice("full-slice", 0, descriptor.length());
+          return openSlice("full-slice", 0, descriptor.size());
         } catch (IOException ex) {
           throw new RuntimeException(ex);
         }
@@ -113,26 +116,56 @@
   /**
    * Reads bytes with {@link FileChannel#read(ByteBuffer, long)}
    */
-  protected static class NIOFSIndexInput extends FSIndexInput {
+  protected static class NIOFSIndexInput extends BufferedIndexInput {
     /**
      * The maximum chunk size for reads of 16384 bytes.
      */
     private static final int CHUNK_SIZE = 16384;
     
+    /** the file channel we will read from */
+    protected final FileChannel channel;
+    /** is this instance a clone and hence does not own the file to close it */
+    boolean isClone = false;
+    /** start offset: non-zero in the slice case */
+    protected final long off;
+    /** end offset (start+length) */
+    protected final long end;
+    
     private ByteBuffer byteBuf; // wraps the buffer for NIO
 
-    final FileChannel channel;
-
-    public NIOFSIndexInput(File path, IOContext context) throws IOException {
-      super("NIOFSIndexInput(path=\"" + path + "\")", path, context);
-      channel = file.getChannel();
+    public NIOFSIndexInput(String resourceDesc, FileChannel fc, IOContext context) throws IOException {
+      super(resourceDesc, context);
+      this.channel = fc; 
+      this.off = 0L;
+      this.end = fc.size();
     }
     
-    public NIOFSIndexInput(String sliceDescription, File path, RandomAccessFile file, FileChannel fc, long off, long length, int bufferSize) {
-      super("NIOFSIndexInput(" + sliceDescription + " in path=\"" + path + "\" slice=" + off + ":" + (off+length) + ")", file, off, length, bufferSize);
-      channel = fc;
-      isClone = true;
+    public NIOFSIndexInput(String resourceDesc, FileChannel fc, long off, long length, int bufferSize) {
+      super(resourceDesc, bufferSize);
+      this.channel = fc;
+      this.off = off;
+      this.end = off + length;
+      this.isClone = true;
     }
+    
+    @Override
+    public void close() throws IOException {
+      if (!isClone) {
+        channel.close();
+      }
+    }
+    
+    @Override
+    public NIOFSIndexInput clone() {
+      NIOFSIndexInput clone = (NIOFSIndexInput)super.clone();
+      clone.isClone = true;
+      return clone;
+    }
+    
+    @Override
+    public final long length() {
+      return end - off;
+    }
 
     @Override
     protected void newBuffer(byte[] newBuffer) {
@@ -183,5 +216,4 @@
     @Override
     protected void seekInternal(long pos) throws IOException {}
   }
-
 }
Index: lucene/core/src/java/org/apache/lucene/store/SimpleFSDirectory.java
===================================================================
--- lucene/core/src/java/org/apache/lucene/store/SimpleFSDirectory.java	(revision 1576724)
+++ lucene/core/src/java/org/apache/lucene/store/SimpleFSDirectory.java	(working copy)
@@ -55,7 +55,8 @@
   public IndexInput openInput(String name, IOContext context) throws IOException {
     ensureOpen();
     final File path = new File(directory, name);
-    return new SimpleFSIndexInput("SimpleFSIndexInput(path=\"" + path.getPath() + "\")", path, context);
+    RandomAccessFile raf = new RandomAccessFile(path, "r");
+    return new SimpleFSIndexInput("SimpleFSIndexInput(path=\"" + path.getPath() + "\")", raf, context);
   }
 
   @Override
@@ -92,20 +93,55 @@
    * Reads bytes with {@link RandomAccessFile#seek(long)} followed by
    * {@link RandomAccessFile#read(byte[], int, int)}.  
    */
-  protected static class SimpleFSIndexInput extends FSIndexInput {
+  protected static class SimpleFSIndexInput extends BufferedIndexInput {
     /**
      * The maximum chunk size is 8192 bytes, because {@link RandomAccessFile} mallocs
      * a native buffer outside of stack if the read buffer size is larger.
      */
     private static final int CHUNK_SIZE = 8192;
-  
-    public SimpleFSIndexInput(String resourceDesc, File path, IOContext context) throws IOException {
-      super(resourceDesc, path, context);
+    
+    /** the file channel we will read from */
+    protected final RandomAccessFile file;
+    /** is this instance a clone and hence does not own the file to close it */
+    boolean isClone = false;
+    /** start offset: non-zero in the slice case */
+    protected final long off;
+    /** end offset (start+length) */
+    protected final long end;
+    
+    public SimpleFSIndexInput(String resourceDesc, RandomAccessFile file, IOContext context) throws IOException {
+      super(resourceDesc, context);
+      this.file = file; 
+      this.off = 0L;
+      this.end = file.length();
     }
     
     public SimpleFSIndexInput(String resourceDesc, RandomAccessFile file, long off, long length, int bufferSize) {
-      super(resourceDesc, file, off, length, bufferSize);
+      super(resourceDesc, bufferSize);
+      this.file = file;
+      this.off = off;
+      this.end = off + length;
+      this.isClone = true;
     }
+    
+    @Override
+    public void close() throws IOException {
+      if (!isClone) {
+        file.close();
+      }
+    }
+    
+    @Override
+    public SimpleFSIndexInput clone() {
+      SimpleFSIndexInput clone = (SimpleFSIndexInput)super.clone();
+      clone.isClone = true;
+      return clone;
+    }
+    
+    @Override
+    public final long length() {
+      return end - off;
+    }
   
     /** IndexInput methods */
     @Override
@@ -140,5 +176,9 @@
     @Override
     protected void seekInternal(long position) {
     }
+    
+    boolean isFDValid() throws IOException {
+      return file.getFD().valid();
+    }
   }
 }
Index: lucene/core/src/java/org/apache/lucene/util/Constants.java
===================================================================
--- lucene/core/src/java/org/apache/lucene/util/Constants.java	(revision 1576724)
+++ lucene/core/src/java/org/apache/lucene/util/Constants.java	(working copy)
@@ -57,8 +57,12 @@
   @Deprecated
   public static final boolean JRE_IS_MINIMUM_JAVA6 =
     new Boolean(true).booleanValue(); // prevent inlining in foreign class files
-  
-  public static final boolean JRE_IS_MINIMUM_JAVA7;
+
+  /** @deprecated With Lucene 4.8, we are always on Java 7 */
+  @Deprecated
+  public static final boolean JRE_IS_MINIMUM_JAVA7 =
+    new Boolean(true).booleanValue(); // prevent inlining in foreign class files
+
   public static final boolean JRE_IS_MINIMUM_JAVA8;
   
   /** True iff running on a 64bit JVM */
@@ -89,27 +93,14 @@
     }
     JRE_IS_64BIT = is64Bit;
     
-    // this method only exists in Java 7:
-    boolean v7 = true;
+    // this method only exists in Java 8:
+    boolean v8 = true;
     try {
-      Throwable.class.getMethod("getSuppressed");
+      Collections.class.getMethod("emptySortedSet");
     } catch (NoSuchMethodException nsme) {
-      v7 = false;
+      v8 = false;
     }
-    JRE_IS_MINIMUM_JAVA7 = v7;
-    
-    if (JRE_IS_MINIMUM_JAVA7) {
-      // this method only exists in Java 8:
-      boolean v8 = true;
-      try {
-        Collections.class.getMethod("emptySortedSet");
-      } catch (NoSuchMethodException nsme) {
-        v8 = false;
-      }
-      JRE_IS_MINIMUM_JAVA8 = v8;
-    } else {
-      JRE_IS_MINIMUM_JAVA8 = false;
-    }
+    JRE_IS_MINIMUM_JAVA8 = v8;
   }
 
   // this method prevents inlining the final version constant in compiled classes,
Index: lucene/core/src/java/org/apache/lucene/util/IOUtils.java
===================================================================
--- lucene/core/src/java/org/apache/lucene/util/IOUtils.java	(revision 1576724)
+++ lucene/core/src/java/org/apache/lucene/util/IOUtils.java	(working copy)
@@ -206,29 +206,13 @@
     }
   }
   
-  /** This reflected {@link Method} is {@code null} before Java 7 */
-  private static final Method SUPPRESS_METHOD;
-  static {
-    Method m;
-    try {
-      m = Throwable.class.getMethod("addSuppressed", Throwable.class);
-    } catch (Exception e) {
-      m = null;
-    }
-    SUPPRESS_METHOD = m;
-  }
-
-  /** adds a Throwable to the list of suppressed Exceptions of the first Throwable (if Java 7 is detected)
+  /** adds a Throwable to the list of suppressed Exceptions of the first Throwable
    * @param exception this exception should get the suppressed one added
    * @param suppressed the suppressed exception
    */
   private static void addSuppressed(Throwable exception, Throwable suppressed) {
-    if (SUPPRESS_METHOD != null && exception != null && suppressed != null) {
-      try {
-        SUPPRESS_METHOD.invoke(exception, suppressed);
-      } catch (Exception e) {
-        // ignore any exceptions caused by invoking (e.g. security constraints)
-      }
+    if (exception != null && suppressed != null) {
+      exception.addSuppressed(suppressed);
     }
   }
   
Index: lucene/core/src/java/org/apache/lucene/util/RamUsageEstimator.java
===================================================================
--- lucene/core/src/java/org/apache/lucene/util/RamUsageEstimator.java	(revision 1576724)
+++ lucene/core/src/java/org/apache/lucene/util/RamUsageEstimator.java	(working copy)
@@ -18,6 +18,7 @@
  */
 
 import java.lang.management.ManagementFactory;
+import java.lang.management.PlatformManagedObject;
 import java.lang.reflect.*;
 import java.text.DecimalFormat;
 import java.text.DecimalFormatSymbols;
@@ -212,27 +213,9 @@
     // regardless of the architecture).
     int objectAlignment = 8;
     try {
-      final Class<?> beanClazz = Class.forName("com.sun.management.HotSpotDiagnosticMXBean");
-      // Try to get the diagnostic mxbean without calling {@link ManagementFactory#getPlatformMBeanServer()}
-      // which starts AWT thread (and shows junk in the dock) on a Mac:
-      Object hotSpotBean;
-      // Java 7+, HotSpot
-      try {
-        hotSpotBean = ManagementFactory.class
-          .getMethod("getPlatformMXBean", Class.class)
-          .invoke(null, beanClazz);
-      } catch (Exception e1) {
-        // Java 6, HotSpot
-        try {
-          Class<?> sunMF = Class.forName("sun.management.ManagementFactory");
-          hotSpotBean = sunMF.getMethod("getDiagnosticMXBean").invoke(null);
-        } catch (Exception e2) {
-          // Last resort option is an attempt to get it from ManagementFactory's server anyway (may start AWT).
-          hotSpotBean = ManagementFactory.newPlatformMXBeanProxy(
-              ManagementFactory.getPlatformMBeanServer(), 
-              "com.sun.management:type=HotSpotDiagnostic", beanClazz);
-        }
-      }
+      final Class<? extends PlatformManagedObject> beanClazz =
+        Class.forName("com.sun.management.HotSpotDiagnosticMXBean").asSubclass(PlatformManagedObject.class);
+      final Object hotSpotBean = ManagementFactory.getPlatformMXBean(beanClazz);
       if (hotSpotBean != null) {
         final Method getVMOptionMethod = beanClazz.getMethod("getVMOption", String.class);
         final Object vmOption = getVMOptionMethod.invoke(hotSpotBean, "ObjectAlignmentInBytes");
Index: lucene/core/src/test/org/apache/lucene/index/TestOmitTf.java
===================================================================
--- lucene/core/src/test/org/apache/lucene/index/TestOmitTf.java	(revision 1576724)
+++ lucene/core/src/test/org/apache/lucene/index/TestOmitTf.java	(working copy)
@@ -315,7 +315,9 @@
       while (cause.getCause() != null) {
         cause = cause.getCause();
       }
-      assertTrue("Expected an IAE, got " + cause, cause instanceof IllegalStateException);
+      if (!(cause instanceof IllegalStateException)) {
+        throw new AssertionError("Expected an IAE", e);
+      } // else OK because positions are not indexed
     }
         
     searcher.search(q1,
Index: lucene/core/src/test/org/apache/lucene/util/TestIOUtils.java
===================================================================
--- lucene/core/src/test/org/apache/lucene/util/TestIOUtils.java	(revision 1576724)
+++ lucene/core/src/test/org/apache/lucene/util/TestIOUtils.java	(working copy)
@@ -44,10 +44,6 @@
   }
 
   public void testSuppressedExceptions() {
-    if (!Constants.JRE_IS_MINIMUM_JAVA7) {
-      System.err.println("WARNING: TestIOUtils.testSuppressedExceptions: Full test coverage only with Java 7, as suppressed exception recording is not supported before.");
-    }
-    
     // test with prior exception
     try {
       final TestException t = new TestException();
Index: lucene/highlighter
===================================================================
--- lucene/highlighter	(revision 1576724)
+++ lucene/highlighter	(working copy)

Property changes on: lucene/highlighter
___________________________________________________________________
Modified: svn:mergeinfo
   Reverse-merged /lucene/dev/trunk/lucene/highlighter:r1450246
   Merged /lucene/dev/trunk/lucene/highlighter:r1457868
Index: lucene/highlighter/src/java/org/apache/lucene/search/postingshighlight/Passage.java
===================================================================
--- lucene/highlighter/src/java/org/apache/lucene/search/postingshighlight/Passage.java	(revision 1576724)
+++ lucene/highlighter/src/java/org/apache/lucene/search/postingshighlight/Passage.java	(working copy)
@@ -82,8 +82,7 @@
 
       @Override
       protected int compare(int i, int j) {
-        // TODO: java7 use Integer.compare(starts[i], starts[j])
-        return Long.signum(((long)starts[i]) - starts[j]);
+        return Integer.compare(starts[i], starts[j]);
       }
 
     }.sort(0, numMatches);
Index: lucene/highlighter/src/java/org/apache/lucene/search/postingshighlight/PostingsHighlighter.java
===================================================================
--- lucene/highlighter/src/java/org/apache/lucene/search/postingshighlight/PostingsHighlighter.java	(revision 1576724)
+++ lucene/highlighter/src/java/org/apache/lucene/search/postingshighlight/PostingsHighlighter.java	(working copy)
@@ -716,7 +716,7 @@
         if (off == otherOff) {
           return id - other.id;
         } else {
-          return Long.signum(((long)off) - otherOff);
+          return Integer.compare(off, otherOff);
         }
       } catch (IOException e) {
         throw new RuntimeException(e);
Index: lucene/misc
===================================================================
--- lucene/misc	(revision 1576724)
+++ lucene/misc	(working copy)

Property changes on: lucene/misc
___________________________________________________________________
Modified: svn:mergeinfo
   Merged /lucene/dev/trunk/lucene/misc:r1457868
Index: lucene/misc/src/java/org/apache/lucene/index/sorter/Sorter.java
===================================================================
--- lucene/misc/src/java/org/apache/lucene/index/sorter/Sorter.java	(revision 1576724)
+++ lucene/misc/src/java/org/apache/lucene/index/sorter/Sorter.java	(working copy)
@@ -235,7 +235,7 @@
               return comp;
             }
           }
-          return docID1 - docID2; // docid order tiebreak
+          return Integer.compare(docID1, docID2); // docid order tiebreak
         } catch (IOException e) {
           throw new RuntimeException(e);
         }
Index: lucene/misc/src/java/org/apache/lucene/misc/HighFreqTerms.java
===================================================================
--- lucene/misc/src/java/org/apache/lucene/misc/HighFreqTerms.java	(revision 1576724)
+++ lucene/misc/src/java/org/apache/lucene/misc/HighFreqTerms.java	(working copy)
@@ -137,7 +137,7 @@
     
     @Override
     public int compare(TermStats a, TermStats b) {
-      int res = Long.signum(a.docFreq - b.docFreq);
+      int res = Long.compare(a.docFreq, b.docFreq);
       if (res == 0) {
         res = a.field.compareTo(b.field);
         if (res == 0) {
@@ -155,16 +155,12 @@
     
     @Override
     public int compare(TermStats a, TermStats b) {
-      int res;
-      if (a.totalTermFreq == b.totalTermFreq) {
+      int res = Long.compare(a.totalTermFreq, b.totalTermFreq);
+      if (res == 0) {
         res = a.field.compareTo(b.field);
         if (res == 0) {
           res = a.termtext.compareTo(b.termtext);
         }
-      } else if (a.totalTermFreq > b.totalTermFreq) {
-        res = 1;
-      } else {
-        res = -1;
       }
       return res;
     }
Index: lucene/queries
===================================================================
--- lucene/queries	(revision 1576724)
+++ lucene/queries	(working copy)

Property changes on: lucene/queries
___________________________________________________________________
Modified: svn:mergeinfo
   Merged /lucene/dev/trunk/lucene/queries:r1457868
Index: lucene/suggest
===================================================================
--- lucene/suggest	(revision 1576724)
+++ lucene/suggest	(working copy)

Property changes on: lucene/suggest
___________________________________________________________________
Modified: svn:mergeinfo
   Merged /lucene/dev/trunk/lucene/suggest:r1457868
Index: lucene/suggest/src/java/org/apache/lucene/search/suggest/SortedTermFreqIteratorWrapper.java
===================================================================
--- lucene/suggest/src/java/org/apache/lucene/search/suggest/SortedTermFreqIteratorWrapper.java	(revision 1576724)
+++ lucene/suggest/src/java/org/apache/lucene/search/suggest/SortedTermFreqIteratorWrapper.java	(working copy)
@@ -121,13 +121,7 @@
       if (cmp != 0) {
         return cmp;
       }
-      if (leftCost < rightCost) {
-        return -1;
-      } else if (rightCost < leftCost) {
-        return 1;
-      } else {
-        return 0;
-      }
+      return Long.compare(leftCost, rightCost);
     }
   };
   
Index: lucene/SYSTEM_REQUIREMENTS.txt
===================================================================
--- lucene/SYSTEM_REQUIREMENTS.txt	(revision 1576724)
+++ lucene/SYSTEM_REQUIREMENTS.txt	(working copy)
@@ -1,6 +1,6 @@
 # System Requirements 
 
-Apache Lucene runs of Java 6 or greater. When using Java 7, be sure to 
+Apache Lucene runs of Java 7 or greater. When using Java 7, be sure to 
 install at least Update 1! With all Java versions it is strongly 
 recommended to not use experimental `-XX` JVM options. It is also 
 recommended to always use the latest update version of your Java VM, 
Index: lucene/SYSTEM_REQUIREMENTS.txt
===================================================================
--- lucene/SYSTEM_REQUIREMENTS.txt	(revision 1576724)
+++ lucene/SYSTEM_REQUIREMENTS.txt	(working copy)

Property changes on: lucene/SYSTEM_REQUIREMENTS.txt
___________________________________________________________________
Modified: svn:mergeinfo
   Merged /lucene/dev/trunk/lucene/SYSTEM_REQUIREMENTS.txt:r1457734,1457868
Index: lucene/test-framework/src/java/org/apache/lucene/util/LuceneTestCase.java
===================================================================
--- lucene/test-framework/src/java/org/apache/lucene/util/LuceneTestCase.java	(revision 1576724)
+++ lucene/test-framework/src/java/org/apache/lucene/util/LuceneTestCase.java	(working copy)
@@ -690,6 +690,7 @@
    * Return <code>args</code> as a {@link Set} instance. The order of elements is not
    * preserved in iterators.
    */
+  @SafeVarargs @SuppressWarnings("varargs")
   public static <T> Set<T> asSet(T... args) {
     return new HashSet<T>(Arrays.asList(args));
   }
Index: lucene/tools
===================================================================
--- lucene/tools	(revision 1576724)
+++ lucene/tools	(working copy)

Property changes on: lucene/tools
___________________________________________________________________
Modified: svn:mergeinfo
   Merged /lucene/dev/trunk/lucene/tools:r1457734,1457868
Index: lucene/tools/javadoc/ecj.javadocs.prefs
===================================================================
--- lucene/tools/javadoc/ecj.javadocs.prefs	(revision 1576724)
+++ lucene/tools/javadoc/ecj.javadocs.prefs	(working copy)
@@ -1,7 +1,7 @@
 #Sun Sep 23 20:55:03 EDT 2012
 eclipse.preferences.version=1
-org.eclipse.jdt.core.compiler.codegen.targetPlatform=1.6
-org.eclipse.jdt.core.compiler.compliance=1.6
+org.eclipse.jdt.core.compiler.codegen.targetPlatform=1.7
+org.eclipse.jdt.core.compiler.compliance=1.7
 org.eclipse.jdt.core.compiler.doc.comment.support=enabled
 org.eclipse.jdt.core.compiler.problem.annotationSuperInterface=ignore
 org.eclipse.jdt.core.compiler.problem.assertIdentifier=error
@@ -88,4 +88,4 @@
 org.eclipse.jdt.core.compiler.problem.unusedPrivateMember=ignore
 org.eclipse.jdt.core.compiler.problem.unusedWarningToken=ignore
 org.eclipse.jdt.core.compiler.problem.varargsArgumentNeedCast=ignore
-org.eclipse.jdt.core.compiler.source=1.6
+org.eclipse.jdt.core.compiler.source=1.7
Index: lucene/tools/javadoc/java6/package-list
===================================================================
--- lucene/tools/javadoc/java6/package-list	(revision 1576724)
+++ lucene/tools/javadoc/java6/package-list	(working copy)
@@ -1,203 +0,0 @@
-java.applet
-java.awt
-java.awt.color
-java.awt.datatransfer
-java.awt.dnd
-java.awt.event
-java.awt.font
-java.awt.geom
-java.awt.im
-java.awt.im.spi
-java.awt.image
-java.awt.image.renderable
-java.awt.print
-java.beans
-java.beans.beancontext
-java.io
-java.lang
-java.lang.annotation
-java.lang.instrument
-java.lang.management
-java.lang.ref
-java.lang.reflect
-java.math
-java.net
-java.nio
-java.nio.channels
-java.nio.channels.spi
-java.nio.charset
-java.nio.charset.spi
-java.rmi
-java.rmi.activation
-java.rmi.dgc
-java.rmi.registry
-java.rmi.server
-java.security
-java.security.acl
-java.security.cert
-java.security.interfaces
-java.security.spec
-java.sql
-java.text
-java.text.spi
-java.util
-java.util.concurrent
-java.util.concurrent.atomic
-java.util.concurrent.locks
-java.util.jar
-java.util.logging
-java.util.prefs
-java.util.regex
-java.util.spi
-java.util.zip
-javax.accessibility
-javax.activation
-javax.activity
-javax.annotation
-javax.annotation.processing
-javax.crypto
-javax.crypto.interfaces
-javax.crypto.spec
-javax.imageio
-javax.imageio.event
-javax.imageio.metadata
-javax.imageio.plugins.bmp
-javax.imageio.plugins.jpeg
-javax.imageio.spi
-javax.imageio.stream
-javax.jws
-javax.jws.soap
-javax.lang.model
-javax.lang.model.element
-javax.lang.model.type
-javax.lang.model.util
-javax.management
-javax.management.loading
-javax.management.modelmbean
-javax.management.monitor
-javax.management.openmbean
-javax.management.relation
-javax.management.remote
-javax.management.remote.rmi
-javax.management.timer
-javax.naming
-javax.naming.directory
-javax.naming.event
-javax.naming.ldap
-javax.naming.spi
-javax.net
-javax.net.ssl
-javax.print
-javax.print.attribute
-javax.print.attribute.standard
-javax.print.event
-javax.rmi
-javax.rmi.CORBA
-javax.rmi.ssl
-javax.script
-javax.security.auth
-javax.security.auth.callback
-javax.security.auth.kerberos
-javax.security.auth.login
-javax.security.auth.spi
-javax.security.auth.x500
-javax.security.cert
-javax.security.sasl
-javax.sound.midi
-javax.sound.midi.spi
-javax.sound.sampled
-javax.sound.sampled.spi
-javax.sql
-javax.sql.rowset
-javax.sql.rowset.serial
-javax.sql.rowset.spi
-javax.swing
-javax.swing.border
-javax.swing.colorchooser
-javax.swing.event
-javax.swing.filechooser
-javax.swing.plaf
-javax.swing.plaf.basic
-javax.swing.plaf.metal
-javax.swing.plaf.multi
-javax.swing.plaf.synth
-javax.swing.table
-javax.swing.text
-javax.swing.text.html
-javax.swing.text.html.parser
-javax.swing.text.rtf
-javax.swing.tree
-javax.swing.undo
-javax.tools
-javax.transaction
-javax.transaction.xa
-javax.xml
-javax.xml.bind
-javax.xml.bind.annotation
-javax.xml.bind.annotation.adapters
-javax.xml.bind.attachment
-javax.xml.bind.helpers
-javax.xml.bind.util
-javax.xml.crypto
-javax.xml.crypto.dom
-javax.xml.crypto.dsig
-javax.xml.crypto.dsig.dom
-javax.xml.crypto.dsig.keyinfo
-javax.xml.crypto.dsig.spec
-javax.xml.datatype
-javax.xml.namespace
-javax.xml.parsers
-javax.xml.soap
-javax.xml.stream
-javax.xml.stream.events
-javax.xml.stream.util
-javax.xml.transform
-javax.xml.transform.dom
-javax.xml.transform.sax
-javax.xml.transform.stax
-javax.xml.transform.stream
-javax.xml.validation
-javax.xml.ws
-javax.xml.ws.handler
-javax.xml.ws.handler.soap
-javax.xml.ws.http
-javax.xml.ws.soap
-javax.xml.ws.spi
-javax.xml.ws.wsaddressing
-javax.xml.xpath
-org.ietf.jgss
-org.omg.CORBA
-org.omg.CORBA.DynAnyPackage
-org.omg.CORBA.ORBPackage
-org.omg.CORBA.TypeCodePackage
-org.omg.CORBA.portable
-org.omg.CORBA_2_3
-org.omg.CORBA_2_3.portable
-org.omg.CosNaming
-org.omg.CosNaming.NamingContextExtPackage
-org.omg.CosNaming.NamingContextPackage
-org.omg.Dynamic
-org.omg.DynamicAny
-org.omg.DynamicAny.DynAnyFactoryPackage
-org.omg.DynamicAny.DynAnyPackage
-org.omg.IOP
-org.omg.IOP.CodecFactoryPackage
-org.omg.IOP.CodecPackage
-org.omg.Messaging
-org.omg.PortableInterceptor
-org.omg.PortableInterceptor.ORBInitInfoPackage
-org.omg.PortableServer
-org.omg.PortableServer.CurrentPackage
-org.omg.PortableServer.POAManagerPackage
-org.omg.PortableServer.POAPackage
-org.omg.PortableServer.ServantLocatorPackage
-org.omg.PortableServer.portable
-org.omg.SendingContext
-org.omg.stub.java.rmi
-org.w3c.dom
-org.w3c.dom.bootstrap
-org.w3c.dom.events
-org.w3c.dom.ls
-org.xml.sax
-org.xml.sax.ext
-org.xml.sax.helpers
Index: lucene/tools/javadoc/java7/package-list
===================================================================
--- lucene/tools/javadoc/java7/package-list	(revision 0)
+++ lucene/tools/javadoc/java7/package-list	(working copy)
@@ -0,0 +1,209 @@
+java.applet
+java.awt
+java.awt.color
+java.awt.datatransfer
+java.awt.dnd
+java.awt.event
+java.awt.font
+java.awt.geom
+java.awt.im
+java.awt.im.spi
+java.awt.image
+java.awt.image.renderable
+java.awt.print
+java.beans
+java.beans.beancontext
+java.io
+java.lang
+java.lang.annotation
+java.lang.instrument
+java.lang.invoke
+java.lang.management
+java.lang.ref
+java.lang.reflect
+java.math
+java.net
+java.nio
+java.nio.channels
+java.nio.channels.spi
+java.nio.charset
+java.nio.charset.spi
+java.nio.file
+java.nio.file.attribute
+java.nio.file.spi
+java.rmi
+java.rmi.activation
+java.rmi.dgc
+java.rmi.registry
+java.rmi.server
+java.security
+java.security.acl
+java.security.cert
+java.security.interfaces
+java.security.spec
+java.sql
+java.text
+java.text.spi
+java.util
+java.util.concurrent
+java.util.concurrent.atomic
+java.util.concurrent.locks
+java.util.jar
+java.util.logging
+java.util.prefs
+java.util.regex
+java.util.spi
+java.util.zip
+javax.accessibility
+javax.activation
+javax.activity
+javax.annotation
+javax.annotation.processing
+javax.crypto
+javax.crypto.interfaces
+javax.crypto.spec
+javax.imageio
+javax.imageio.event
+javax.imageio.metadata
+javax.imageio.plugins.bmp
+javax.imageio.plugins.jpeg
+javax.imageio.spi
+javax.imageio.stream
+javax.jws
+javax.jws.soap
+javax.lang.model
+javax.lang.model.element
+javax.lang.model.type
+javax.lang.model.util
+javax.management
+javax.management.loading
+javax.management.modelmbean
+javax.management.monitor
+javax.management.openmbean
+javax.management.relation
+javax.management.remote
+javax.management.remote.rmi
+javax.management.timer
+javax.naming
+javax.naming.directory
+javax.naming.event
+javax.naming.ldap
+javax.naming.spi
+javax.net
+javax.net.ssl
+javax.print
+javax.print.attribute
+javax.print.attribute.standard
+javax.print.event
+javax.rmi
+javax.rmi.CORBA
+javax.rmi.ssl
+javax.script
+javax.security.auth
+javax.security.auth.callback
+javax.security.auth.kerberos
+javax.security.auth.login
+javax.security.auth.spi
+javax.security.auth.x500
+javax.security.cert
+javax.security.sasl
+javax.sound.midi
+javax.sound.midi.spi
+javax.sound.sampled
+javax.sound.sampled.spi
+javax.sql
+javax.sql.rowset
+javax.sql.rowset.serial
+javax.sql.rowset.spi
+javax.swing
+javax.swing.border
+javax.swing.colorchooser
+javax.swing.event
+javax.swing.filechooser
+javax.swing.plaf
+javax.swing.plaf.basic
+javax.swing.plaf.metal
+javax.swing.plaf.multi
+javax.swing.plaf.nimbus
+javax.swing.plaf.synth
+javax.swing.table
+javax.swing.text
+javax.swing.text.html
+javax.swing.text.html.parser
+javax.swing.text.rtf
+javax.swing.tree
+javax.swing.undo
+javax.tools
+javax.transaction
+javax.transaction.xa
+javax.xml
+javax.xml.bind
+javax.xml.bind.annotation
+javax.xml.bind.annotation.adapters
+javax.xml.bind.attachment
+javax.xml.bind.helpers
+javax.xml.bind.util
+javax.xml.crypto
+javax.xml.crypto.dom
+javax.xml.crypto.dsig
+javax.xml.crypto.dsig.dom
+javax.xml.crypto.dsig.keyinfo
+javax.xml.crypto.dsig.spec
+javax.xml.datatype
+javax.xml.namespace
+javax.xml.parsers
+javax.xml.soap
+javax.xml.stream
+javax.xml.stream.events
+javax.xml.stream.util
+javax.xml.transform
+javax.xml.transform.dom
+javax.xml.transform.sax
+javax.xml.transform.stax
+javax.xml.transform.stream
+javax.xml.validation
+javax.xml.ws
+javax.xml.ws.handler
+javax.xml.ws.handler.soap
+javax.xml.ws.http
+javax.xml.ws.soap
+javax.xml.ws.spi
+javax.xml.ws.spi.http
+javax.xml.ws.wsaddressing
+javax.xml.xpath
+org.ietf.jgss
+org.omg.CORBA
+org.omg.CORBA.DynAnyPackage
+org.omg.CORBA.ORBPackage
+org.omg.CORBA.TypeCodePackage
+org.omg.CORBA.portable
+org.omg.CORBA_2_3
+org.omg.CORBA_2_3.portable
+org.omg.CosNaming
+org.omg.CosNaming.NamingContextExtPackage
+org.omg.CosNaming.NamingContextPackage
+org.omg.Dynamic
+org.omg.DynamicAny
+org.omg.DynamicAny.DynAnyFactoryPackage
+org.omg.DynamicAny.DynAnyPackage
+org.omg.IOP
+org.omg.IOP.CodecFactoryPackage
+org.omg.IOP.CodecPackage
+org.omg.Messaging
+org.omg.PortableInterceptor
+org.omg.PortableInterceptor.ORBInitInfoPackage
+org.omg.PortableServer
+org.omg.PortableServer.CurrentPackage
+org.omg.PortableServer.POAManagerPackage
+org.omg.PortableServer.POAPackage
+org.omg.PortableServer.ServantLocatorPackage
+org.omg.PortableServer.portable
+org.omg.SendingContext
+org.omg.stub.java.rmi
+org.w3c.dom
+org.w3c.dom.bootstrap
+org.w3c.dom.events
+org.w3c.dom.ls
+org.xml.sax
+org.xml.sax.ext
+org.xml.sax.helpers
Index: lucene/tools/javadoc/java7/package-list
===================================================================
--- lucene/tools/javadoc/java7/package-list	(revision 1457734)
+++ lucene/tools/javadoc/java7/package-list	(working copy)

Property changes on: lucene/tools/javadoc/java7/package-list
___________________________________________________________________
Added: svn:eol-style
## -0,0 +1 ##
+native
\ No newline at end of property
Index: solr
===================================================================
--- solr	(revision 1576724)
+++ solr	(working copy)

Property changes on: solr
___________________________________________________________________
Modified: svn:mergeinfo
   Merged /lucene/dev/trunk/solr:r1457734,1457868
Index: solr/build.xml
===================================================================
--- solr/build.xml	(revision 1576724)
+++ solr/build.xml	(working copy)
@@ -375,7 +375,7 @@
     <svn-export-source source.dir=".."/>
 
     <!-- Exclude javadoc package-list files under licenses incompatible with the ASL -->
-    <delete dir="${svn.export.dir}/lucene/tools/javadoc/java6"/>
+    <delete dir="${svn.export.dir}/lucene/tools/javadoc/java7"/>
     <!-- Exclude clover license files incompatible with the ASL -->
     <delete dir="${svn.export.dir}/lucene/tools/clover"/>
 
Index: solr/build.xml
===================================================================
--- solr/build.xml	(revision 1576724)
+++ solr/build.xml	(working copy)

Property changes on: solr/build.xml
___________________________________________________________________
Modified: svn:mergeinfo
   Merged /lucene/dev/trunk/solr/build.xml:r1457734,1457868
Index: solr/CHANGES.txt
===================================================================
--- solr/CHANGES.txt	(revision 1576724)
+++ solr/CHANGES.txt	(working copy)
@@ -12,7 +12,7 @@
 
 Getting Started
 ---------------
-You need a Java 1.6 VM or later installed.
+You need a Java 1.7 VM or later installed.
 In this release, there is an example Solr server including a bundled 
 servlet container in the directory named "example".
 See the tutorial at http://lucene.apache.org/solr/tutorial.html
Index: solr/CHANGES.txt
===================================================================
--- solr/CHANGES.txt	(revision 1576724)
+++ solr/CHANGES.txt	(working copy)

Property changes on: solr/CHANGES.txt
___________________________________________________________________
Modified: svn:mergeinfo
   Merged /lucene/dev/trunk/solr/CHANGES.txt:r1457734,1457868
Index: solr/common-build.xml
===================================================================
--- solr/common-build.xml	(revision 1576724)
+++ solr/common-build.xml	(working copy)
@@ -25,9 +25,9 @@
   
   <property name="Name" value="Solr" />
   
-  <!-- solr uses 1.6 -->
-  <property name="javac.source" value="1.6"/>
-  <property name="javac.target" value="1.6"/>
+  <!-- solr uses 1.7 -->
+  <property name="javac.source" value="1.7"/>
+  <property name="javac.target" value="1.7"/>
   <property name="javac.args" value=""/>
   
   <property name="dest" location="${common-solr.dir}/build" />
Index: solr/common-build.xml
===================================================================
--- solr/common-build.xml	(revision 1576724)
+++ solr/common-build.xml	(working copy)

Property changes on: solr/common-build.xml
___________________________________________________________________
Modified: svn:mergeinfo
   Merged /lucene/dev/trunk/solr/common-build.xml:r1457734,1457868
Index: solr/contrib
===================================================================
--- solr/contrib	(revision 1576724)
+++ solr/contrib	(working copy)

Property changes on: solr/contrib
___________________________________________________________________
Modified: svn:mergeinfo
   Merged /lucene/dev/trunk/solr/contrib:r1457734,1457868
Index: solr/contrib/clustering/src/test-files/clustering/solr/collection1/conf/schema.xml
===================================================================
--- solr/contrib/clustering/src/test-files/clustering/solr/collection1/conf/schema.xml	(revision 1576724)
+++ solr/contrib/clustering/src/test-files/clustering/solr/collection1/conf/schema.xml	(working copy)
@@ -243,7 +243,7 @@
              See the Java Regular Expression documentation for more
              infomation on pattern and replacement string syntax.
              
-             http://java.sun.com/j2se/1.6.0/docs/api/java/util/regex/package-summary.html
+             http://docs.oracle.com/javase/7/docs/api/java/util/regex/package-summary.html
           -->
         <filter class="solr.PatternReplaceFilterFactory"
                 pattern="([^a-z])" replacement="" replace="all"
Index: solr/contrib/dataimporthandler/src/test-files/dih/solr/collection1/conf/dataimport-solr_id-schema.xml
===================================================================
--- solr/contrib/dataimporthandler/src/test-files/dih/solr/collection1/conf/dataimport-solr_id-schema.xml	(revision 1576724)
+++ solr/contrib/dataimporthandler/src/test-files/dih/solr/collection1/conf/dataimport-solr_id-schema.xml	(working copy)
@@ -224,7 +224,7 @@
              See the Java Regular Expression documentation for more
              infomation on pattern and replacement string syntax.
              
-             http://java.sun.com/j2se/1.6.0/docs/api/java/util/regex/package-summary.html
+             http://docs.oracle.com/javase/7/docs/api/java/util/regex/package-summary.html
           -->
         <filter class="solr.PatternReplaceFilterFactory"
                 pattern="([^a-z])" replacement="" replace="all"
Index: solr/contrib/uima/src/test-files/uima/solr/collection1/conf/schema.xml
===================================================================
--- solr/contrib/uima/src/test-files/uima/solr/collection1/conf/schema.xml	(revision 1576724)
+++ solr/contrib/uima/src/test-files/uima/solr/collection1/conf/schema.xml	(working copy)
@@ -406,7 +406,7 @@
           documentation for more information on pattern and replacement
           string syntax.
 
-          http://java.sun.com/j2se/1.6.0/docs/api/java/util/regex/package-summary.html
+          http://docs.oracle.com/javase/7/docs/api/java/util/regex/package-summary.html
         -->
         <filter class="solr.PatternReplaceFilterFactory" pattern="([^a-z])"
           replacement="" replace="all" />
Index: solr/contrib/uima/src/test-files/uima/uima-tokenizers-schema.xml
===================================================================
--- solr/contrib/uima/src/test-files/uima/uima-tokenizers-schema.xml	(revision 1576724)
+++ solr/contrib/uima/src/test-files/uima/uima-tokenizers-schema.xml	(working copy)
@@ -402,7 +402,7 @@
           documentation for more information on pattern and replacement
           string syntax.
 
-          http://java.sun.com/j2se/1.6.0/docs/api/java/util/regex/package-summary.html
+          http://docs.oracle.com/javase/7/docs/api/java/util/regex/package-summary.html
         -->
         <filter class="solr.PatternReplaceFilterFactory" pattern="([^a-z])"
           replacement="" replace="all" />
Index: solr/core
===================================================================
--- solr/core	(revision 1576724)
+++ solr/core	(working copy)

Property changes on: solr/core
___________________________________________________________________
Modified: svn:mergeinfo
   Reverse-merged /lucene/dev/trunk/solr/core:r1544815
   Merged /lucene/dev/trunk/solr/core:r1457734,1457868
Index: solr/core/src/java/org/apache/solr/cloud/Assign.java
===================================================================
--- solr/core/src/java/org/apache/solr/cloud/Assign.java	(revision 1576724)
+++ solr/core/src/java/org/apache/solr/cloud/Assign.java	(working copy)
@@ -191,7 +191,7 @@
           + " shards to be created (higher than the allowed number)");
     }
 
-    ArrayList<Node> sortedNodeList = new ArrayList<Node>(nodeNameVsShardCount.values());
+    ArrayList<Node> sortedNodeList = new ArrayList<>(nodeNameVsShardCount.values());
     Collections.sort(sortedNodeList, new Comparator<Node>() {
       @Override
       public int compare(Node x, Node y) {
Index: solr/core/src/java/org/apache/solr/cloud/OverseerCollectionProcessor.java
===================================================================
--- solr/core/src/java/org/apache/solr/cloud/OverseerCollectionProcessor.java	(revision 1576724)
+++ solr/core/src/java/org/apache/solr/cloud/OverseerCollectionProcessor.java	(working copy)
@@ -1544,7 +1544,7 @@
       int repFactor = message.getInt( REPLICATION_FACTOR, 1);
       Integer numSlices = message.getInt(NUM_SLICES, null);
       String router = message.getStr("router.name", DocRouter.DEFAULT_NAME);
-      List<String> shardNames = new ArrayList<String>();
+      List<String> shardNames = new ArrayList<>();
       if(ImplicitDocRouter.NAME.equals(router)){
         Overseer.getShardNames(shardNames, message.getStr("shards",null));
         numSlices = shardNames.size();
Index: solr/core/src/java/org/apache/solr/handler/component/QueryComponent.java
===================================================================
--- solr/core/src/java/org/apache/solr/handler/component/QueryComponent.java	(revision 1576724)
+++ solr/core/src/java/org/apache/solr/handler/component/QueryComponent.java	(working copy)
@@ -525,16 +525,7 @@
 
         @Override
         protected int compare(int i, int j) {
-          // In Java 6 there is no Long#compare(long,long):
-          final long v1 = sortedIds[i];
-          final long v2 = sortedIds[j];
-          if (v1 > v2) {
-            return 1;
-          } else if (v1 < v2) {
-            return -1;
-          } else {
-            return 0;
-          }
+          return Long.compare(sortedIds[i], sortedIds[j]);
         }
       }.sort(0, sortedIds.length);
 
Index: solr/core/src/java/org/apache/solr/handler/component/SuggestComponent.java
===================================================================
--- solr/core/src/java/org/apache/solr/handler/component/SuggestComponent.java	(revision 1576724)
+++ solr/core/src/java/org/apache/solr/handler/component/SuggestComponent.java	(working copy)
@@ -247,7 +247,7 @@
       return;
     int count = params.getInt(SUGGEST_COUNT, 1);
     
-    List<SuggesterResult> suggesterResults = new ArrayList<SuggesterResult>();
+    List<SuggesterResult> suggesterResults = new ArrayList<>();
     
     // Collect Shard responses
     for (ShardRequest sreq : rb.finished) {
@@ -280,7 +280,7 @@
    * */
   private static SuggesterResult merge(List<SuggesterResult> suggesterResults, int count) {
     SuggesterResult result = new SuggesterResult();
-    Set<String> allTokens = new HashSet<String>();
+    Set<String> allTokens = new HashSet<>();
     Set<String> suggesterNames = new HashSet<String>();
     
     // collect all tokens
@@ -415,7 +415,7 @@
       for (Iterator<Map.Entry<String, NamedList<Object>>> suggestionsIter = entry.getValue().iterator(); suggestionsIter.hasNext();) {
         Map.Entry<String, NamedList<Object>> suggestions = suggestionsIter.next(); 
         String tokenString = suggestions.getKey();
-        List<LookupResult> lookupResults = new ArrayList<LookupResult>();
+        List<LookupResult> lookupResults = new ArrayList<>();
         NamedList<Object> suggestion = suggestions.getValue();
         // for each suggestion
         for (int j = 0; j < suggestion.size(); j++) {
Index: solr/core/src/java/org/apache/solr/spelling/suggest/DocumentExpressionDictionaryFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/spelling/suggest/DocumentExpressionDictionaryFactory.java	(revision 1576724)
+++ solr/core/src/java/org/apache/solr/spelling/suggest/DocumentExpressionDictionaryFactory.java	(working copy)
@@ -68,7 +68,7 @@
     String field = (String) params.get(FIELD);
     String payloadField = (String) params.get(PAYLOAD_FIELD);
     String weightExpression = (String) params.get(WEIGHT_EXPRESSION);
-    Set<SortField> sortFields = new HashSet<SortField>();
+    Set<SortField> sortFields = new HashSet<>();
     
     if (field == null) {
       throw new IllegalArgumentException(FIELD + " is a mandatory parameter");
Index: solr/core/src/test-files/solr/collection1/conf/schema-trie.xml
===================================================================
--- solr/core/src/test-files/solr/collection1/conf/schema-trie.xml	(revision 1576724)
+++ solr/core/src/test-files/solr/collection1/conf/schema-trie.xml	(working copy)
@@ -233,7 +233,7 @@
              See the Java Regular Expression documentation for more
              infomation on pattern and replacement string syntax.
 
-             http://java.sun.com/j2se/1.6.0/docs/api/java/util/regex/package-summary.html
+             http://docs.oracle.com/javase/7/docs/api/java/util/regex/package-summary.html
           -->
         <filter class="solr.PatternReplaceFilterFactory"
                 pattern="([^a-z])" replacement="" replace="all"
Index: solr/core/src/test-files/solr/collection1/conf/schema11.xml
===================================================================
--- solr/core/src/test-files/solr/collection1/conf/schema11.xml	(revision 1576724)
+++ solr/core/src/test-files/solr/collection1/conf/schema11.xml	(working copy)
@@ -224,7 +224,7 @@
              See the Java Regular Expression documentation for more
              infomation on pattern and replacement string syntax.
              
-             http://java.sun.com/j2se/1.6.0/docs/api/java/util/regex/package-summary.html
+             http://docs.oracle.com/javase/7/docs/api/java/util/regex/package-summary.html
           -->
         <filter class="solr.PatternReplaceFilterFactory"
                 pattern="([^a-z])" replacement="" replace="all"
Index: solr/core/src/test/org/apache/solr/cloud/CollectionsAPIDistributedZkTest.java
===================================================================
--- solr/core/src/test/org/apache/solr/cloud/CollectionsAPIDistributedZkTest.java	(revision 1576724)
+++ solr/core/src/test/org/apache/solr/cloud/CollectionsAPIDistributedZkTest.java	(working copy)
@@ -35,6 +35,7 @@
 import java.util.List;
 import java.util.Map;
 import java.util.Map.Entry;
+import java.util.Objects;
 import java.util.Set;
 import java.util.concurrent.CompletionService;
 import java.util.concurrent.ExecutorCompletionService;
@@ -76,9 +77,12 @@
 import org.apache.solr.common.cloud.ZkCoreNodeProps;
 import org.apache.solr.common.cloud.ZkNodeProps;
 import org.apache.solr.common.cloud.ZkStateReader;
+import org.apache.solr.common.params.CollectionParams;
 import org.apache.solr.common.params.CollectionParams.CollectionAction;
+import org.apache.solr.common.params.CoreAdminParams;
 import org.apache.solr.common.params.MapSolrParams;
 import org.apache.solr.common.params.ModifiableSolrParams;
+import org.apache.solr.common.params.SolrParams;
 import org.apache.solr.common.util.NamedList;
 import org.apache.solr.common.util.SimpleOrderedMap;
 import org.apache.solr.common.util.StrUtils;
@@ -1349,11 +1353,9 @@
     boolean changed = false;
     while(System.currentTimeMillis() <tomeOut){
       Thread.sleep(10);
-      Object b = client.getZkStateReader().getClusterProps().get(name);
-      changed = (val == b) || (val != null && val.equals(b));
+      changed = Objects.equals(val,client.getZkStateReader().getClusterProps().get(name));
       if(changed) break;
     }
     return changed;
   }
-
 }
Index: solr/example
===================================================================
--- solr/example	(revision 1576724)
+++ solr/example	(working copy)

Property changes on: solr/example
___________________________________________________________________
Modified: svn:mergeinfo
   Merged /lucene/dev/trunk/solr/example:r1457734,1457868
Index: solr/example/example-DIH/solr/db/conf/schema.xml
===================================================================
--- solr/example/example-DIH/solr/db/conf/schema.xml	(revision 1576724)
+++ solr/example/example-DIH/solr/db/conf/schema.xml	(working copy)
@@ -224,7 +224,7 @@
              See the Java Regular Expression documentation for more
              infomation on pattern and replacement string syntax.
              
-             http://java.sun.com/j2se/1.6.0/docs/api/java/util/regex/package-summary.html
+             http://docs.oracle.com/javase/7/docs/api/java/util/regex/package-summary.html
           -->
         <filter class="solr.PatternReplaceFilterFactory"
                 pattern="([^a-z])" replacement="" replace="all"
Index: solr/example/example-DIH/solr/mail/conf/schema.xml
===================================================================
--- solr/example/example-DIH/solr/mail/conf/schema.xml	(revision 1576724)
+++ solr/example/example-DIH/solr/mail/conf/schema.xml	(working copy)
@@ -290,7 +290,7 @@
              See the Java Regular Expression documentation for more
              infomation on pattern and replacement string syntax.
 
-             http://java.sun.com/j2se/1.6.0/docs/api/java/util/regex/package-summary.html
+             http://docs.oracle.com/javase/7/docs/api/java/util/regex/package-summary.html
           -->
         <filter class="solr.PatternReplaceFilterFactory"
                 pattern="([^a-z])" replacement="" replace="all"
Index: solr/example/example-DIH/solr/rss/conf/schema.xml
===================================================================
--- solr/example/example-DIH/solr/rss/conf/schema.xml	(revision 1576724)
+++ solr/example/example-DIH/solr/rss/conf/schema.xml	(working copy)
@@ -224,7 +224,7 @@
              See the Java Regular Expression documentation for more
              infomation on pattern and replacement string syntax.
              
-             http://java.sun.com/j2se/1.6.0/docs/api/java/util/regex/package-summary.html
+             http://docs.oracle.com/javase/7/docs/api/java/util/regex/package-summary.html
           -->
         <filter class="solr.PatternReplaceFilterFactory"
                 pattern="([^a-z])" replacement="" replace="all"
Index: solr/example/example-DIH/solr/solr/conf/schema.xml
===================================================================
--- solr/example/example-DIH/solr/solr/conf/schema.xml	(revision 1576724)
+++ solr/example/example-DIH/solr/solr/conf/schema.xml	(working copy)
@@ -224,7 +224,7 @@
              See the Java Regular Expression documentation for more
              infomation on pattern and replacement string syntax.
              
-             http://java.sun.com/j2se/1.6.0/docs/api/java/util/regex/package-summary.html
+             http://docs.oracle.com/javase/7/docs/api/java/util/regex/package-summary.html
           -->
         <filter class="solr.PatternReplaceFilterFactory"
                 pattern="([^a-z])" replacement="" replace="all"
Index: solr/example/solr/collection1/conf/schema.xml
===================================================================
--- solr/example/solr/collection1/conf/schema.xml	(revision 1576724)
+++ solr/example/solr/collection1/conf/schema.xml	(working copy)
@@ -622,7 +622,7 @@
              See the Java Regular Expression documentation for more
              information on pattern and replacement string syntax.
              
-             http://java.sun.com/j2se/1.6.0/docs/api/java/util/regex/package-summary.html
+             http://docs.oracle.com/javase/7/docs/api/java/util/regex/package-summary.html
           -->
         <filter class="solr.PatternReplaceFilterFactory"
                 pattern="([^a-z])" replacement="" replace="all"
Index: solr/README.txt
===================================================================
--- solr/README.txt	(revision 1576724)
+++ solr/README.txt	(working copy)
@@ -62,10 +62,10 @@
 Instructions for Building Apache Solr from Source
 -------------------------------------------------
 
-1. Download the Java SE 6 JDK (Java Development Kit) or later from http://java.sun.com/
+1. Download the Java SE 7 JDK (Java Development Kit) or later from http://java.sun.com/
    You will need the JDK installed, and the $JAVA_HOME/bin (Windows: %JAVA_HOME%\bin) 
    folder included on your command path. To test this, issue a "java -version" command 
-   from your shell (command prompt) and verify that the Java version is 1.6 or later.
+   from your shell (command prompt) and verify that the Java version is 1.7 or later.
 
 2. Download the Apache Ant binary distribution (1.8.2+) from 
    http://ant.apache.org/  You will need Ant installed and the $ANT_HOME/bin (Windows: 
Index: solr/README.txt
===================================================================
--- solr/README.txt	(revision 1576724)
+++ solr/README.txt	(working copy)

Property changes on: solr/README.txt
___________________________________________________________________
Modified: svn:mergeinfo
   Merged /lucene/dev/trunk/solr/README.txt:r1457734,1457868
Index: solr/site
===================================================================
--- solr/site	(revision 1576724)
+++ solr/site	(working copy)

Property changes on: solr/site
___________________________________________________________________
Modified: svn:mergeinfo
   Merged /lucene/dev/trunk/solr/site:r1457734,1457868
Index: solr/site/html/tutorial.html
===================================================================
--- solr/site/html/tutorial.html	(revision 1576724)
+++ solr/site/html/tutorial.html	(working copy)
@@ -54,13 +54,13 @@
 </p>
 <ol>
   
-<li>Java 1.6 or greater.  Some places you can get it are from
+<li>Java 1.7 or greater.  Some places you can get it are from
   <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Oracle</a>,
   <a href="http://openjdk.java.net/">Open JDK</a>, or
   <a href="http://www.ibm.com/developerworks/java/jdk/">IBM</a>.
   <ul>
     <li>Running <span class="codefrag">java -version</span> at the command 
-      line should indicate a version number starting with 1.6.
+      line should indicate a version number starting with 1.7.
     </li>
     <li>Gnu's GCJ is not supported and does not work with Solr.</li>
   </ul>
Index: solr/solrj
===================================================================
--- solr/solrj	(revision 1576724)
+++ solr/solrj	(working copy)

Property changes on: solr/solrj
___________________________________________________________________
Modified: svn:mergeinfo
   Merged /lucene/dev/trunk/solr/solrj:r1457734,1457868
Index: solr/SYSTEM_REQUIREMENTS.txt
===================================================================
--- solr/SYSTEM_REQUIREMENTS.txt	(revision 1576724)
+++ solr/SYSTEM_REQUIREMENTS.txt	(working copy)
@@ -1,6 +1,6 @@
 # System Requirements 
 
-Apache Solr runs of Java 6 or greater. When using Java 7, be sure to 
+Apache Solr runs of Java 7 or greater. When using Java 7, be sure to 
 install at least Update 1! With all Java versions it is strongly 
 recommended to not use experimental `-XX` JVM options. It is also 
 recommended to always use the latest update version of your Java VM, 
Index: solr/SYSTEM_REQUIREMENTS.txt
===================================================================
--- solr/SYSTEM_REQUIREMENTS.txt	(revision 1576724)
+++ solr/SYSTEM_REQUIREMENTS.txt	(working copy)

Property changes on: solr/SYSTEM_REQUIREMENTS.txt
___________________________________________________________________
Modified: svn:mergeinfo
   Merged /lucene/dev/trunk/solr/SYSTEM_REQUIREMENTS.txt:r1457734,1457868
