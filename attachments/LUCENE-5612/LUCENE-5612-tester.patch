Index: lucene/core/build.xml
===================================================================
--- lucene/core/build.xml	(revision 1588160)
+++ lucene/core/build.xml	(working copy)
@@ -145,5 +145,45 @@
   </target>
 
   <target name="regenerate" depends="createLevAutomata,createPackedIntSources"/>
+  
+  <target name="test-lock-factory" depends="compile-core">
+    <property name="lock.factory.impl" value="org.apache.lucene.store.NativeFSLockFactory"/>
+    <property name="lock.factory.dir" location="${build.dir}/lockfactorytest"/>
+    <property name="lock.factory.delay" value="5"/>
+    <path id="test-lock.classpath">
+      <path refid="classpath"/>
+      <pathelement location="${build.dir}/classes/java"/>
+    </path>
+    <mkdir dir="${lock.factory.dir}"/>
+    <parallel threadCount="3">
+      <sequential>
+        <java taskname="LockVerifyServer" fork="true" classpathref="test-lock.classpath" classname="org.apache.lucene.store.LockVerifyServer">
+          <arg value="5000"/>
+        </java>
+      </sequential>
+      <sequential>
+        <sleep seconds="1"/>
+        <java taskname="LockStressTest1" fork="true" classpathref="test-lock.classpath" classname="org.apache.lucene.store.LockStressTest">
+          <arg value="1"/>
+          <arg value="127.0.0.1"/>
+          <arg value="5000"/>
+          <arg value="${lock.factory.impl}"/>
+          <arg value="${lock.factory.dir}"/>
+          <arg value="${lock.factory.delay}"/>
+        </java>
+      </sequential>
+      <sequential>
+        <sleep seconds="1"/>
+        <java taskname="LockStressTest2" fork="true" classpathref="test-lock.classpath" classname="org.apache.lucene.store.LockStressTest">
+          <arg value="2"/>
+          <arg value="127.0.0.1"/>
+          <arg value="5000"/>
+          <arg value="${lock.factory.impl}"/>
+          <arg value="${lock.factory.dir}"/>
+          <arg value="${lock.factory.delay}"/>
+        </java>
+      </sequential>
+    </parallel>
+  </target>
 
 </project>
