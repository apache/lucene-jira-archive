Index: lucene/test-framework/src/java/org/apache/lucene/analysis/MockCharFilter.java
===================================================================
--- lucene/test-framework/src/java/org/apache/lucene/analysis/MockCharFilter.java	(revision 1439839)
+++ lucene/test-framework/src/java/org/apache/lucene/analysis/MockCharFilter.java	(working copy)
@@ -19,6 +19,7 @@
 
 import java.io.IOException;
 import java.io.Reader;
+import java.util.Map;
 import java.util.SortedMap;
 import java.util.TreeMap;
 
@@ -89,8 +90,8 @@
 
   @Override
   public int correct(int currentOff) {
-    SortedMap<Integer,Integer> subMap = corrections.subMap(0, currentOff+1);
-    int ret = subMap.isEmpty() ? currentOff : currentOff + subMap.get(subMap.lastKey());
+    Map.Entry<Integer,Integer> lastEntry = corrections.lowerEntry(currentOff+1);
+    int ret = lastEntry == null ? currentOff : currentOff + lastEntry.getValue();
     assert ret >= 0 : "currentOff=" + currentOff + ",diff=" + (ret-currentOff);
     return ret;
   }
