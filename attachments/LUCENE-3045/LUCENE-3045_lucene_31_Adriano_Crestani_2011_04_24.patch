Index: contrib/CHANGES.txt
===================================================================
--- contrib/CHANGES.txt	(revision 1096391)
+++ contrib/CHANGES.txt	(working copy)
@@ -1,5 +1,12 @@
 Lucene contrib change Log
 
+======================= Lucene 3.1.x (not yet released) =======================
+
+Bug fixes
+
+ * LUCENE-3045: fixed QueryNodeImpl.containsTag(String key) that was
+   not lowercasing the key before checking for the tag (Adriano Crestani)
+
 ======================= Lucene 3.1.0 =======================
 
 Changes in backwards compatibility policy
Index: contrib/queryparser/src/java/org/apache/lucene/queryParser/core/nodes/QueryNodeImpl.java
===================================================================
--- contrib/queryparser/src/java/org/apache/lucene/queryParser/core/nodes/QueryNodeImpl.java	(revision 1096391)
+++ contrib/queryparser/src/java/org/apache/lucene/queryParser/core/nodes/QueryNodeImpl.java	(working copy)
@@ -189,7 +189,7 @@
 
   /** verify if a node contains a tag */
   public boolean containsTag(String tagName) {
-    return this.tags.containsKey(tagName);
+    return this.tags.containsKey(tagName.toLowerCase());
   }
 
   /**
