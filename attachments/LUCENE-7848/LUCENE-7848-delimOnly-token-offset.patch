From 2b147ed37eee10aa3b133d86f6c6918066b454c9 Mon Sep 17 00:00:00 2001
From: Michael Gibney <michael@michaelgibney.net>
Date: Fri, 14 Jul 2017 10:13:21 -0400
Subject: [PATCH] for delim-only tokens with PRESERVE_ORIGINAL, output and
 clear accumPosInc

---
 .../apache/lucene/analysis/miscellaneous/WordDelimiterGraphFilter.java  | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/lucene/analysis/common/src/java/org/apache/lucene/analysis/miscellaneous/WordDelimiterGraphFilter.java b/lucene/analysis/common/src/java/org/apache/lucene/analysis/miscellaneous/WordDelimiterGraphFilter.java
index a6ade19954..c4886830b0 100644
--- a/lucene/analysis/common/src/java/org/apache/lucene/analysis/miscellaneous/WordDelimiterGraphFilter.java
+++ b/lucene/analysis/common/src/java/org/apache/lucene/analysis/miscellaneous/WordDelimiterGraphFilter.java
@@ -353,6 +353,8 @@ public final class WordDelimiterGraphFilter extends TokenFilter {
           if (has(PRESERVE_ORIGINAL) == false) {
             continue;
           } else {
+            posIncAttribute.setPositionIncrement(accumPosInc);
+            accumPosInc = 0;
             return true;
           }
         }
-- 
2.13.0

