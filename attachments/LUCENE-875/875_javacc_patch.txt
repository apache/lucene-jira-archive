Index: CHANGES.txt
===================================================================
--- CHANGES.txt	(revision 535361)
+++ CHANGES.txt	(working copy)
@@ -169,6 +169,12 @@
     java.util.Comparator.compare(): Any integer is allowed to be returned
     instead of only -1/0/1.
     (Paul Cowan via Michael Busch)
+ 
+ 3. LUCENE-875: Solved javadoc warnings & errors under jdk1.4. 
+    Solved javadoc errors under jdk5 (jars in path for gdata).
+    Set javadoc target to fail if there are errors or warnings.
+    For now allow warnings under jdk5 (until gdata javadocs are fixed).
+    (Doron Cohen)
 
 ======================= Release 2.1.0 2007-02-14 =======================
 
Index: build.xml
===================================================================
--- build.xml	(revision 535366)
+++ build.xml	(working copy)
@@ -17,6 +17,38 @@
     <pathelement location="${build.dir}/classes/java"/>
   </path>
 
+  <!-- Javadoc classpath -->
+  <path id="javadoc.classpath">
+    <path refid="classpath"/>
+    <pathelement location="${ant.home}/lib/ant.jar"/>
+    <pathelement location="contrib/lucli/lib/jline.jar"/>
+    <pathelement location="contrib/regex/lib/jakarta-regexp-1.4.jar"/>
+    <pathelement location="contrib/benchmark/commons-beanutils-1.7.0.jar"/>
+    <pathelement location="contrib/benchmark/lib/commons-collections-3.1.jar"/>
+    <pathelement location="contrib/benchmark/lib/commons-digester-1.7.jar"/>
+    <pathelement location="contrib/benchmark/lib/commons-logging-1.0.4.jar"/>
+    <pathelement location="contrib/ant/lib/Tidy.jar"/>
+    <!-- gdata jars only used with jdk 5 but include them even for lower jdk -->
+    <pathelement location="contrib/gdata-server/lib/commons-beanutils.jar"/>
+    <pathelement location="contrib/gdata-server/lib/commons-collections-3.2.jar"/>
+    <pathelement location="contrib/gdata-server/lib/commons-digester-1.7.jar"/>
+    <pathelement location="contrib/gdata-server/lib/commons-logging-1.1.jar"/>
+    <pathelement location="contrib/gdata-server/lib/gdata-client-1.0.jar"/>
+    <pathelement location="contrib/gdata-server/lib/log4j-1.2.13.jar"/>
+    <pathelement location="contrib/gdata-server/lib/nekohtml.jar"/>
+    <pathelement location="contrib/gdata-server/lib/servlet-api.jar"/>
+    <pathelement location="contrib/gdata-server/lib/xercesImpl.jar"/>
+    <pathelement location="contrib/gdata-server/ext-lib/easymock-1.2_Java1.5.jar"/>
+    <pathelement location="contrib/gdata-server/ext-lib/hessian-3.0.20.jar"/>
+    <pathelement location="contrib/gdata-server/ext-lib/hivemind-1.1.jar"/>
+    <pathelement location="contrib/gdata-server/ext-lib/hivemind-jmx-1.1.jar"/>
+    <pathelement location="contrib/gdata-server/ext-lib/hivemind-lib-1.1.jar"/>
+    <pathelement location="contrib/gdata-server/ext-lib/javassist-3.0.jar"/>
+    <pathelement location="contrib/gdata-server/ext-lib/oro-2.0.6.jar"/>
+    <pathelement location="contrib/gdata-server/ext-lib/stax-1.1.2-dev.jar"/>
+    <pathelement location="contrib/gdata-server/ext-lib/stax-api-1.0.1.jar"/>
+  </path>
+
   <path id="demo.classpath">
     <path refid="classpath"/>
     <pathelement location="${build.dir}/classes/demo"/>
@@ -366,7 +398,10 @@
         <include name="**" if="javadoc-1-5-contrib" />
       </dirset>
 
+      <record name="log_javadoc.txt" action="start" append="no"/>
+
       <javadoc
+          failonerror="true"
           overview="src/java/overview.html"
           packagenames="org.apache.lucene.*"
           destdir="@{destdir}"
@@ -413,7 +448,7 @@
 
         <group title="contrib: Analysis" packages="org.apache.lucene.analysis.*"/>
         <group title="contrib: Ant" packages="org.apache.lucene.ant*"/>
-          <group title="contrib: Benchmark" packages="org.apache.lucene.benchmark*"/>
+        <group title="contrib: Benchmark" packages="org.apache.lucene.benchmark*"/>
         <group title="contrib: Highlighter" packages="org.apache.lucene.search.highlight*"/>
         <group title="contrib: GData Server (Java1.5)" packages="org.apache.lucene.gdata.*"/>
         <group title="contrib: Lucli" packages="lucli*"/>
@@ -429,7 +464,33 @@
         <group title="contrib: WordNet" packages="org.apache.lucene.wordnet*"/>
 
 
+        <classpath refid="javadoc.classpath"/>
+
       </javadoc>
+
+      <record name="log_javadoc.txt" action="stop"/>
+
+      <delete>
+        <fileset file="log_javadoc.txt">
+          <not>
+           <containsregexp expression="\[javadoc\]\s*[1-9][0-9]*[\s]*warning"/>
+          </not>
+        </fileset>
+      </delete>
+
+      <fail message="Javadocs warnings were found!">
+        <condition>
+          <and>
+            <available file="log_javadoc.txt"/>
+            <not>  
+              <!-- TODO: once gdata javadocs are fixed, remove this part of the 'and' (and the 'and' itself...) -->
+              <isset property="javadoc-1-5-contrib"/>  
+            </not>
+          </and>
+        </condition>
+      </fail>
+
+
    </sequential>
   </macrodef>
 
Index: src/java/org/apache/lucene/queryParser/QueryParser.java
===================================================================
--- src/java/org/apache/lucene/queryParser/QueryParser.java	(revision 535361)
+++ src/java/org/apache/lucene/queryParser/QueryParser.java	(working copy)
@@ -219,9 +219,14 @@
 
 
   /**
-   * Set to <code>true</code> to allow <code>*</code> and <code>?</code> as the first character 
-   * of a PrefixQuery and WildcardQuery. Note that this can produce very slow
-   * queries on big indexes. Default: false.
+   * Set to <code>true</code> to allow leading wildcard characters.
+   * <p>
+   * When set, <code>*</code> or <code>?</code> are allowed as 
+   * the first character of a PrefixQuery and WildcardQuery.
+   * Note that this can produce very slow
+   * queries on big indexes. 
+   * <p>
+   * Default: false.
    */
   public void setAllowLeadingWildcard(boolean allowLeadingWildcard) {
     this.allowLeadingWildcard = allowLeadingWildcard;
@@ -1253,6 +1258,16 @@
     finally { jj_save(0, xla); }
   }
 
+  final private boolean jj_3_1() {
+    Token xsp;
+    xsp = jj_scanpos;
+    if (jj_3R_2()) {
+    jj_scanpos = xsp;
+    if (jj_3R_3()) return true;
+    }
+    return false;
+  }
+
   final private boolean jj_3R_3() {
     if (jj_scan_token(STAR)) return true;
     if (jj_scan_token(COLON)) return true;
@@ -1265,16 +1280,6 @@
     return false;
   }
 
-  final private boolean jj_3_1() {
-    Token xsp;
-    xsp = jj_scanpos;
-    if (jj_3R_2()) {
-    jj_scanpos = xsp;
-    if (jj_3R_3()) return true;
-    }
-    return false;
-  }
-
   public QueryParserTokenManager token_source;
   public Token token, jj_nt;
   private int jj_ntk;
Index: src/java/org/apache/lucene/queryParser/QueryParser.jj
===================================================================
--- src/java/org/apache/lucene/queryParser/QueryParser.jj	(revision 535361)
+++ src/java/org/apache/lucene/queryParser/QueryParser.jj	(working copy)
@@ -243,9 +243,14 @@
 
 
   /**
-   * Set to <code>true</code> to allow <code>*</code> and <code>?</code> as the first character 
-   * of a PrefixQuery and WildcardQuery. Note that this can produce very slow
-   * queries on big indexes. Default: false.
+   * Set to <code>true</code> to allow leading wildcard characters.
+   * <p>
+   * When set, <code>*</code> or <code>?</code> are allowed as 
+   * the first character of a PrefixQuery and WildcardQuery.
+   * Note that this can produce very slow
+   * queries on big indexes. 
+   * <p>
+   * Default: false.
    */
   public void setAllowLeadingWildcard(boolean allowLeadingWildcard) {
     this.allowLeadingWildcard = allowLeadingWildcard;
Index: src/java/org/apache/lucene/analysis/Token.java
===================================================================
--- src/java/org/apache/lucene/analysis/Token.java	(revision 535361)
+++ src/java/org/apache/lucene/analysis/Token.java	(working copy)
@@ -136,8 +136,8 @@
   public final String type() { return type; }
 
   /** 
-   * Sets this Token's payload.<br>
-   * <br>
+   * Sets this Token's payload.
+   * <p>
    * <b>
    * Warning: The status of the Payloads feature is experimental. The APIs
    * introduced here might change in the future and will not be supported anymore
@@ -151,8 +151,8 @@
   }
   
   /** 
-   * Returns this Token's payload.<br> 
-   * <br>
+   * Returns this Token's payload. 
+   * <p>
    * <b>
    * Warning: The status of the Payloads feature is experimental. The APIs
    * introduced here might change in the future and will not be supported anymore
Index: src/java/org/apache/lucene/search/FieldCache.java
===================================================================
--- src/java/org/apache/lucene/search/FieldCache.java	(revision 535361)
+++ src/java/org/apache/lucene/search/FieldCache.java	(working copy)
@@ -54,16 +54,15 @@
   }
 
   /** Interface to parse ints from document fields.
-   * @see #getInts(IndexReader, String, IntParser)
+   * @see FieldCache#getInts(IndexReader, String, FieldCache.IntParser)
    */
   public interface IntParser {
     /** Return an integer representation of this field's value. */
     public int parseInt(String string);
   }
 
-
   /** Interface to parse floats from document fields.
-   * @see #getFloats(IndexReader, String, FloatParser)
+   * @see FieldCache#getFloats(IndexReader, String, FieldCache.FloatParser)
    */
   public interface FloatParser {
     /** Return an float representation of this field's value. */
@@ -73,7 +72,6 @@
   /** Expert: The cache used internally by sorting and range query classes. */
   public static FieldCache DEFAULT = new FieldCacheImpl();
 
-
   /** Checks the internal cache for an appropriate entry, and if none is
    * found, reads the terms in <code>field</code> as integers and returns an array
    * of size <code>reader.maxDoc()</code> of the value each document
@@ -175,4 +173,5 @@
    */
   public Comparable[] getCustom (IndexReader reader, String field, SortComparator comparator)
   throws IOException;
+  
 }
Index: src/java/org/apache/lucene/search/Similarity.java
===================================================================
--- src/java/org/apache/lucene/search/Similarity.java	(revision 535361)
+++ src/java/org/apache/lucene/search/Similarity.java	(working copy)
@@ -284,7 +284,7 @@
  * </ol>
  *
  * @see #setDefault(Similarity)
- * @see IndexWriter#setSimilarity(Similarity)
+ * @see org.apache.lucene.index.IndexWriter#setSimilarity(Similarity)
  * @see Searcher#setSimilarity(Similarity)
  */
 public abstract class Similarity implements Serializable {
@@ -295,7 +295,7 @@
    * code.
    *
    * @see Searcher#setSimilarity(Similarity)
-   * @see IndexWriter#setSimilarity(Similarity)
+   * @see org.apache.lucene.index.IndexWriter#setSimilarity(Similarity)
    */
   public static void setDefault(Similarity similarity) {
     Similarity.defaultImpl = similarity;
@@ -307,7 +307,7 @@
    * <p>This is initially an instance of {@link DefaultSimilarity}.
    *
    * @see Searcher#setSimilarity(Similarity)
-   * @see IndexWriter#setSimilarity(Similarity)
+   * @see org.apache.lucene.index.IndexWriter#setSimilarity(Similarity)
    */
   public static Similarity getDefault() {
     return Similarity.defaultImpl;
@@ -344,9 +344,11 @@
    * method usually return smaller values when <code>numTokens</code> is large,
    * and larger values when <code>numTokens</code> is small.
    *
-   * <p>That these values are computed under {@link
-   * IndexWriter#addDocument(org.apache.lucene.document.Document)} and stored then using
-   * {@link #encodeNorm(float)}.  Thus they have limited precision, and documents
+   * <p>That these values are computed under 
+   * {@link org.apache.lucene.index.IndexWriter#addDocument(org.apache.lucene.document.Document)} 
+   * and stored then using
+   * {@link #encodeNorm(float)}.  
+   * Thus they have limited precision, and documents
    * must be re-indexed if this method is altered.
    *
    * @param fieldName the name of the field
@@ -382,7 +384,7 @@
    * value.
    *
    * @see org.apache.lucene.document.Field#setBoost(float)
-   * @see SmallFloat
+   * @see org.apache.lucene.util.SmallFloat
    */
   public static byte encodeNorm(float f) {
     return SmallFloat.floatToByte315(f);
@@ -445,7 +447,7 @@
    * </pre>
    *
    * Note that {@link Searcher#maxDoc()} is used instead of
-   * {@link IndexReader#numDocs()} because it is proportional to
+   * {@link org.apache.lucene.index.IndexReader#numDocs()} because it is proportional to
    * {@link Searcher#docFreq(Term)} , i.e., when one is inaccurate,
    * so is the other, and in the same direction.
    *
Index: src/java/org/apache/lucene/index/TermPositions.java
===================================================================
--- src/java/org/apache/lucene/index/TermPositions.java	(revision 535361)
+++ src/java/org/apache/lucene/index/TermPositions.java	(working copy)
@@ -83,8 +83,11 @@
     byte[] getPayload(byte[] data, int offset) throws IOException;
 
   /**
-   * Can we load the payload at this position?  Payloads can only be loaded once per call
-   * to {@link #nextPosition()}
+   * Checks if a payload can be loaded at this position.
+   * <p>
+   * Payloads can only be loaded once per call to 
+   * {@link #nextPosition()}.
+   * 
    * @return true if there is a payload available at this position that can be loaded
    *
    * * <b>
Index: src/java/org/apache/lucene/index/FieldReaderException.java
===================================================================
--- src/java/org/apache/lucene/index/FieldReaderException.java	(revision 535361)
+++ src/java/org/apache/lucene/index/FieldReaderException.java	(working copy)
@@ -30,9 +30,11 @@
 
   /**
    * Constructs a new runtime exception with the specified cause and a
-   * detail message of <tt>(cause==null ? null : cause.toString())</tt>
+   * detail message of <tt>(cause==null &#63; null : cause.toString())</tt>
    * (which typically contains the class and detail message of
-   * <tt>cause</tt>).  This constructor is useful for runtime exceptions
+   * <tt>cause</tt>).  
+   * <p>
+   * This constructor is useful for runtime exceptions
    * that are little more than wrappers for other throwables.
    *
    * @param cause the cause (which is saved for later retrieval by the
Index: src/java/org/apache/lucene/document/FieldSelectorResult.java
===================================================================
--- src/java/org/apache/lucene/document/FieldSelectorResult.java	(revision 535361)
+++ src/java/org/apache/lucene/document/FieldSelectorResult.java	(working copy)
@@ -68,7 +68,7 @@
       */
   public transient static final FieldSelectorResult SIZE = new FieldSelectorResult(5);
 
-  /** Expert: Like {@link #SIZE} but immediately break from the field loading loop, i.e. stop loading further fields, after the size is loaded */         
+  /** Expert: Like {@link #SIZE} but immediately break from the field loading loop, i.e., stop loading further fields, after the size is loaded */         
   public transient static final FieldSelectorResult SIZE_AND_BREAK = new FieldSelectorResult(6);
 
 
Index: contrib/ant/src/java/org/apache/lucene/ant/TextDocument.java
===================================================================
--- contrib/ant/src/java/org/apache/lucene/ant/TextDocument.java	(revision 535361)
+++ contrib/ant/src/java/org/apache/lucene/ant/TextDocument.java	(working copy)
@@ -30,7 +30,7 @@
  *  A utility for making Lucene Documents from a File.
  *
  *@author     Erik Hatcher
- *@created    December 6, 2001
+ *@since      December 6, 2001
  *@todo       Fix JavaDoc comments here
  */
 
Index: contrib/ant/src/java/org/apache/lucene/ant/FileExtensionDocumentHandler.java
===================================================================
--- contrib/ant/src/java/org/apache/lucene/ant/FileExtensionDocumentHandler.java	(revision 535361)
+++ contrib/ant/src/java/org/apache/lucene/ant/FileExtensionDocumentHandler.java	(working copy)
@@ -27,7 +27,7 @@
  *  files are handled, other extensions ignored.
  *
  *@author     Erik Hatcher
- *@created    October 28, 2001
+ *@since      October 28, 2001
  *@todo Implement dynamic document type lookup
  */
 public class FileExtensionDocumentHandler
Index: contrib/ant/src/java/org/apache/lucene/ant/DocumentHandler.java
===================================================================
--- contrib/ant/src/java/org/apache/lucene/ant/DocumentHandler.java	(revision 535361)
+++ contrib/ant/src/java/org/apache/lucene/ant/DocumentHandler.java	(working copy)
@@ -25,7 +25,7 @@
  *  Allows a class to act as a Lucene document handler
  *
  *@author     Erik Hatcher
- *@created    October 27, 2001
+ *@since    October 27, 2001
  */
 public interface DocumentHandler {
 
Index: contrib/benchmark/src/java/org/apache/lucene/benchmark/standard/StandardOptions.java
===================================================================
--- contrib/benchmark/src/java/org/apache/lucene/benchmark/standard/StandardOptions.java	(revision 535361)
+++ contrib/benchmark/src/java/org/apache/lucene/benchmark/standard/StandardOptions.java	(working copy)
@@ -42,7 +42,6 @@
 
     /**
      * How often to print out log messages when in benchmark loops
-     * @return
      */
     public int getLogStep()
     {
@@ -56,7 +55,6 @@
 
     /**
      * The number of times to run the benchmark
-     * @return
      */
     public int getRunCount()
     {
@@ -68,10 +66,6 @@
         this.runCount = runCount;
     }
 
-    /**
-     *
-     * @return
-     */
     public int getScaleUp()
     {
         return scaleUp;
Index: contrib/benchmark/src/java/org/apache/lucene/benchmark/stats/TestRunData.java
===================================================================
--- contrib/benchmark/src/java/org/apache/lucene/benchmark/stats/TestRunData.java	(revision 535361)
+++ contrib/benchmark/src/java/org/apache/lucene/benchmark/stats/TestRunData.java	(working copy)
@@ -123,7 +123,7 @@
     return v;
   }
 
-  /** Get memory usage stats. for a given data type. */
+  /** Get memory usage stats for a given data type. */
   public MemUsage getMemUsage(String label) {
     Vector v = (Vector) data.get(label);
       if (v == null)
Index: contrib/memory/src/java/org/apache/lucene/index/memory/PatternAnalyzer.java
===================================================================
--- contrib/memory/src/java/org/apache/lucene/index/memory/PatternAnalyzer.java	(revision 535361)
+++ contrib/memory/src/java/org/apache/lucene/index/memory/PatternAnalyzer.java	(working copy)
@@ -65,7 +65,7 @@
  */
 public class PatternAnalyzer extends Analyzer {
   
-  /** <code>"\\W+"</code>; Divides text at non-letters (!Character.isLetter(c)) */
+  /** <code>"\\W+"</code>; Divides text at non-letters (NOT Character.isLetter(c)) */
   public static final Pattern NON_WORD_PATTERN = Pattern.compile("\\W+");
   
   /** <code>"\\s+"</code>; Divides text at whitespaces (Character.isWhitespace(c)) */
Index: contrib/miscellaneous/src/java/org/apache/lucene/queryParser/analyzing/AnalyzingQueryParser.java
===================================================================
--- contrib/miscellaneous/src/java/org/apache/lucene/queryParser/analyzing/AnalyzingQueryParser.java	(revision 535361)
+++ contrib/miscellaneous/src/java/org/apache/lucene/queryParser/analyzing/AnalyzingQueryParser.java	(working copy)
@@ -29,8 +29,8 @@
 
 /**
  * Overrides Lucene's default QueryParser so that Fuzzy-, Prefix-, Range-, and WildcardQuerys
- * are also passed through the given analyzer, but <code>?</code> and <code>*</code> don't get 
- * removed from the search terms.
+ * are also passed through the given analyzer, but wild card characters (like <code>*</code>) 
+ * don't get removed from the search terms.
  * 
  * <p><b>Warning:</b> This class should only be used with analyzers that do not use stopwords
  * or that add tokens. Also, several stemming analyzers are inappropriate: for example, GermanAnalyzer 
@@ -55,9 +55,12 @@
   /**
    * Called when parser
    * parses an input term token that contains one or more wildcard
-   * characters (? and *), but is not a prefix term token (one
-   * that has just a single * character at the end)
+   * characters (like <code>*</code>), but is not a prefix term token (one
+   * that has just a single * character at the end).
    * <p>
+   * Example: will be called for <code>H?user</code> or for <code>H*user</code> 
+   * but not for <code>*user</code>.
+   * <p>
    * Depending on analyzer and settings, a wildcard term may (most probably will)
    * be lower-cased automatically. It <b>will</b> go through the default Analyzer.
    * <p>
Index: contrib/miscellaneous/src/java/org/apache/lucene/index/FieldNormModifier.java
===================================================================
--- contrib/miscellaneous/src/java/org/apache/lucene/index/FieldNormModifier.java	(revision 535361)
+++ contrib/miscellaneous/src/java/org/apache/lucene/index/FieldNormModifier.java	(working copy)
@@ -25,8 +25,10 @@
 
 /**
  * Given a directory and a list of fields, updates the fieldNorms in place for every document.
+ * 
  * If Similarity class is specified, uses its lengthNorm method to set norms.
- * If -n command line argument is used, removed field norms, as if {@link Field.Index.NO_NORMS} was used.
+ * If -n command line argument is used, removed field norms, as if 
+ * {@link org.apache.lucene.document.Field.Index}.NO_NORMS was used.
  *
  * <p>
  * NOTE: This will overwrite any length normalization or field/document boosts.
@@ -36,9 +38,9 @@
  * @author Otis Gospodnetic
  */
 public class FieldNormModifier {
-  
+
   /**
-   * Command Line Execution method
+   * Command Line Execution method.
    *
    * <pre>
    * Usage: FieldNormModifier /path/index <package.SimilarityClassName | -n> field1 field2 ...
Index: contrib/miscellaneous/src/java/org/apache/lucene/misc/SweetSpotSimilarity.java
===================================================================
--- contrib/miscellaneous/src/java/org/apache/lucene/misc/SweetSpotSimilarity.java	(revision 535361)
+++ contrib/miscellaneous/src/java/org/apache/lucene/misc/SweetSpotSimilarity.java	(working copy)
@@ -118,10 +118,10 @@
   }
     
   /**
-   * Implimented as:
+   * Implemented as:
    * <code>
    * 1/sqrt( steepness * (abs(x-min) + abs(x-max) - (max-min)) + 1 )
-   * </code>
+   * </code>.
    *
    * <p>
    * This degrades to <code>1/sqrt(x)</code> when min and max are both 1 and
@@ -173,9 +173,9 @@
   }
   
   /**
-   * Implimented as:
+   * Implemented as:
    * <code>
-   *  (x &lt;= min) ? base : sqrt(x+(base**2)-min)
+   *  (x &lt;= min) &#63; base : sqrt(x+(base**2)-min)
    * </code>
    * ...but with a special case check for 0.
    * <p>
Index: contrib/miscellaneous/src/java/org/apache/lucene/misc/LengthNormModifier.java
===================================================================
--- contrib/miscellaneous/src/java/org/apache/lucene/misc/LengthNormModifier.java	(revision 535361)
+++ contrib/miscellaneous/src/java/org/apache/lucene/misc/LengthNormModifier.java	(working copy)
@@ -42,7 +42,7 @@
 public class LengthNormModifier {
   
   /**
-   * Command Line Execution method
+   * Command Line Execution method.
    *
    * <pre>
    * Usage: LengthNormModifier /path/index package.SimilarityClassName field1 field2 ...
