<!--
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Mon May 09 17:45:01 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/sr/jira.issueviews:searchrequest-xml/temp/SearchRequest.xml?jqlQuery=project+in+(LUCENE%2C+SOLR)+AND+fixVersion+%3D+6.0+ORDER+BY+key+DESC&amp;tempMax=200&amp;field=key&amp;field=summary
-->
<!-- If you wish to do custom client-side styling of RSS, uncomment this:
<?xml-stylesheet href="https://issues.apache.org/jira/styles/jiraxml2html.xsl" type="text/xsl"?>
-->
<rss version="0.92">
    <channel>
        <title>ASF JIRA</title>
        <link>https://issues.apache.org/jira/secure/IssueNavigator.jspa?reset=true&amp;jqlQuery=project+in+%28LUCENE%2C+SOLR%29+AND+fixVersion+%3D+6.0+ORDER+BY+key+DESC</link>
        <description>An XML representation of a search request</description>
                <language>en-us</language>
                        <issue start="0" end="186" total="186"/>
                <build-info>
            <version>6.3.4</version>
            <build-number>6332</build-number>
            <build-date>15-08-2014</build-date>
        </build-info>
<item>
            <title>[SOLR-8940] ArrayIndexOutOfBoundsException in TopGroupsResultTransformer.transformToNativeShardDoc after upgrading to 5.5.0</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8940</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;We get an ArrayIndexOutOfBoundsException when searching after upgrading to solr 5.5.&lt;/p&gt;

&lt;p&gt;Here's the query:&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
&lt;span class="code-quote"&gt;"params"&lt;/span&gt;:{
      &lt;span class="code-quote"&gt;"q"&lt;/span&gt;:&lt;span class="code-quote"&gt;"*:*"&lt;/span&gt;,
      &lt;span class="code-quote"&gt;"group.sort"&lt;/span&gt;:&lt;span class="code-quote"&gt;"priceAmount asc,rnd desc"&lt;/span&gt;,
      &lt;span class="code-quote"&gt;"indent"&lt;/span&gt;:&lt;span class="code-quote"&gt;"on"&lt;/span&gt;,
      &lt;span class="code-quote"&gt;"fl"&lt;/span&gt;:&lt;span class="code-quote"&gt;"priceAmount,flightTripId,brand,slob,cabinType,tripDuration"&lt;/span&gt;,
      &lt;span class="code-quote"&gt;"group.limit"&lt;/span&gt;:&lt;span class="code-quote"&gt;"100"&lt;/span&gt;,
      &lt;span class="code-quote"&gt;"fq"&lt;/span&gt;:[&lt;span class="code-quote"&gt;"searchId:e31a0c58-9056-4297-8d70-049017ba4906"&lt;/span&gt;,
        &lt;span class="code-quote"&gt;"doctype:offer"&lt;/span&gt;,
        &lt;span class="code-quote"&gt;"flightTripId:(DY6020421-SK2360519 OR DY6020421-SK2600519 OR DY6020421-SK2620519 OR DY6020421-SK2740519 OR DY6020421-SK2900519 OR DY6020421-SK2860519 OR DY6040421-SK2380519 OR DY6040421-SK2440519 OR DY6040421-SK2480519 OR DY6040421-SK2520519 OR DY6040421-SK2600519 OR DY6040421-SK2620519 OR DY6040421-SK2720519 OR DY6040421-SK2740519 OR DY6040421-SK2800519 OR DY6040421-SK2840519 OR DY6040421-SK2820519 OR DY6060421-SK2480519 OR DY6060421-SK2740519 OR DY6060421-SK2800519 OR DY6060421-SK2840519 OR DY6060421-SK2900519 OR DY6060421-SK2860519 OR DY6060421-SK2820519 OR DY6080421-SK2440519)"&lt;/span&gt;,
        &lt;span class="code-quote"&gt;"maximumLegDuration:[* TO 180]"&lt;/span&gt;,
        &lt;span class="code-quote"&gt;"departureAirportLeg1:(OSL)"&lt;/span&gt;,
        &lt;span class="code-quote"&gt;"(arrivalAirportLeg2:(OSL) OR (* NOT arrivalAirportLeg2:*))"&lt;/span&gt;,
        &lt;span class="code-quote"&gt;"arrivalAirportLeg1:(BGO)"&lt;/span&gt;,
        &lt;span class="code-quote"&gt;"(departureAirportLeg2:(BGO) OR (* NOT departureAirportLeg2:*))"&lt;/span&gt;],
      &lt;span class="code-quote"&gt;"group.ngroups"&lt;/span&gt;:&lt;span class="code-quote"&gt;"&lt;span class="code-keyword"&gt;true&lt;/span&gt;"&lt;/span&gt;,
      &lt;span class="code-quote"&gt;"wt"&lt;/span&gt;:&lt;span class="code-quote"&gt;"json"&lt;/span&gt;,
      &lt;span class="code-quote"&gt;"group.field"&lt;/span&gt;:&lt;span class="code-quote"&gt;"flightTripId"&lt;/span&gt;,
      &lt;span class="code-quote"&gt;"group"&lt;/span&gt;:&lt;span class="code-quote"&gt;"&lt;span class="code-keyword"&gt;true&lt;/span&gt;"&lt;/span&gt;}}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And here's the exception:&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
ERROR [20160404T104846,333] qtp315138752-3037 org.apache.solr.servlet.HttpSolrCall - &lt;span class="code-keyword"&gt;null&lt;/span&gt;:java.lang.ArrayIndexOutOfBoundsException: 1
        at org.apache.solr.search.grouping.distributed.shardresultserializer.TopGroupsResultTransformer.transformToNativeShardDoc(TopGroupsResultTransformer.java:175)
        at org.apache.solr.search.grouping.distributed.shardresultserializer.TopGroupsResultTransformer.transformToNative(TopGroupsResultTransformer.java:137)
        at org.apache.solr.search.grouping.distributed.responseprocessor.TopGroupsShardResponseProcessor.process(TopGroupsShardResponseProcessor.java:129)
        at org.apache.solr.handler.component.QueryComponent.handleGroupedResponses(QueryComponent.java:750)
        at org.apache.solr.handler.component.QueryComponent.handleResponses(QueryComponent.java:733)
        at org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:405)
        at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:155)
        at org.apache.solr.core.SolrCore.execute(SolrCore.java:2082)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The exception is thrown at the last line here:&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
  &lt;span class="code-keyword"&gt;protected&lt;/span&gt; ScoreDoc[] transformToNativeShardDoc(List&amp;lt;NamedList&amp;lt;&lt;span class="code-object"&gt;Object&lt;/span&gt;&amp;gt;&amp;gt; documents, Sort groupSort, &lt;span class="code-object"&gt;String&lt;/span&gt; shard,
                                                 IndexSchema schema) {
    [...]
    &lt;span class="code-keyword"&gt;for&lt;/span&gt; (NamedList&amp;lt;&lt;span class="code-object"&gt;Object&lt;/span&gt;&amp;gt; document : documents) {
      [...]
      &lt;span class="code-object"&gt;Object&lt;/span&gt; sortValuesVal = document.get(&lt;span class="code-quote"&gt;"sortValues"&lt;/span&gt;);
      &lt;span class="code-keyword"&gt;if&lt;/span&gt; (sortValuesVal != &lt;span class="code-keyword"&gt;null&lt;/span&gt;) {
        sortValues = ((List) sortValuesVal).toArray();
        &lt;span class="code-keyword"&gt;for&lt;/span&gt; (&lt;span class="code-object"&gt;int&lt;/span&gt; k = 0; k &amp;lt; sortValues.length; k++) {
          SchemaField field = groupSort.getSort()[k].getField() != &lt;span class="code-keyword"&gt;null&lt;/span&gt;
              ? schema.getFieldOrNull(groupSort.getSort()[k].getField()) : &lt;span class="code-keyword"&gt;null&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It's not obvious to me that &lt;tt&gt;sortValues.length == groupSort.getSort().length&lt;/tt&gt;, but I guess there's some logic behind it &lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/smile.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt;&lt;/p&gt;

&lt;p&gt;I have attached the schema and json result.&lt;/p&gt;

&lt;p&gt;The problem disappears when rolling back to 5.4.0.&lt;/p&gt;</description>
                <environment/>
        <key id="12955745">SOLR-8940</key>
            <summary>ArrayIndexOutOfBoundsException in TopGroupsResultTransformer.transformToNativeShardDoc after upgrading to 5.5.0</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="monti">Henrik</reporter>
                        <labels>
                            <label>5.5</label>
                            <label>arrayindexoutofbounds</label>
                            <label>exception</label>
                            <label>query</label>
                            <label>search</label>
                    </labels>
                <created>Mon, 4 Apr 2016 05:10:27 -0700</created>
                <updated>Mon, 4 Apr 2016 06:23:58 -0700</updated>
                                            <version>5.5</version>
                                    <fixVersion>5.5.1</fixVersion>
                    <fixVersion>6.0</fixVersion>
                    <fixVersion>master</fixVersion>
                                    <component>search</component>
                        <due/>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                        <attachments>
                            <attachment id="12796812" name="schema-types.xml" size="646" author="monti" created="Mon, 4 Apr 2016 05:11:56 -0700"/>
                            <attachment id="12796813" name="schema.xml" size="4703" author="monti" created="Mon, 4 Apr 2016 05:11:56 -0700"/>
                            <attachment id="12796811" name="solr-query-exception.txt" size="4306" author="monti" created="Mon, 4 Apr 2016 05:11:56 -0700"/>
                            <attachment id="12796814" name="solrconfig.xml" size="5356" author="monti" created="Mon, 4 Apr 2016 05:11:56 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2vlcn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>

<item>
            <title>[SOLR-8924] RollupStream breaks with null values in the group by buckets</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8924</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Currently the RollupStream throws an NPE when there are null values in the rollup up buckets. This effects the SQL group by queries in map_reduce mode.&lt;/p&gt;</description>
                <environment/>
        <key id="12954835">SOLR-8924</key>
            <summary>RollupStream breaks with null values in the group by buckets</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="joel.bernstein">Joel Bernstein</reporter>
                        <labels>
                    </labels>
                <created>Wed, 30 Mar 2016 19:18:48 -0700</created>
                <updated>Thu, 31 Mar 2016 09:07:14 -0700</updated>
                            <resolved>Thu, 31 Mar 2016 09:07:14 -0700</resolved>
                                                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="15220043" author="joel.bernstein" created="Thu, 31 Mar 2016 08:32:14 -0700">&lt;p&gt;Patch with simple fix. I'll be committing shortly and back porting to 6.0&lt;/p&gt;</comment>
                            <comment id="15220059" author="jira-bot" created="Thu, 31 Mar 2016 08:43:30 -0700">&lt;p&gt;Commit 0b2040d61c1e351200d053783416a28fce757a16 in lucene-solr's branch refs/heads/master from jbernste&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=0b2040d" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=0b2040d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8924" title="RollupStream breaks with null values in the group by buckets" class="issue-link" data-issue-key="SOLR-8924"&gt;&lt;del&gt;SOLR-8924&lt;/del&gt;&lt;/a&gt;: RollupStream breaks with null values in the group by buckets&lt;/p&gt;</comment>
                            <comment id="15220087" author="jira-bot" created="Thu, 31 Mar 2016 08:59:23 -0700">&lt;p&gt;Commit 74b5a7a9722523980630211d416883d76b804f90 in lucene-solr's branch refs/heads/branch_6x from jbernste&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=74b5a7a" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=74b5a7a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8924" title="RollupStream breaks with null values in the group by buckets" class="issue-link" data-issue-key="SOLR-8924"&gt;&lt;del&gt;SOLR-8924&lt;/del&gt;&lt;/a&gt;: RollupStream breaks with null values in the group by buckets&lt;/p&gt;</comment>
                            <comment id="15220098" author="jira-bot" created="Thu, 31 Mar 2016 09:06:55 -0700">&lt;p&gt;Commit 114d855c11714e36470dcaa40c21e93450dab659 in lucene-solr's branch refs/heads/branch_6_0 from jbernste&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=114d855" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=114d855&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8924" title="RollupStream breaks with null values in the group by buckets" class="issue-link" data-issue-key="SOLR-8924"&gt;&lt;del&gt;SOLR-8924&lt;/del&gt;&lt;/a&gt;: RollupStream breaks with null values in the group by buckets&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12796325" name="SOLR-8924.patch" size="3893" author="joel.bernstein" created="Thu, 31 Mar 2016 08:32:14 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 31 Mar 2016 15:43:30 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2vfqn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8904] Switch from SimpleDateFormat to Java 8 DateTimeFormatter.ISO_INSTANT</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8904</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;I'd like to move Solr away from SimpleDateFormat to Java 8's java.time.formatter.DateTimeFormatter API, particularly using simply ISO_INSTANT without any custom rules.  This especially involves our DateFormatUtil class in Solr core, but also involves DateUtil (I filed &lt;a href="https://issues.apache.org/jira/browse/SOLR-8903" title="Move SolrJ DateUtil to Extraction module as ExtractionDateUtil" class="issue-link" data-issue-key="SOLR-8903"&gt;&lt;del&gt;SOLR-8903&lt;/del&gt;&lt;/a&gt; to deal with additional delete/move/deprecations for that one).&lt;/p&gt;

&lt;p&gt;In particular, there's &lt;tt&gt;new Date(Instant.parse(d).toEpochMilli())&lt;/tt&gt; for parsing and &lt;tt&gt;DateTimeFormatter.ISO_INSTANT.format(d.toInstant())&lt;/tt&gt; for formatting.  Simple &amp;amp; thread-safe!&lt;/p&gt;

&lt;p&gt;I want to simply cut over completely without having special custom rules.  There are differences in how ISO_INSTANT does things:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Formatting: Milliseconds are 0 padded to 3 digits if the milliseconds is non-zero.  Thus 30 milliseconds will have ".030" added on.  Our current formatting code emits ".03".&lt;/li&gt;
	&lt;li&gt;Dates with years after '9999' (i.e. 10000 and beyond, &amp;gt;= 5 digit years):  ISO_INSTANT strictly demands a leading '&amp;#43;' &amp;#8211; it is formatted with a "&amp;#43;" and if such a year is parsed it &lt;b&gt;must&lt;/b&gt; have a "&amp;#43;" or there is an exception.  SimpleDateFormatter requires the opposite &amp;#8211; no '+' and and if you tried to give it one, it would throw an exception.&lt;/li&gt;
	&lt;li&gt;Currently we don't support negative years (resulting in invisible errors mostly!).  ISO_INSTANT supports this!&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;In addition, DateFormatUtil.parseDate currently allows the trailing 'Z' to be optional, but the only caller that could exploit this is the analytics module.  I'd like to remove the optional-ness of 'Z' and inline this method away to &lt;tt&gt;new Date(Instant.parse(d).toEpochMilli())&lt;/tt&gt;.&lt;/p&gt;</description>
                <environment/>
        <key id="12953493">SOLR-8904</key>
            <summary>Switch from SimpleDateFormat to Java 8 DateTimeFormatter.ISO_INSTANT</summary>
                <type id="3" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/task.png">Task</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dsmiley">David Smiley</assignee>
                                    <reporter username="dsmiley">David Smiley</reporter>
                        <labels>
                    </labels>
                <created>Thu, 24 Mar 2016 21:13:31 -0700</created>
                <updated>Wed, 30 Mar 2016 11:59:04 -0700</updated>
                            <resolved>Wed, 30 Mar 2016 11:59:04 -0700</resolved>
                                                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="15211521" author="dsmiley" created="Fri, 25 Mar 2016 00:05:10 -0700">&lt;p&gt;Another apparent difference is that Solr currently accepts &lt;tt&gt;"1976-07-21T00:07:67.890Z"&lt;/tt&gt;  (notice 67 seconds!) whereas ISO_INSTANT is quite strict; it does not.  I found this weird date in SimpleFacetsTest, without any comment to it's oddity.&lt;/p&gt;

&lt;p&gt;I'm working on a patch.  In this patch, I removed DateFormatUtils and moved parseMath to DateMathParser.  parseDate &amp;amp; formatDateExternal were one-liners of standard JDK calls so I felt no need for it.  It'll make the patch bigger to digest though.&lt;/p&gt;</comment>
                            <comment id="15211769" author="dsmiley" created="Fri, 25 Mar 2016 05:42:56 -0700">&lt;p&gt;Another apparent distance is that Solr currently accepts &lt;tt&gt;2012-1-01T12:30:00Z&lt;/tt&gt;  (notice single digit month without padding), seen from a literal string in DistributedFacetPivotLargeTest&lt;/p&gt;</comment>
                            <comment id="15211782" author="yseeley@gmail.com" created="Fri, 25 Mar 2016 06:05:24 -0700">&lt;blockquote&gt;&lt;p&gt;1976-07-21T00:07:67.890Z" (notice 67 seconds!)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Must have been unintended (notice that 67890 digits are all in a row... something one would type in randomly as a test number).  And it's in a facets test no less!&lt;/p&gt;

&lt;p&gt;Any idea if there are significant performance differences?&lt;/p&gt;</comment>
                            <comment id="15211932" author="dsmiley" created="Fri, 25 Mar 2016 08:20:32 -0700">&lt;p&gt;FYI Instant is the new replacement for Date in Java 8.  This patch is just about switching the parsing/formatting though; not to stop using Date.  Instant.toString() uses DateTimeFormatter.ISO_INSTANT, so you can be pretty concise when formatting if you want to.  Here's a code snippet (which I modified a test for) to build a formatted date string to send to Solr for a test specified variable number of minutes: &lt;tt&gt;ZonedDateTime.of(2016, 1, 1, 0, MM, 0, 0, ZoneOffset.UTC).toInstant().toString()&lt;/tt&gt; (MM was a variable in a test method)&lt;/p&gt;

&lt;p&gt;In case anyone reading this missed my warning of these changes to the dev list, I did so: &lt;a href="http://mail-archives.apache.org/mod_mbox/lucene-dev/201603.mbox/%3cCABEwPvGyqu=uDq8ULVAM1t_VX2Qg3++MOsDCYb7rcY5N=XMf4A@mail.gmail.com%3e" class="external-link" rel="nofollow"&gt;http://mail-archives.apache.org/mod_mbox/lucene-dev/201603.mbox/%3cCABEwPvGyqu=uDq8ULVAM1t_VX2Qg3++MOsDCYb7rcY5N=XMf4A@mail.gmail.com%3e&lt;/a&gt;&lt;br/&gt;
No responses yet so I assume no issue with making a backwards incompatible change like this for 6.0.&lt;/p&gt;

&lt;p&gt;My tentative CHANGES.txt entry will be, this, under "Upgrading from Solr 5.x":&lt;/p&gt;
&lt;div class="preformatted panel" style="border-width: 1px;"&gt;&lt;div class="preformattedContent panelContent"&gt;
&lt;pre&gt; * Date-time parsing has been made more strict (based on Java 8 java.time.DateTimeFormatter.ISO_INSTANT),
but also now supports negative years.  AD years with &amp;gt;= 5 digits must have a leading '+' (formerly unsupported).
BC years must have a '-' (formerly unsupported).  All parts of the format must be padded with zeros to the left 
(e.g. "01" for January, never "1").  All parts must be within valid maximum boundaries (e.g. 67 seconds is now
 invalid).  Formatted times from Solr now have the milliseconds 3-digit padded if non-zero.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;And I'll add an entry below under "Other Changes", more succinct.&lt;/p&gt;

&lt;p&gt;Still running tests...&lt;/p&gt;</comment>
                            <comment id="15212112" author="steve_rowe" created="Fri, 25 Mar 2016 10:21:42 -0700">&lt;p&gt;FYI, I used the new Java8 API to do random date generation in &lt;tt&gt;TestUseDocValuesAsStored&lt;/tt&gt; as part of &lt;a href="https://issues.apache.org/jira/browse/SOLR-8838" title="Returning non-stored docValues is incorrect for floats and doubles" class="issue-link" data-issue-key="SOLR-8838"&gt;&lt;del&gt;SOLR-8838&lt;/del&gt;&lt;/a&gt;: &lt;a href="https://github.com/apache/lucene-solr/blob/master/solr/core/src/test/org/apache/solr/schema/TestUseDocValuesAsStored.java#L217-L222" class="external-link" rel="nofollow"&gt;https://github.com/apache/lucene-solr/blob/master/solr/core/src/test/org/apache/solr/schema/TestUseDocValuesAsStored.java#L217-L222&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15212119" author="dsmiley" created="Fri, 25 Mar 2016 10:26:54 -0700">&lt;p&gt;Yup I noticed it &lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/smile.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt;  In my match (coming &lt;em&gt;real soon now&lt;/em&gt;) I changed those couple lines of code to this more succinct version:&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;          values[i] = DateTimeFormatter.ISO_INSTANT.format(Instant.ofEpochMilli(epochMillis));&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;when you have the epochMillis, it's that simple.  No need to use anything more complex.  I could have even done:&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;           values[i] = Instant.ofEpochMilli(epochMillis).toString(); &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/smile.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt;&lt;/p&gt;</comment>
                            <comment id="15212130" author="steve_rowe" created="Fri, 25 Mar 2016 10:32:12 -0700">&lt;p&gt;Don't remember the details, but I think I had to use &lt;tt&gt;DateTimeFormatter.ISO_LOCAL_DATE_TIME&lt;/tt&gt; instead of ISO_INSTANT, something to do with millisecond roundtripping.&lt;/p&gt;</comment>
                            <comment id="15212202" author="dsmiley" created="Fri, 25 Mar 2016 11:22:03 -0700">&lt;p&gt;Here's the patch.  Instead of referencing DateTimeFormatter in a bunch of places, I opted for the even more concise Instant.toString().  So DTF is only used in maybe a couple places.  DateFormatUtil is gone.&lt;/p&gt;

&lt;p&gt;This patch also weens &lt;em&gt;some&lt;/em&gt; callers of DateUtil to Instant.toString so long as that format was what was required based on the code.  But DateUtil itself and some of its callers is being left to &lt;a href="https://issues.apache.org/jira/browse/SOLR-8903" title="Move SolrJ DateUtil to Extraction module as ExtractionDateUtil" class="issue-link" data-issue-key="SOLR-8903"&gt;&lt;del&gt;SOLR-8903&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I'm running tests yet again.  I had also run precommit.&lt;/p&gt;</comment>
                            <comment id="15212204" author="dsmiley" created="Fri, 25 Mar 2016 11:24:16 -0700">&lt;p&gt;Hmm; ok I'll watch out for that.  As it was I had to change it since &lt;tt&gt;dateTime.format(DateTimeFormatter.ISO_LOCAL_DATE_TIME) + 'Z'&lt;/tt&gt; truncated right 0 padded milliseconds (if I recall) whereas DateTimeFormatter.ISO_INSTANT does not unless it's entirely 0.&lt;/p&gt;</comment>
                            <comment id="15215956" author="dsmiley" created="Tue, 29 Mar 2016 05:45:26 -0700">&lt;p&gt;This new patch adds parsing leniency in accordance with the &lt;a href="https://en.wikipedia.org/wiki/Robustness_principle" class="external-link" rel="nofollow"&gt;Robustness Principle&lt;/a&gt; &amp;#8211; "Be conservative in what you send, be liberal in what you accept".  In the dev list I mentioned making this leniency settable via a System property but I am not making it toggle-able here.  Perhaps it could be added later or we can let it be this way forever.&lt;/p&gt;

&lt;p&gt;Patch summary:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;DateMathParser.parseMath&lt;/tt&gt; now parses the date literal part using a new method, &lt;tt&gt;parseNoMath()&lt;/tt&gt; that uses a static instance of DTF created like this: {{new DateTimeFormatterBuilder().&lt;br/&gt;
    .parseCaseInsensitive().parseLenient().appendInstant().toFormatter(Locale.ROOT)}}.  
	&lt;ul&gt;
		&lt;li&gt;I have this method private because, in general, Solr should be parsing with "date math" from user input.  When it's from Solr (e.g. SolrJ parsing dates), it can use &lt;tt&gt;Integer.parse&lt;/tt&gt; which is strict. Solr is strict about formatting output.&lt;/li&gt;
		&lt;li&gt;parsing leniency is now explicitly tested.  A leading "+" is always optional no matter how many digits are in the year.  And numbers need not have leading 0 pads. However it's an error to have values out of bounds (e.g. &amp;gt;= 60 secs).&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;I changed &lt;tt&gt;ValueSourceAugmenter&lt;/tt&gt; to call &lt;tt&gt;DateMathParser.parseMath&lt;/tt&gt;  (instead of without).&lt;/li&gt;
	&lt;li&gt;I changed all 3 spots in the analytics contrib module that parse dates to parse with math (instead of without).&lt;/li&gt;
	&lt;li&gt;I moved most testing in &lt;tt&gt;DateFieldTest&lt;/tt&gt; into &lt;tt&gt;DateMathParserTest&lt;/tt&gt;, doing a bit of consolidating/refactoring along the way.  The only test that remains is testing createField.  I made that test a bit more clear that TrieDateField parses with date math.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;New suggested CHANGES.txt:&lt;/p&gt;
&lt;div class="preformatted panel" style="border-width: 1px;"&gt;&lt;div class="preformattedContent panelContent"&gt;
&lt;pre&gt; * Formatted date-times from Solr have some differences.  If the year is more
than 4 digits, there is a leading '+'.  When there is a non-zero number of 
milliseconds, it is padded with zeros to 3 digits.  Negative year (BC) dates are
now possible.  It is now an error to supply a portion of the date out 
of its, range, like 67 seconds.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I think this is ready.&lt;/p&gt;</comment>
                            <comment id="15215965" author="dsmiley" created="Tue, 29 Mar 2016 05:52:03 -0700">&lt;p&gt;Sorry; this patch now has 2 changes that were in my changelist for &lt;a href="https://issues.apache.org/jira/browse/SOLR-8903" title="Move SolrJ DateUtil to Extraction module as ExtractionDateUtil" class="issue-link" data-issue-key="SOLR-8903"&gt;&lt;del&gt;SOLR-8903&lt;/del&gt;&lt;/a&gt; that better belong here.  ValueSourceAugmenter &lt;tt&gt;[value]&lt;/tt&gt;, and ValueSourceParser &lt;tt&gt;ms()&lt;/tt&gt;.  That makes hits patch stand-alone.&lt;/p&gt;</comment>
                            <comment id="15218207" author="steve_rowe" created="Wed, 30 Mar 2016 08:58:28 -0700">&lt;p&gt;+1, lots of nice simplification.  I like how in TestUseDocValuesAsStored you expanded the random date range to include negative dates and dates much farther into the future.&lt;/p&gt;

&lt;p&gt;All Solr tests passed for me.&lt;/p&gt;

&lt;p&gt;Two nits:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;In DateMathParser.parseMath() you carried over from DateMathUtil the obsolete commented out code &lt;tt&gt;p.setNow(toObject(val.substring(0,zz)));&lt;/tt&gt; - I think it should be removed.&lt;/li&gt;
	&lt;li&gt;DateFieldTest has unused imports&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;In DateMathParser.parseNoMath() you have a TODO to make a Date-returning temporal query - here's an (untested) one (probably should not hold up this issue though):&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
  /** Temporal query to convert from TemporalAccessor to Date. */
  &lt;span class="code-keyword"&gt;private&lt;/span&gt; &lt;span class="code-keyword"&gt;static&lt;/span&gt; Date temporalToDate(TemporalAccessor temporal) {
    &lt;span class="code-object"&gt;long&lt;/span&gt; seconds = temporal.getLong(INSTANT_SECONDS);
    &lt;span class="code-object"&gt;int&lt;/span&gt; nanos = temporal.get(NANO_OF_SECOND);
    &lt;span class="code-keyword"&gt;if&lt;/span&gt; (seconds &amp;lt; 0 &amp;amp;&amp;amp; nanos &amp;gt; 0) {  &lt;span class="code-comment"&gt;// from Instant.toEpochMilli()
&lt;/span&gt;      &lt;span class="code-object"&gt;long&lt;/span&gt; millis = &lt;span class="code-object"&gt;Math&lt;/span&gt;.multiplyExact(seconds + 1, 1_000);  &lt;span class="code-comment"&gt;// millis is now &amp;lt;= 0
&lt;/span&gt;      &lt;span class="code-object"&gt;long&lt;/span&gt; adjustment = nanos / 1_000_000 - 1_000;           &lt;span class="code-comment"&gt;// adjustment is now negative
&lt;/span&gt;      &lt;span class="code-keyword"&gt;return&lt;/span&gt; &lt;span class="code-keyword"&gt;new&lt;/span&gt; Date(&lt;span class="code-object"&gt;Math&lt;/span&gt;.addExact(millis, adjustment));
    } &lt;span class="code-keyword"&gt;else&lt;/span&gt; {
      &lt;span class="code-object"&gt;long&lt;/span&gt; millis = &lt;span class="code-object"&gt;Math&lt;/span&gt;.multiplyExact(seconds, 1_000);
      &lt;span class="code-keyword"&gt;return&lt;/span&gt; &lt;span class="code-keyword"&gt;new&lt;/span&gt; Date(&lt;span class="code-object"&gt;Math&lt;/span&gt;.addExact(millis, nanos / 1_000_000));
    }
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15218221" author="dsmiley" created="Wed, 30 Mar 2016 09:08:25 -0700">&lt;p&gt;I'm glad you like the simplifications; that was definitely part of this.  The 2 nits are small enough that I'll just go commit with them done now.&lt;/p&gt;

&lt;p&gt;Thanks for that code snippet.  As I was working on the code, I resisted taking this step because it would also require some tests, and could conceivably be combined in another issue with optimizations to avoid creating an instance of DateMathParser when there is no math to parse.&lt;/p&gt;

&lt;p&gt;As an aside, I have no idea how much faster (or slower?) date formatting and parsing is.  I suspect faster given no need to worry about thread-safety.&lt;/p&gt;</comment>
                            <comment id="15218424" author="jira-bot" created="Wed, 30 Mar 2016 10:43:24 -0700">&lt;p&gt;Commit 94c04237cce44cac1e40e1b8b6ee6a6addc001a5 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley" class="user-hover" rel="dsmiley"&gt;David Smiley&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=94c0423" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=94c0423&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8904" title="Switch from SimpleDateFormat to Java 8 DateTimeFormatter.ISO_INSTANT" class="issue-link" data-issue-key="SOLR-8904"&gt;&lt;del&gt;SOLR-8904&lt;/del&gt;&lt;/a&gt;: switch from SimpleDateFormat to Instant.parse and format.&lt;br/&gt;
&lt;span class="error"&gt;&amp;#91;value&amp;#93;&lt;/span&gt; and ms() and contrib/analytics now call DateMathParser to parse.  DateFormatUtil is now removed.&lt;/p&gt;</comment>
                            <comment id="15218565" author="jira-bot" created="Wed, 30 Mar 2016 11:43:15 -0700">&lt;p&gt;Commit 72f5eac2c5e7fb743f166fb3c1b25e73078ebdbe in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley" class="user-hover" rel="dsmiley"&gt;David Smiley&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=72f5eac" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=72f5eac&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8904" title="Switch from SimpleDateFormat to Java 8 DateTimeFormatter.ISO_INSTANT" class="issue-link" data-issue-key="SOLR-8904"&gt;&lt;del&gt;SOLR-8904&lt;/del&gt;&lt;/a&gt;: switch from SimpleDateFormat to Instant.parse and format.&lt;br/&gt;
&lt;span class="error"&gt;&amp;#91;value&amp;#93;&lt;/span&gt; and ms() and contrib/analytics now call DateMathParser to parse.  DateFormatUtil is now removed.&lt;br/&gt;
(cherry picked from commit 94c0423) (cherry picked from commit 39932f5)&lt;/p&gt;</comment>
                            <comment id="15218575" author="jira-bot" created="Wed, 30 Mar 2016 11:48:05 -0700">&lt;p&gt;Commit a47a0baa829ee18b30cc391a229b96d85c865ea0 in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley" class="user-hover" rel="dsmiley"&gt;David Smiley&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=a47a0ba" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=a47a0ba&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8904" title="Switch from SimpleDateFormat to Java 8 DateTimeFormatter.ISO_INSTANT" class="issue-link" data-issue-key="SOLR-8904"&gt;&lt;del&gt;SOLR-8904&lt;/del&gt;&lt;/a&gt;: switch from SimpleDateFormat to Instant.parse and format.&lt;br/&gt;
&lt;span class="error"&gt;&amp;#91;value&amp;#93;&lt;/span&gt; and ms() and contrib/analytics now call DateMathParser to parse.  DateFormatUtil is now removed.&lt;br/&gt;
(cherry picked from commit 72f5eac)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12953481">SOLR-8903</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310051">
                    <name>Supercedes</name>
                                            <outwardlinks description="supercedes">
                                        <issuelink>
            <issuekey id="12463472">SOLR-1899</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12795835" name="SOLR_8904.patch" size="101952" author="dsmiley" created="Tue, 29 Mar 2016 05:52:03 -0700"/>
                            <attachment id="12795832" name="SOLR_8904.patch" size="99095" author="dsmiley" created="Tue, 29 Mar 2016 05:45:26 -0700"/>
                            <attachment id="12795443" name="SOLR_8904_switch_from_SimpleDateFormat_to_Instant_parse_and_format.patch" size="94378" author="dsmiley" created="Fri, 25 Mar 2016 11:22:03 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 25 Mar 2016 13:05:24 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2v7gn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8903] Move SolrJ DateUtil to Extraction module as ExtractionDateUtil</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8903</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;SolrJ doesn't need a DateUtil class, particularly since we're on Java 8 and can simply use &lt;tt&gt;new Date(Instant.parse(d).toEpochMilli());&lt;/tt&gt; for parsing and &lt;tt&gt;DateTimeFormatter.ISO_INSTANT.format(d.toInstant())&lt;/tt&gt; for formatting.  Yes, they are threadsafe.  I propose that we deprecate DateUtil from SolrJ, or perhaps outright remove it from SolrJ for Solr 6.  The only SolrJ calls into this class are to essentially use it to format or parse in the ISO standard format.&lt;/p&gt;

&lt;p&gt;I also think we should move it to the "extraction" (SolrCell) module and name it something like ExtractionDateUtil.  See, this class has a parse method taking a list of formats, and there's a static list of them taken from HttpClient's DateUtil.  DateUtil's original commit was &lt;a href="https://issues.apache.org/jira/browse/SOLR-284" title="Parsing Rich Document Types" class="issue-link" data-issue-key="SOLR-284"&gt;&lt;del&gt;SOLR-284&lt;/del&gt;&lt;/a&gt; to be used by SolrCell, and SolrCell wants this feature.  So I think it should move there.&lt;/p&gt;

&lt;p&gt;There are a few other uses:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Morphlines uses it, but morphlines depends on the extraction module so it could just as well access it if we move it there.&lt;/li&gt;
	&lt;li&gt;The ValueAugmenterFactory (a doc transformer).  I really doubt whoever added it realized that DateUtil.parseDate would try a bunch of formats instead of only supporting the ISO canonical format.  So I think we should just remove this reference.&lt;/li&gt;
	&lt;li&gt;DateFormatUtil.parseMathLenient falls back on this, and this method is in turn called by just one caller &amp;#8211; DateValueSourceParser, registered as &lt;tt&gt;ms&lt;/tt&gt;.  I don't think we need leniency in use of this function query; values given to ms should be computer generated in the ISO format.&lt;/li&gt;
&lt;/ul&gt;


&lt;hr /&gt;
&lt;p&gt;edit: added ms().&lt;/p&gt;</description>
                <environment/>
        <key id="12953481">SOLR-8903</key>
            <summary>Move SolrJ DateUtil to Extraction module as ExtractionDateUtil</summary>
                <type id="3" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/task.png">Task</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dsmiley">David Smiley</assignee>
                                    <reporter username="dsmiley">David Smiley</reporter>
                        <labels>
                    </labels>
                <created>Thu, 24 Mar 2016 19:38:45 -0700</created>
                <updated>Wed, 30 Mar 2016 12:24:13 -0700</updated>
                            <resolved>Wed, 30 Mar 2016 12:24:13 -0700</resolved>
                                                    <fixVersion>6.0</fixVersion>
                                    <component>SolrJ</component>
                        <due/>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="15212219" author="dsmiley" created="Fri, 25 Mar 2016 11:35:56 -0700">&lt;p&gt;The attached patch shows some small changes to DateUtil itself, and a few callers (for &lt;tt&gt;ms()&lt;/tt&gt; and &lt;tt&gt;[value]&lt;/tt&gt;).  This patch shows it as deprecated but what I'd really like to do is move it to extraction module as ExtractingDateUtil (rename test similarly) and then simply outright remove the deprecated stuff.  But it's in SolrJ... yet this is a major release and this utility isn't very front &amp;amp; center.  Any opinions?  If I get none I will go with my preference of removing it from SolrJ.&lt;/p&gt;

&lt;p&gt;Note: the changes in &lt;a href="https://issues.apache.org/jira/browse/SOLR-8904" title="Switch from SimpleDateFormat to Java 8 DateTimeFormatter.ISO_INSTANT" class="issue-link" data-issue-key="SOLR-8904"&gt;&lt;del&gt;SOLR-8904&lt;/del&gt;&lt;/a&gt; result in DateUtil not being called from SolrJ any more.  So this patch is somewhat dependent on that one.&lt;/p&gt;</comment>
                            <comment id="15215998" author="dsmiley" created="Tue, 29 Mar 2016 06:31:15 -0700">&lt;p&gt;Updated patch which moves DateUtil to the extraction module as ExtractionDateUtil.  It depends on &lt;a href="https://issues.apache.org/jira/browse/SOLR-8904" title="Switch from SimpleDateFormat to Java 8 DateTimeFormatter.ISO_INSTANT" class="issue-link" data-issue-key="SOLR-8904"&gt;&lt;del&gt;SOLR-8904&lt;/del&gt;&lt;/a&gt; in that some call sites into DateUtil are updated in that patch, not this one now.  DateMathParser is not referred to at all.  I also added some tests, ported from DateMathParserTest.&lt;/p&gt;

&lt;p&gt;Suggested CHANGES.txt:&lt;/p&gt;
&lt;div class="preformatted panel" style="border-width: 1px;"&gt;&lt;div class="preformattedContent panelContent"&gt;
&lt;pre&gt;(in upgrading)
* SolrJ no longer includes DateUtil.  If for some reason you need to format or parse dates, simply use Instant.format() and Instant.parse().

(in other)
* SOLR-8904: DateUtil in SolrJ moved to the extraction contrib as ExtractionDateUtil.  Obsolete methods were removed.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15218327" author="steve_rowe" created="Wed, 30 Mar 2016 10:06:13 -0700">&lt;p&gt;+1, LGTM&lt;/p&gt;

&lt;p&gt;FYI I had to apply the patch using IntelliJ - &lt;tt&gt;git apply&lt;/tt&gt; (git v2.7.4) doesn't grok the file rename/move syntax that is used in this IntelliJ-produced patch - here's the errors I got:&lt;/p&gt;

&lt;div class="preformatted panel" style="border-width: 1px;"&gt;&lt;div class="preformattedContent panelContent"&gt;
&lt;pre&gt;error: solr/contrib/extraction/src/test/org/apache/solr/handler/extraction/TestExtractionDateUtil.java: No such file or directory
error: solr/contrib/extraction/src/java/org/apache/solr/handler/extraction/ExtractionDateUtil.java: No such file or directory
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Also, this patch (and the &lt;a href="https://issues.apache.org/jira/browse/SOLR-8904" title="Switch from SimpleDateFormat to Java 8 DateTimeFormatter.ISO_INSTANT" class="issue-link" data-issue-key="SOLR-8904"&gt;&lt;del&gt;SOLR-8904&lt;/del&gt;&lt;/a&gt; patch) don't apply at the top-level of the project - I had to run &lt;tt&gt;git apply&lt;/tt&gt; under &lt;tt&gt;solr/&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="15218626" author="jira-bot" created="Wed, 30 Mar 2016 12:08:25 -0700">&lt;p&gt;Commit 44e0ac38567e19465ebf74a160064b8a642ec6b6 in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley" class="user-hover" rel="dsmiley"&gt;David Smiley&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=44e0ac3" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=44e0ac3&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8903" title="Move SolrJ DateUtil to Extraction module as ExtractionDateUtil" class="issue-link" data-issue-key="SOLR-8903"&gt;&lt;del&gt;SOLR-8903&lt;/del&gt;&lt;/a&gt;: Move SolrJ DateUtil to contrib/extraction as ExtractionDateUtil.&lt;br/&gt;
And removed obsolete methods.&lt;br/&gt;
(cherry picked from commit 5e5fd66)&lt;/p&gt;</comment>
                            <comment id="15218630" author="jira-bot" created="Wed, 30 Mar 2016 12:10:01 -0700">&lt;p&gt;Commit 479f0e06343df51a8076dca386cc902f85c3c8fc in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley" class="user-hover" rel="dsmiley"&gt;David Smiley&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=479f0e0" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=479f0e0&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8903" title="Move SolrJ DateUtil to Extraction module as ExtractionDateUtil" class="issue-link" data-issue-key="SOLR-8903"&gt;&lt;del&gt;SOLR-8903&lt;/del&gt;&lt;/a&gt;: Move SolrJ DateUtil to contrib/extraction as ExtractionDateUtil.&lt;br/&gt;
And removed obsolete methods.&lt;br/&gt;
(cherry picked from commit 44e0ac3)&lt;/p&gt;</comment>
                            <comment id="15218652" author="dsmiley" created="Wed, 30 Mar 2016 12:24:13 -0700">&lt;p&gt;Thanks for the review Steve!  Maybe I should start generating patches from the command line.  FWIW looking at the patch I do see the leading &lt;tt&gt;solr/&lt;/tt&gt; but I know many patches I've seen out there have some sort of nominal a/ or b/ or something like that in front.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12953493">SOLR-8904</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12795842" name="SOLR_8903.patch" size="14848" author="dsmiley" created="Tue, 29 Mar 2016 06:31:15 -0700"/>
                            <attachment id="12795446" name="SOLR_8903_DateUtil_deprecate.patch" size="9379" author="dsmiley" created="Fri, 25 Mar 2016 11:35:56 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 30 Mar 2016 17:06:13 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2v7dz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8891] StrField issues with docValues</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8891</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;ul class="alternate" type="square"&gt;
	&lt;li&gt;StrField.toObject and toExternal don't work with docValue IndexableField instances&lt;/li&gt;
	&lt;li&gt;StrField.createFields needlessly adds nulls to the list of returned IndexableFields (not strictly a bug, but not needed), and creates an arraylist that is bigger than needed.&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment/>
        <key id="12953045">SOLR-8891</key>
            <summary>StrField issues with docValues</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yseeley@gmail.com">Yonik Seeley</assignee>
                                    <reporter username="yseeley@gmail.com">Yonik Seeley</reporter>
                        <labels>
                    </labels>
                <created>Wed, 23 Mar 2016 17:21:52 -0700</created>
                <updated>Wed, 27 Apr 2016 16:58:36 -0700</updated>
                            <resolved>Wed, 23 Mar 2016 17:45:44 -0700</resolved>
                                                    <fixVersion>5.5.1</fixVersion>
                    <fixVersion>5.6</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="15214666" author="hossman" created="Mon, 28 Mar 2016 11:48:58 -0700">&lt;p&gt;Yoniks commits where missing the jira citation so they didn't automatically get linked here...&lt;/p&gt;

&lt;p&gt;&lt;a href="http://git-wip-us.apache.org/repos/asf/lucene-solr/commit/e136d108" class="external-link" rel="nofollow"&gt;http://git-wip-us.apache.org/repos/asf/lucene-solr/commit/e136d108&lt;/a&gt;&lt;br/&gt;
&lt;a href="http://git-wip-us.apache.org/repos/asf/lucene-solr/commit/b978666d" class="external-link" rel="nofollow"&gt;http://git-wip-us.apache.org/repos/asf/lucene-solr/commit/b978666d&lt;/a&gt;&lt;br/&gt;
&lt;a href="http://git-wip-us.apache.org/repos/asf/lucene-solr/commit/e2f0aae5" class="external-link" rel="nofollow"&gt;http://git-wip-us.apache.org/repos/asf/lucene-solr/commit/e2f0aae5&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;(edited: this type paste in the &lt;em&gt;actual&lt;/em&gt; commits)&lt;/p&gt;</comment>
                            <comment id="15261223" author="jira-bot" created="Wed, 27 Apr 2016 16:47:26 -0700">&lt;p&gt;Commit da961396de915e877651923ccea0271ceacd420d in lucene-solr's branch refs/heads/branch_5x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org" class="user-hover" rel="yonik@apache.org"&gt;Yonik Seeley&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=da96139" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=da96139&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8891" title="StrField issues with docValues" class="issue-link" data-issue-key="SOLR-8891"&gt;&lt;del&gt;SOLR-8891&lt;/del&gt;&lt;/a&gt;: Fix StrField.toObject and toExternal to work with docValue IndexableField instances, optimize createFields&lt;/p&gt;</comment>
                            <comment id="15261237" author="jira-bot" created="Wed, 27 Apr 2016 16:55:49 -0700">&lt;p&gt;Commit 9bf0bb96e36e03065252779fa12229cc444ef0ca in lucene-solr's branch refs/heads/branch_5_5 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org" class="user-hover" rel="yonik@apache.org"&gt;Yonik Seeley&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9bf0bb9" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9bf0bb9&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8891" title="StrField issues with docValues" class="issue-link" data-issue-key="SOLR-8891"&gt;&lt;del&gt;SOLR-8891&lt;/del&gt;&lt;/a&gt;: Fix StrField.toObject and toExternal to work with docValue IndexableField instances, optimize createFields&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12795114" name="SOLR-8891.patch" size="3122" author="yseeley@gmail.com" created="Wed, 23 Mar 2016 17:23:43 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 28 Mar 2016 18:48:58 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 week, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2v4p3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8886] TrieField.toObject(IndexableField) can't handle docValues</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8886</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;multiValued docValues numeric fields currently use SortedSet for some reason, but toObject throws an exception in that case.&lt;/p&gt;</description>
                <environment/>
        <key id="12952667">SOLR-8886</key>
            <summary>TrieField.toObject(IndexableField) can't handle docValues</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yseeley@gmail.com">Yonik Seeley</assignee>
                                    <reporter username="yseeley@gmail.com">Yonik Seeley</reporter>
                        <labels>
                    </labels>
                <created>Tue, 22 Mar 2016 19:24:08 -0700</created>
                <updated>Wed, 27 Apr 2016 15:29:37 -0700</updated>
                            <resolved>Wed, 27 Apr 2016 12:46:56 -0700</resolved>
                                                    <fixVersion>5.5.1</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="15208444" author="dsmiley" created="Wed, 23 Mar 2016 07:08:27 -0700">&lt;blockquote&gt;&lt;p&gt;multiValued docValues numeric fields currently use SortedSet for some reason&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I recall it's because the numeric docValues came after SortedSet &amp;#8211; SortedSet came first.  So there would be a back-compat issue in simply switching to numeric docValues, and so that hasn't happened yet.  See &lt;a href="https://issues.apache.org/jira/browse/SOLR-7878" title="Use SortedNumericDocValues (efficient sort &amp;amp; facet on multi-valued numeric fields)" class="issue-link" data-issue-key="SOLR-7878"&gt;SOLR-7878&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15208462" author="yseeley@gmail.com" created="Wed, 23 Mar 2016 07:18:27 -0700">&lt;p&gt;Actually, it turned out that the IndexableField for single-valued docValues numeric was also incorrect (the long bits were not turned back into the correct type).&lt;/p&gt;

&lt;p&gt;Patch attached.&lt;/p&gt;</comment>
                            <comment id="15208486" author="dsmiley" created="Wed, 23 Mar 2016 07:26:34 -0700">&lt;p&gt;There's no test in the patch.  Is there an existing test that would trip?&lt;/p&gt;</comment>
                            <comment id="15208496" author="yseeley@gmail.com" created="Wed, 23 Mar 2016 07:28:57 -0700">&lt;p&gt;Ad-hoc testing for now.  It fixes stuff in the linked issue.&lt;/p&gt;</comment>
                            <comment id="15208604" author="yseeley@gmail.com" created="Wed, 23 Mar 2016 08:36:15 -0700">&lt;p&gt;new patch w/ tests&lt;/p&gt;</comment>
                            <comment id="15208609" author="dsmiley" created="Wed, 23 Mar 2016 08:39:25 -0700">&lt;p&gt;+1.&lt;br/&gt;
The only thing I would do differently is use random numbers to round-trip rather then fix them all at -1.&lt;/p&gt;</comment>
                            <comment id="15208724" author="jira-bot" created="Wed, 23 Mar 2016 09:39:36 -0700">&lt;p&gt;Commit ced7570e2c630442cb7b6ba117d38ac4433775af in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org" class="user-hover" rel="yonik@apache.org"&gt;Yonik Seeley&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ced7570" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ced7570&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8886" title="TrieField.toObject(IndexableField) can&amp;#39;t handle docValues" class="issue-link" data-issue-key="SOLR-8886"&gt;&lt;del&gt;SOLR-8886&lt;/del&gt;&lt;/a&gt;: fix TrieField.toObject(IndexableField) for docValues&lt;/p&gt;</comment>
                            <comment id="15208726" author="jira-bot" created="Wed, 23 Mar 2016 09:40:26 -0700">&lt;p&gt;Commit 82a537795ff9e85cd6834d6f46c41851b435bf7c in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org" class="user-hover" rel="yonik@apache.org"&gt;Yonik Seeley&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=82a5377" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=82a5377&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8886" title="TrieField.toObject(IndexableField) can&amp;#39;t handle docValues" class="issue-link" data-issue-key="SOLR-8886"&gt;&lt;del&gt;SOLR-8886&lt;/del&gt;&lt;/a&gt;: fix TrieField.toObject(IndexableField) for docValues&lt;/p&gt;</comment>
                            <comment id="15208730" author="jira-bot" created="Wed, 23 Mar 2016 09:41:11 -0700">&lt;p&gt;Commit a144f16f72bf12d97b060da26f3cfe60abaad80d in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org" class="user-hover" rel="yonik@apache.org"&gt;Yonik Seeley&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=a144f16" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=a144f16&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8886" title="TrieField.toObject(IndexableField) can&amp;#39;t handle docValues" class="issue-link" data-issue-key="SOLR-8886"&gt;&lt;del&gt;SOLR-8886&lt;/del&gt;&lt;/a&gt;: fix TrieField.toObject(IndexableField) for docValues&lt;/p&gt;</comment>
                            <comment id="15258312" author="anshumg" created="Tue, 26 Apr 2016 08:44:44 -0700">&lt;p&gt;Reopening to port for 5.5.1&lt;/p&gt;</comment>
                            <comment id="15258392" author="anshumg" created="Tue, 26 Apr 2016 09:36:19 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yseeley%40gmail.com" class="user-hover" rel="yseeley@gmail.com"&gt;Yonik Seeley&lt;/a&gt; can you help with back porting this and &lt;a href="https://issues.apache.org/jira/browse/SOLR-8865" title="real-time get does not retrieve values from docValues" class="issue-link" data-issue-key="SOLR-8865"&gt;&lt;del&gt;SOLR-8865&lt;/del&gt;&lt;/a&gt; for 5x ? Let me know if you think we shouldn't be doing this in the first place.&lt;/p&gt;</comment>
                            <comment id="15260511" author="yseeley@gmail.com" created="Wed, 27 Apr 2016 10:14:21 -0700">&lt;p&gt;OK, I'm in the process of backporting this.  Just running the full tests now.&lt;/p&gt;</comment>
                            <comment id="15260795" author="jira-bot" created="Wed, 27 Apr 2016 12:30:22 -0700">&lt;p&gt;Commit ebbe72567f1c3abe5be751606d59cc49cd4f451b in lucene-solr's branch refs/heads/branch_5x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org" class="user-hover" rel="yonik@apache.org"&gt;Yonik Seeley&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ebbe725" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ebbe725&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8886" title="TrieField.toObject(IndexableField) can&amp;#39;t handle docValues" class="issue-link" data-issue-key="SOLR-8886"&gt;&lt;del&gt;SOLR-8886&lt;/del&gt;&lt;/a&gt;: fix TrieField.toObject(IndexableField) for docValues&lt;/p&gt;</comment>
                            <comment id="15260796" author="jira-bot" created="Wed, 27 Apr 2016 12:31:10 -0700">&lt;p&gt;Commit fedbbfe29fea6f7382de63162fc973c9c2964bea in lucene-solr's branch refs/heads/branch_5_5 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org" class="user-hover" rel="yonik@apache.org"&gt;Yonik Seeley&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=fedbbfe" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=fedbbfe&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8886" title="TrieField.toObject(IndexableField) can&amp;#39;t handle docValues" class="issue-link" data-issue-key="SOLR-8886"&gt;&lt;del&gt;SOLR-8886&lt;/del&gt;&lt;/a&gt;: fix TrieField.toObject(IndexableField) for docValues&lt;/p&gt;</comment>
                            <comment id="15260820" author="anshumg" created="Wed, 27 Apr 2016 12:52:07 -0700">&lt;p&gt;Thanks Yonik. Are you also looking at &lt;a href="https://issues.apache.org/jira/browse/SOLR-8885" title="Update JS lib versions" class="issue-link" data-issue-key="SOLR-8885"&gt;SOLR-8885&lt;/a&gt; ?&lt;/p&gt;</comment>
                            <comment id="15261026" author="yseeley@gmail.com" created="Wed, 27 Apr 2016 14:58:47 -0700">&lt;p&gt;"Update JS lib versions"? I don't know anything about that one.&lt;/p&gt;</comment>
                            <comment id="15261057" author="anshumg" created="Wed, 27 Apr 2016 15:13:58 -0700">&lt;p&gt;I meant, &lt;a href="https://issues.apache.org/jira/browse/SOLR-8865" title="real-time get does not retrieve values from docValues" class="issue-link" data-issue-key="SOLR-8865"&gt;&lt;del&gt;SOLR-8865&lt;/del&gt;&lt;/a&gt;. The one that was blocked by this particular issue.&lt;/p&gt;</comment>
                            <comment id="15261082" author="yseeley@gmail.com" created="Wed, 27 Apr 2016 15:29:37 -0700">&lt;p&gt;Ah OK... yeah, I'll look into that and &lt;a href="https://issues.apache.org/jira/browse/SOLR-8891" title="StrField issues with docValues" class="issue-link" data-issue-key="SOLR-8891"&gt;&lt;del&gt;SOLR-8891&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12951074">SOLR-8865</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12795007" name="SOLR-8886.patch" size="6203" author="yseeley@gmail.com" created="Wed, 23 Mar 2016 08:36:15 -0700"/>
                            <attachment id="12794999" name="SOLR-8886.patch" size="2577" author="yseeley@gmail.com" created="Wed, 23 Mar 2016 07:18:27 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 23 Mar 2016 14:08:27 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 week, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2v2d3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8878] Allow the DaemonStream run rate be controlled by the internal stream</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8878</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Currently the DaemonStream sleeps for one second and then checks the runInterval param to determine if it needs to rerun the internal stream.&lt;/p&gt;

&lt;p&gt;This setup will work fine if the runInterval is longer then one second and if it never changes. But with the TopicStream, you want a variable run rate. For example if the TopicStream's latest run has returned documents, the next run should be immediate. But if the TopicStream's latest run returned zero documents then you'd want to sleep for a period of time before starting the next run.&lt;/p&gt;

&lt;p&gt;This ticket allows the internal stream to control the DaemonStream run rate by adding a &lt;b&gt;sleepMillis&lt;/b&gt; key-pair to the EOF Tuple. After each run the DaemonStream will check the EOF Tuple from the internal stream and if the sleepMillis key-pair is present it will adjust it's run rate accordingly.&lt;/p&gt;
</description>
                <environment/>
        <key id="12951744">SOLR-8878</key>
            <summary>Allow the DaemonStream run rate be controlled by the internal stream</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="joel.bernstein">Joel Bernstein</reporter>
                        <labels>
                    </labels>
                <created>Sat, 19 Mar 2016 19:33:33 -0700</created>
                <updated>Mon, 21 Mar 2016 10:07:30 -0700</updated>
                                                            <fixVersion>6.0</fixVersion>
                    <fixVersion>master</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="15203559" author="joel.bernstein" created="Sun, 20 Mar 2016 16:02:31 -0700">&lt;p&gt;Added a StreamingTest for a compound DaemonStream, TopicStream.&lt;/p&gt;</comment>
                            <comment id="15203632" author="jira-bot" created="Sun, 20 Mar 2016 19:06:02 -0700">&lt;p&gt;Commit f86ac58a5a4f1268e118c2cd7d2ec9192d91da6e in lucene-solr's branch refs/heads/master from jbernste&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f86ac58" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f86ac58&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8878" title="Allow the DaemonStream run rate be controlled by the internal stream" class="issue-link" data-issue-key="SOLR-8878"&gt;SOLR-8878&lt;/a&gt;: Allow the DaemonStream run rate be controlled by the internal stream&lt;/p&gt;</comment>
                            <comment id="15203634" author="joel.bernstein" created="Sun, 20 Mar 2016 19:08:51 -0700">&lt;p&gt;This ticket has some nice API changes for both the DaemonStream and the TopicStream, so I'd like backport this prior to the 6.0 release. &lt;/p&gt;</comment>
                            <comment id="15203639" author="jira-bot" created="Sun, 20 Mar 2016 19:14:50 -0700">&lt;p&gt;Commit 5a40ae030574aa2141d807a24f10b8d8ab4548db in lucene-solr's branch refs/heads/master from jbernste&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=5a40ae0" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=5a40ae0&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8878" title="Allow the DaemonStream run rate be controlled by the internal stream" class="issue-link" data-issue-key="SOLR-8878"&gt;SOLR-8878&lt;/a&gt;: Remove debugging&lt;/p&gt;</comment>
                            <comment id="15204573" author="jira-bot" created="Mon, 21 Mar 2016 09:44:09 -0700">&lt;p&gt;Commit 5c074dac28adb51ed681f254cae61324ac5c9a6a in lucene-solr's branch refs/heads/branch_6x from jbernste&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=5c074da" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=5c074da&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8878" title="Allow the DaemonStream run rate be controlled by the internal stream" class="issue-link" data-issue-key="SOLR-8878"&gt;SOLR-8878&lt;/a&gt;: Allow the DaemonStream run rate be controlled by the internal stream&lt;/p&gt;</comment>
                            <comment id="15204574" author="jira-bot" created="Mon, 21 Mar 2016 09:44:10 -0700">&lt;p&gt;Commit faa077224cad8d0ae9f06748cfe72fdc7f208399 in lucene-solr's branch refs/heads/branch_6x from jbernste&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=faa0772" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=faa0772&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8878" title="Allow the DaemonStream run rate be controlled by the internal stream" class="issue-link" data-issue-key="SOLR-8878"&gt;SOLR-8878&lt;/a&gt;: Remove debugging&lt;/p&gt;</comment>
                            <comment id="15204626" author="jira-bot" created="Mon, 21 Mar 2016 10:07:29 -0700">&lt;p&gt;Commit 39c1858adc267131c9de07ca6f087dbbdf58c848 in lucene-solr's branch refs/heads/branch_6_0 from jbernste&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=39c1858" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=39c1858&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8878" title="Allow the DaemonStream run rate be controlled by the internal stream" class="issue-link" data-issue-key="SOLR-8878"&gt;SOLR-8878&lt;/a&gt;: Allow the DaemonStream run rate be controlled by the internal stream&lt;/p&gt;</comment>
                            <comment id="15204627" author="jira-bot" created="Mon, 21 Mar 2016 10:07:30 -0700">&lt;p&gt;Commit 4dad70f24a0596b66896f49df1710b349dc6a6ca in lucene-solr's branch refs/heads/branch_6_0 from jbernste&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=4dad70f" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=4dad70f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8878" title="Allow the DaemonStream run rate be controlled by the internal stream" class="issue-link" data-issue-key="SOLR-8878"&gt;SOLR-8878&lt;/a&gt;: Remove debugging&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12794434" name="SOLR-8878.patch" size="8391" author="joel.bernstein" created="Sun, 20 Mar 2016 16:02:31 -0700"/>
                            <attachment id="12794385" name="SOLR-8878.patch" size="4512" author="joel.bernstein" created="Sat, 19 Mar 2016 20:14:06 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 21 Mar 2016 02:06:02 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ux4v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>

<item>
            <title>[SOLR-8874] Add fixes and workaround for Java 9 Jigsaw (Module System) to Solr tests</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8874</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;We now have one more week to prepare our build for Java 9 Jigsaw. The next Java 9 EA build will now contain the new Java 9 module system. From that time on, it is no longer possible to test Java 9 unless we fix remaining bugs. Currently Solr does not pass at all, because almost every test fails because the RAMUsageEstimator tries to look into objects in static field where the internals were hidden by Java 9:&lt;/p&gt;

&lt;div class="preformatted panel" style="border-width: 1px;"&gt;&lt;div class="preformattedContent panelContent"&gt;
&lt;pre&gt;   [junit4] ERROR   0.00s | SolrRequestParserTest (suite) &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: java.lang.IllegalStateException: Unable to access 'private final sun.nio.fs.WindowsFileSystem sun.nio.fs
.WindowsPath.fs' to estimate memory usage
   [junit4]    &amp;gt;        at __randomizedtesting.SeedInfo.seed([C6C2FAD07A66283B]:0)
   [junit4]    &amp;gt;        at com.carrotsearch.randomizedtesting.rules.RamUsageEstimator.createCacheEntry(RamUsageEstimator.java:602)
   [junit4]    &amp;gt;        at com.carrotsearch.randomizedtesting.rules.RamUsageEstimator.measureSizeOf(RamUsageEstimator.java:545)
   [junit4]    &amp;gt;        at com.carrotsearch.randomizedtesting.rules.RamUsageEstimator.sizeOfAll(RamUsageEstimator.java:387)
   [junit4]    &amp;gt;        at com.carrotsearch.randomizedtesting.rules.StaticFieldsInvariantRule$1.afterAlways(StaticFieldsInvariantRule.j
ava:127)
   [junit4]    &amp;gt;        at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:43)
   [junit4]    &amp;gt;        at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
   [junit4]    &amp;gt;        at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
   [junit4]    &amp;gt;        at org.apache.lucene.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)
   [junit4]    &amp;gt;        at org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:47)
   [junit4]    &amp;gt;        at org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:64)
   [junit4]    &amp;gt;        at org.apache.lucene.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:54)
   [junit4]    &amp;gt;        at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
   [junit4]    &amp;gt;        at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:367)
   [junit4]    &amp;gt;        at java.lang.Thread.run(java.base@9-ea/Thread.java:804)
   [junit4]    &amp;gt; Caused by: java.lang.reflect.InaccessibleObjectException: Unable to make member of class sun.nio.fs.WindowsPath access
ible:  module java.base does not export sun.nio.fs to unnamed module @436813f3
   [junit4]    &amp;gt;        at sun.reflect.Reflection.throwInaccessibleObjectException(java.base@9-ea/Reflection.java:420)
   [junit4]    &amp;gt;        at java.lang.reflect.AccessibleObject.checkCanSetAccessible(java.base@9-ea/AccessibleObject.java:174)
   [junit4]    &amp;gt;        at java.lang.reflect.Field.checkCanSetAccessible(java.base@9-ea/Field.java:170)
   [junit4]    &amp;gt;        at java.lang.reflect.Field.setAccessible(java.base@9-ea/Field.java:164)
   [junit4]    &amp;gt;        at com.carrotsearch.randomizedtesting.rules.RamUsageEstimator$3.run(RamUsageEstimator.java:597)
   [junit4]    &amp;gt;        at com.carrotsearch.randomizedtesting.rules.RamUsageEstimator$3.run(RamUsageEstimator.java:594)
   [junit4]    &amp;gt;        at java.security.AccessController.doPrivileged(java.base@9-ea/Native Method)
   [junit4]    &amp;gt;        at com.carrotsearch.randomizedtesting.rules.RamUsageEstimator.createCacheEntry(RamUsageEstimator.java:594)
   [junit4]    &amp;gt;        ... 13 more
   [junit4] Completed [1/1 (1!)] in 8.46s, 12 tests, 1 error &amp;lt;&amp;lt;&amp;lt; FAILURES!
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I have 2 suggestions:&lt;/p&gt;
&lt;ul class="alternate" type="square"&gt;
	&lt;li&gt;for now disable the static heap usage checks for Java 9 (how? See below!)&lt;/li&gt;
	&lt;li&gt;fix the problems! Mainly we have to ensure that &lt;b&gt;all&lt;/b&gt; static, non-final fields in tests pointing to Java obects are nulled on tear down (@AfterClass).&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I have no idea how to do the disabling conditionally. Maybe Dawid Weiss can give a hint.&lt;/p&gt;

&lt;p&gt;In addition, almost every Hadoop test fails with Java 9 module system! Unless Hadoop fixes this and we have updated libs, our only chance is to disable all hadoop related stuff with Java 9 preview builds - sorry. I'd like to add a new Test annotation &lt;tt&gt;@DisableWithJava9Jigsaw&lt;/tt&gt;, which disables the test if running under Java 9 Jigsaw.&lt;/p&gt;</description>
                <environment/>
        <key id="12951657">SOLR-8874</key>
            <summary>Add fixes and workaround for Java 9 Jigsaw (Module System) to Solr tests</summary>
                <type id="6" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/requirement.png">Test</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thetaphi">Uwe Schindler</assignee>
                                    <reporter username="thetaphi">Uwe Schindler</reporter>
                        <labels>
                            <label>Java9</label>
                    </labels>
                <created>Fri, 18 Mar 2016 17:21:31 -0700</created>
                <updated>Tue, 22 Mar 2016 03:21:44 -0700</updated>
                            <resolved>Sat, 19 Mar 2016 06:56:46 -0700</resolved>
                                    <version>6.0</version>
                                    <fixVersion>6.0</fixVersion>
                    <fixVersion>6.1</fixVersion>
                    <fixVersion>master</fixVersion>
                                    <component>Tests</component>
                        <due/>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="15202410" author="thetaphi" created="Fri, 18 Mar 2016 17:24:21 -0700">&lt;p&gt;Preliminary patch:&lt;/p&gt;
&lt;ul class="alternate" type="square"&gt;
	&lt;li&gt;Disables the static leak detector in Solr tests (by package name) if running under Java 9 Jigsaw.&lt;/li&gt;
	&lt;li&gt;Add new annotation and disable the first test: &lt;a href="https://issues.apache.org/jira/browse/SOLR-8052" title="Tests using MiniKDC do not work with Java 9 Jigsaw" class="issue-link" data-issue-key="SOLR-8052"&gt;SOLR-8052&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I did not yet run under linux, so Hadoop tests did not run, but all other tests pass now.&lt;/p&gt;

&lt;p&gt;I will figure out the Hadoop situation tomorrow and add the new annotation accordingly. After that I will setup Jenkins to run with Java 9 Jigsaw build 109 (110 is broken).&lt;/p&gt;</comment>
                            <comment id="15202689" author="thetaphi" created="Sat, 19 Mar 2016 02:53:10 -0700">&lt;p&gt;Simplified test rule.&lt;/p&gt;</comment>
                            <comment id="15202728" author="thetaphi" created="Sat, 19 Mar 2016 04:24:29 -0700">&lt;p&gt;I was able to get hold of the static leak detector issues:&lt;/p&gt;
&lt;ul class="alternate" type="square"&gt;
	&lt;li&gt;I added java.nio.fs.Path and java.io.File to the list of ignored types (the latter because it has a transient reference to Path)&lt;/li&gt;
	&lt;li&gt;I added java.lang.Class to the list, too (it consumes no memory, because they are singletons)&lt;/li&gt;
	&lt;li&gt;I fixed SolrTestCaseJ4 and some other tests to not sit on the core Path for completeness.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;So I removed the hack in LTC. Running tests again...&lt;/p&gt;</comment>
                            <comment id="15202751" author="thetaphi" created="Sat, 19 Mar 2016 05:55:15 -0700">&lt;p&gt;New patch:&lt;/p&gt;
&lt;ul class="alternate" type="square"&gt;
	&lt;li&gt;I reverted all in LTC, except the excluded types for static leak checker&lt;/li&gt;
	&lt;li&gt;I disabled all HDFS tests through the ant property (like Windows)&lt;/li&gt;
	&lt;li&gt;I disabled the &lt;a href="https://issues.apache.org/jira/browse/SOLR-8052" title="Tests using MiniKDC do not work with Java 9 Jigsaw" class="issue-link" data-issue-key="SOLR-8052"&gt;SOLR-8052&lt;/a&gt; test completely for Java 9, it also failed quite often with non-Jigsaw builds&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I will commit this in a moment.&lt;/p&gt;</comment>
                            <comment id="15202778" author="jira-bot" created="Sat, 19 Mar 2016 06:54:14 -0700">&lt;p&gt;Commit f93f90ca1b22d67d738cbd238ef44c292dd82274 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi" class="user-hover" rel="thetaphi"&gt;Uwe Schindler&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f93f90c" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f93f90c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8874" title="Add fixes and workaround for Java 9 Jigsaw (Module System) to Solr tests" class="issue-link" data-issue-key="SOLR-8874"&gt;&lt;del&gt;SOLR-8874&lt;/del&gt;&lt;/a&gt;: Make Solr tests work with Java 9 Jigsaw&lt;/p&gt;</comment>
                            <comment id="15202780" author="jira-bot" created="Sat, 19 Mar 2016 06:55:15 -0700">&lt;p&gt;Commit 0a89ffaf96f63617968c208afcaf9bfb293490ea in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi" class="user-hover" rel="thetaphi"&gt;Uwe Schindler&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=0a89ffa" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=0a89ffa&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8874" title="Add fixes and workaround for Java 9 Jigsaw (Module System) to Solr tests" class="issue-link" data-issue-key="SOLR-8874"&gt;&lt;del&gt;SOLR-8874&lt;/del&gt;&lt;/a&gt;: Make Solr tests work with Java 9 Jigsaw&lt;/p&gt;</comment>
                            <comment id="15202781" author="jira-bot" created="Sat, 19 Mar 2016 06:56:17 -0700">&lt;p&gt;Commit 7a2bd4318cc98fe612ab97cb37634e44bff8080c in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi" class="user-hover" rel="thetaphi"&gt;Uwe Schindler&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=7a2bd43" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=7a2bd43&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8874" title="Add fixes and workaround for Java 9 Jigsaw (Module System) to Solr tests" class="issue-link" data-issue-key="SOLR-8874"&gt;&lt;del&gt;SOLR-8874&lt;/del&gt;&lt;/a&gt;: Make Solr tests work with Java 9 Jigsaw&lt;/p&gt;</comment>
                            <comment id="15203188" author="jira-bot" created="Sun, 20 Mar 2016 02:41:17 -0700">&lt;p&gt;Commit 91424ae9633b2f382799691693dd4ce8ed216cb8 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi" class="user-hover" rel="thetaphi"&gt;Uwe Schindler&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=91424ae" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=91424ae&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8874" title="Add fixes and workaround for Java 9 Jigsaw (Module System) to Solr tests" class="issue-link" data-issue-key="SOLR-8874"&gt;&lt;del&gt;SOLR-8874&lt;/del&gt;&lt;/a&gt;, &lt;a href="https://issues.apache.org/jira/browse/SOLR-8876" title="Morphlines tests fail with Java 9 (Jigsaw)" class="issue-link" data-issue-key="SOLR-8876"&gt;SOLR-8876&lt;/a&gt;: Disable more Hadoop tests with Java 9&lt;/p&gt;</comment>
                            <comment id="15203190" author="jira-bot" created="Sun, 20 Mar 2016 02:41:56 -0700">&lt;p&gt;Commit 19b4168b3f6ef7c6614ece040948cab9a05be32b in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi" class="user-hover" rel="thetaphi"&gt;Uwe Schindler&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=19b4168" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=19b4168&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8874" title="Add fixes and workaround for Java 9 Jigsaw (Module System) to Solr tests" class="issue-link" data-issue-key="SOLR-8874"&gt;&lt;del&gt;SOLR-8874&lt;/del&gt;&lt;/a&gt;, &lt;a href="https://issues.apache.org/jira/browse/SOLR-8876" title="Morphlines tests fail with Java 9 (Jigsaw)" class="issue-link" data-issue-key="SOLR-8876"&gt;SOLR-8876&lt;/a&gt;: Disable more Hadoop tests with Java 9&lt;/p&gt;</comment>
                            <comment id="15203192" author="jira-bot" created="Sun, 20 Mar 2016 02:42:38 -0700">&lt;p&gt;Commit 2e06790bdcf0b26fcc8ecf518284432153dd6a7c in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi" class="user-hover" rel="thetaphi"&gt;Uwe Schindler&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=2e06790" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=2e06790&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8874" title="Add fixes and workaround for Java 9 Jigsaw (Module System) to Solr tests" class="issue-link" data-issue-key="SOLR-8874"&gt;&lt;del&gt;SOLR-8874&lt;/del&gt;&lt;/a&gt;, &lt;a href="https://issues.apache.org/jira/browse/SOLR-8876" title="Morphlines tests fail with Java 9 (Jigsaw)" class="issue-link" data-issue-key="SOLR-8876"&gt;SOLR-8876&lt;/a&gt;: Disable more Hadoop tests with Java 9&lt;/p&gt;</comment>
                            <comment id="15203270" author="jira-bot" created="Sun, 20 Mar 2016 05:25:48 -0700">&lt;p&gt;Commit 3a4e1d114219e0f9a28cf49c51ed9928913d2cb3 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi" class="user-hover" rel="thetaphi"&gt;Uwe Schindler&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3a4e1d1" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3a4e1d1&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8874" title="Add fixes and workaround for Java 9 Jigsaw (Module System) to Solr tests" class="issue-link" data-issue-key="SOLR-8874"&gt;&lt;del&gt;SOLR-8874&lt;/del&gt;&lt;/a&gt;: Update Maven config to correctly set tests.disableHdfs&lt;/p&gt;</comment>
                            <comment id="15203271" author="jira-bot" created="Sun, 20 Mar 2016 05:26:30 -0700">&lt;p&gt;Commit 0f60ce61eb9d28910c5934929d6d300f047ed1ce in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi" class="user-hover" rel="thetaphi"&gt;Uwe Schindler&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=0f60ce6" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=0f60ce6&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8874" title="Add fixes and workaround for Java 9 Jigsaw (Module System) to Solr tests" class="issue-link" data-issue-key="SOLR-8874"&gt;&lt;del&gt;SOLR-8874&lt;/del&gt;&lt;/a&gt;: Update Maven config to correctly set tests.disableHdfs&lt;/p&gt;</comment>
                            <comment id="15203273" author="jira-bot" created="Sun, 20 Mar 2016 05:27:12 -0700">&lt;p&gt;Commit 2ea8d4cd7b39e675ebc2cad6a9bfa983872599a0 in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi" class="user-hover" rel="thetaphi"&gt;Uwe Schindler&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=2ea8d4c" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=2ea8d4c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8874" title="Add fixes and workaround for Java 9 Jigsaw (Module System) to Solr tests" class="issue-link" data-issue-key="SOLR-8874"&gt;&lt;del&gt;SOLR-8874&lt;/del&gt;&lt;/a&gt;: Update Maven config to correctly set tests.disableHdfs&lt;/p&gt;</comment>
                            <comment id="15204788" author="mdrob" created="Mon, 21 Mar 2016 11:13:05 -0700">&lt;p&gt;Thanks for figuring this out, Uwe! Hadoop is tracking their Java 9 efforts in &lt;a href="https://issues.apache.org/jira/browse/HADOOP-11123" title="Uber-JIRA: Hadoop on Java 9" class="issue-link" data-issue-key="HADOOP-11123"&gt;HADOOP-11123&lt;/a&gt;, looks like there is no activity there for 16 months.&lt;/p&gt;</comment>
                            <comment id="15206127" author="stevel@apache.org" created="Tue, 22 Mar 2016 03:21:44 -0700">&lt;p&gt;there's no activity in Hadoop as we tend to be trailing edge: people get upset when we tell them to upgrade. That said: too trailing edge for some of us developers. The JIRA was created as placeholder rather than active dev point.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Nobody is going to be looking @ java 9 right now; java 8 is still getting cleanup details in.&lt;/li&gt;
	&lt;li&gt;If someone was to do the work for java 9 and supply patches, it can only be beneficial.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;You are probably the first people to test Hadoop and Java 9. What broke?&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12863820">SOLR-8052</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12951703">SOLR-8876</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310040">
                    <name>Required</name>
                                            <outwardlinks description="requires">
                                        <issuelink>
            <issuekey id="12743764">HADOOP-11123</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12794350" name="SOLR-8874.patch" size="11178" author="thetaphi" created="Sat, 19 Mar 2016 05:55:15 -0700"/>
                            <attachment id="12794345" name="SOLR-8874.patch" size="10033" author="thetaphi" created="Sat, 19 Mar 2016 04:24:29 -0700"/>
                            <attachment id="12794334" name="SOLR-8874.patch" size="6021" author="thetaphi" created="Sat, 19 Mar 2016 02:53:10 -0700"/>
                            <attachment id="12794295" name="SOLR-8874.patch" size="6225" author="thetaphi" created="Fri, 18 Mar 2016 17:24:21 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 19 Mar 2016 13:54:14 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2uwlj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8867] frange / ValueSourceRangeFilter / FunctionValues.getRangeScorer should not match documents w/o a value</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8867</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>{!frange}
&lt;p&gt; currently can match documents w/o a value (because of a default value of 0).&lt;br/&gt;
This only existed historically because we didn't have info about what fields had a value for numerics, and didn't have exists() on FunctionValues.&lt;/p&gt;</description>
                <environment/>
        <key id="12951240">SOLR-8867</key>
            <summary>frange / ValueSourceRangeFilter / FunctionValues.getRangeScorer should not match documents w/o a value</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="4" iconUrl="https://issues.apache.org/jira/images/icons/statuses/reopened.png" description="This issue was once resolved, but the resolution was deemed incorrect. From here issues are either marked assigned or resolved.">Reopened</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="yseeley@gmail.com">Yonik Seeley</assignee>
                                    <reporter username="yseeley@gmail.com">Yonik Seeley</reporter>
                        <labels>
                    </labels>
                <created>Thu, 17 Mar 2016 08:24:01 -0700</created>
                <updated>Tue, 26 Apr 2016 11:24:09 -0700</updated>
                                                            <fixVersion>5.6</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="15199937" author="ichattopadhyaya" created="Thu, 17 Mar 2016 10:05:49 -0700">&lt;p&gt;Yonik, do you think you'll be able to get to this in time for 6.0? I can take a look in case there are other issues you're caught up with. &lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/smile.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt;&lt;/p&gt;</comment>
                            <comment id="15199968" author="yseeley@gmail.com" created="Thu, 17 Mar 2016 10:16:26 -0700">&lt;p&gt;Here's an untested patch... current tests are running now, still needs new tests for coverage.&lt;/p&gt;</comment>
                            <comment id="15200262" author="yseeley@gmail.com" created="Thu, 17 Mar 2016 13:01:46 -0700">&lt;p&gt;Here's an updated patch that modifies a random range test to include docs w/o a value in the field and also queries across negative values.&lt;/p&gt;

&lt;p&gt;This also changes getRangeScorer() to use LeafReaderContext to be consistent with everything else.&lt;/p&gt;

&lt;p&gt;All tests pass, and I plan on committing shortly.&lt;/p&gt;</comment>
                            <comment id="15200364" author="jira-bot" created="Thu, 17 Mar 2016 13:59:06 -0700">&lt;p&gt;Commit 5ea86b14c36bc38366888a208368ac241d254baf in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org" class="user-hover" rel="yonik@apache.org"&gt;Yonik Seeley&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=5ea86b1" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=5ea86b1&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8867" title="frange / ValueSourceRangeFilter / FunctionValues.getRangeScorer should not match documents w/o a value" class="issue-link" data-issue-key="SOLR-8867"&gt;SOLR-8867&lt;/a&gt;: fix frange/FunctionValues.getRangeScorer to not match missing values, getRangeScorer refactored to take LeafReaderContext&lt;/p&gt;</comment>
                            <comment id="15200367" author="jira-bot" created="Thu, 17 Mar 2016 13:59:50 -0700">&lt;p&gt;Commit c195395d34fb28711b99e4552602dcea729a718b in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org" class="user-hover" rel="yonik@apache.org"&gt;Yonik Seeley&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c195395" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c195395&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8867" title="frange / ValueSourceRangeFilter / FunctionValues.getRangeScorer should not match documents w/o a value" class="issue-link" data-issue-key="SOLR-8867"&gt;SOLR-8867&lt;/a&gt;: fix frange/FunctionValues.getRangeScorer to not match missing values, getRangeScorer refactored to take LeafReaderContext&lt;/p&gt;</comment>
                            <comment id="15200368" author="jira-bot" created="Thu, 17 Mar 2016 14:00:05 -0700">&lt;p&gt;Commit ce0ba5cab99c9ae9da2f25fd7c73f9116fe17a5a in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org" class="user-hover" rel="yonik@apache.org"&gt;Yonik Seeley&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ce0ba5c" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ce0ba5c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8867" title="frange / ValueSourceRangeFilter / FunctionValues.getRangeScorer should not match documents w/o a value" class="issue-link" data-issue-key="SOLR-8867"&gt;SOLR-8867&lt;/a&gt;: fix frange/FunctionValues.getRangeScorer to not match missing values, getRangeScorer refactored to take LeafReaderContext&lt;/p&gt;</comment>
                            <comment id="15201171" author="jira-bot" created="Fri, 18 Mar 2016 01:29:56 -0700">&lt;p&gt;Commit 5ea86b14c36bc38366888a208368ac241d254baf in lucene-solr's branch refs/heads/apiv2 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org" class="user-hover" rel="yonik@apache.org"&gt;Yonik Seeley&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=5ea86b1" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=5ea86b1&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8867" title="frange / ValueSourceRangeFilter / FunctionValues.getRangeScorer should not match documents w/o a value" class="issue-link" data-issue-key="SOLR-8867"&gt;SOLR-8867&lt;/a&gt;: fix frange/FunctionValues.getRangeScorer to not match missing values, getRangeScorer refactored to take LeafReaderContext&lt;/p&gt;</comment>
                            <comment id="15256554" author="anshumg" created="Mon, 25 Apr 2016 09:36:43 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yseeley%40gmail.com" class="user-hover" rel="yseeley@gmail.com"&gt;Yonik Seeley&lt;/a&gt; : Should this one also go back into 5x ?&lt;/p&gt;</comment>
                            <comment id="15256653" author="yseeley@gmail.com" created="Mon, 25 Apr 2016 10:33:44 -0700">&lt;blockquote&gt;&lt;p&gt;Should this one also go back into 5x ?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It's a judgement call... it's certainly more of a bug to most people, but it's also a limitation that someone could have been relying on.&lt;/p&gt;</comment>
                            <comment id="15256675" author="anshumg" created="Mon, 25 Apr 2016 10:45:19 -0700">&lt;p&gt;In that case I think I'll back port it to 5x but leave it out of 5.5.1 to avoid any behavior changes. That way it would be released with 5.6.&lt;/p&gt;</comment>
                            <comment id="15258618" author="anshumg" created="Tue, 26 Apr 2016 11:23:47 -0700">&lt;p&gt;Reopening to back port to 5x.&lt;/p&gt;</comment>
                            <comment id="15258620" author="jira-bot" created="Tue, 26 Apr 2016 11:24:09 -0700">&lt;p&gt;Commit 3f49fd7adb47a935585de41287e237bb49e473b8 in lucene-solr's branch refs/heads/branch_5x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org" class="user-hover" rel="yonik@apache.org"&gt;Yonik Seeley&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3f49fd7" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3f49fd7&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8867" title="frange / ValueSourceRangeFilter / FunctionValues.getRangeScorer should not match documents w/o a value" class="issue-link" data-issue-key="SOLR-8867"&gt;SOLR-8867&lt;/a&gt;: fix frange/FunctionValues.getRangeScorer to not match missing values, getRangeScorer refactored to take LeafReaderContext&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12895270">SOLR-8082</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12794050" name="SOLR-8867.patch" size="22037" author="yseeley@gmail.com" created="Thu, 17 Mar 2016 13:01:46 -0700"/>
                            <attachment id="12794013" name="SOLR-8867.patch" size="6005" author="yseeley@gmail.com" created="Thu, 17 Mar 2016 10:16:26 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 17 Mar 2016 17:05:49 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 week, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2uu0v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>

<item>
            <title>[SOLR-8865] real-time get does not retrieve values from docValues</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8865</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Uncovered during ad-hoc testing... the &lt;em&gt;version&lt;/em&gt; field, which has stored=false docValues=true is not retrieved with realtime-get&lt;/p&gt;</description>
                <environment/>
        <key id="12951074">SOLR-8865</key>
            <summary>real-time get does not retrieve values from docValues</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yseeley@gmail.com">Yonik Seeley</assignee>
                                    <reporter username="yseeley@gmail.com">Yonik Seeley</reporter>
                        <labels>
                    </labels>
                <created>Wed, 16 Mar 2016 20:08:12 -0700</created>
                <updated>Wed, 27 Apr 2016 16:58:46 -0700</updated>
                            <resolved>Fri, 25 Mar 2016 07:21:12 -0700</resolved>
                                                    <fixVersion>5.5.1</fixVersion>
                    <fixVersion>5.6</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="15198704" author="ichattopadhyaya" created="Wed, 16 Mar 2016 21:00:52 -0700">&lt;p&gt;Interesting.. I thought we fixed this with &lt;a href="https://issues.apache.org/jira/browse/SOLR-8276" title="Atomic updates &amp;amp; RTG don&amp;#39;t work with non-stored docvalues" class="issue-link" data-issue-key="SOLR-8276"&gt;&lt;del&gt;SOLR-8276&lt;/del&gt;&lt;/a&gt;, but seems like not fixed?&lt;/p&gt;</comment>
                            <comment id="15198706" author="yseeley@gmail.com" created="Wed, 16 Mar 2016 21:08:50 -0700">&lt;p&gt;I just followed the first couple of steps here: &lt;a href="http://yonik.com/solr-tutorial/" class="external-link" rel="nofollow"&gt;http://yonik.com/solr-tutorial/&lt;/a&gt;&lt;br/&gt;
Best guess is that not all paths were covered... I think the steps above will lead to a retrieval from the tlog and not the index.&lt;/p&gt;</comment>
                            <comment id="15198716" author="ichattopadhyaya" created="Wed, 16 Mar 2016 21:27:03 -0700">&lt;p&gt;I think something like the attached patch (untested) might work?&lt;/p&gt;</comment>
                            <comment id="15201498" author="ichattopadhyaya" created="Fri, 18 Mar 2016 07:02:19 -0700">&lt;p&gt;I'm working on a test for this.&lt;/p&gt;</comment>
                            <comment id="15201517" author="yseeley@gmail.com" created="Fri, 18 Mar 2016 07:13:30 -0700">&lt;p&gt;Ah cool, good thing you brought it up... I was just going to start looking into that myself!&lt;/p&gt;</comment>
                            <comment id="15202307" author="ichattopadhyaya" created="Fri, 18 Mar 2016 15:56:23 -0700">&lt;p&gt;Here's a patch that works. Made the TestRealTimeGet to randomly use non stored docValues based &amp;#95;version&amp;#95; field. The full test suite passes.&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org" class="user-hover" rel="yonik@apache.org"&gt;Yonik Seeley&lt;/a&gt; Can you please review? Is there something we can do better for avoiding the double addition of a dv field in the toSolrDoc method?&lt;/p&gt;</comment>
                            <comment id="15202569" author="ichattopadhyaya" created="Fri, 18 Mar 2016 22:15:46 -0700">&lt;p&gt;Added a test for a multivalued field, to ensure that the logic for avoiding double adding of dv fields doesn't affect multivalued fields.&lt;/p&gt;</comment>
                            <comment id="15203104" author="ichattopadhyaya" created="Sat, 19 Mar 2016 21:45:45 -0700">&lt;p&gt;I think this should be made a blocker for 6.0.&lt;/p&gt;</comment>
                            <comment id="15203621" author="yseeley@gmail.com" created="Sun, 20 Mar 2016 18:37:54 -0700">&lt;p&gt;Sorry for not getting to this earlier, busy weekend and now I'm sick...&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Is there something we can do better for avoiding the double addition of a dv field in the toSolrDoc method?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Why/how does the double addition happen?&lt;/p&gt;</comment>
                            <comment id="15205809" author="ichattopadhyaya" created="Mon, 21 Mar 2016 22:11:26 -0700">&lt;blockquote&gt;&lt;p&gt;Sorry for not getting to this earlier, busy weekend and now I'm sick...&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Ouch, get well soon Yonik!&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Why/how does the double addition happen?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I remember this double addition was due to the toSolrDoc method that converts a tlog document (which has only one field) to a Lucene document and then back again to a Solr document. I'll debug this again and quote specific parts of the code and in-memory lucene and solr documents from a test run next.&lt;/p&gt;</comment>
                            <comment id="15206389" author="yseeley@gmail.com" created="Tue, 22 Mar 2016 06:51:39 -0700">&lt;blockquote&gt;&lt;p&gt;remember this double addition was due to the toSolrDoc method that converts a tlog document (which has only one field) to a Lucene document and then back again to a Solr document.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Ah, I see... creating the lucene document creates both a docValue field and a stored field for the same field.&lt;br/&gt;
But this would hold for multi-valued fields as well, meaning the part of this patch that checks if the value has already been added won't work for multi-valued fields?&lt;/p&gt;

&lt;p&gt;Seems like a better approach would be to fix the code that creates duplicates in the first place... so in this code:&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
    &lt;span class="code-keyword"&gt;for&lt;/span&gt; (IndexableField f : doc.getFields()) {
      &lt;span class="code-keyword"&gt;if&lt;/span&gt; (f.fieldType().stored()) {
        out.add((IndexableField) f);
      } &lt;span class="code-keyword"&gt;else&lt;/span&gt; {
        SchemaField schemaField = schema.getFieldOrNull(f.name());
        &lt;span class="code-keyword"&gt;if&lt;/span&gt; (schemaField != &lt;span class="code-keyword"&gt;null&lt;/span&gt; &amp;amp;&amp;amp; schemaField.hasDocValues() &amp;amp;&amp;amp; schemaField.useDocValuesAsStored()) {
          out.add((IndexableField) f);
        }
      }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Drive it off of our schema... if the field is both stored and has docValues, then we can simply avoid one of them.&lt;/p&gt;</comment>
                            <comment id="15206408" author="yseeley@gmail.com" created="Tue, 22 Mar 2016 07:02:44 -0700">&lt;blockquote&gt;&lt;p&gt;Made the TestRealTimeGet to randomly use non stored docValues based &lt;em&gt;version&lt;/em&gt; field. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Rather than randomly using a different schema, how about changing/adding a test that just uses more fields?&lt;br/&gt;
We need to test combinations of stored, docValues, multiValued, etc.&lt;/p&gt;</comment>
                            <comment id="15207606" author="yseeley@gmail.com" created="Tue, 22 Mar 2016 17:27:57 -0700">&lt;p&gt;OK, I have some time to take a shot at this now...&lt;/p&gt;</comment>
                            <comment id="15207737" author="yseeley@gmail.com" created="Tue, 22 Mar 2016 19:07:25 -0700">&lt;p&gt;Checkpoint patch... I updated schema_latest to make a bunch of the docValues fields unstored and used that.&lt;/p&gt;

&lt;p&gt;Progress being made... currently an interesting fail in testRealTimeGet():&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
 expected ==={'doc':{'id':'1', a_f:-1.5, a_fd:-1.5, a_fdS:-1.5,  a_fs:[1.0,2.5],a_fds:[1.0,2.5]       }}
 response = {
  &lt;span class="code-quote"&gt;"doc"&lt;/span&gt;:
  {
    &lt;span class="code-quote"&gt;"id"&lt;/span&gt;:&lt;span class="code-quote"&gt;"1"&lt;/span&gt;,
    &lt;span class="code-quote"&gt;"a_f"&lt;/span&gt;:-1.5,
    &lt;span class="code-quote"&gt;"a_fd"&lt;/span&gt;:-1.5,
    &lt;span class="code-quote"&gt;"a_fdS"&lt;/span&gt;:-1.5,
    &lt;span class="code-quote"&gt;"a_fs"&lt;/span&gt;:[1.0,
      2.5],
    &lt;span class="code-quote"&gt;"a_fds"&lt;/span&gt;:[1.0,
      &lt;span class="code-quote"&gt;"ERROR:SCHEMA-INDEX-MISMATCH,stringValue=&lt;span class="code-keyword"&gt;null&lt;/span&gt;"&lt;/span&gt;,
      2.5,
      &lt;span class="code-quote"&gt;"ERROR:SCHEMA-INDEX-MISMATCH,stringValue=&lt;span class="code-keyword"&gt;null&lt;/span&gt;"&lt;/span&gt;]}}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This looks like a bug in TrieField.toObject() when using docValues&lt;/p&gt;</comment>
                            <comment id="15208083" author="ichattopadhyaya" created="Wed, 23 Mar 2016 01:50:53 -0700">&lt;p&gt;Ouch, good catch. That looks bad. Linking &lt;a href="https://issues.apache.org/jira/browse/SOLR-8886" title="TrieField.toObject(IndexableField) can&amp;#39;t handle docValues" class="issue-link" data-issue-key="SOLR-8886"&gt;&lt;del&gt;SOLR-8886&lt;/del&gt;&lt;/a&gt; to this issue.&lt;/p&gt;

&lt;p&gt;Yonik, hope you are feeling better. Sorry, I'm currently out on vacation for Holi (&lt;a href="https://en.wikipedia.org/wiki/Holi" class="external-link" rel="nofollow"&gt;https://en.wikipedia.org/wiki/Holi&lt;/a&gt;) and shall be able to get to this on Thursday.&lt;/p&gt;</comment>
                            <comment id="15208807" author="yseeley@gmail.com" created="Wed, 23 Mar 2016 10:22:07 -0700">&lt;p&gt;Yeah feeling fine now, and making progress on this.  No worries.&lt;br/&gt;
Enjoy your vacation, sounds fun!&lt;/p&gt;</comment>
                            <comment id="15209585" author="yseeley@gmail.com" created="Wed, 23 Mar 2016 19:06:19 -0700">&lt;p&gt;Updated patch, hopefully this is it... starting to run full tests now.&lt;/p&gt;</comment>
                            <comment id="15211868" author="jira-bot" created="Fri, 25 Mar 2016 07:18:45 -0700">&lt;p&gt;Commit 6f60ac21f303364eece9c9f2893278f7da31aef8 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org" class="user-hover" rel="yonik@apache.org"&gt;Yonik Seeley&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=6f60ac2" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=6f60ac2&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8865" title="real-time get does not retrieve values from docValues" class="issue-link" data-issue-key="SOLR-8865"&gt;&lt;del&gt;SOLR-8865&lt;/del&gt;&lt;/a&gt;: Real-time get sometimes fails to retrieve stored fields from docValues&lt;/p&gt;</comment>
                            <comment id="15211869" author="jira-bot" created="Fri, 25 Mar 2016 07:19:27 -0700">&lt;p&gt;Commit ca374d947678a81df665095387dadc0551590729 in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org" class="user-hover" rel="yonik@apache.org"&gt;Yonik Seeley&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ca374d9" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ca374d9&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8865" title="real-time get does not retrieve values from docValues" class="issue-link" data-issue-key="SOLR-8865"&gt;&lt;del&gt;SOLR-8865&lt;/del&gt;&lt;/a&gt;: Real-time get sometimes fails to retrieve stored fields from docValues&lt;/p&gt;</comment>
                            <comment id="15211870" author="jira-bot" created="Fri, 25 Mar 2016 07:19:36 -0700">&lt;p&gt;Commit 762000f226ff015e51082adff887ee1a046dd9d6 in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org" class="user-hover" rel="yonik@apache.org"&gt;Yonik Seeley&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=762000f" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=762000f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8865" title="real-time get does not retrieve values from docValues" class="issue-link" data-issue-key="SOLR-8865"&gt;&lt;del&gt;SOLR-8865&lt;/del&gt;&lt;/a&gt;: Real-time get sometimes fails to retrieve stored fields from docValues&lt;/p&gt;</comment>
                            <comment id="15261224" author="jira-bot" created="Wed, 27 Apr 2016 16:47:27 -0700">&lt;p&gt;Commit d255771565b5c241651ffb89bb02155278cf45fd in lucene-solr's branch refs/heads/branch_5x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org" class="user-hover" rel="yonik@apache.org"&gt;Yonik Seeley&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d255771" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d255771&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8865" title="real-time get does not retrieve values from docValues" class="issue-link" data-issue-key="SOLR-8865"&gt;&lt;del&gt;SOLR-8865&lt;/del&gt;&lt;/a&gt;: Real-time get sometimes fails to retrieve stored fields from docValues&lt;/p&gt;</comment>
                            <comment id="15261238" author="jira-bot" created="Wed, 27 Apr 2016 16:55:50 -0700">&lt;p&gt;Commit 3619099eb58cd5691a05004d9ad004a36884c06d in lucene-solr's branch refs/heads/branch_5_5 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org" class="user-hover" rel="yonik@apache.org"&gt;Yonik Seeley&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3619099" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3619099&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8865" title="real-time get does not retrieve values from docValues" class="issue-link" data-issue-key="SOLR-8865"&gt;&lt;del&gt;SOLR-8865&lt;/del&gt;&lt;/a&gt;: Real-time get sometimes fails to retrieve stored fields from docValues&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12952667">SOLR-8886</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12845571">SOLR-7797</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12795137" name="SOLR-8865.patch" size="15351" author="yseeley@gmail.com" created="Wed, 23 Mar 2016 19:06:19 -0700"/>
                            <attachment id="12794918" name="SOLR-8865.patch" size="13290" author="yseeley@gmail.com" created="Tue, 22 Mar 2016 19:07:25 -0700"/>
                            <attachment id="12794317" name="SOLR-8865.patch" size="6659" author="ichattopadhyaya" created="Fri, 18 Mar 2016 22:15:46 -0700"/>
                            <attachment id="12794282" name="SOLR-8865.patch" size="4909" author="ichattopadhyaya" created="Fri, 18 Mar 2016 15:56:23 -0700"/>
                            <attachment id="12793915" name="SOLR-8865.patch" size="842" author="ichattopadhyaya" created="Wed, 16 Mar 2016 21:36:38 -0700"/>
                            <attachment id="12793912" name="SOLR-8865.patch" size="843" author="ichattopadhyaya" created="Wed, 16 Mar 2016 21:27:03 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 17 Mar 2016 04:00:52 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 week, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2uszz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8854] Config Overlay reports phantom znodeVersion</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8854</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Stock techproduct example. Calling &lt;a href="http://localhost:8983/solr/techproducts/config/overlay" class="external-link" rel="nofollow"&gt;http://localhost:8983/solr/techproducts/config/overlay&lt;/a&gt; returns&lt;/p&gt;
&lt;div class="preformatted panel" style="border-width: 1px;"&gt;&lt;div class="preformattedContent panelContent"&gt;
&lt;pre&gt;{
  "responseHeader":{
    "status":0,
    "QTime":4},
  "overlay":{"znodeVersion":-1}}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This *&lt;b&gt;znodeVersion&lt;/b&gt;* is phantom for several reasons:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;There is no configoverlay.json file on the filesystem where all overlay properties are supposed to be stored&lt;/li&gt;
	&lt;li&gt;The overall config endpoint does not include this property even though it is supposed to be the superset of properties&lt;/li&gt;
	&lt;li&gt;What is this parameter doing in the non-cloud installation?&lt;/li&gt;
&lt;/ol&gt;

</description>
                <environment/>
        <key id="12950763">SOLR-8854</key>
            <summary>Config Overlay reports phantom znodeVersion</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="arafalov">Alexandre Rafalovitch</reporter>
                        <labels>
                    </labels>
                <created>Wed, 16 Mar 2016 00:29:22 -0700</created>
                <updated>Wed, 16 Mar 2016 00:29:22 -0700</updated>
                                            <version>5.5</version>
                    <version>6.0</version>
                                    <fixVersion>6.0</fixVersion>
                                    <component>config-api</component>
                        <due/>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                        <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ur2v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>

<item>
            <title>[SOLR-8849] ChaosMonkey should cuase chaos in a more reproducible manner</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8849</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Looking into the ChaosMonkey code a bit, and it seems like this class &amp;#8211; particularly the way &lt;tt&gt;monkeyThread&lt;/tt&gt; is defined &amp;#8211; uses randomness in a way that makes it extremely unlikely that it will ever create reproducible failures.&lt;/p&gt;

&lt;p&gt;Obviously in any test where there are multiple concurrent threads, timing issues might prevent test reproducibility &amp;#8211; but in this case, even the sequence of "chaos" actions the monkeyThread takes won't be reproducible if anyother concurrent test thread accesses &lt;tt&gt;LuceneTestCase.random()&lt;/tt&gt; ...&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
      &lt;span class="code-keyword"&gt;public&lt;/span&gt; void run() {
        &lt;span class="code-keyword"&gt;while&lt;/span&gt; (!stop) {
          &lt;span class="code-keyword"&gt;try&lt;/span&gt; {
    
            Random random = LuceneTestCase.random();
            &lt;span class="code-comment"&gt;// ... lots of stuff using random, or calling methods that use LuceneTestCase.random() directly&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It seems like it would be a lot better if ChaosMonkey's constructor created it's own private &lt;tt&gt;Random chaosRand&lt;/tt&gt; using &lt;tt&gt;LuceneTestCase.random()&lt;/tt&gt; as a seed, and then used &lt;tt&gt;chaosRand&lt;/tt&gt; to make all random choices in it's methods.&lt;/p&gt;

&lt;p&gt;That way at least the sequence of chaotic operations made by ChaosMonkey would be consistent for a given test seed, even if the exact timing/interleaving of those operations relative to other operations by other threads couldn't be garunteed.&lt;/p&gt;</description>
                <environment/>
        <key id="12950109">SOLR-8849</key>
            <summary>ChaosMonkey should cuase chaos in a more reproducible manner</summary>
                <type id="6" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/requirement.png">Test</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hossman">Hoss Man</assignee>
                                    <reporter username="hossman">Hoss Man</reporter>
                        <labels>
                    </labels>
                <created>Mon, 14 Mar 2016 16:29:12 -0700</created>
                <updated>Tue, 15 Mar 2016 12:48:59 -0700</updated>
                            <resolved>Tue, 15 Mar 2016 12:48:59 -0700</resolved>
                                                    <fixVersion>6.0</fixVersion>
                    <fixVersion>master</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="15194384" author="hossman" created="Mon, 14 Mar 2016 16:31:31 -0700">&lt;p&gt;i'm happy to work on this, but before i spend any time on it i'd appreciate if &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com" class="user-hover" rel="markrmiller@gmail.com"&gt;Mark Miller&lt;/a&gt; or someone else equally familiar with ChaosMonkey could sanity check my assessment (i can't imagine the current behavior is intentionally desired, but it also seems like it would have been totally obvious when initially written this way, so i'm not sure why it wasn't caught then)&lt;/p&gt;</comment>
                            <comment id="15194395" author="markrmiller@gmail.com" created="Mon, 14 Mar 2016 16:37:22 -0700">&lt;p&gt;Makes sense to me. I don't see a problem with the change. &lt;/p&gt;</comment>
                            <comment id="15194476" author="hossman" created="Mon, 14 Mar 2016 17:41:35 -0700">&lt;p&gt;proposed patch.&lt;/p&gt;

&lt;p&gt;in addition to cleaning up the random usage, this also refactors the non-loop/sleep portions of the monkeyThread into a new &lt;tt&gt;public void causeSomeChaos()&lt;/tt&gt; method.&lt;/p&gt;

&lt;p&gt;this way, it's possible to write a (single threaded) test with 100% reproducible chaos w/o needing to write your own random decision making about what chaos methods to call.&lt;/p&gt;</comment>
                            <comment id="15195857" author="jira-bot" created="Tue, 15 Mar 2016 11:18:35 -0700">&lt;p&gt;Commit 0bafb171083f58034900a31f83feb8f09b26bc04 in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hossman_lucene%40fucit.org" class="user-hover" rel="hossman_lucene@fucit.org"&gt;Chris Hostetter&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=0bafb17" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=0bafb17&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8849" title="ChaosMonkey should cuase chaos in a more reproducible manner" class="issue-link" data-issue-key="SOLR-8849"&gt;&lt;del&gt;SOLR-8849&lt;/del&gt;&lt;/a&gt;: improve reproducibility in random order of chaosmonkey actions&lt;/p&gt;</comment>
                            <comment id="15195858" author="jira-bot" created="Tue, 15 Mar 2016 11:18:36 -0700">&lt;p&gt;Commit 0739f9155b80fdacb90309159523258452b27484 in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hossman_lucene%40fucit.org" class="user-hover" rel="hossman_lucene@fucit.org"&gt;Chris Hostetter&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=0739f91" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=0739f91&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8849" title="ChaosMonkey should cuase chaos in a more reproducible manner" class="issue-link" data-issue-key="SOLR-8849"&gt;&lt;del&gt;SOLR-8849&lt;/del&gt;&lt;/a&gt;: improve reproducibility in random order of chaosmonkey actions&lt;/p&gt;</comment>
                            <comment id="15195860" author="jira-bot" created="Tue, 15 Mar 2016 11:18:39 -0700">&lt;p&gt;Commit 0f78235b9450ed7a81313dd9c7b9d7dfa4b57ee3 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hossman_lucene%40fucit.org" class="user-hover" rel="hossman_lucene@fucit.org"&gt;Chris Hostetter&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=0f78235" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=0f78235&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8849" title="ChaosMonkey should cuase chaos in a more reproducible manner" class="issue-link" data-issue-key="SOLR-8849"&gt;&lt;del&gt;SOLR-8849&lt;/del&gt;&lt;/a&gt;: improve reproducibility in random order of chaosmonkey actions&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12793451" name="SOLR-8849.patch" size="5774" author="hossman" created="Mon, 14 Mar 2016 17:41:35 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 14 Mar 2016 23:37:22 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2un1r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8838] Returning non-stored docValues is incorrect for floats and doubles</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8838</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;In &lt;a href="https://issues.apache.org/jira/browse/SOLR-8220" title="Read field from docValues for non stored fields" class="issue-link" data-issue-key="SOLR-8220"&gt;&lt;del&gt;SOLR-8220&lt;/del&gt;&lt;/a&gt;, we introduced returning non-stored docValues as if they were regular stored fields. The handling of doubles and floats, as introduced there, was incorrect for negative values.&lt;/p&gt;</description>
                <environment/>
        <key id="12949751">SOLR-8838</key>
            <summary>Returning non-stored docValues is incorrect for floats and doubles</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="steve_rowe">Steve Rowe</assignee>
                                    <reporter username="ichattopadhyaya">Ishan Chattopadhyaya</reporter>
                        <labels>
                    </labels>
                <created>Sun, 13 Mar 2016 21:46:46 -0700</created>
                <updated>Mon, 25 Apr 2016 09:27:30 -0700</updated>
                            <resolved>Mon, 25 Apr 2016 09:27:30 -0700</resolved>
                                    <version>5.5</version>
                                    <fixVersion>5.5.1</fixVersion>
                    <fixVersion>5.6</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="15192737" author="ichattopadhyaya" created="Sun, 13 Mar 2016 21:50:53 -0700">&lt;p&gt;Here's a patch for this. Modified the test to randomly try indexing/retrieving negative or positive floats/doubles.&lt;/p&gt;</comment>
                            <comment id="15192738" author="ichattopadhyaya" created="Sun, 13 Mar 2016 21:53:52 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalinmangar" class="user-hover" rel="shalinmangar"&gt;Shalin Shekhar Mangar&lt;/a&gt;, &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nknize" class="user-hover" rel="nknize"&gt;Nicholas Knize&lt;/a&gt;, Marking this as a blocker for 6.0, but please feel free to change this as necessary.&lt;/p&gt;</comment>
                            <comment id="15192741" author="ichattopadhyaya" created="Sun, 13 Mar 2016 21:58:51 -0700">&lt;p&gt;&lt;del&gt;There is this same problem for multiValued fields as well, I'm working on the fix for that.&lt;/del&gt;&lt;br/&gt;
Actually, multivalued fields are working fine.&lt;/p&gt;</comment>
                            <comment id="15198345" author="steve_rowe" created="Wed, 16 Mar 2016 15:44:11 -0700">&lt;p&gt;Patch with more randomization of values in &lt;tt&gt;TestUseDocValuesAsStored&lt;/tt&gt;.  I beasted this for a while with lots more iterations and it held up, so I think we're good to go.&lt;/p&gt;

&lt;p&gt;I'll commit once it passes precommit.&lt;/p&gt;</comment>
                            <comment id="15198366" author="jira-bot" created="Wed, 16 Mar 2016 15:56:40 -0700">&lt;p&gt;Commit 6e55135be3a8194db42a91de65d7746f0fc50332 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe" class="user-hover" rel="steve_rowe"&gt;Steve Rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=6e55135" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=6e55135&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8838" title="Returning non-stored docValues is incorrect for floats and doubles" class="issue-link" data-issue-key="SOLR-8838"&gt;&lt;del&gt;SOLR-8838&lt;/del&gt;&lt;/a&gt;: Returning non-stored docValues is incorrect for negative floats and doubles.&lt;/p&gt;</comment>
                            <comment id="15198370" author="jira-bot" created="Wed, 16 Mar 2016 15:58:59 -0700">&lt;p&gt;Commit 3cdde08ff2b77c52aa2eeb12c936da8c118e6dc2 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe" class="user-hover" rel="steve_rowe"&gt;Steve Rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3cdde08" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3cdde08&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8838" title="Returning non-stored docValues is incorrect for floats and doubles" class="issue-link" data-issue-key="SOLR-8838"&gt;&lt;del&gt;SOLR-8838&lt;/del&gt;&lt;/a&gt;: Remove obsolete comment&lt;/p&gt;</comment>
                            <comment id="15198372" author="jira-bot" created="Wed, 16 Mar 2016 16:01:39 -0700">&lt;p&gt;Commit efad5807b6b3e109201ba11c218750ee1e444185 in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe" class="user-hover" rel="steve_rowe"&gt;Steve Rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=efad580" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=efad580&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8838" title="Returning non-stored docValues is incorrect for floats and doubles" class="issue-link" data-issue-key="SOLR-8838"&gt;&lt;del&gt;SOLR-8838&lt;/del&gt;&lt;/a&gt;: Returning non-stored docValues is incorrect for negative floats and doubles.&lt;/p&gt;</comment>
                            <comment id="15198374" author="jira-bot" created="Wed, 16 Mar 2016 16:01:42 -0700">&lt;p&gt;Commit e30551db2a1a195c4b6c320f05beb10879aa3318 in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe" class="user-hover" rel="steve_rowe"&gt;Steve Rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e30551d" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e30551d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8838" title="Returning non-stored docValues is incorrect for floats and doubles" class="issue-link" data-issue-key="SOLR-8838"&gt;&lt;del&gt;SOLR-8838&lt;/del&gt;&lt;/a&gt;: Remove obsolete comment&lt;/p&gt;</comment>
                            <comment id="15198376" author="jira-bot" created="Wed, 16 Mar 2016 16:05:32 -0700">&lt;p&gt;Commit d5e437315a3d936b8cae8375e8ea0eb0c7d69722 in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe" class="user-hover" rel="steve_rowe"&gt;Steve Rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d5e4373" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d5e4373&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8838" title="Returning non-stored docValues is incorrect for floats and doubles" class="issue-link" data-issue-key="SOLR-8838"&gt;&lt;del&gt;SOLR-8838&lt;/del&gt;&lt;/a&gt;: Returning non-stored docValues is incorrect for negative floats and doubles.&lt;/p&gt;</comment>
                            <comment id="15198377" author="jira-bot" created="Wed, 16 Mar 2016 16:06:16 -0700">&lt;p&gt;Commit 92ac775ebcbb97672b818c52429025f2a3afe4bd in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe" class="user-hover" rel="steve_rowe"&gt;Steve Rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=92ac775" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=92ac775&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8838" title="Returning non-stored docValues is incorrect for floats and doubles" class="issue-link" data-issue-key="SOLR-8838"&gt;&lt;del&gt;SOLR-8838&lt;/del&gt;&lt;/a&gt;: Remove obsolete comment&lt;/p&gt;</comment>
                            <comment id="15198520" author="jira-bot" created="Wed, 16 Mar 2016 18:01:31 -0700">&lt;p&gt;Commit 11fd447860f5400c2fcf880bde9477e164606971 in lucene-solr's branch refs/heads/branch_5_5 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe" class="user-hover" rel="steve_rowe"&gt;Steve Rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=11fd447" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=11fd447&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8838" title="Returning non-stored docValues is incorrect for floats and doubles" class="issue-link" data-issue-key="SOLR-8838"&gt;&lt;del&gt;SOLR-8838&lt;/del&gt;&lt;/a&gt;: Returning non-stored docValues is incorrect for negative floats and doubles.&lt;/p&gt;</comment>
                            <comment id="15198521" author="jira-bot" created="Wed, 16 Mar 2016 18:01:32 -0700">&lt;p&gt;Commit 44f9569d32a6b84126a91e39ddc598c374adeaab in lucene-solr's branch refs/heads/branch_5_5 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe" class="user-hover" rel="steve_rowe"&gt;Steve Rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=44f9569" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=44f9569&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8838" title="Returning non-stored docValues is incorrect for floats and doubles" class="issue-link" data-issue-key="SOLR-8838"&gt;&lt;del&gt;SOLR-8838&lt;/del&gt;&lt;/a&gt;: Returning non-stored docValues is incorrect for negative floats and doubles.&lt;/p&gt;</comment>
                            <comment id="15198522" author="jira-bot" created="Wed, 16 Mar 2016 18:01:33 -0700">&lt;p&gt;Commit 34b813c34f6a3d32b77c8f16bbbde2ee1a06924b in lucene-solr's branch refs/heads/branch_5_5 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe" class="user-hover" rel="steve_rowe"&gt;Steve Rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=34b813c" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=34b813c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8838" title="Returning non-stored docValues is incorrect for floats and doubles" class="issue-link" data-issue-key="SOLR-8838"&gt;&lt;del&gt;SOLR-8838&lt;/del&gt;&lt;/a&gt;: Remove obsolete comment&lt;/p&gt;</comment>
                            <comment id="15198523" author="jira-bot" created="Wed, 16 Mar 2016 18:01:34 -0700">&lt;p&gt;Commit d3d5439bf2790868b8a5dde7d888401f2094d1f3 in lucene-solr's branch refs/heads/branch_5_5 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe" class="user-hover" rel="steve_rowe"&gt;Steve Rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d3d5439" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d3d5439&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8838" title="Returning non-stored docValues is incorrect for floats and doubles" class="issue-link" data-issue-key="SOLR-8838"&gt;&lt;del&gt;SOLR-8838&lt;/del&gt;&lt;/a&gt;: java8 date handling -&amp;gt; java7&lt;/p&gt;</comment>
                            <comment id="15198551" author="ichattopadhyaya" created="Wed, 16 Mar 2016 18:27:30 -0700">&lt;p&gt;Thanks Steve!&lt;/p&gt;</comment>
                            <comment id="15254156" author="anshumg" created="Fri, 22 Apr 2016 09:17:24 -0700">&lt;p&gt;Reopening to port to 5x branch so we don't regress if there is a 5.6 release at some point.&lt;/p&gt;</comment>
                            <comment id="15255027" author="jira-bot" created="Fri, 22 Apr 2016 18:51:45 -0700">&lt;p&gt;Commit db853d4983f3d7b6b55f70f3025444e733d44250 in lucene-solr's branch refs/heads/branch_5x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe" class="user-hover" rel="steve_rowe"&gt;Steve Rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=db853d4" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=db853d4&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8838" title="Returning non-stored docValues is incorrect for floats and doubles" class="issue-link" data-issue-key="SOLR-8838"&gt;&lt;del&gt;SOLR-8838&lt;/del&gt;&lt;/a&gt;: Returning non-stored docValues is incorrect for negative floats and doubles.&lt;/p&gt;</comment>
                            <comment id="15255028" author="jira-bot" created="Fri, 22 Apr 2016 18:51:46 -0700">&lt;p&gt;Commit 404a3f995673d54bc7565dea934332e1cd37d4c3 in lucene-solr's branch refs/heads/branch_5x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe" class="user-hover" rel="steve_rowe"&gt;Steve Rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=404a3f9" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=404a3f9&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8838" title="Returning non-stored docValues is incorrect for floats and doubles" class="issue-link" data-issue-key="SOLR-8838"&gt;&lt;del&gt;SOLR-8838&lt;/del&gt;&lt;/a&gt;: Returning non-stored docValues is incorrect for negative floats and doubles.&lt;/p&gt;</comment>
                            <comment id="15255029" author="jira-bot" created="Fri, 22 Apr 2016 18:51:48 -0700">&lt;p&gt;Commit 496a7535115c13c25fe6c12b7f463477c9426098 in lucene-solr's branch refs/heads/branch_5x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe" class="user-hover" rel="steve_rowe"&gt;Steve Rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=496a753" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=496a753&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8838" title="Returning non-stored docValues is incorrect for floats and doubles" class="issue-link" data-issue-key="SOLR-8838"&gt;&lt;del&gt;SOLR-8838&lt;/del&gt;&lt;/a&gt;: Remove obsolete comment&lt;/p&gt;</comment>
                            <comment id="15255030" author="jira-bot" created="Fri, 22 Apr 2016 18:51:49 -0700">&lt;p&gt;Commit 33462956c6e2e1cc1d23afeb947c9688f00ba490 in lucene-solr's branch refs/heads/branch_5x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe" class="user-hover" rel="steve_rowe"&gt;Steve Rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3346295" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3346295&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8838" title="Returning non-stored docValues is incorrect for floats and doubles" class="issue-link" data-issue-key="SOLR-8838"&gt;&lt;del&gt;SOLR-8838&lt;/del&gt;&lt;/a&gt;: java8 date handling -&amp;gt; java7&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12895270">SOLR-8082</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12793874" name="SOLR-8838.patch" size="13505" author="steve_rowe" created="Wed, 16 Mar 2016 15:44:11 -0700"/>
                            <attachment id="12793241" name="SOLR-8838.patch" size="3875" author="ichattopadhyaya" created="Sun, 13 Mar 2016 22:21:34 -0700"/>
                            <attachment id="12793239" name="SOLR-8838.patch" size="2778" author="ichattopadhyaya" created="Sun, 13 Mar 2016 21:50:53 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 16 Mar 2016 22:44:11 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ukuv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8837] Duplicate leader elector node detection is broken</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8837</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;LeaderElector.checkIfIAmLeader checks to see if it has duplicate registrations in under its election node, but it does this by prefix checking, which means that if core_node1 registers itself after core_node11, it will think it's a duplicate, and delete the core_node11 node.&lt;/p&gt;

&lt;p&gt;This is causing regular failures in UnloadDistributedZkTest.&lt;/p&gt;</description>
                <environment/>
        <key id="12949697">SOLR-8837</key>
            <summary>Duplicate leader elector node detection is broken</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="romseygeek">Alan Woodward</assignee>
                                    <reporter username="romseygeek">Alan Woodward</reporter>
                        <labels>
                    </labels>
                <created>Sun, 13 Mar 2016 04:41:28 -0700</created>
                <updated>Thu, 21 Apr 2016 14:12:28 -0700</updated>
                            <resolved>Thu, 21 Apr 2016 14:12:28 -0700</resolved>
                                    <version>6.0</version>
                    <version>master</version>
                                    <fixVersion>5.5.1</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="15192317" author="romseygeek" created="Sun, 13 Mar 2016 04:47:28 -0700">&lt;p&gt;We can fix this by fixing the duplicate-detection logic, but I'm not sure we shouldn't just remove this entirely.  I guess it could prevent an election delay in the case that a session gets interrupted and the ephemeral nodes from the previous session hang around up to the session timeout, but it seems just as likely to cause problems to me.&lt;/p&gt;</comment>
                            <comment id="15192434" author="dragonsinth" created="Sun, 13 Mar 2016 10:33:26 -0700">&lt;p&gt;Seems like a pretty simple fix for the exact case you mentioned.  But you're right about this being a weird edge case; I definitely don't fully understand why it's there.&lt;/p&gt;</comment>
                            <comment id="15204489" author="romseygeek" created="Mon, 21 Mar 2016 08:52:29 -0700">&lt;p&gt;Thanks Scott, I'll commit this fix.  Looks like the bug crept in with &lt;a href="https://issues.apache.org/jira/browse/SOLR-8697" title="Fix LeaderElector issues" class="issue-link" data-issue-key="SOLR-8697"&gt;&lt;del&gt;SOLR-8697&lt;/del&gt;&lt;/a&gt;, so it hasn't actually been released.&lt;/p&gt;</comment>
                            <comment id="15204714" author="jira-bot" created="Mon, 21 Mar 2016 10:39:54 -0700">&lt;p&gt;Commit 04bd5860710ca5ab309d2e8b2e8fb36d3bf962bc in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=romseygeek" class="user-hover" rel="romseygeek"&gt;Alan Woodward&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=04bd586" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=04bd586&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8837" title="Duplicate leader elector node detection is broken" class="issue-link" data-issue-key="SOLR-8837"&gt;&lt;del&gt;SOLR-8837&lt;/del&gt;&lt;/a&gt;: Fix duplicate election node detection&lt;/p&gt;</comment>
                            <comment id="15204716" author="jira-bot" created="Mon, 21 Mar 2016 10:40:53 -0700">&lt;p&gt;Commit 451ff488afc4707cb8555c5629bcf0c9ebef210f in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=romseygeek" class="user-hover" rel="romseygeek"&gt;Alan Woodward&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=451ff48" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=451ff48&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8837" title="Duplicate leader elector node detection is broken" class="issue-link" data-issue-key="SOLR-8837"&gt;&lt;del&gt;SOLR-8837&lt;/del&gt;&lt;/a&gt;: Fix duplicate election node detection&lt;/p&gt;</comment>
                            <comment id="15204748" author="jira-bot" created="Mon, 21 Mar 2016 10:56:21 -0700">&lt;p&gt;Commit 9a4c1dd15c80ec3265b8be5dc716672ec9a9973d in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=romseygeek" class="user-hover" rel="romseygeek"&gt;Alan Woodward&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9a4c1dd" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9a4c1dd&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8837" title="Duplicate leader elector node detection is broken" class="issue-link" data-issue-key="SOLR-8837"&gt;&lt;del&gt;SOLR-8837&lt;/del&gt;&lt;/a&gt;: Fix duplicate election node detection&lt;/p&gt;</comment>
                            <comment id="15252319" author="anshumg" created="Thu, 21 Apr 2016 10:49:02 -0700">&lt;p&gt;Reopening to back port for 5.5.1&lt;/p&gt;</comment>
                            <comment id="15252651" author="jira-bot" created="Thu, 21 Apr 2016 13:39:40 -0700">&lt;p&gt;Commit 0b7b28a04157f4a74020ea79a29ad74c280f137f in lucene-solr's branch refs/heads/branch_5x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=romseygeek" class="user-hover" rel="romseygeek"&gt;Alan Woodward&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=0b7b28a" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=0b7b28a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8837" title="Duplicate leader elector node detection is broken" class="issue-link" data-issue-key="SOLR-8837"&gt;&lt;del&gt;SOLR-8837&lt;/del&gt;&lt;/a&gt;: Fix duplicate election node detection&lt;/p&gt;</comment>
                            <comment id="15252753" author="jira-bot" created="Thu, 21 Apr 2016 14:11:46 -0700">&lt;p&gt;Commit 55ac1ab95819f307f8056f8ddffbdd349ea51247 in lucene-solr's branch refs/heads/branch_5_5 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=romseygeek" class="user-hover" rel="romseygeek"&gt;Alan Woodward&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=55ac1ab" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=55ac1ab&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8837" title="Duplicate leader elector node detection is broken" class="issue-link" data-issue-key="SOLR-8837"&gt;&lt;del&gt;SOLR-8837&lt;/del&gt;&lt;/a&gt;: Fix duplicate election node detection&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12940265">SOLR-8697</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12793206" name="SOLR-8837.patch" size="756" author="dragonsinth" created="Sun, 13 Mar 2016 10:33:26 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 13 Mar 2016 17:33:26 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ukiv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8836] /update should return BAD REQUEST when invalid JSON provided</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8836</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;When a user provides invalid JSON to the /update endpoint, the request fails with a 500 (INTERNAL SERVER ERROR).  If the user looks at the response body, they'll see a message indicating that the provided JSON was invalid.  However, going from the status code alone, the failure is indistinguishable from a true server-error.  This is a bit misleading.  It would be nice if Solr instead returned a 400 (BAD REQUEST) status code when it detects invalid arguments.&lt;/p&gt;

&lt;p&gt;Reproduction Steps:&lt;br/&gt;
1.) bin/solr start -e cloud -noprompt&lt;br/&gt;
2.) curl -i -l -k -X POST -H 'Content-Type: application/json' 'http://localhost:8983/solr/gettingstarted/update' --data-binary '}{'&lt;/p&gt;

</description>
                <environment/>
        <key id="12949657">SOLR-8836</key>
            <summary>/update should return BAD REQUEST when invalid JSON provided</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="5" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.png">Trivial</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="anshumg">Anshum Gupta</assignee>
                                    <reporter username="gerlowskija">Jason Gerlowski</reporter>
                        <labels>
                    </labels>
                <created>Sat, 12 Mar 2016 20:24:56 -0700</created>
                <updated>Tue, 15 Mar 2016 12:16:48 -0700</updated>
                            <resolved>Tue, 15 Mar 2016 12:16:48 -0700</resolved>
                                    <version>master</version>
                                    <fixVersion>6.0</fixVersion>
                    <fixVersion>master</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="15192105" author="gerlowskija" created="Sat, 12 Mar 2016 20:33:43 -0700">&lt;p&gt;A simple patch demonstrating a fix for the issue.  With this fix, /update answers invalid JSON with the response:&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
[~/c/s/l/solr] $ curl -i -l -k -X POST -H 'Content-Type: application/json' 'http:&lt;span class="code-comment"&gt;//localhost:7574/solr/gettingstarted/update' --data-binary '}{'
&lt;/span&gt;HTTP/1.1 400 Bad Request

{&lt;span class="code-quote"&gt;"responseHeader"&lt;/span&gt;:{&lt;span class="code-quote"&gt;"status"&lt;/span&gt;:400,&lt;span class="code-quote"&gt;"QTime"&lt;/span&gt;:11},&lt;span class="code-quote"&gt;"error"&lt;/span&gt;:{&lt;span class="code-quote"&gt;"metadata"&lt;/span&gt;:[&lt;span class="code-quote"&gt;"error-class"&lt;/span&gt;,&lt;span class="code-quote"&gt;"org.apache.solr.common.SolrException"&lt;/span&gt;,&lt;span class="code-quote"&gt;"root-error-class"&lt;/span&gt;,&lt;span class="code-quote"&gt;"org.noggit.JSONParser$ParseException"&lt;/span&gt;],&lt;span class="code-quote"&gt;"msg"&lt;/span&gt;:&lt;span class="code-quote"&gt;"org.noggit.JSONParser$ParseException: JSON Parse Error: &lt;span class="code-object"&gt;char&lt;/span&gt;=},position=0 BEFORE='}' AFTER='{'"&lt;/span&gt;,&lt;span class="code-quote"&gt;"code"&lt;/span&gt;:400}}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This fixes the status code, but the response body is a little odd.  I'm not quite sure where the "metadata", "error-class", "root-error-class" nesting comes from.  Still some details of Solr's error reporting that I'm brushing up on; bit of a work-in-progress.&lt;/p&gt;</comment>
                            <comment id="15192507" author="gerlowskija" created="Sun, 13 Mar 2016 12:52:52 -0700">&lt;p&gt;Looking into Solr's error messages more, I think the error-message is pretty standard when SolrException is used.  So I'm fine with it now.&lt;/p&gt;

&lt;p&gt;Latest patch adds a test, which ensures 400 is returned.  All tests pass locally.&lt;/p&gt;

&lt;p&gt;Patch should be ready for review if anyone has interest in seeing this change get in.&lt;/p&gt;</comment>
                            <comment id="15193418" author="anshumg" created="Mon, 14 Mar 2016 08:03:03 -0700">&lt;p&gt;Thanks Jason. &lt;br/&gt;
LGTM, I'll run the tests and commit.&lt;/p&gt;</comment>
                            <comment id="15195849" author="jira-bot" created="Tue, 15 Mar 2016 11:15:33 -0700">&lt;p&gt;Commit 30a77b73b603ba52a50da397aefc6f9a88f05732 in lucene-solr's branch refs/heads/master from anshum&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=30a77b7" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=30a77b7&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8836" title="/update should return BAD REQUEST when invalid JSON provided" class="issue-link" data-issue-key="SOLR-8836"&gt;&lt;del&gt;SOLR-8836&lt;/del&gt;&lt;/a&gt;: Return 400, and a SolrException when an invalid json is provided to the update handler instead of 500.&lt;/p&gt;</comment>
                            <comment id="15195953" author="jira-bot" created="Tue, 15 Mar 2016 11:50:32 -0700">&lt;p&gt;Commit 4deb4cd1bac4d18914164fccc3e377eb8f11a117 in lucene-solr's branch refs/heads/branch_6x from anshum&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=4deb4cd" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=4deb4cd&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8836" title="/update should return BAD REQUEST when invalid JSON provided" class="issue-link" data-issue-key="SOLR-8836"&gt;&lt;del&gt;SOLR-8836&lt;/del&gt;&lt;/a&gt;: Return 400, and a SolrException when an invalid json is provided to the update handler instead of 500.&lt;/p&gt;</comment>
                            <comment id="15196014" author="jira-bot" created="Tue, 15 Mar 2016 12:16:25 -0700">&lt;p&gt;Commit cd070d7b17955fc3cc10f013e9694946c5ce1c88 in lucene-solr's branch refs/heads/branch_6_0 from anshum&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=cd070d7" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=cd070d7&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8836" title="/update should return BAD REQUEST when invalid JSON provided" class="issue-link" data-issue-key="SOLR-8836"&gt;&lt;del&gt;SOLR-8836&lt;/del&gt;&lt;/a&gt;: Return 400, and a SolrException when an invalid json is provided to the update handler instead of 500.&lt;/p&gt;</comment>
                            <comment id="15196016" author="anshumg" created="Tue, 15 Mar 2016 12:16:48 -0700">&lt;p&gt;Thanks Jason.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12793214" name="SOLR-8836.patch" size="2807" author="gerlowskija" created="Sun, 13 Mar 2016 12:52:52 -0700"/>
                            <attachment id="12793180" name="SOLR-8836.patch" size="1393" author="gerlowskija" created="Sat, 12 Mar 2016 20:33:43 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 14 Mar 2016 15:03:03 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2uk9r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8835] fix multi-valued numeric docvalues faceting</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8835</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;The new facet module doesn't work with multi-valued numeric docValues fields.&lt;/p&gt;</description>
                <environment/>
        <key id="12949652">SOLR-8835</key>
            <summary>fix multi-valued numeric docvalues faceting</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yseeley@gmail.com">Yonik Seeley</assignee>
                                    <reporter username="yseeley@gmail.com">Yonik Seeley</reporter>
                        <labels>
                    </labels>
                <created>Sat, 12 Mar 2016 19:28:03 -0700</created>
                <updated>Wed, 13 Apr 2016 07:02:38 -0700</updated>
                            <resolved>Mon, 14 Mar 2016 08:35:35 -0700</resolved>
                                                    <fixVersion>5.5.1</fixVersion>
                    <fixVersion>5.6</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>Facet Module</component>
                        <due/>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="15192097" author="yseeley@gmail.com" created="Sat, 12 Mar 2016 19:58:07 -0700">&lt;p&gt;Patch attached.&lt;br/&gt;
The fallback of UnInvertedField did not work when docValues were present since DocTermOrds threw an exception.&lt;/p&gt;</comment>
                            <comment id="15193487" author="jira-bot" created="Mon, 14 Mar 2016 08:33:32 -0700">&lt;p&gt;Commit 95f20c6f00966db0b16d3abeaf12a768da83366a in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org" class="user-hover" rel="yonik@apache.org"&gt;Yonik Seeley&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=95f20c6" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=95f20c6&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8835" title="fix multi-valued numeric docvalues faceting" class="issue-link" data-issue-key="SOLR-8835"&gt;&lt;del&gt;SOLR-8835&lt;/del&gt;&lt;/a&gt;: fix faceting exception (uif) on multi-valued numeric docValues&lt;/p&gt;</comment>
                            <comment id="15193491" author="jira-bot" created="Mon, 14 Mar 2016 08:34:58 -0700">&lt;p&gt;Commit 5d7592bc14c4a20cb365e4cc8515bee92eec1f6f in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org" class="user-hover" rel="yonik@apache.org"&gt;Yonik Seeley&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=5d7592b" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=5d7592b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8835" title="fix multi-valued numeric docvalues faceting" class="issue-link" data-issue-key="SOLR-8835"&gt;&lt;del&gt;SOLR-8835&lt;/del&gt;&lt;/a&gt;: fix faceting exception (uif) on multi-valued numeric docValues&lt;/p&gt;</comment>
                            <comment id="15193492" author="jira-bot" created="Mon, 14 Mar 2016 08:35:09 -0700">&lt;p&gt;Commit da4342c8e553e20c63410b97ce80cee367d0465e in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org" class="user-hover" rel="yonik@apache.org"&gt;Yonik Seeley&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=da4342c" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=da4342c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8835" title="fix multi-valued numeric docvalues faceting" class="issue-link" data-issue-key="SOLR-8835"&gt;&lt;del&gt;SOLR-8835&lt;/del&gt;&lt;/a&gt;: fix faceting exception (uif) on multi-valued numeric docValues&lt;/p&gt;</comment>
                            <comment id="15239289" author="jira-bot" created="Wed, 13 Apr 2016 07:00:52 -0700">&lt;p&gt;Commit c17ff70baa2aa5c8be11645c578801bc805de985 in lucene-solr's branch refs/heads/branch_5x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org" class="user-hover" rel="yonik@apache.org"&gt;Yonik Seeley&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c17ff70" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c17ff70&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8835" title="fix multi-valued numeric docvalues faceting" class="issue-link" data-issue-key="SOLR-8835"&gt;&lt;del&gt;SOLR-8835&lt;/del&gt;&lt;/a&gt;: fix faceting exception (uif) on multi-valued numeric docValues&lt;/p&gt;</comment>
                            <comment id="15239290" author="jira-bot" created="Wed, 13 Apr 2016 07:01:07 -0700">&lt;p&gt;Commit 4e7b578d2f73f9ef86cb99ea1912fbc013dee7bf in lucene-solr's branch refs/heads/branch_5_5 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org" class="user-hover" rel="yonik@apache.org"&gt;Yonik Seeley&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=4e7b578" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=4e7b578&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8835" title="fix multi-valued numeric docvalues faceting" class="issue-link" data-issue-key="SOLR-8835"&gt;&lt;del&gt;SOLR-8835&lt;/del&gt;&lt;/a&gt;: fix faceting exception (uif) on multi-valued numeric docValues&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12793178" name="SOLR-8835.patch" size="9580" author="yseeley@gmail.com" created="Sat, 12 Mar 2016 19:58:07 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 14 Mar 2016 15:33:32 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2uk8n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8831] allow _version_ field to be retrievable via docValues</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8831</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Right now, one is prohibited from having an unstored &lt;em&gt;version&lt;/em&gt; field, even if docValues are enabled.&lt;/p&gt;</description>
                <environment/>
        <key id="12948974">SOLR-8831</key>
            <summary>allow _version_ field to be retrievable via docValues</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yseeley@gmail.com">Yonik Seeley</assignee>
                                    <reporter username="yseeley@gmail.com">Yonik Seeley</reporter>
                        <labels>
                    </labels>
                <created>Thu, 10 Mar 2016 18:56:18 -0700</created>
                <updated>Wed, 13 Apr 2016 17:44:08 -0700</updated>
                            <resolved>Fri, 11 Mar 2016 12:17:09 -0700</resolved>
                                                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                <comments>
                            <comment id="15190357" author="yseeley@gmail.com" created="Thu, 10 Mar 2016 19:08:53 -0700">&lt;p&gt;simple patch attached.&lt;/p&gt;</comment>
                            <comment id="15190516" author="dsmiley" created="Thu, 10 Mar 2016 23:24:07 -0700">&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="15190821" author="varunthacker" created="Fri, 11 Mar 2016 04:27:38 -0700">&lt;p&gt;Hi Yonik,&lt;/p&gt;

&lt;p&gt;Was this committed as part in &lt;a href="https://issues.apache.org/jira/browse/SOLR-5670" title="_version_ either indexed OR docvalue" class="issue-link" data-issue-key="SOLR-5670"&gt;&lt;del&gt;SOLR-5670&lt;/del&gt;&lt;/a&gt; ?&lt;/p&gt;</comment>
                            <comment id="15190825" author="ichattopadhyaya" created="Fri, 11 Mar 2016 04:38:25 -0700">&lt;p&gt;+1, this is much needed. I used to keep something like this in my patch for &lt;a href="https://issues.apache.org/jira/browse/SOLR-5944" title="Support updates of numeric DocValues" class="issue-link" data-issue-key="SOLR-5944"&gt;SOLR-5944&lt;/a&gt; (&lt;a href="https://github.com/chatman/lucene-solr/commit/627b9ac9b46796f20be78b04ebbdfa4299b96ab7#diff-040ec312b12294ee52a94eac00766ea7L77" class="external-link" rel="nofollow"&gt;https://github.com/chatman/lucene-solr/commit/627b9ac9b46796f20be78b04ebbdfa4299b96ab7#diff-040ec312b12294ee52a94eac00766ea7L77&lt;/a&gt;).&lt;/p&gt;</comment>
                            <comment id="15191075" author="jkrupan" created="Fri, 11 Mar 2016 08:46:30 -0700">&lt;p&gt;Can we come up with a nice clean term for "stored or docValues are enabled"?&lt;/p&gt;

&lt;p&gt;I mean, the issue title here is misleading, as the description then indicates - "if docValues are enabled." So, it should be "allow &lt;em&gt;version&lt;/em&gt; field to be unstored if docValues are enabled."&lt;/p&gt;

&lt;p&gt;Traditional database nomenclature is no help here since the concept of non-stored data is meaningless in a true database.&lt;/p&gt;

&lt;p&gt;Personally, I'd be happier if Solr hid a lot of the byzantine complexity of Lucene, including this odd distinction between stored and docValues. I mean, to me they are just two different implementations of the logical concept of storing data for later retreival - how the data is stored rather than whether it is stored.&lt;/p&gt;

&lt;p&gt;I'll offer two suggested simple terms to be used at the Solr level even if Lucene insists on remaining byzantine: "xstored" or "retrievable", both meaning that the field attributes make it possible for Solr to retrieve data after indexing, either because the field is stored or has docValues enabled. This is not a proposal for a feature, but simply terminology to be used to talk about fields which are... "either stored or have docValues enabled." (If I wanted a feature, it might be to have a new attribute like retrieval_storage="{by_field|by_document|none}" or... stored="{yes|no|docValues|fieldValues}".)&lt;/p&gt;

&lt;p&gt;I'm not proposing any feature here since that would be out of the scope of the issue, but since this issue needs doc, I am just proposing new terminology for that doc.&lt;/p&gt;

&lt;p&gt;Again, to summarize more briefly, I am proposed that the terminology of "retrievable" be used to refer to fields that are either stored or have docValues enabled.&lt;/p&gt;</comment>
                            <comment id="15191090" author="yseeley@gmail.com" created="Fri, 11 Mar 2016 08:59:44 -0700">&lt;blockquote&gt;&lt;p&gt;they are just two different implementations of the logical concept of storing data for later retreival &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I agree - I've been occasionally using the term "row stored" and "column stored".&lt;br/&gt;
While we won't be able to totally squash the terms "stored" or "docValues"  (too much history), in certain contexts it will certainly be easier to use an all encompassing term like "retrievable".  I'll update this patch to reflect that unless someone comes up with a better word for it.&lt;/p&gt;</comment>
                            <comment id="15191397" author="jira-bot" created="Fri, 11 Mar 2016 12:13:35 -0700">&lt;p&gt;Commit ff8cedcb11638ee52f91bf81bad2ee01f3c3d59a in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org" class="user-hover" rel="yonik@apache.org"&gt;Yonik Seeley&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ff8cedc" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ff8cedc&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8831" title="allow _version_ field to be retrievable via docValues" class="issue-link" data-issue-key="SOLR-8831"&gt;&lt;del&gt;SOLR-8831&lt;/del&gt;&lt;/a&gt;: allow &lt;em&gt;version&lt;/em&gt; field to be retrievable via docValues&lt;/p&gt;</comment>
                            <comment id="15191403" author="yseeley@gmail.com" created="Fri, 11 Mar 2016 12:16:46 -0700">&lt;p&gt;I think that was for searchability purposes... it allowed indexed OR docValues (and said nothing about stored)&lt;/p&gt;</comment>
                            <comment id="15191504" author="jkrupan" created="Fri, 11 Mar 2016 14:07:04 -0700">&lt;p&gt;Now that docValues is supported for &lt;em&gt;version&lt;/em&gt;, the question arises as to which is preferred (faster, less memory), stored or docValues. IOW, which should be the default. I presume it should be docValues, but I have no real clue.&lt;/p&gt;

&lt;p&gt;Also, the doc for Atomic Update has this example as a Power Tip, that has BOTH stored and docValues set:&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
&amp;lt;field name=&lt;span class="code-quote"&gt;"_version_"&lt;/span&gt; type=&lt;span class="code-quote"&gt;"&lt;span class="code-object"&gt;long&lt;/span&gt;"&lt;/span&gt; indexed=&lt;span class="code-quote"&gt;"&lt;span class="code-keyword"&gt;false&lt;/span&gt;"&lt;/span&gt; stored=&lt;span class="code-quote"&gt;"&lt;span class="code-keyword"&gt;true&lt;/span&gt;"&lt;/span&gt; required=&lt;span class="code-quote"&gt;"&lt;span class="code-keyword"&gt;true&lt;/span&gt;"&lt;/span&gt; docValues=&lt;span class="code-quote"&gt;"&lt;span class="code-keyword"&gt;true&lt;/span&gt;"&lt;/span&gt;/&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;See:&lt;br/&gt;
&lt;a href="https://cwiki.apache.org/confluence/display/solr/Updating+Parts+of+Documents" class="external-link" rel="nofollow"&gt;https://cwiki.apache.org/confluence/display/solr/Updating+Parts+of+Documents&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Should that be changed to stored="false"? Or, is there actually some aditional hidden benefit to store="true" AND docValues="true"?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12792638" name="SOLR-8831.patch" size="865" author="yseeley@gmail.com" created="Thu, 10 Mar 2016 19:08:53 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 11 Mar 2016 06:24:07 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2uhzr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8829] Mark CDCR as experimental in 6.0</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8829</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;A slew of improvements to CDCR viz. &lt;a href="https://issues.apache.org/jira/browse/SOLR-6465" title="CDCR: fall back to whole-index replication when tlogs are insufficient" class="issue-link" data-issue-key="SOLR-6465"&gt;SOLR-6465&lt;/a&gt;, &lt;a href="https://issues.apache.org/jira/browse/SOLR-8389" title="Convert CDCR peer cluster and other configurations into collection properties modifiable via APIs" class="issue-link" data-issue-key="SOLR-8389"&gt;SOLR-8389&lt;/a&gt;, &lt;a href="https://issues.apache.org/jira/browse/SOLR-8391" title="Convert CdcrRequestHandler into an implicitly loaded request handler" class="issue-link" data-issue-key="SOLR-8391"&gt;SOLR-8391&lt;/a&gt; are planned and on which I am actively working. Unfortunately, those won't make it to the 6.0 release. At the same time since both the amount of configuration and mode of configuration (API vs editing solrconfig.xml) will change with these planned improvements, it'd be nice to not have strong back-compat guarantees which prevent us from making CDCR easier to use.&lt;/p&gt;

&lt;p&gt;Therefore, I propose to put a note in CHANGES.txt and any documentation in the Solr reference guide to this effect as well as add an experimental response key in all CDCR API responses.&lt;/p&gt;</description>
                <environment/>
        <key id="12948876">SOLR-8829</key>
            <summary>Mark CDCR as experimental in 6.0</summary>
                <type id="5" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Wish</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="shalinmangar">Shalin Shekhar Mangar</assignee>
                                    <reporter username="shalinmangar">Shalin Shekhar Mangar</reporter>
                        <labels>
                    </labels>
                <created>Thu, 10 Mar 2016 11:54:01 -0700</created>
                <updated>Thu, 10 Mar 2016 22:24:09 -0700</updated>
                                                            <fixVersion>6.0</fixVersion>
                                    <component>CDCR</component>
                    <component>SolrCloud</component>
                        <due/>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="15189778" author="anshumg" created="Thu, 10 Mar 2016 12:17:01 -0700">&lt;p&gt;+1 to making it experimental.&lt;/p&gt;</comment>
                            <comment id="15189858" author="erickerickson" created="Thu, 10 Mar 2016 12:58:03 -0700">&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;BTW, I'm working on the CWiki docs for configuration, should have them in early next week. (or perhaps this weekend) so we'll have a home for documenting your changes.&lt;/p&gt;</comment>
                            <comment id="15190483" author="noble.paul" created="Thu, 10 Mar 2016 22:24:09 -0700">&lt;p&gt;Keeping in mind that there will be significant changes on how we use CDCR as a result of &lt;a href="https://issues.apache.org/jira/browse/SOLR-8389" title="Convert CDCR peer cluster and other configurations into collection properties modifiable via APIs" class="issue-link" data-issue-key="SOLR-8389"&gt;SOLR-8389&lt;/a&gt;, it is important to highlight that it is not just experimental , the work flow and public interfaces also will change significantly&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 10 Mar 2016 19:17:01 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2uhdz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>

<item>
            <title>[SOLR-8819] Implement DatabaseMetaDataImpl getTables() and fix getSchemas()</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8819</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;DbVisualizer NPE when clicking on DB References tab. After connecting, NPE if double click on "DB" under connection name then click on References tab.&lt;/p&gt;</description>
                <environment/>
        <key id="12948793">SOLR-8819</key>
            <summary>Implement DatabaseMetaDataImpl getTables() and fix getSchemas()</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12937649">SOLR-8659</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="10">Implemented</resolution>
                                        <assignee username="risdenk">Kevin Risden</assignee>
                                    <reporter username="risdenk">Kevin Risden</reporter>
                        <labels>
                    </labels>
                <created>Thu, 10 Mar 2016 07:34:04 -0700</created>
                <updated>Wed, 23 Mar 2016 15:35:48 -0700</updated>
                            <resolved>Wed, 23 Mar 2016 13:57:57 -0700</resolved>
                                    <version>master</version>
                                    <fixVersion>6.0</fixVersion>
                                    <component>SolrJ</component>
                        <due/>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="15190101" author="cahilltr" created="Thu, 10 Mar 2016 15:41:44 -0700">&lt;p&gt;Added a patch that fixes the NPE caused by clicking on the DB References tab by implementing the getTables() method in DatabaseMetaDataImpl.  Removed restriction of requiring the field "TABLE_CAT" when querying &lt;em&gt;CATALOGS&lt;/em&gt; by wrapping CatalogsStream in SelectStream.  Removed restriction of requiring the both the fields "TABLE_SCHEM" and "TABLE_CATALOG" when querying &lt;em&gt;SCHEMAS&lt;/em&gt; by wrapping SchemasStream in SelectStream.  Added tests as needed.&lt;/p&gt;</comment>
                            <comment id="15190990" author="risdenk" created="Fri, 11 Mar 2016 07:27:01 -0700">&lt;p&gt;Since DatabaseMetaDataImpl.getTables isn't fully implemented, it looks like it causes the following errors in DbVisualizer when clicking on the table looking icon under the table name. We should probably implement all of the return columns for DatabaseMetaDataImpl.getTables instead of just the two currently in the patch.&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
2016-03-11 08:24:34.821 FINE   870 [pool-3-thread-2 - E.] RootConnection: DatabaseMetaDataImpl.getTables(&lt;span class="code-quote"&gt;"localhost:9983"&lt;/span&gt;, &lt;span class="code-quote"&gt;"test"&lt;/span&gt;, &lt;span class="code-quote"&gt;"%"&lt;/span&gt;, &lt;span class="code-keyword"&gt;null&lt;/span&gt;)
2016-03-11 08:24:34.843 FINE   870 [ExecutorRunner-pool-2-thread-1 - E.] getting column 1 (java.lang.&lt;span class="code-object"&gt;String&lt;/span&gt;) 'TABLE_SCHEM' using getString()
2016-03-11 08:24:34.843 FINE   870 [ExecutorRunner-pool-2-thread-1 - E.] getting column 2 (java.lang.&lt;span class="code-object"&gt;String&lt;/span&gt;) 'TABLE_CATALOG' using getString()
2016-03-11 08:24:34.844 FINE   870 [ExecutorRunner-pool-2-thread-1 - Z.processResultSet] Fetched Rows: 1 Columns: 2 Exec: 0.022 Fetch: 0.000 sec
2016-03-11 08:24:34.847 WARN   870 [ExecutorRunner-pool-2-thread-1 - C.getValueAt] IndexOutOfBoundsException: row=0 column=2 rowCount=1 columnCount=2
java.lang.IndexOutOfBoundsException: Index: 2, Size: 2
	at java.util.ArrayList.rangeCheck(ArrayList.java:653)
	at java.util.ArrayList.get(ArrayList.java:429)
	at com.onseven.dbvis.K.A.C.getValueAt(Z:2606)
	at com.onseven.dbvis.K.B.B.(Z:61)
	at com.onseven.dbvis.n.I.K.(Z:2413)
	at com.onseven.dbvis.n.I.K.(Z:240)
	at com.onseven.dbvis.n.I.K.(Z:2852)
	at com.onseven.dbvis.n.I.K.execute(Z:659)
	at com.onseven.dbvis.K.B.Z.(Z:2285)
	at com.onseven.dbvis.K.B.L.(Z:1374)
	at com.onseven.dbvis.K.B.L.doInBackground(Z:1521)
	at javax.swing.SwingWorker$1.call(SwingWorker.java:295)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at javax.swing.SwingWorker.run(SwingWorker.java:334)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
	at java.lang.&lt;span class="code-object"&gt;Thread&lt;/span&gt;.run(&lt;span class="code-object"&gt;Thread&lt;/span&gt;.java:745)
2016-03-11 08:24:34.850 WARN   870 [ExecutorRunner-pool-2-thread-1 - C.getValueAt] IndexOutOfBoundsException: row=0 column=3 rowCount=1 columnCount=2
java.lang.IndexOutOfBoundsException: Index: 3, Size: 2
	at java.util.ArrayList.rangeCheck(ArrayList.java:653)
	at java.util.ArrayList.get(ArrayList.java:429)
	at com.onseven.dbvis.K.A.C.getValueAt(Z:2606)
	at com.onseven.dbvis.K.B.B.(Z:61)
	at com.onseven.dbvis.n.I.K.(Z:2413)
	at com.onseven.dbvis.n.I.K.(Z:240)
	at com.onseven.dbvis.n.I.K.(Z:2852)
	at com.onseven.dbvis.n.I.K.execute(Z:659)
	at com.onseven.dbvis.K.B.Z.(Z:2285)
	at com.onseven.dbvis.K.B.L.(Z:1374)
	at com.onseven.dbvis.K.B.L.doInBackground(Z:1521)
	at javax.swing.SwingWorker$1.call(SwingWorker.java:295)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at javax.swing.SwingWorker.run(SwingWorker.java:334)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
	at java.lang.&lt;span class="code-object"&gt;Thread&lt;/span&gt;.run(&lt;span class="code-object"&gt;Thread&lt;/span&gt;.java:745)
2016-03-11 08:24:34.853 WARN   870 [ExecutorRunner-pool-2-thread-1 - C.getValueAt] IndexOutOfBoundsException: row=0 column=4 rowCount=1 columnCount=2
java.lang.IndexOutOfBoundsException: Index: 4, Size: 2
	at java.util.ArrayList.rangeCheck(ArrayList.java:653)
	at java.util.ArrayList.get(ArrayList.java:429)
	at com.onseven.dbvis.K.A.C.getValueAt(Z:2606)
	at com.onseven.dbvis.K.B.B.(Z:61)
	at com.onseven.dbvis.n.I.K.(Z:2413)
	at com.onseven.dbvis.n.I.K.(Z:240)
	at com.onseven.dbvis.n.I.K.(Z:2852)
	at com.onseven.dbvis.n.I.K.execute(Z:659)
	at com.onseven.dbvis.K.B.Z.(Z:2285)
	at com.onseven.dbvis.K.B.L.(Z:1374)
	at com.onseven.dbvis.K.B.L.doInBackground(Z:1521)
	at javax.swing.SwingWorker$1.call(SwingWorker.java:295)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at javax.swing.SwingWorker.run(SwingWorker.java:334)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
	at java.lang.&lt;span class="code-object"&gt;Thread&lt;/span&gt;.run(&lt;span class="code-object"&gt;Thread&lt;/span&gt;.java:745)
2016-03-11 08:24:34.855 WARN   870 [ExecutorRunner-pool-2-thread-1 - C.getValueAt] IndexOutOfBoundsException: row=0 column=3 rowCount=1 columnCount=3
java.lang.IndexOutOfBoundsException: Index: 3, Size: 3
	at java.util.ArrayList.rangeCheck(ArrayList.java:653)
	at java.util.ArrayList.get(ArrayList.java:429)
	at com.onseven.dbvis.K.A.C.getValueAt(Z:2606)
	at com.jidesoft.grid.TableModelWrapperImpl.getValueAt(Unknown Source)
	at com.jidesoft.grid.DefaultTableModelWrapper.getValueAt(Unknown Source)
	at com.onseven.dbvis.K.B._.(Z:292)
	at com.onseven.dbvis.n.I.K.(Z:679)
	at com.onseven.dbvis.n.I.K.(Z:240)
	at com.onseven.dbvis.n.I.K.(Z:2852)
	at com.onseven.dbvis.n.I.K.execute(Z:659)
	at com.onseven.dbvis.K.B.Z.(Z:2285)
	at com.onseven.dbvis.K.B.L.(Z:1374)
	at com.onseven.dbvis.K.B.L.doInBackground(Z:1521)
	at javax.swing.SwingWorker$1.call(SwingWorker.java:295)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at javax.swing.SwingWorker.run(SwingWorker.java:334)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
	at java.lang.&lt;span class="code-object"&gt;Thread&lt;/span&gt;.run(&lt;span class="code-object"&gt;Thread&lt;/span&gt;.java:745)
2016-03-11 08:24:34.856 WARN   870 [ExecutorRunner-pool-2-thread-1 - C.getValueAt] IndexOutOfBoundsException: row=0 column=4 rowCount=1 columnCount=3
java.lang.IndexOutOfBoundsException: Index: 4, Size: 3
	at java.util.ArrayList.rangeCheck(ArrayList.java:653)
	at java.util.ArrayList.get(ArrayList.java:429)
	at com.onseven.dbvis.K.A.C.getValueAt(Z:2606)
	at com.jidesoft.grid.TableModelWrapperImpl.getValueAt(Unknown Source)
	at com.jidesoft.grid.DefaultTableModelWrapper.getValueAt(Unknown Source)
	at com.onseven.dbvis.K.B._.(Z:292)
	at com.onseven.dbvis.n.I.K.(Z:679)
	at com.onseven.dbvis.n.I.K.(Z:240)
	at com.onseven.dbvis.n.I.K.(Z:2852)
	at com.onseven.dbvis.n.I.K.execute(Z:659)
	at com.onseven.dbvis.K.B.Z.(Z:2285)
	at com.onseven.dbvis.K.B.L.(Z:1374)
	at com.onseven.dbvis.K.B.L.doInBackground(Z:1521)
	at javax.swing.SwingWorker$1.call(SwingWorker.java:295)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at javax.swing.SwingWorker.run(SwingWorker.java:334)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
	at java.lang.&lt;span class="code-object"&gt;Thread&lt;/span&gt;.run(&lt;span class="code-object"&gt;Thread&lt;/span&gt;.java:745)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15191105" author="risdenk" created="Fri, 11 Mar 2016 09:15:56 -0700">&lt;p&gt;Improves on &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cahilltr" class="user-hover" rel="cahilltr"&gt;Trey Cahill&lt;/a&gt;'s patch. His patch and subsequent manual testing with DbVisualizer uncovered an issue with getSchemas. We shouldn't be returning any schema information since we don't have the concept of schemas. getTables is really what we want and this is now implemented in a TablesStream.&lt;/p&gt;

&lt;p&gt;This is a change to what is returned is returned by the JDBC driver. This should be put into Solr 6 before the release so we don't have to deal with backwards compatibility issues.&lt;/p&gt;</comment>
                            <comment id="15193741" author="risdenk" created="Mon, 14 Mar 2016 10:49:50 -0700">&lt;p&gt;Fix usage of get/set Schema in ConnectionImpl.&lt;/p&gt;</comment>
                            <comment id="15193747" author="risdenk" created="Mon, 14 Mar 2016 10:52:38 -0700">&lt;p&gt;Add test file that was missed on previous patch.&lt;/p&gt;</comment>
                            <comment id="15195676" author="cahilltr" created="Tue, 15 Mar 2016 10:04:03 -0700">&lt;p&gt;Added the ability for Collection Aliases to be considered their own databases and added tests as needed.&lt;/p&gt;</comment>
                            <comment id="15197303" author="cahilltr" created="Wed, 16 Mar 2016 06:23:43 -0700">&lt;p&gt;Was seeing NPE's at times when using DBVisualizer made calls to getTables().  Was able to trace the issue back to a null ZKStateReader in the cloudSolrClient.  Calling cloudSolrClient.connect() prevents this from happening.&lt;/p&gt;</comment>
                            <comment id="15197326" author="joel.bernstein" created="Wed, 16 Mar 2016 06:41:12 -0700">&lt;p&gt;Just read the patch but haven't applied it yet. I think it looks pretty good I'll try to make some time to apply it today and test it out.&lt;/p&gt;

&lt;p&gt;We should probably hold off on collection alias support because the streaming API doesn't yet support aliases. So I don't believe SolrCloud aliases are queryable in the SQLHandler.&lt;/p&gt;

&lt;p&gt;One other very small thing is the TablesStream might make more sense as the TableStream, where each Tuple returns a single Table.&lt;/p&gt;</comment>
                            <comment id="15200226" author="cahilltr" created="Thu, 17 Mar 2016 12:41:27 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=joel.bernstein" class="user-hover" rel="joel.bernstein"&gt;Joel Bernstein&lt;/a&gt; I removed alias support and renamed TablesStreams to TableStream.  Also updated the get on cloudSolrClient.getZKStateReader() to only get once instead of twice.&lt;/p&gt;</comment>
                            <comment id="15200334" author="joel.bernstein" created="Thu, 17 Mar 2016 13:42:08 -0700">&lt;p&gt;Ok things are looking pretty good to me.&lt;/p&gt;</comment>
                            <comment id="15209141" author="jira-bot" created="Wed, 23 Mar 2016 13:49:46 -0700">&lt;p&gt;Commit dbee6591741ab5aecf3a75326a9db126aa8cd0c4 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=risdenk" class="user-hover" rel="risdenk"&gt;Kevin Risden&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=dbee659" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=dbee659&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8819" title="Implement DatabaseMetaDataImpl getTables() and fix getSchemas()" class="issue-link" data-issue-key="SOLR-8819"&gt;&lt;del&gt;SOLR-8819&lt;/del&gt;&lt;/a&gt;: Implement DatabaseMetaDataImpl getTables() and fix getSchemas(). (Trey Cahill, Joel Bernstein, Kevin Risden)&lt;/p&gt;</comment>
                            <comment id="15209150" author="jira-bot" created="Wed, 23 Mar 2016 13:54:32 -0700">&lt;p&gt;Commit 39270d9df8959067a18edfe7c1e3cdb24adce543 in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=risdenk" class="user-hover" rel="risdenk"&gt;Kevin Risden&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=39270d9" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=39270d9&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8819" title="Implement DatabaseMetaDataImpl getTables() and fix getSchemas()" class="issue-link" data-issue-key="SOLR-8819"&gt;&lt;del&gt;SOLR-8819&lt;/del&gt;&lt;/a&gt;: Implement DatabaseMetaDataImpl getTables() and fix getSchemas(). (Trey Cahill, Joel Bernstein, Kevin Risden)&lt;/p&gt;</comment>
                            <comment id="15209152" author="jira-bot" created="Wed, 23 Mar 2016 13:55:24 -0700">&lt;p&gt;Commit 658b2a4a925ed694a2c11add8c1bb81de1525294 in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=risdenk" class="user-hover" rel="risdenk"&gt;Kevin Risden&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=658b2a4" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=658b2a4&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8819" title="Implement DatabaseMetaDataImpl getTables() and fix getSchemas()" class="issue-link" data-issue-key="SOLR-8819"&gt;&lt;del&gt;SOLR-8819&lt;/del&gt;&lt;/a&gt;: Implement DatabaseMetaDataImpl getTables() and fix getSchemas(). (Trey Cahill, Joel Bernstein, Kevin Risden)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310060">
                    <name>Container</name>
                                            <outwardlinks description="contains">
                                        <issuelink>
            <issuekey id="12948792">SOLR-8818</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12948794">SOLR-8820</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12948796">SOLR-8821</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12794043" name="SOLR-8819.patch" size="15520" author="cahilltr" created="Thu, 17 Mar 2016 12:38:44 -0700"/>
                            <attachment id="12793744" name="SOLR-8819.patch" size="20234" author="cahilltr" created="Wed, 16 Mar 2016 06:21:10 -0700"/>
                            <attachment id="12793588" name="SOLR-8819.patch" size="18905" author="cahilltr" created="Tue, 15 Mar 2016 10:03:12 -0700"/>
                            <attachment id="12793357" name="SOLR-8819.patch" size="14185" author="risdenk" created="Mon, 14 Mar 2016 10:52:38 -0700"/>
                            <attachment id="12793356" name="SOLR-8819.patch" size="13629" author="risdenk" created="Mon, 14 Mar 2016 10:49:50 -0700"/>
                            <attachment id="12792813" name="SOLR-8819.patch" size="11220" author="risdenk" created="Fri, 11 Mar 2016 09:15:55 -0700"/>
                            <attachment id="12792597" name="SOLR-8819.patch" size="6697" author="cahilltr" created="Thu, 10 Mar 2016 15:35:21 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 10 Mar 2016 22:41:44 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ugvj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8812] ExtendedDismaxQParser (edismax) ignores Boolean OR when q.op=AND</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8812</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;The edismax parser ignores Boolean OR in queries when q.op=AND. This behavior is new to Solr 5.5.0 and an unexpected major change.&lt;/p&gt;

&lt;p&gt;Example:&lt;br/&gt;
      "q": "id:12345 OR zzzzzzzzzz",&lt;br/&gt;
      "defType": "edismax",&lt;br/&gt;
      "q.op": "AND",&lt;br/&gt;
where "12345" is a known document ID and "zzzzzzzzzz" is a string NOT present in my data&lt;/p&gt;

&lt;p&gt;Version 5.5.0 produces zero results:&lt;br/&gt;
    "rawquerystring": "id:12345 OR zzzzzzzzzz",&lt;br/&gt;
    "querystring": "id:12345 OR zzzzzzzzzz",&lt;br/&gt;
    "parsedquery": "(+((id:12345 DisjunctionMaxQuery((text:zzzzzzzzzz)))~2))/no_coord",&lt;br/&gt;
    "parsedquery_toString": "+((id:12345 (text:zzzzzzzzzz))~2)",&lt;br/&gt;
    "explain": {},&lt;br/&gt;
    "QParser": "ExtendedDismaxQParser"&lt;/p&gt;

&lt;p&gt;Version 5.4.0 produces one result as expected&lt;br/&gt;
  "rawquerystring": "id:12345 OR zzzzzzzzzz",&lt;br/&gt;
    "querystring": "id:12345 OR zzzzzzzzzz",&lt;br/&gt;
    "parsedquery": "(+(id:12345 DisjunctionMaxQuery((text:zzzzzzzzzz))))/no_coord",&lt;br/&gt;
    "parsedquery_toString": "+(id:12345 (text:zzzzzzzzzz))"&lt;br/&gt;
    "explain": {},&lt;br/&gt;
    "QParser": "ExtendedDismaxQParser"&lt;/p&gt;</description>
                <environment/>
        <key id="12948480">SOLR-8812</key>
            <summary>ExtendedDismaxQParser (edismax) ignores Boolean OR when q.op=AND</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="erickerickson">Erick Erickson</assignee>
                                    <reporter username="ryanmax">Ryan Steinberg</reporter>
                        <labels>
                    </labels>
                <created>Wed, 9 Mar 2016 11:30:47 -0700</created>
                <updated>Wed, 27 Apr 2016 20:02:21 -0700</updated>
                                            <version>5.5</version>
                                    <fixVersion>5.5.1</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>query parsers</component>
                        <due/>
                            <votes>7</votes>
                                    <watches>16</watches>
                                                                <comments>
                            <comment id="15188158" author="jkrupan" created="Wed, 9 Mar 2016 15:12:33 -0700">&lt;p&gt;The difference in the generated query appears to be the "))~2" which indicates a BooleanQuery with a minShouldMatch of 2 which means that both OR/SHOULD terms MUST match, effectively turning SHOULD/OR into MUST/AND.&lt;/p&gt;

&lt;p&gt;I'm guessing it was this 5.5 change: &lt;a href="https://issues.apache.org/jira/browse/SOLR-2649" title="MM ignored in edismax queries with operators" class="issue-link" data-issue-key="SOLR-2649"&gt;&lt;del&gt;SOLR-2649&lt;/del&gt;&lt;/a&gt;:&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
* SOLR-2649: MM ignored in edismax queries with operators.
  (Greg Pendlebury, Jan Hydahl et. al. via Erick Erickson)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I think q.op=AND simply sets MM=100%, effectively overriding the explicit OR.&lt;/p&gt;
</comment>
                            <comment id="15188444" author="ryanmax" created="Wed, 9 Mar 2016 18:25:37 -0700">&lt;p&gt;I agree: &lt;a href="https://issues.apache.org/jira/browse/SOLR-2649" title="MM ignored in edismax queries with operators" class="issue-link" data-issue-key="SOLR-2649"&gt;&lt;del&gt;SOLR-2649&lt;/del&gt;&lt;/a&gt; likely introduced this new behavior. I just read through the comments on &lt;a href="https://issues.apache.org/jira/browse/SOLR-2649" title="MM ignored in edismax queries with operators" class="issue-link" data-issue-key="SOLR-2649"&gt;&lt;del&gt;SOLR-2649&lt;/del&gt;&lt;/a&gt; and I'm still not sure this was intended: effectively, explicit OR is no longer possible when q.op=AND, even in the absence of an explicit mm param. After reading this &lt;a href="https://lucidworks.com/blog/2011/12/28/why-not-and-or-and-not/" class="external-link" rel="nofollow"&gt;helpful blog post&lt;/a&gt; referenced in the ExtendedDismaxQParser unit test, I now understand that AND takes precedence over OR but I'm not sure this is a clearly documented or anticipated consequence of this recent change.&lt;/p&gt;</comment>
                            <comment id="15201362" author="janhoy" created="Fri, 18 Mar 2016 04:53:43 -0700">&lt;p&gt;Attaching patch with a failing test case. It is quite shocking that we apparently did not have test coverage of basic OR with q.op=AND already??&lt;/p&gt;</comment>
                            <comment id="15201372" author="janhoy" created="Fri, 18 Mar 2016 05:03:34 -0700">&lt;p&gt;&lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/warning.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt; Promoting this bug as Blocker for now, as it directly affects correctness of many edismax queries, and likely to hit a large part of users upgrading to 5.5.0.&lt;/p&gt;</comment>
                            <comment id="15201388" author="janhoy" created="Fri, 18 Mar 2016 05:20:37 -0700">&lt;p&gt;Problem lies in &lt;tt&gt;SolrPluginUtils.setMinShouldMatch(BooleanQuery.Builder q, String spec, boolean mmAutoRelax)&lt;/tt&gt;, which before &lt;a href="https://issues.apache.org/jira/browse/SOLR-2649" title="MM ignored in edismax queries with operators" class="issue-link" data-issue-key="SOLR-2649"&gt;&lt;del&gt;SOLR-2649&lt;/del&gt;&lt;/a&gt; was only ever called if the query did not contain explicit &lt;tt&gt;OR&lt;/tt&gt; or &lt;tt&gt;NOT&lt;/tt&gt;, while now it is called always, but is not designed to handle those cases. The failing test has two clauses &lt;tt&gt;(text_sw:oil) (text_sw:stock)&lt;/tt&gt; both of which are &lt;tt&gt;SHOULD&lt;/tt&gt;. But still we return mm=2.&lt;/p&gt;</comment>
                            <comment id="15201408" author="janhoy" created="Fri, 18 Mar 2016 05:36:50 -0700">&lt;p&gt;Also, in &lt;a href="https://issues.apache.org/jira/browse/SOLR-2649" title="MM ignored in edismax queries with operators" class="issue-link" data-issue-key="SOLR-2649"&gt;&lt;del&gt;SOLR-2649&lt;/del&gt;&lt;/a&gt; we have&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
     &lt;span class="code-keyword"&gt;public&lt;/span&gt; ExtendedSolrQueryParser(QParser parser, &lt;span class="code-object"&gt;String&lt;/span&gt; defaultField) {
       &lt;span class="code-keyword"&gt;super&lt;/span&gt;(parser, defaultField);
-      &lt;span class="code-comment"&gt;// don't trust that our parent class won't ever change its &lt;span class="code-keyword"&gt;default&lt;/span&gt;
&lt;/span&gt;-      setDefaultOperator(QueryParser.Operator.OR);
+      &lt;span class="code-comment"&gt;// Respect the q.op parameter before mm will be applied later
&lt;/span&gt;+      SolrParams defaultParams = SolrParams.wrapDefaults(parser.getLocalParams(), parser.getParams());
+      QueryParser.Operator defaultOp = QueryParsing.getQueryParserDefaultOperator(
+          parser.getReq().getSchema(), defaultParams.get(QueryParsing.OP));
+      setDefaultOperator(defaultOp);
     }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This means the mm calculations may now get REQUIRED clauses as input, while before &lt;a href="https://issues.apache.org/jira/browse/SOLR-2649" title="MM ignored in edismax queries with operators" class="issue-link" data-issue-key="SOLR-2649"&gt;&lt;del&gt;SOLR-2649&lt;/del&gt;&lt;/a&gt; when defaultOperator was forced to OR, all clauses would enter as OPTIONAL. Since &lt;tt&gt;minShouldMatch&lt;/tt&gt; is supposed to be calculated only between optional clauses, this will fail.&lt;/p&gt;</comment>
                            <comment id="15201525" author="rjosal" created="Fri, 18 Mar 2016 07:17:10 -0700">&lt;p&gt;On the topic of &lt;a href="https://issues.apache.org/jira/browse/SOLR-2649" title="MM ignored in edismax queries with operators" class="issue-link" data-issue-key="SOLR-2649"&gt;&lt;del&gt;SOLR-2649&lt;/del&gt;&lt;/a&gt;, I just upgraded to 5.5 yesterday and &lt;a href="https://issues.apache.org/jira/browse/SOLR-2649" title="MM ignored in edismax queries with operators" class="issue-link" data-issue-key="SOLR-2649"&gt;&lt;del&gt;SOLR-2649&lt;/del&gt;&lt;/a&gt; broke one of our test cases which was "hair ties -barbie" should return hair ties but not barbie hair ties, and now it matches nothing.  I assume this is intended, but if not, maybe this ticket also addresses it?&lt;/p&gt;</comment>
                            <comment id="15217914" author="janhoy" created="Wed, 30 Mar 2016 05:45:53 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickerickson" class="user-hover" rel="erickerickson"&gt;Erick Erickson&lt;/a&gt; Should we attempt a fix for 5.5.1 or do you prefer to revert &lt;a href="https://issues.apache.org/jira/browse/SOLR-2649" title="MM ignored in edismax queries with operators" class="issue-link" data-issue-key="SOLR-2649"&gt;&lt;del&gt;SOLR-2649&lt;/del&gt;&lt;/a&gt; until there is a better patch available?&lt;/p&gt;</comment>
                            <comment id="15218104" author="erickerickson" created="Wed, 30 Mar 2016 08:06:53 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=janhoy" class="user-hover" rel="janhoy"&gt;Jan Hydahl&lt;/a&gt; I could go either way on this. As I stated in &lt;a href="https://issues.apache.org/jira/browse/SOLR-2649" title="MM ignored in edismax queries with operators" class="issue-link" data-issue-key="SOLR-2649"&gt;&lt;del&gt;SOLR-2649&lt;/del&gt;&lt;/a&gt;, though, I'm out of my depth when dealing with the parsing here, plus I'm kind of slammed for the next while.&lt;/p&gt;

&lt;p&gt;So unless someone volunteers to create a patch, I'll revert &lt;a href="https://issues.apache.org/jira/browse/SOLR-2649" title="MM ignored in edismax queries with operators" class="issue-link" data-issue-key="SOLR-2649"&gt;&lt;del&gt;SOLR-2649&lt;/del&gt;&lt;/a&gt; before any 5.5.1 release.&lt;/p&gt;</comment>
                            <comment id="15218894" author="janhoy" created="Wed, 30 Mar 2016 14:26:33 -0700">&lt;p&gt;Perhaps, after reverting, we could spend some effort adding better test coverage to edismax, to prevent similar regressions in the future.&lt;br/&gt;
Then also add a bunch more tests for &lt;a href="https://issues.apache.org/jira/browse/SOLR-2649" title="MM ignored in edismax queries with operators" class="issue-link" data-issue-key="SOLR-2649"&gt;&lt;del&gt;SOLR-2649&lt;/del&gt;&lt;/a&gt;, defining wanted behavior for all kind of corner cases.&lt;/p&gt;</comment>
                            <comment id="15219086" author="gpendleb" created="Wed, 30 Mar 2016 17:00:23 -0700">&lt;p&gt;I am happy to take a look at any issues, since I was involved in &lt;a href="https://issues.apache.org/jira/browse/SOLR-2649" title="MM ignored in edismax queries with operators" class="issue-link" data-issue-key="SOLR-2649"&gt;&lt;del&gt;SOLR-2649&lt;/del&gt;&lt;/a&gt;. I need to get a new copy of the code first, but in the interim, can someone confirm that explicitly setting mm to 0 does not fix this? I believe mm defaults to 100%, so that may be the real culprit, as opposed to q.op=AND. Before &lt;a href="https://issues.apache.org/jira/browse/SOLR-2649" title="MM ignored in edismax queries with operators" class="issue-link" data-issue-key="SOLR-2649"&gt;&lt;del&gt;SOLR-2649&lt;/del&gt;&lt;/a&gt; was resolved, setting an OR operator would have caused mm to be ignored. Now it will use the default value unless you set it explicitly.&lt;/p&gt;

&lt;p&gt;Our production servers are using 5.1 with &lt;a href="https://issues.apache.org/jira/browse/SOLR-2649" title="MM ignored in edismax queries with operators" class="issue-link" data-issue-key="SOLR-2649"&gt;&lt;del&gt;SOLR-2649&lt;/del&gt;&lt;/a&gt; applied, and we have q.op=AND, with perfectly functional OR operators and mm=0%. All of the obvious queries work, including the cases referenced above.&lt;/p&gt;

&lt;p&gt;From memory there are a lot of subtle cliffs to fall off here, such as making sure we are talking about top level clauses and ultimately remembering that Solr does not use boolean logic... and there are some edge cases where it simply doesn't work the same way as the occurs flags. SHOULD vs OR is the main culprit.&lt;/p&gt;</comment>
                            <comment id="15219120" author="ryanmax" created="Wed, 30 Mar 2016 17:29:11 -0700">&lt;p&gt;I tested explicitly setting mm to 0 and all of my tests passed. I also added a mm=0 to the failing test case from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=janhoy" class="user-hover" rel="janhoy"&gt;Jan Hydahl&lt;/a&gt; and it passed too.&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gpendleb" class="user-hover" rel="gpendleb"&gt;Greg Pendlebury&lt;/a&gt;, I think your suspicion about mm defaulting to 100% is correct.&lt;/p&gt;</comment>
                            <comment id="15219133" author="gpendleb" created="Wed, 30 Mar 2016 17:35:15 -0700">&lt;p&gt;Thanks. Hopefully that is ok. I just installed git and started cloning trunk... now to upgrade to Java 8.&lt;/p&gt;

&lt;p&gt;I think it is all working as intended, it is just that there is a confusing legacy of not having to worry about what mm was set to for some use cases. &lt;a href="https://issues.apache.org/jira/browse/SOLR-2649" title="MM ignored in edismax queries with operators" class="issue-link" data-issue-key="SOLR-2649"&gt;&lt;del&gt;SOLR-2649&lt;/del&gt;&lt;/a&gt; will force people to check what the parameters are, but all queries are now supported.&lt;/p&gt;

&lt;p&gt;It would be nice if it was less disruptive, but given that pre-patch there was no way to get edismax to do certain queries, no matter what parameters you set, I think it is still an improvement.&lt;/p&gt;</comment>
                            <comment id="15219210" author="erickerickson" created="Wed, 30 Mar 2016 19:17:05 -0700">&lt;p&gt;Thanks to you both for jumping in here. I'll see what I can do to get this into any 5.5.1 and also 6.0 (and trunk of course).&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=janhoy" class="user-hover" rel="janhoy"&gt;Jan Hydahl&lt;/a&gt; What do you think? We can raise adding tests as a separate JIRA...&lt;/p&gt;</comment>
                            <comment id="15219758" author="janhoy" created="Thu, 31 Mar 2016 04:27:15 -0700">&lt;p&gt;Setting &lt;tt&gt;q.op=AND&lt;/tt&gt;or &lt;tt&gt;mm=100%&lt;/tt&gt; should result in exactly the same behavior. The fact that setting &lt;tt&gt;mm=0&lt;/tt&gt; passes the test could be a coincidence more than a general workaround, perhaps an issue of the order things are done in the code. Would be interesting to see which code path is executed with &lt;tt&gt;q.op=AND&amp;amp;mm=0&lt;/tt&gt; though...&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickerickson" class="user-hover" rel="erickerickson"&gt;Erick Erickson&lt;/a&gt; We can add more general tests in &lt;a href="https://issues.apache.org/jira/browse/SOLR-8926" title="Better test coverage for edismax" class="issue-link" data-issue-key="SOLR-8926"&gt;SOLR-8926&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15219765" author="janhoy" created="Thu, 31 Mar 2016 04:40:48 -0700">&lt;blockquote&gt;&lt;p&gt;I think your suspicion about mm defaulting to 100% is correct.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Not entirely. The method &lt;tt&gt;DisMaxQParser#parseMinShouldMatch&lt;/tt&gt; "Applies the appropriate default rules for the "mm" param based on the effective value of the "q.op" param", i.e. if mm is not explicitly set, it is set i 0 for q.op=OR and 100% for q.op=AND.&lt;/p&gt;</comment>
                            <comment id="15220391" author="erickerickson" created="Thu, 31 Mar 2016 11:26:29 -0700">&lt;p&gt;OK, just to see if we're all on the same page. I can make this not a blocker since we have a work-around (set mm=0 when mixing q.op=AND with OR top-level clauses) and work is ongoing to clarify the interaction between q.op and mm.&lt;/p&gt;

&lt;p&gt;The code Jan pointed out sure makes this confusing. Am I correct in that the OR is honored (without setting mm=0) in a query like  q.op=AND&amp;amp;q=A and (B OR C)?&lt;/p&gt;</comment>
                            <comment id="15220618" author="janhoy" created="Thu, 31 Mar 2016 13:31:22 -0700">&lt;blockquote&gt;&lt;p&gt;I can make this not a blocker since we have a work-around&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Isn't it premature to proclaim a generic workaround, at least without more test coverage to prove so? &lt;br/&gt;
The majority of edismax users have not upgraded to 5.5.0 yet, and for many of them, existing applications and existing queries will start producing wrong results. If there is a generic workaround to add &lt;tt&gt;mm=0&lt;/tt&gt; in solrconfig.xml to get back the correct behavior, we can declare a workaround. But we cannot assume it is acceptable for people to write custom logic to conditionally change the request depending on how the user-entered query looks like. &lt;br/&gt;
That's why I lean towards reverting, since a revert will only affect the very few 5.5.0 users who rely upon the new stuff. And they have a workaround in building a custom Solr version with the patch, or waiting until 5.5.x or 6.x where a proper fix is introduced.&lt;/p&gt;</comment>
                            <comment id="15220854" author="gpendleb" created="Thu, 31 Mar 2016 16:25:13 -0700">&lt;p&gt;I don't know that what we are talking about here is a 'workaround' at all. Solr is doing exactly what it is being asked to do. I know it is disrupting an existing user base, so it warrants discussion and maybe even a 'fix'... but the existing user base were leaving a non-configured parameter at its default value (which probably didn't match their use case) and it only worked because the parameter was being ignored by edismax. The fact that parameter was ignored introduced the real bugs in &lt;a href="https://issues.apache.org/jira/browse/SOLR-2649" title="MM ignored in edismax queries with operators" class="issue-link" data-issue-key="SOLR-2649"&gt;&lt;del&gt;SOLR-2649&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I think there has always been confusion over how this works under the hood, and that still continues. q.op and mm apply to two different parts of the query, and each of them has other factors that come into play.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;q.op is a boolean operator, which happens pre-parse (or in the very earliest stages of parsing)&lt;/li&gt;
	&lt;li&gt;mm applies to (top level) clauses which have the SHOULD occur flag &lt;b&gt;after&lt;/b&gt; Solr translates all the boolean operators&lt;/li&gt;
	&lt;li&gt;if mm is not explicitly set, the default value is determined by q.op (? I haven't verified this, but that is Jan's input above). The old doco says it is always 100% default... but I personally have always set it explicitly... no experience.&lt;/li&gt;
	&lt;li&gt;Solr translates boolean operators into occurs flags differently depending on the value of q.op. In particular q.op=AND causes non-intuitive generation of occurs flags if looked at from a purely boolean perspective.&lt;/li&gt;
	&lt;li&gt;mm does not make much sense at all if you think about search as a purely boolean query (ie. the result either matches or doesn't) instead of occurs flags (ie. the score of the result is either higher or lower)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;So now that &lt;a href="https://issues.apache.org/jira/browse/SOLR-2649" title="MM ignored in edismax queries with operators" class="issue-link" data-issue-key="SOLR-2649"&gt;&lt;del&gt;SOLR-2649&lt;/del&gt;&lt;/a&gt; has come along, it slightly muddies the water because:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;q.op is no longer hard coded to OR. Pre-patch the user could say q.op=AND, but it didn't do anything to the query&lt;/li&gt;
	&lt;li&gt;The presence of an operator no longer turns off the mm feature&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&lt;b&gt;My take on the issue is that users who want to use boolean operators in edismax should pay attention to the mm parameter, and make sure their choice matches their use case&lt;/b&gt;. Previously they didn't have to... but the presence of the boolean operators when using edismax was buggy (? debatable... it has been argued that it simply wasn't the use case edismax was first written for).&lt;/p&gt;

&lt;p&gt;Having said that, IF anything was to change, I would simply play subtly with choosing the default value of mm. Maybe something like this:&lt;/p&gt;

&lt;p&gt;IF (the query contains a boolean operator) AND (mm has not been explicitly set) THEN (mm = 0%)&lt;/p&gt;

&lt;p&gt;It is a tweak on the work Jan did in &lt;a href="https://issues.apache.org/jira/browse/SOLR-2649" title="MM ignored in edismax queries with operators" class="issue-link" data-issue-key="SOLR-2649"&gt;&lt;del&gt;SOLR-2649&lt;/del&gt;&lt;/a&gt;, so that instead of turning off mm in response to a boolean operator being present, we instead influence the default value. We still let users ultimately set up their parameters however they want though. If the user has a use case that includes both boolean parameters and mm logic... have fun.&lt;/p&gt;</comment>
                            <comment id="15220908" author="janhoy" created="Thu, 31 Mar 2016 17:17:55 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gpendleb" class="user-hover" rel="gpendleb"&gt;Greg Pendlebury&lt;/a&gt; looks like you have a good command on the logic and interactions here, so feel free to throw up a patch...&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;IF (the query contains a boolean operator) AND (mm has not been explicitly set) THEN (mm = 0%)&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;In my experience some users may set mm=100% while others achieved the same with q.op=AND. Advising users to favor the use of only q.op to get boolean operators working makes the distinction hard to explain.&lt;/p&gt;

&lt;p&gt;I'm positive to applying a fix that focuses on getting the pure AND/OR 0%/100% case fixed (if that could be achieved with your proposed method), and then worry about other mm's combined with explicit operators later.&lt;/p&gt;</comment>
                            <comment id="15220925" author="gpendleb" created="Thu, 31 Mar 2016 17:31:18 -0700">&lt;p&gt;Ok, I will try to find some time over the next week or so. I freely confess it doesn't look great on a Friday afternoon and school holidays begin here after next week. It might be a rough contribution someone else can carry over the line.&lt;/p&gt;

&lt;p&gt;With regards to mixed cases of q.op and mm where users are explicitly setting them, I think they are already covered if you look in the unit test testDefaultOperatorWithMm(). The problem here seems to be the use case where people do not explicitly set mm and fall back to the default. This is treading on some expected behaviour from existing users.&lt;/p&gt;</comment>
                            <comment id="15221073" author="gpendleb" created="Thu, 31 Mar 2016 20:16:08 -0700">&lt;p&gt;Attaching possible 'fix' that defaults mm to 0% if the users has declared no explicit mm, but has boolean operators in their query.&lt;/p&gt;

&lt;p&gt;First time I have generated a patch using git, so hopefully it is ok.&lt;/p&gt;</comment>
                            <comment id="15221079" author="gpendleb" created="Thu, 31 Mar 2016 20:19:58 -0700">&lt;p&gt;I also confirmed (for my own sanity) that q.op does indeed influence the default value of mm, as per &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=janhoy" class="user-hover" rel="janhoy"&gt;Jan Hydahl&lt;/a&gt;. Personally I don't like that, and perhaps it isn't relevant anymore since &lt;a href="https://issues.apache.org/jira/browse/SOLR-2649" title="MM ignored in edismax queries with operators" class="issue-link" data-issue-key="SOLR-2649"&gt;&lt;del&gt;SOLR-2649&lt;/del&gt;&lt;/a&gt;... but I left it alone.&lt;/p&gt;</comment>
                            <comment id="15221407" author="janhoy" created="Fri, 1 Apr 2016 02:07:08 -0700">&lt;p&gt;Should we add a test case for &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rjosal" class="user-hover" rel="rjosal"&gt;Ryan Josal&lt;/a&gt;'s issue above as well? &lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;"hair ties -barbie" should return hair ties but not barbie hair ties, and now it matches nothing.&lt;/p&gt;&lt;/blockquote&gt;</comment>
                            <comment id="15222676" author="erickerickson" created="Fri, 1 Apr 2016 20:10:30 -0700">&lt;p&gt;We've got something of a time problem here. 6.0 is being released (there was an RC1, but it's being re-spun) and this JIRA is marked as a blocker.&lt;/p&gt;

&lt;p&gt;I don't think that this &lt;em&gt;should&lt;/em&gt; be a blocker for 6.0 since it's already in 5.5. And I'm reluctant to hurry a fix in to 6.0 at this late date given the discussion so far. I suspect that practically 6.0 won't be rushed into production before we get a fix for this issue (6.0.1 or 6.1 or whatever).&lt;/p&gt;

&lt;p&gt;We should fix it ASAP, but not at the expense of holding up 6.0.&lt;/p&gt;

&lt;p&gt;Thoughts?&lt;/p&gt;</comment>
                            <comment id="15223238" author="ichattopadhyaya" created="Sun, 3 Apr 2016 05:14:32 -0700">&lt;p&gt;How about initiating a 5.5.1 and 6.0.1 release immediately after the 6.0 release?&lt;/p&gt;</comment>
                            <comment id="15223568" author="gpendleb" created="Sun, 3 Apr 2016 17:35:53 -0700">&lt;p&gt;Adding a 'hair ties -barbie' example to unit tests. Not sure it demonstrates anything new, but it does work as I would expect.&lt;/p&gt;

&lt;p&gt;I can't get git to generate a combined patch the way I would have in svn... my git-fu is weak.&lt;/p&gt;</comment>
                            <comment id="15223581" author="gpendleb" created="Sun, 3 Apr 2016 17:58:09 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickerickson" class="user-hover" rel="erickerickson"&gt;Erick Erickson&lt;/a&gt;, personally, I am ambivalent with regards to timing and versions. I am still not convinced there is actually an issue here, but I don't want to be a dick and dismiss it out-of-hand.&lt;/p&gt;

&lt;p&gt;The patches provided are simply about choosing default parameter values that disrupt the least number of users who did not have mm set to an appropriate value. Any user (risky, broad generalisation incoming) who puts a boolean OR operator into an edismax query string would not want mm=100%, but that is what is happening here.&lt;/p&gt;</comment>
                            <comment id="15259298" author="erickerickson" created="Tue, 26 Apr 2016 18:07:36 -0700">&lt;p&gt;Since this hasn't really reached any sort of resolution, and since this behavior is out there in the field already I changed its status. I'll keep it on my back burner.&lt;/p&gt;

&lt;p&gt;I suspect that Jan's comments about beefing up the test cases is well taken. When I Get Some Time (tm) I'll see about beefing up the test cases (all volunteers welcome). I think it'll be easier to discuss specific test cases and whether the behavior they're testing is the desired behavior...&lt;/p&gt;</comment>
                            <comment id="15259660" author="janhoy" created="Tue, 26 Apr 2016 23:59:01 -0700">&lt;p&gt;Relevant user@ email thread, confirming the impression that this indeed must be treated as a bug: &lt;a href="http://search-lucene.com/m/eHNlru3hR1b74Oz&amp;amp;subj=How+can+I+set+the+defaultOperator+to+be+AND+" class="external-link" rel="nofollow"&gt;http://search-lucene.com/m/eHNlru3hR1b74Oz&amp;amp;subj=How+can+I+set+the+defaultOperator+to+be+AND+&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12950739">SOLR-8853</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12947640">SOLR-8796</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12513780">SOLR-2649</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12796761" name="SOLR-8812-barbie.patch" size="2753" author="gpendleb" created="Sun, 3 Apr 2016 17:35:53 -0700"/>
                            <attachment id="12796457" name="SOLR-8812.patch" size="5191" author="gpendleb" created="Thu, 31 Mar 2016 20:16:08 -0700"/>
                            <attachment id="12794179" name="SOLR-8812.patch" size="997" author="janhoy" created="Fri, 18 Mar 2016 04:53:43 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 9 Mar 2016 22:12:33 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 week, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2uexz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>

<item>
            <title>[SOLR-8810] Implement Connection.setReadOnly, Statement.set/getFetchSize, ResultSet.getType</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8810</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Connection.setReadOnly, Statement.set/getFetchSize, ResultSet.getType are necessary for IntelliJ to be able to execute queries against Solr JDBC.&lt;/p&gt;</description>
                <environment/>
        <key id="12948425">SOLR-8810</key>
            <summary>Implement Connection.setReadOnly, Statement.set/getFetchSize, ResultSet.getType</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12937649">SOLR-8659</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="10">Implemented</resolution>
                                        <assignee username="risdenk">Kevin Risden</assignee>
                                    <reporter username="risdenk">Kevin Risden</reporter>
                        <labels>
                    </labels>
                <created>Wed, 9 Mar 2016 08:49:49 -0700</created>
                <updated>Wed, 23 Mar 2016 15:35:30 -0700</updated>
                            <resolved>Wed, 23 Mar 2016 15:35:30 -0700</resolved>
                                    <version>master</version>
                                    <fixVersion>6.0</fixVersion>
                                    <component>SolrJ</component>
                        <due/>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="15187278" author="risdenk" created="Wed, 9 Mar 2016 08:51:09 -0700">&lt;p&gt;Attached patch with added tests.&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=joel.bernstein" class="user-hover" rel="joel.bernstein"&gt;Joel Bernstein&lt;/a&gt; FYI&lt;/p&gt;</comment>
                            <comment id="15187407" author="risdenk" created="Wed, 9 Mar 2016 09:57:16 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=joel.bernstein" class="user-hover" rel="joel.bernstein"&gt;Joel Bernstein&lt;/a&gt; - Is this minor enough to get into Solr 6? Since JDBC isn't released yet and should be minimal impact.&lt;/p&gt;</comment>
                            <comment id="15209314" author="jira-bot" created="Wed, 23 Mar 2016 15:31:52 -0700">&lt;p&gt;Commit a0da40204a2fc3b717b71627e10dceaa04dac8fb in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=risdenk" class="user-hover" rel="risdenk"&gt;Kevin Risden&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=a0da402" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=a0da402&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8810" title="Implement Connection.setReadOnly, Statement.set/getFetchSize, ResultSet.getType" class="issue-link" data-issue-key="SOLR-8810"&gt;&lt;del&gt;SOLR-8810&lt;/del&gt;&lt;/a&gt;: Implement Connection.setReadOnly, Statement.set/getFetchSize, ResultSet.getType&lt;/p&gt;</comment>
                            <comment id="15209320" author="jira-bot" created="Wed, 23 Mar 2016 15:34:03 -0700">&lt;p&gt;Commit 2b13210c3d113b224ccc0878f8c792942e078fd4 in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=risdenk" class="user-hover" rel="risdenk"&gt;Kevin Risden&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=2b13210" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=2b13210&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8810" title="Implement Connection.setReadOnly, Statement.set/getFetchSize, ResultSet.getType" class="issue-link" data-issue-key="SOLR-8810"&gt;&lt;del&gt;SOLR-8810&lt;/del&gt;&lt;/a&gt;: Implement Connection.setReadOnly, Statement.set/getFetchSize, ResultSet.getType&lt;/p&gt;</comment>
                            <comment id="15209323" author="jira-bot" created="Wed, 23 Mar 2016 15:35:14 -0700">&lt;p&gt;Commit 8edc535286fcadfbc361da7d7f0d1d2b0230a888 in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=risdenk" class="user-hover" rel="risdenk"&gt;Kevin Risden&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=8edc535" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=8edc535&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8810" title="Implement Connection.setReadOnly, Statement.set/getFetchSize, ResultSet.getType" class="issue-link" data-issue-key="SOLR-8810"&gt;&lt;del&gt;SOLR-8810&lt;/del&gt;&lt;/a&gt;: Implement Connection.setReadOnly, Statement.set/getFetchSize, ResultSet.getType&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12792270" name="SOLR-8810.patch" size="3748" author="risdenk" created="Wed, 9 Mar 2016 08:51:09 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 23 Mar 2016 22:31:52 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2uelr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8804] Race condition in ClusterStatus.getClusterStatus</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8804</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Reading cluster state information using &lt;tt&gt;/collections?action=CLUSTERSTATUS&lt;/tt&gt; can fail if there's a concurrent &lt;tt&gt;/collections?action=DELETE&lt;/tt&gt; operation.&lt;/p&gt;

&lt;p&gt;The code in &lt;tt&gt;ClusterStatus.getClusterStatus&lt;/tt&gt; &lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;gets collection names&lt;/li&gt;
	&lt;li&gt;for every collection reads its cluster state info using &lt;tt&gt;ClusterState.getCollection&lt;/tt&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;The problem is that if there's a &lt;tt&gt;DELETE&lt;/tt&gt; operation in between then &lt;tt&gt;ClusterState.getCollection&lt;/tt&gt; can fail thus causing the whole operation to fail. It seems that it would be better to call &lt;tt&gt;ClusterState.getCollectionOrNull&lt;/tt&gt; and skip/ignore that collection if the result is null.&lt;/p&gt;

&lt;div class="preformatted panel" style="border-width: 1px;"&gt;&lt;div class="preformattedContent panelContent"&gt;
&lt;pre&gt;19:49:32.479 [qtp1531448569-881] ERROR org.apache.solr.core.SolrCore - org.apache.solr.common.SolrException: Could not find collection : collection
    at org.apache.solr.common.cloud.ClusterState.getCollection(ClusterState.java:165)
    at org.apache.solr.handler.admin.ClusterStatus.getClusterStatus(ClusterStatus.java:110)
    at org.apache.solr.handler.admin.CollectionsHandler$CollectionOperation$19.call(CollectionsHandler.java:614)
    at org.apache.solr.handler.admin.CollectionsHandler.handleRequestBody(CollectionsHandler.java:166)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment/>
        <key id="12948094">SOLR-8804</key>
            <summary>Race condition in ClusterStatus.getClusterStatus</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="5" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.png">Trivial</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="varunthacker">Varun Thacker</assignee>
                                    <reporter username="alexey">Alexey Serba</reporter>
                        <labels>
                    </labels>
                <created>Tue, 8 Mar 2016 11:04:36 -0700</created>
                <updated>Sun, 24 Apr 2016 21:43:13 -0700</updated>
                            <resolved>Sun, 24 Apr 2016 21:43:13 -0700</resolved>
                                    <version>5.3.1</version>
                                    <fixVersion>5.5.1</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>SolrCloud</component>
                        <due/>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                <comments>
                            <comment id="15187703" author="varunthacker" created="Wed, 9 Mar 2016 12:13:44 -0700">&lt;p&gt;Patch which fixes the problem. &lt;/p&gt;</comment>
                            <comment id="15189218" author="noble.paul" created="Thu, 10 Mar 2016 05:34:13 -0700">&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="15189257" author="shalinmangar" created="Thu, 10 Mar 2016 06:06:48 -0700">&lt;p&gt;This fix isn't correct. We should throw an exception only if the user specifically asked for a collection and it doesn't exist anymore because of a concurrent delete request. In case no collection was specified in the request, we should just ignore a missing collection and continue to the next one.&lt;/p&gt;</comment>
                            <comment id="15189371" author="varunthacker" created="Thu, 10 Mar 2016 07:38:29 -0700">&lt;p&gt;Thanks Shalin for the review! Updated patch taking into account your suggestions&lt;/p&gt;</comment>
                            <comment id="15189531" author="shalinmangar" created="Thu, 10 Mar 2016 09:54:36 -0700">&lt;p&gt;+1 LGTM&lt;/p&gt;</comment>
                            <comment id="15190681" author="jira-bot" created="Fri, 11 Mar 2016 02:11:35 -0700">&lt;p&gt;Commit 343d9c6fa4ccff3d997b5b8c143b839364569ae6 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varunthacker" class="user-hover" rel="varunthacker"&gt;Varun Thacker&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=343d9c6" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=343d9c6&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8804" title="Race condition in ClusterStatus.getClusterStatus" class="issue-link" data-issue-key="SOLR-8804"&gt;&lt;del&gt;SOLR-8804&lt;/del&gt;&lt;/a&gt;: Fix a race condition in the ClusterStatus API call&lt;/p&gt;</comment>
                            <comment id="15190682" author="jira-bot" created="Fri, 11 Mar 2016 02:12:24 -0700">&lt;p&gt;Commit b8e454c1daf52b4f6126c0997e4e0b75eae9e34d in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varunthacker" class="user-hover" rel="varunthacker"&gt;Varun Thacker&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b8e454c" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b8e454c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8804" title="Race condition in ClusterStatus.getClusterStatus" class="issue-link" data-issue-key="SOLR-8804"&gt;&lt;del&gt;SOLR-8804&lt;/del&gt;&lt;/a&gt;: Fix a race condition in the ClusterStatus API call&lt;/p&gt;</comment>
                            <comment id="15190683" author="jira-bot" created="Fri, 11 Mar 2016 02:13:31 -0700">&lt;p&gt;Commit c0f69138a271f7aad67e937e99a24090986612fc in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varunthacker" class="user-hover" rel="varunthacker"&gt;Varun Thacker&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c0f6913" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c0f6913&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8804" title="Race condition in ClusterStatus.getClusterStatus" class="issue-link" data-issue-key="SOLR-8804"&gt;&lt;del&gt;SOLR-8804&lt;/del&gt;&lt;/a&gt;: Fix a race condition in the ClusterStatus API call&lt;/p&gt;</comment>
                            <comment id="15190686" author="varunthacker" created="Fri, 11 Mar 2016 02:15:41 -0700">&lt;p&gt;Thanks Alexey for reporting the issue and Noble/Shalin for the reviews! &lt;/p&gt;</comment>
                            <comment id="15254150" author="anshumg" created="Fri, 22 Apr 2016 09:12:05 -0700">&lt;p&gt;back porting for 5.5.1&lt;/p&gt;</comment>
                            <comment id="15255026" author="jira-bot" created="Fri, 22 Apr 2016 18:51:44 -0700">&lt;p&gt;Commit bf8a2c7caa2350e4764a0791cbee0c6764995e76 in lucene-solr's branch refs/heads/branch_5x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varunthacker" class="user-hover" rel="varunthacker"&gt;Varun Thacker&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=bf8a2c7" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=bf8a2c7&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8804" title="Race condition in ClusterStatus.getClusterStatus" class="issue-link" data-issue-key="SOLR-8804"&gt;&lt;del&gt;SOLR-8804&lt;/del&gt;&lt;/a&gt;: Fix a race condition in the ClusterStatus API call&lt;/p&gt;</comment>
                            <comment id="15255880" author="jira-bot" created="Sun, 24 Apr 2016 21:40:58 -0700">&lt;p&gt;Commit a0e686d0697957fac7f85fa8b606f547e5982e36 in lucene-solr's branch refs/heads/branch_5_5 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varunthacker" class="user-hover" rel="varunthacker"&gt;Varun Thacker&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=a0e686d" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=a0e686d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8804" title="Race condition in ClusterStatus.getClusterStatus" class="issue-link" data-issue-key="SOLR-8804"&gt;&lt;del&gt;SOLR-8804&lt;/del&gt;&lt;/a&gt;: Fix a race condition in the ClusterStatus API call&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12792517" name="SOLR-8804.patch" size="3330" author="varunthacker" created="Thu, 10 Mar 2016 07:38:29 -0700"/>
                            <attachment id="12792318" name="SOLR-8804.patch" size="1803" author="varunthacker" created="Wed, 9 Mar 2016 12:13:44 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 9 Mar 2016 19:13:44 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2uck7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8799] Improve error message when tuple can't be read by SolrJ JDBC</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8799</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Currently the error message prints "Can't read first tuple" with the full stack trace having the full error. This isn't useful for JDBC clients since they don't show the full stack trace.&lt;/p&gt;</description>
                <environment/>
        <key id="12947720">SOLR-8799</key>
            <summary>Improve error message when tuple can't be read by SolrJ JDBC</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="10">Implemented</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="risdenk">Kevin Risden</reporter>
                        <labels>
                    </labels>
                <created>Mon, 7 Mar 2016 09:46:46 -0700</created>
                <updated>Wed, 9 Mar 2016 09:00:20 -0700</updated>
                            <resolved>Tue, 8 Mar 2016 14:08:10 -0700</resolved>
                                    <version>master</version>
                                    <fixVersion>6.0</fixVersion>
                                    <component>SolrJ</component>
                        <due/>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="15183249" author="risdenk" created="Mon, 7 Mar 2016 09:48:19 -0700">&lt;p&gt;Simple patch to just wrap the exception in a SQLException and not add new error message. This propagates the error message properly.&lt;/p&gt;</comment>
                            <comment id="15183250" author="risdenk" created="Mon, 7 Mar 2016 09:49:13 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=joel.bernstein" class="user-hover" rel="joel.bernstein"&gt;Joel Bernstein&lt;/a&gt; - Patch to improve error message when can't read tuple. Would be great to get this into Solr 6.&lt;/p&gt;</comment>
                            <comment id="15183349" author="joel.bernstein" created="Mon, 7 Mar 2016 10:50:04 -0700">&lt;p&gt;Ok, thanks. I'll commit today and see if we can backport.&lt;/p&gt;</comment>
                            <comment id="15185703" author="jira-bot" created="Tue, 8 Mar 2016 13:17:27 -0700">&lt;p&gt;Commit 56ad6e5d8a3d92f7ea496c598c2097aa572263cc in lucene-solr's branch refs/heads/master from jbernste&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=56ad6e5" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=56ad6e5&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8799" title="Improve error message when tuple can&amp;#39;t be read by SolrJ JDBC" class="issue-link" data-issue-key="SOLR-8799"&gt;&lt;del&gt;SOLR-8799&lt;/del&gt;&lt;/a&gt;: Improve error message when tuple can't be read by SolrJ JDBC&lt;/p&gt;</comment>
                            <comment id="15185713" author="jira-bot" created="Tue, 8 Mar 2016 13:21:01 -0700">&lt;p&gt;Commit 02523d5b6d7a4416265c4a36289b3dcb497ed6a6 in lucene-solr's branch refs/heads/master from jbernste&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=02523d5" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=02523d5&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8799" title="Improve error message when tuple can&amp;#39;t be read by SolrJ JDBC" class="issue-link" data-issue-key="SOLR-8799"&gt;&lt;del&gt;SOLR-8799&lt;/del&gt;&lt;/a&gt;: Update CHANGES.txt&lt;/p&gt;</comment>
                            <comment id="15185733" author="joel.bernstein" created="Tue, 8 Mar 2016 13:31:35 -0700">&lt;p&gt;Ok, just need to backport now.&lt;/p&gt;</comment>
                            <comment id="15185762" author="jira-bot" created="Tue, 8 Mar 2016 13:48:57 -0700">&lt;p&gt;Commit 15bf038f29cd877706b348a3c1c185475c935552 in lucene-solr's branch refs/heads/branch_6x from jbernste&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=15bf038" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=15bf038&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8799" title="Improve error message when tuple can&amp;#39;t be read by SolrJ JDBC" class="issue-link" data-issue-key="SOLR-8799"&gt;&lt;del&gt;SOLR-8799&lt;/del&gt;&lt;/a&gt;: Improve error message when tuple can't be read by SolrJ JDBC&lt;/p&gt;</comment>
                            <comment id="15185763" author="jira-bot" created="Tue, 8 Mar 2016 13:48:58 -0700">&lt;p&gt;Commit d0427d8617565cb4782faf1c93cf0ac0a6207680 in lucene-solr's branch refs/heads/branch_6x from jbernste&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d0427d8" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d0427d8&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8799" title="Improve error message when tuple can&amp;#39;t be read by SolrJ JDBC" class="issue-link" data-issue-key="SOLR-8799"&gt;&lt;del&gt;SOLR-8799&lt;/del&gt;&lt;/a&gt;: Update CHANGES.txt&lt;/p&gt;</comment>
                            <comment id="15185792" author="jira-bot" created="Tue, 8 Mar 2016 14:05:44 -0700">&lt;p&gt;Commit a13b2b0c24f256f6ba72588fef7332f6fc8fac70 in lucene-solr's branch refs/heads/branch_6_0 from jbernste&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=a13b2b0" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=a13b2b0&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8799" title="Improve error message when tuple can&amp;#39;t be read by SolrJ JDBC" class="issue-link" data-issue-key="SOLR-8799"&gt;&lt;del&gt;SOLR-8799&lt;/del&gt;&lt;/a&gt;: Improve error message when tuple can't be read by SolrJ JDBC&lt;/p&gt;</comment>
                            <comment id="15185793" author="jira-bot" created="Tue, 8 Mar 2016 14:05:45 -0700">&lt;p&gt;Commit ab7b410e9561c319a9499df22fb14c785588601e in lucene-solr's branch refs/heads/branch_6_0 from jbernste&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ab7b410" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ab7b410&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8799" title="Improve error message when tuple can&amp;#39;t be read by SolrJ JDBC" class="issue-link" data-issue-key="SOLR-8799"&gt;&lt;del&gt;SOLR-8799&lt;/del&gt;&lt;/a&gt;: Update CHANGES.txt&lt;/p&gt;</comment>
                            <comment id="15187298" author="jira-bot" created="Wed, 9 Mar 2016 09:00:18 -0700">&lt;p&gt;Commit 56ad6e5d8a3d92f7ea496c598c2097aa572263cc in lucene-solr's branch refs/heads/apiv2 from jbernste&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=56ad6e5" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=56ad6e5&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8799" title="Improve error message when tuple can&amp;#39;t be read by SolrJ JDBC" class="issue-link" data-issue-key="SOLR-8799"&gt;&lt;del&gt;SOLR-8799&lt;/del&gt;&lt;/a&gt;: Improve error message when tuple can't be read by SolrJ JDBC&lt;/p&gt;</comment>
                            <comment id="15187299" author="jira-bot" created="Wed, 9 Mar 2016 09:00:20 -0700">&lt;p&gt;Commit 02523d5b6d7a4416265c4a36289b3dcb497ed6a6 in lucene-solr's branch refs/heads/apiv2 from jbernste&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=02523d5" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=02523d5&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8799" title="Improve error message when tuple can&amp;#39;t be read by SolrJ JDBC" class="issue-link" data-issue-key="SOLR-8799"&gt;&lt;del&gt;SOLR-8799&lt;/del&gt;&lt;/a&gt;: Update CHANGES.txt&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12902422">SOLR-8125</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12946729">SOLR-8786</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12791780" name="SOLR-8799.patch" size="950" author="risdenk" created="Mon, 7 Mar 2016 09:48:19 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 7 Mar 2016 17:50:04 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ua93:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8790] Add node name back to the core level responses in OverseerMessageHandler</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8790</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Continuing from &lt;a href="https://issues.apache.org/jira/browse/SOLR-8789" title="CollectionAPISolrJTests is not run when running ant test" class="issue-link" data-issue-key="SOLR-8789"&gt;&lt;del&gt;SOLR-8789&lt;/del&gt;&lt;/a&gt;, now that this test runs, time to fix it.&lt;/p&gt;</description>
                <environment/>
        <key id="12947390">SOLR-8790</key>
            <summary>Add node name back to the core level responses in OverseerMessageHandler</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="anshumg">Anshum Gupta</assignee>
                                    <reporter username="anshumg">Anshum Gupta</reporter>
                        <labels>
                    </labels>
                <created>Fri, 4 Mar 2016 17:40:26 -0700</created>
                <updated>Sun, 24 Apr 2016 21:43:46 -0700</updated>
                            <resolved>Sun, 24 Apr 2016 21:43:46 -0700</resolved>
                                                    <fixVersion>5.5.1</fixVersion>
                    <fixVersion>6.0</fixVersion>
                    <fixVersion>master</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="15181481" author="jira-bot" created="Fri, 4 Mar 2016 20:25:50 -0700">&lt;p&gt;Commit 81feea2505103f4f0bcc4f6a84d9ea9b99e7ecb5 in lucene-solr's branch refs/heads/master from anshum&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=81feea2" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=81feea2&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8790" title="Add node name back to the core level responses in OverseerMessageHandler" class="issue-link" data-issue-key="SOLR-8790"&gt;&lt;del&gt;SOLR-8790&lt;/del&gt;&lt;/a&gt;: Ignoring failing CollectionsAPISolrJTest test until this is fixed&lt;/p&gt;</comment>
                            <comment id="15181482" author="jira-bot" created="Fri, 4 Mar 2016 20:27:02 -0700">&lt;p&gt;Commit 2055b64ca10c66b5fe5f63c3ec3a845c567aadda in lucene-solr's branch refs/heads/branch_6x from anshum&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=2055b64" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=2055b64&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8790" title="Add node name back to the core level responses in OverseerMessageHandler" class="issue-link" data-issue-key="SOLR-8790"&gt;&lt;del&gt;SOLR-8790&lt;/del&gt;&lt;/a&gt;: Ignoring failing CollectionsAPISolrJTest test until this is fixed&lt;/p&gt;</comment>
                            <comment id="15181483" author="anshumg" created="Fri, 4 Mar 2016 20:28:18 -0700">&lt;p&gt;Ignored the test to unblock Jenkins. I'll take a look at it later tonight.&lt;/p&gt;</comment>
                            <comment id="15184043" author="anshumg" created="Mon, 7 Mar 2016 16:45:57 -0700">&lt;p&gt;git bisect led to this commit:&lt;/p&gt;

&lt;p&gt;&lt;span class="error"&gt;&amp;#91;a2e5c37c85acc7692d6fbcc29866a70db4f8be2e&amp;#93;&lt;/span&gt; &lt;a href="https://issues.apache.org/jira/browse/SOLR-8534" title="Add generic support for Collection APIs to be async" class="issue-link" data-issue-key="SOLR-8534"&gt;&lt;del&gt;SOLR-8534&lt;/del&gt;&lt;/a&gt;: Add generic support for collection APIs to be async&lt;/p&gt;

&lt;p&gt;I'll take a look and fix. I'm fairly certain that the commit changed the response returned from Solr.&lt;/p&gt;</comment>
                            <comment id="15190217" author="anshumg" created="Thu, 10 Mar 2016 17:22:02 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nknize" class="user-hover" rel="nknize"&gt;Nicholas Knize&lt;/a&gt; I'd like to get this into 6.0 as this is regression. &lt;/p&gt;</comment>
                            <comment id="15190225" author="jira-bot" created="Thu, 10 Mar 2016 17:24:28 -0700">&lt;p&gt;Commit 209f5c2946c8816a7ab175dc5e886ea661d154a5 in lucene-solr's branch refs/heads/master from anshum&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=209f5c2" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=209f5c2&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8790" title="Add node name back to the core level responses in OverseerMessageHandler" class="issue-link" data-issue-key="SOLR-8790"&gt;&lt;del&gt;SOLR-8790&lt;/del&gt;&lt;/a&gt;: Add the node name to core responses in calls from the Overseer&lt;/p&gt;</comment>
                            <comment id="15190265" author="jira-bot" created="Thu, 10 Mar 2016 18:05:14 -0700">&lt;p&gt;Commit 8fe11a06ce9e8bfef99184b1849e459b15691bf2 in lucene-solr's branch refs/heads/branch_6x from anshum&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=8fe11a0" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=8fe11a0&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8790" title="Add node name back to the core level responses in OverseerMessageHandler" class="issue-link" data-issue-key="SOLR-8790"&gt;&lt;del&gt;SOLR-8790&lt;/del&gt;&lt;/a&gt;: Add the node name to core responses in calls from the Overseer&lt;/p&gt;</comment>
                            <comment id="15190544" author="varunthacker" created="Thu, 10 Mar 2016 23:50:47 -0700">&lt;p&gt;Hi Anshum,&lt;/p&gt;

&lt;p&gt;Thanks for fixing the code! Patch looks good&lt;/p&gt;

&lt;p&gt;Just looking at the OverseerCollectionMessageHandler there are different things being set as nodeName in different places:&lt;/p&gt;

&lt;p&gt;For example,&lt;br/&gt;
processRebalanceLeaders does this - &lt;tt&gt;sreq.nodeName = message.getStr(ZkStateReader.CORE_NAME_PROP);&lt;/tt&gt;&lt;br/&gt;
addReplica does this - &lt;tt&gt;String node = message.getStr(CoreAdminParams.NODE);&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;Everyone else sets nodeName as &lt;tt&gt;ZkStateReader.NODE_NAME_PROP&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;I think we should also add some javadocs to &lt;tt&gt;sendShardRequest&lt;/tt&gt; and &lt;tt&gt;ShardRequest.java&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="15190591" author="varunthacker" created="Fri, 11 Mar 2016 00:54:25 -0700">&lt;p&gt;AddReplica is fine. The API actually takes in a "node" parameter but internally it's used as "node_name".&lt;/p&gt;</comment>
                            <comment id="15190631" author="varunthacker" created="Fri, 11 Mar 2016 01:10:22 -0700">&lt;p&gt;Here is a quick patch of what I was referring to.&lt;/p&gt;</comment>
                            <comment id="15190971" author="nknize" created="Fri, 11 Mar 2016 07:16:36 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anshumg" class="user-hover" rel="anshumg"&gt;Anshum Gupta&lt;/a&gt; I'm okay with this making it in 6_0.&lt;/p&gt;</comment>
                            <comment id="15191369" author="anshumg" created="Fri, 11 Mar 2016 11:48:14 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varunthacker" class="user-hover" rel="varunthacker"&gt;Varun Thacker&lt;/a&gt; The patch leads to failing TestRebalanceLeaders. &lt;br/&gt;
You are trying to extract the NODE_NAME from message but that is always be null.&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
message.getStr(ZkStateReader.NODE_NAME_PROP)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Also, your patch loses this information:&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
sreq.purpose = ShardRequest.PURPOSE_PRIVATE;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15196068" author="jira-bot" created="Tue, 15 Mar 2016 12:51:13 -0700">&lt;p&gt;Commit b4d52d60ac4413f7bd0cd83bcc3c94a00c6dcddf in lucene-solr's branch refs/heads/branch_6_0 from anshum&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b4d52d6" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b4d52d6&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8790" title="Add node name back to the core level responses in OverseerMessageHandler" class="issue-link" data-issue-key="SOLR-8790"&gt;&lt;del&gt;SOLR-8790&lt;/del&gt;&lt;/a&gt;: Add the node name to core responses in calls from the Overseer&lt;/p&gt;</comment>
                            <comment id="15254128" author="anshumg" created="Fri, 22 Apr 2016 08:58:03 -0700">&lt;p&gt;backport for 5.5.1.&lt;/p&gt;</comment>
                            <comment id="15255023" author="jira-bot" created="Fri, 22 Apr 2016 18:51:40 -0700">&lt;p&gt;Commit cbb29d2a5ae4ab8741aab6c9f0806d4236c0cad0 in lucene-solr's branch refs/heads/branch_5x from anshum&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=cbb29d2" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=cbb29d2&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8790" title="Add node name back to the core level responses in OverseerMessageHandler" class="issue-link" data-issue-key="SOLR-8790"&gt;&lt;del&gt;SOLR-8790&lt;/del&gt;&lt;/a&gt;: Add the node name to core responses in calls from the Overseer&lt;/p&gt;</comment>
                            <comment id="15255877" author="jira-bot" created="Sun, 24 Apr 2016 21:40:54 -0700">&lt;p&gt;Commit bc08d7893fa6ba0bd0e9f37b72f014758f66b988 in lucene-solr's branch refs/heads/branch_5_5 from anshum&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=bc08d78" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=bc08d78&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8790" title="Add node name back to the core level responses in OverseerMessageHandler" class="issue-link" data-issue-key="SOLR-8790"&gt;&lt;del&gt;SOLR-8790&lt;/del&gt;&lt;/a&gt;: Add the node name to core responses in calls from the Overseer&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12792673" name="SOLR-8790-followup.patch" size="2622" author="varunthacker" created="Fri, 11 Mar 2016 01:10:22 -0700"/>
                            <attachment id="12792579" name="SOLR-8790.patch" size="1728" author="anshumg" created="Thu, 10 Mar 2016 13:27:01 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 5 Mar 2016 03:25:50 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2u87z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8789] CollectionAPISolrJTests is not run when running ant test</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8789</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;The pattern that is used to run the tests on Jenkins (ant test) is (from lucene/common-build.xml) :&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
&amp;lt;include name=&lt;span class="code-quote"&gt;"**/Test*.class"&lt;/span&gt; /&amp;gt;
&amp;lt;include name=&lt;span class="code-quote"&gt;"**/*Test.class"&lt;/span&gt; /&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;CollectionAPISolrJTests ends in an extra 's' and so is not executed. We need to either fix the pattern or the test name to make sure that this test is run.&lt;/p&gt;</description>
                <environment/>
        <key id="12947086">SOLR-8789</key>
            <summary>CollectionAPISolrJTests is not run when running ant test</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="anshumg">Anshum Gupta</assignee>
                                    <reporter username="anshumg">Anshum Gupta</reporter>
                        <labels>
                    </labels>
                <created>Fri, 4 Mar 2016 14:01:12 -0700</created>
                <updated>Sun, 24 Apr 2016 21:43:38 -0700</updated>
                            <resolved>Sun, 24 Apr 2016 21:43:38 -0700</resolved>
                                                    <fixVersion>5.5.1</fixVersion>
                    <fixVersion>6.0</fixVersion>
                    <fixVersion>master</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="15180774" author="mgainty@hotmail.com" created="Fri, 4 Mar 2016 16:47:31 -0700">&lt;p&gt;anshum/eric &lt;/p&gt;

&lt;p&gt;solr-5.3.1&amp;gt;find . -name &lt;b&gt;Test&lt;/b&gt;.java&lt;br/&gt;
?&lt;/p&gt;

&lt;p&gt;can you be specific on which filenames e.g. &lt;b&gt;Test&lt;/b&gt;.java are &lt;b&gt;supposed to be&lt;/b&gt; located in solr&lt;br/&gt;
?&lt;/p&gt;</comment>
                            <comment id="15181301" author="anshumg" created="Fri, 4 Mar 2016 16:51:47 -0700">&lt;p&gt;./solr/core/src/test/org/apache/solr/cloud/CollectionsAPISolrJTests.java&lt;/p&gt;</comment>
                            <comment id="15181310" author="elyograg" created="Fri, 4 Mar 2016 16:58:41 -0700">&lt;p&gt;In lucene/common-build.xml:&lt;/p&gt;

&lt;div class="preformatted panel" style="border-width: 1px;"&gt;&lt;div class="preformattedContent panelContent"&gt;
&lt;pre&gt;                &amp;lt;include name="**/Test*.class" /&amp;gt;
                &amp;lt;include name="**/*Test.class" /&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Remove the last "s" from the class name on the test.&lt;/p&gt;</comment>
                            <comment id="15181328" author="elyograg" created="Fri, 4 Mar 2016 17:14:18 -0700">&lt;p&gt;Obviously I'm blind.  I saw the recent comments, but didn't look closely at the issue description.&lt;/p&gt;</comment>
                            <comment id="15181339" author="anshumg" created="Fri, 4 Mar 2016 17:20:07 -0700">&lt;p&gt;Here's the patch.&lt;/p&gt;

&lt;p&gt;FYI, adding this test back would require fixing the test/code too. This test has been failing for a while and I noticed that while debugging this issue. I went back almost 2 weeks to run git bisect but couldn't get this to pass even back then.&lt;/p&gt;</comment>
                            <comment id="15181343" author="jira-bot" created="Fri, 4 Mar 2016 17:25:52 -0700">&lt;p&gt;Commit 6772ed09e8097b6c93774b96fce914eb847aaa41 in lucene-solr's branch refs/heads/master from anshum&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=6772ed0" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=6772ed0&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8789" title="CollectionAPISolrJTests is not run when running ant test" class="issue-link" data-issue-key="SOLR-8789"&gt;&lt;del&gt;SOLR-8789&lt;/del&gt;&lt;/a&gt;: Fix common-build.xml to run tests in classes that end in *Tests.java&lt;/p&gt;</comment>
                            <comment id="15181350" author="jira-bot" created="Fri, 4 Mar 2016 17:29:07 -0700">&lt;p&gt;Commit 651da42116f169c1391309d16eb8aa7d1b9d49fb in lucene-solr's branch refs/heads/branch_6x from anshum&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=651da42" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=651da42&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8789" title="CollectionAPISolrJTests is not run when running ant test" class="issue-link" data-issue-key="SOLR-8789"&gt;&lt;del&gt;SOLR-8789&lt;/del&gt;&lt;/a&gt;: Fix common-build.xml to run tests in classes that end in *Tests.java&lt;/p&gt;</comment>
                            <comment id="15181359" author="jira-bot" created="Fri, 4 Mar 2016 17:35:42 -0700">&lt;p&gt;Commit 437170fa88bc9ee5ee8da1a597b4dfc2d20160a3 in lucene-solr's branch refs/heads/master from anshum&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=437170f" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=437170f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8789" title="CollectionAPISolrJTests is not run when running ant test" class="issue-link" data-issue-key="SOLR-8789"&gt;&lt;del&gt;SOLR-8789&lt;/del&gt;&lt;/a&gt;: Remove the *Tests regular expression from the build xml, and instead rename CollectionsAPISolrJTests to CollectionsAPISolrJTest&lt;/p&gt;</comment>
                            <comment id="15181361" author="jira-bot" created="Fri, 4 Mar 2016 17:37:37 -0700">&lt;p&gt;Commit 0ac5d724b207e052ca86ef413fbd9d76fdadf72d in lucene-solr's branch refs/heads/branch_6x from anshum&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=0ac5d72" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=0ac5d72&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8789" title="CollectionAPISolrJTests is not run when running ant test" class="issue-link" data-issue-key="SOLR-8789"&gt;&lt;del&gt;SOLR-8789&lt;/del&gt;&lt;/a&gt;: Remove the *Tests regular expression from the build xml, and instead rename CollectionsAPISolrJTests to CollectionsAPISolrJTest&lt;/p&gt;</comment>
                            <comment id="15196066" author="jira-bot" created="Tue, 15 Mar 2016 12:51:10 -0700">&lt;p&gt;Commit 94325a9095fed26128cff8eb3256680f1dd01399 in lucene-solr's branch refs/heads/branch_6_0 from anshum&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=94325a9" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=94325a9&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8789" title="CollectionAPISolrJTests is not run when running ant test" class="issue-link" data-issue-key="SOLR-8789"&gt;&lt;del&gt;SOLR-8789&lt;/del&gt;&lt;/a&gt;: Fix common-build.xml to run tests in classes that end in *Tests.java&lt;/p&gt;</comment>
                            <comment id="15196067" author="jira-bot" created="Tue, 15 Mar 2016 12:51:11 -0700">&lt;p&gt;Commit 2ff013cdc49d82f96715f700e1c3999f76adeb13 in lucene-solr's branch refs/heads/branch_6_0 from anshum&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=2ff013c" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=2ff013c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8789" title="CollectionAPISolrJTests is not run when running ant test" class="issue-link" data-issue-key="SOLR-8789"&gt;&lt;del&gt;SOLR-8789&lt;/del&gt;&lt;/a&gt;: Remove the *Tests regular expression from the build xml, and instead rename CollectionsAPISolrJTests to CollectionsAPISolrJTest&lt;/p&gt;</comment>
                            <comment id="15254127" author="anshumg" created="Fri, 22 Apr 2016 08:57:42 -0700">&lt;p&gt;backport for 5.5.1&lt;/p&gt;</comment>
                            <comment id="15255024" author="jira-bot" created="Fri, 22 Apr 2016 18:51:41 -0700">&lt;p&gt;Commit 87f99019acd8a82756ee930a1b088f9a514e0f75 in lucene-solr's branch refs/heads/branch_5x from anshum&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=87f9901" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=87f9901&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8789" title="CollectionAPISolrJTests is not run when running ant test" class="issue-link" data-issue-key="SOLR-8789"&gt;&lt;del&gt;SOLR-8789&lt;/del&gt;&lt;/a&gt;: Fix common-build.xml to run tests in classes that end in *Tests.java&lt;/p&gt;</comment>
                            <comment id="15255025" author="jira-bot" created="Fri, 22 Apr 2016 18:51:43 -0700">&lt;p&gt;Commit 1fb79c94b182e0fbe4c5f90033cd6d34033c773a in lucene-solr's branch refs/heads/branch_5x from anshum&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=1fb79c9" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=1fb79c9&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8789" title="CollectionAPISolrJTests is not run when running ant test" class="issue-link" data-issue-key="SOLR-8789"&gt;&lt;del&gt;SOLR-8789&lt;/del&gt;&lt;/a&gt;: Remove the *Tests regular expression from the build xml, and instead rename CollectionsAPISolrJTests to CollectionsAPISolrJTest&lt;/p&gt;</comment>
                            <comment id="15255878" author="jira-bot" created="Sun, 24 Apr 2016 21:40:55 -0700">&lt;p&gt;Commit 153a13c9ae153df6f32358fe06d2d490812fdbb8 in lucene-solr's branch refs/heads/branch_5_5 from anshum&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=153a13c" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=153a13c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8789" title="CollectionAPISolrJTests is not run when running ant test" class="issue-link" data-issue-key="SOLR-8789"&gt;&lt;del&gt;SOLR-8789&lt;/del&gt;&lt;/a&gt;: Fix common-build.xml to run tests in classes that end in *Tests.java&lt;/p&gt;</comment>
                            <comment id="15255879" author="jira-bot" created="Sun, 24 Apr 2016 21:40:57 -0700">&lt;p&gt;Commit 0304729f8e2677b16366e7ff7f4139ad132c7400 in lucene-solr's branch refs/heads/branch_5_5 from anshum&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=0304729" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=0304729&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8789" title="CollectionAPISolrJTests is not run when running ant test" class="issue-link" data-issue-key="SOLR-8789"&gt;&lt;del&gt;SOLR-8789&lt;/del&gt;&lt;/a&gt;: Remove the *Tests regular expression from the build xml, and instead rename CollectionsAPISolrJTests to CollectionsAPISolrJTest&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12791577" name="SOLR-8789.patch" size="525" author="anshumg" created="Fri, 4 Mar 2016 17:20:07 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 4 Mar 2016 23:47:31 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2u6cf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8788] CollectionTooManyReplicasTest.testDownedShards failures</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8788</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;CollectionTooManyReplicasTest.testDownedShards fails frequently on master and branch_6x.&lt;/p&gt;

&lt;p&gt;&lt;a href="http://jenkins.thetaphi.de/job/Lucene-Solr-6.x-Linux/15/" class="external-link" rel="nofollow"&gt;http://jenkins.thetaphi.de/job/Lucene-Solr-6.x-Linux/15/&lt;/a&gt;&lt;/p&gt;</description>
                <environment/>
        <key id="12947011">SOLR-8788</key>
            <summary>CollectionTooManyReplicasTest.testDownedShards failures</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="noble.paul">Noble Paul</assignee>
                                    <reporter username="shalinmangar">Shalin Shekhar Mangar</reporter>
                        <labels>
                    </labels>
                <created>Fri, 4 Mar 2016 09:12:47 -0700</created>
                <updated>Fri, 4 Mar 2016 23:02:10 -0700</updated>
                            <resolved>Fri, 4 Mar 2016 23:02:10 -0700</resolved>
                                                    <fixVersion>6.0</fixVersion>
                    <fixVersion>master</fixVersion>
                                    <component>Tests</component>
                        <due/>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="15181535" author="shalinmangar" created="Fri, 4 Mar 2016 22:34:38 -0700">&lt;p&gt;According to git bisect, this was broken by &lt;a href="https://issues.apache.org/jira/browse/SOLR-8728" title="Splitting a shard of a collection created with a rule fails with NPE" class="issue-link" data-issue-key="SOLR-8728"&gt;&lt;del&gt;SOLR-8728&lt;/del&gt;&lt;/a&gt;. &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;, can you please take a look?&lt;/p&gt;</comment>
                            <comment id="15181544" author="jira-bot" created="Fri, 4 Mar 2016 23:00:17 -0700">&lt;p&gt;Commit f09c5590e5f102bb38d65129967f8710f478df48 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f09c559" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f09c559&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8788" title="CollectionTooManyReplicasTest.testDownedShards failures" class="issue-link" data-issue-key="SOLR-8788"&gt;&lt;del&gt;SOLR-8788&lt;/del&gt;&lt;/a&gt;: CollectionTooManyReplicasTest.testDownedShards failures&lt;/p&gt;</comment>
                            <comment id="15181546" author="jira-bot" created="Fri, 4 Mar 2016 23:01:14 -0700">&lt;p&gt;Commit 1df8aca394742cb27383daa8b94587007ec90471 in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=1df8aca" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=1df8aca&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8788" title="CollectionTooManyReplicasTest.testDownedShards failures" class="issue-link" data-issue-key="SOLR-8788"&gt;&lt;del&gt;SOLR-8788&lt;/del&gt;&lt;/a&gt;: CollectionTooManyReplicasTest.testDownedShards failures&lt;/p&gt;</comment>
                            <comment id="15181547" author="jira-bot" created="Fri, 4 Mar 2016 23:02:03 -0700">&lt;p&gt;Commit a93dbff052b85ce1aba5fdfa38c0eafa4e2392ce in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=a93dbff" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=a93dbff&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8788" title="CollectionTooManyReplicasTest.testDownedShards failures" class="issue-link" data-issue-key="SOLR-8788"&gt;&lt;del&gt;SOLR-8788&lt;/del&gt;&lt;/a&gt;: CollectionTooManyReplicasTest.testDownedShards failures&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 5 Mar 2016 06:00:17 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2u5vr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8780] Remove unused OverseerCollectionMessageHandler#getClusterStatus</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8780</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;In &lt;a href="https://issues.apache.org/jira/browse/SOLR-7636" title="CLUSTERSTATUS Api should not go to OCP to fetch data" class="issue-link" data-issue-key="SOLR-7636"&gt;&lt;del&gt;SOLR-7636&lt;/del&gt;&lt;/a&gt;  we moved the ClusterStatus call to the CollectionsHandler so that they can be served by their individual nodes.&lt;/p&gt;

&lt;p&gt;In &lt;a href="https://issues.apache.org/jira/browse/SOLR-7907" title="Remove CLUSTERSTATUS related checks from the Overseer" class="issue-link" data-issue-key="SOLR-7907"&gt;&lt;del&gt;SOLR-7907&lt;/del&gt;&lt;/a&gt; we removed the exclusivity checks which were present in the Overseer for ClusterStatus but looks like we forgot to remove OverseerCollectionMessageHandler#getClusterStatus&lt;/p&gt;

&lt;p&gt;We should remove the method as it's not used and was moved to a separate class - ClusterStatus.java&lt;/p&gt;</description>
                <environment/>
        <key id="12946486">SOLR-8780</key>
            <summary>Remove unused OverseerCollectionMessageHandler#getClusterStatus</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="varunthacker">Varun Thacker</assignee>
                                    <reporter username="varunthacker">Varun Thacker</reporter>
                        <labels>
                    </labels>
                <created>Thu, 3 Mar 2016 02:38:00 -0700</created>
                <updated>Thu, 3 Mar 2016 05:42:39 -0700</updated>
                            <resolved>Thu, 3 Mar 2016 05:42:39 -0700</resolved>
                                                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="15177568" author="varunthacker" created="Thu, 3 Mar 2016 02:45:10 -0700">&lt;p&gt;Simple patch which removes the unused code form OverseerCollectionMessageHandler . I'll run tests and commit this shortly.&lt;/p&gt;</comment>
                            <comment id="15177728" author="jira-bot" created="Thu, 3 Mar 2016 05:07:24 -0700">&lt;p&gt;Commit b440a1deb3f129bcb09d610efa48468d648fc7f0 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varunthacker" class="user-hover" rel="varunthacker"&gt;Varun Thacker&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b440a1d" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b440a1d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8780" title="Remove unused OverseerCollectionMessageHandler#getClusterStatus" class="issue-link" data-issue-key="SOLR-8780"&gt;&lt;del&gt;SOLR-8780&lt;/del&gt;&lt;/a&gt;: Remove unused OverseerCollectionMessageHandler#getClusterStatus method&lt;/p&gt;</comment>
                            <comment id="15177756" author="jira-bot" created="Thu, 3 Mar 2016 05:35:35 -0700">&lt;p&gt;Commit 6b2d176e4837e1969956d65de1f5279322d362d7 in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varunthacker" class="user-hover" rel="varunthacker"&gt;Varun Thacker&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=6b2d176" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=6b2d176&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8780" title="Remove unused OverseerCollectionMessageHandler#getClusterStatus" class="issue-link" data-issue-key="SOLR-8780"&gt;&lt;del&gt;SOLR-8780&lt;/del&gt;&lt;/a&gt;: Remove unused OverseerCollectionMessageHandler#getClusterStatus method&lt;/p&gt;</comment>
                            <comment id="15177760" author="jira-bot" created="Thu, 3 Mar 2016 05:38:19 -0700">&lt;p&gt;Commit 033c564f97344a6a8688b61571ba59f16eb01ee7 in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varunthacker" class="user-hover" rel="varunthacker"&gt;Varun Thacker&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=033c564" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=033c564&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8780" title="Remove unused OverseerCollectionMessageHandler#getClusterStatus" class="issue-link" data-issue-key="SOLR-8780"&gt;&lt;del&gt;SOLR-8780&lt;/del&gt;&lt;/a&gt;: Remove unused OverseerCollectionMessageHandler#getClusterStatus method&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12791139" name="SOLR-8780.patch" size="5138" author="varunthacker" created="Thu, 3 Mar 2016 02:45:10 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 3 Mar 2016 12:07:24 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2u36n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8779] Fix missing InterruptedException handling in ZkStateReader</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8779</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;I was debugging a zk session expired issue and saw this stack-trace&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
ERROR - 2016-03-03 06:55:53.873; [   ] org.apache.solr.common.SolrException; OverseerAutoReplicaFailoverThread had an error in its thread work loop.:org.apache.solr.common.SolrException: Error reading cluster properties
	at org.apache.solr.common.cloud.ZkStateReader.getClusterProps(ZkStateReader.java:738)
	at org.apache.solr.cloud.OverseerAutoReplicaFailoverThread.doWork(OverseerAutoReplicaFailoverThread.java:153)
	at org.apache.solr.cloud.OverseerAutoReplicaFailoverThread.run(OverseerAutoReplicaFailoverThread.java:132)
	at java.lang.&lt;span class="code-object"&gt;Thread&lt;/span&gt;.run(&lt;span class="code-object"&gt;Thread&lt;/span&gt;.java:745)
Caused by: java.lang.InterruptedException: sleep interrupted
	at java.lang.&lt;span class="code-object"&gt;Thread&lt;/span&gt;.sleep(Native Method)
	at org.apache.solr.common.cloud.ZkCmdExecutor.retryDelay(ZkCmdExecutor.java:108)
	at org.apache.solr.common.cloud.ZkCmdExecutor.retryOperation(ZkCmdExecutor.java:76)
	at org.apache.solr.common.cloud.SolrZkClient.exists(SolrZkClient.java:308)
	at org.apache.solr.common.cloud.ZkStateReader.getClusterProps(ZkStateReader.java:731)
	... 3 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So I audited ZKStateReader and found a couple of places where an InterruptedException was caught but the interrupt flag wasn't set back.&lt;/p&gt;</description>
                <environment/>
        <key id="12946476">SOLR-8779</key>
            <summary>Fix missing InterruptedException handling in ZkStateReader</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="varunthacker">Varun Thacker</assignee>
                                    <reporter username="varunthacker">Varun Thacker</reporter>
                        <labels>
                    </labels>
                <created>Thu, 3 Mar 2016 01:57:55 -0700</created>
                <updated>Thu, 21 Apr 2016 17:29:56 -0700</updated>
                            <resolved>Thu, 21 Apr 2016 17:20:37 -0700</resolved>
                                                    <fixVersion>5.5.1</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="15177516" author="varunthacker" created="Thu, 3 Mar 2016 02:04:05 -0700">&lt;p&gt;Simple patch which sets the interrupt flag back in &lt;tt&gt;ZkStateReader#readConfigName&lt;/tt&gt; , &lt;tt&gt;ZkStateReader#getClusterProps&lt;/tt&gt; , &lt;tt&gt;ZkStateReader#setClusterProperty&lt;/tt&gt; and &lt;tt&gt;ZkStateReader#getSecurityProps&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="15178019" author="dragonsinth" created="Thu, 3 Mar 2016 09:08:46 -0700">&lt;p&gt;LGTM&lt;/p&gt;</comment>
                            <comment id="15179835" author="varunthacker" created="Fri, 4 Mar 2016 05:44:15 -0700">&lt;p&gt;Thanks Scott for the review! &lt;/p&gt;

&lt;p&gt;I'll commit this soon.&lt;/p&gt;

&lt;p&gt;Hi &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nknize" class="user-hover" rel="nknize"&gt;Nicholas Knize&lt;/a&gt; , this is a bug . It's fine if I commit it to the 6_0 branch as well?&lt;/p&gt;</comment>
                            <comment id="15179931" author="nknize" created="Fri, 4 Mar 2016 07:22:34 -0700">&lt;blockquote&gt;&lt;p&gt;this is a bug . It's fine if I commit it to the 6_0 branch as well?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="15179958" author="jira-bot" created="Fri, 4 Mar 2016 07:42:27 -0700">&lt;p&gt;Commit 21bf9c6e8045adce3301a7a92766f9c43a49ba71 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varunthacker" class="user-hover" rel="varunthacker"&gt;Varun Thacker&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=21bf9c6" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=21bf9c6&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8779" title="Fix missing InterruptedException handling in ZkStateReader" class="issue-link" data-issue-key="SOLR-8779"&gt;&lt;del&gt;SOLR-8779&lt;/del&gt;&lt;/a&gt;: Fix missing InterruptedException handling in ZkStateReader&lt;/p&gt;</comment>
                            <comment id="15179960" author="jira-bot" created="Fri, 4 Mar 2016 07:44:42 -0700">&lt;p&gt;Commit 1cbf22569a38add32eae22b38d5f02257ada3fed in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varunthacker" class="user-hover" rel="varunthacker"&gt;Varun Thacker&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=1cbf225" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=1cbf225&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8779" title="Fix missing InterruptedException handling in ZkStateReader" class="issue-link" data-issue-key="SOLR-8779"&gt;&lt;del&gt;SOLR-8779&lt;/del&gt;&lt;/a&gt;: Fix missing InterruptedException handling in ZkStateReader&lt;/p&gt;</comment>
                            <comment id="15179962" author="jira-bot" created="Fri, 4 Mar 2016 07:46:15 -0700">&lt;p&gt;Commit 45ddc181486c15022577b23f37e6bded1dadeef7 in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varunthacker" class="user-hover" rel="varunthacker"&gt;Varun Thacker&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=45ddc18" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=45ddc18&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8779" title="Fix missing InterruptedException handling in ZkStateReader" class="issue-link" data-issue-key="SOLR-8779"&gt;&lt;del&gt;SOLR-8779&lt;/del&gt;&lt;/a&gt;: Fix missing InterruptedException handling in ZkStateReader&lt;/p&gt;</comment>
                            <comment id="15252962" author="anshumg" created="Thu, 21 Apr 2016 16:01:52 -0700">&lt;p&gt;backport for 5.5.1&lt;/p&gt;</comment>
                            <comment id="15253073" author="anshumg" created="Thu, 21 Apr 2016 17:29:56 -0700">&lt;p&gt;branch_5x&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
commit 1ce5e533c551bf04fd256cd945be2cb9a261f069
Author: Varun Thacker &amp;lt;varunthacker1989@gmail.com&amp;gt;
Date:   Fri Mar 4 18:08:53 2016 +0530

    SOLR-8779: Fix missing InterruptedException handling in ZkStateReader
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;branch_5_5&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
commit 6024572a53fc3af8fbb2f3d0cf51cf46d7406350
Author: Varun Thacker &amp;lt;varunthacker1989@gmail.com&amp;gt;
Date:   Fri Mar 4 18:08:53 2016 +0530

    SOLR-8779: Fix missing InterruptedException handling in ZkStateReader
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12791132" name="SOLR-8779.patch" size="3416" author="varunthacker" created="Thu, 3 Mar 2016 02:04:05 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 3 Mar 2016 16:08:46 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2u34f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8778] Deprecate CSVStrategy's setters, and make its pre-configured strategies immutable</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8778</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Removing some deprecated things in CSVStrategy (&lt;a href="https://issues.apache.org/jira/browse/SOLR-8764" title="Remove all deprecated methods and classes from master prior to the 6.0 release" class="issue-link" data-issue-key="SOLR-8764"&gt;&lt;del&gt;SOLR-8764&lt;/del&gt;&lt;/a&gt;) exposed a bug: it's possible to redefine the public static &lt;tt&gt;CSVStrategy.{DEFAULT,EXCEL,TDF}_STRATEGY&lt;/tt&gt; strategies, simply by calling their setters.&lt;/p&gt;

&lt;p&gt;Right now that's happening in &lt;tt&gt;CSVParserTest.testUnicodeEscape()&lt;/tt&gt;, where the default unicode escape interpretation is changed from false to true.  And then if that test happens to run before &lt;tt&gt;CSVStrategyTest.testSetCSVStrategy()&lt;/tt&gt;, which tests that the unicode escape interpretation on the default strategy is set to false, then the latter will fail.&lt;/p&gt;

&lt;p&gt;Example failures: &lt;a href="http://jenkins.thetaphi.de/job/Lucene-Solr-trunk-Linux/16079/" class="external-link" rel="nofollow"&gt;http://jenkins.thetaphi.de/job/Lucene-Solr-trunk-Linux/16079/&lt;/a&gt; and &lt;a href="http://jenkins.thetaphi.de/job/Lucene-Solr-trunk-MacOSX/3126/" class="external-link" rel="nofollow"&gt;http://jenkins.thetaphi.de/job/Lucene-Solr-trunk-MacOSX/3126/&lt;/a&gt;&lt;/p&gt;</description>
                <environment/>
        <key id="12946336">SOLR-8778</key>
            <summary>Deprecate CSVStrategy's setters, and make its pre-configured strategies immutable</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="steve_rowe">Steve Rowe</assignee>
                                    <reporter username="steve_rowe">Steve Rowe</reporter>
                        <labels>
                    </labels>
                <created>Wed, 2 Mar 2016 17:00:16 -0700</created>
                <updated>Thu, 3 Mar 2016 13:48:45 -0700</updated>
                            <resolved>Thu, 3 Mar 2016 12:22:10 -0700</resolved>
                                                    <fixVersion>6.0</fixVersion>
                    <fixVersion>master</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="15176777" author="steve_rowe" created="Wed, 2 Mar 2016 17:12:49 -0700">&lt;p&gt;I don't think it's useful to have live setters at all on a CSVStrategy instance - they should be removed.&lt;/p&gt;

&lt;p&gt;I'll make a patch that:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;deprecates the setters (to be removed in 7.0, sigh)&lt;/li&gt;
	&lt;li&gt;switches the ctors to not call the setters&lt;/li&gt;
	&lt;li&gt;switches all internal Solr usages to treat CSVStrategy instances as if they were immutable (i.e., don't call any setters)&lt;/li&gt;
	&lt;li&gt;adds a deprecated private CSVStrategy subclass that throws an error from all setters, to be used for the pre-defined static strategies&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15177964" author="steve_rowe" created="Thu, 3 Mar 2016 08:33:11 -0700">&lt;p&gt;Patch implementing the idea, additionally adding a ctor param for &lt;tt&gt;printerNewline&lt;/tt&gt; and deprecating &lt;tt&gt;clone()&lt;/tt&gt;, which will also be removed (along with &lt;tt&gt;implements Cloneable&lt;/tt&gt;) in Solr 7, since the sequence (clone(),setXXX(), ...) will no longer be supported - people will just create new immutable instances using one of the ctors.&lt;/p&gt;

&lt;p&gt;I guess a builder would make sense here, since there are now 9 params in the full ctor, but I don't plan on doing that.&lt;/p&gt;

&lt;p&gt;I'll make a followup issue to remove the deprecated stuff in master.&lt;/p&gt;

&lt;p&gt;Precommit passes, along with the unit tests in the same package.  Running the full Solr test suite now, once done, assuming no failures, I'll commit.&lt;/p&gt;</comment>
                            <comment id="15177978" author="thetaphi" created="Thu, 3 Mar 2016 08:46:00 -0700">&lt;p&gt;+1 to fix this!&lt;/p&gt;

&lt;p&gt;Ideally we should remove our CSV fork from Solr's repository! I tried to do that and cut over to the official release, but I gave up; see &lt;a href="https://issues.apache.org/jira/browse/SOLR-3213" title="Upgrade to commons-csv once it is released" class="issue-link" data-issue-key="SOLR-3213"&gt;SOLR-3213&lt;/a&gt;. The commons-csv release is a total rewrite not having any overlap with our early fork in the internal package. The official release does not support most "hackish" stuff, introduced to spare allocations (which is no longer an issue in Java 8, we can do &lt;tt&gt;new CSV*()&lt;/tt&gt; as often as we like, Hotspot optimizes that away). I think this stuff also is the reason for this issue, &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe" class="user-hover" rel="steve_rowe"&gt;Steve Rowe&lt;/a&gt;?&lt;/p&gt;

&lt;p&gt;So we should really upgrade to a better CSV parser (official commons-csv) and remove the "reuse" of instances in thread unsafe ways.&lt;/p&gt;</comment>
                            <comment id="15177985" author="steve_rowe" created="Thu, 3 Mar 2016 08:47:59 -0700">&lt;p&gt;+1, after the 6.0 release.  I'll commit the patch for now.&lt;/p&gt;</comment>
                            <comment id="15177998" author="jira-bot" created="Thu, 3 Mar 2016 08:54:56 -0700">&lt;p&gt;Commit a079ff2528a384468289a8fb80787b418c887496 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe" class="user-hover" rel="steve_rowe"&gt;Steve Rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=a079ff2" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=a079ff2&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8778" title="Deprecate CSVStrategy&amp;#39;s setters, and make its pre-configured strategies immutable" class="issue-link" data-issue-key="SOLR-8778"&gt;&lt;del&gt;SOLR-8778&lt;/del&gt;&lt;/a&gt;: Deprecate CSVStrategy's setters, and make its pre-configured strategies immutable&lt;/p&gt;</comment>
                            <comment id="15178002" author="jira-bot" created="Thu, 3 Mar 2016 08:57:19 -0700">&lt;p&gt;Commit eb0c3bd90a4feee61b7c9b4c21a78a9f9bace0ff in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe" class="user-hover" rel="steve_rowe"&gt;Steve Rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=eb0c3bd" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=eb0c3bd&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8778" title="Deprecate CSVStrategy&amp;#39;s setters, and make its pre-configured strategies immutable" class="issue-link" data-issue-key="SOLR-8778"&gt;&lt;del&gt;SOLR-8778&lt;/del&gt;&lt;/a&gt;: Deprecate CSVStrategy's setters, and make its pre-configured strategies immutable&lt;/p&gt;</comment>
                            <comment id="15178004" author="jira-bot" created="Thu, 3 Mar 2016 08:57:57 -0700">&lt;p&gt;Commit 8034b5aabd17aa60a37417359841623b07a9e927 in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe" class="user-hover" rel="steve_rowe"&gt;Steve Rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=8034b5a" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=8034b5a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8778" title="Deprecate CSVStrategy&amp;#39;s setters, and make its pre-configured strategies immutable" class="issue-link" data-issue-key="SOLR-8778"&gt;&lt;del&gt;SOLR-8778&lt;/del&gt;&lt;/a&gt;: Deprecate CSVStrategy's setters, and make its pre-configured strategies immutable&lt;/p&gt;</comment>
                            <comment id="15178422" author="steve_rowe" created="Thu, 3 Mar 2016 12:22:10 -0700">&lt;p&gt;Resolving as fixed.  I'll hold off creating a JIRA to remove the deprecated stuff in master, since as Uwe says we should instead remove the whole fork.&lt;/p&gt;</comment>
                            <comment id="15178593" author="thetaphi" created="Thu, 3 Mar 2016 13:47:55 -0700">&lt;blockquote&gt;&lt;p&gt;I'll hold off creating a JIRA to remove the deprecated stuff in master, since as Uwe says we should instead remove the whole fork.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We should investigate this. Issue with patch is &lt;a href="https://issues.apache.org/jira/browse/SOLR-3213" title="Upgrade to commons-csv once it is released" class="issue-link" data-issue-key="SOLR-3213"&gt;SOLR-3213&lt;/a&gt;, but I gave up because to fix this you have to understand the whole CSV handler code (and I was not familar to it when I tried to do this).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="12545576">SOLR-3213</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12945714">SOLR-8764</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12791189" name="SOLR-8778.patch" size="20632" author="steve_rowe" created="Thu, 3 Mar 2016 08:33:11 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 3 Mar 2016 15:46:00 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2u29b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8771] Multi-threaded core shutdown creates executor per core</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8771</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;The multi-threaded core shutdown that was added in &lt;a href="https://issues.apache.org/jira/browse/SOLR-8615" title="Just like creating cores, we should use multiple threads when closing cores." class="issue-link" data-issue-key="SOLR-8615"&gt;&lt;del&gt;SOLR-8615&lt;/del&gt;&lt;/a&gt; has a bug where a new executor is created per core. This means we don't get any benefit from the parallel operations.&lt;/p&gt;

&lt;p&gt;Patch incoming shortly.&lt;/p&gt;</description>
                <environment/>
        <key id="12945899">SOLR-8771</key>
            <summary>Multi-threaded core shutdown creates executor per core</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="mdrob">Mike Drob</reporter>
                        <labels>
                    </labels>
                <created>Tue, 1 Mar 2016 11:23:38 -0700</created>
                <updated>Thu, 21 Apr 2016 17:27:11 -0700</updated>
                            <resolved>Thu, 21 Apr 2016 17:22:44 -0700</resolved>
                                                    <fixVersion>5.5.1</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="15174263" author="markrmiller@gmail.com" created="Tue, 1 Mar 2016 12:28:56 -0700">&lt;p&gt;+1, good catch!&lt;/p&gt;</comment>
                            <comment id="15174349" author="jira-bot" created="Tue, 1 Mar 2016 13:14:10 -0700">&lt;p&gt;Commit 0f4f53a8f52cab0838bea2482aaa7d5012c5ecaa in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com" class="user-hover" rel="markrmiller@gmail.com"&gt;Mark Miller&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=0f4f53a" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=0f4f53a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8771" title="Multi-threaded core shutdown creates executor per core" class="issue-link" data-issue-key="SOLR-8771"&gt;&lt;del&gt;SOLR-8771&lt;/del&gt;&lt;/a&gt;: Multi-threaded core shutdown creates executor per core.&lt;/p&gt;</comment>
                            <comment id="15252912" author="anshumg" created="Thu, 21 Apr 2016 15:34:22 -0700">&lt;p&gt;Back porting for 5.5.1.&lt;/p&gt;</comment>
                            <comment id="15253067" author="anshumg" created="Thu, 21 Apr 2016 17:27:11 -0700">&lt;p&gt;For some reason the bot didn't comment on JIRA after the commits. Here are the back ports:&lt;br/&gt;
branch_5x:&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
commit 27ca43a16ed6d9ee83378b0532ba6c84a900eada
Author: anshum &amp;lt;anshum@apache.org&amp;gt;
Date:   Thu Apr 21 16:53:15 2016 -0700

    SOLR-8771: Fix broken build that broke during backporting to 5x
    
commit 34340f540bc8a4ee8cbf80719093c677ffa0f128
Author: Mark Miller &amp;lt;markrmiller@gmail.com&amp;gt;
Date:   Tue Mar 1 12:13:56 2016 -0800

    SOLR-8771: Multi-threaded core shutdown creates executor per core.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;branch_5_5&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
commit 297bdb63aa6720c6c204ce921f8bfc5854b4cfd4
Author: anshum &amp;lt;anshum@apache.org&amp;gt;
Date:   Thu Apr 21 16:53:15 2016 -0700

    SOLR-8771: Fix broken build that broke during backporting to 5x

commit 9698d1bee31eb5f103f8894246acf7f8f5479194
Author: Mark Miller &amp;lt;markrmiller@gmail.com&amp;gt;
Date:   Tue Mar 1 12:13:56 2016 -0800

    SOLR-8771: Multi-threaded core shutdown creates executor per core.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12934842">SOLR-8615</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12790753" name="SOLR-8771.patch" size="1808" author="mdrob" created="Tue, 1 Mar 2016 11:34:47 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 1 Mar 2016 19:28:56 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2tzk7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8769] CloudMLTQParser does not use uniqueKey field name for exclusion</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8769</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Using the {&lt;tt&gt;!mlt&lt;/tt&gt;} query parser in cloud mode on a schema with a non-"id" uniqueKey, the main "like this" document won't be excluded properly due to this code:&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
realMLTQuery.add(createIdQuery(&lt;span class="code-quote"&gt;"id"&lt;/span&gt;, id), BooleanClause.Occur.MUST_NOT);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;See also &lt;a href="https://github.com/apache/lucene-solr/blob/813ca77250db29116812bc949e2a466a70f969a3/solr/core/src/java/org/apache/solr/search/mlt/CloudMLTQParser.java#L166" class="external-link" rel="nofollow"&gt;https://github.com/apache/lucene-solr/blob/813ca77250db29116812bc949e2a466a70f969a3/solr/core/src/java/org/apache/solr/search/mlt/CloudMLTQParser.java#L166&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Like SimpleMLTQParser, it needs to use the uniqueKey field with this type of code: &lt;tt&gt;req.getSchema().getUniqueKeyField().getName()&lt;/tt&gt;&lt;/p&gt;</description>
                <environment/>
        <key id="12945865">SOLR-8769</key>
            <summary>CloudMLTQParser does not use uniqueKey field name for exclusion</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="ehatcher">Erik Hatcher</reporter>
                        <labels>
                    </labels>
                <created>Tue, 1 Mar 2016 09:24:30 -0700</created>
                <updated>Thu, 21 Apr 2016 17:32:36 -0700</updated>
                            <resolved>Thu, 3 Mar 2016 18:29:21 -0700</resolved>
                                                    <fixVersion>5.5.1</fixVersion>
                    <fixVersion>6.0</fixVersion>
                    <fixVersion>master</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="15178861" author="anshumg" created="Thu, 3 Mar 2016 16:39:21 -0700">&lt;p&gt;Thanks for pointing this out &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ehatcher" class="user-hover" rel="ehatcher"&gt;Erik Hatcher&lt;/a&gt;. I committed this but forgot to specify the JIRA#.&lt;br/&gt;
I tried to amend the commit message but for some reason that isn't working. Until that happens, thought I'll update the JIRA manually.&lt;/p&gt;

&lt;p&gt;Here's the commit hash: 44d8ee9115ebcfdaba03238031b68a58dbcc4cd6&lt;/p&gt;</comment>
                            <comment id="15178866" author="jira-bot" created="Thu, 3 Mar 2016 16:42:45 -0700">&lt;p&gt;Commit ba039f7c8c28518053776fe9952e5cb93c5b3f75 in lucene-solr's branch refs/heads/branch_6x from anshum&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ba039f7" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ba039f7&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8769" title="CloudMLTQParser does not use uniqueKey field name for exclusion" class="issue-link" data-issue-key="SOLR-8769"&gt;&lt;del&gt;SOLR-8769&lt;/del&gt;&lt;/a&gt;: Fix document exclusion in mlt query parser in Cloud mode for schemas that have non-'id' unique field&lt;/p&gt;</comment>
                            <comment id="15179007" author="anshumg" created="Thu, 3 Mar 2016 17:21:39 -0700">&lt;p&gt;I'm waiting to hear back from Nick before I port this for the 6.0 release.&lt;/p&gt;</comment>
                            <comment id="15179108" author="jira-bot" created="Thu, 3 Mar 2016 18:28:24 -0700">&lt;p&gt;Commit 18874ababc73404356bd24fef2687d33f9489887 in lucene-solr's branch refs/heads/branch_6_0 from anshum&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=18874ab" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=18874ab&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8769" title="CloudMLTQParser does not use uniqueKey field name for exclusion" class="issue-link" data-issue-key="SOLR-8769"&gt;&lt;del&gt;SOLR-8769&lt;/del&gt;&lt;/a&gt;: Fix document exclusion in mlt query parser in Cloud mode for schemas that have non-'id' unique field&lt;/p&gt;</comment>
                            <comment id="15253079" author="anshumg" created="Thu, 21 Apr 2016 17:32:36 -0700">&lt;p&gt;branch_5x&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
commit 8dc61cecdc933b52a8ec15eb34756e50ee2378ab
Author: anshum &amp;lt;anshum@apache.org&amp;gt;
Date:   Thu Mar 3 15:27:04 2016 -0800

    SOLR-8769: Fix document exclusion in mlt query parser in Cloud mode &lt;span class="code-keyword"&gt;for&lt;/span&gt; schemas that have non-'id' unique field
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;branch_5_5&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
commit 66f47a53f904bab2d845a1a3baf2e0090830cfc7
Author: anshum &amp;lt;anshum@apache.org&amp;gt;
Date:   Thu Mar 3 15:27:04 2016 -0800

    SOLR-8769: Fix document exclusion in mlt query parser in Cloud mode &lt;span class="code-keyword"&gt;for&lt;/span&gt; schemas that have non-'id' unique field
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 3 Mar 2016 23:39:21 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2tzcn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8766] remove the deprecated &lt;admin&gt;tag from solrconfig.xml</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8766</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;thisis not used anymore anywhere&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-xml"&gt;
  &lt;span class="code-tag"&gt;&lt;span class="code-comment"&gt;&amp;lt;!-- Legacy config for the admin interface --&amp;gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class="code-tag"&gt;&amp;lt;admin&amp;gt;&lt;/span&gt;
    &lt;span class="code-tag"&gt;&amp;lt;defaultQuery&amp;gt;&lt;/span&gt;*:*&lt;span class="code-tag"&gt;&amp;lt;/defaultQuery&amp;gt;&lt;/span&gt;
  &lt;span class="code-tag"&gt;&amp;lt;/admin&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=upayavira" class="user-hover" rel="upayavira"&gt;Upayavira&lt;/a&gt; do you think it's OK to nuke it&lt;/p&gt;</description>
                <environment/>
        <key id="12945830">SOLR-8766</key>
            <summary>remove the deprecated &lt;admin&gt;tag from solrconfig.xml</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="5" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.png">Trivial</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="noble.paul">Noble Paul</assignee>
                                    <reporter username="noble.paul">Noble Paul</reporter>
                        <labels>
                    </labels>
                <created>Tue, 1 Mar 2016 06:49:19 -0700</created>
                <updated>Tue, 8 Mar 2016 07:38:24 -0700</updated>
                            <resolved>Tue, 8 Mar 2016 07:38:24 -0700</resolved>
                                                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="15173795" author="upayavira" created="Tue, 1 Mar 2016 07:06:53 -0700">&lt;p&gt;See no issue with that&lt;/p&gt;</comment>
                            <comment id="15173798" author="steve_rowe" created="Tue, 1 Mar 2016 07:10:00 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8398" title="Remove deprecated &amp;lt;admin/gettableFiles&amp;gt; support in solrconfig" class="issue-link" data-issue-key="SOLR-8398"&gt;&lt;del&gt;SOLR-8398&lt;/del&gt;&lt;/a&gt; is part of this.&lt;/p&gt;</comment>
                            <comment id="15181793" author="gerlowskija" created="Sat, 5 Mar 2016 11:11:29 -0700">&lt;p&gt;This patch scrubs any/all &amp;lt;admin&amp;gt; tags from solrconfig.xml.&lt;/p&gt;</comment>
                            <comment id="15184904" author="jira-bot" created="Tue, 8 Mar 2016 06:21:29 -0700">&lt;p&gt;Commit 84b06e2ef1d8648b9584bff6fe1f62359ff2ca1b in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=84b06e2" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=84b06e2&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8766" title="remove the deprecated &amp;lt;admin&amp;gt;tag from solrconfig.xml" class="issue-link" data-issue-key="SOLR-8766"&gt;&lt;del&gt;SOLR-8766&lt;/del&gt;&lt;/a&gt;: deprecated &amp;lt;admin&amp;gt; tag in solrconfig.xml is removed&lt;/p&gt;</comment>
                            <comment id="15184906" author="jira-bot" created="Tue, 8 Mar 2016 06:23:24 -0700">&lt;p&gt;Commit 058ddffcafd215039194c84ac6b6f315f9dd83cd in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=058ddff" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=058ddff&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8766" title="remove the deprecated &amp;lt;admin&amp;gt;tag from solrconfig.xml" class="issue-link" data-issue-key="SOLR-8766"&gt;&lt;del&gt;SOLR-8766&lt;/del&gt;&lt;/a&gt;: deprecated &amp;lt;admin&amp;gt; tag in solrconfig.xml is removed&lt;/p&gt;</comment>
                            <comment id="15184908" author="jira-bot" created="Tue, 8 Mar 2016 06:24:29 -0700">&lt;p&gt;Commit e70c638bcf5b2b76f3b2dd70fed55ccd6b25411d in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e70c638" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e70c638&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8766" title="remove the deprecated &amp;lt;admin&amp;gt;tag from solrconfig.xml" class="issue-link" data-issue-key="SOLR-8766"&gt;&lt;del&gt;SOLR-8766&lt;/del&gt;&lt;/a&gt;: deprecated &amp;lt;admin&amp;gt; tag in solrconfig.xml is removed&lt;/p&gt;</comment>
                            <comment id="15184917" author="varunthacker" created="Tue, 8 Mar 2016 06:35:58 -0700">&lt;p&gt;Re-opening this to remove the admin/gettableFiles from the code&lt;/p&gt;</comment>
                            <comment id="15184937" author="jira-bot" created="Tue, 8 Mar 2016 07:04:30 -0700">&lt;p&gt;Commit dcb7a882b61d679ce220de8f40045ce8b0d8830b in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varunthacker" class="user-hover" rel="varunthacker"&gt;Varun Thacker&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=dcb7a88" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=dcb7a88&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8766" title="remove the deprecated &amp;lt;admin&amp;gt;tag from solrconfig.xml" class="issue-link" data-issue-key="SOLR-8766"&gt;&lt;del&gt;SOLR-8766&lt;/del&gt;&lt;/a&gt;: Remove support for admin/gettableFiles as well&lt;/p&gt;</comment>
                            <comment id="15184940" author="jira-bot" created="Tue, 8 Mar 2016 07:07:03 -0700">&lt;p&gt;Commit 981ad999d075266423b01ece3be31ada3f89913b in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varunthacker" class="user-hover" rel="varunthacker"&gt;Varun Thacker&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=981ad99" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=981ad99&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8766" title="remove the deprecated &amp;lt;admin&amp;gt;tag from solrconfig.xml" class="issue-link" data-issue-key="SOLR-8766"&gt;&lt;del&gt;SOLR-8766&lt;/del&gt;&lt;/a&gt;: Remove support for admin/gettableFiles as well&lt;/p&gt;</comment>
                            <comment id="15184941" author="jira-bot" created="Tue, 8 Mar 2016 07:08:14 -0700">&lt;p&gt;Commit 5298fe965ae6adef24ca8b2e077d910e8553d978 in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varunthacker" class="user-hover" rel="varunthacker"&gt;Varun Thacker&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=5298fe9" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=5298fe9&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8766" title="remove the deprecated &amp;lt;admin&amp;gt;tag from solrconfig.xml" class="issue-link" data-issue-key="SOLR-8766"&gt;&lt;del&gt;SOLR-8766&lt;/del&gt;&lt;/a&gt;: Remove support for admin/gettableFiles as well&lt;/p&gt;</comment>
                            <comment id="15184978" author="varunthacker" created="Tue, 8 Mar 2016 07:38:24 -0700">&lt;p&gt;I am resolving the issue. Committed the extra changes.&lt;/p&gt;

&lt;p&gt;Thanks Jason for your patches!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12920716">SOLR-8398</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12920716">SOLR-8398</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12791633" name="SOLR-8766.patch" size="29854" author="gerlowskija" created="Sat, 5 Mar 2016 11:11:29 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 1 Mar 2016 14:06:53 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2tz4v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8764] Remove all deprecated methods and classes from master prior to the 6.0 release</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8764</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Code marked as deprecated with &lt;tt&gt;@Deprecated&lt;/tt&gt; and/or &lt;tt&gt;@deprecated&lt;/tt&gt; should be removed from master, unless it's being used internally, or the annotations are there as markers.&lt;/p&gt;</description>
                <environment/>
        <key id="12945714">SOLR-8764</key>
            <summary>Remove all deprecated methods and classes from master prior to the 6.0 release</summary>
                <type id="3" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/task.png">Task</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="steve_rowe">Steve Rowe</assignee>
                                    <reporter username="steve_rowe">Steve Rowe</reporter>
                        <labels>
                    </labels>
                <created>Mon, 29 Feb 2016 20:03:12 -0700</created>
                <updated>Thu, 3 Mar 2016 12:24:53 -0700</updated>
                            <resolved>Thu, 3 Mar 2016 12:24:53 -0700</resolved>
                                                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="15173153" author="steve_rowe" created="Mon, 29 Feb 2016 20:06:52 -0700">&lt;p&gt;First cut at a patch.  Compiles and passes precommit but I haven't looked at test failures yet, so there may be problems.&lt;/p&gt;

&lt;p&gt;I've excluded deprecations for &lt;a href="https://issues.apache.org/jira/browse/SOLR-8668" title="Remove support for &amp;lt;mergePolicy&amp;gt;" class="issue-link" data-issue-key="SOLR-8668"&gt;SOLR-8668&lt;/a&gt;, and also facet.date deprecations, for which I'll put up a separate patch on &lt;a href="https://issues.apache.org/jira/browse/SOLR-7010" title="Remove facet.date client functionality from master" class="issue-link" data-issue-key="SOLR-7010"&gt;&lt;del&gt;SOLR-7010&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15173816" author="steve_rowe" created="Tue, 1 Mar 2016 07:29:31 -0700">&lt;p&gt;Patch, fixes a few failing tests and adds a CHANGES.txt entry.&lt;/p&gt;

&lt;p&gt;Tests and precommit pass.&lt;/p&gt;

&lt;p&gt;I think it's ready to go.  If there are no objections I'll commit later today.&lt;/p&gt;</comment>
                            <comment id="15175654" author="jira-bot" created="Wed, 2 Mar 2016 07:23:01 -0700">&lt;p&gt;Commit 9427b7402da33cccff9692bb4d7146dad4bb16e1 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe" class="user-hover" rel="steve_rowe"&gt;Steve Rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9427b74" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9427b74&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8764" title="Remove all deprecated methods and classes from master prior to the 6.0 release" class="issue-link" data-issue-key="SOLR-8764"&gt;&lt;del&gt;SOLR-8764&lt;/del&gt;&lt;/a&gt;: Remove deprecated methods and classes&lt;/p&gt;</comment>
                            <comment id="15175662" author="jira-bot" created="Wed, 2 Mar 2016 07:29:27 -0700">&lt;p&gt;Commit 8bbb1dcacea996f81b989e360578a64ba3b78bfb in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe" class="user-hover" rel="steve_rowe"&gt;Steve Rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=8bbb1dc" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=8bbb1dc&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8764" title="Remove all deprecated methods and classes from master prior to the 6.0 release" class="issue-link" data-issue-key="SOLR-8764"&gt;&lt;del&gt;SOLR-8764&lt;/del&gt;&lt;/a&gt;: Remove deprecated methods and classes&lt;/p&gt;</comment>
                            <comment id="15177124" author="jira-bot" created="Wed, 2 Mar 2016 21:03:53 -0700">&lt;p&gt;Commit deb6a4907b19b6756aa83cf149564e1fd05fc34a in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley" class="user-hover" rel="dsmiley"&gt;David Smiley&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=deb6a49" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=deb6a49&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8764" title="Remove all deprecated methods and classes from master prior to the 6.0 release" class="issue-link" data-issue-key="SOLR-8764"&gt;&lt;del&gt;SOLR-8764&lt;/del&gt;&lt;/a&gt;: test schema-latest.xml spatial dist units should be kilometers&lt;br/&gt;
(no test uses yet?)&lt;/p&gt;</comment>
                            <comment id="15177129" author="jira-bot" created="Wed, 2 Mar 2016 21:05:45 -0700">&lt;p&gt;Commit 6dcb01ccb4ec77a1cf2fa89155335ead689535c1 in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley" class="user-hover" rel="dsmiley"&gt;David Smiley&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=6dcb01c" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=6dcb01c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8764" title="Remove all deprecated methods and classes from master prior to the 6.0 release" class="issue-link" data-issue-key="SOLR-8764"&gt;&lt;del&gt;SOLR-8764&lt;/del&gt;&lt;/a&gt;: test schema-latest.xml spatial dist units should be kilometers&lt;br/&gt;
(no test uses yet?)&lt;br/&gt;
(cherry picked from commit deb6a49)&lt;/p&gt;</comment>
                            <comment id="15177946" author="jira-bot" created="Thu, 3 Mar 2016 08:23:20 -0700">&lt;p&gt;Commit 84d2bb604207e6f07914fd37da5337b867c0cee9 in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley" class="user-hover" rel="dsmiley"&gt;David Smiley&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=84d2bb6" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=84d2bb6&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8764" title="Remove all deprecated methods and classes from master prior to the 6.0 release" class="issue-link" data-issue-key="SOLR-8764"&gt;&lt;del&gt;SOLR-8764&lt;/del&gt;&lt;/a&gt;: test schema-latest.xml spatial dist units should be kilometers&lt;br/&gt;
(no test uses yet?)&lt;br/&gt;
(cherry picked from commit deb6a49)&lt;br/&gt;
(cherry picked from commit 6dcb01c)&lt;/p&gt;</comment>
                            <comment id="15177973" author="steve_rowe" created="Thu, 3 Mar 2016 08:42:29 -0700">&lt;p&gt;These changes exposed a bug in Solr's CSV handling code - see &lt;a href="https://issues.apache.org/jira/browse/SOLR-8778" title="Deprecate CSVStrategy&amp;#39;s setters, and make its pre-configured strategies immutable" class="issue-link" data-issue-key="SOLR-8778"&gt;&lt;del&gt;SOLR-8778&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                            <outwardlinks description="breaks">
                                        <issuelink>
            <issuekey id="12946336">SOLR-8778</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12790724" name="SOLR-8764.patch" size="99035" author="steve_rowe" created="Tue, 1 Mar 2016 07:29:31 -0700"/>
                            <attachment id="12790650" name="SOLR-8764.patch" size="86578" author="steve_rowe" created="Mon, 29 Feb 2016 20:06:52 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 2 Mar 2016 14:23:01 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2tyf3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8758] Add SolrCloudTestCase base class</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8758</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;At the moment, if you want to write unit tests for Cloud components, you have to extend AbstractDistribZkTestCase, which has a number of disadvantages:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;the API isn't well-documented&lt;/li&gt;
	&lt;li&gt;you get a default configuration loaded into ZK, and it's not trivial to add separate ones&lt;/li&gt;
	&lt;li&gt;you get a default collection, whether you want one or not&lt;/li&gt;
	&lt;li&gt;the test cluster isn't static, which means that it's started up and shutdown after every test function.  To avoid tests being incredibly slow, we end up writing single-function tests that call out to sub-functions, losing the benefits of execution-order randomization.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;It would be more useful to have a properly configurable and documented testcase base class.&lt;/p&gt;</description>
                <environment/>
        <key id="12945429">SOLR-8758</key>
            <summary>Add SolrCloudTestCase base class</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="romseygeek">Alan Woodward</reporter>
                        <labels>
                    </labels>
                <created>Mon, 29 Feb 2016 04:41:47 -0700</created>
                <updated>Thu, 21 Apr 2016 15:30:09 -0700</updated>
                            <resolved>Thu, 21 Apr 2016 15:30:09 -0700</resolved>
                                                    <fixVersion>5.5.1</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                <comments>
                            <comment id="15171780" author="romseygeek" created="Mon, 29 Feb 2016 04:45:05 -0700">&lt;p&gt;Here's a patch.  The base class uses a MiniSolrCloudCluster, and exposes a Builder interface to configure it.  You can give it a solr.xml (either as a Path or a String), and add configs that will be uploaded when the cluster starts.&lt;/p&gt;

&lt;p&gt;I initially wanted to implement this as a junit ExternalResource that could be added as a ClassRule, but unfortunately this puts it outside the BeforeClass/AfterClass boundaries of LuceneTestCase and it falls foul of things like the ThreadLeak tracker.&lt;/p&gt;</comment>
                            <comment id="15172051" author="tomasflobbe" created="Mon, 29 Feb 2016 09:02:20 -0700">&lt;p&gt;+1! AbstractDistribZkTestCase also creates the "control Jetty vs distrib" by default, which is not always something you need.&lt;/p&gt;</comment>
                            <comment id="15172174" author="markrmiller@gmail.com" created="Mon, 29 Feb 2016 10:16:05 -0700">&lt;p&gt;We also need to move from that pattern to get rid of legacyCloud=true and finish zk=truth. We can't have all those tests with predefined cores. &lt;/p&gt;</comment>
                            <comment id="15172234" author="romseygeek" created="Mon, 29 Feb 2016 10:54:40 -0700">&lt;p&gt;Yes, once this is committed we can start cutting over the tests one-by-one.  &lt;a href="https://issues.apache.org/jira/browse/SOLR-8323" title="Add CollectionWatcher API to ZkStateReader" class="issue-link" data-issue-key="SOLR-8323"&gt;SOLR-8323&lt;/a&gt; should help here as well.&lt;/p&gt;</comment>
                            <comment id="15172348" author="jira-bot" created="Mon, 29 Feb 2016 11:44:42 -0700">&lt;p&gt;Commit 9a3458f69328045a8c62acc826f3012edeb154c6 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=romseygeek" class="user-hover" rel="romseygeek"&gt;Alan Woodward&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9a3458f" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9a3458f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8758" title="Add SolrCloudTestCase base class" class="issue-link" data-issue-key="SOLR-8758"&gt;&lt;del&gt;SOLR-8758&lt;/del&gt;&lt;/a&gt;: Add SolrCloudTestCase base class&lt;/p&gt;</comment>
                            <comment id="15172349" author="romseygeek" created="Mon, 29 Feb 2016 11:45:12 -0700">&lt;p&gt;Thanks for the review gents.&lt;/p&gt;</comment>
                            <comment id="15252770" author="anshumg" created="Thu, 21 Apr 2016 14:21:23 -0700">&lt;p&gt;I'll also back port this to 5x for 5.5.1 so that the bug fixes and tests that use SolrCloudTestCase base class from master/6.0 can be easily back ported.&lt;/p&gt;</comment>
                            <comment id="15252819" author="jira-bot" created="Thu, 21 Apr 2016 14:49:31 -0700">&lt;p&gt;Commit 27e284bb7bcd6536b3c017d76e675f24397cce9c in lucene-solr's branch refs/heads/branch_5x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=romseygeek" class="user-hover" rel="romseygeek"&gt;Alan Woodward&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=27e284b" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=27e284b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8758" title="Add SolrCloudTestCase base class" class="issue-link" data-issue-key="SOLR-8758"&gt;&lt;del&gt;SOLR-8758&lt;/del&gt;&lt;/a&gt;: Add SolrCloudTestCase base class&lt;/p&gt;</comment>
                            <comment id="15252872" author="jira-bot" created="Thu, 21 Apr 2016 15:14:58 -0700">&lt;p&gt;Commit 4a274605b8b426029276b9cccec78a23c095e0da in lucene-solr's branch refs/heads/branch_5_5 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=romseygeek" class="user-hover" rel="romseygeek"&gt;Alan Woodward&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=4a27460" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=4a27460&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8758" title="Add SolrCloudTestCase base class" class="issue-link" data-issue-key="SOLR-8758"&gt;&lt;del&gt;SOLR-8758&lt;/del&gt;&lt;/a&gt;: Add SolrCloudTestCase base class&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12957280">SOLR-8959</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12790456" name="SOLR-8758.patch" size="5216" author="romseygeek" created="Mon, 29 Feb 2016 04:45:05 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 29 Feb 2016 16:02:20 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2twof:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8752] Add a test for SizeLimitedDistributedMap</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8752</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;This class performs cleanup logic on a put operation. We should add a test for it and beef up javadocs.&lt;/p&gt;</description>
                <environment/>
        <key id="12945172">SOLR-8752</key>
            <summary>Add a test for SizeLimitedDistributedMap</summary>
                <type id="6" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/requirement.png">Test</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="shalinmangar">Shalin Shekhar Mangar</assignee>
                                    <reporter username="shalinmangar">Shalin Shekhar Mangar</reporter>
                        <labels>
                    </labels>
                <created>Fri, 26 Feb 2016 23:12:04 -0700</created>
                <updated>Sat, 27 Feb 2016 05:41:43 -0700</updated>
                            <resolved>Sat, 27 Feb 2016 00:08:55 -0700</resolved>
                                                    <fixVersion>6.0</fixVersion>
                    <fixVersion>master</fixVersion>
                                    <component>SolrCloud</component>
                    <component>Tests</component>
                        <due/>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="15170390" author="shalinmangar" created="Fri, 26 Feb 2016 23:13:38 -0700">&lt;p&gt;Test + simple javadocs for SizeLimitedDistributedMap&lt;/p&gt;</comment>
                            <comment id="15170409" author="jira-bot" created="Sat, 27 Feb 2016 00:06:29 -0700">&lt;p&gt;Commit 06053fc01cf149553d2cb18535f692fab5699420 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalinmangar" class="user-hover" rel="shalinmangar"&gt;Shalin Shekhar Mangar&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=06053fc" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=06053fc&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8752" title="Add a test for SizeLimitedDistributedMap" class="issue-link" data-issue-key="SOLR-8752"&gt;&lt;del&gt;SOLR-8752&lt;/del&gt;&lt;/a&gt;: Add a test for SizeLimitedDistributedMap and improve javadocs&lt;/p&gt;</comment>
                            <comment id="15170574" author="jira-bot" created="Sat, 27 Feb 2016 05:41:43 -0700">&lt;p&gt;Commit 70440bbbd20d0642f3d0af5762c811d456622cd0 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalinmangar" class="user-hover" rel="shalinmangar"&gt;Shalin Shekhar Mangar&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=70440bb" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=70440bb&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8752" title="Add a test for SizeLimitedDistributedMap" class="issue-link" data-issue-key="SOLR-8752"&gt;&lt;del&gt;SOLR-8752&lt;/del&gt;&lt;/a&gt;: Add change log entry&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12790291" name="SOLR-8752.patch" size="3798" author="shalinmangar" created="Fri, 26 Feb 2016 23:13:38 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 27 Feb 2016 07:06:29 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2tv33:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8750] Use lambdas in code where SAM type interfaces are used</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8750</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description/>
                <environment/>
        <key id="12945154">SOLR-8750</key>
            <summary>Use lambdas in code where SAM type interfaces are used</summary>
                <type id="3" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/task.png">Task</type>
                                            <priority id="5" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.png">Trivial</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="noble.paul">Noble Paul</assignee>
                                    <reporter username="noble.paul">Noble Paul</reporter>
                        <labels>
                    </labels>
                <created>Fri, 26 Feb 2016 18:56:15 -0700</created>
                <updated>Thu, 7 Apr 2016 13:29:44 -0700</updated>
                            <resolved>Fri, 4 Mar 2016 06:28:22 -0700</resolved>
                                                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="15179866" author="jira-bot" created="Fri, 4 Mar 2016 06:24:28 -0700">&lt;p&gt;Commit c27dd8e03866082686ab3d17f7350f91975a8efc in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c27dd8e" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c27dd8e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8750" title="Use lambdas in code where SAM type interfaces are used" class="issue-link" data-issue-key="SOLR-8750"&gt;&lt;del&gt;SOLR-8750&lt;/del&gt;&lt;/a&gt; : Use lambdas in code where SAM type interfaces are used&lt;/p&gt;</comment>
                            <comment id="15179868" author="jira-bot" created="Fri, 4 Mar 2016 06:25:56 -0700">&lt;p&gt;Commit 8d835f1231d4f5e4ebfa70a4320bc7daa447197b in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=8d835f1" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=8d835f1&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8750" title="Use lambdas in code where SAM type interfaces are used" class="issue-link" data-issue-key="SOLR-8750"&gt;&lt;del&gt;SOLR-8750&lt;/del&gt;&lt;/a&gt; : Use lambdas in code where SAM type interfaces are used&lt;/p&gt;</comment>
                            <comment id="15179870" author="jira-bot" created="Fri, 4 Mar 2016 06:27:44 -0700">&lt;p&gt;Commit 6a4f912b5bd1b924244efebc02308bd65df17757 in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=6a4f912" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=6a4f912&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8750" title="Use lambdas in code where SAM type interfaces are used" class="issue-link" data-issue-key="SOLR-8750"&gt;&lt;del&gt;SOLR-8750&lt;/del&gt;&lt;/a&gt; : Use lambdas in code where SAM type interfaces are used&lt;/p&gt;</comment>
                            <comment id="15226766" author="jira-bot" created="Tue, 5 Apr 2016 10:51:43 -0700">&lt;p&gt;Commit d67ec549320ae1f12981797fa5c64eb62d401e86 in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d67ec54" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d67ec54&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8750" title="Use lambdas in code where SAM type interfaces are used" class="issue-link" data-issue-key="SOLR-8750"&gt;&lt;del&gt;SOLR-8750&lt;/del&gt;&lt;/a&gt;: replace anonymous inner class for callable, Runnable etc&lt;/p&gt;</comment>
                            <comment id="15226767" author="jira-bot" created="Tue, 5 Apr 2016 10:51:44 -0700">&lt;p&gt;Commit 88d2b3bfbed3d823a13b486ba44cb2d219ae0941 in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=88d2b3b" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=88d2b3b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8750" title="Use lambdas in code where SAM type interfaces are used" class="issue-link" data-issue-key="SOLR-8750"&gt;&lt;del&gt;SOLR-8750&lt;/del&gt;&lt;/a&gt;: replace anonymous inner class for callable, Runnable etc&lt;/p&gt;</comment>
                            <comment id="15226776" author="steve_rowe" created="Tue, 5 Apr 2016 10:58:29 -0700">&lt;p&gt;Noble, please don't commit under issues that are marked as fixed in a version that you can't commit to (i.e. previously released, or a frozen release branch pending release).&lt;/p&gt;

&lt;p&gt;The "replace anonymous inner class for callable, Runnable etc" commit should have been done under a new JIRA.&lt;/p&gt;</comment>
                            <comment id="15226803" author="noble.paul" created="Tue, 5 Apr 2016 11:09:47 -0700">&lt;p&gt;I thought of doing that. This was a trivial code cleanup and I thought it was an overkill to open a ticket  &lt;/p&gt;</comment>
                            <comment id="15231001" author="jira-bot" created="Thu, 7 Apr 2016 13:29:44 -0700">&lt;p&gt;Commit 18fb9463de4828e736fa75e0e8f06c013133513b in lucene-solr's branch refs/heads/apiv2 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=18fb946" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=18fb946&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8750" title="Use lambdas in code where SAM type interfaces are used" class="issue-link" data-issue-key="SOLR-8750"&gt;&lt;del&gt;SOLR-8750&lt;/del&gt;&lt;/a&gt;: replace anonymous inner class for callable, Runnable etc&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 4 Mar 2016 13:24:28 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2tuz3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8748] OverseerTaskProcessor limits number of concurrent tasks to just 10 even though the thread pool size is 100</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8748</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;OverseerTaskProcessor uses maxParallelThreads to limit number of concurrent tasks but the same is not used for creating the thread pool. The default limit of 10 is too small, IMO and we should change it to 100. The overseer collection processor mostly just waits around on network calls so there is no harm in increasing this limit.&lt;/p&gt;</description>
                <environment/>
        <key id="12945142">SOLR-8748</key>
            <summary>OverseerTaskProcessor limits number of concurrent tasks to just 10 even though the thread pool size is 100</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="shalinmangar">Shalin Shekhar Mangar</assignee>
                                    <reporter username="shalinmangar">Shalin Shekhar Mangar</reporter>
                        <labels>
                    </labels>
                <created>Fri, 26 Feb 2016 18:13:30 -0700</created>
                <updated>Thu, 21 Apr 2016 15:30:58 -0700</updated>
                            <resolved>Thu, 21 Apr 2016 15:30:58 -0700</resolved>
                                    <version>4.10.4</version>
                    <version>5.5</version>
                                    <fixVersion>5.5.1</fixVersion>
                    <fixVersion>6.0</fixVersion>
                    <fixVersion>master</fixVersion>
                                    <component>SolrCloud</component>
                        <due/>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="15170434" author="shalinmangar" created="Sat, 27 Feb 2016 00:52:49 -0700">&lt;ol&gt;
	&lt;li&gt;Renamed maxParallelThreads to a static constant MAX_PARALLEL_TASKS&lt;/li&gt;
	&lt;li&gt;Increased value of constant to 100 from 10.&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="15170464" author="jira-bot" created="Sat, 27 Feb 2016 01:35:18 -0700">&lt;p&gt;Commit c59ca69ec008251d8e16ce05b71122c4abe75669 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalinmangar" class="user-hover" rel="shalinmangar"&gt;Shalin Shekhar Mangar&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c59ca69" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c59ca69&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8748" title="OverseerTaskProcessor limits number of concurrent tasks to just 10 even though the thread pool size is 100" class="issue-link" data-issue-key="SOLR-8748"&gt;&lt;del&gt;SOLR-8748&lt;/del&gt;&lt;/a&gt;: OverseerTaskProcessor limits number of concurrent tasks to just 10 even though the thread pool size is 100. The limit has now been increased to 100.&lt;/p&gt;</comment>
                            <comment id="15170466" author="shalinmangar" created="Sat, 27 Feb 2016 01:37:12 -0700">&lt;p&gt;Shout out to &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dragonsinth" class="user-hover" rel="dragonsinth"&gt;Scott Blum&lt;/a&gt; for finding this bug.&lt;/p&gt;</comment>
                            <comment id="15252725" author="anshumg" created="Thu, 21 Apr 2016 14:01:51 -0700">&lt;p&gt;Reopening for 5.5.1&lt;/p&gt;</comment>
                            <comment id="15252817" author="jira-bot" created="Thu, 21 Apr 2016 14:49:28 -0700">&lt;p&gt;Commit 953949181992351cdad417d5fff05f1fcc5ee510 in lucene-solr's branch refs/heads/branch_5x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalinmangar" class="user-hover" rel="shalinmangar"&gt;Shalin Shekhar Mangar&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9539491" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9539491&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8748" title="OverseerTaskProcessor limits number of concurrent tasks to just 10 even though the thread pool size is 100" class="issue-link" data-issue-key="SOLR-8748"&gt;&lt;del&gt;SOLR-8748&lt;/del&gt;&lt;/a&gt;: OverseerTaskProcessor limits number of concurrent tasks to just 10 even though the thread pool size is 100. The limit has now been increased to 100.&lt;/p&gt;</comment>
                            <comment id="15252870" author="jira-bot" created="Thu, 21 Apr 2016 15:14:55 -0700">&lt;p&gt;Commit f1127db72c7ac247f25420c34b49b92f3e156dd7 in lucene-solr's branch refs/heads/branch_5_5 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalinmangar" class="user-hover" rel="shalinmangar"&gt;Shalin Shekhar Mangar&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f1127db" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f1127db&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8748" title="OverseerTaskProcessor limits number of concurrent tasks to just 10 even though the thread pool size is 100" class="issue-link" data-issue-key="SOLR-8748"&gt;&lt;del&gt;SOLR-8748&lt;/del&gt;&lt;/a&gt;: OverseerTaskProcessor limits number of concurrent tasks to just 10 even though the thread pool size is 100. The limit has now been increased to 100.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12790301" name="SOLR-8748.patch" size="1939" author="shalinmangar" created="Sat, 27 Feb 2016 00:52:49 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 27 Feb 2016 08:35:18 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2tuwf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8747] ExclusiveMarking enum and checkExclusiveMarking method is very confusing</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8747</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;ExclusiveMarking enum and checkExclusiveMarking method is very confusing.  It appears to do the opposite of its name e.g.&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
@Override
  &lt;span class="code-keyword"&gt;public&lt;/span&gt; ExclusiveMarking checkExclusiveMarking(&lt;span class="code-object"&gt;String&lt;/span&gt; collectionName, ZkNodeProps message) {
    &lt;span class="code-comment"&gt;// CLUSTERSTATUS is always mutually exclusive
&lt;/span&gt;    &lt;span class="code-comment"&gt;//TODO deprecated remove &lt;span class="code-keyword"&gt;this&lt;/span&gt; check .
&lt;/span&gt;    &lt;span class="code-keyword"&gt;if&lt;/span&gt;(CLUSTERSTATUS.isEqual(message.getStr(Overseer.QUEUE_OPERATION)))
      &lt;span class="code-keyword"&gt;return&lt;/span&gt; ExclusiveMarking.EXCLUSIVE;

    &lt;span class="code-keyword"&gt;synchronized&lt;/span&gt; (collectionWip) {
      &lt;span class="code-keyword"&gt;if&lt;/span&gt;(collectionWip.contains(collectionName))
        &lt;span class="code-keyword"&gt;return&lt;/span&gt; ExclusiveMarking.NONEXCLUSIVE;
    }

    &lt;span class="code-keyword"&gt;return&lt;/span&gt; ExclusiveMarking.NOTDETERMINED;
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I guess it returns exclusive if the current task is the only one to run. We should document it or rename it to make its function more comprehensible.&lt;/p&gt;</description>
                <environment/>
        <key id="12945139">SOLR-8747</key>
            <summary>ExclusiveMarking enum and checkExclusiveMarking method is very confusing</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="shalinmangar">Shalin Shekhar Mangar</reporter>
                        <labels>
                    </labels>
                <created>Fri, 26 Feb 2016 18:00:50 -0700</created>
                <updated>Fri, 6 May 2016 09:37:42 -0700</updated>
                                                            <fixVersion>6.0</fixVersion>
                    <fixVersion>master</fixVersion>
                                    <component>SolrCloud</component>
                        <due/>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="15274315" author="dragonsinth" created="Fri, 6 May 2016 09:35:00 -0700">&lt;p&gt;CC: &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt; related to &lt;a href="https://issues.apache.org/jira/browse/SOLR-8744" title="SplitShard needs finer-grained mutual exclusion" class="issue-link" data-issue-key="SOLR-8744"&gt;SOLR-8744&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15274327" author="noble.paul" created="Fri, 6 May 2016 09:37:42 -0700">&lt;p&gt;We need a refactoring of this feature to ensure that locking is done at the right level. We should just link these two&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 6 May 2016 16:35:00 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2tuvr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>

<item>
            <title>[SOLR-8746] Document the usage and difference between various overseer queues, rename methods if necessary</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8746</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;The various overseer queues can use better javadocs to document their purpose and usage. The method names such as getInQueue, getInternalQueue and getCollectionQueue aren't descriptive enough.&lt;/p&gt;</description>
                <environment/>
        <key id="12945137">SOLR-8746</key>
            <summary>Document the usage and difference between various overseer queues, rename methods if necessary</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="shalinmangar">Shalin Shekhar Mangar</assignee>
                                    <reporter username="shalinmangar">Shalin Shekhar Mangar</reporter>
                        <labels>
                    </labels>
                <created>Fri, 26 Feb 2016 17:53:57 -0700</created>
                <updated>Sat, 27 Feb 2016 01:38:16 -0700</updated>
                            <resolved>Sat, 27 Feb 2016 00:41:25 -0700</resolved>
                                                    <fixVersion>6.0</fixVersion>
                    <fixVersion>master</fixVersion>
                                    <component>SolrCloud</component>
                        <due/>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="15170426" author="shalinmangar" created="Sat, 27 Feb 2016 00:38:20 -0700">&lt;ol&gt;
	&lt;li&gt;Renamed Overseer.getInQueue to getStateUpdateQueue&lt;/li&gt;
	&lt;li&gt;Renamed Overseer.getInternalQueue to getInternalWorkQueue&lt;/li&gt;
	&lt;li&gt;Added javadocs for getStateUpdateQueue, getInternalWorkQueue, getCollectionQueue&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="15170429" author="jira-bot" created="Sat, 27 Feb 2016 00:41:12 -0700">&lt;p&gt;Commit 41eb5e8542d260cdca630243c8800b5aa7e74623 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalinmangar" class="user-hover" rel="shalinmangar"&gt;Shalin Shekhar Mangar&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=41eb5e8" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=41eb5e8&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8746" title="Document the usage and difference between various overseer queues, rename methods if necessary" class="issue-link" data-issue-key="SOLR-8746"&gt;&lt;del&gt;SOLR-8746&lt;/del&gt;&lt;/a&gt;: Renamed Overseer.getInQueue to getStateUpdateQueue, getInternalQueue to getInternalWorkQueue and added javadocs&lt;/p&gt;</comment>
                            <comment id="15170465" author="jira-bot" created="Sat, 27 Feb 2016 01:36:18 -0700">&lt;p&gt;Commit 9c97f2f3d26303a0354435fc011d3a747ce29ff7 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalinmangar" class="user-hover" rel="shalinmangar"&gt;Shalin Shekhar Mangar&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9c97f2f" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9c97f2f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8746" title="Document the usage and difference between various overseer queues, rename methods if necessary" class="issue-link" data-issue-key="SOLR-8746"&gt;&lt;del&gt;SOLR-8746&lt;/del&gt;&lt;/a&gt;: Renamed Overseer.getInQueue to getStateUpdateQueue, getInternalQueue to getInternalWorkQueue and added javadocs&lt;/p&gt;</comment>
                            <comment id="15170467" author="shalinmangar" created="Sat, 27 Feb 2016 01:38:16 -0700">&lt;p&gt;Thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dragonsinth" class="user-hover" rel="dragonsinth"&gt;Scott Blum&lt;/a&gt; for prodding me to add these docs!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12790300" name="SOLR-8746.patch" size="35785" author="shalinmangar" created="Sat, 27 Feb 2016 00:38:20 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 27 Feb 2016 07:41:12 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2tuvb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8740] set docValues="true" for most non-text fieldTypes in the sample schemas</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8740</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;We should consider switching to docValues for most of the non-text fields in the sample schemas provided with solr.&lt;/p&gt;

&lt;p&gt;This may be a better default since it is more NRT friendly and acts to avoid OOM errors due to large field cache or UnInvertedField entries.&lt;/p&gt;</description>
                <environment/>
        <key id="12944974">SOLR-8740</key>
            <summary>set docValues="true" for most non-text fieldTypes in the sample schemas</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="yseeley@gmail.com">Yonik Seeley</reporter>
                        <labels>
                    </labels>
                <created>Fri, 26 Feb 2016 10:50:55 -0700</created>
                <updated>Fri, 8 Apr 2016 17:43:32 -0700</updated>
                            <resolved>Wed, 16 Mar 2016 16:46:19 -0700</resolved>
                                    <version>master</version>
                                    <fixVersion>6.0</fixVersion>
                    <fixVersion>master</fixVersion>
                                        <due/>
                            <votes>3</votes>
                                    <watches>17</watches>
                                                                <comments>
                            <comment id="15183152" author="tomasflobbe" created="Mon, 7 Mar 2016 08:45:21 -0700">&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="15183177" author="jkrupan" created="Mon, 7 Mar 2016 08:59:50 -0700">&lt;p&gt;And default to docValuesFormat="Memory" as well, or is that already the default when docValues="true" is set?&lt;/p&gt;

&lt;p&gt;Personally, I still find the whole docValues vs. Stored fields narrative extremely confusing. I've never been able to figure out why Lucene still needs Stored fields (other than for tokenized text fields) if docValues is so much better.&lt;/p&gt;

&lt;p&gt;In any case, with this Jira in place, there should be clear doc as to what scenarios, if any, stored="true" might have any utility for non-tokenized/text fields.&lt;/p&gt;</comment>
                            <comment id="15183180" author="varunthacker" created="Mon, 7 Mar 2016 09:01:51 -0700">&lt;p&gt;+1 . Too many new users still don't know about docValues and when their index grows large and they start seeing memory pressure issues re-indexing is a big pain.&lt;/p&gt;
</comment>
                            <comment id="15183190" author="ichattopadhyaya" created="Mon, 7 Mar 2016 09:05:47 -0700">&lt;p&gt;In the same breath, now that non-stored docValues fields can be accessed through the docValues api, I think the version field should be non-stored dv going forward. &lt;a href="https://issues.apache.org/jira/browse/SOLR-6337" title="Moving the _versions_ field to DocValues" class="issue-link" data-issue-key="SOLR-6337"&gt;SOLR-6337&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15183357" author="jpountz" created="Mon, 7 Mar 2016 11:00:48 -0700">&lt;blockquote&gt;&lt;p&gt;And default to docValuesFormat="Memory" as well, or is that already the default when docValues="true" is set?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Having the default setup not using the default codec looks dangerous to me as it means that users won't be able to upgrade clusters without switching back to the default codec first (which is the only supported one for backwards compatibility).&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I've never been able to figure out why Lucene still needs Stored fields (other than for tokenized text fields) if docValues is so much better.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Doc values are not better, they just have different trade-offs: stored fields are optimized for randomly getting several values from a couple dozen documents while doc values are optimized for sequentially reading a couple values from many documents. If you were to replace stored fields with doc values, performance would become horrible if your index is significantly larger than your filesystem cache, especially if you have spinning disks. I suspect it could be fine if it was only done for the version field as suggested above but doing it for all fields sounds dangerous to me.&lt;/p&gt;</comment>
                            <comment id="15184957" author="yseeley@gmail.com" created="Tue, 8 Mar 2016 07:24:01 -0700">&lt;blockquote&gt;&lt;p&gt;And default to docValuesFormat="Memory" as well, or is that already the default when docValues="true" is set?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The ability to keep everything off-heap and accessed via memory map seems to be the default we want (i.e.the docValues default of "disk").&lt;br/&gt;
Sorting and faceting on docValues fields will most likely be a little slower (ignoring NRT).... but the real benefit is having things "just work" and avoiding the dreaded "I got an OOM exception when I tried to sort on this field" issues.  So we're going to want them by default on non-text fields that people will use for sorting, faceting, stats, etc.&lt;/p&gt;

&lt;p&gt;I'll try and make some time to tackle this issue soon (sometime after the Lucene/Solr NYC meetup on Wednesday)&lt;/p&gt;</comment>
                            <comment id="15184988" author="simon.rosenthal" created="Tue, 8 Mar 2016 07:45:20 -0700">&lt;p&gt;If this is adopted, it  needs to be clearly documented that DocValues do not retain ordering in multivalued fields whereas stored fields do. Our use case -  picking  first and last authors from a multivalued 'authors' String field.&lt;/p&gt;</comment>
                            <comment id="15184997" author="yseeley@gmail.com" created="Tue, 8 Mar 2016 07:51:12 -0700">&lt;p&gt;This issue is really only about changing what our starting schemas look like I think, and won't change any behavior.  That's already been done in other issues.&lt;/p&gt;</comment>
                            <comment id="15185002" author="varunthacker" created="Tue, 8 Mar 2016 07:53:17 -0700">&lt;p&gt;Can we please not mix up the issues.&lt;/p&gt;

&lt;p&gt;The issue here which Yonik created is about making docValues as default. So even if you don't mark a field explicitly with docValues="true" in your schema , Solr will enable it. You have to explicitly turn it off instead. This does not change any behaviour on how fields are returned etc.&lt;/p&gt;

&lt;p&gt;Discussions which started with &lt;tt&gt;I still find the whole docValues vs. Stored fields narrative extremely confusing.&lt;/tt&gt; and any followups on this are tangential to this issue. Solr now supports two way to return back the actual field values. &lt;a href="https://issues.apache.org/jira/browse/SOLR-8220" title="Read field from docValues for non stored fields" class="issue-link" data-issue-key="SOLR-8220"&gt;&lt;del&gt;SOLR-8220&lt;/del&gt;&lt;/a&gt; has all the details and there is a very detailed entry about it in the CHANGES file. Can we please have any followup discussions on that on another mailing list discussion/&lt;a href="https://issues.apache.org/jira/browse/SOLR-8220" title="Read field from docValues for non stored fields" class="issue-link" data-issue-key="SOLR-8220"&gt;&lt;del&gt;SOLR-8220&lt;/del&gt;&lt;/a&gt; Jira&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
* The Solr schema version has been increased to 1.6. Since schema version 1.6, all non-stored docValues fields
  will be returned along with other stored fields when all fields (or pattern matching globs) are specified
  to be returned (e.g. fl=*) &lt;span class="code-keyword"&gt;for&lt;/span&gt; search queries. This behavior can be turned on and off by setting
  'useDocValuesAsStored' parameter &lt;span class="code-keyword"&gt;for&lt;/span&gt; a field or a field type to &lt;span class="code-keyword"&gt;true&lt;/span&gt; (&lt;span class="code-keyword"&gt;default&lt;/span&gt; since schema version 1.6)
  or &lt;span class="code-keyword"&gt;false&lt;/span&gt; (&lt;span class="code-keyword"&gt;default&lt;/span&gt; till schema version 1.5).
  Note that enabling &lt;span class="code-keyword"&gt;this&lt;/span&gt; property has performance implications because DocValues are column-oriented and may
  therefore incur additional cost to retrieve &lt;span class="code-keyword"&gt;for&lt;/span&gt; each returned document. All example schema are upgraded to
  version 1.6 but any older schemas will &lt;span class="code-keyword"&gt;default&lt;/span&gt; to useDocValuesAsStored=&lt;span class="code-keyword"&gt;false&lt;/span&gt; and &lt;span class="code-keyword"&gt;continue&lt;/span&gt; to work as in
  older versions of Solr. If &lt;span class="code-keyword"&gt;this&lt;/span&gt; &lt;span class="code-keyword"&gt;new&lt;/span&gt; behavior is desirable, then you should set version attribute in your
  schema file to '1.6'. Re-indexing is not necessary to upgrade the schema version.
  Also note that &lt;span class="code-keyword"&gt;while&lt;/span&gt; returning non-stored fields from docValues (&lt;span class="code-keyword"&gt;default&lt;/span&gt; in schema versions 1.6+, unless
  useDocValuesAsStored is &lt;span class="code-keyword"&gt;false&lt;/span&gt;), the values of a multi-valued field are returned in sorted order.
  If you require the multi-valued fields to be returned in the original insertion order, then make your
  multi-valued field as stored. This requires re-indexing.
  See SOLR-8220 &lt;span class="code-keyword"&gt;for&lt;/span&gt; more details.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15185031" author="yseeley@gmail.com" created="Tue, 8 Mar 2016 08:07:06 -0700">&lt;blockquote&gt;&lt;p&gt;The issue here which Yonik created is about making docValues as default. So even if you don't mark a field explicitly with docValues="true" in your schema , Solr will enable it. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Oh, hmmm, that's a good point.  I hadn't actually meant that.  But I now realize that the issue title/description is somewhat ambiguous.&lt;br/&gt;
As an example, I was thinking of things like changing the *_i dynamic field in our schema templates to explicitly include docValues="true" by default (or setting it on the fieldType if that's a flag that carries over to all of it's fields by default).&lt;/p&gt;

&lt;p&gt;We could consider changing the default such that even if it doesn't appear in the schema, docValues would be true (and bump the schema version of course).  I had assumed that might be more controversial though, so was just looking to effectively change the de-facto defaults.&lt;/p&gt;

&lt;p&gt;If we can set docValues=true on a fieldType and have it carry over to all fields by default, then that's even friendly for fields added via API or guessed fields.&lt;/p&gt;
</comment>
                            <comment id="15185336" author="jkrupan" created="Tue, 8 Mar 2016 10:43:45 -0700">&lt;p&gt;My apologies for any unnecessary noise I may have caused here. I just think that every single docValues issue raised for Solr should endeavor to make the lives of Solr users a lot easier, not more complicated and even more confusing. As things stand, docValues is more of an expert-only feature. The mere fact that we can't make docValues uniformly the default illustrates that in spades.&lt;/p&gt;</comment>
                            <comment id="15185350" author="joel.bernstein" created="Tue, 8 Mar 2016 10:51:09 -0700">&lt;p&gt;+1 &lt;/p&gt;

&lt;p&gt;I think this ticket is a pretty important improvement because it means that the /export handler (requires docValues) will work out of the box.  The /export handler is needed for many features in Streaming Expressions and Paralllel SQL. So having docValues on by default makes these feature easier to use.&lt;/p&gt;</comment>
                            <comment id="15185492" author="erickerickson" created="Tue, 8 Mar 2016 11:53:09 -0700">&lt;p&gt;Tell you what, I'll either write or make sure a test exists that illustrates my concern and in any case put in a big fat warning in the code to document if the change if it suddenly starts failing.&lt;/p&gt;</comment>
                            <comment id="15185581" author="tomasflobbe" created="Tue, 8 Mar 2016 12:30:43 -0700">&lt;p&gt;Also, if we add PointFields (&lt;a href="https://issues.apache.org/jira/browse/SOLR-8396" title="Investigate PointField to replace NumericField types" class="issue-link" data-issue-key="SOLR-8396"&gt;SOLR-8396&lt;/a&gt;), we'll need docValues for sorting/faceting on them. A basic/unoptimized schema would allow you to sort or facet on any of those fields as you can do now with TrieFields and the FieldCache/FieldValueCache. Later you can optimize the schema by removing DV from the fields where you don't need them. I believe that would be a better starting experience than not adding DV and giving errors. &lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;I was thinking of things like changing the *_i dynamic field in our schema templates to explicitly include docValues="true" by default (or setting it on the fieldType if that's a flag that carries over to all of it's fields by default).&lt;/p&gt;

&lt;p&gt;We could consider changing the default such that even if it doesn't appear in the schema, docValues would be true (and bump the schema version of course). I had assumed that might be more controversial though, so was just looking to effectively change the de-facto defaults.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I'm OK either way, I do think in any case we should leave the &lt;tt&gt;docValues="true"&lt;/tt&gt; in the schema to make it more obvious that you want to look at that attribute for optimizing your schema. &lt;/p&gt;</comment>
                            <comment id="15185917" author="arafalov" created="Tue, 8 Mar 2016 15:01:43 -0700">&lt;blockquote&gt;
&lt;p&gt;We could consider changing the default such that even if it doesn't appear in the schema, docValues would be true (and bump the schema version of course). I had assumed that might be more controversial though, so was just looking to effectively change the de-facto defaults.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;At the moment, both &lt;b&gt;indexed&lt;/b&gt; and &lt;b&gt;stored&lt;/b&gt; flags are &lt;b&gt;false&lt;/b&gt; if not set, I believe. making &lt;b&gt;docValues&lt;/b&gt; to be &lt;b&gt;true&lt;/b&gt; if not set, could cause confusions. So, I am with Yonik's original suggestion of having them enabled as explicit flags in the example schemas.&lt;/p&gt;</comment>
                            <comment id="15186008" author="markrmiller@gmail.com" created="Tue, 8 Mar 2016 15:46:52 -0700">&lt;p&gt;There are tradeoffs. They won't be shoved on users though. They can always switch back. Given the history of users with OOM and the fieldcache, I think we are making a much better user experience default. &lt;/p&gt;</comment>
                            <comment id="15186232" author="elyograg" created="Tue, 8 Mar 2016 18:08:10 -0700">&lt;blockquote&gt;&lt;p&gt;At the moment, both indexed and stored flags are false if not set, I believe.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The default values for stored and indexed are &lt;b&gt;true&lt;/b&gt; for all schema versions.  See this method in FieldType.java, line 153 in particular:&lt;/p&gt;

&lt;p&gt;&lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;a=blob;f=solr/core/src/java/org/apache/solr/schema/FieldType.java;h=fbcebcda1b163dd1ba2d9980e1cfd540b2769f13;hb=12f7ad66963a5ae784f2bd0bf8b5dbc4b3c1630e#l150" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;a=blob;f=solr/core/src/java/org/apache/solr/schema/FieldType.java;h=fbcebcda1b163dd1ba2d9980e1cfd540b2769f13;hb=12f7ad66963a5ae784f2bd0bf8b5dbc4b3c1630e#l150&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I think setting the default for docValues to true in schema version 1.7 is probably a good idea, but I do predict a lot of "I upgraded and now my index is twice as big!" messages on the list. &lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/smile.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt;&lt;/p&gt;</comment>
                            <comment id="15186237" author="elyograg" created="Tue, 8 Mar 2016 18:09:55 -0700">&lt;p&gt;On further consideration, if the schema version is explicitly stated, I guess that won't happen.&lt;/p&gt;</comment>
                            <comment id="15187900" author="erickerickson" created="Wed, 9 Mar 2016 13:39:25 -0700">&lt;p&gt;I added some tests that should serve to flag if the ordering of MV fields is different so we can stop discussing it &lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/wink.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt; See &lt;a href="https://issues.apache.org/jira/browse/SOLR-8813" title="Add test for MultiValued fields being returned in the correct order" class="issue-link" data-issue-key="SOLR-8813"&gt;&lt;del&gt;SOLR-8813&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15195452" author="yseeley@gmail.com" created="Tue, 15 Mar 2016 08:09:10 -0700">&lt;p&gt;Here's a draft patch for "basic" schema only at this point...&lt;/p&gt;

&lt;ul class="alternate" type="square"&gt;
	&lt;li&gt;boolean fields don't support docValues&lt;/li&gt;
	&lt;li&gt;I don't think LatLonType supports docValues in the main field&lt;/li&gt;
	&lt;li&gt;Not sure if some of the other spatial types (bbox) support DocValues for the main field or not.  But perhaps these are on the road to deprecation due to the new point stuff in lucene?&lt;/li&gt;
	&lt;li&gt;in some preliminary performance tests with unstored DV fields, /export was &lt;b&gt;much&lt;/b&gt; faster (7 times faster) than /select - so at this point I've left the fields as stored as well until performance issues can be addressed.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15197727" author="yseeley@gmail.com" created="Wed, 16 Mar 2016 10:21:01 -0700">&lt;p&gt;Here's an update w/ the other template schemas converted to use docValues.&lt;br/&gt;
I'll do some more testing to validate that things work and then commit.&lt;/p&gt;</comment>
                            <comment id="15198360" author="jira-bot" created="Wed, 16 Mar 2016 15:52:12 -0700">&lt;p&gt;Commit e76fa568172173feeed3eaaf7de06b773b32605d in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org" class="user-hover" rel="yonik@apache.org"&gt;Yonik Seeley&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e76fa56" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e76fa56&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8740" title="set docValues=&amp;quot;true&amp;quot; for most non-text fieldTypes in the sample schemas" class="issue-link" data-issue-key="SOLR-8740"&gt;&lt;del&gt;SOLR-8740&lt;/del&gt;&lt;/a&gt;: use docValues for non-text fields in schema templates&lt;/p&gt;</comment>
                            <comment id="15198362" author="jira-bot" created="Wed, 16 Mar 2016 15:52:53 -0700">&lt;p&gt;Commit 14752476f445436944618a6f1dde9bd787a1f3c9 in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org" class="user-hover" rel="yonik@apache.org"&gt;Yonik Seeley&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=1475247" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=1475247&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8740" title="set docValues=&amp;quot;true&amp;quot; for most non-text fieldTypes in the sample schemas" class="issue-link" data-issue-key="SOLR-8740"&gt;&lt;del&gt;SOLR-8740&lt;/del&gt;&lt;/a&gt;: use docValues for non-text fields in schema templates&lt;/p&gt;</comment>
                            <comment id="15198363" author="jira-bot" created="Wed, 16 Mar 2016 15:53:04 -0700">&lt;p&gt;Commit 97361313582d054ff44a2a3a8e206f313e67d68c in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org" class="user-hover" rel="yonik@apache.org"&gt;Yonik Seeley&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9736131" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9736131&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8740" title="set docValues=&amp;quot;true&amp;quot; for most non-text fieldTypes in the sample schemas" class="issue-link" data-issue-key="SOLR-8740"&gt;&lt;del&gt;SOLR-8740&lt;/del&gt;&lt;/a&gt;: use docValues for non-text fields in schema templates&lt;/p&gt;</comment>
                            <comment id="15227254" author="hossman" created="Tue, 5 Apr 2016 15:23:50 -0700">&lt;p&gt;updating summary &amp;amp; description to reflect the reality of what was changed....&lt;/p&gt;

&lt;p&gt;For fields &amp;amp; fieldtypes that do not explicitly declare &lt;tt&gt;docValues&lt;/tt&gt; attribute, all existing solr FieldTypes still default to false, but in all of the same schema files provided with solr most non-text &lt;tt&gt;&amp;lt;fieldType /&amp;gt;&lt;/tt&gt; declarations have been modified to include a &lt;tt&gt;docValues="true"&lt;/tt&gt; attribute&lt;/p&gt;</comment>
                            <comment id="15233140" author="ichattopadhyaya" created="Fri, 8 Apr 2016 16:20:52 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org" class="user-hover" rel="yonik@apache.org"&gt;Yonik Seeley&lt;/a&gt;, in the Solr 6.0 release notes, the following was mentioned:&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
Users should set useDocValuesAsStored=&lt;span class="code-quote"&gt;"&lt;span class="code-keyword"&gt;false&lt;/span&gt;"&lt;/span&gt; to preserve sort order on multi-valued
    fields that have both stored=&lt;span class="code-quote"&gt;"&lt;span class="code-keyword"&gt;true&lt;/span&gt;"&lt;/span&gt; and docValues=&lt;span class="code-quote"&gt;"&lt;span class="code-keyword"&gt;true&lt;/span&gt;"&lt;/span&gt;. 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Given that useDocValuesAsStored doesn't &lt;b&gt;currently&lt;/b&gt; affect fields with stored=true, do you think this note was appropriately worded? I agree that in future, we might have useDocValuesAsStored affect how we retrieve stored=true fields, but whether that will affect the ordering is still not known (since we can, in theory, use another docValues format that preserves the original order). Though, even if future optimizations are potentially breaking for a user, the note mentioned above implies something that needs to be done for avoiding a current issue, not a future issue.&lt;/p&gt;</comment>
                            <comment id="15233228" author="yseeley@gmail.com" created="Fri, 8 Apr 2016 17:43:32 -0700">&lt;p&gt;I think it's a good idea... there is a lot of performance to be gained out of using docValues when returning a couple of docValue fields for many documents (like the export handler currently does).  Although we &lt;b&gt;can&lt;/b&gt; (and should at some point) have docValue implementations that preserve order, we don't have them yet... and the note leaves the door open to implementing optimizations before the next major release.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12948485">SOLR-8813</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12793802" name="SOLR-8740.patch" size="21735" author="yseeley@gmail.com" created="Wed, 16 Mar 2016 10:21:01 -0700"/>
                            <attachment id="12793550" name="SOLR-8740.patch" size="6388" author="yseeley@gmail.com" created="Tue, 15 Mar 2016 08:09:10 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 7 Mar 2016 15:45:21 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ttv3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8738] invalid DBQ initially sent to a non-leader node will report success</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8738</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Discovered this while working on &lt;a href="https://issues.apache.org/jira/browse/SOLR-445" title="Update Handlers abort with bad documents" class="issue-link" data-issue-key="SOLR-445"&gt;&lt;del&gt;SOLR-445&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;If a Delete By Query gets sent to a node which is not hosting a leader (ie: only hosts replicas, or doesn't host any cores related to the specified collection) then a success will be returned, even if the DBQ is completely malformed and actually failed.&lt;/p&gt;</description>
                <environment/>
        <key id="12944621">SOLR-8738</key>
            <summary>invalid DBQ initially sent to a non-leader node will report success</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hossman">Hoss Man</assignee>
                                    <reporter username="hossman">Hoss Man</reporter>
                        <labels>
                    </labels>
                <created>Thu, 25 Feb 2016 12:32:56 -0700</created>
                <updated>Thu, 21 Apr 2016 15:29:47 -0700</updated>
                            <resolved>Thu, 21 Apr 2016 15:29:47 -0700</resolved>
                                                    <fixVersion>5.5.1</fixVersion>
                    <fixVersion>6.0</fixVersion>
                    <fixVersion>master</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="15167711" author="hossman" created="Thu, 25 Feb 2016 12:33:26 -0700">&lt;p&gt;The most trivial/obvious way to reproduce is...&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;bin/solr -e cloud&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;Pick "&lt;b&gt;3&lt;/b&gt;" for number of nodes&lt;/li&gt;
	&lt;li&gt;accept the default port numbers (8983, 7574, 8984)&lt;/li&gt;
	&lt;li&gt;accept the default collection name (gettingstarted)&lt;/li&gt;
	&lt;li&gt;pick "&lt;b&gt;1&lt;/b&gt;" for the number of shards&lt;/li&gt;
	&lt;li&gt;accept the default number of replicas per shard (2)&lt;/li&gt;
	&lt;li&gt;accept the default config set (data_driven_schema_configs)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;(So now you should have a single collection with a single shard with 2 replicas on 2 diff nodes and the remaining node doesn't host any cores related to the collection)&lt;/p&gt;

&lt;p&gt;Now try running a broken DBQ against all 3 nodes...&lt;/p&gt;

&lt;div class="preformatted panel" style="border-width: 1px;"&gt;&lt;div class="preformattedContent panelContent"&gt;
&lt;pre&gt;$ curl -H 'Content-Type: application/json' 'http://127.0.1.1:8983/solr/gettingstarted/update' --data-binary '{"delete":{"query" : "foo_i:yak"}}'
{"responseHeader":{"status":400,"QTime":18},"error":{"metadata":["error-class","org.apache.solr.common.SolrException","root-error-class","org.apache.solr.common.SolrException"],"msg":"Invalid Number: yak","code":400}}
$ curl -H 'Content-Type: application/json' 'http://127.0.1.1:8984/solr/gettingstarted/update' --data-binary '{"delete":{"query" : "foo_i:yak"}}'
{"responseHeader":{"status":0,"QTime":25}}
$ curl -H 'Content-Type: application/json' 'http://127.0.1.1:7574/solr/gettingstarted/update' --data-binary '{"delete":{"query" : "foo_i:yak"}}'
{"responseHeader":{"status":0,"QTime":7}}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;...only the node hosting the leader correctly repsponds back with the error, requests that initially hit nodes only hosting replicas or not hosting any cores incorrectly indicate that the delete succeeded.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;2 important notes:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;This can also be reproduced using &lt;tt&gt;numShards &amp;gt; 1&lt;/tt&gt;, most easily by running &lt;tt&gt;-e cloud&lt;/tt&gt; and choosing &lt;b&gt;4&lt;/b&gt; nodes, and accepting the default 2 shards, 2 replicas.  Then repeat the same curl commands above over all 4 ports.
	&lt;ul&gt;
		&lt;li&gt;you should see 2 nodes correctly return failures, and 2 nodes incorrectly claim success&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;You can also reproduce using &lt;tt&gt;-e cloud -noprompt&lt;/tt&gt; but since that that defaults to only 2 nodes they are garunteed to each have a leader on them, so you have to be more explicit about the requests.
	&lt;ul&gt;
		&lt;li&gt;Use the Solr UI to determine the &lt;em&gt;non-leader&lt;/em&gt; core_node_names (ex: &lt;tt&gt;gettingstarted_shard1_replica1&lt;/tt&gt;) and which node they are located on, then use those in url instead of the simple collection name (otherwise smple collection paths will be auto-route to a leader on each node)&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ol&gt;


</comment>
                            <comment id="15167914" author="hossman" created="Thu, 25 Feb 2016 14:38:08 -0700">&lt;p&gt;here's a MiniSolrCloudCluster based test patch i hacked out of the existing &lt;a href="https://issues.apache.org/jira/browse/SOLR-445" title="Update Handlers abort with bad documents" class="issue-link" data-issue-key="SOLR-445"&gt;&lt;del&gt;SOLR-445&lt;/del&gt;&lt;/a&gt; work demonstrating the problem.&lt;/p&gt;

&lt;p&gt;still tracing trough to try and figure out why the errors aren't getting propogated.&lt;/p&gt;</comment>
                            <comment id="15169479" author="hossman" created="Fri, 26 Feb 2016 11:29:28 -0700">&lt;p&gt;The crux of why the errors are silently ignored seems to be because &lt;tt&gt;DUP.doFinish()&lt;/tt&gt; only logs a WARN &amp;#8211; but does not propogate &amp;#8211; any error returned by &lt;tt&gt;cmdDistrib.getErrors();&lt;/tt&gt; unless the type of Node involved in the request was a &lt;tt&gt;RetryNode&lt;/tt&gt;.  The reason given for this being...&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
&lt;span class="code-comment"&gt;// &lt;span class="code-keyword"&gt;else&lt;/span&gt;
&lt;/span&gt;&lt;span class="code-comment"&gt;// &lt;span class="code-keyword"&gt;for&lt;/span&gt; now we don't error - we assume &lt;span class="code-keyword"&gt;if&lt;/span&gt; it was added locally, we
&lt;/span&gt;&lt;span class="code-comment"&gt;// succeeded &lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The problem aparently being that when a DBQ is forwarded to all leaders, &lt;tt&gt;StdNode&lt;/tt&gt; is (currently) used &amp;#8211; but there was no local operation executed, only the forward to the leaders, so there is no local success/failure.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;The attached patch changes the DBQ propagation logic to use &lt;tt&gt;RetryNode&lt;/tt&gt; &amp;#8211; i'm still running full tests, but at a minimum it makes the new &lt;tt&gt;TestCloudDeleteByQuery&lt;/tt&gt; in the patch start passing.&lt;/p&gt;

&lt;p&gt;i don't fully understand the entire ramifications of this change, particularly as it relates to rest of the code in &lt;tt&gt;DUP.doFinish&lt;/tt&gt; and things like forcing leader recovery, but based on the comments on the &lt;tt&gt;StdNode&lt;/tt&gt; / &lt;tt&gt;RetryNode&lt;/tt&gt; classes and the other uses of &lt;tt&gt;StdNode&lt;/tt&gt; / &lt;tt&gt;RetryNode&lt;/tt&gt;&lt;tt&gt;RetryNode&lt;/tt&gt; (notably: STD-&amp;gt;replica vs RETRY-&amp;gt;leader) this seems like the most correct fix in general.&lt;/p&gt;</comment>
                            <comment id="15172958" author="hossman" created="Mon, 29 Feb 2016 17:17:32 -0700">&lt;p&gt;Updated patch to refactor test to take advantage of SolrCloudTestCase added by &lt;a href="https://issues.apache.org/jira/browse/SOLR-8758" title="Add SolrCloudTestCase base class" class="issue-link" data-issue-key="SOLR-8758"&gt;&lt;del&gt;SOLR-8758&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Still need someone who actually understands this code to review the non-test changes.&lt;/p&gt;</comment>
                            <comment id="15173921" author="noble.paul" created="Tue, 1 Mar 2016 08:44:31 -0700">&lt;p&gt;It is easy to understand why and how this fix works. &lt;br/&gt;
But it's kinda hard to understand why DUP is written to look at classname to propagate the errors. &lt;/p&gt;

&lt;p&gt;+1 to commit&lt;/p&gt;</comment>
                            <comment id="15174037" author="jira-bot" created="Tue, 1 Mar 2016 10:06:51 -0700">&lt;p&gt;Commit ff6557cbcb5308d60f17114de1d0ad29003e9668 in lucene-solr's branch refs/heads/jira/&lt;a href="https://issues.apache.org/jira/browse/SOLR-445" title="Update Handlers abort with bad documents" class="issue-link" data-issue-key="SOLR-445"&gt;&lt;del&gt;SOLR-445&lt;/del&gt;&lt;/a&gt; from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hossman_lucene%40fucit.org" class="user-hover" rel="hossman_lucene@fucit.org"&gt;Chris Hostetter&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ff6557c" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ff6557c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8738" title="invalid DBQ initially sent to a non-leader node will report success" class="issue-link" data-issue-key="SOLR-8738"&gt;&lt;del&gt;SOLR-8738&lt;/del&gt;&lt;/a&gt;: Fixed false success response when invalid deleteByQuery requests intially hit non-leader cloud nodes&lt;/p&gt;</comment>
                            <comment id="15174040" author="jira-bot" created="Tue, 1 Mar 2016 10:06:56 -0700">&lt;p&gt;Commit 2401c9495319e1b5065b05ef3a36ee586f06b6d4 in lucene-solr's branch refs/heads/jira/&lt;a href="https://issues.apache.org/jira/browse/SOLR-445" title="Update Handlers abort with bad documents" class="issue-link" data-issue-key="SOLR-445"&gt;&lt;del&gt;SOLR-445&lt;/del&gt;&lt;/a&gt; from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hossman_lucene%40fucit.org" class="user-hover" rel="hossman_lucene@fucit.org"&gt;Chris Hostetter&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=2401c94" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=2401c94&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-445" title="Update Handlers abort with bad documents" class="issue-link" data-issue-key="SOLR-445"&gt;&lt;del&gt;SOLR-445&lt;/del&gt;&lt;/a&gt; Merge branch 'master' into jira/&lt;a href="https://issues.apache.org/jira/browse/SOLR-445" title="Update Handlers abort with bad documents" class="issue-link" data-issue-key="SOLR-445"&gt;&lt;del&gt;SOLR-445&lt;/del&gt;&lt;/a&gt; (pick up &lt;a href="https://issues.apache.org/jira/browse/SOLR-8738" title="invalid DBQ initially sent to a non-leader node will report success" class="issue-link" data-issue-key="SOLR-8738"&gt;&lt;del&gt;SOLR-8738&lt;/del&gt;&lt;/a&gt; changes)&lt;/p&gt;</comment>
                            <comment id="15174041" author="jira-bot" created="Tue, 1 Mar 2016 10:06:57 -0700">&lt;p&gt;Commit ff6557cbcb5308d60f17114de1d0ad29003e9668 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hossman_lucene%40fucit.org" class="user-hover" rel="hossman_lucene@fucit.org"&gt;Chris Hostetter&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ff6557c" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ff6557c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8738" title="invalid DBQ initially sent to a non-leader node will report success" class="issue-link" data-issue-key="SOLR-8738"&gt;&lt;del&gt;SOLR-8738&lt;/del&gt;&lt;/a&gt;: Fixed false success response when invalid deleteByQuery requests intially hit non-leader cloud nodes&lt;/p&gt;</comment>
                            <comment id="15252744" author="anshumg" created="Thu, 21 Apr 2016 14:09:24 -0700">&lt;p&gt;Reopening for 5.5.1&lt;/p&gt;</comment>
                            <comment id="15252820" author="jira-bot" created="Thu, 21 Apr 2016 14:49:32 -0700">&lt;p&gt;Commit 9e77319abcf3ff372b86cec4d66bac11f7e038b6 in lucene-solr's branch refs/heads/branch_5x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hossman_lucene%40fucit.org" class="user-hover" rel="hossman_lucene@fucit.org"&gt;Chris Hostetter&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9e77319" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9e77319&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8738" title="invalid DBQ initially sent to a non-leader node will report success" class="issue-link" data-issue-key="SOLR-8738"&gt;&lt;del&gt;SOLR-8738&lt;/del&gt;&lt;/a&gt;: Fixed false success response when invalid deleteByQuery requests intially hit non-leader cloud nodes&lt;/p&gt;</comment>
                            <comment id="15252873" author="jira-bot" created="Thu, 21 Apr 2016 15:14:59 -0700">&lt;p&gt;Commit 66d3c2eb0a1e7b28621557c87c8d5b5219a95add in lucene-solr's branch refs/heads/branch_5_5 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hossman_lucene%40fucit.org" class="user-hover" rel="hossman_lucene@fucit.org"&gt;Chris Hostetter&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=66d3c2e" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=66d3c2e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8738" title="invalid DBQ initially sent to a non-leader node will report success" class="issue-link" data-issue-key="SOLR-8738"&gt;&lt;del&gt;SOLR-8738&lt;/del&gt;&lt;/a&gt;: Fixed false success response when invalid deleteByQuery requests intially hit non-leader cloud nodes&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12385211">SOLR-445</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12790617" name="SOLR-8738.patch" size="11976" author="hossman" created="Mon, 29 Feb 2016 17:17:32 -0700"/>
                            <attachment id="12790186" name="SOLR-8738.patch" size="13519" author="hossman" created="Fri, 26 Feb 2016 11:29:28 -0700"/>
                            <attachment id="12790005" name="SOLR-8738.patch" size="12726" author="hossman" created="Thu, 25 Feb 2016 14:38:08 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 1 Mar 2016 15:44:31 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2tron:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8736] GET operations on fields, dynamicFields, fieldTypes, copyField should work</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8736</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Commits under this issue changed the implementation for handling GET operations on the following URL paths: &lt;tt&gt;schema/fields&lt;/tt&gt;, &lt;tt&gt;schema/dynamicfields&lt;/tt&gt;, &lt;tt&gt;schema/fieldtypes&lt;/tt&gt;, and &lt;tt&gt;schema/copyfields&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;As part of the changes, the following functionality was removed, as of Solr 6.0.0:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;schema/copyfields&lt;/tt&gt;:
	&lt;ul&gt;
		&lt;li&gt;The following information is no longer output:
		&lt;ul&gt;
			&lt;li&gt;&lt;tt&gt;destDynamicBase&lt;/tt&gt;: the matching dynamic field pattern for the destination&lt;/li&gt;
			&lt;li&gt;&lt;tt&gt;sourceDynamicBase&lt;/tt&gt;: the matching dynamic field pattern for the source&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
		&lt;li&gt;The following request parameters are no longer supported:
		&lt;ul&gt;
			&lt;li&gt;&lt;tt&gt;dest.fl&lt;/tt&gt;: include only copyFields that have one of these as a destination&lt;/li&gt;
			&lt;li&gt;&lt;tt&gt;source.fl&lt;/tt&gt;: include only copyFields that have one of these as a source&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;schema/dynamicfields&lt;/tt&gt;:
	&lt;ul&gt;
		&lt;li&gt;The following request parameters are no longer supported:
		&lt;ul&gt;
			&lt;li&gt;&lt;tt&gt;fl&lt;/tt&gt;: a comma and/or space separated list of dynamic field patterns to include&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;schema/fields&lt;/tt&gt; and &lt;tt&gt;schema/fields/&lt;em&gt;fieldname&lt;/em&gt;&lt;/tt&gt;:
	&lt;ul&gt;
		&lt;li&gt;The following information is no longer output:
		&lt;ul&gt;
			&lt;li&gt;&lt;tt&gt;dynamicBase&lt;/tt&gt;: the matching dynamic field pattern, if the &lt;tt&gt;includeDynamic&lt;/tt&gt; param is given (see below)&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
		&lt;li&gt;The following request parameters are no longer supported:
		&lt;ul&gt;
			&lt;li&gt;&lt;tt&gt;fl&lt;/tt&gt;: (only supported without &lt;tt&gt;/&lt;em&gt;fieldname&lt;/em&gt;&lt;/tt&gt;): a comma and/or space separated list of fields to include&lt;/li&gt;
			&lt;li&gt;&lt;tt&gt;includeDynamic&lt;/tt&gt;: output the matching dynamic field pattern as &lt;tt&gt;dynamicBase&lt;/tt&gt;, if &lt;tt&gt;&lt;em&gt;fieldname&lt;/em&gt;&lt;/tt&gt;, or field(s) listed in &lt;tt&gt;fl&lt;/tt&gt; param, are not explicitly declared in the schema&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;schema/fieldtypes&lt;/tt&gt; and &lt;tt&gt;schema/fieldtypes/&lt;em&gt;typename&lt;/em&gt;&lt;/tt&gt;:
	&lt;ul&gt;
		&lt;li&gt;The following information is no longer output:
		&lt;ul&gt;
			&lt;li&gt;&lt;tt&gt;fields&lt;/tt&gt;: the fields with the given field type&lt;/li&gt;
			&lt;li&gt;&lt;tt&gt;dynamicFields&lt;/tt&gt;: the dynamic fields with the given field type&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment/>
        <key id="12944475">SOLR-8736</key>
            <summary>GET operations on fields, dynamicFields, fieldTypes, copyField should work</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="noble.paul">Noble Paul</assignee>
                                    <reporter username="noble.paul">Noble Paul</reporter>
                        <labels>
                    </labels>
                <created>Thu, 25 Feb 2016 05:57:40 -0700</created>
                <updated>Thu, 14 Apr 2016 21:42:41 -0700</updated>
                            <resolved>Tue, 8 Mar 2016 05:34:20 -0700</resolved>
                                                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="15169047" author="noble.paul" created="Fri, 26 Feb 2016 06:55:22 -0700">&lt;p&gt;The GET methods for fields, fieldtypes, dynamicfields and copyfields are  moved to SchemaHandler.  &lt;/p&gt;</comment>
                            <comment id="15183293" author="jira-bot" created="Mon, 7 Mar 2016 10:18:37 -0700">&lt;p&gt;Commit f2c281abcbfc254d44c196ceb7c7f61311e7967c in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f2c281a" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f2c281a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8736" title="GET operations on fields, dynamicFields, fieldTypes, copyField should work" class="issue-link" data-issue-key="SOLR-8736"&gt;&lt;del&gt;SOLR-8736&lt;/del&gt;&lt;/a&gt;: schema GET operations on fields, dynamicFields, fieldTypes, copyField are&lt;br/&gt;
  reimplemented as a part of the bulk API with less details. The tests and write implementations are removed&lt;/p&gt;</comment>
                            <comment id="15183297" author="jira-bot" created="Mon, 7 Mar 2016 10:20:02 -0700">&lt;p&gt;Commit 5146e78a6445c1d1578154678518c8c904bf21e0 in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=5146e78" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=5146e78&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8736" title="GET operations on fields, dynamicFields, fieldTypes, copyField should work" class="issue-link" data-issue-key="SOLR-8736"&gt;&lt;del&gt;SOLR-8736&lt;/del&gt;&lt;/a&gt;: schema GET operations on fields, dynamicFields, fieldTypes, copyField are&lt;br/&gt;
  reimplemented as a part of the bulk API with less details. The tests and write implementations are removed&lt;/p&gt;</comment>
                            <comment id="15183298" author="jira-bot" created="Mon, 7 Mar 2016 10:21:02 -0700">&lt;p&gt;Commit b623557d3219b78aa995174389e9192276456672 in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b623557" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b623557&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8736" title="GET operations on fields, dynamicFields, fieldTypes, copyField should work" class="issue-link" data-issue-key="SOLR-8736"&gt;&lt;del&gt;SOLR-8736&lt;/del&gt;&lt;/a&gt;: schema GET operations on fields, dynamicFields, fieldTypes, copyField are&lt;br/&gt;
  reimplemented as a part of the bulk API with less details. The tests and write implementations are removed&lt;/p&gt;</comment>
                            <comment id="15184842" author="jira-bot" created="Tue, 8 Mar 2016 05:30:35 -0700">&lt;p&gt;Commit 5ea6ee7362d5020d6a0b80f9c0efcb83b7bee196 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=5ea6ee7" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=5ea6ee7&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8736" title="GET operations on fields, dynamicFields, fieldTypes, copyField should work" class="issue-link" data-issue-key="SOLR-8736"&gt;&lt;del&gt;SOLR-8736&lt;/del&gt;&lt;/a&gt;: schema GET operations on fields, dynamicFields, fieldTypes, copyField have less details&lt;/p&gt;</comment>
                            <comment id="15184845" author="jira-bot" created="Tue, 8 Mar 2016 05:31:45 -0700">&lt;p&gt;Commit 644d534f6c5d68e149f5ff36c477e82ecec0f3d2 in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=644d534" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=644d534&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8736" title="GET operations on fields, dynamicFields, fieldTypes, copyField should work" class="issue-link" data-issue-key="SOLR-8736"&gt;&lt;del&gt;SOLR-8736&lt;/del&gt;&lt;/a&gt;: schema GET operations on fields, dynamicFields, fieldTypes, copyField have less details&lt;/p&gt;</comment>
                            <comment id="15184847" author="jira-bot" created="Tue, 8 Mar 2016 05:32:51 -0700">&lt;p&gt;Commit 97fa0f52367d4b685e6fb4c3aea128b6a18ed652 in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=97fa0f5" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=97fa0f5&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8736" title="GET operations on fields, dynamicFields, fieldTypes, copyField should work" class="issue-link" data-issue-key="SOLR-8736"&gt;&lt;del&gt;SOLR-8736&lt;/del&gt;&lt;/a&gt;: schema GET operations on fields, dynamicFields, fieldTypes, copyField have less details&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                            <outwardlinks description="incorporates">
                                        <issuelink>
            <issuekey id="12938035">SOLR-8667</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12959047">SOLR-8992</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12790131" name="SOLR-8736.patch" size="118581" author="noble.paul" created="Fri, 26 Feb 2016 06:55:22 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 7 Mar 2016 17:18:37 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2tqs7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8735] Fix CheckHdfsIndexTest test failure</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8735</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;I was going to post this on &lt;a href="https://issues.apache.org/jira/browse/SOLR-7928" title="Improve CheckIndex to work against HdfsDirectory" class="issue-link" data-issue-key="SOLR-7928"&gt;&lt;del&gt;SOLR-7928&lt;/del&gt;&lt;/a&gt; but the "Attach File" button is gone for some reason.&lt;/p&gt;

&lt;p&gt;There are some failures from this on Jenkins &amp;#8211; &lt;a href="https://builds.apache.org/job/Lucene-Solr-Tests-5.x-Java7/3977/" class="external-link" rel="nofollow"&gt;https://builds.apache.org/job/Lucene-Solr-Tests-5.x-Java7/3977/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I think we need to give Solr more time to start up before we begin indexing, patch coming shortly.&lt;/p&gt;


&lt;p&gt;I was not able to find any failures on trunk.&lt;/p&gt;</description>
                <environment/>
        <key id="12944353">SOLR-8735</key>
            <summary>Fix CheckHdfsIndexTest test failure</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gchanan">Gregory Chanan</assignee>
                                    <reporter username="mdrob">Mike Drob</reporter>
                        <labels>
                            <label>jenkins</label>
                            <label>unit-test</label>
                    </labels>
                <created>Wed, 24 Feb 2016 18:57:03 -0700</created>
                <updated>Thu, 25 Feb 2016 01:20:03 -0700</updated>
                            <resolved>Thu, 25 Feb 2016 01:20:03 -0700</resolved>
                                                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="15166742" author="gchanan" created="Wed, 24 Feb 2016 22:23:46 -0700">&lt;p&gt;+1.  Seems reasonable to put in trunk even if there are no failures that you could find.&lt;/p&gt;</comment>
                            <comment id="15166901" author="jira-bot" created="Thu, 25 Feb 2016 01:19:00 -0700">&lt;p&gt;Commit de119f0b5d2fc1ca5aebd815dad714677d0afca4 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gchanan" class="user-hover" rel="gchanan"&gt;Gregory Chanan&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=de119f0" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=de119f0&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8735" title="Fix CheckHdfsIndexTest test failure" class="issue-link" data-issue-key="SOLR-8735"&gt;&lt;del&gt;SOLR-8735&lt;/del&gt;&lt;/a&gt;: Fix CheckHdfsIndexTest test failure&lt;/p&gt;</comment>
                            <comment id="15166904" author="gchanan" created="Thu, 25 Feb 2016 01:20:03 -0700">&lt;p&gt;Thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mdrob" class="user-hover" rel="mdrob"&gt;Mike Drob&lt;/a&gt;, committed to trunk.  I held off committing to 5.x because it's not clear to me what's going on there...there's no 5.5.1 or 5.6.0 version in jira.  This is safe for 6.0 in any case.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12856245">SOLR-7928</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12789840" name="SOLR-8735.patch" size="559" author="mdrob" created="Wed, 24 Feb 2016 18:57:45 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 25 Feb 2016 05:23:46 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2tq13:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8734] fix deprecation warnings for absent (maxMergeDocs|mergeFactor)</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8734</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markus17" class="user-hover" rel="markus17"&gt;Markus Jelsma&lt;/a&gt; wrote on the solr-user mailing list:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;5.5.0 &lt;a href="https://issues.apache.org/jira/browse/SOLR-8621" title="solrconfig.xml: deprecate/replace &amp;lt;mergePolicy&amp;gt; with &amp;lt;mergePolicyFactory&amp;gt;" class="issue-link" data-issue-key="SOLR-8621"&gt;&lt;del&gt;SOLR-8621&lt;/del&gt;&lt;/a&gt; deprecation warnings without maxMergeDocs or mergeFactor&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;...&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;o.a.s.c.Config Beginning with Solr 5.5, &amp;lt;maxMergeDocs&amp;gt; is deprecated, configure it on the relevant &amp;lt;mergePolicyFactory&amp;gt; instead.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;...&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;On my development machine for all cores. None of the cores has either parameter configured. Is this expected?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;...&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cpoerschke" class="user-hover" rel="cpoerschke"&gt;Christine Poerschke&lt;/a&gt; replied:&lt;br/&gt;
...&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Could you advise if/that the solrconfig.xml has a &amp;lt;mergePolicy&amp;gt; element (for which deprecated warnings would appear separately) or that the solrconfig.xml has no &amp;lt;mergePolicyFactory&amp;gt; element?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;...&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;If either is the case then yes based on the code (SolrIndexConfig.java#L153) the warnings would be expected-and-harmless though admittedly are confusing, and fixable.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;...&lt;/p&gt;
</description>
                <environment/>
        <key id="12944008">SOLR-8734</key>
            <summary>fix deprecation warnings for absent (maxMergeDocs|mergeFactor)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cpoerschke">Christine Poerschke</assignee>
                                    <reporter username="cpoerschke">Christine Poerschke</reporter>
                        <labels>
                    </labels>
                <created>Wed, 24 Feb 2016 16:07:19 -0700</created>
                <updated>Fri, 26 Feb 2016 11:01:36 -0700</updated>
                            <resolved>Fri, 26 Feb 2016 11:01:36 -0700</resolved>
                                    <version>5.5</version>
                    <version>master</version>
                                    <fixVersion>5.5.1</fixVersion>
                    <fixVersion>6.0</fixVersion>
                    <fixVersion>master</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="15166347" author="cpoerschke" created="Wed, 24 Feb 2016 16:39:05 -0700">&lt;p&gt;Attaching proposed warnings fix patch against master.&lt;/p&gt;

&lt;p&gt;The proposed patch includes a fix/change of erroring/failing if a &amp;lt;maxMergeDocs|mergeFactor&amp;gt; is combined with a &amp;lt;mergePolicyFactory&amp;gt; element whereas the &lt;a href="https://github.com/apache/lucene-solr/blob/master/solr/core/src/java/org/apache/solr/update/SolrIndexConfig.java#L250" class="external-link" rel="nofollow"&gt;existing code&lt;/a&gt; would ignore the &amp;lt;mergePolicyFactory&amp;gt; element and use the default &amp;lt;mergePolicy&amp;gt; instead. Though perhaps that is too controversional a change in general or for any future 5.5.1 release in particular?&lt;/p&gt;</comment>
                            <comment id="15167039" author="cpoerschke" created="Thu, 25 Feb 2016 03:20:28 -0700">&lt;p&gt;Simplified/Tweaked proposed patch a little.&lt;/p&gt;</comment>
                            <comment id="15167049" author="shaie" created="Thu, 25 Feb 2016 03:26:46 -0700">&lt;p&gt;Patch looks good. Even while working on the previous issue I thought that we should be able to detect the existence of &lt;tt&gt;&amp;lt;mergeFactor&amp;gt;&lt;/tt&gt; element in the .xml, and not compare the value to the default. What happens if someone includes both &lt;tt&gt;&amp;lt;mergePolicyFactory&amp;gt;&lt;/tt&gt; and &lt;tt&gt;&amp;lt;mergeFactor&amp;gt;&lt;/tt&gt; set to the default value? Would we also fail?&lt;/p&gt;</comment>
                            <comment id="15167071" author="cpoerschke" created="Thu, 25 Feb 2016 03:53:47 -0700">&lt;blockquote&gt;&lt;p&gt;... to detect the existence of &amp;lt;mergeFactor&amp;gt; element in the .xml, and not compare the value to the default. ...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;If I understood you right this means to distinguish&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
...
&amp;lt;mergeFactor&amp;gt;-1&amp;lt;/mergeFactor&amp;gt;
&amp;lt;mergePolicy...&amp;gt;...&amp;lt;/mergePolicy...&amp;gt;
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;from&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
&amp;lt;mergePolicy...&amp;gt;...&amp;lt;/mergePolicy...&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;where -1 is the default value for the &amp;lt;mergeFactor&amp;gt; element. The motivation perhaps being that when &lt;a href="https://issues.apache.org/jira/browse/SOLR-8668" title="Remove support for &amp;lt;mergePolicy&amp;gt;" class="issue-link" data-issue-key="SOLR-8668"&gt;SOLR-8668&lt;/a&gt; removes &amp;lt;mergePolicy&amp;gt; (and &amp;lt;mergeFactor&amp;gt;) element support the &lt;tt&gt;&amp;lt;mergeFactor&amp;gt;-1&amp;lt;/mergeFactor&amp;gt;&lt;/tt&gt; likely would remain behind as a zombie element?&lt;/p&gt;

&lt;p&gt;Might we go even further than detecting the existence of a deprecated &amp;lt;mergeFactor&amp;gt; element and detect any and all unsupported elements? Unsupported elements could be simple typos on part of the user e.g. &lt;tt&gt;&amp;lt;mergePolicyFactor&amp;gt;&lt;/tt&gt; instead of &lt;tt&gt;&amp;lt;mergePolicyFactory&amp;gt;&lt;/tt&gt; or they could be misplaced elements e.g. &lt;a href="https://github.com/apache/lucene-solr/blob/master/solr/core/src/test-files/solr/collection1/conf/solrconfig-spellcheckcomponent.xml#L34" class="external-link" rel="nofollow"&gt;test-files/solr/collection1/conf/solrconfig-spellcheckcomponent.xml&lt;/a&gt; seems to have &lt;tt&gt;indexConfig/query/maxWarmingSearchers&lt;/tt&gt; when possibly &lt;tt&gt;query/maxWarmingSearchers&lt;/tt&gt; was intended (&lt;a href="https://issues.apache.org/jira/browse/SOLR-8682" title="SpellCheckComponentTest occasionally fails on Windows" class="issue-link" data-issue-key="SOLR-8682"&gt;SOLR-8682&lt;/a&gt; exists for that).&lt;/p&gt;</comment>
                            <comment id="15167343" author="markus17" created="Thu, 25 Feb 2016 08:54:17 -0700">&lt;p&gt;Hello these configurations have neither &amp;lt;mergePolicy&amp;gt; nor &amp;lt;mergePolicyFactory&amp;gt; configurated.&lt;/p&gt;</comment>
                            <comment id="15169338" author="jira-bot" created="Fri, 26 Feb 2016 10:10:54 -0700">&lt;p&gt;Commit 0ed625b107264f2ed079b9e07e4f885b7398a6c4 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cpoerschke" class="user-hover" rel="cpoerschke"&gt;Christine Poerschke&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=0ed625b" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=0ed625b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8734" title="fix deprecation warnings for absent (maxMergeDocs|mergeFactor)" class="issue-link" data-issue-key="SOLR-8734"&gt;&lt;del&gt;SOLR-8734&lt;/del&gt;&lt;/a&gt;: fix (maxMergeDocs|mergeFactor) deprecation warnings: in solrconfig.xml &amp;lt;maxMergeDocs|mergeFactor&amp;gt; may not be combined with &amp;lt;mergePolicyFactory&amp;gt; and &amp;lt;maxMergeDocs|mergeFactor&amp;gt; on their own or combined with &amp;lt;mergePolicy&amp;gt; is a warning.&lt;/p&gt;</comment>
                            <comment id="15169394" author="jira-bot" created="Fri, 26 Feb 2016 10:40:48 -0700">&lt;p&gt;Commit b1c06eed306366c54cccd71166a80fb4bb1d0235 in lucene-solr's branch refs/heads/branch_5x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cpoerschke" class="user-hover" rel="cpoerschke"&gt;Christine Poerschke&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b1c06ee" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b1c06ee&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8734" title="fix deprecation warnings for absent (maxMergeDocs|mergeFactor)" class="issue-link" data-issue-key="SOLR-8734"&gt;&lt;del&gt;SOLR-8734&lt;/del&gt;&lt;/a&gt;: fix (maxMergeDocs|mergeFactor) deprecation warnings: in solrconfig.xml &amp;lt;maxMergeDocs|mergeFactor&amp;gt; may not be combined with &amp;lt;mergePolicyFactory&amp;gt; and &amp;lt;maxMergeDocs|mergeFactor&amp;gt; on their own or combined with &amp;lt;mergePolicy&amp;gt; is a warning.&lt;/p&gt;

&lt;p&gt;(Resolved conflict for solr/CHANGES.txt file.)&lt;/p&gt;</comment>
                            <comment id="15169418" author="jira-bot" created="Fri, 26 Feb 2016 10:57:02 -0700">&lt;p&gt;Commit 55b3614fd37eeb1cf6ac2d2ef6c902d18e42d135 in lucene-solr's branch refs/heads/branch_5_5 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cpoerschke" class="user-hover" rel="cpoerschke"&gt;Christine Poerschke&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=55b3614" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=55b3614&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8734" title="fix deprecation warnings for absent (maxMergeDocs|mergeFactor)" class="issue-link" data-issue-key="SOLR-8734"&gt;&lt;del&gt;SOLR-8734&lt;/del&gt;&lt;/a&gt;: fix (maxMergeDocs|mergeFactor) deprecation warnings: in solrconfig.xml &amp;lt;maxMergeDocs|mergeFactor&amp;gt; may not be combined with &amp;lt;mergePolicyFactory&amp;gt; and &amp;lt;maxMergeDocs|mergeFactor&amp;gt; on their own or combined with &amp;lt;mergePolicy&amp;gt; is a warning.&lt;/p&gt;

&lt;p&gt;(Resolved conflict for solr/CHANGES.txt file.)&lt;/p&gt;</comment>
                            <comment id="15169420" author="jira-bot" created="Fri, 26 Feb 2016 10:57:06 -0700">&lt;p&gt;Commit c7214a2ba5f96492e5c4cd6a558734217afe5089 in lucene-solr's branch refs/heads/branch_5_5 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cpoerschke" class="user-hover" rel="cpoerschke"&gt;Christine Poerschke&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c7214a2" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c7214a2&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Merge 5.5.1 changes sections from &lt;a href="https://issues.apache.org/jira/browse/SOLR-8737" title="Managed synonym lists do not include the original term in the expand" class="issue-link" data-issue-key="SOLR-8737"&gt;&lt;del&gt;SOLR-8737&lt;/del&gt;&lt;/a&gt; and &lt;a href="https://issues.apache.org/jira/browse/SOLR-8734" title="fix deprecation warnings for absent (maxMergeDocs|mergeFactor)" class="issue-link" data-issue-key="SOLR-8734"&gt;&lt;del&gt;SOLR-8734&lt;/del&gt;&lt;/a&gt; tickets.&lt;/p&gt;</comment>
                            <comment id="15169434" author="cpoerschke" created="Fri, 26 Feb 2016 11:01:36 -0700">&lt;p&gt;Thanks Markus for noticing and reporting this!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="12935085">SOLR-8621</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12789911" name="SOLR-8734.patch" size="2977" author="cpoerschke" created="Thu, 25 Feb 2016 03:20:28 -0700"/>
                            <attachment id="12789806" name="SOLR-8734.patch" size="3305" author="cpoerschke" created="Wed, 24 Feb 2016 16:39:05 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 25 Feb 2016 10:26:46 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2tnwf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8730] Experimental UI, the hl.fl is not properly set doing queries</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8730</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;When using the experiment UI and doing searches on collection, when populating the hl.fl field, the value is used for the fl instead.&lt;/p&gt;

&lt;p&gt;URL generated:&lt;br/&gt;
&lt;a href="http://127.0.0.1/solr/collection/select?fl=content&amp;amp;hl=on&amp;amp;indent=on&amp;amp;q=html&amp;amp;wt=json" class="external-link" rel="nofollow"&gt;http://127.0.0.1/solr/collection/select?fl=content&amp;amp;hl=on&amp;amp;indent=on&amp;amp;q=html&amp;amp;wt=json&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;URL Expected:&lt;br/&gt;
&lt;a href="http://127.0.0.1/solr/collection/select?hl.fl=content&amp;amp;hl=on&amp;amp;indent=on&amp;amp;q=html&amp;amp;wt=json" class="external-link" rel="nofollow"&gt;http://127.0.0.1/solr/collection/select?hl.fl=content&amp;amp;hl=on&amp;amp;indent=on&amp;amp;q=html&amp;amp;wt=json&lt;/a&gt;&lt;/p&gt;</description>
                <environment>&lt;p&gt;Debian wheezy x64, 4 processors, 4gb memory, 4 SOLR clouds servers&lt;/p&gt;</environment>
        <key id="12943022">SOLR-8730</key>
            <summary>Experimental UI, the hl.fl is not properly set doing queries</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="upayavira">Upayavira</assignee>
                                    <reporter username="jrmargelidon">Jean-Renaud Margelidon</reporter>
                        <labels>
                    </labels>
                <created>Wed, 24 Feb 2016 10:58:57 -0700</created>
                <updated>Fri, 8 Apr 2016 01:58:47 -0700</updated>
                            <resolved>Fri, 11 Mar 2016 06:40:38 -0700</resolved>
                                    <version>5.4.1</version>
                                    <fixVersion>6.0</fixVersion>
                                    <component>web gui</component>
                        <due/>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="15166998" author="upayavira" created="Thu, 25 Feb 2016 02:40:41 -0700">&lt;p&gt;Fix should be trivial, will get to it when i can.&lt;/p&gt;</comment>
                            <comment id="15190917" author="jira-bot" created="Fri, 11 Mar 2016 06:26:57 -0700">&lt;p&gt;Commit fe21f7a4c3a135caa39b1e25e640bc28c069b0a6 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=upayavira" class="user-hover" rel="upayavira"&gt;Upayavira&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=fe21f7a" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=fe21f7a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8730" title="Experimental UI, the hl.fl is not properly set doing queries" class="issue-link" data-issue-key="SOLR-8730"&gt;&lt;del&gt;SOLR-8730&lt;/del&gt;&lt;/a&gt;: Fix highlighting in new UI query pane&lt;/p&gt;</comment>
                            <comment id="15190919" author="jira-bot" created="Fri, 11 Mar 2016 06:28:18 -0700">&lt;p&gt;Commit ef916c1e7eab01cb5d43ac3a7146f4cb7f4b9916 in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=upayavira" class="user-hover" rel="upayavira"&gt;Upayavira&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ef916c1" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ef916c1&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8730" title="Experimental UI, the hl.fl is not properly set doing queries" class="issue-link" data-issue-key="SOLR-8730"&gt;&lt;del&gt;SOLR-8730&lt;/del&gt;&lt;/a&gt;: Fix highlighting in new UI query pane&lt;/p&gt;</comment>
                            <comment id="15190921" author="jira-bot" created="Fri, 11 Mar 2016 06:29:23 -0700">&lt;p&gt;Commit f0aa4fc15a29b0c9e0ef7cd075e3bf2db48efa46 in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=upayavira" class="user-hover" rel="upayavira"&gt;Upayavira&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f0aa4fc" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f0aa4fc&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8730" title="Experimental UI, the hl.fl is not properly set doing queries" class="issue-link" data-issue-key="SOLR-8730"&gt;&lt;del&gt;SOLR-8730&lt;/del&gt;&lt;/a&gt;: Fix highlighting in new UI query pane&lt;/p&gt;</comment>
                            <comment id="15190931" author="upayavira" created="Fri, 11 Mar 2016 06:40:38 -0700">&lt;p&gt;Fixed, thanks for the report!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12956827">SOLR-8957</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 25 Feb 2016 09:40:41 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2thtb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8728] Splitting a shard of a collection created with a rule fails with NPE</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8728</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Spinoff from this discussion: &lt;a href="http://markmail.org/message/f7liw4hqaagxo7y2" class="external-link" rel="nofollow"&gt;http://markmail.org/message/f7liw4hqaagxo7y2&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I wrote a short test which reproduces, will upload shortly.&lt;/p&gt;</description>
                <environment/>
        <key id="12942983">SOLR-8728</key>
            <summary>Splitting a shard of a collection created with a rule fails with NPE</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="noble.paul">Noble Paul</assignee>
                                    <reporter username="shaie">Shai Erera</reporter>
                        <labels>
                    </labels>
                <created>Wed, 24 Feb 2016 08:46:39 -0700</created>
                <updated>Thu, 21 Apr 2016 17:31:13 -0700</updated>
                            <resolved>Thu, 21 Apr 2016 17:21:18 -0700</resolved>
                                                    <fixVersion>5.5.1</fixVersion>
                    <fixVersion>6.0</fixVersion>
                    <fixVersion>6.1</fixVersion>
                    <fixVersion>master</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="15163217" author="shaie" created="Wed, 24 Feb 2016 08:47:53 -0700">&lt;p&gt;If you run this test it fails and you can see this exception in the console:&lt;/p&gt;

&lt;div class="preformatted panel" style="border-width: 1px;"&gt;&lt;div class="preformattedContent panelContent"&gt;
&lt;pre&gt;42071 ERROR (OverseerThreadFactory-6-thread-2-processing-n:127.0.0.1:49954_yd_dma%2Fkz) [n:127.0.0.1:49954_yd_dma%2Fkz    ] o.a.s.c.OverseerCollectionMessageHandler Error executing split operation for collection: shardSplitWithRule parent shard: shard1
java.lang.NullPointerException
	at org.apache.solr.cloud.rule.Rule.getNumberOfNodesWithSameTagVal(Rule.java:166)
	at org.apache.solr.cloud.rule.Rule.tryAssignNodeToShard(Rule.java:128)
	at org.apache.solr.cloud.rule.ReplicaAssigner.tryAPermutationOfRules(ReplicaAssigner.java:249)
	at org.apache.solr.cloud.rule.ReplicaAssigner.tryAllPermutations(ReplicaAssigner.java:201)
	at org.apache.solr.cloud.rule.ReplicaAssigner.getNodeMappings0(ReplicaAssigner.java:173)
	at org.apache.solr.cloud.rule.ReplicaAssigner.getNodeMappings(ReplicaAssigner.java:134)
	at org.apache.solr.cloud.Assign.getNodesViaRules(Assign.java:215)
	at org.apache.solr.cloud.Assign.getNodesForNewReplicas(Assign.java:178)
	at org.apache.solr.cloud.OverseerCollectionMessageHandler.addReplica(OverseerCollectionMessageHandler.java:2164)
	at org.apache.solr.cloud.OverseerCollectionMessageHandler.splitShard(OverseerCollectionMessageHandler.java:1388)
	at org.apache.solr.cloud.OverseerCollectionMessageHandler.processMessage(OverseerCollectionMessageHandler.java:236)
	at org.apache.solr.cloud.OverseerTaskProcessor$Runner.run(OverseerTaskProcessor.java:433)
	at org.apache.solr.common.util.ExecutorUtil$MDCAwareThreadPoolExecutor$1.run(ExecutorUtil.java:231)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
	at java.lang.Thread.run(Thread.java:745)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15173252" author="noble.paul" created="Mon, 29 Feb 2016 22:27:54 -0700">&lt;p&gt;Thanks a lot &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shaie" class="user-hover" rel="shaie"&gt;Shai Erera&lt;/a&gt; I shall fix this right away&lt;/p&gt;</comment>
                            <comment id="15177789" author="noble.paul" created="Thu, 3 Mar 2016 06:12:55 -0700">&lt;p&gt;summary of changes:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;ReplicaAssigner&lt;/tt&gt; should only lookup tags for nodes participating in selection. This is to avoid the NPE.&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;splitShard()&lt;/tt&gt; preassigns nodes and the assignment is done without using the &lt;tt&gt;ReplicaAssigner&lt;/tt&gt; .This means , rules don't kick in when nodes are assigned in splitshard. In this patch, the preassigning is done using the rules , if they exist&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalinmangar" class="user-hover" rel="shalinmangar"&gt;Shalin Shekhar Mangar&lt;/a&gt; I would like you to take a look at the changes made to &lt;tt&gt;splitShard()&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="15179260" author="shalinmangar" created="Thu, 3 Mar 2016 20:44:01 -0700">&lt;p&gt;Thanks Noble. &lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
+      List&amp;lt;&lt;span class="code-object"&gt;String&lt;/span&gt;&amp;gt; subSliceNames =  &lt;span class="code-keyword"&gt;new&lt;/span&gt; ArrayList&amp;lt;&amp;gt;();
+      &lt;span class="code-keyword"&gt;for&lt;/span&gt; (&lt;span class="code-object"&gt;int&lt;/span&gt; i = 0; i &amp;lt; subSlices.size(); i++) subSliceNames.add(slice + &lt;span class="code-quote"&gt;"_"&lt;/span&gt; + i);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This seems redundant because the "subSlices" list already has all the sub-slice names.&lt;/p&gt;

&lt;p&gt;The rest looks good!&lt;/p&gt;</comment>
                            <comment id="15179689" author="noble.paul" created="Fri, 4 Mar 2016 03:28:25 -0700">&lt;p&gt;thanks&lt;/p&gt;</comment>
                            <comment id="15179730" author="jira-bot" created="Fri, 4 Mar 2016 03:55:00 -0700">&lt;p&gt;Commit 0cd24c5d08678a4cc883381d54089f62d0978b4d in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=0cd24c5" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=0cd24c5&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8728" title="Splitting a shard of a collection created with a rule fails with NPE" class="issue-link" data-issue-key="SOLR-8728"&gt;&lt;del&gt;SOLR-8728&lt;/del&gt;&lt;/a&gt;: ReplicaAssigner throws NPE when a partial list of nodes are only participating in replica&lt;br/&gt;
  placement. splitshard should preassign nodes using rules, if rules are present&lt;/p&gt;</comment>
                            <comment id="15179741" author="jira-bot" created="Fri, 4 Mar 2016 04:04:34 -0700">&lt;p&gt;Commit 201b8b02a47ccbc7d08222e11b0a3d54f63ce90f in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=201b8b0" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=201b8b0&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8728" title="Splitting a shard of a collection created with a rule fails with NPE" class="issue-link" data-issue-key="SOLR-8728"&gt;&lt;del&gt;SOLR-8728&lt;/del&gt;&lt;/a&gt;: ReplicaAssigner throws NPE when a partial list of nodes are only participating in replica&lt;br/&gt;
  placement. splitshard should preassign nodes using rules, if rules are present&lt;/p&gt;</comment>
                            <comment id="15179742" author="jira-bot" created="Fri, 4 Mar 2016 04:04:35 -0700">&lt;p&gt;Commit 89524d917adc02018f277df56553546fd11fdf77 in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=89524d9" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=89524d9&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8728" title="Splitting a shard of a collection created with a rule fails with NPE" class="issue-link" data-issue-key="SOLR-8728"&gt;&lt;del&gt;SOLR-8728&lt;/del&gt;&lt;/a&gt;: ReplicaAssigner throws NPE when a partial list of nodes are only participating in replica&lt;br/&gt;
  placement. splitshard should preassign nodes using rules, if rules are present&lt;/p&gt;</comment>
                            <comment id="15179750" author="jira-bot" created="Fri, 4 Mar 2016 04:10:02 -0700">&lt;p&gt;Commit b8183c808083fa206fbf5a0bec76807496fec162 in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b8183c8" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b8183c8&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8728" title="Splitting a shard of a collection created with a rule fails with NPE" class="issue-link" data-issue-key="SOLR-8728"&gt;&lt;del&gt;SOLR-8728&lt;/del&gt;&lt;/a&gt;: ReplicaAssigner throws NPE when a partial list of nodes are only participating in replica&lt;br/&gt;
  placement. splitshard should preassign nodes using rules, if rules are present&lt;/p&gt;</comment>
                            <comment id="15179751" author="jira-bot" created="Fri, 4 Mar 2016 04:10:03 -0700">&lt;p&gt;Commit d0de8cf8733662999e0dcd08cb07445b35632a9d in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d0de8cf" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d0de8cf&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8728" title="Splitting a shard of a collection created with a rule fails with NPE" class="issue-link" data-issue-key="SOLR-8728"&gt;&lt;del&gt;SOLR-8728&lt;/del&gt;&lt;/a&gt;: ReplicaAssigner throws NPE when a partial list of nodes are only participating in replica&lt;br/&gt;
  placement. splitshard should preassign nodes using rules, if rules are present&lt;/p&gt;</comment>
                            <comment id="15181540" author="noble.paul" created="Fri, 4 Mar 2016 22:43:10 -0700">&lt;p&gt;test failure caused by this fix &lt;br/&gt;
&lt;a href="http://jenkins.thetaphi.de/job/Lucene-Solr-6.x-Linux/15/testReport/org.apache.solr.cloud/CollectionTooManyReplicasTest/testDownedShards/" class="external-link" rel="nofollow"&gt;http://jenkins.thetaphi.de/job/Lucene-Solr-6.x-Linux/15/testReport/org.apache.solr.cloud/CollectionTooManyReplicasTest/testDownedShards/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15185200" author="shaie" created="Tue, 8 Mar 2016 09:44:17 -0700">&lt;p&gt;This is marked as fixed in 6.0, but should it also be marked for 6.1(since it's also committed to 6x)?&lt;/p&gt;

&lt;p&gt;What about master &amp;#8211; was it not committed to master too? Does it not affect master?&lt;/p&gt;

&lt;p&gt;And lastly, in case we will have a 5.5.1, is this considered a bugfix that we'll want to backport?&lt;/p&gt;</comment>
                            <comment id="15185216" author="noble.paul" created="Tue, 8 Mar 2016 09:51:56 -0700">&lt;p&gt;It's fixed on all three. So, isn't it implicit that stuff fixed in 6.0 is fixed in all releases that come after 6.0? &lt;/p&gt;


&lt;p&gt; 5.5.1 makes sense because it is a release prior to 6.0&lt;/p&gt;</comment>
                            <comment id="15185223" author="shaie" created="Tue, 8 Mar 2016 09:54:41 -0700">&lt;p&gt;We usually set the fix version to be e.g. "5.5" and "trunk/master".&lt;/p&gt;

&lt;p&gt;Cause there are issues that are fixed only in a specific version, e.g. if they only affect that version.&lt;/p&gt;</comment>
                            <comment id="15187517" author="noble.paul" created="Wed, 9 Mar 2016 10:54:12 -0700">&lt;p&gt;I guess this should go to the 5.5 branch as well right away. Just in case there is a 5.5.1&lt;/p&gt;</comment>
                            <comment id="15187565" author="jira-bot" created="Wed, 9 Mar 2016 11:17:52 -0700">&lt;p&gt;Commit c17f80a7a22a4215ebcfe08939b6c0acc30df7c2 in lucene-solr's branch refs/heads/branch_5_5 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c17f80a" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c17f80a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8728" title="Splitting a shard of a collection created with a rule fails with NPE" class="issue-link" data-issue-key="SOLR-8728"&gt;&lt;del&gt;SOLR-8728&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15187566" author="jira-bot" created="Wed, 9 Mar 2016 11:17:54 -0700">&lt;p&gt;Commit 4faadb625e91b8ef323724855748258570137084 in lucene-solr's branch refs/heads/branch_5_5 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=4faadb6" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=4faadb6&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8728" title="Splitting a shard of a collection created with a rule fails with NPE" class="issue-link" data-issue-key="SOLR-8728"&gt;&lt;del&gt;SOLR-8728&lt;/del&gt;&lt;/a&gt;: ReplicaAssigner throws NPE when a partial list of nodes are only participating in replica&lt;br/&gt;
  placement. splitshard should preassign nodes using rules, if rules are present&lt;/p&gt;</comment>
                            <comment id="15252948" author="anshumg" created="Thu, 21 Apr 2016 15:52:37 -0700">&lt;p&gt;Noble, this was committed to branch_5_5 but seems like you missed the change log entry.&lt;/p&gt;</comment>
                            <comment id="15252950" author="anshumg" created="Thu, 21 Apr 2016 15:53:08 -0700">&lt;p&gt;Reopening to add the change log entry to branch_5_5.&lt;/p&gt;</comment>
                            <comment id="15253075" author="anshumg" created="Thu, 21 Apr 2016 17:31:13 -0700">&lt;p&gt;branch_5x&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
commit 07f9cf8aee3523a22c92923f9d4e46a297efc455
Author: anshum &amp;lt;anshum@apache.org&amp;gt;
Date:   Thu Apr 21 15:59:25 2016 -0700

    SOLR-8728: Add missing change log entry &lt;span class="code-keyword"&gt;for&lt;/span&gt; 5.5.1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;branch_5_5&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
commit 5601f839c5001b1c2cce44b3b6349b1c1de23230
Author: anshum &amp;lt;anshum@apache.org&amp;gt;
Date:   Thu Apr 21 15:59:25 2016 -0700

    SOLR-8728: Add missing change log entry &lt;span class="code-keyword"&gt;for&lt;/span&gt; 5.5.1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12946511">SOLR-8783</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12791166" name="SOLR-8728.patch" size="9912" author="noble.paul" created="Thu, 3 Mar 2016 06:12:55 -0700"/>
                            <attachment id="12789582" name="SOLR-8728.patch" size="2253" author="shaie" created="Wed, 24 Feb 2016 08:47:53 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 1 Mar 2016 05:27:54 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2thkn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8726] move the embedded xml for schema and solconfig for .system collection to a file</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8726</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;These files can be moved to the resources &lt;/p&gt;</description>
                <environment/>
        <key id="12942562">SOLR-8726</key>
            <summary>move the embedded xml for schema and solconfig for .system collection to a file</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="noble.paul">Noble Paul</assignee>
                                    <reporter username="noble.paul">Noble Paul</reporter>
                        <labels>
                    </labels>
                <created>Wed, 24 Feb 2016 01:29:00 -0700</created>
                <updated>Fri, 26 Feb 2016 03:14:23 -0700</updated>
                            <resolved>Wed, 24 Feb 2016 06:35:32 -0700</resolved>
                                                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="15162986" author="noble.paul" created="Wed, 24 Feb 2016 06:34:12 -0700">&lt;p&gt;Commit d77cd3287d06e68a7aec598e20562b4e4f5d6fb2 in lucene-solr's branch refs/heads/master from Noble Paul&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d77cd32" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d77cd32&lt;/a&gt; ]&lt;br/&gt;
&lt;a href="https://issues.apache.org/jira/browse/SOLR-8726" title="move the embedded xml for schema and solconfig for .system collection to a file" class="issue-link" data-issue-key="SOLR-8726"&gt;&lt;del&gt;SOLR-8726&lt;/del&gt;&lt;/a&gt;: move the embedded xml for schema and solconfig for .system collection to individual files&lt;/p&gt;</comment>
                            <comment id="15168772" author="jira-bot" created="Fri, 26 Feb 2016 03:14:23 -0700">&lt;p&gt;Commit 6c0846107aeab85a254b1ee023cb069c23caa803 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=6c08461" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=6c08461&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8726" title="move the embedded xml for schema and solconfig for .system collection to a file" class="issue-link" data-issue-key="SOLR-8726"&gt;&lt;del&gt;SOLR-8726&lt;/del&gt;&lt;/a&gt; : typo in file name&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 26 Feb 2016 10:14:23 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2tez3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8725] Cores, collections, and shards should accept hyphens in identifier name</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8725</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;In &lt;a href="https://issues.apache.org/jira/browse/SOLR-8642" title="SOLR allows creation of collections with invalid names" class="issue-link" data-issue-key="SOLR-8642"&gt;&lt;del&gt;SOLR-8642&lt;/del&gt;&lt;/a&gt;, hyphens are no longer considered valid identifiers for cores (and collections?). Our solr instance was successfully using hyphens in our core names, and our affected cores now error with:&lt;/p&gt;

&lt;p&gt;marc-profiler_shard1_replica1: org.apache.solr.common.SolrException:org.apache.solr.common.SolrException: Invalid name: 'marc-profiler_shard1_replica1' Identifiers must consist entirely of periods, underscores and alphanumerics&lt;/p&gt;

&lt;p&gt;Before starting to rename all of our collections, I wonder if this decision could be revisited to be backwards compatible with previously created collections.&lt;/p&gt;</description>
                <environment/>
        <key id="12941590">SOLR-8725</key>
            <summary>Cores, collections, and shards should accept hyphens in identifier name</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="4" iconUrl="https://issues.apache.org/jira/images/icons/statuses/reopened.png" description="This issue was once resolved, but the resolution was deemed incorrect. From here issues are either marked assigned or resolved.">Reopened</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="anshumg">Anshum Gupta</assignee>
                                    <reporter username="cbeer">Chris Beer</reporter>
                        <labels>
                    </labels>
                <created>Tue, 23 Feb 2016 17:30:36 -0700</created>
                <updated>Mon, 9 May 2016 08:40:42 -0700</updated>
                                            <version>5.5</version>
                                    <fixVersion>5.5.1</fixVersion>
                    <fixVersion>6.0</fixVersion>
                    <fixVersion>master</fixVersion>
                                        <due/>
                            <votes>7</votes>
                                    <watches>17</watches>
                                                                <comments>
                            <comment id="15160352" author="janhoy" created="Wed, 24 Feb 2016 01:04:24 -0700">&lt;p&gt;It makes sense to allow hyphens, but not as first character of the name. In &lt;a href="https://issues.apache.org/jira/browse/SOLR-8110" title="Start enforcing field naming recomendations in next X.0 release?" class="issue-link" data-issue-key="SOLR-8110"&gt;SOLR-8110&lt;/a&gt; we discuss rules for all kind of identifiers for 6.x and so far there seems to be consensus to allow both hyphens, dots and underscores.&lt;/p&gt;</comment>
                            <comment id="15168929" author="arcadius" created="Fri, 26 Feb 2016 05:48:24 -0700">&lt;p&gt;We just got hit by this issue.&lt;/p&gt;

&lt;p&gt;We are just replacing '-' by '_' as a workaround.&lt;/p&gt;

&lt;p&gt;Good we are using aliases to access the collections, so not much code change.&lt;/p&gt;</comment>
                            <comment id="15168994" author="gerlowskija" created="Fri, 26 Feb 2016 06:18:13 -0700">&lt;p&gt;For context, this was initially changed in &lt;a href="https://issues.apache.org/jira/browse/SOLR-8308" title="Core gets inaccessible after RENAME operation with special characters" class="issue-link" data-issue-key="SOLR-8308"&gt;&lt;del&gt;SOLR-8308&lt;/del&gt;&lt;/a&gt;.  You can read up on the rationale/discussion there.  To summarize, there were some issues with cores becoming inaccessible after being renamed, when the new name contained quirky characters.  When enforcement was put in, the regex as written to match existing Solr "recommendations", which suggest that identifiers should only contain alphanumerics, periods, and underscores.&lt;/p&gt;

&lt;p&gt;There's been some pushback on treating hyphens as invalid, particularly on &lt;a href="https://issues.apache.org/jira/browse/SOLR-8110" title="Start enforcing field naming recomendations in next X.0 release?" class="issue-link" data-issue-key="SOLR-8110"&gt;SOLR-8110&lt;/a&gt;, and on &lt;a href="https://issues.apache.org/jira/browse/SOLR-8642" title="SOLR allows creation of collections with invalid names" class="issue-link" data-issue-key="SOLR-8642"&gt;&lt;del&gt;SOLR-8642&lt;/del&gt;&lt;/a&gt;.  I think the current consensus is that this behavior will be changed in &lt;a href="https://issues.apache.org/jira/browse/SOLR-8110" title="Start enforcing field naming recomendations in next X.0 release?" class="issue-link" data-issue-key="SOLR-8110"&gt;SOLR-8110&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15169572" author="jwartes" created="Fri, 26 Feb 2016 12:03:17 -0700">&lt;p&gt;Well, I'm glad I haven't tried moving to 5.5 yet, this would have been an unpleasant migration discovery.&lt;br/&gt;
I use hyphens in both collection names and alias names. (although not as a leading character) &lt;br/&gt;
Generally, I prefer to avoid using underscores anyplace that ends up in a URL.&lt;/p&gt;</comment>
                            <comment id="15169804" author="anshumg" created="Fri, 26 Feb 2016 14:01:31 -0700">&lt;p&gt;After discussions on other JIRAs mentioned above, I'll add the hypen to the allowed char list and an added check to make sure that it's not the first char when naming a core, collection, shard etc.&lt;/p&gt;</comment>
                            <comment id="15169933" author="anshumg" created="Fri, 26 Feb 2016 15:03:50 -0700">&lt;p&gt;Patch without tests. Will add them in a bit and commit.&lt;br/&gt;
This allows hyphens in the name but not as the first char.&lt;/p&gt;</comment>
                            <comment id="15170622" author="gerlowskija" created="Sat, 27 Feb 2016 08:32:15 -0700">&lt;p&gt;Hey &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anshumg" class="user-hover" rel="anshumg"&gt;Anshum Gupta&lt;/a&gt;, were you planning on changing the messages that get returned from the core/collection/shard APIs when an invalid identifier is used?  I think they mention specifically what characters are allowed in a valid identifier.  If the regex is changing, the messages should probably be updated also.  (Might make sense to pull the message into a single constant that lives in &lt;tt&gt;SolrIdentifierValidator&lt;/tt&gt; too, but maybe it doesn't, I'd have to look.)&lt;/p&gt;

&lt;p&gt;Happy to update the patch myself with those changes if you want.  Wanted to check first though; didn't want to step on your toes if there's a reason you didn't do it.&lt;/p&gt;</comment>
                            <comment id="15172156" author="mschumann" created="Mon, 29 Feb 2016 10:08:08 -0700">&lt;p&gt;This issue is stopping us from using 5.5 since we have a lot of infrastructure built around managing our collections and it would be expensive for us to adapt it to not use a hyphen. Please fix it with a point release.&lt;/p&gt;</comment>
                            <comment id="15176783" author="anshumg" created="Wed, 2 Mar 2016 17:20:02 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gerlowskija" class="user-hover" rel="gerlowskija"&gt;Jason Gerlowski&lt;/a&gt; yes, it makes sense to consolidate all the messages in one place. I've done that in this patch which I'm about to commit. Thanks for looking at it.&lt;/p&gt;</comment>
                            <comment id="15176785" author="anshumg" created="Wed, 2 Mar 2016 17:20:43 -0700">&lt;p&gt;Yes, we should back-port this to a 5x release whenever that happens.&lt;/p&gt;</comment>
                            <comment id="15178366" author="jira-bot" created="Thu, 3 Mar 2016 11:53:06 -0700">&lt;p&gt;Commit 6de2b7dbd17fc70fc9b2b053fe2628534116309b in lucene-solr's branch refs/heads/master from anshum&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=6de2b7d" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=6de2b7d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8725" title="Cores, collections, and shards should accept hyphens in identifier name" class="issue-link" data-issue-key="SOLR-8725"&gt;SOLR-8725&lt;/a&gt;: Allow hyphen in shard, collection, core, and alias names but not the first char&lt;/p&gt;</comment>
                            <comment id="15178636" author="jira-bot" created="Thu, 3 Mar 2016 14:13:58 -0700">&lt;p&gt;Commit 7daad8d7d17b429adbd6cf61474a81b7c7bdf9c9 in lucene-solr's branch refs/heads/master from anshum&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=7daad8d" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=7daad8d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8725" title="Cores, collections, and shards should accept hyphens in identifier name" class="issue-link" data-issue-key="SOLR-8725"&gt;SOLR-8725&lt;/a&gt;: Fix precommit check&lt;/p&gt;</comment>
                            <comment id="15178645" author="jira-bot" created="Thu, 3 Mar 2016 14:23:25 -0700">&lt;p&gt;Commit 7e59ba4220d836d205f454a35a9c8ae192c28a26 in lucene-solr's branch refs/heads/branch_6x from anshum&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=7e59ba4" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=7e59ba4&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8725" title="Cores, collections, and shards should accept hyphens in identifier name" class="issue-link" data-issue-key="SOLR-8725"&gt;SOLR-8725&lt;/a&gt;: Allow hyphen in shard, collection, core, and alias names but not the first char&lt;/p&gt;</comment>
                            <comment id="15178646" author="jira-bot" created="Thu, 3 Mar 2016 14:23:27 -0700">&lt;p&gt;Commit 73d2d1125f43d6f482b0be7ecfccd673d1fe6d41 in lucene-solr's branch refs/heads/branch_6x from anshum&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=73d2d11" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=73d2d11&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8725" title="Cores, collections, and shards should accept hyphens in identifier name" class="issue-link" data-issue-key="SOLR-8725"&gt;SOLR-8725&lt;/a&gt;: Fix precommit check&lt;/p&gt;</comment>
                            <comment id="15178685" author="jira-bot" created="Thu, 3 Mar 2016 14:58:44 -0700">&lt;p&gt;Commit 3f15560b519f41eb579d114363a4874aa585b324 in lucene-solr's branch refs/heads/branch_6_0 from anshum&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3f15560b" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3f15560b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8725" title="Cores, collections, and shards should accept hyphens in identifier name" class="issue-link" data-issue-key="SOLR-8725"&gt;SOLR-8725&lt;/a&gt;: Allow hyphen in shard, collection, core, and alias names but not the first char&lt;/p&gt;</comment>
                            <comment id="15178686" author="jira-bot" created="Thu, 3 Mar 2016 14:58:45 -0700">&lt;p&gt;Commit 2fef533fe97be90ffb41daee83b4d05c88cc3a7a in lucene-solr's branch refs/heads/branch_6_0 from anshum&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=2fef533" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=2fef533&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8725" title="Cores, collections, and shards should accept hyphens in identifier name" class="issue-link" data-issue-key="SOLR-8725"&gt;SOLR-8725&lt;/a&gt;: Fix precommit check&lt;/p&gt;</comment>
                            <comment id="15216703" author="elyograg" created="Tue, 29 Mar 2016 12:23:45 -0700">&lt;p&gt;I could not cherry-pick this change to the 5.5 branch, or even apply it as a patch.  The later branches have deviated too far.&lt;/p&gt;

&lt;p&gt;Instead I hand-edited a minimally invasive change to the pattern, the javadoc, and the message in the thrown exception.  Patch for branch_5_5 attached.&lt;/p&gt;

&lt;p&gt;If I temporarily revert an ill-advised commit that I made to change the version to 5.5.1, precommit passes.&lt;/p&gt;</comment>
                            <comment id="15217046" author="anshumg" created="Tue, 29 Mar 2016 16:19:49 -0700">&lt;p&gt;Shawn pointed out to an issue with the regular expression to me on irc. Here's a fix with a quick test. &lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=elyograg" class="user-hover" rel="elyograg"&gt;Shawn Heisey&lt;/a&gt;, mind taking a look?&lt;/p&gt;</comment>
                            <comment id="15217078" author="elyograg" created="Tue, 29 Mar 2016 16:44:46 -0700">&lt;p&gt;I think the regex did work before &amp;#8211; I tried a whole bunch of creation commands to see if I could break it and it seemed to work as advertised.  The new one is easier to understand, but I believe it does the same task.&lt;/p&gt;

&lt;p&gt;My main concern was getting the fix backported to the 5.5 branch, so if we do release 5.5.1, it will have the fix.&lt;/p&gt;</comment>
                            <comment id="15217251" author="anshumg" created="Tue, 29 Mar 2016 19:15:36 -0700">&lt;p&gt;I really thought that the regex didn't work but the test I added seems to say otherwise! I'll skip the patch.&lt;br/&gt;
I'll take a look at the 5.5.1 fix. Thanks for the patch.&lt;/p&gt;</comment>
                            <comment id="15218150" author="erickerickson" created="Wed, 30 Mar 2016 08:32:17 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anshumg" class="user-hover" rel="anshumg"&gt;Anshum Gupta&lt;/a&gt; I made this a blocker in response to the move to cut 6.0 to be sure we consciously decide to include this or not...&lt;/p&gt;

&lt;p&gt;The revised regex is a little easier to understand I think, but whatever.... Maybe a comment about what the purpose of the regex is (i.e. exclude a hyphen as the first character)?&lt;/p&gt;

&lt;p&gt;And maybe add the fact that they cannot &lt;em&gt;start&lt;/em&gt; with hypens to the getIdentifierMessage?&lt;/p&gt;</comment>
                            <comment id="15218457" author="anshumg" created="Wed, 30 Mar 2016 10:58:20 -0700">&lt;p&gt;but a working version of this is in 6.0, so I don't think we need this to be a blocker. I made this a blocker thinking on similar lines but then decided against it.&lt;/p&gt;

&lt;p&gt;It would be nice to add that information about hyphen not being allowed as the first character to the getIdentifiesMessage method though.&lt;/p&gt;</comment>
                            <comment id="15218507" author="erickerickson" created="Wed, 30 Mar 2016 11:19:54 -0700">&lt;p&gt;OK, Anshum is correct, this fix is in 6.0 so this shouldn't be a blocker, just have to decide what to do about 5.5.1 etc.&lt;/p&gt;

&lt;p&gt;And my comment about re-wording things was on the theory that the patch hadn't been committed yet, feel free to ignore.&lt;/p&gt;</comment>
                            <comment id="15220418" author="anshumg" created="Thu, 31 Mar 2016 11:36:16 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=elyograg" class="user-hover" rel="elyograg"&gt;Shawn Heisey&lt;/a&gt; the patch looks fine to me. I really wanted to get things in sync but seem like the code changed while enforcing more restrictions.&lt;br/&gt;
Let's go with this as it's the same regular expression.&lt;/p&gt;</comment>
                            <comment id="15220666" author="jira-bot" created="Thu, 31 Mar 2016 14:00:18 -0700">&lt;p&gt;Commit 9bca6db03223e1da07129e374100b74cc14f9a44 in lucene-solr's branch refs/heads/branch_5_5 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anshum" class="user-hover" rel="anshum"&gt;Anshum Gupta&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9bca6db" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9bca6db&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8725" title="Cores, collections, and shards should accept hyphens in identifier name" class="issue-link" data-issue-key="SOLR-8725"&gt;SOLR-8725&lt;/a&gt;: Allow hyphen in shard, collection, core, and alias names but not the first char (backport to 5.5 branch)&lt;/p&gt;</comment>
                            <comment id="15225978" author="joycebabu" created="Tue, 5 Apr 2016 02:40:07 -0700">&lt;p&gt;Is this now available in the latest nightly?&lt;/p&gt;</comment>
                            <comment id="15228706" author="anshumg" created="Wed, 6 Apr 2016 10:34:45 -0700">&lt;p&gt;Yes, this would be available.&lt;/p&gt;</comment>
                            <comment id="15259552" author="anshumg" created="Tue, 26 Apr 2016 21:56:36 -0700">&lt;p&gt;Reopening this as it's not on the 5x branch but on 5.5.&lt;/p&gt;</comment>
                            <comment id="15276520" author="stephlag" created="Mon, 9 May 2016 08:40:42 -0700">&lt;p&gt;Can you close the issue as it is commited on the 5.5 branch?&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12936745">SOLR-8642</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12901721">SOLR-8110</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12795903" name="SOLR-8725-5_5.patch" size="2317" author="elyograg" created="Tue, 29 Mar 2016 12:23:45 -0700"/>
                            <attachment id="12795963" name="SOLR-8725-fix-regex.patch" size="2036" author="anshumg" created="Tue, 29 Mar 2016 16:23:16 -0700"/>
                            <attachment id="12791065" name="SOLR-8725.patch" size="19078" author="anshumg" created="Wed, 2 Mar 2016 17:20:02 -0700"/>
                            <attachment id="12790233" name="SOLR-8725.patch" size="861" author="anshumg" created="Fri, 26 Feb 2016 15:03:50 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 24 Feb 2016 08:04:24 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 hours ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2t8z3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>

<item>
            <title>[SOLR-8719] Rename the Jar loading classes to load any  blobs</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8719</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;The classes used to load jars from blob store can be used for loading any blobs. &lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;JarRepository -&amp;gt;BlobRepository&lt;/li&gt;
	&lt;li&gt;JarContentRef -&amp;gt; BlobContentRef&lt;/li&gt;
	&lt;li&gt;JarContent -&amp;gt; BlobContent&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment/>
        <key id="12941366">SOLR-8719</key>
            <summary>Rename the Jar loading classes to load any  blobs</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="noble.paul">Noble Paul</assignee>
                                    <reporter username="noble.paul">Noble Paul</reporter>
                        <labels>
                    </labels>
                <created>Tue, 23 Feb 2016 03:33:08 -0700</created>
                <updated>Tue, 23 Feb 2016 23:12:18 -0700</updated>
                            <resolved>Tue, 23 Feb 2016 03:46:21 -0700</resolved>
                                                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="15158710" author="jira-bot" created="Tue, 23 Feb 2016 03:45:35 -0700">&lt;p&gt;Commit 4d9d0c0011de8653fbe404af702e822883e8fb13 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=4d9d0c0" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=4d9d0c0&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8719" title="Rename the Jar loading classes to load any  blobs" class="issue-link" data-issue-key="SOLR-8719"&gt;&lt;del&gt;SOLR-8719&lt;/del&gt;&lt;/a&gt; renamed classes to make their usage generic&lt;/p&gt;</comment>
                            <comment id="15160232" author="jira-bot" created="Tue, 23 Feb 2016 23:12:18 -0700">&lt;p&gt;Commit 4d9d0c0011de8653fbe404af702e822883e8fb13 in lucene-solr's branch refs/heads/apiv2 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=4d9d0c0" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=4d9d0c0&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8719" title="Rename the Jar loading classes to load any  blobs" class="issue-link" data-issue-key="SOLR-8719"&gt;&lt;del&gt;SOLR-8719&lt;/del&gt;&lt;/a&gt; renamed classes to make their usage generic&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12916820">SOLR-8349</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12789172" name="SOLR-8719.patch" size="10540" author="noble.paul" created="Tue, 23 Feb 2016 03:44:14 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 23 Feb 2016 10:45:35 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2t7lb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8708] DaemonStream should catch InterruptedException when reading underlying stream.</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8708</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Currently the DaemonStream is only catching IOException when reading from the underlying stream. This causes the DaemonStream to not shutdown properly. Jenkins failures look like this:&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
  [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([A9AE0C8FDE484A6D]:0)Throwable #2: com.carrotsearch.randomizedtesting.UncaughtExceptionError: Captured an uncaught exception in thread: &lt;span class="code-object"&gt;Thread&lt;/span&gt;[id=2859, name=&lt;span class="code-object"&gt;Thread&lt;/span&gt;-971, state=RUNNABLE, group=TGRP-StreamExpressionTest]
   [junit4]    &amp;gt; Caused by: org.apache.solr.common.SolrException: Could not load collection from ZK: parallelDestinationCollection1
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([A9AE0C8FDE484A6D]:0)
   [junit4]    &amp;gt; 	at org.apache.solr.common.cloud.ZkStateReader.getCollectionLive(ZkStateReader.java:959)
   [junit4]    &amp;gt; 	at org.apache.solr.common.cloud.ZkStateReader$LazyCollectionRef.get(ZkStateReader.java:517)
   [junit4]    &amp;gt; 	at org.apache.solr.common.cloud.ClusterState.getCollectionOrNull(ClusterState.java:189)
   [junit4]    &amp;gt; 	at org.apache.solr.common.cloud.ClusterState.hasCollection(ClusterState.java:119)
   [junit4]    &amp;gt; 	at org.apache.solr.client.solrj.impl.CloudSolrClient.getCollectionNames(CloudSolrClient.java:1111)
   [junit4]    &amp;gt; 	at org.apache.solr.client.solrj.impl.CloudSolrClient.requestWithRetryOnStaleState(CloudSolrClient.java:833)
   [junit4]    &amp;gt; 	at org.apache.solr.client.solrj.impl.CloudSolrClient.request(CloudSolrClient.java:806)
   [junit4]    &amp;gt; 	at org.apache.solr.client.solrj.SolrRequest.process(SolrRequest.java:149)
   [junit4]    &amp;gt; 	at org.apache.solr.client.solrj.SolrClient.add(SolrClient.java:106)
   [junit4]    &amp;gt; 	at org.apache.solr.client.solrj.SolrClient.add(SolrClient.java:71)
   [junit4]    &amp;gt; 	at org.apache.solr.client.solrj.io.stream.UpdateStream.uploadBatchToCollection(UpdateStream.java:256)
   [junit4]    &amp;gt; 	at org.apache.solr.client.solrj.io.stream.UpdateStream.read(UpdateStream.java:118)
   [junit4]    &amp;gt; 	at org.apache.solr.client.solrj.io.stream.DaemonStream$StreamRunner.run(DaemonStream.java:245)
   [junit4]    &amp;gt; Caused by: java.lang.InterruptedException
   [junit4]    &amp;gt; 	at java.lang.&lt;span class="code-object"&gt;Object&lt;/span&gt;.wait(Native Method)
   [junit4]    &amp;gt; 	at java.lang.&lt;span class="code-object"&gt;Object&lt;/span&gt;.wait(&lt;span class="code-object"&gt;Object&lt;/span&gt;.java:502)
   [junit4]    &amp;gt; 	at org.apache.zookeeper.ClientCnxn.submitRequest(ClientCnxn.java:1342)
   [junit4]    &amp;gt; 	at org.apache.zookeeper.ZooKeeper.getData(ZooKeeper.java:1153)
   [junit4]    &amp;gt; 	at org.apache.solr.common.cloud.SolrZkClient$7.execute(SolrZkClient.java:353)
   [junit4]    &amp;gt; 	at org.apache.solr.common.cloud.SolrZkClient$7.execute(SolrZkClient.java:350)
   [junit4]    &amp;gt; 	at org.apache.solr.common.cloud.ZkCmdExecutor.retryOperation(ZkCmdExecutor.java:60)
   [junit4]    &amp;gt; 	at org.apache.solr.common.cloud.SolrZkClient.getData(SolrZkClient.java:350)
   [junit4]    &amp;gt; 	at org.apache.solr.common.cloud.ZkStateReader.fetchCollectionState(ZkStateReader.java:967)
   [junit4]    &amp;gt; 	at org.apache.solr.common.cloud.ZkStateReader.getCollectionLive(ZkStateReader.java:954)
   [junit4]    &amp;gt; 	... 12 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment/>
        <key id="12940621">SOLR-8708</key>
            <summary>DaemonStream should catch InterruptedException when reading underlying stream.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="joel.bernstein">Joel Bernstein</assignee>
                                    <reporter username="joel.bernstein">Joel Bernstein</reporter>
                        <labels>
                    </labels>
                <created>Fri, 19 Feb 2016 13:03:33 -0700</created>
                <updated>Sat, 20 Feb 2016 20:35:51 -0700</updated>
                            <resolved>Sat, 20 Feb 2016 20:35:51 -0700</resolved>
                                    <version>6.0</version>
                                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="15155321" author="joel.bernstein" created="Fri, 19 Feb 2016 19:40:03 -0700">&lt;p&gt;Patch with improved error handling that handles the InterruptedException causing this issue.&lt;/p&gt;</comment>
                            <comment id="15155877" author="jira-bot" created="Sat, 20 Feb 2016 20:35:32 -0700">&lt;p&gt;Commit 2b3529c3b8b8ea923b6e86a71b22db0d425ca5e7 in lucene-solr's branch refs/heads/master from jbernste&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=2b3529c" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=2b3529c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8708" title="DaemonStream should catch InterruptedException when reading underlying stream." class="issue-link" data-issue-key="SOLR-8708"&gt;&lt;del&gt;SOLR-8708&lt;/del&gt;&lt;/a&gt;: DaemonStream should catch InterruptedException when reading underlying stream.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12788809" name="SOLR-8708.patch" size="3186" author="joel.bernstein" created="Fri, 19 Feb 2016 19:40:03 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 21 Feb 2016 03:35:32 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2t2zz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8701] CloudSolrClient decides that there are no healthy nodes to handle a request too early.</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8701</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;CloudSolrClient bails when it finds no leaders before trying replicas. We should try all nodes before declaring we cannot serve the request.&lt;/p&gt;</description>
                <environment/>
        <key id="12940493">SOLR-8701</key>
            <summary>CloudSolrClient decides that there are no healthy nodes to handle a request too early.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="markrmiller@gmail.com">Mark Miller</assignee>
                                    <reporter username="markrmiller@gmail.com">Mark Miller</reporter>
                        <labels>
                    </labels>
                <created>Fri, 19 Feb 2016 06:00:54 -0700</created>
                <updated>Mon, 9 May 2016 07:52:50 -0700</updated>
                            <resolved>Mon, 9 May 2016 07:52:50 -0700</resolved>
                                                    <fixVersion>5.5.1</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="15154197" author="markrmiller@gmail.com" created="Fri, 19 Feb 2016 06:16:04 -0700">&lt;p&gt;I think I've seen commits in tests fail due to this.&lt;/p&gt;</comment>
                            <comment id="15154229" author="jira-bot" created="Fri, 19 Feb 2016 06:51:53 -0700">&lt;p&gt;Commit c4d31798cc79fabf3b7cee4757eb39367461633e in lucene-solr's branch refs/heads/master from markrmiller&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c4d3179" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c4d3179&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8701" title="CloudSolrClient decides that there are no healthy nodes to handle a request too early." class="issue-link" data-issue-key="SOLR-8701"&gt;&lt;del&gt;SOLR-8701&lt;/del&gt;&lt;/a&gt;: CloudSolrClient decides that there are no healthy nodes to handle a request too early.&lt;/p&gt;</comment>
                            <comment id="15248550" author="anshumg" created="Tue, 19 Apr 2016 13:23:43 -0700">&lt;p&gt;Reopening to back porting for 5.5.1.&lt;/p&gt;</comment>
                            <comment id="15248651" author="jira-bot" created="Tue, 19 Apr 2016 14:11:08 -0700">&lt;p&gt;Commit 6ddf2c977161ccf17e8b3c1fbeaa4c4bdc6473f5 in lucene-solr's branch refs/heads/branch_5x from markrmiller&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=6ddf2c9" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=6ddf2c9&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8701" title="CloudSolrClient decides that there are no healthy nodes to handle a request too early." class="issue-link" data-issue-key="SOLR-8701"&gt;&lt;del&gt;SOLR-8701&lt;/del&gt;&lt;/a&gt;: CloudSolrClient decides that there are no healthy nodes to handle a request too early.&lt;/p&gt;</comment>
                            <comment id="15248816" author="jira-bot" created="Tue, 19 Apr 2016 15:34:21 -0700">&lt;p&gt;Commit 607e91cdab50af1168f5bc8b8785cfa77f1e55ea in lucene-solr's branch refs/heads/branch_5_5 from markrmiller&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=607e91c" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=607e91c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8701" title="CloudSolrClient decides that there are no healthy nodes to handle a request too early." class="issue-link" data-issue-key="SOLR-8701"&gt;&lt;del&gt;SOLR-8701&lt;/del&gt;&lt;/a&gt;: CloudSolrClient decides that there are no healthy nodes to handle a request too early.&lt;/p&gt;</comment>
                            <comment id="15276450" author="stephlag" created="Mon, 9 May 2016 07:49:13 -0700">&lt;p&gt;Can you close the issue as the commit has been applied on 5.x and 5.5 ?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12788675" name="SOLR-8701.patch" size="2444" author="markrmiller@gmail.com" created="Fri, 19 Feb 2016 06:10:49 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 19 Feb 2016 13:51:53 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 hours ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2t27j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8700] Move the ImplicitPlugins definitions to a json file</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8700</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;ImplicitPlugins.java is all about constructing the datastructures programmatically. it's much better if they were represented in a proper json file&lt;/p&gt;</description>
                <environment/>
        <key id="12940364">SOLR-8700</key>
            <summary>Move the ImplicitPlugins definitions to a json file</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="noble.paul">Noble Paul</assignee>
                                    <reporter username="noble.paul">Noble Paul</reporter>
                        <labels>
                    </labels>
                <created>Thu, 18 Feb 2016 18:36:07 -0700</created>
                <updated>Sun, 21 Feb 2016 08:23:46 -0700</updated>
                            <resolved>Sun, 21 Feb 2016 08:23:46 -0700</resolved>
                                                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="15156058" author="jira-bot" created="Sun, 21 Feb 2016 08:22:14 -0700">&lt;p&gt;Commit 5a15fed9f5249cf658ddfbccae55733bb5855190 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=5a15fed" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=5a15fed&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8700" title="Move the ImplicitPlugins definitions to a json file" class="issue-link" data-issue-key="SOLR-8700"&gt;&lt;del&gt;SOLR-8700&lt;/del&gt;&lt;/a&gt; eliminate the java class for implicit plugins&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12788898" name="SOLR-8700.patch" size="13208" author="noble.paul" created="Sun, 21 Feb 2016 02:59:06 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 21 Feb 2016 15:22:14 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2t1ev:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8698] params.json should have a way to specify appends and invariants</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8698</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;params.json only supports defaults today. It should be possible to add &lt;tt&gt;appends&lt;/tt&gt; and &lt;tt&gt;invariants&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;for example&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
{
&lt;span class="code-quote"&gt;"params"&lt;/span&gt;:{

&lt;span class="code-quote"&gt;"my_param_set"&lt;/span&gt; : {
&lt;span class="code-quote"&gt;"a"&lt;/span&gt;:&lt;span class="code-quote"&gt;"A"&lt;/span&gt;,
&lt;span class="code-quote"&gt;"b"&lt;/span&gt; :&lt;span class="code-quote"&gt;"B"&lt;/span&gt;,
&lt;span class="code-quote"&gt;"_appends_"&lt;/span&gt; : {
&lt;span class="code-quote"&gt;"c"&lt;/span&gt;: &lt;span class="code-quote"&gt;"C"&lt;/span&gt;
},
&lt;span class="code-quote"&gt;"_invariants_"&lt;/span&gt;:{
&lt;span class="code-quote"&gt;"d"&lt;/span&gt; : &lt;span class="code-quote"&gt;"D"&lt;/span&gt;
}}
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In this case variables &lt;tt&gt;a&lt;/tt&gt; and &lt;tt&gt;b&lt;/tt&gt; are defaults, &lt;tt&gt;c&lt;/tt&gt; is appends and &lt;tt&gt;d&lt;/tt&gt; is invariants&lt;/p&gt;

&lt;p&gt;The fact that we can have invariants and appends means that if a useParam is specified with the component, it should not be overridable from the request&lt;/p&gt;

&lt;p&gt;So, this introduces a back incompat change&lt;/p&gt;</description>
                <environment/>
        <key id="12940313">SOLR-8698</key>
            <summary>params.json should have a way to specify appends and invariants</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="noble.paul">Noble Paul</assignee>
                                    <reporter username="noble.paul">Noble Paul</reporter>
                        <labels>
                    </labels>
                <created>Thu, 18 Feb 2016 15:52:01 -0700</created>
                <updated>Tue, 1 Mar 2016 10:06:47 -0700</updated>
                            <resolved>Tue, 23 Feb 2016 05:11:36 -0700</resolved>
                                                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>1</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="15157018" author="noble.paul" created="Mon, 22 Feb 2016 07:07:00 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ehatcher" class="user-hover" rel="ehatcher"&gt;Erik Hatcher&lt;/a&gt; From 6.0 onwards we are making this much needed change and params now have the full capabilities of standard requesthandler definitions. &lt;/p&gt;</comment>
                            <comment id="15157021" author="noble.paul" created="Mon, 22 Feb 2016 07:07:56 -0700">&lt;p&gt;all required changes as per the description and necessary changes in the tests&lt;/p&gt;</comment>
                            <comment id="15157116" author="ehatcher" created="Mon, 22 Feb 2016 08:18:32 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt; sweet!  this will allow the workaround in example/files solrconfig.xml for /browse and the appended parameter.&lt;/p&gt;</comment>
                            <comment id="15158772" author="jira-bot" created="Tue, 23 Feb 2016 05:11:05 -0700">&lt;p&gt;Commit 9ce2d0d25df7d619ef9ea16a8b5e7f5341d3fc71 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9ce2d0d" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9ce2d0d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8698" title="params.json should have a way to specify appends and invariants" class="issue-link" data-issue-key="SOLR-8698"&gt;&lt;del&gt;SOLR-8698&lt;/del&gt;&lt;/a&gt;: params.json can now have appends and invariants as well. 'useParams' specified in the requestHandler is always applied&lt;/p&gt;</comment>
                            <comment id="15160233" author="jira-bot" created="Tue, 23 Feb 2016 23:12:19 -0700">&lt;p&gt;Commit 9ce2d0d25df7d619ef9ea16a8b5e7f5341d3fc71 in lucene-solr's branch refs/heads/apiv2 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9ce2d0d" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9ce2d0d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8698" title="params.json should have a way to specify appends and invariants" class="issue-link" data-issue-key="SOLR-8698"&gt;&lt;del&gt;SOLR-8698&lt;/del&gt;&lt;/a&gt;: params.json can now have appends and invariants as well. 'useParams' specified in the requestHandler is always applied&lt;/p&gt;</comment>
                            <comment id="15173197" author="jira-bot" created="Mon, 29 Feb 2016 21:00:35 -0700">&lt;p&gt;Commit 1734d03eb9f92d53f99b5652e239064519e1ba79 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=1734d03" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=1734d03&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8698" title="params.json should have a way to specify appends and invariants" class="issue-link" data-issue-key="SOLR-8698"&gt;&lt;del&gt;SOLR-8698&lt;/del&gt;&lt;/a&gt;: changes the example config to reflect the new behavior&lt;/p&gt;</comment>
                            <comment id="15174034" author="jira-bot" created="Tue, 1 Mar 2016 10:06:47 -0700">&lt;p&gt;Commit 1734d03eb9f92d53f99b5652e239064519e1ba79 in lucene-solr's branch refs/heads/jira/&lt;a href="https://issues.apache.org/jira/browse/SOLR-445" title="Update Handlers abort with bad documents" class="issue-link" data-issue-key="SOLR-445"&gt;&lt;del&gt;SOLR-445&lt;/del&gt;&lt;/a&gt; from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=1734d03" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=1734d03&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8698" title="params.json should have a way to specify appends and invariants" class="issue-link" data-issue-key="SOLR-8698"&gt;&lt;del&gt;SOLR-8698&lt;/del&gt;&lt;/a&gt;: changes the example config to reflect the new behavior&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12789005" name="SOLR-8698.patch" size="25122" author="noble.paul" created="Mon, 22 Feb 2016 07:07:56 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 22 Feb 2016 15:18:32 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2t13j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8697] Fix LeaderElector issues</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8697</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;This patch is still somewhat WIP for a couple of reasons:&lt;/p&gt;

&lt;p&gt;1) Still debugging test failures.&lt;br/&gt;
2) This will more scrutiny from knowledgable folks!&lt;/p&gt;

&lt;p&gt;There are some subtle bugs with the current implementation of LeaderElector, best demonstrated by the following test:&lt;/p&gt;

&lt;p&gt;1) Start up a small single-node solrcloud.  it should be become Overseer.&lt;br/&gt;
2) kill -9 the solrcloud process and immediately start a new one.&lt;br/&gt;
3) The new process won't become overseer.  The old process's ZK leader elect node has not yet disappeared, and the new process fails to set appropriate watches.&lt;/p&gt;

&lt;p&gt;NOTE: this is only reproducible if the new node is able to start up and join the election quickly.&lt;/p&gt;</description>
                <environment/>
        <key id="12940265">SOLR-8697</key>
            <summary>Fix LeaderElector issues</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="markrmiller@gmail.com">Mark Miller</assignee>
                                    <reporter username="dragonsinth">Scott Blum</reporter>
                        <labels>
                            <label>patch</label>
                            <label>reliability</label>
                            <label>solrcloud</label>
                    </labels>
                <created>Thu, 18 Feb 2016 12:54:18 -0700</created>
                <updated>Thu, 21 Apr 2016 14:12:12 -0700</updated>
                            <resolved>Thu, 21 Apr 2016 14:12:12 -0700</resolved>
                                    <version>5.4.1</version>
                                    <fixVersion>5.5.1</fixVersion>
                    <fixVersion>6.0</fixVersion>
                    <fixVersion>master</fixVersion>
                                    <component>SolrCloud</component>
                        <due/>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="15152995" author="dragonsinth" created="Thu, 18 Feb 2016 13:06:54 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalinmangar" class="user-hover" rel="shalinmangar"&gt;Shalin Shekhar Mangar&lt;/a&gt; &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickerickson" class="user-hover" rel="erickerickson"&gt;Erick Erickson&lt;/a&gt; &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com" class="user-hover" rel="markrmiller@gmail.com"&gt;Mark Miller&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15153011" author="markrmiller@gmail.com" created="Thu, 18 Feb 2016 13:17:39 -0700">&lt;blockquote&gt;&lt;p&gt;The old process's ZK leader elect node has not yet disappeared, and the new process fails to set appropriate watches.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I thought we waited for a while for the old one to go away...is that missing in the Overseer election code and just in the shard election code?&lt;/p&gt;</comment>
                            <comment id="15153048" author="dragonsinth" created="Thu, 18 Feb 2016 13:41:08 -0700">&lt;p&gt;TBH, the code is pretty hard to follow in its existing form, and a lot of the theory of operation and design is difficult to distill.  There is code that looks like it's trying to do what you're talking about, but it's buggy.&lt;/p&gt;

&lt;p&gt;Take this analysis with like 70% confidence: The existing code has a very hazy definition of "myself" and "previous registration", from what I can tell.  The previous elect node from a different process qualifies as "myself" in some cases, so the new process thinks it's already registered when it's not.&lt;/p&gt;</comment>
                            <comment id="15153294" author="dragonsinth" created="Thu, 18 Feb 2016 15:52:46 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com" class="user-hover" rel="markrmiller@gmail.com"&gt;Mark Miller&lt;/a&gt; &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickerickson" class="user-hover" rel="erickerickson"&gt;Erick Erickson&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I think there is a potential problem with how OverseerTest is constructed, that perhaps caused us to write some code into LeaderElector in the past that doesn't make any sense for live code.&lt;/p&gt;

&lt;p&gt;I'm looking at the implementation of MockZkController.publishState() (it's kind of a beast) and I notice that when it creates an ElectionContext, it never actually adds it to the map, checks whether one already exists, etc.  As a result, MockZkController does something the real ZkController never does &amp;#8211; it tries to register two different election contexts for the same core on the same ZK session.&lt;/p&gt;

&lt;p&gt;My question is, what's the right fix?  I can either make MockZkController not setup a new electionContext on subsequent invocations, or I could make it simply cancel the previous election context before creating a new one.&lt;/p&gt;</comment>
                            <comment id="15153418" author="dragonsinth" created="Thu, 18 Feb 2016 17:16:37 -0700">&lt;p&gt;Found another bug in ShardLeaderElectionContextBase.&lt;/p&gt;

&lt;p&gt;cancelElection() and runLeaderProcess() can race with each other.  If the local process is trying to cancel right as it becomes leader, cancelElection() won't see a leaderZkNodeParentVersion yet, so it won't try to delete the leader registration.  Meanwhile, runLeaderProcess() still succeeds in creating the leader registration.  The call to super.cancelElection() does remove us from the queue, but the dead leader registration is left there.&lt;/p&gt;

&lt;p&gt;I think moving the call to super.cancelElection() to the start of ShardLeaderElectionContextBase.cancelElection() should resolve the race, because actually removing the election node will cause the multi to fail with a NoNode rather than a NodeExists, and it won't get stuck in a retry loop.&lt;/p&gt;</comment>
                            <comment id="15154618" author="dragonsinth" created="Fri, 19 Feb 2016 11:37:11 -0700">&lt;p&gt;Okay, all the tests are passing now, I think this is ready for review.&lt;/p&gt;</comment>
                            <comment id="15154740" author="markrmiller@gmail.com" created="Fri, 19 Feb 2016 12:44:17 -0700">&lt;blockquote&gt;&lt;p&gt;TBH, the code is pretty hard to follow in its existing form&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yup. It was mildly hairy in its first form (copying the ZK recipe as described) and took a while to harden. Then some contributions came that just made it insane to follow. I've brought it up before, instead of trying to avoid thundering herd issues with what will be a reasonably low number of replicas trying to be leader, we probably should just have very simple leader elections. All of the original logic, and the logic that was added that made it really hard for me to follow, would be really simple if we gave up the cool elegant approach we used to avoid a mostly non existent thundering herd issue. That thicket is just a ripe breeding ground for random bugs our tests just don't easily expose.&lt;/p&gt;

&lt;p&gt;At this point, the effort to change reliably is probably really high though.&lt;/p&gt;</comment>
                            <comment id="15154817" author="dragonsinth" created="Fri, 19 Feb 2016 13:30:14 -0700">&lt;p&gt;I think part of the general problem with a lot of the ZK-interacting code is a lack of clean separation of concerns.  The relationships between LeaderElector and the various ElectionContext subclasses are pretty gnarly and incestuous.  DistributedQueue had a similar kind of design problem before I extracted the app specific gnarly parts into OverseerTaskQueue.&lt;/p&gt;

&lt;p&gt;Have we considered trying to migrate to, say, Apache Curator (full disclosure: I'm a committer)?  There are a lot of advantages to using third party libs for some of these common patterns like distributed queue, leader election, or even observing changes in a tree.  Those components tend to be reusable, better documented, with cleaner APIs, and have a natural resistance to spaghetti invasion.  (Examples: OverseerNodePrioritizer and RebalanceLeaders are intricately tied to implementation details of LeaderElector.)&lt;/p&gt;

&lt;p&gt;A clean, reusable leader election component (with its own tests) that could simply be used in a few different contexts seems like a good place to be longer term.&lt;/p&gt;

&lt;p&gt;That said, I hope this patch can simply clean up some up the existing bugs without being too disruptive.&lt;/p&gt;</comment>
                            <comment id="15154833" author="markrmiller@gmail.com" created="Fri, 19 Feb 2016 13:42:04 -0700">&lt;p&gt;Curator has come up before. Personally, I have not wanted to try and mimic what we have or go through a protracted hardening process again. This stuff is all very touchy, and our tests def do not catch everything, so a rip and replace at that low level would be both very difficult and sure to introduce a lot of issues.&lt;/p&gt;

&lt;p&gt;I think a lot of the problem is that devs like to favor just tossing crap on top of what exists, rather than trying to wholistically move the design forward or make it right for what they want to add (Examples: OverseerNodePrioritizer and RebalanceLeaders - which also made the election code much more dense). I feel a lot of "let's just make this work". I can't tell you how surprised I've been that some devs have come and built so much on some of the prototype code I initially laid out. I've always thought, how do you build so much on this without finding/fixing more core bugs and seeing other necessary improvements more things as you go? Not that it doesn't happen, but the scale has historically been way below what I think makes sense. Easy for me to say I guess. Anyway, it's great that you have already filed a bunch of issues &lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/smile.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt;&lt;/p&gt;

&lt;p&gt;I'd rather focus on some refactoring than bringing in curator though. The implications of that would be pretty large and we have plenty of other more pressing issues I think.&lt;/p&gt;</comment>
                            <comment id="15154853" author="markrmiller@gmail.com" created="Fri, 19 Feb 2016 13:55:38 -0700">&lt;blockquote&gt;&lt;p&gt;full disclosure: I'm a committer&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;And you worked on GWT! Awesome. Have not used it in years, still madly in love with GWT.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;using third party libs &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We may have started with curator but when we started (query side of SolrCloud was 2009 or 2010?) it was not around or we did not know about it back then if it was.&lt;/p&gt;</comment>
                            <comment id="15154888" author="dragonsinth" created="Fri, 19 Feb 2016 14:22:44 -0700">&lt;p&gt;Yeah, totally agreed on refactoring and trying to fix core bugs!  Bringing in Curator at some point would be something I'd only advocate for incrementally and in pieces, like replace our DQ with Curator's, etc.  Moving everything over at in a short period of time would be a pipe dream anyway.&lt;/p&gt;

&lt;p&gt;Back on the topic of LeaderElector, I think this patch is in a pretty good state now.  The only thing I want to consider doing in the short term (after this patch) is that, in addition to watching the node ahead of you, I think we should also be watching our own node, whether or not we're leader.  If an outside party forcibly deletes our node, we should put ourselves at the back of the line.  If you think about it, if we could trust that behavior, something like RebalanceLeaders wouldn't even need to be a distributed request; overseer could just delete the current leader elect node and trust the owner to do the right thing.&lt;/p&gt;</comment>
                            <comment id="15154919" author="markrmiller@gmail.com" created="Fri, 19 Feb 2016 14:44:27 -0700">&lt;p&gt;You can leave the old patches by the way. We tend to leave the history and just pull the latest patch with the same file name.&lt;/p&gt;</comment>
                            <comment id="15154939" author="markrmiller@gmail.com" created="Fri, 19 Feb 2016 14:54:50 -0700">&lt;blockquote&gt;&lt;p&gt;Bringing in Curator at some point would be something I'd only advocate for incrementally and in pieces, like replace our DQ with Curator's, etc.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yeah, I suppose if we had some consensus to push it forward over time, that's a viable option.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;If an outside party forcibly deletes our node, we should put ourselves at the back of the line.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yeah, that sounds like an interesting improvement. Much nicer than making a bunch of distrib calls.&lt;/p&gt;</comment>
                            <comment id="15154950" author="markrmiller@gmail.com" created="Fri, 19 Feb 2016 15:02:01 -0700">&lt;p&gt;FYI, we are in a special little place where we can break back compat and don't have to consider rolling upgrades because the next release is 6.0. We don't have much time before 6.0 branches though I think.&lt;/p&gt;

&lt;p&gt;Patch looks good to me. Others should take a look as well, but I'll commit to get Jenkins cranking on it.&lt;/p&gt;</comment>
                            <comment id="15154965" author="jira-bot" created="Fri, 19 Feb 2016 15:07:05 -0700">&lt;p&gt;Commit 9418369b46586818467109e482b70ba41e90d4ed in lucene-solr's branch refs/heads/master from markrmiller&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9418369" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9418369&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8697" title="Fix LeaderElector issues" class="issue-link" data-issue-key="SOLR-8697"&gt;&lt;del&gt;SOLR-8697&lt;/del&gt;&lt;/a&gt;: Scope ZK election nodes by session to prevent elections from interfering with each other and other small LeaderElector improvements.&lt;/p&gt;</comment>
                            <comment id="15154976" author="markrmiller@gmail.com" created="Fri, 19 Feb 2016 15:11:55 -0700">&lt;blockquote&gt;&lt;p&gt;cancelElection() and runLeaderProcess() can race with each other. If the local process is trying to cancel right as it becomes leader, cancelElection() won't see a leaderZkNodeParentVersion yet, so it won't try to delete the leader registration. Meanwhile, runLeaderProcess() still succeeds in creating the leader registration. The call to super.cancelElection() does remove us from the queue, but the dead leader registration is left there.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Any thoughts on why the existing stress tests for leader election can't catch this? Can we beef something up?&lt;/p&gt;</comment>
                            <comment id="15154993" author="dragonsinth" created="Fri, 19 Feb 2016 15:22:24 -0700">&lt;p&gt;Actually OverseerTest.testShardLeaderChange() DID catch this race for me.  But only rarely.  Debugging that flake is how I uncovered the race.&lt;/p&gt;</comment>
                            <comment id="15154996" author="markrmiller@gmail.com" created="Fri, 19 Feb 2016 15:25:07 -0700">&lt;p&gt;Okay, good, but then was it after your changes? I don't recall seeing that test fail in a long, long time on our Jenkins 'cluster', and that's a bunch of machines running the tests continuously. I also don't recall it locally.&lt;/p&gt;</comment>
                            <comment id="15155203" author="dragonsinth" created="Fri, 19 Feb 2016 17:22:00 -0700">&lt;p&gt;I think it's such a subtle race, that it would only generally show up with code changes-- but as little as changing logging could trigger it / not trigger it.  So it might have been beaten into a state where it happened to work unless you breathed on it.  Drove me nuts for the longest time debugging it until I stumbled on the race. &lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/biggrin.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt;&lt;/p&gt;</comment>
                            <comment id="15159525" author="markrmiller@gmail.com" created="Tue, 23 Feb 2016 12:46:49 -0700">&lt;p&gt;Note: Have not seen any fails like this in this test in a long, long time so may be related to this change. Perhaps just a test issue, because this retries for like 60 seconds or something.&lt;/p&gt;

&lt;div class="preformatted panel" style="border-width: 1px;"&gt;&lt;div class="preformattedContent panelContent"&gt;
&lt;pre&gt;   [junit4] ERROR   66.3s J4  | OverseerTest.testShardLeaderChange &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: org.apache.solr.common.SolrException: Could not register as the leader because creating the ephemeral registration node in ZooKeeper failed
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([C4618609907C7E14:1A3201FE8AE48BE5]:0)
   [junit4]    &amp;gt; 	at org.apache.solr.cloud.ShardLeaderElectionContextBase.runLeaderProcess(ElectionContext.java:212)
   [junit4]    &amp;gt; 	at org.apache.solr.cloud.LeaderElector.runIamLeaderProcess(LeaderElector.java:173)
   [junit4]    &amp;gt; 	at org.apache.solr.cloud.LeaderElector.checkIfIamLeader(LeaderElector.java:138)
   [junit4]    &amp;gt; 	at org.apache.solr.cloud.LeaderElector.joinElection(LeaderElector.java:310)
   [junit4]    &amp;gt; 	at org.apache.solr.cloud.LeaderElector.joinElection(LeaderElector.java:219)
   [junit4]    &amp;gt; 	at org.apache.solr.cloud.OverseerTest$MockZKController.publishState(OverseerTest.java:181)
   [junit4]    &amp;gt; 	at org.apache.solr.cloud.OverseerTest.testShardLeaderChange(OverseerTest.java:841)
   [junit4]    &amp;gt; 	at java.lang.Thread.run(Thread.java:745)
   [junit4]    &amp;gt; Caused by: org.apache.zookeeper.KeeperException$NodeExistsException: KeeperErrorCode = NodeExists
   [junit4]    &amp;gt; 	at org.apache.zookeeper.KeeperException.create(KeeperException.java:119)
   [junit4]    &amp;gt; 	at org.apache.zookeeper.ZooKeeper.multiInternal(ZooKeeper.java:949)
   [junit4]    &amp;gt; 	at org.apache.zookeeper.ZooKeeper.multi(ZooKeeper.java:915)
   [junit4]    &amp;gt; 	at org.apache.solr.common.cloud.SolrZkClient$11.execute(SolrZkClient.java:577)
   [junit4]    &amp;gt; 	at org.apache.solr.common.cloud.SolrZkClient$11.execute(SolrZkClient.java:574)
   [junit4]    &amp;gt; 	at org.apache.solr.common.cloud.ZkCmdExecutor.retryOperation(ZkCmdExecutor.java:60)
   [junit4]    &amp;gt; 	at org.apache.solr.common.cloud.SolrZkClient.multi(SolrZkClient.java:574)
   [junit4]    &amp;gt; 	at org.apache.solr.cloud.ShardLeaderElectionContextBase$1.execute(ElectionContext.java:195)
   [junit4]    &amp;gt; 	at org.apache.solr.common.util.RetryUtil.retryOnThrowable(RetryUtil.java:49)
   [junit4]    &amp;gt; 	at org.apache.solr.common.util.RetryUtil.retryOnThrowable(RetryUtil.java:42)
   [junit4]    &amp;gt; 	at org.apache.solr.cloud.ShardLeaderElectionContextBase.runLeaderProcess(ElectionContext.java:178)
   [junit4]    &amp;gt; 	... 45 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15159537" author="dragonsinth" created="Tue, 23 Feb 2016 12:52:50 -0700">&lt;p&gt;I'll take a look.  I ran into this before on account of the test code doing a couple of questionable things.&lt;/p&gt;

&lt;p&gt;1) Re-using the same ZK session for multiple election contexts on the same election.  I fixed that one in my patch.&lt;/p&gt;

&lt;p&gt;2) Not deleting the registration on cancel.  I didn't bother fixing this one, since I figured eventually the session timeout would kill all the ephemeral nodes, making for a more thorough test.  But explicitly deleting the registration would speed the test up and make it more reliable, probably.&lt;/p&gt;

&lt;p&gt;Thoughts?&lt;/p&gt;</comment>
                            <comment id="15159554" author="markrmiller@gmail.com" created="Tue, 23 Feb 2016 13:00:50 -0700">&lt;p&gt;Here is the log file just in case.&lt;/p&gt;</comment>
                            <comment id="15159562" author="markrmiller@gmail.com" created="Tue, 23 Feb 2016 13:05:57 -0700">&lt;blockquote&gt;&lt;p&gt;deleting the registration on cancel.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1.&lt;/p&gt;</comment>
                            <comment id="15159589" author="dragonsinth" created="Tue, 23 Feb 2016 13:29:28 -0700">&lt;p&gt;Attached a followup patch that cancels previous elections when the MockZkController is closed.  I haven't actually been able to get OverseerTest.testShardLeaderChange() to flake on my machine, with or without the change, even running like 100 iterations.  But &lt;/p&gt;</comment>
                            <comment id="15159597" author="markrmiller@gmail.com" created="Tue, 23 Feb 2016 13:34:00 -0700">&lt;blockquote&gt;&lt;p&gt;, even running like 100 iterations.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Unfortunately, that is common. The tests are run in a wicked diverse set of envs. We see stuff from the jenkins cluster no dev ever seems to hit. &lt;/p&gt;

&lt;p&gt;A lot of fails only pop when running with other tests to also bog down the system, and you won't see the issue with that test in isolation, and then you can configure different numbers of tests to run at the same time (I do 10 on my 6 core machine), and the different levels of hardware...&lt;/p&gt;

&lt;p&gt;Some things are pretty hard to replicate locally.&lt;/p&gt;</comment>
                            <comment id="15159610" author="dragonsinth" created="Tue, 23 Feb 2016 13:42:49 -0700">&lt;p&gt;Actually, I'm stupid.  The flaky problem is that I &lt;b&gt;still&lt;/b&gt; didn't fix the race regarding leaderZkNodeParentVersion.  I just made it harder to repro.&lt;/p&gt;

&lt;p&gt;The smoking gun is this line:&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
      log.info(&lt;span class="code-quote"&gt;"No version found &lt;span class="code-keyword"&gt;for&lt;/span&gt; ephemeral leader parent node, won't remove previous leader registration."&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You can repro this pretty easily with the following change:&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;

 -- a/solr/core/src/java/org/apache/solr/cloud/ElectionContext.java
 ++ b/solr/core/src/java/org/apache/solr/cloud/ElectionContext.java

@@ -193,7 +193,7 @@ class ShardLeaderElectionContextBase &lt;span class="code-keyword"&gt;extends&lt;/span&gt; ElectionContext {
           List&amp;lt;OpResult&amp;gt; results;
           
           results = zkClient.multi(ops, &lt;span class="code-keyword"&gt;true&lt;/span&gt;);
           
           &lt;span class="code-object"&gt;Thread&lt;/span&gt;.sleep(10000);
           &lt;span class="code-keyword"&gt;for&lt;/span&gt; (OpResult result : results) {
             &lt;span class="code-keyword"&gt;if&lt;/span&gt; (result.getType() == ZooDefs.OpCode.setData) {
               SetDataResult dresult = (SetDataResult) result;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We need a harder synchronization around becoming leader vs. canceling.&lt;/p&gt;</comment>
                            <comment id="15159632" author="dragonsinth" created="Tue, 23 Feb 2016 13:54:36 -0700">&lt;p&gt;Attached a patch with real synchronization.  99% sure this will fix the observed flake.&lt;br/&gt;
I also included the MockZKController.close() election cancel change, I think it's a good cleanup but not related to the flake.&lt;/p&gt;</comment>
                            <comment id="15163535" author="dragonsinth" created="Wed, 24 Feb 2016 12:05:12 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com" class="user-hover" rel="markrmiller@gmail.com"&gt;Mark Miller&lt;/a&gt; should I open a separate jira for the follow on patch?&lt;/p&gt;</comment>
                            <comment id="15163597" author="markrmiller@gmail.com" created="Wed, 24 Feb 2016 12:47:04 -0700">&lt;p&gt;No, we only open a new issue if this one has gone out in a release, otherwise we can keep iterating as needed in the same issue. A bit busy, but I'll get to this soon.&lt;/p&gt;</comment>
                            <comment id="15169379" author="jira-bot" created="Fri, 26 Feb 2016 10:32:26 -0700">&lt;p&gt;Commit efb7bb171b22a3c6a00d30eefe935a0024df0c71 in lucene-solr's branch refs/heads/master from markrmiller&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=efb7bb1" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=efb7bb1&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8697" title="Fix LeaderElector issues" class="issue-link" data-issue-key="SOLR-8697"&gt;&lt;del&gt;SOLR-8697&lt;/del&gt;&lt;/a&gt;: Add synchronization around registering as leader and canceling.&lt;/p&gt;</comment>
                            <comment id="15170408" author="jira-bot" created="Sat, 27 Feb 2016 00:06:28 -0700">&lt;p&gt;Commit c2bc93822d73b66c74ed998ea6c57a3cce05af44 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalinmangar" class="user-hover" rel="shalinmangar"&gt;Shalin Shekhar Mangar&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c2bc938" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c2bc938&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8697" title="Fix LeaderElector issues" class="issue-link" data-issue-key="SOLR-8697"&gt;&lt;del&gt;SOLR-8697&lt;/del&gt;&lt;/a&gt;: Fix precommit failure&lt;/p&gt;</comment>
                            <comment id="15252315" author="anshumg" created="Thu, 21 Apr 2016 10:47:54 -0700">&lt;p&gt;Reopening to back port for 5.5.1&lt;/p&gt;</comment>
                            <comment id="15252648" author="jira-bot" created="Thu, 21 Apr 2016 13:39:36 -0700">&lt;p&gt;Commit 0dabbadb4dbdabbad4da06a49e2eebd908a4cd62 in lucene-solr's branch refs/heads/branch_5x from markrmiller&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=0dabbad" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=0dabbad&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8697" title="Fix LeaderElector issues" class="issue-link" data-issue-key="SOLR-8697"&gt;&lt;del&gt;SOLR-8697&lt;/del&gt;&lt;/a&gt;: Scope ZK election nodes by session to prevent elections from interfering with each other and other small LeaderElector improvements.&lt;/p&gt;</comment>
                            <comment id="15252649" author="jira-bot" created="Thu, 21 Apr 2016 13:39:38 -0700">&lt;p&gt;Commit d08169e6f6355d9023779cac1303ab48fe2c86e0 in lucene-solr's branch refs/heads/branch_5x from markrmiller&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d08169e" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d08169e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8697" title="Fix LeaderElector issues" class="issue-link" data-issue-key="SOLR-8697"&gt;&lt;del&gt;SOLR-8697&lt;/del&gt;&lt;/a&gt;: Add synchronization around registering as leader and canceling.&lt;/p&gt;</comment>
                            <comment id="15252650" author="jira-bot" created="Thu, 21 Apr 2016 13:39:39 -0700">&lt;p&gt;Commit 4b42c77ac6b045dce914d2244298cd0fea5300e4 in lucene-solr's branch refs/heads/branch_5x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalinmangar" class="user-hover" rel="shalinmangar"&gt;Shalin Shekhar Mangar&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=4b42c77" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=4b42c77&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8697" title="Fix LeaderElector issues" class="issue-link" data-issue-key="SOLR-8697"&gt;&lt;del&gt;SOLR-8697&lt;/del&gt;&lt;/a&gt;: Fix precommit failure&lt;/p&gt;</comment>
                            <comment id="15252750" author="jira-bot" created="Thu, 21 Apr 2016 14:11:42 -0700">&lt;p&gt;Commit f8dd98f93b75ff774fd81c3a44d551d204676b94 in lucene-solr's branch refs/heads/branch_5_5 from markrmiller&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f8dd98f" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f8dd98f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8697" title="Fix LeaderElector issues" class="issue-link" data-issue-key="SOLR-8697"&gt;&lt;del&gt;SOLR-8697&lt;/del&gt;&lt;/a&gt;: Scope ZK election nodes by session to prevent elections from interfering with each other and other small LeaderElector improvements.&lt;/p&gt;</comment>
                            <comment id="15252751" author="jira-bot" created="Thu, 21 Apr 2016 14:11:44 -0700">&lt;p&gt;Commit 78bed536984dbfd4ba2f802deb58b29979d59329 in lucene-solr's branch refs/heads/branch_5_5 from markrmiller&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=78bed53" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=78bed53&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8697" title="Fix LeaderElector issues" class="issue-link" data-issue-key="SOLR-8697"&gt;&lt;del&gt;SOLR-8697&lt;/del&gt;&lt;/a&gt;: Add synchronization around registering as leader and canceling.&lt;/p&gt;</comment>
                            <comment id="15252752" author="jira-bot" created="Thu, 21 Apr 2016 14:11:45 -0700">&lt;p&gt;Commit f6fca6901665cab4bea078baa4350ddc8964a2cf in lucene-solr's branch refs/heads/branch_5_5 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalinmangar" class="user-hover" rel="shalinmangar"&gt;Shalin Shekhar Mangar&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f6fca69" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f6fca69&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8697" title="Fix LeaderElector issues" class="issue-link" data-issue-key="SOLR-8697"&gt;&lt;del&gt;SOLR-8697&lt;/del&gt;&lt;/a&gt;: Fix precommit failure&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12949697">SOLR-8837</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12789290" name="OverseerTestFail.log" size="639890" author="markrmiller@gmail.com" created="Tue, 23 Feb 2016 13:00:50 -0700"/>
                            <attachment id="12789305" name="SOLR-8697-followup.patch" size="8777" author="dragonsinth" created="Tue, 23 Feb 2016 13:53:39 -0700"/>
                            <attachment id="12788725" name="SOLR-8697.patch" size="9602" author="dragonsinth" created="Fri, 19 Feb 2016 11:36:36 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 18 Feb 2016 20:17:39 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    <customfieldvalue key="10431"><![CDATA[Important]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2t0sv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8694] DistributedMap/Queue simplifications and fixes.</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8694</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Bugfix in DistributedQueue, it could add too many watchers since it assumed the watcher was cleared on connection events.&lt;/p&gt;

&lt;p&gt;Huge simplification to DistributedMap; it implemented a lot of tricky stuff that no one is actually using.&lt;/p&gt;</description>
                <environment/>
        <key id="12940251">SOLR-8694</key>
            <summary>DistributedMap/Queue simplifications and fixes.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dragonsinth">Scott Blum</assignee>
                                    <reporter username="dragonsinth">Scott Blum</reporter>
                        <labels>
                            <label>patch</label>
                            <label>reliability</label>
                    </labels>
                <created>Thu, 18 Feb 2016 12:19:00 -0700</created>
                <updated>Thu, 21 Apr 2016 11:57:49 -0700</updated>
                            <resolved>Wed, 20 Apr 2016 17:29:46 -0700</resolved>
                                    <version>5.4.1</version>
                                    <fixVersion>5.5.1</fixVersion>
                    <fixVersion>5.6</fixVersion>
                    <fixVersion>6.0</fixVersion>
                    <fixVersion>master</fixVersion>
                                    <component>SolrCloud</component>
                        <due/>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="15152924" author="dragonsinth" created="Thu, 18 Feb 2016 12:23:43 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalinmangar" class="user-hover" rel="shalinmangar"&gt;Shalin Shekhar Mangar&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15154658" author="markrmiller@gmail.com" created="Fri, 19 Feb 2016 11:51:55 -0700">&lt;p&gt;Nice catch! We should audit all our Watcher process methods for this. It's been awhile since we did. &lt;/p&gt;

&lt;p&gt;Bummer, doesn't look like any explicit tests already exist for this class to build on and try and catch this.&lt;/p&gt;</comment>
                            <comment id="15154661" author="dragonsinth" created="Fri, 19 Feb 2016 11:54:57 -0700">&lt;p&gt;I did audit all the Watcher process methods. &lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/smile.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt;&lt;br/&gt;
&lt;a href="https://issues.apache.org/jira/browse/SOLR-8695" class="external-link" rel="nofollow"&gt;https://issues.apache.org/jira/browse/SOLR-8695&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15154745" author="jira-bot" created="Fri, 19 Feb 2016 12:47:22 -0700">&lt;p&gt;Commit 32fbca6ea7b65043041e622660e07915f04090fe in lucene-solr's branch refs/heads/master from markrmiller&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=32fbca6" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=32fbca6&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8694" title="DistributedMap/Queue simplifications and fixes." class="issue-link" data-issue-key="SOLR-8694"&gt;&lt;del&gt;SOLR-8694&lt;/del&gt;&lt;/a&gt;: DistributedMap/Queue can create too many Watchers and some code simplification.&lt;/p&gt;</comment>
                            <comment id="15154749" author="markrmiller@gmail.com" created="Fri, 19 Feb 2016 12:48:06 -0700">&lt;p&gt;Thanks Scott!&lt;/p&gt;</comment>
                            <comment id="15248875" author="anshumg" created="Tue, 19 Apr 2016 16:11:35 -0700">&lt;p&gt;Reopening to back port for 5.5.1&lt;/p&gt;</comment>
                            <comment id="15249050" author="dragonsinth" created="Tue, 19 Apr 2016 17:44:48 -0700">&lt;p&gt;I have a compatible patch if you'd like me to take this one as well.&lt;/p&gt;</comment>
                            <comment id="15250935" author="dragonsinth" created="Wed, 20 Apr 2016 16:28:05 -0700">&lt;p&gt;In progress.&lt;/p&gt;</comment>
                            <comment id="15250999" author="jira-bot" created="Wed, 20 Apr 2016 17:16:34 -0700">&lt;p&gt;Commit bbae36aa92c58cdbe031ea447bcbd9ae66f5138c in lucene-solr's branch refs/heads/branch_5x from markrmiller&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=bbae36a" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=bbae36a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8694" title="DistributedMap/Queue simplifications and fixes." class="issue-link" data-issue-key="SOLR-8694"&gt;&lt;del&gt;SOLR-8694&lt;/del&gt;&lt;/a&gt;: DistributedMap/Queue can create too many Watchers and some code simplification.&lt;/p&gt;</comment>
                            <comment id="15251004" author="jira-bot" created="Wed, 20 Apr 2016 17:19:01 -0700">&lt;p&gt;Commit 6d3402188d3b7e2e12fc27d98d643a87feffa147 in lucene-solr's branch refs/heads/branch_5_5 from markrmiller&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=6d34021" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=6d34021&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8694" title="DistributedMap/Queue simplifications and fixes." class="issue-link" data-issue-key="SOLR-8694"&gt;&lt;del&gt;SOLR-8694&lt;/del&gt;&lt;/a&gt;: DistributedMap/Queue can create too many Watchers and some code simplification.&lt;/p&gt;</comment>
                            <comment id="15252397" author="jira-bot" created="Thu, 21 Apr 2016 11:23:42 -0700">&lt;p&gt;Commit 244649bc74b204b9e595607e877f9913abee28dc in lucene-solr's branch refs/heads/branch_5x from markrmiller&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=244649bc" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=244649bc&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8694" title="DistributedMap/Queue simplifications and fixes." class="issue-link" data-issue-key="SOLR-8694"&gt;&lt;del&gt;SOLR-8694&lt;/del&gt;&lt;/a&gt;: DistributedMap/Queue can create too many Watchers and some code simplification.&lt;/p&gt;</comment>
                            <comment id="15252408" author="anshumg" created="Thu, 21 Apr 2016 11:27:44 -0700">&lt;p&gt;Seems like a wrong commit got tagged here. It's just some formatting fix in CHANGES.txt so should be fine.&lt;/p&gt;</comment>
                            <comment id="15252467" author="jira-bot" created="Thu, 21 Apr 2016 11:57:49 -0700">&lt;p&gt;Commit 0e69a562857da9fc68cfc104bddfdea4c493476f in lucene-solr's branch refs/heads/branch_5_5 from markrmiller&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=0e69a56" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=0e69a56&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8694" title="DistributedMap/Queue simplifications and fixes." class="issue-link" data-issue-key="SOLR-8694"&gt;&lt;del&gt;SOLR-8694&lt;/del&gt;&lt;/a&gt;: DistributedMap/Queue can create too many Watchers and some code simplification.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12940255">SOLR-8695</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12788499" name="SOLR-8694.patch" size="12611" author="dragonsinth" created="Thu, 18 Feb 2016 12:23:43 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 19 Feb 2016 18:51:55 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2t0pr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8692] Move out embedded  json in ConfigOverlay and RuleBasedAuthorizationPlugin </title>
                <link>https://issues.apache.org/jira/browse/SOLR-8692</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description/>
                <environment/>
        <key id="12940225">SOLR-8692</key>
            <summary>Move out embedded  json in ConfigOverlay and RuleBasedAuthorizationPlugin </summary>
                <type id="3" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/task.png">Task</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="noble.paul">Noble Paul</assignee>
                                    <reporter username="noble.paul">Noble Paul</reporter>
                        <labels>
                    </labels>
                <created>Thu, 18 Feb 2016 11:17:15 -0700</created>
                <updated>Mon, 22 Feb 2016 16:21:34 -0700</updated>
                            <resolved>Thu, 18 Feb 2016 16:19:48 -0700</resolved>
                                                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="15152791" author="noble.paul" created="Thu, 18 Feb 2016 11:32:03 -0700">&lt;p&gt; Moves the json to individual json files in the core/src/resources dir&lt;/p&gt;</comment>
                            <comment id="15153305" author="jira-bot" created="Thu, 18 Feb 2016 16:01:30 -0700">&lt;p&gt;Commit 8bcac81a219f685ea2e92901e9bec05954de90df in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=8bcac81" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=8bcac81&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8692" title="Move out embedded  json in ConfigOverlay and RuleBasedAuthorizationPlugin " class="issue-link" data-issue-key="SOLR-8692"&gt;&lt;del&gt;SOLR-8692&lt;/del&gt;&lt;/a&gt; moved the embedded json out to resources dir&lt;/p&gt;</comment>
                            <comment id="15157929" author="jira-bot" created="Mon, 22 Feb 2016 16:19:15 -0700">&lt;p&gt;Commit eeee1c3f407f8a77132fcd43fd56ac8e3b9ce4db in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe" class="user-hover" rel="steve_rowe"&gt;Steve Rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=eeee1c3" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=eeee1c3&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8692" title="Move out embedded  json in ConfigOverlay and RuleBasedAuthorizationPlugin " class="issue-link" data-issue-key="SOLR-8692"&gt;&lt;del&gt;SOLR-8692&lt;/del&gt;&lt;/a&gt;: Deal with the new solr/core/src/resources/ dir: 1) add Maven config; and 2) improve IntelliJ config by using a new content root in solr-core module pointing to the resources dir, rather than using module-library declarations in the solr-core, solr-core-tests and solrj modules.&lt;/p&gt;</comment>
                            <comment id="15157931" author="noble.paul" created="Mon, 22 Feb 2016 16:21:34 -0700">&lt;p&gt;thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe" class="user-hover" rel="steve_rowe"&gt;Steve Rowe&lt;/a&gt; &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12788486" name="SOLR-8692.patch" size="13320" author="noble.paul" created="Thu, 18 Feb 2016 11:32:03 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 18 Feb 2016 23:01:30 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2t0jz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8677] SOLR allows creation of shards with invalid names.</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8677</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Solr currently has "recommendations" about what constitutes a valid identifier, but doesn't enforce these "recommendations" uniformly.  Core (&lt;a href="https://issues.apache.org/jira/browse/SOLR-8308" title="Core gets inaccessible after RENAME operation with special characters" class="issue-link" data-issue-key="SOLR-8308"&gt;&lt;del&gt;SOLR-8308&lt;/del&gt;&lt;/a&gt;) and collection (&lt;a href="https://issues.apache.org/jira/browse/SOLR-8642" title="SOLR allows creation of collections with invalid names" class="issue-link" data-issue-key="SOLR-8642"&gt;&lt;del&gt;SOLR-8642&lt;/del&gt;&lt;/a&gt;) names are currently checked, but shards aren't.&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
$ bin/solr -e cloud -noprompt
    ....
$ curl -i -l -k -X GET &lt;span class="code-quote"&gt;"http:&lt;span class="code-comment"&gt;//localhost:8983/solr/admin/collections?action=CREATE&amp;amp;name=coll1&amp;amp;router.name=implicit&amp;amp;numShards=1&amp;amp;shards=bad+shard+name"&lt;/span&gt;
&lt;/span&gt;HTTP/1.1 200 OK
Content-Type: application/xml; charset=UTF-8
Transfer-Encoding: chunked

&amp;lt;?xml version=&lt;span class="code-quote"&gt;"1.0"&lt;/span&gt; encoding=&lt;span class="code-quote"&gt;"UTF-8"&lt;/span&gt;?&amp;gt;
&amp;lt;response&amp;gt;
&amp;lt;lst name=&lt;span class="code-quote"&gt;"responseHeader"&lt;/span&gt;&amp;gt;&amp;lt;&lt;span class="code-object"&gt;int&lt;/span&gt; name=&lt;span class="code-quote"&gt;"status"&lt;/span&gt;&amp;gt;0&amp;lt;/&lt;span class="code-object"&gt;int&lt;/span&gt;&amp;gt;&amp;lt;&lt;span class="code-object"&gt;int&lt;/span&gt; name=&lt;span class="code-quote"&gt;"QTime"&lt;/span&gt;&amp;gt;204&amp;lt;/&lt;span class="code-object"&gt;int&lt;/span&gt;&amp;gt;&amp;lt;/lst&amp;gt;&amp;lt;lst name=&lt;span class="code-quote"&gt;"failure"&lt;/span&gt;&amp;gt;&amp;lt;str&amp;gt;org.apache.solr.client.solrj.impl.HttpSolrClient$RemoteSolrException:Error from server at http:&lt;span class="code-comment"&gt;//127.0.1.1:8983/solr: Error CREATEing SolrCore 'coll1_bad shard name_replica1': Unable to create core [coll1_bad shard name_replica1] Caused by: Invalid name: 'coll1_bad shard name_replica1' Identifiers must consist entirely of periods, underscores and alphanumerics&amp;lt;/str&amp;gt;&amp;lt;/lst&amp;gt;
&lt;/span&gt;&amp;lt;/response&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;(Note that the CREATE command above returned 200-OK, and the failure was only apparent when viewing the message.)&lt;/p&gt;

&lt;p&gt;A CLUSTERSTATUS shows that the shard was actually created, but has no underlying cores.&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
$ curl -i -l -k -X GET &lt;span class="code-quote"&gt;"http:&lt;span class="code-comment"&gt;//localhost:8983/solr/admin/collections?action=CLUSTERSTATUS&amp;amp;wt=json&amp;amp;indent=&lt;span class="code-keyword"&gt;true&lt;/span&gt;"&lt;/span&gt;
&lt;/span&gt;...
    &lt;span class="code-quote"&gt;"collections"&lt;/span&gt;:{
      &lt;span class="code-quote"&gt;"coll1"&lt;/span&gt;:{
        &lt;span class="code-quote"&gt;"replicationFactor"&lt;/span&gt;:&lt;span class="code-quote"&gt;"1"&lt;/span&gt;,
        &lt;span class="code-quote"&gt;"shards"&lt;/span&gt;:{&lt;span class="code-quote"&gt;"bad shard name"&lt;/span&gt;:{
            &lt;span class="code-quote"&gt;"range"&lt;/span&gt;:&lt;span class="code-keyword"&gt;null&lt;/span&gt;,
            &lt;span class="code-quote"&gt;"state"&lt;/span&gt;:&lt;span class="code-quote"&gt;"active"&lt;/span&gt;,
            &lt;span class="code-quote"&gt;"replicas"&lt;/span&gt;:{}}},
        &lt;span class="code-quote"&gt;"router"&lt;/span&gt;:{&lt;span class="code-quote"&gt;"name"&lt;/span&gt;:&lt;span class="code-quote"&gt;"implicit"&lt;/span&gt;},
        &lt;span class="code-quote"&gt;"maxShardsPerNode"&lt;/span&gt;:&lt;span class="code-quote"&gt;"1"&lt;/span&gt;,
        &lt;span class="code-quote"&gt;"autoAddReplicas"&lt;/span&gt;:&lt;span class="code-quote"&gt;"&lt;span class="code-keyword"&gt;false&lt;/span&gt;"&lt;/span&gt;,
        &lt;span class="code-quote"&gt;"znodeVersion"&lt;/span&gt;:1,
        &lt;span class="code-quote"&gt;"configName"&lt;/span&gt;:&lt;span class="code-quote"&gt;"gettingstarted"&lt;/span&gt;},
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This JIRA proposes adding a check to ensure that shard names meet SOLR's identifier "recommendations".  This should prevent users from accidentally putting themselves in a bad state.&lt;/p&gt;</description>
                <environment/>
        <key id="12938864">SOLR-8677</key>
            <summary>SOLR allows creation of shards with invalid names.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="4" iconUrl="https://issues.apache.org/jira/images/icons/statuses/reopened.png" description="This issue was once resolved, but the resolution was deemed incorrect. From here issues are either marked assigned or resolved.">Reopened</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="anshumg">Anshum Gupta</assignee>
                                    <reporter username="gerlowskija">Jason Gerlowski</reporter>
                        <labels>
                    </labels>
                <created>Fri, 12 Feb 2016 11:10:27 -0700</created>
                <updated>Tue, 26 Apr 2016 22:23:59 -0700</updated>
                                            <version>master</version>
                                    <fixVersion>6.0</fixVersion>
                    <fixVersion>master</fixVersion>
                                        <due/>
                            <votes>1</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="15144989" author="gerlowskija" created="Fri, 12 Feb 2016 11:13:56 -0700">&lt;p&gt;This check would need to be put in at least two places:&lt;/p&gt;
&lt;ul class="alternate" type="square"&gt;
	&lt;li&gt;the &lt;tt&gt;shards&lt;/tt&gt; parameter of the CREATE collection call.&lt;/li&gt;
	&lt;li&gt;the &lt;tt&gt;shard&lt;/tt&gt; parameter of the CREATESHARD call.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;There may be other places where users can specify the name of a new shard.  These are just the two places I found after a quick look.&lt;/p&gt;

&lt;p&gt;Hoping to upload a patch shortly that can address this behavior.&lt;/p&gt;</comment>
                            <comment id="15145223" author="gerlowskija" created="Fri, 12 Feb 2016 13:19:56 -0700">&lt;p&gt;Attached patch prevents creation of shards with "invalid" names via the CREATESHARD and CREATE APIs.  (There might be other places where shards can be created that I'm not aware of, though I'm reasonably certain I got them all).&lt;/p&gt;

&lt;p&gt;All tests pass locally for me.&lt;/p&gt;</comment>
                            <comment id="15146458" author="shaie" created="Sun, 14 Feb 2016 02:23:51 -0700">&lt;p&gt;Looks good to me. &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gerlowskija" class="user-hover" rel="gerlowskija"&gt;Jason Gerlowski&lt;/a&gt; I know it's not strictly related to this issue, but perhaps we can use the validator in SolrJ too, short-circuiting alias/collection/shard requests before they reach the server?&lt;/p&gt;</comment>
                            <comment id="15146459" author="shaie" created="Sun, 14 Feb 2016 02:24:24 -0700">&lt;p&gt;Also, would u mind adding a CHANGES.txt entry too?&lt;/p&gt;</comment>
                            <comment id="15146604" author="gerlowskija" created="Sun, 14 Feb 2016 08:03:50 -0700">&lt;p&gt;Thanks for the review Shai.  Do you want to see that SolrJ change as a part of this JIRA?  I'd thought about adding that myself, but I had planned on it being its own JIRA, since as you mentioned it's not strictly related.  But if there's no objection to adding it in this patch, I'll just save the overhead and add it here.&lt;/p&gt;</comment>
                            <comment id="15146678" author="shaie" created="Sun, 14 Feb 2016 11:25:41 -0700">&lt;p&gt;I don't mind either way Jason. Either you add it to this patch, and with that finish the collection/alias/shard name restrictions handling, or to a new issue, whatever works for you. I assume both will be released only post 5.5 anyway, and thus together. If you prefer to handle that separately, let me know and I'll add a CHANGES entry before committing this patch.&lt;/p&gt;</comment>
                            <comment id="15146701" author="gerlowskija" created="Sun, 14 Feb 2016 12:44:13 -0700">&lt;p&gt;I'll just roll it into this patch.  Just wanted to make sure I was doing the right thing process-wise before I start in on it.  If it doesn't bother you, it doesn't bother me.&lt;/p&gt;

&lt;p&gt;I'll push up a new revision shortly.&lt;/p&gt;</comment>
                            <comment id="15148602" author="gerlowskija" created="Tue, 16 Feb 2016 06:39:09 -0700">&lt;p&gt;Updated the patch with the changes to SolrJ that Shai suggested.  A few notes:&lt;/p&gt;

&lt;ul class="alternate" type="square"&gt;
	&lt;li&gt;SolrJ now throws an "InvalidIdentifierException" (extends IllegalArgumentException) when an invalid shard/core/collection/alias name is provided.  I wasn't sure whether it's acceptable to add a new thrown exception type, or if SolrJ had conventions around this.  Might be onerous to ask callers to add an additional catch block into their code.  But grepping through SolrJ's code, I saw a variety of exceptions being thrown, so I took that as a sign that I was "in the clear".&lt;/li&gt;
	&lt;li&gt;The existing identifier-validation logic (on the server side) threw a SolrException directly.  This makes sense on the server side, but less so in SolrJ.  So I created a client-side validation class to throw a more appropriate exception (InvalidIdentifierException, as mentioned above).  This obviously means some duplicated code, since the classes are largely the same other than the exception being thrown.  If anyone has suggestions on better ways to structure this, I'd love to hear them.&lt;/li&gt;
	&lt;li&gt;I added tests for the additional SolrJ checks.  I had a hard time finding any tests for the Collection-API related types in SolrJ (CollectionAdminRequest).  So I created a new file for these tests (TestCollectionAdminRequest).  Wanted to mention it, in case tests for those classes do already exist, and I just missed them.  Pretty sure the new file was warranted though.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Hope this covers what you were looking for Shai!&lt;/p&gt;</comment>
                            <comment id="15149447" author="anshumg" created="Tue, 16 Feb 2016 15:30:51 -0700">&lt;p&gt;Thanks Jason. Here's an updated patch.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Refactored the validator to a single class in SolrJ instead and the validation methods now return boolean instead. This allows for throwing the appropriate exception from the calling code.&lt;/li&gt;
	&lt;li&gt;Removed the new Exception to just throw IllegalArgumentException directly.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I didn't have any strong feelings about the new Exception but I didn't find it adding any value so I let go of it. I'm still running the tests but this should be fine I think.&lt;/p&gt;</comment>
                            <comment id="15149451" author="anshumg" created="Tue, 16 Feb 2016 15:34:55 -0700">&lt;blockquote&gt;&lt;p&gt;This obviously means some duplicated code, since the classes are largely the same other than the exception being thrown. If anyone has suggestions on better ways to structure this, I'd love to hear them.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;handled in my last patch.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I created a new file for these tests (TestCollectionAdminRequest). Wanted to mention it, in case tests for those classes do already exist, and I just missed them. Pretty sure the new file was warranted though.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;You've added nice unit tests that don't require SolrCloud bootstrapping, so that's perfect. We can also add more tests to CollectionsAPISolrJTests class but it's not really needed so we're good.&lt;/p&gt;</comment>
                            <comment id="15149540" author="gerlowskija" created="Tue, 16 Feb 2016 17:05:30 -0700">&lt;p&gt;Good changes.  I'd thought about having SolrIdentifierValidator spit out booleans initially, but decided against it back in &lt;a href="https://issues.apache.org/jira/browse/SOLR-8642" title="SOLR allows creation of collections with invalid names" class="issue-link" data-issue-key="SOLR-8642"&gt;&lt;del&gt;SOLR-8642&lt;/del&gt;&lt;/a&gt;, as it'd force callers in Solr to produce their own SolrExceptions by wrapping the call.  Pros and cons either way.&lt;/p&gt;

&lt;p&gt;But now that it gets rid of the duplication I like it better this/your way.&lt;/p&gt;

&lt;p&gt;Thanks for taking the time to review Anshum.&lt;/p&gt;</comment>
                            <comment id="15153203" author="anshumg" created="Thu, 18 Feb 2016 15:02:12 -0700">&lt;p&gt;There were a few issues with the last patch. Here's an updated patch.&lt;br/&gt;
I'll commit once the entire test suite passes. Thanks everyone.&lt;/p&gt;</comment>
                            <comment id="15153325" author="jira-bot" created="Thu, 18 Feb 2016 16:19:12 -0700">&lt;p&gt;Commit d01230d6394b29fa6fd42377404c0c03d6e8a4d9 in lucene-solr's branch refs/heads/master from anshum&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d01230d" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d01230d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8677" title="SOLR allows creation of shards with invalid names." class="issue-link" data-issue-key="SOLR-8677"&gt;SOLR-8677&lt;/a&gt;: Restrict creation of shards with invalid names&lt;/p&gt;</comment>
                            <comment id="15153402" author="jira-bot" created="Thu, 18 Feb 2016 17:04:21 -0700">&lt;p&gt;Commit a54e819a6272830098cb50ec1abd75f2501d4993 in lucene-solr's branch refs/heads/master from anshum&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=a54e819" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=a54e819&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8677" title="SOLR allows creation of shards with invalid names." class="issue-link" data-issue-key="SOLR-8677"&gt;SOLR-8677&lt;/a&gt;: Fix broken build&lt;/p&gt;</comment>
                            <comment id="15153545" author="jira-bot" created="Thu, 18 Feb 2016 19:06:39 -0700">&lt;p&gt;Commit c7c5b8fe498408fb28911272986b119fc3ab563f in lucene-solr's branch refs/heads/master from anshum&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c7c5b8f" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c7c5b8f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8677" title="SOLR allows creation of shards with invalid names." class="issue-link" data-issue-key="SOLR-8677"&gt;SOLR-8677&lt;/a&gt;: Fix broken build&lt;/p&gt;</comment>
                            <comment id="15153596" author="jira-bot" created="Thu, 18 Feb 2016 19:44:08 -0700">&lt;p&gt;Commit eb0e270043f7e83c06683043a4fb642b4f04b485 in lucene-solr's branch refs/heads/master from anshum&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=eb0e270" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=eb0e270&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8677" title="SOLR allows creation of shards with invalid names." class="issue-link" data-issue-key="SOLR-8677"&gt;SOLR-8677&lt;/a&gt;: Fix assert statement&lt;/p&gt;</comment>
                            <comment id="15153871" author="jira-bot" created="Fri, 19 Feb 2016 00:53:50 -0700">&lt;p&gt;Commit 96c01a2c885871f7d80beddc6e019547639ef71e in lucene-solr's branch refs/heads/branch_5x from anshum&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=96c01a2" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=96c01a2&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8677" title="SOLR allows creation of shards with invalid names." class="issue-link" data-issue-key="SOLR-8677"&gt;SOLR-8677&lt;/a&gt;: Restrict creation of shards with invalid names&lt;/p&gt;</comment>
                            <comment id="15153872" author="jira-bot" created="Fri, 19 Feb 2016 00:53:52 -0700">&lt;p&gt;Commit 55162f2255a1f707603cc81134996cfb2a5968ec in lucene-solr's branch refs/heads/branch_5x from anshum&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=55162f2" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=55162f2&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8677" title="SOLR allows creation of shards with invalid names." class="issue-link" data-issue-key="SOLR-8677"&gt;SOLR-8677&lt;/a&gt;: Fix broken build&lt;/p&gt;</comment>
                            <comment id="15153873" author="jira-bot" created="Fri, 19 Feb 2016 00:53:53 -0700">&lt;p&gt;Commit 9b9a64a9d6a6b334c93ae18dbc8da534f4198b22 in lucene-solr's branch refs/heads/branch_5x from anshum&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9b9a64a" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9b9a64a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8677" title="SOLR allows creation of shards with invalid names." class="issue-link" data-issue-key="SOLR-8677"&gt;SOLR-8677&lt;/a&gt;: Fix broken build&lt;/p&gt;</comment>
                            <comment id="15153874" author="jira-bot" created="Fri, 19 Feb 2016 00:53:54 -0700">&lt;p&gt;Commit e8acc04c68ac74ca5757285581c42457100c990c in lucene-solr's branch refs/heads/branch_5x from anshum&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e8acc04" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e8acc04&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8677" title="SOLR allows creation of shards with invalid names." class="issue-link" data-issue-key="SOLR-8677"&gt;SOLR-8677&lt;/a&gt;: Fix assert statement&lt;/p&gt;</comment>
                            <comment id="15188193" author="erickerickson" created="Wed, 9 Mar 2016 15:22:50 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anshumg" class="user-hover" rel="anshumg"&gt;Anshum Gupta&lt;/a&gt; Can this be closed out?&lt;/p&gt;</comment>
                            <comment id="15188241" author="anshumg" created="Wed, 9 Mar 2016 15:47:38 -0700">&lt;p&gt;Done&lt;/p&gt;</comment>
                            <comment id="15259576" author="anshumg" created="Tue, 26 Apr 2016 22:23:43 -0700">&lt;p&gt;This shouldn't have gone to 5x. My bad! I'll revert this so that this isn't released on the 5x line.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12936745">SOLR-8642</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12913909">SOLR-8308</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12788538" name="SOLR-8677.patch" size="35163" author="anshumg" created="Thu, 18 Feb 2016 15:02:12 -0700"/>
                            <attachment id="12788122" name="SOLR-8677.patch" size="32094" author="anshumg" created="Tue, 16 Feb 2016 15:30:51 -0700"/>
                            <attachment id="12788053" name="SOLR-8677.patch" size="28165" author="gerlowskija" created="Tue, 16 Feb 2016 06:39:09 -0700"/>
                            <attachment id="12787716" name="SOLR-8677.patch" size="7164" author="gerlowskija" created="Fri, 12 Feb 2016 13:19:56 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 14 Feb 2016 09:23:51 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 week, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ss73:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>

<item>
            <title>[SOLR-8674] increase &lt;mergePolicy&gt; vs. &lt;mergePolicyFactory&gt; test coverage</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8674</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Following on from &lt;a href="https://issues.apache.org/jira/browse/SOLR-8621" title="solrconfig.xml: deprecate/replace &amp;lt;mergePolicy&amp;gt; with &amp;lt;mergePolicyFactory&amp;gt;" class="issue-link" data-issue-key="SOLR-8621"&gt;&lt;del&gt;SOLR-8621&lt;/del&gt;&lt;/a&gt; which deprecated/replaced &amp;lt;mergePolicy&amp;gt; with &amp;lt;mergePolicyFactory&amp;gt; there are some test solrconfig.xml files and associated test code that need to be transitioned from&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
&amp;lt;mergePolicy class=&lt;span class="code-quote"&gt;"${solr.tests.mergePolicy:org.apache.solr.util.RandomMergePolicy}"&lt;/span&gt;/&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;to&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
&amp;lt;mergePolicyFactory class=&lt;span class="code-quote"&gt;"${solr.tests.mergePolicyFactory:org.apache.solr.util.RandomMergePolicyFactory}"&lt;/span&gt;/&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;or something similar.&lt;/p&gt;</description>
                <environment/>
        <key id="12938619">SOLR-8674</key>
            <summary>increase &lt;mergePolicy&gt; vs. &lt;mergePolicyFactory&gt; test coverage</summary>
                <type id="6" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/requirement.png">Test</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cpoerschke">Christine Poerschke</assignee>
                                    <reporter username="cpoerschke">Christine Poerschke</reporter>
                        <labels>
                    </labels>
                <created>Thu, 11 Feb 2016 13:52:57 -0700</created>
                <updated>Wed, 24 Feb 2016 18:57:30 -0700</updated>
                            <resolved>Mon, 22 Feb 2016 10:08:13 -0700</resolved>
                                                    <fixVersion>6.0</fixVersion>
                    <fixVersion>master</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="15154219" author="cpoerschke" created="Fri, 19 Feb 2016 06:42:32 -0700">&lt;p&gt;Attached proposed patch against master, with the change &lt;tt&gt;solr.tests.mergePolicy[Factory]&lt;/tt&gt; tests now randomly choose between &amp;lt;mergePolicy&amp;gt; and &amp;lt;mergePolicyFactory&amp;gt;&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;This increases &amp;lt;mergePolicy&amp;gt; vs. &amp;lt;mergePolicyFactory&amp;gt; test coverage.&lt;/li&gt;
	&lt;li&gt;This temporarily also adds a little test setup complexity but when &lt;a href="https://issues.apache.org/jira/browse/SOLR-8668" title="Remove support for &amp;lt;mergePolicy&amp;gt;" class="issue-link" data-issue-key="SOLR-8668"&gt;SOLR-8668&lt;/a&gt; removes support for &amp;lt;mergePolicy&amp;gt; then test setup will return to its original complexity.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shaie" class="user-hover" rel="shaie"&gt;Shai Erera&lt;/a&gt; - with this following on from &lt;a href="https://issues.apache.org/jira/browse/SOLR-8621" title="solrconfig.xml: deprecate/replace &amp;lt;mergePolicy&amp;gt; with &amp;lt;mergePolicyFactory&amp;gt;" class="issue-link" data-issue-key="SOLR-8621"&gt;&lt;del&gt;SOLR-8621&lt;/del&gt;&lt;/a&gt;, would you have a chance to review the patch at some point? Thanks.&lt;/p&gt;
</comment>
                            <comment id="15154396" author="shaie" created="Fri, 19 Feb 2016 09:01:44 -0700">&lt;p&gt;Patch looks good!&lt;/p&gt;</comment>
                            <comment id="15157123" author="jira-bot" created="Mon, 22 Feb 2016 08:24:19 -0700">&lt;p&gt;Commit b14fb50b7fb5c2a57f55ce42263f888576b8ca1f in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cpoerschke" class="user-hover" rel="cpoerschke"&gt;Christine Poerschke&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b14fb50" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b14fb50&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8674" title="increase &amp;lt;mergePolicy&amp;gt; vs. &amp;lt;mergePolicyFactory&amp;gt; test coverage" class="issue-link" data-issue-key="SOLR-8674"&gt;&lt;del&gt;SOLR-8674&lt;/del&gt;&lt;/a&gt;: solr.tests.mergePolicy&lt;span class="error"&gt;&amp;#91;Factory&amp;#93;&lt;/span&gt; tests now randomly choose between &amp;lt;mergePolicy&amp;gt; and &amp;lt;mergePolicyFactory&amp;gt;&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;This increases &amp;lt;mergePolicy&amp;gt; vs. &amp;lt;mergePolicyFactory&amp;gt; test coverage.&lt;/li&gt;
	&lt;li&gt;This temporarily also adds a little test setup complexity but when &lt;a href="https://issues.apache.org/jira/browse/SOLR-8668" title="Remove support for &amp;lt;mergePolicy&amp;gt;" class="issue-link" data-issue-key="SOLR-8668"&gt;SOLR-8668&lt;/a&gt; removes support for &amp;lt;mergePolicy&amp;gt; then test setup will return to its original complexity.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15157281" author="jira-bot" created="Mon, 22 Feb 2016 10:05:41 -0700">&lt;p&gt;Commit e6bc86d4b972e9560ff524ba113b474365982a59 in lucene-solr's branch refs/heads/branch_5x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cpoerschke" class="user-hover" rel="cpoerschke"&gt;Christine Poerschke&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e6bc86d" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e6bc86d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8674" title="increase &amp;lt;mergePolicy&amp;gt; vs. &amp;lt;mergePolicyFactory&amp;gt; test coverage" class="issue-link" data-issue-key="SOLR-8674"&gt;&lt;del&gt;SOLR-8674&lt;/del&gt;&lt;/a&gt;: solr.tests.mergePolicy&lt;span class="error"&gt;&amp;#91;Factory&amp;#93;&lt;/span&gt; tests now randomly choose between &amp;lt;mergePolicy&amp;gt; and &amp;lt;mergePolicyFactory&amp;gt;&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;This increases &amp;lt;mergePolicy&amp;gt; vs. &amp;lt;mergePolicyFactory&amp;gt; test coverage.&lt;/li&gt;
	&lt;li&gt;This temporarily also adds a little test setup complexity but when &lt;a href="https://issues.apache.org/jira/browse/SOLR-8668" title="Remove support for &amp;lt;mergePolicy&amp;gt;" class="issue-link" data-issue-key="SOLR-8668"&gt;SOLR-8668&lt;/a&gt; removes support for &amp;lt;mergePolicy&amp;gt; then test setup will return to its original complexity.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;(Resolved conflict for solr/core/src/test/org/apache/solr/cloud/TestMiniSolrCloudCluster.java (java7 has no putIfAbsent).)&lt;/p&gt;</comment>
                            <comment id="15166550" author="jira-bot" created="Wed, 24 Feb 2016 18:57:30 -0700">&lt;p&gt;Commit bc5dfeeff1a182630fc3b55be3cf2f4fe164d446 in lucene-solr's branch refs/heads/jira/&lt;a href="https://issues.apache.org/jira/browse/SOLR-445" title="Update Handlers abort with bad documents" class="issue-link" data-issue-key="SOLR-445"&gt;&lt;del&gt;SOLR-445&lt;/del&gt;&lt;/a&gt; from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hossman_lucene%40fucit.org" class="user-hover" rel="hossman_lucene@fucit.org"&gt;Chris Hostetter&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=bc5dfee" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=bc5dfee&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-445" title="Update Handlers abort with bad documents" class="issue-link" data-issue-key="SOLR-445"&gt;&lt;del&gt;SOLR-445&lt;/del&gt;&lt;/a&gt;: play nice with &lt;a href="https://issues.apache.org/jira/browse/SOLR-8674" title="increase &amp;lt;mergePolicy&amp;gt; vs. &amp;lt;mergePolicyFactory&amp;gt; test coverage" class="issue-link" data-issue-key="SOLR-8674"&gt;&lt;del&gt;SOLR-8674&lt;/del&gt;&lt;/a&gt; test changes&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12935085">SOLR-8621</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12938061">SOLR-8668</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12788679" name="SOLR-8674.patch" size="25318" author="cpoerschke" created="Fri, 19 Feb 2016 06:38:27 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 19 Feb 2016 16:01:44 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2sqon:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8668] Remove support for &lt;mergePolicy&gt;</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8668</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Following &lt;a href="https://issues.apache.org/jira/browse/SOLR-8621" title="solrconfig.xml: deprecate/replace &amp;lt;mergePolicy&amp;gt; with &amp;lt;mergePolicyFactory&amp;gt;" class="issue-link" data-issue-key="SOLR-8621"&gt;&lt;del&gt;SOLR-8621&lt;/del&gt;&lt;/a&gt;, we should remove support for &lt;tt&gt;&amp;lt;mergePolicy&amp;gt;&lt;/tt&gt; (and related &lt;tt&gt;&amp;lt;mergeFactor&amp;gt;&lt;/tt&gt; and &lt;tt&gt;&amp;lt;maxMergeDocs&amp;gt;&lt;/tt&gt;) in trunk/6x.&lt;/p&gt;</description>
                <environment/>
        <key id="12938061">SOLR-8668</key>
            <summary>Remove support for &lt;mergePolicy&gt;</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="shaie">Shai Erera</reporter>
                        <labels>
                    </labels>
                <created>Tue, 9 Feb 2016 18:11:27 -0700</created>
                <updated>Mon, 22 Feb 2016 10:05:42 -0700</updated>
                                                            <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="15157124" author="jira-bot" created="Mon, 22 Feb 2016 08:24:21 -0700">&lt;p&gt;Commit b14fb50b7fb5c2a57f55ce42263f888576b8ca1f in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cpoerschke" class="user-hover" rel="cpoerschke"&gt;Christine Poerschke&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b14fb50" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b14fb50&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8674" title="increase &amp;lt;mergePolicy&amp;gt; vs. &amp;lt;mergePolicyFactory&amp;gt; test coverage" class="issue-link" data-issue-key="SOLR-8674"&gt;&lt;del&gt;SOLR-8674&lt;/del&gt;&lt;/a&gt;: solr.tests.mergePolicy&lt;span class="error"&gt;&amp;#91;Factory&amp;#93;&lt;/span&gt; tests now randomly choose between &amp;lt;mergePolicy&amp;gt; and &amp;lt;mergePolicyFactory&amp;gt;&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;This increases &amp;lt;mergePolicy&amp;gt; vs. &amp;lt;mergePolicyFactory&amp;gt; test coverage.&lt;/li&gt;
	&lt;li&gt;This temporarily also adds a little test setup complexity but when &lt;a href="https://issues.apache.org/jira/browse/SOLR-8668" title="Remove support for &amp;lt;mergePolicy&amp;gt;" class="issue-link" data-issue-key="SOLR-8668"&gt;SOLR-8668&lt;/a&gt; removes support for &amp;lt;mergePolicy&amp;gt; then test setup will return to its original complexity.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15157282" author="jira-bot" created="Mon, 22 Feb 2016 10:05:42 -0700">&lt;p&gt;Commit e6bc86d4b972e9560ff524ba113b474365982a59 in lucene-solr's branch refs/heads/branch_5x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cpoerschke" class="user-hover" rel="cpoerschke"&gt;Christine Poerschke&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e6bc86d" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e6bc86d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8674" title="increase &amp;lt;mergePolicy&amp;gt; vs. &amp;lt;mergePolicyFactory&amp;gt; test coverage" class="issue-link" data-issue-key="SOLR-8674"&gt;&lt;del&gt;SOLR-8674&lt;/del&gt;&lt;/a&gt;: solr.tests.mergePolicy&lt;span class="error"&gt;&amp;#91;Factory&amp;#93;&lt;/span&gt; tests now randomly choose between &amp;lt;mergePolicy&amp;gt; and &amp;lt;mergePolicyFactory&amp;gt;&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;This increases &amp;lt;mergePolicy&amp;gt; vs. &amp;lt;mergePolicyFactory&amp;gt; test coverage.&lt;/li&gt;
	&lt;li&gt;This temporarily also adds a little test setup complexity but when &lt;a href="https://issues.apache.org/jira/browse/SOLR-8668" title="Remove support for &amp;lt;mergePolicy&amp;gt;" class="issue-link" data-issue-key="SOLR-8668"&gt;SOLR-8668&lt;/a&gt; removes support for &amp;lt;mergePolicy&amp;gt; then test setup will return to its original complexity.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;(Resolved conflict for solr/core/src/test/org/apache/solr/cloud/TestMiniSolrCloudCluster.java (java7 has no putIfAbsent).)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12938619">SOLR-8674</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12935085">SOLR-8621</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 22 Feb 2016 15:24:21 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2sn8v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>

<item>
            <title>[SOLR-8667] Remove the one action only schema APIs </title>
                <link>https://issues.apache.org/jira/browse/SOLR-8667</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description/>
                <environment/>
        <key id="12938035">SOLR-8667</key>
            <summary>Remove the one action only schema APIs </summary>
                <type id="3" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/task.png">Task</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="11">Done</resolution>
                                        <assignee username="noble.paul">Noble Paul</assignee>
                                    <reporter username="noble.paul">Noble Paul</reporter>
                        <labels>
                    </labels>
                <created>Tue, 9 Feb 2016 16:25:10 -0700</created>
                <updated>Thu, 14 Apr 2016 17:21:04 -0700</updated>
                            <resolved>Thu, 14 Apr 2016 17:21:04 -0700</resolved>
                                    <version>6.0</version>
                                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="15242207" author="steve_rowe" created="Thu, 14 Apr 2016 17:21:04 -0700">&lt;p&gt;Resolved as part of &lt;a href="https://issues.apache.org/jira/browse/SOLR-8736" title="GET operations on fields, dynamicFields, fieldTypes, copyField should work" class="issue-link" data-issue-key="SOLR-8736"&gt;&lt;del&gt;SOLR-8736&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                                                <inwardlinks description="is part of">
                                        <issuelink>
            <issuekey id="12944475">SOLR-8736</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12746194">SOLR-6594</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 15 Apr 2016 00:21:04 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2sn33:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8658] Fix test failure introduced in SOLR-8651</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8658</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;OK, I think I've found a possible reason. The waitForDocCount method waits until a response comes back with the, well, expected doc counts. But then it drops out of the wait loop the first time a query works.&lt;/p&gt;

&lt;p&gt;But then it goes out to each and every node and re-issues the request. This looks to be a 2-shard, 2-replica situation. So here's the theory: the second node hasn't yet opened a new searcher. So the wait loop is satisfied by, say, node2 but the test later looks at node4 (both for shard2) which hasn't completed opening a searcher yet so it fails.&lt;/p&gt;

&lt;p&gt;I could not get this to fail locally in 20 runs. So I'll beast the unchanged version some more to see but meanwhile commit this change which I think is more correct anyway and monitor.&lt;/p&gt;</description>
                <environment/>
        <key id="12937619">SOLR-8658</key>
            <summary>Fix test failure introduced in SOLR-8651</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="erickerickson">Erick Erickson</assignee>
                                    <reporter username="erickerickson">Erick Erickson</reporter>
                        <labels>
                    </labels>
                <created>Mon, 8 Feb 2016 12:58:07 -0700</created>
                <updated>Tue, 23 Feb 2016 03:40:07 -0700</updated>
                            <resolved>Wed, 10 Feb 2016 10:30:15 -0700</resolved>
                                                    <fixVersion>5.5</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="15138286" author="jira-bot" created="Mon, 8 Feb 2016 20:38:47 -0700">&lt;p&gt;Commit b5823b50db14d93b546fa898e33ad3dfea58df17 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickerickson" class="user-hover" rel="erickerickson"&gt;Erick Erickson&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b5823b5" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b5823b5&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8658" title="Fix test failure introduced in SOLR-8651" class="issue-link" data-issue-key="SOLR-8658"&gt;&lt;del&gt;SOLR-8658&lt;/del&gt;&lt;/a&gt;: Fix test failure introduced in &lt;a href="https://issues.apache.org/jira/browse/SOLR-8651" title="The commitWithin parameter is not passed on for deleteById in UpdateRequest for distributed queries" class="issue-link" data-issue-key="SOLR-8651"&gt;&lt;del&gt;SOLR-8651&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15138290" author="erickerickson" created="Mon, 8 Feb 2016 20:45:20 -0700">&lt;p&gt;200 runs of this test case and this error did not recur (without this patch). I'm guessing that it requires a slower machine to reproduce the assumed race condition. So I don't see any other choice than to commit this test fix and see if it happens again.&lt;/p&gt;

&lt;p&gt;I'll keep this JIRA open for a day or two and then close it if we don't see the problem again.&lt;/p&gt;

&lt;p&gt;I don't think this really requires a CHANGES.txt entry so if we package up 6.0 and 5.5 &lt;/p&gt;</comment>
                            <comment id="15138301" author="jira-bot" created="Mon, 8 Feb 2016 20:52:50 -0700">&lt;p&gt;Commit f4f1486895bf9cc18bb4e9f89a110c50ae63f59c in lucene-solr's branch refs/heads/branch_5x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickerickson" class="user-hover" rel="erickerickson"&gt;Erick Erickson&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f4f1486" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f4f1486&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8658" title="Fix test failure introduced in SOLR-8651" class="issue-link" data-issue-key="SOLR-8658"&gt;&lt;del&gt;SOLR-8658&lt;/del&gt;&lt;/a&gt;: Fix test failure introduced in &lt;a href="https://issues.apache.org/jira/browse/SOLR-8651" title="The commitWithin parameter is not passed on for deleteById in UpdateRequest for distributed queries" class="issue-link" data-issue-key="SOLR-8651"&gt;&lt;del&gt;SOLR-8651&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15141251" author="erickerickson" created="Wed, 10 Feb 2016 10:30:15 -0700">&lt;p&gt;I think this is OK, if it crops back up we can open a new JIRA or re-open this one.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12786984" name="SOLR-8658.patch" size="3423" author="erickerickson" created="Mon, 8 Feb 2016 20:45:20 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 9 Feb 2016 03:38:47 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2skqn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8656] PeerSync should use same nUpdates everywhere</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8656</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;PeerSync requests information on the most recent nUpdates updates from another instance to determine whether PeerSync can succeed. The value of nUpdates can be customized in solrconfig.xml: UpdateHandler.UpdateLog.NumRecordsToKeep.&lt;/p&gt;

&lt;p&gt;PeerSync can be initiated in a number of different paths. One path to start PeerSync (leader-initiated sync) is incorrectly still using a hard-coded value of nUpdates=100.&lt;/p&gt;

&lt;p&gt;This change fixes leader-initiated-sync code path to also pick up the value of nUpdates from the customized/configured value.&lt;/p&gt;</description>
                <environment/>
        <key id="12937508">SOLR-8656</key>
            <summary>PeerSync should use same nUpdates everywhere</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="anshumg">Anshum Gupta</assignee>
                                    <reporter username="rwhaddad">Ramsey Haddad</reporter>
                        <labels>
                    </labels>
                <created>Mon, 8 Feb 2016 07:19:27 -0700</created>
                <updated>Thu, 21 Apr 2016 11:58:26 -0700</updated>
                            <resolved>Thu, 21 Apr 2016 11:58:26 -0700</resolved>
                                    <version>5.4.1</version>
                    <version>master</version>
                                    <fixVersion>5.5.1</fixVersion>
                    <fixVersion>6.0</fixVersion>
                    <fixVersion>master</fixVersion>
                                    <component>SolrCloud</component>
                        <due/>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="15154910" author="jira-bot" created="Fri, 19 Feb 2016 14:41:55 -0700">&lt;p&gt;Commit 771f14cb6e476373e94169be05c1eadf816ca5b6 in lucene-solr's branch refs/heads/master from markrmiller&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=771f14c" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=771f14c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8656" title="PeerSync should use same nUpdates everywhere" class="issue-link" data-issue-key="SOLR-8656"&gt;&lt;del&gt;SOLR-8656&lt;/del&gt;&lt;/a&gt;: PeerSync should use same nUpdates everywhere.&lt;/p&gt;</comment>
                            <comment id="15154911" author="markrmiller@gmail.com" created="Fri, 19 Feb 2016 14:42:10 -0700">&lt;p&gt;Thanks Ramsey!&lt;/p&gt;</comment>
                            <comment id="15252311" author="anshumg" created="Thu, 21 Apr 2016 10:46:44 -0700">&lt;p&gt;Reopening to back port for 5.5.1&lt;/p&gt;</comment>
                            <comment id="15252399" author="jira-bot" created="Thu, 21 Apr 2016 11:23:46 -0700">&lt;p&gt;Commit d2f68e13c660291f460b4b5e54c8a95643497eea in lucene-solr's branch refs/heads/branch_5x from markrmiller&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d2f68e1" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d2f68e1&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8656" title="PeerSync should use same nUpdates everywhere" class="issue-link" data-issue-key="SOLR-8656"&gt;&lt;del&gt;SOLR-8656&lt;/del&gt;&lt;/a&gt;: PeerSync should use same nUpdates everywhere.&lt;/p&gt;</comment>
                            <comment id="15252469" author="jira-bot" created="Thu, 21 Apr 2016 11:57:52 -0700">&lt;p&gt;Commit 9f7bd67d2d34be1548fff6f2f44a4146b9d28b13 in lucene-solr's branch refs/heads/branch_5_5 from markrmiller&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9f7bd67" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9f7bd67&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8656" title="PeerSync should use same nUpdates everywhere" class="issue-link" data-issue-key="SOLR-8656"&gt;&lt;del&gt;SOLR-8656&lt;/del&gt;&lt;/a&gt;: PeerSync should use same nUpdates everywhere.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12733076">SOLR-6359</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12786815" name="solr-8656.patch" size="2512" author="rwhaddad" created="Mon, 8 Feb 2016 07:27:18 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 19 Feb 2016 21:41:55 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2sk27:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8640] CloudSolrClient does not send the credentials set in the UpdateRequest</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8640</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;CloudSolrClient copies the UpdateRequest, but not the credentials. So BasicAuth does not work if u use CloudSolrClient &lt;/p&gt;</description>
                <environment/>
        <key id="12936711">SOLR-8640</key>
            <summary>CloudSolrClient does not send the credentials set in the UpdateRequest</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="noble.paul">Noble Paul</assignee>
                                    <reporter username="noble.paul">Noble Paul</reporter>
                        <labels>
                    </labels>
                <created>Thu, 4 Feb 2016 05:42:49 -0700</created>
                <updated>Wed, 6 Apr 2016 12:11:15 -0700</updated>
                            <resolved>Tue, 22 Mar 2016 08:01:51 -0700</resolved>
                                    <version>5.4</version>
                                    <fixVersion>5.5</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>security</component>
                    <component>SolrJ</component>
                        <due/>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="15132320" author="jira-bot" created="Thu, 4 Feb 2016 06:29:25 -0700">&lt;p&gt;Commit f85036cd9ce74dd94e29aa3f44851633342c69bd in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f85036c" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f85036c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8640" title="CloudSolrClient does not send the credentials set in the UpdateRequest" class="issue-link" data-issue-key="SOLR-8640"&gt;&lt;del&gt;SOLR-8640&lt;/del&gt;&lt;/a&gt;: CloudSolrClient does not send credentials for update request&lt;/p&gt;</comment>
                            <comment id="15132337" author="jira-bot" created="Thu, 4 Feb 2016 06:41:54 -0700">&lt;p&gt;Commit 87de803f267bdbac812525503be3be9c7eb78ea4 in lucene-solr's branch refs/heads/branch_5x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=87de803" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=87de803&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8640" title="CloudSolrClient does not send the credentials set in the UpdateRequest" class="issue-link" data-issue-key="SOLR-8640"&gt;&lt;del&gt;SOLR-8640&lt;/del&gt;&lt;/a&gt;: CloudSolrClient does not send credentials for update request (noble, hoss)&lt;/p&gt;</comment>
                            <comment id="15134474" author="jira-bot" created="Fri, 5 Feb 2016 10:02:19 -0700">&lt;p&gt;Commit f85036cd9ce74dd94e29aa3f44851633342c69bd in lucene-solr's branch refs/heads/lucene-6997 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f85036c" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f85036c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8640" title="CloudSolrClient does not send the credentials set in the UpdateRequest" class="issue-link" data-issue-key="SOLR-8640"&gt;&lt;del&gt;SOLR-8640&lt;/del&gt;&lt;/a&gt;: CloudSolrClient does not send credentials for update request&lt;/p&gt;</comment>
                            <comment id="15134540" author="jira-bot" created="Fri, 5 Feb 2016 10:39:54 -0700">&lt;p&gt;Commit f85036cd9ce74dd94e29aa3f44851633342c69bd in lucene-solr's branch refs/heads/lucene-6835 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f85036c" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f85036c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8640" title="CloudSolrClient does not send the credentials set in the UpdateRequest" class="issue-link" data-issue-key="SOLR-8640"&gt;&lt;del&gt;SOLR-8640&lt;/del&gt;&lt;/a&gt;: CloudSolrClient does not send credentials for update request&lt;/p&gt;</comment>
                            <comment id="15154664" author="smschauhan" created="Fri, 19 Feb 2016 11:59:43 -0700">&lt;p&gt;Any update on this? This is breaking functionality for environments that have Basic Auth setup with SolrCloud. &lt;/p&gt;</comment>
                            <comment id="15154755" author="noble.paul" created="Fri, 19 Feb 2016 12:52:03 -0700">&lt;p&gt;It;s fixed in 6.0 and 5.5 &lt;/p&gt;

&lt;p&gt;Unfortunately the CHAGES section does not have it for 5.5&lt;/p&gt;</comment>
                            <comment id="15206462" author="ctargett" created="Tue, 22 Mar 2016 07:45:13 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt; - This is confusing - the issue is fixed in 6.0 and 5.5.0? But, it's still open and doesn't include 5.5 as the fixVersion so it appears open at first glance. Would you update this issue to the proper state so it's more clear?&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12954001">SOLR-8912</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12786251" name="SOLR-8640.patch" size="9892" author="noble.paul" created="Thu, 4 Feb 2016 06:20:35 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 4 Feb 2016 13:29:25 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2sf5b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8638] Implement ConnectionImpl setCatalog and setSchema</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8638</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;When testing with &lt;a href="https://issues.apache.org/jira/browse/SOLR-8507" title="Add information about database product name, product version, driver name, and driver version." class="issue-link" data-issue-key="SOLR-8507"&gt;&lt;del&gt;SOLR-8507&lt;/del&gt;&lt;/a&gt; and the other improvements, executing a query throws an exception since setCatalog is not implemented.&lt;/p&gt;</description>
                <environment/>
        <key id="12936521">SOLR-8638</key>
            <summary>Implement ConnectionImpl setCatalog and setSchema</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12928403">SOLR-8502</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="10">Implemented</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="risdenk">Kevin Risden</reporter>
                        <labels>
                    </labels>
                <created>Wed, 3 Feb 2016 15:42:41 -0700</created>
                <updated>Sat, 6 Feb 2016 18:27:57 -0700</updated>
                            <resolved>Sat, 6 Feb 2016 18:27:57 -0700</resolved>
                                    <version>6.0</version>
                                    <fixVersion>6.0</fixVersion>
                                    <component>SolrJ</component>
                        <due/>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="15131310" author="risdenk" created="Wed, 3 Feb 2016 15:52:50 -0700">&lt;p&gt;Attached patch with simple test. Manually testing with DBVisualizer now.&lt;/p&gt;</comment>
                            <comment id="15131347" author="risdenk" created="Wed, 3 Feb 2016 16:14:59 -0700">&lt;p&gt;Updated patch to make setCatalog a noop and avoid having to deal with changing catalogs currently. Same tests.&lt;/p&gt;</comment>
                            <comment id="15131363" author="risdenk" created="Wed, 3 Feb 2016 16:26:34 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=joel.bernstein" class="user-hover" rel="joel.bernstein"&gt;Joel Bernstein&lt;/a&gt; - This is required to run queries once &lt;a href="https://issues.apache.org/jira/browse/SOLR-8507" title="Add information about database product name, product version, driver name, and driver version." class="issue-link" data-issue-key="SOLR-8507"&gt;&lt;del&gt;SOLR-8507&lt;/del&gt;&lt;/a&gt; is merged since then DBVisualizer starts trying to be able to change catalog/schemas when querying. This wasn't noticeable before because all the metadata wasn't available and DBVisualizer was giving up before getting this far.&lt;/p&gt;</comment>
                            <comment id="15131389" author="joel.bernstein" created="Wed, 3 Feb 2016 16:39:37 -0700">&lt;p&gt;OK, i'll makes sure this gets in.&lt;/p&gt;</comment>
                            <comment id="15136089" author="jira-bot" created="Sat, 6 Feb 2016 18:24:19 -0700">&lt;p&gt;Commit dc6b1a68d28142a1ef85f497b6437cbd7f2777f0 in lucene-solr's branch refs/heads/master from jbernste&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=dc6b1a6" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=dc6b1a6&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8507" title="Add information about database product name, product version, driver name, and driver version." class="issue-link" data-issue-key="SOLR-8507"&gt;&lt;del&gt;SOLR-8507&lt;/del&gt;&lt;/a&gt;, &lt;a href="https://issues.apache.org/jira/browse/SOLR-8638" title="Implement ConnectionImpl setCatalog and setSchema" class="issue-link" data-issue-key="SOLR-8638"&gt;&lt;del&gt;SOLR-8638&lt;/del&gt;&lt;/a&gt;: Add information about database product name, product version, driver name, and driver version. Implement ConnectionImpl setCatalog and setSchema.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12786138" name="SOLR-8638.patch" size="5254" author="risdenk" created="Wed, 3 Feb 2016 16:14:59 -0700"/>
                            <attachment id="12786131" name="SOLR-8638.patch" size="5320" author="risdenk" created="Wed, 3 Feb 2016 15:52:50 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 3 Feb 2016 23:39:37 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2sdz3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8633] DistributedUpdateProcess processCommit/deleteByQuery call finish on DUP and SolrCmdDistributor, which violates the lifecycle and can cause bugs.</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8633</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;trying to wrap my head around a weird bug in my experiements with &lt;a href="https://issues.apache.org/jira/browse/SOLR-445" title="Update Handlers abort with bad documents" class="issue-link" data-issue-key="SOLR-445"&gt;&lt;del&gt;SOLR-445&lt;/del&gt;&lt;/a&gt;, i realized that &lt;tt&gt;DUP.processDelete&lt;/tt&gt; has a direct call to &lt;tt&gt;finish()&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;This violates the normal lifecycle of an UpdateProcessor (finish is only suppose to be called exactly once after processing any/all UpdateCommands) and could potentially break any UpdateProcessors configured after DUP (or in my case: processors configured &lt;em&gt;before&lt;/em&gt; DUP that expect to be in charge of calling finish, and catching any resulting exceptions, as part of the normal life cycle)&lt;/p&gt;

&lt;p&gt;Independent of how it impacts other update processors, this also means that:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;all the logic in &lt;tt&gt;DUP.doFinish&lt;/tt&gt; is getting executed twice &amp;#8211; which seems kind of expensive/dangerous to me since there is leader initiated recovery involved in this method&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;SolrCmdDistributor.finish()&lt;/tt&gt; gets called twice, which means &lt;tt&gt;StreamingSolrClients.shutdown()&lt;/tt&gt; gets called twice, which means &lt;tt&gt;ConcurrentUpdateSolrClient.close()&lt;/tt&gt; gets called twice ... it seems like we're just getting really lucky that (as configured by DUP) all of these resources are still usable after being finished/shutdown/closed&lt;/li&gt;
&lt;/ol&gt;


</description>
                <environment/>
        <key id="12936137">SOLR-8633</key>
            <summary>DistributedUpdateProcess processCommit/deleteByQuery call finish on DUP and SolrCmdDistributor, which violates the lifecycle and can cause bugs.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="markrmiller@gmail.com">Mark Miller</assignee>
                                    <reporter username="hossman">Hoss Man</reporter>
                        <labels>
                    </labels>
                <created>Tue, 2 Feb 2016 14:54:08 -0700</created>
                <updated>Thu, 21 Apr 2016 11:58:38 -0700</updated>
                            <resolved>Thu, 21 Apr 2016 11:58:38 -0700</resolved>
                                                    <fixVersion>5.5.1</fixVersion>
                    <fixVersion>6.0</fixVersion>
                    <fixVersion>master</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="15129112" author="hossman" created="Tue, 2 Feb 2016 14:55:13 -0700">
&lt;p&gt;I suspect that the &lt;em&gt;intended&lt;/em&gt; goal here (in processCommit) is to do the same sort of "force sequential ordering" type logic as doDeleteByQuery &amp;#8211; in which case we can/should replace the call to &lt;tt&gt;finish()&lt;/tt&gt; with a call to &lt;tt&gt;cmdDistrib.finish()&lt;/tt&gt; ... except that i'm still concerned about shutdown/closing of clients done by that method, and wonder if &lt;em&gt;both&lt;/em&gt; processCommit &amp;amp; processDelete should be calling &lt;tt&gt;SolrCmdDistributor.blockAndDoRetries()&lt;/tt&gt; directly? (we would just need to make that method public)&lt;/p&gt;

&lt;p&gt;Hoping folks like &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com" class="user-hover" rel="markrmiller@gmail.com"&gt;Mark Miller&lt;/a&gt; / &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tim.potter" class="user-hover" rel="tim.potter"&gt;Timothy Potter&lt;/a&gt; might have some ideas about this?&lt;/p&gt;</comment>
                            <comment id="15129378" author="hossman" created="Tue, 2 Feb 2016 16:54:39 -0700">&lt;p&gt;attaching a strawman patch that has asserts ensuring that &lt;tt&gt;finish()&lt;/tt&gt; is never called more then once on either DUP or SolrCmdDistributor, and makes &lt;tt&gt;blockAndDoRetries()&lt;/tt&gt; public so DUP can call it instead of &lt;tt&gt;finish()&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;all tests pass ... anyone see any problems with this? &lt;/p&gt;

&lt;p&gt;any reason why the previous code (where all the logic in DUP.finish() was getting executed twice when there was an explicit commit) was better/needed ?&lt;/p&gt;</comment>
                            <comment id="15129751" author="markrmiller@gmail.com" created="Tue, 2 Feb 2016 21:13:29 -0700">&lt;p&gt;Healing. Happy to review soon (this week). &lt;/p&gt;</comment>
                            <comment id="15154144" author="markrmiller@gmail.com" created="Fri, 19 Feb 2016 05:04:19 -0700">&lt;p&gt;Forgot this issue. I'll review this today.&lt;/p&gt;</comment>
                            <comment id="15154184" author="markrmiller@gmail.com" created="Fri, 19 Feb 2016 05:59:01 -0700">&lt;p&gt;Yeah, it's a bug, patch is the right fix.&lt;/p&gt;</comment>
                            <comment id="15154482" author="hossman" created="Fri, 19 Feb 2016 09:48:25 -0700">&lt;p&gt;thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com" class="user-hover" rel="markrmiller@gmail.com"&gt;Mark Miller&lt;/a&gt; - if you want to take this go ahead, otherwise i'll commit &amp;amp; backport first thing next week.&lt;/p&gt;</comment>
                            <comment id="15154788" author="jira-bot" created="Fri, 19 Feb 2016 13:05:55 -0700">&lt;p&gt;Commit 8cd53a076b579ebc3be1fbb26875321e66a41608 in lucene-solr's branch refs/heads/master from markrmiller&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=8cd53a0" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=8cd53a0&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8633" title="DistributedUpdateProcess processCommit/deleteByQuery call finish on DUP and SolrCmdDistributor, which violates the lifecycle and can cause bugs." class="issue-link" data-issue-key="SOLR-8633"&gt;&lt;del&gt;SOLR-8633&lt;/del&gt;&lt;/a&gt;: DistributedUpdateProcess processCommit/deleteByQuery call finish on DUP and SolrCmdDistributor, which violates the lifecycle and can cause bugs.&lt;/p&gt;</comment>
                            <comment id="15248893" author="anshumg" created="Tue, 19 Apr 2016 16:18:52 -0700">&lt;p&gt;Reopening for 5.5.1&lt;/p&gt;</comment>
                            <comment id="15252398" author="jira-bot" created="Thu, 21 Apr 2016 11:23:44 -0700">&lt;p&gt;Commit 30fee6ba03fc77c51ff0e87a405f5b2942d8e7c9 in lucene-solr's branch refs/heads/branch_5x from markrmiller&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=30fee6b" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=30fee6b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8633" title="DistributedUpdateProcess processCommit/deleteByQuery call finish on DUP and SolrCmdDistributor, which violates the lifecycle and can cause bugs." class="issue-link" data-issue-key="SOLR-8633"&gt;&lt;del&gt;SOLR-8633&lt;/del&gt;&lt;/a&gt;: DistributedUpdateProcess processCommit/deleteByQuery call finish on DUP and SolrCmdDistributor, which violates the lifecycle and can cause bugs.&lt;/p&gt;</comment>
                            <comment id="15252468" author="jira-bot" created="Thu, 21 Apr 2016 11:57:50 -0700">&lt;p&gt;Commit e603565d4757625cc90d9db77a7ee240c20f93ed in lucene-solr's branch refs/heads/branch_5_5 from markrmiller&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e603565" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e603565&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8633" title="DistributedUpdateProcess processCommit/deleteByQuery call finish on DUP and SolrCmdDistributor, which violates the lifecycle and can cause bugs." class="issue-link" data-issue-key="SOLR-8633"&gt;&lt;del&gt;SOLR-8633&lt;/del&gt;&lt;/a&gt;: DistributedUpdateProcess processCommit/deleteByQuery call finish on DUP and SolrCmdDistributor, which violates the lifecycle and can cause bugs.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12385211">SOLR-445</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12785884" name="SOLR-8633.patch" size="2805" author="hossman" created="Tue, 2 Feb 2016 16:54:39 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 3 Feb 2016 04:13:29 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2sbmn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8631] Throw UnsupportedOperationException for DatabaseMetaDataImpl.getTypeInfo()</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8631</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Once getSchemas (&lt;a href="https://issues.apache.org/jira/browse/SOLR-8510" title="Implement DatabaseMetaDataImpl.getSchemas()" class="issue-link" data-issue-key="SOLR-8510"&gt;&lt;del&gt;SOLR-8510&lt;/del&gt;&lt;/a&gt;) is implemented, DBVisualizer tries to get type information with getDataTypes and fails with a NPE. A short term workaround is to an UnsupportedOperationException instead of returning null.&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
2016-02-01 21:27:33.868 FINE   647 [pool-3-thread-4 - E.] RootConnection: DatabaseMetaDataImpl.getTypeInfo()
2016-02-01 21:27:33.870 FINE   647 [AWT-EventQueue-0 - B.executionFinished] Exception &lt;span class="code-keyword"&gt;while&lt;/span&gt; Connecting
com.onseven.dbvis.K.B.P: java.util.concurrent.ExecutionException: java.lang.NullPointerException
	at com.onseven.dbvis.K.B.L.(Z:2680)
	at com.onseven.dbvis.K.B.L.(Z:1521)
	at com.onseven.dbvis.K.B.L$3.run(Z:3032)
	at java.awt.event.InvocationEvent.dispatch(InvocationEvent.java:311)
	at java.awt.EventQueue.dispatchEventImpl(EventQueue.java:756)
	at java.awt.EventQueue.access$500(EventQueue.java:97)
	at java.awt.EventQueue$3.run(EventQueue.java:709)
	at java.awt.EventQueue$3.run(EventQueue.java:703)
	at java.security.AccessController.doPrivileged(Native Method)
	at java.security.ProtectionDomain$JavaSecurityAccessImpl.doIntersectionPrivilege(ProtectionDomain.java:76)
	at java.awt.EventQueue.dispatchEvent(EventQueue.java:726)
	at java.awt.EventDispatchThread.pumpOneEventForFilters(EventDispatchThread.java:201)
	at java.awt.EventDispatchThread.pumpEventsForFilter(EventDispatchThread.java:116)
	at java.awt.EventDispatchThread.pumpEventsForHierarchy(EventDispatchThread.java:105)
	at java.awt.EventDispatchThread.pumpEvents(EventDispatchThread.java:101)
	at java.awt.EventDispatchThread.pumpEvents(EventDispatchThread.java:93)
	at java.awt.EventDispatchThread.run(EventDispatchThread.java:82)
Caused by: java.util.concurrent.ExecutionException: java.lang.NullPointerException
	at java.util.concurrent.FutureTask.report(FutureTask.java:122)
	at java.util.concurrent.FutureTask.get(FutureTask.java:192)
	at javax.swing.SwingWorker.get(SwingWorker.java:602)
	at com.onseven.dbvis.K.B.L.(Z:990)
	... 16 more
Caused by: java.lang.NullPointerException
	at com.onseven.dbvis.db.AbstractFacade.getDataTypes(Z:3212)
	at com.onseven.dbvis.db.AbstractFacade.runConnectionSetup(Z:1260)
	at com.onseven.dbvis.db.A.I.(Z:3512)
	at com.onseven.dbvis.db.A.B.execute(Z:2933)
	at com.onseven.dbvis.K.B.Z.(Z:2285)
	at com.onseven.dbvis.K.B.L.(Z:1374)
	at com.onseven.dbvis.K.B.L.doInBackground(Z:1521)
	at javax.swing.SwingWorker$1.call(SwingWorker.java:295)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at javax.swing.SwingWorker.run(SwingWorker.java:334)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
	at java.lang.&lt;span class="code-object"&gt;Thread&lt;/span&gt;.run(&lt;span class="code-object"&gt;Thread&lt;/span&gt;.java:745)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment/>
        <key id="12935834">SOLR-8631</key>
            <summary>Throw UnsupportedOperationException for DatabaseMetaDataImpl.getTypeInfo()</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12928403">SOLR-8502</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="10">Implemented</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="risdenk">Kevin Risden</reporter>
                        <labels>
                    </labels>
                <created>Mon, 1 Feb 2016 20:29:50 -0700</created>
                <updated>Fri, 29 Apr 2016 16:18:03 -0700</updated>
                            <resolved>Tue, 2 Feb 2016 11:22:31 -0700</resolved>
                                    <version>master</version>
                                    <fixVersion>6.0</fixVersion>
                                    <component>SolrJ</component>
                        <due/>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="15128178" author="joel.bernstein" created="Tue, 2 Feb 2016 05:36:05 -0700">&lt;p&gt;This looks like a complicated Tuple that is returned. I think for 6.0 it makes sense to throw the UnsupportedOperationException.&lt;/p&gt;</comment>
                            <comment id="15128423" author="risdenk" created="Tue, 2 Feb 2016 08:47:46 -0700">&lt;p&gt;Initial patch just throwing unsupported operation.&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=joel.bernstein" class="user-hover" rel="joel.bernstein"&gt;Joel Bernstein&lt;/a&gt; - I agree that this requires a lot of metadata to be sent back. Maybe we can leave this open and implement it at a later date?&lt;/p&gt;</comment>
                            <comment id="15128432" author="joel.bernstein" created="Tue, 2 Feb 2016 08:54:34 -0700">&lt;p&gt;Great, I'll commit this today.&lt;/p&gt;</comment>
                            <comment id="15128717" author="jira-bot" created="Tue, 2 Feb 2016 11:20:18 -0700">&lt;p&gt;Commit 70ad8316f4964d1b62b53f02e5fdf7798d5a8350 in lucene-solr's branch refs/heads/master from jbernste&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=70ad831" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=70ad831&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8631" title="Throw UnsupportedOperationException for DatabaseMetaDataImpl.getTypeInfo()" class="issue-link" data-issue-key="SOLR-8631"&gt;&lt;del&gt;SOLR-8631&lt;/del&gt;&lt;/a&gt;: Throw UnsupportedOperationException for DatabaseMetaDataImpl.getTypeInfo()&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12928429">SOLR-8510</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12785784" name="SOLR-8631.patch" size="875" author="risdenk" created="Tue, 2 Feb 2016 08:47:46 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 2 Feb 2016 12:36:05 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2s9rj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8625] SQL: Wrong error msg if stmt param is missing</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8625</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;If you call &lt;tt&gt;/sql?&lt;/tt&gt; without &lt;tt&gt;stmt&lt;/tt&gt;, the following error msg is printed:&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
&lt;span class="code-quote"&gt;"EXCEPTION"&lt;/span&gt;: &lt;span class="code-quote"&gt;"sql parameter cannot be &lt;span class="code-keyword"&gt;null&lt;/span&gt;"&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment/>
        <key id="12935562">SOLR-8625</key>
            <summary>SQL: Wrong error msg if stmt param is missing</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="janhoy">Jan Hydahl</reporter>
                        <labels>
                    </labels>
                <created>Mon, 1 Feb 2016 02:10:02 -0700</created>
                <updated>Tue, 2 Feb 2016 02:53:23 -0700</updated>
                            <resolved>Mon, 1 Feb 2016 14:48:32 -0700</resolved>
                                    <version>master</version>
                                    <fixVersion>6.0</fixVersion>
                                    <component>Parallell SQL</component>
                        <due/>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="15126116" author="joel.bernstein" created="Mon, 1 Feb 2016 04:02:19 -0700">&lt;p&gt;Good catch! This is a quick fix in the SQLHandler line 112. I can commit a fix for this today.&lt;/p&gt;</comment>
                            <comment id="15126124" author="janhoy" created="Mon, 1 Feb 2016 04:12:00 -0700">&lt;p&gt;Yep, should also move many of the inline strings into constants, and use the constant in the error msg. Some params are also shared between &lt;tt&gt;SQLHandler&lt;/tt&gt; and SolrJ's &lt;tt&gt;DriverImpl&lt;/tt&gt;.. Perhaps a new class &lt;tt&gt;SQLParameters.java&lt;/tt&gt; would be suitable?&lt;/p&gt;</comment>
                            <comment id="15126127" author="joel.bernstein" created="Mon, 1 Feb 2016 04:15:06 -0700">&lt;p&gt;Yeah makes sense. I'll make the quick fix for this ticket and open a new ticket for constants.&lt;/p&gt;</comment>
                            <comment id="15127102" author="jira-bot" created="Mon, 1 Feb 2016 14:48:12 -0700">&lt;p&gt;Commit c136bd7dc737096843ff538e172762026b895f5b in lucene-solr's branch refs/heads/master from jbernste&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c136bd7" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c136bd7&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8625" title="SQL: Wrong error msg if stmt param is missing" class="issue-link" data-issue-key="SOLR-8625"&gt;&lt;del&gt;SOLR-8625&lt;/del&gt;&lt;/a&gt;: SQL: Wrong error msg if stmt param is missing&lt;/p&gt;</comment>
                            <comment id="15127989" author="jira-bot" created="Tue, 2 Feb 2016 02:53:23 -0700">&lt;p&gt;Commit c136bd7dc737096843ff538e172762026b895f5b in lucene-solr's branch refs/heads/master-solr-8621 from jbernste&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c136bd7" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c136bd7&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8625" title="SQL: Wrong error msg if stmt param is missing" class="issue-link" data-issue-key="SOLR-8625"&gt;&lt;del&gt;SOLR-8625&lt;/del&gt;&lt;/a&gt;: SQL: Wrong error msg if stmt param is missing&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12902422">SOLR-8125</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 1 Feb 2016 11:02:19 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2s833:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8603] Implement StatementImpl.getMoreResults()</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8603</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;JiSQL requires getMoreResults to be implemented. Here is the stacktrace:&lt;/p&gt;

&lt;p&gt;java.lang.UnsupportedOperationException&lt;br/&gt;
	at org.apache.solr.client.solrj.io.sql.StatementImpl.getMoreResults(StatementImpl.java:232)&lt;br/&gt;
	at com.xigole.util.sql.Jisql.doIsql(Jisql.java:443)&lt;br/&gt;
	at com.xigole.util.sql.Jisql.run(Jisql.java:296)&lt;br/&gt;
	at com.xigole.util.sql.Jisql.main(Jisql.java:271)&lt;/p&gt;</description>
                <environment/>
        <key id="12934476">SOLR-8603</key>
            <summary>Implement StatementImpl.getMoreResults()</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12928403">SOLR-8502</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="10">Implemented</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="risdenk">Kevin Risden</reporter>
                        <labels>
                    </labels>
                <created>Wed, 27 Jan 2016 07:44:34 -0700</created>
                <updated>Fri, 29 Apr 2016 16:18:55 -0700</updated>
                            <resolved>Wed, 27 Jan 2016 12:11:11 -0700</resolved>
                                    <version>master</version>
                                    <fixVersion>6.0</fixVersion>
                                    <component>SolrJ</component>
                        <due/>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="15119355" author="risdenk" created="Wed, 27 Jan 2016 07:54:55 -0700">&lt;p&gt;Attached patch with a test.&lt;/p&gt;</comment>
                            <comment id="15119983" author="jira-bot" created="Wed, 27 Jan 2016 12:07:48 -0700">&lt;p&gt;Commit b3eb7222df82a28d344356dd856444c23341b515 in lucene-solr's branch refs/heads/master from jbernste&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b3eb722" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b3eb722&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8603" title="Implement StatementImpl.getMoreResults()" class="issue-link" data-issue-key="SOLR-8603"&gt;&lt;del&gt;SOLR-8603&lt;/del&gt;&lt;/a&gt;: Implement StatementImpl.getMoreResults()&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12784654" name="SOLR-8603.patch" size="1545" author="risdenk" created="Wed, 27 Jan 2016 07:54:55 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 27 Jan 2016 19:07:48 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2s1dz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8602] Implement ResultSetImpl.wasNull()</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8602</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;ResultSetImpl.wasNull is necessary for SQL clients to display a SQL NULL instead of 0 or false for certain get* commands.&lt;/p&gt;</description>
                <environment/>
        <key id="12934475">SOLR-8602</key>
            <summary>Implement ResultSetImpl.wasNull()</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12928403">SOLR-8502</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="10">Implemented</resolution>
                                        <assignee username="joel.bernstein">Joel Bernstein</assignee>
                                    <reporter username="risdenk">Kevin Risden</reporter>
                        <labels>
                    </labels>
                <created>Wed, 27 Jan 2016 07:41:42 -0700</created>
                <updated>Fri, 29 Apr 2016 16:19:08 -0700</updated>
                            <resolved>Thu, 28 Jan 2016 09:05:15 -0700</resolved>
                                    <version>master</version>
                                    <fixVersion>6.0</fixVersion>
                                    <component>SolrJ</component>
                        <due/>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="15119412" author="risdenk" created="Wed, 27 Jan 2016 08:12:45 -0700">&lt;p&gt;Implemented wasNull but need to add tests. This will require putting in a new column and null values in the indexr.&lt;/p&gt;</comment>
                            <comment id="15120208" author="risdenk" created="Wed, 27 Jan 2016 14:37:29 -0700">&lt;p&gt;Improved implementation and added tests&lt;/p&gt;</comment>
                            <comment id="15120216" author="risdenk" created="Wed, 27 Jan 2016 14:44:21 -0700">&lt;p&gt;Fixed on top of &lt;a href="https://issues.apache.org/jira/browse/SOLR-8520" title="Implement ResultSetMetaDataImpl getColumnLabel(int column) and getColumnDisplaySize(int column)" class="issue-link" data-issue-key="SOLR-8520"&gt;&lt;del&gt;SOLR-8520&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15120391" author="joel.bernstein" created="Wed, 27 Jan 2016 16:24:31 -0700">&lt;p&gt;Latest patch is looking good.&lt;/p&gt;</comment>
                            <comment id="15120429" author="joel.bernstein" created="Wed, 27 Jan 2016 16:46:54 -0700">&lt;p&gt;I believe in the case of the /export handler numerics will never be null. This is because numerics are read from NumericDocValues which I believe treats nulls as 0. But as you've proven with the test case, the /select handler will return null values for numerics. &lt;/p&gt;

&lt;p&gt;I was surprised to see that you could put a null value in an int field and that would behave properly.  I'm assuming the field is not added to the document if the field value is null.&lt;/p&gt;</comment>
                            <comment id="15120447" author="risdenk" created="Wed, 27 Jan 2016 16:56:28 -0700">&lt;p&gt;I want to add a few more test cases:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;testing with facet instead of map_reduce on the connection&lt;/li&gt;
	&lt;li&gt;testing with a column that doesn't exist like missingcol and see if that comes back with all nulls (not sure how something like mysql handles this)&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15120459" author="risdenk" created="Wed, 27 Jan 2016 17:05:46 -0700">&lt;p&gt;Updated complete patch with tests for missing column.&lt;/p&gt;</comment>
                            <comment id="15120467" author="joel.bernstein" created="Wed, 27 Jan 2016 17:08:19 -0700">&lt;p&gt;If we want to see how the /export handler behaves in the test case we leave the limit clause off the SQL statement and it will switch to the /export handler. I'm planning on committing the patch as is though so no need to put more work into this now.&lt;/p&gt;</comment>
                            <comment id="15120480" author="risdenk" created="Wed, 27 Jan 2016 17:15:41 -0700">&lt;p&gt;Looks like with aggregationMode=map_reduce and workers=2 then metadata tuple isn't present. If you want to commit it as is that is fine just need to figure out why this is happening.&lt;/p&gt;</comment>
                            <comment id="15120482" author="joel.bernstein" created="Wed, 27 Jan 2016 17:16:53 -0700">&lt;p&gt;Ok, I'll work with the new patch.&lt;/p&gt;

&lt;p&gt;The facet / map_reduce flag will only come into play with Select DISTINCT and GROUP BY aggregations. &lt;/p&gt;

&lt;p&gt;I think the thing to do with this is to add a jira ticket called something like "Beef up Jdbc tests". In that ticket we can add more tests for aggregations and randomize the facet / map_reduce flag.&lt;/p&gt;

&lt;p&gt;This also something that can be done outside the DBVisualizer work so we can close out &lt;a href="https://issues.apache.org/jira/browse/SOLR-8502" title="Improve Solr JDBC Driver to support SQL Clients like DBVisualizer" class="issue-link" data-issue-key="SOLR-8502"&gt;&lt;del&gt;SOLR-8502&lt;/del&gt;&lt;/a&gt; and declare victory.&lt;/p&gt;</comment>
                            <comment id="15120491" author="risdenk" created="Wed, 27 Jan 2016 17:20:46 -0700">&lt;p&gt;sounds good to me. The last attached patch 21KB ~6pm works correctly. It has tests for missing column. I'll create a beef up jdbc jira issue and can move the work there.&lt;/p&gt;</comment>
                            <comment id="15120505" author="risdenk" created="Wed, 27 Jan 2016 17:30:12 -0700">&lt;p&gt;Created &lt;a href="https://issues.apache.org/jira/browse/SOLR-8608" title="Improve SolrJ JDBC testing" class="issue-link" data-issue-key="SOLR-8608"&gt;SOLR-8608&lt;/a&gt; and linked appropriate JIRAs.&lt;/p&gt;</comment>
                            <comment id="15120522" author="joel.bernstein" created="Wed, 27 Jan 2016 17:43:35 -0700">&lt;p&gt;I'm not in a hurry. Let me know if you want me to take a look.&lt;/p&gt;</comment>
                            <comment id="15120526" author="joel.bernstein" created="Wed, 27 Jan 2016 17:47:40 -0700">&lt;p&gt;From what I can see the meta data Tuple should work OK in parallel mode.&lt;/p&gt;</comment>
                            <comment id="15120543" author="risdenk" created="Wed, 27 Jan 2016 17:58:29 -0700">&lt;p&gt;The error is related to numWorkers &amp;gt; 1 and partitionKeys not being set. I set the numWorkers to 1 currently to work around this.&lt;/p&gt;

&lt;p&gt;If limit is not used and there is a missing column then it fails getting the first tuple saying missing column. This only happens when limit is not used. The two tests for not limits are commented out.&lt;/p&gt;

&lt;p&gt;This patch improves the testing by separating out the test method to allow changing connection parameters and sql query.&lt;/p&gt;</comment>
                            <comment id="15120559" author="joel.bernstein" created="Wed, 27 Jan 2016 18:12:39 -0700">&lt;p&gt;This sounds like a you've found a bug. The SQLHandler should not be getting tripped up like that. &lt;/p&gt;</comment>
                            <comment id="15120561" author="joel.bernstein" created="Wed, 27 Jan 2016 18:14:05 -0700">&lt;p&gt;This was on a simple select no limit?&lt;/p&gt;</comment>
                            <comment id="15120565" author="joel.bernstein" created="Wed, 27 Jan 2016 18:17:39 -0700">&lt;p&gt;Weird from a code review I don't see how you would be getting that bug.&lt;/p&gt;

&lt;p&gt;Can you post the exact test that was failing?&lt;/p&gt;</comment>
                            <comment id="15120568" author="joel.bernstein" created="Wed, 27 Jan 2016 18:21:59 -0700">&lt;p&gt;I'll take you're last patch and change numWorkers=2 and see what happens.&lt;/p&gt;</comment>
                            <comment id="15120578" author="joel.bernstein" created="Wed, 27 Jan 2016 18:30:01 -0700">&lt;p&gt;I've got it reproducing. I'll figure out what the problem is.&lt;/p&gt;</comment>
                            <comment id="15120582" author="joel.bernstein" created="Wed, 27 Jan 2016 18:38:38 -0700">&lt;p&gt;Alright I found the bug. I'll work with your latest patch and add the bug fix. We'll fix this bug as part of this ticket.&lt;/p&gt;

&lt;p&gt;Good job turning up this bug.&lt;/p&gt;</comment>
                            <comment id="15120607" author="joel.bernstein" created="Wed, 27 Jan 2016 19:12:35 -0700">&lt;p&gt;Patch that moves the responsibility for setting the StreamContext to the SQLTupleStreamParser.&lt;/p&gt;

&lt;p&gt;This resolves the bug that &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=risdenk" class="user-hover" rel="risdenk"&gt;Kevin Risden&lt;/a&gt; found.&lt;/p&gt;

&lt;p&gt;The test has been changed to numWorkers=2 and now passes and existing SQL tests pass.&lt;/p&gt;</comment>
                            <comment id="15120608" author="joel.bernstein" created="Wed, 27 Jan 2016 19:13:58 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=risdenk" class="user-hover" rel="risdenk"&gt;Kevin Risden&lt;/a&gt;, let me know if you want to work some with this patch or if you think it's ready to go.&lt;/p&gt;</comment>
                            <comment id="15120719" author="risdenk" created="Wed, 27 Jan 2016 21:09:43 -0700">&lt;p&gt;It looks good except that lines 372 and 373 are commented out. in JdbcTest. Those 2 lines are tests for a sql statement without a limit. "missingcol" isn't a real column in the schema, but is part of the select statement. This may or may not be valid SQL, but I thought it was.&lt;/p&gt;

&lt;p&gt;If those tests are run, then the following error occurs at the client:&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
java.sql.SQLException: java.lang.RuntimeException: Couldn't get the first tuple

	at __randomizedtesting.SeedInfo.seed([26B9AF1BDBAE7536:81FD17BFB615668F]:0)
	at org.apache.solr.client.solrj.io.sql.StatementImpl.executeQuery(StatementImpl.java:78)
	at org.apache.solr.client.solrj.io.sql.JdbcTest.testJDBCMethods(JdbcTest.java:400)
	at org.apache.solr.client.solrj.io.sql.JdbcTest.testDriverMetadata(JdbcTest.java:372)
	at org.apache.solr.client.solrj.io.sql.JdbcTest.doTest(JdbcTest.java:353)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:483)
	at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1764)
	at com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:871)
	at com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:907)
	at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:921)
	at org.apache.solr.BaseDistributedSearchTestCase$ShardsRepeatRule$ShardsFixedStatement.callStatement(BaseDistributedSearchTestCase.java:965)
	at org.apache.solr.BaseDistributedSearchTestCase$ShardsRepeatRule$ShardsStatement.evaluate(BaseDistributedSearchTestCase.java:940)
	at com.carrotsearch.randomizedtesting.rules.SystemPropertiesRestoreRule$1.evaluate(SystemPropertiesRestoreRule.java:57)
	at org.apache.lucene.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:50)
	at org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:46)
	at org.apache.lucene.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:49)
	at org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:65)
	at org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:48)
	at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
	at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:367)
	at com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:809)
	at com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:460)
	at com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:880)
	at com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:781)
	at com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:816)
	at com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:827)
	at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
	at com.carrotsearch.randomizedtesting.rules.SystemPropertiesRestoreRule$1.evaluate(SystemPropertiesRestoreRule.java:57)
	at org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:46)
	at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
	at org.apache.lucene.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:42)
	at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
	at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
	at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
	at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
	at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
	at org.apache.lucene.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:54)
	at org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:48)
	at org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:65)
	at org.apache.lucene.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:55)
	at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
	at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:367)
	at java.lang.&lt;span class="code-object"&gt;Thread&lt;/span&gt;.run(&lt;span class="code-object"&gt;Thread&lt;/span&gt;.java:745)
Caused by: java.lang.RuntimeException: Couldn't get the first tuple
	at org.apache.solr.client.solrj.io.sql.ResultSetImpl.&amp;lt;init&amp;gt;(ResultSetImpl.java:71)
	at org.apache.solr.client.solrj.io.sql.StatementImpl.executeQuery(StatementImpl.java:75)
	... 44 more
Caused by: java.io.IOException: --&amp;gt; http:&lt;span class="code-comment"&gt;//127.0.0.1:59212/sjm/vx/collection1/:java.util.concurrent.ExecutionException: java.io.IOException: --&amp;gt; http://127.0.0.1:59212/sjm/vx/collection1/:org.apache.solr.common.SolrException: undefined field: &lt;span class="code-quote"&gt;"missingcol"&lt;/span&gt;
&lt;/span&gt;	at org.apache.solr.client.solrj.io.stream.SolrStream.read(SolrStream.java:178)
	at org.apache.solr.client.solrj.io.stream.PushBackStream.read(PushBackStream.java:83)
	at org.apache.solr.client.solrj.io.sql.ResultSetImpl.&amp;lt;init&amp;gt;(ResultSetImpl.java:64)
	... 45 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The underlying error from the server is actually this:&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
15540 ERROR (qtp601677615-98) [n:127.0.0.1:59216_sjm%2Fvx c:collection1 s:shard1 r:core_node2 x:collection1] o.a.s.r.SortingResponseWriter java.io.IOException: org.apache.solr.common.SolrException: undefined field: &lt;span class="code-quote"&gt;"missingcol"&lt;/span&gt;
	at org.apache.solr.response.SortingResponseWriter.getFieldWriters(SortingResponseWriter.java:274)
	at org.apache.solr.response.SortingResponseWriter.write(SortingResponseWriter.java:133)
	at org.apache.solr.response.QueryResponseWriterUtil.writeQueryResponse(QueryResponseWriterUtil.java:53)
	at org.apache.solr.servlet.HttpSolrCall.writeResponse(HttpSolrCall.java:744)
	at org.apache.solr.servlet.HttpSolrCall.call(HttpSolrCall.java:468)
	at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:226)
	at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:184)
	at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1652)
	at org.apache.solr.client.solrj.embedded.JettySolrRunner$DebugFilter.doFilter(JettySolrRunner.java:110)
	at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1652)
	at org.eclipse.jetty.servlets.UserAgentFilter.doFilter(UserAgentFilter.java:83)
	at org.eclipse.jetty.servlets.GzipFilter.doFilter(GzipFilter.java:300)
	at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1652)
	at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:585)
	at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:221)
	at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1127)
	at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:515)
	at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:185)
	at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1061)
	at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141)
	at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:97)
	at org.eclipse.jetty.server.Server.handle(Server.java:499)
	at org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:310)
	at org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:257)
	at org.eclipse.jetty.io.AbstractConnection$2.run(AbstractConnection.java:540)
	at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:635)
	at org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:555)
	at java.lang.&lt;span class="code-object"&gt;Thread&lt;/span&gt;.run(&lt;span class="code-object"&gt;Thread&lt;/span&gt;.java:745)
Caused by: org.apache.solr.common.SolrException: undefined field: &lt;span class="code-quote"&gt;"missingcol"&lt;/span&gt;
	at org.apache.solr.schema.IndexSchema.getField(IndexSchema.java:1211)
	at org.apache.solr.response.SortingResponseWriter.getFieldWriters(SortingResponseWriter.java:272)
	... 27 more

15540 ERROR (qtp212013910-69) [n:127.0.0.1:59212_sjm%2Fvx c:collection1 s:shard2 r:core_node1 x:collection1] o.a.s.r.SortingResponseWriter java.io.IOException: org.apache.solr.common.SolrException: undefined field: &lt;span class="code-quote"&gt;"missingcol"&lt;/span&gt;
	at org.apache.solr.response.SortingResponseWriter.getFieldWriters(SortingResponseWriter.java:274)
	at org.apache.solr.response.SortingResponseWriter.write(SortingResponseWriter.java:133)
	at org.apache.solr.response.QueryResponseWriterUtil.writeQueryResponse(QueryResponseWriterUtil.java:53)
	at org.apache.solr.servlet.HttpSolrCall.writeResponse(HttpSolrCall.java:744)
	at org.apache.solr.servlet.HttpSolrCall.call(HttpSolrCall.java:468)
	at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:226)
	at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:184)
	at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1652)
	at org.apache.solr.client.solrj.embedded.JettySolrRunner$DebugFilter.doFilter(JettySolrRunner.java:110)
	at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1652)
	at org.eclipse.jetty.servlets.UserAgentFilter.doFilter(UserAgentFilter.java:83)
	at org.eclipse.jetty.servlets.GzipFilter.doFilter(GzipFilter.java:300)
	at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1652)
	at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:585)
	at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:221)
	at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1127)
	at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:515)
	at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:185)
	at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1061)
	at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141)
	at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:97)
	at org.eclipse.jetty.server.Server.handle(Server.java:499)
	at org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:310)
	at org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:257)
	at org.eclipse.jetty.io.AbstractConnection$2.run(AbstractConnection.java:540)
	at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:635)
	at org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:555)
	at java.lang.&lt;span class="code-object"&gt;Thread&lt;/span&gt;.run(&lt;span class="code-object"&gt;Thread&lt;/span&gt;.java:745)
Caused by: org.apache.solr.common.SolrException: undefined field: &lt;span class="code-quote"&gt;"missingcol"&lt;/span&gt;
	at org.apache.solr.schema.IndexSchema.getField(IndexSchema.java:1211)
	at org.apache.solr.response.SortingResponseWriter.getFieldWriters(SortingResponseWriter.java:272)
	... 27 more

15544 ERROR (qtp212013910-70) [n:127.0.0.1:59212_sjm%2Fvx c:collection1 s:shard2 r:core_node1 x:collection1] o.a.s.c.s.i.s.ExceptionStream java.io.IOException: java.util.concurrent.ExecutionException: java.io.IOException: --&amp;gt; http:&lt;span class="code-comment"&gt;//127.0.0.1:59212/sjm/vx/collection1/:org.apache.solr.common.SolrException: undefined field: &lt;span class="code-quote"&gt;"missingcol"&lt;/span&gt;
&lt;/span&gt;	at org.apache.solr.client.solrj.io.stream.CloudSolrStream.openStreams(CloudSolrStream.java:356)
	at org.apache.solr.client.solrj.io.stream.CloudSolrStream.open(CloudSolrStream.java:237)
	at org.apache.solr.client.solrj.io.stream.SelectStream.open(SelectStream.java:154)
	at org.apache.solr.handler.SQLHandler$MetadataStream.open(SQLHandler.java:1374)
	at org.apache.solr.client.solrj.io.stream.ExceptionStream.open(ExceptionStream.java:48)
	at org.apache.solr.handler.StreamHandler$TimerStream.open(StreamHandler.java:362)
	at org.apache.solr.response.TextResponseWriter.writeTupleStream(TextResponseWriter.java:303)
	at org.apache.solr.response.TextResponseWriter.writeVal(TextResponseWriter.java:169)
	at org.apache.solr.response.JSONWriter.writeNamedListAsMapWithDups(JSONResponseWriter.java:184)
	at org.apache.solr.response.JSONWriter.writeNamedList(JSONResponseWriter.java:300)
	at org.apache.solr.response.JSONWriter.writeResponse(JSONResponseWriter.java:96)
	at org.apache.solr.response.JSONResponseWriter.write(JSONResponseWriter.java:61)
	at org.apache.solr.response.QueryResponseWriterUtil.writeQueryResponse(QueryResponseWriterUtil.java:53)
	at org.apache.solr.servlet.HttpSolrCall.writeResponse(HttpSolrCall.java:744)
	at org.apache.solr.servlet.HttpSolrCall.call(HttpSolrCall.java:468)
	at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:226)
	at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:184)
	at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1652)
	at org.apache.solr.client.solrj.embedded.JettySolrRunner$DebugFilter.doFilter(JettySolrRunner.java:110)
	at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1652)
	at org.eclipse.jetty.servlets.UserAgentFilter.doFilter(UserAgentFilter.java:83)
	at org.eclipse.jetty.servlets.GzipFilter.doFilter(GzipFilter.java:300)
	at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1652)
	at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:585)
	at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:221)
	at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1127)
	at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:515)
	at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:185)
	at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1061)
	at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141)
	at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:97)
	at org.eclipse.jetty.server.Server.handle(Server.java:499)
	at org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:310)
	at org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:257)
	at org.eclipse.jetty.io.AbstractConnection$2.run(AbstractConnection.java:540)
	at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:635)
	at org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:555)
	at java.lang.&lt;span class="code-object"&gt;Thread&lt;/span&gt;.run(&lt;span class="code-object"&gt;Thread&lt;/span&gt;.java:745)
Caused by: java.util.concurrent.ExecutionException: java.io.IOException: --&amp;gt; http:&lt;span class="code-comment"&gt;//127.0.0.1:59212/sjm/vx/collection1/:org.apache.solr.common.SolrException: undefined field: &lt;span class="code-quote"&gt;"missingcol"&lt;/span&gt;
&lt;/span&gt;	at java.util.concurrent.FutureTask.report(FutureTask.java:122)
	at java.util.concurrent.FutureTask.get(FutureTask.java:192)
	at org.apache.solr.client.solrj.io.stream.CloudSolrStream.openStreams(CloudSolrStream.java:350)
	... 37 more
Caused by: java.io.IOException: --&amp;gt; http:&lt;span class="code-comment"&gt;//127.0.0.1:59212/sjm/vx/collection1/:org.apache.solr.common.SolrException: undefined field: &lt;span class="code-quote"&gt;"missingcol"&lt;/span&gt;
&lt;/span&gt;	at org.apache.solr.client.solrj.io.stream.SolrStream.read(SolrStream.java:178)
	at org.apache.solr.client.solrj.io.stream.CloudSolrStream$TupleWrapper.next(CloudSolrStream.java:444)
	at org.apache.solr.client.solrj.io.stream.CloudSolrStream$StreamOpener.call(CloudSolrStream.java:467)
	at org.apache.solr.client.solrj.io.stream.CloudSolrStream$StreamOpener.call(CloudSolrStream.java:454)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at org.apache.solr.common.util.ExecutorUtil$MDCAwareThreadPoolExecutor$1.run(ExecutorUtil.java:232)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
	... 1 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15120721" author="risdenk" created="Wed, 27 Jan 2016 21:13:35 -0700">&lt;p&gt;If this is a valid SQL statement then it needs to work for both limit and non limit statements. If it is NOT valid then it needs to not work for both limit and non limit statements. Currently it is handled differently between limit and non limit statements which is weird to me.&lt;/p&gt;</comment>
                            <comment id="15121356" author="joel.bernstein" created="Thu, 28 Jan 2016 05:36:23 -0700">&lt;p&gt;There are lot's of inconsistencies between limited and unlimited queries. For example limited queries can return any stored field and unlimited queries can only return docValues fields. The reason these inconsistencies exist is that the /export handler has much tighter restrictions then the /select handler. For the early SQL releases we can just document these inconsistencies.&lt;/p&gt;</comment>
                            <comment id="15121365" author="joel.bernstein" created="Thu, 28 Jan 2016 05:45:47 -0700">&lt;p&gt;I was just reviewing the exception handling in ResultSetImpl constructor. It looks ok but wanted to check to make sure the underlying error was being thrown properly in the driver. For example did the DBVisualizer debug panel display the message about the numWorkers error.&lt;/p&gt;

&lt;p&gt;The way this works is that the SolrStream recognizes errors coming from the server through a flag in the Tuple. If it sees this flag it throws an Exception with the message. This should have been thrown on the first call to read() with the numWorker error.&lt;/p&gt;</comment>
                            <comment id="15121375" author="joel.bernstein" created="Thu, 28 Jan 2016 05:57:33 -0700">&lt;p&gt;Doing some more review. That particular exception would have been thrown during the open() call on the server. This should have caused the first Tuple read in the jdbc driver to throw an exception with the correct message from the server.&lt;/p&gt;</comment>
                            <comment id="15121417" author="risdenk" created="Thu, 28 Jan 2016 06:25:38 -0700">&lt;p&gt;The issue was that there was no exception added to the RuntimeException. It was missing the argument after the message. I updated the patch to include adding the exception to the RunTimeException. I am uploading a new patch with the exception handling being better.&lt;/p&gt;</comment>
                            <comment id="15121418" author="risdenk" created="Thu, 28 Jan 2016 06:26:05 -0700">&lt;p&gt;Improve exception handling so that the underlying exception is thrown where applicable.&lt;/p&gt;</comment>
                            <comment id="15121460" author="joel.bernstein" created="Thu, 28 Jan 2016 06:39:52 -0700">&lt;p&gt;What was the change in this patch?&lt;/p&gt;</comment>
                            <comment id="15121468" author="risdenk" created="Thu, 28 Jan 2016 06:42:10 -0700">&lt;p&gt;changed new RuntimeException(MESSAGE) to new RuntimeException(MESSAGE, ERROR) in ResultSetImpl. This propagates the error up the client instead of swallowing why stream.read failed.&lt;/p&gt;</comment>
                            <comment id="15121489" author="joel.bernstein" created="Thu, 28 Jan 2016 06:52:19 -0700">&lt;p&gt;The code I was reviewing already was doing that in the constructor. Was there another place?&lt;/p&gt;</comment>
                            <comment id="15121492" author="risdenk" created="Thu, 28 Jan 2016 06:53:24 -0700">&lt;p&gt;For reference, on MySQL "select id, bad from test" results in an invalid field bad error. This means that limit statements are doing the wrong thing right now. Filed &lt;a href="https://issues.apache.org/jira/browse/SOLR-8613" title="SolrJ JDBC - SQL queries with limit do not fail when a bad column is provided" class="issue-link" data-issue-key="SOLR-8613"&gt;SOLR-8613&lt;/a&gt; for this issue.&lt;/p&gt;</comment>
                            <comment id="15121497" author="risdenk" created="Thu, 28 Jan 2016 06:55:12 -0700">&lt;p&gt;Hmmmm guess I had changed it already. I also consolidated the try/catch in the constructor so it will throw the same error if either the first tuple or the metadata tuple fails to be read.&lt;/p&gt;</comment>
                            <comment id="15121563" author="joel.bernstein" created="Thu, 28 Jan 2016 07:27:35 -0700">&lt;p&gt;Ok, I'll review.&lt;/p&gt;</comment>
                            <comment id="15121667" author="joel.bernstein" created="Thu, 28 Jan 2016 08:17:19 -0700">&lt;p&gt;I think the error handling in ResultSetImpl constructor is correct in the latest patch.&lt;/p&gt;
</comment>
                            <comment id="15121754" author="joel.bernstein" created="Thu, 28 Jan 2016 08:50:00 -0700">&lt;p&gt;Currently the result set tests are only testing queries with a limit clause. I'm going to have to leave it that way for now because the the /export handler doesn't handle null values at all currently. There is an open ticket for this (&lt;a href="https://issues.apache.org/jira/browse/SOLR-8285" title="Ensure the /export handler works with NULL field values." class="issue-link" data-issue-key="SOLR-8285"&gt;&lt;del&gt;SOLR-8285&lt;/del&gt;&lt;/a&gt;). When I work on &lt;a href="https://issues.apache.org/jira/browse/SOLR-8285" title="Ensure the /export handler works with NULL field values." class="issue-link" data-issue-key="SOLR-8285"&gt;&lt;del&gt;SOLR-8285&lt;/del&gt;&lt;/a&gt; I'll rework the JDBC tests to reflect the different null handling behaviors of the /select handler and the /export handler.&lt;/p&gt;</comment>
                            <comment id="15121776" author="joel.bernstein" created="Thu, 28 Jan 2016 09:01:53 -0700">&lt;p&gt;Planning on committing this shortly.&lt;/p&gt;
</comment>
                            <comment id="15121784" author="jira-bot" created="Thu, 28 Jan 2016 09:04:21 -0700">&lt;p&gt;Commit 79e384bac5604fe999bd7293ea568b8ad7a014c7 in lucene-solr's branch refs/heads/master from jbernste&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=79e384b" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=79e384b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8602" title="Implement ResultSetImpl.wasNull()" class="issue-link" data-issue-key="SOLR-8602"&gt;&lt;del&gt;SOLR-8602&lt;/del&gt;&lt;/a&gt;: Implement ResultSetImpl.wasNull()&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12934641">SOLR-8608</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12934811">SOLR-8613</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12784915" name="SOLR-8602.patch" size="26114" author="risdenk" created="Thu, 28 Jan 2016 06:26:05 -0700"/>
                            <attachment id="12784799" name="SOLR-8602.patch" size="25928" author="joel.bernstein" created="Wed, 27 Jan 2016 19:12:35 -0700"/>
                            <attachment id="12784791" name="SOLR-8602.patch" size="23088" author="risdenk" created="Wed, 27 Jan 2016 17:58:29 -0700"/>
                            <attachment id="12784783" name="SOLR-8602.patch" size="21344" author="risdenk" created="Wed, 27 Jan 2016 17:05:46 -0700"/>
                            <attachment id="12784729" name="SOLR-8602.patch" size="17606" author="risdenk" created="Wed, 27 Jan 2016 14:44:21 -0700"/>
                            <attachment id="12784726" name="SOLR-8602.patch" size="17301" author="risdenk" created="Wed, 27 Jan 2016 14:37:29 -0700"/>
                            <attachment id="12784657" name="SOLR-8602.patch" size="6476" author="risdenk" created="Wed, 27 Jan 2016 08:12:45 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 27 Jan 2016 23:24:31 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2s1dr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8599] Errors in construction of SolrZooKeeper cause Solr to go into an inconsistent state</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8599</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;We originally saw this happen due to a DNS exception (see stack trace below). Although any exception thrown in the constructor of SolrZooKeeper or the parent class, ZooKeeper, will cause DefaultConnectionStrategy to fail to update the zookeeper client. Once it gets into this state, it will not try to connect again until the process is restarted. The node itself will also respond successfully to query requests, but not to update requests.&lt;/p&gt;

&lt;p&gt;Two things should be address here:&lt;br/&gt;
1) Fix the error handling and issue some number of retries&lt;br/&gt;
2) If we are stuck in a state like this stop responding to all requests &lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
2016-01-23 13:49:20.222 ERROR ConnectionManager [main-EventThread] - :java.net.UnknownHostException: HOSTNAME: unknown error
at java.net.Inet6AddressImpl.lookupAllHostAddr(Native Method)
at java.net.InetAddress$2.lookupAllHostAddr(InetAddress.java:928)
at java.net.InetAddress.getAddressesFromNameService(InetAddress.java:1323)
at java.net.InetAddress.getAllByName0(InetAddress.java:1276)
at java.net.InetAddress.getAllByName(InetAddress.java:1192)
at java.net.InetAddress.getAllByName(InetAddress.java:1126)
at org.apache.zookeeper.client.StaticHostProvider.&amp;lt;init&amp;gt;(StaticHostProvider.java:61)
at org.apache.zookeeper.ZooKeeper.&amp;lt;init&amp;gt;(ZooKeeper.java:445)
at org.apache.zookeeper.ZooKeeper.&amp;lt;init&amp;gt;(ZooKeeper.java:380)
at org.apache.solr.common.cloud.SolrZooKeeper.&amp;lt;init&amp;gt;(SolrZooKeeper.java:41)
at org.apache.solr.common.cloud.DefaultConnectionStrategy.reconnect(DefaultConnectionStrategy.java:53)
at org.apache.solr.common.cloud.ConnectionManager.process(ConnectionManager.java:132)
at org.apache.zookeeper.ClientCnxn$EventThread.processEvent(ClientCnxn.java:522)
at org.apache.zookeeper.ClientCnxn$EventThread.run(ClientCnxn.java:498)
2016-01-23 13:49:20.222 INFO ConnectionManager [main-EventThread] - Connected:&lt;span class="code-keyword"&gt;false&lt;/span&gt;
2016-01-23 13:49:20.222 INFO ClientCnxn [main-EventThread] - EventThread shut down
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment/>
        <key id="12934145">SOLR-8599</key>
            <summary>Errors in construction of SolrZooKeeper cause Solr to go into an inconsistent state</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dpgove">Dennis Gove</assignee>
                                    <reporter username="k317h">Keith Laban</reporter>
                        <labels>
                    </labels>
                <created>Tue, 26 Jan 2016 09:09:07 -0700</created>
                <updated>Thu, 21 Apr 2016 15:57:00 -0700</updated>
                            <resolved>Thu, 21 Apr 2016 15:57:00 -0700</resolved>
                                                    <fixVersion>5.5.1</fixVersion>
                    <fixVersion>6.0</fixVersion>
                    <fixVersion>master</fixVersion>
                                    <component>SolrCloud</component>
                        <due/>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="15120426" author="k317h" created="Wed, 27 Jan 2016 16:45:28 -0700">&lt;p&gt;Added a patch to address issue #1. In this patch I had to remove &lt;tt&gt;final&lt;/tt&gt; clause for &lt;tt&gt;ZkServerAddress&lt;/tt&gt; and add a public setter method in order to test the issue&lt;/p&gt;</comment>
                            <comment id="15141360" author="dpgove" created="Wed, 10 Feb 2016 11:14:48 -0700">&lt;p&gt;This fails the forbidden api precommit check.&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
[forbidden-apis] Forbidden method invocation: java.util.concurrent.Executors#newSingleThreadScheduledExecutor() [Spawns threads with vague names; use a custom thread factory (Lucene's NamedThreadFactory, Solr's DefaultSolrThreadFactory) and name threads so that you can tell (by its name) which executor it is associated with]
[forbidden-apis]   in org.apache.solr.cloud.ConnectionManagerTest (ConnectionManagerTest.java:119)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15143635" author="k317h" created="Thu, 11 Feb 2016 15:37:19 -0700">&lt;p&gt;added usage of DefaultSolrThreadFactory to test&lt;/p&gt;</comment>
                            <comment id="15157644" author="dpgove" created="Mon, 22 Feb 2016 13:26:15 -0700">&lt;p&gt;I have somewhat of an interesting situation at hand here.&lt;/p&gt;

&lt;p&gt;As part of this patch a test is added to ConnectionManagerTest which forces a DNS failure on the zookeeper connection by attempting to connect to "BADADDRESS" and then fixing it after 5 seconds. This shows that the change Keith put in ConnectionManager will continually try to make a connection until it can. It's a good test and it exercises the bug and fix perfectly.&lt;/p&gt;

&lt;p&gt;However, the test depends on my ISP. I've run the test under 5 scenarios and only 3 of them pass. &lt;/p&gt;

&lt;p&gt;1. Connected to my corporate network&lt;br/&gt;
In this scenario the test passes perfectly as it should.&lt;/p&gt;

&lt;p&gt;2. Connected to no network (ie, wifi card turned off)&lt;br/&gt;
In this scenario the test passes perfectly as it should.&lt;/p&gt;

&lt;p&gt;3. Connected to my home network backed by Verizon FIOS&lt;br/&gt;
In this scenario the test hangs and upon further investigation I found that it is in an "infinite" loop in ConnectionManager::waitForConnected. This appears to be an infinite loop because while there is a timeout the timeout is Long.MAX_VALUE. The problem here is that the loop waits until it is either connected or closed. Neither of those conditions are ever hit. But why? We're trying to hit &lt;a href="http://BADADDRESS" class="external-link" rel="nofollow"&gt;http://BADADDRESS&lt;/a&gt; and clearly that is a DNS lookup failure. Oh no no no, not according to Verizon. See, Verizon instead says "Oh, you must've typed something in wrong so instead of returning to you a DNS failure let me return to you a redirect to a search page - you clearly want this search page". It appears that because of this redirection a connection is never made nor is it ever closed. Hence, loop forever. &lt;/p&gt;

&lt;p&gt;4. Connected to my personal wifi hotspot backed by T-Mobile&lt;br/&gt;
Same issue as seen with Verizon FIOS, though a T-Mobile specific search page. &lt;/p&gt;

&lt;p&gt;5. Connected to a hotspot through my iPhone backed by Verizon Wireless&lt;br/&gt;
In this scenario the test passes perfectly as it should.&lt;/p&gt;

&lt;p&gt;Note that this difference is &lt;b&gt;only&lt;/b&gt; seen when a DNS lookup failure is in play. If I change the bad address to "http://BADADDRESS" then it fails instead because "//BADADDRESSIS" is said to be an invalid path string. Technically this is testing a slightly different case but I'm comfortable calling it the same test because the issue being corrected is a failure to make a connection during the construction of SolrZooKeeper and a malformed url fails just the same.&lt;/p&gt;</comment>
                            <comment id="15157810" author="markrmiller@gmail.com" created="Mon, 22 Feb 2016 15:10:04 -0700">&lt;p&gt;Yeah, we try to avoid that in tests due to dns hijacking. I think there is an ip6 address that works for this? &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi" class="user-hover" rel="thetaphi"&gt;Uwe Schindler&lt;/a&gt;, am I remembering right?&lt;/p&gt;</comment>
                            <comment id="15157834" author="thetaphi" created="Mon, 22 Feb 2016 15:24:52 -0700">&lt;p&gt;Hi,&lt;br/&gt;
please don't write tests that rely on DNS failures. Every local provider does something else, but not all return a correct "not found". Unless we have a "mock DNS server", we cannot use any DNS in Solr tests. For similar reasons we also do not use "localhost" as hostname, but instead use 127.0.0.1 as IP address.&lt;/p&gt;

&lt;p&gt;To have some broken address that always fails to connect to, use an IPv6 address that is standardized to be routed nowhere and already refused by the Hosts's IPv6 stack. According to spec one possible address is: &lt;tt&gt;&lt;a href="http://[ff01::114]:anyport/" class="external-link" rel="nofollow"&gt;http://[ff01::114]:anyport/&lt;/a&gt;&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;As example look at SolrExceptionTest.java&lt;/p&gt;

&lt;p&gt;FYI, &lt;tt&gt;ff01::&lt;/tt&gt; is the address range for local Multicast addresses, but only &lt;tt&gt;ff01::1&lt;/tt&gt; (all local nodes) and &lt;tt&gt;ff01::2&lt;/tt&gt; (all routers) are allowed in IPv6 networks. &lt;tt&gt;ff01::114&lt;/tt&gt; is plain invalid and refused by host's TCP stack for using in TCP connections. So it is guaranteed to fail.&lt;/p&gt;</comment>
                            <comment id="15158011" author="jira-bot" created="Mon, 22 Feb 2016 17:26:07 -0700">&lt;p&gt;Commit 2c0a5e30364d83dc82383075a5f7c65200022494 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dpgove" class="user-hover" rel="dpgove"&gt;Dennis Gove&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=2c0a5e3" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=2c0a5e3&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8599" title="Errors in construction of SolrZooKeeper cause Solr to go into an inconsistent state" class="issue-link" data-issue-key="SOLR-8599"&gt;&lt;del&gt;SOLR-8599&lt;/del&gt;&lt;/a&gt;: After a failed connection during construction of SolrZkClient attempt to retry until a connection can be made&lt;/p&gt;</comment>
                            <comment id="15158017" author="dpgove" created="Mon, 22 Feb 2016 17:32:05 -0700">&lt;p&gt;Thanks. I'll keep that in mind going forward - and I agree, depending on a DNS failure was ripe for issues down the road. As the test was changed to instead rely on an invalid url I think what's in there will be good. New attachment forthcoming.&lt;/p&gt;</comment>
                            <comment id="15158022" author="dpgove" created="Mon, 22 Feb 2016 17:35:26 -0700">&lt;p&gt;New patch with slightly updated test. This now causes an exception due to an invalid url instead of a DNS failure. It exposes the same issue being fixed and the test shows that the patch does in fact resolve it. This patch is what was committed in 2c0a5e30364d83dc82383075a5f7c65200022494.&lt;/p&gt;</comment>
                            <comment id="15158459" author="thetaphi" created="Tue, 23 Feb 2016 00:30:38 -0700">&lt;p&gt;Hi,&lt;br/&gt;
why not make the setter of the zkAddress package private? Test is in same package, so it does not need to be fully public!&lt;/p&gt;</comment>
                            <comment id="15158473" author="thetaphi" created="Tue, 23 Feb 2016 00:37:20 -0700">&lt;p&gt;In addition there is a bug in the test: It sets the "correct" server address in another thread but there is no synchronization. This may work many times but fails easily, especially on highly parallel CPU architectures! Making the zkServerAddress volatile would be a fix, but as its for testing only, it is not a good idea.&lt;/p&gt;</comment>
                            <comment id="15158506" author="thetaphi" created="Tue, 23 Feb 2016 01:01:44 -0700">&lt;p&gt;Hi, I would go a completely other route to test this:&lt;/p&gt;
&lt;ul class="alternate" type="square"&gt;
	&lt;li&gt;make the zkAddress final again. The change here will not work correctly in Multi-CPU environments. Also it is always a bad idea to "suddenly" change accessibility of fields&lt;/li&gt;
	&lt;li&gt;instead of trying to connect to a wronmg address, we should emulate what is really the issue: the same address does not resolve or work. The correct way to "emulate" this failure is to intercept the connection to zookeeper. All socket connections in Java are handled through a SocketFactory. During the test you can exchange the default SocketFactory by a custom one that throws IOException, if the connect address is the one in the test and delegate otherwise (to not break other stuff like HTTP connections,...). After a few seconds restore the original socket factory (and also in finally!!!). By this we emulate the real failure and we dont need to use "bad"/"invalid" adresses. You can also throw the real execption like &lt;tt&gt;java.net.UnknownHostException&lt;/tt&gt;.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Beware: This may not work, if Zookeeper caches the socketfactory internally, but that is unlikely.&lt;/p&gt;</comment>
                            <comment id="15158511" author="thetaphi" created="Tue, 23 Feb 2016 01:07:03 -0700">&lt;p&gt;2nd: Do we really need to wait 5 !!! seconds in this test? This is horrible for people running the test! At least you should mark it with @Slow so it only runs nightly.&lt;/p&gt;</comment>
                            <comment id="15158520" author="thetaphi" created="Tue, 23 Feb 2016 01:15:44 -0700">&lt;p&gt;Ah, the whole test is marked as slow.&lt;/p&gt;</comment>
                            <comment id="15189585" author="k317h" created="Thu, 10 Mar 2016 10:24:36 -0700">&lt;p&gt;uploaded a new patch against master addressing Uwes concerns. I see that this was already merged in master, but that seems to be the only branch its currently on so hopefully its ok to put this out there.&lt;/p&gt;

&lt;p&gt;Instead of scheduling a thread to change the address I was able to mock the DefaultConnectionStrategy to throw an exception in the reconnect call the first time its called to verify that it is being retried. With this change I also changed the server address to be final again and removed the public setter method seeing how they were no longer needed&lt;/p&gt;

&lt;p&gt;Note: The new patch doesn't have the changes which introduced the retry logic in &lt;tt&gt;ConnectionManager&lt;/tt&gt; since that part is already merged in on the master branch and branch_6x/branch_6_0. I can put in a separate patch containing both for backport to branch_5x if needed&lt;/p&gt;</comment>
                            <comment id="15203380" author="jira-bot" created="Sun, 20 Mar 2016 10:33:08 -0700">&lt;p&gt;Commit e3b785a906d6f93e04f2cb45c436516158af0425 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dpgove" class="user-hover" rel="dpgove"&gt;Dennis Gove&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e3b785a" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e3b785a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8599" title="Errors in construction of SolrZooKeeper cause Solr to go into an inconsistent state" class="issue-link" data-issue-key="SOLR-8599"&gt;&lt;del&gt;SOLR-8599&lt;/del&gt;&lt;/a&gt;: Improved the tests for this issue to avoid changing a variable to non-final&lt;/p&gt;</comment>
                            <comment id="15252692" author="anshumg" created="Thu, 21 Apr 2016 13:47:38 -0700">&lt;p&gt;I see this in the CHANGE log for 6.0 but there's no Fix version. I guess this was just a mistake. Please correct me if I'm missing something here.&lt;br/&gt;
I'm also back porting this for 5.5.1.&lt;/p&gt;</comment>
                            <comment id="15252720" author="k317h" created="Thu, 21 Apr 2016 14:00:50 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anshumg" class="user-hover" rel="anshumg"&gt;Anshum Gupta&lt;/a&gt; There were two separate commits for this ticket, but they didn't all land on 6x or 6.0 but are both on master:&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
commit e3b785a906d6f93e04f2cb45c436516158af0425
Author: Dennis Gove &amp;lt;dpgove@gmail.com&amp;gt;
Date:   Sun Mar 20 11:13:56 2016 -0400

    SOLR-8599: Improved the tests &lt;span class="code-keyword"&gt;for&lt;/span&gt; &lt;span class="code-keyword"&gt;this&lt;/span&gt; issue to avoid changing a variable to non-&lt;span class="code-keyword"&gt;final&lt;/span&gt;

commit 2c0a5e30364d83dc82383075a5f7c65200022494
Author: Dennis Gove &amp;lt;dpgove@gmail.com&amp;gt;
Date:   Wed Feb 10 15:02:18 2016 -0500

    SOLR-8599: After a failed connection during construction of SolrZkClient attempt to retry until a connection can be made
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;however only the first commit found its way to 6x and 6.0 so please port that second commit and remember to port both for 5.5.1, thanks&lt;/p&gt;</comment>
                            <comment id="15252814" author="jira-bot" created="Thu, 21 Apr 2016 14:49:24 -0700">&lt;p&gt;Commit d9875832f4798e5f732f4ae5627c7b306ccafa9c in lucene-solr's branch refs/heads/branch_5x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dpgove" class="user-hover" rel="dpgove"&gt;Dennis Gove&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d987583" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d987583&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8599" title="Errors in construction of SolrZooKeeper cause Solr to go into an inconsistent state" class="issue-link" data-issue-key="SOLR-8599"&gt;&lt;del&gt;SOLR-8599&lt;/del&gt;&lt;/a&gt;: After a failed connection during construction of SolrZkClient attempt to retry until a connection can be made&lt;/p&gt;</comment>
                            <comment id="15252815" author="jira-bot" created="Thu, 21 Apr 2016 14:49:25 -0700">&lt;p&gt;Commit 20e2caba9615e19f84fbcc59a950fb197385592e in lucene-solr's branch refs/heads/branch_5x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dpgove" class="user-hover" rel="dpgove"&gt;Dennis Gove&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=20e2cab" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=20e2cab&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8599" title="Errors in construction of SolrZooKeeper cause Solr to go into an inconsistent state" class="issue-link" data-issue-key="SOLR-8599"&gt;&lt;del&gt;SOLR-8599&lt;/del&gt;&lt;/a&gt;: Improved the tests for this issue to avoid changing a variable to non-final&lt;/p&gt;</comment>
                            <comment id="15252863" author="anshumg" created="Thu, 21 Apr 2016 15:13:11 -0700">&lt;p&gt;Thanks Keith. We need to track these better &lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/smile.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt;&lt;br/&gt;
I'll commit the other one to 6x too. I got both of them to 5x and I'm about to commit these to 5.5.&lt;/p&gt;</comment>
                            <comment id="15252867" author="jira-bot" created="Thu, 21 Apr 2016 15:14:51 -0700">&lt;p&gt;Commit 853e1b99b10ccce4029fd77ba88df17dbc77ce3d in lucene-solr's branch refs/heads/branch_5_5 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dpgove" class="user-hover" rel="dpgove"&gt;Dennis Gove&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=853e1b9" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=853e1b9&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8599" title="Errors in construction of SolrZooKeeper cause Solr to go into an inconsistent state" class="issue-link" data-issue-key="SOLR-8599"&gt;&lt;del&gt;SOLR-8599&lt;/del&gt;&lt;/a&gt;: After a failed connection during construction of SolrZkClient attempt to retry until a connection can be made&lt;/p&gt;</comment>
                            <comment id="15252868" author="jira-bot" created="Thu, 21 Apr 2016 15:14:52 -0700">&lt;p&gt;Commit 983abb1ca14f7ee42678a03f9d754af8e05e8288 in lucene-solr's branch refs/heads/branch_5_5 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dpgove" class="user-hover" rel="dpgove"&gt;Dennis Gove&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=983abb1" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=983abb1&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8599" title="Errors in construction of SolrZooKeeper cause Solr to go into an inconsistent state" class="issue-link" data-issue-key="SOLR-8599"&gt;&lt;del&gt;SOLR-8599&lt;/del&gt;&lt;/a&gt;: Improved the tests for this issue to avoid changing a variable to non-final&lt;/p&gt;</comment>
                            <comment id="15252953" author="jira-bot" created="Thu, 21 Apr 2016 15:54:12 -0700">&lt;p&gt;Commit 78176e23bcac5c6e4accd8989dc931ec6cedb188 in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dpgove" class="user-hover" rel="dpgove"&gt;Dennis Gove&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=78176e2" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=78176e2&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8599" title="Errors in construction of SolrZooKeeper cause Solr to go into an inconsistent state" class="issue-link" data-issue-key="SOLR-8599"&gt;&lt;del&gt;SOLR-8599&lt;/del&gt;&lt;/a&gt;: Improved the tests for this issue to avoid changing a variable to non-final&lt;/p&gt;</comment>
                            <comment id="15252955" author="jira-bot" created="Thu, 21 Apr 2016 15:56:29 -0700">&lt;p&gt;Commit 8d24d72ab64d435a5e6bdca11b5e79c22f0057ef in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dpgove" class="user-hover" rel="dpgove"&gt;Dennis Gove&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=8d24d72" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=8d24d72&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8599" title="Errors in construction of SolrZooKeeper cause Solr to go into an inconsistent state" class="issue-link" data-issue-key="SOLR-8599"&gt;&lt;del&gt;SOLR-8599&lt;/del&gt;&lt;/a&gt;: Improved the tests for this issue to avoid changing a variable to non-final&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12792549" name="SOLR-8599.patch" size="4139" author="k317h" created="Thu, 10 Mar 2016 10:24:36 -0700"/>
                            <attachment id="12789102" name="SOLR-8599.patch" size="7833" author="dpgove" created="Mon, 22 Feb 2016 17:35:26 -0700"/>
                            <attachment id="12787554" name="SOLR-8599.patch" size="4812" author="k317h" created="Thu, 11 Feb 2016 15:37:19 -0700"/>
                            <attachment id="12784776" name="SOLR-8599.patch" size="6885" author="k317h" created="Wed, 27 Jan 2016 16:45:28 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 10 Feb 2016 18:14:48 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2rzcf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8590] example/files improvements</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8590</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;There are several example/files improvements/fixes that are warranted:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Fix e-mail and URL field names (&lt;tt&gt;&amp;lt;email&amp;gt;_ss&lt;/tt&gt; and &lt;tt&gt;&amp;lt;url&amp;gt;_ss&lt;/tt&gt;, with angle brackets in field names), also add display of these fields in /browse results rendering&lt;/li&gt;
	&lt;li&gt;Improve quality of extracted phrases&lt;/li&gt;
	&lt;li&gt;Extract, facet, and display acronyms&lt;/li&gt;
	&lt;li&gt;Add sorting controls, possibly all or some of these: last modified date, created date, relevancy, and title&lt;/li&gt;
	&lt;li&gt;Add grouping by doc_type perhaps&lt;/li&gt;
	&lt;li&gt;fix debug mode - currently does not update the parsed query debug output (this is probably a bug in data driven /browse as well)&lt;/li&gt;
	&lt;li&gt;Harden update-script: it currently errors if documents do not have a "content" field (eg indexing basic CSV), but should instead skip extraction of e-mail addresses and URLs when no "content".  Not quite the use case (no "content") for example/files, but no reason to error in the update script at least.&lt;/li&gt;
	&lt;li&gt;Filter out bogus e-mail addresses.  I'm seeing &lt;tt&gt;email_ss = "?@&lt;span class="error"&gt;&amp;#91;^&amp;#93;&lt;/span&gt;,\,/^@&lt;span class="error"&gt;&amp;#91;$_a-z&amp;#93;&lt;/span&gt;"&lt;/tt&gt; for some documents (using Solr docs/ directory as the dataset)&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment/>
        <key id="12933686">SOLR-8590</key>
            <summary>example/files improvements</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="ehatcher">Erik Hatcher</assignee>
                                    <reporter username="ehatcher">Erik Hatcher</reporter>
                        <labels>
                    </labels>
                <created>Sun, 24 Jan 2016 11:22:26 -0700</created>
                <updated>Tue, 26 Jan 2016 18:18:13 -0700</updated>
                                                            <fixVersion>6.0</fixVersion>
                                    <component>examples</component>
                        <due/>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="15118408" author="ehatcher" created="Tue, 26 Jan 2016 18:18:13 -0700">&lt;p&gt;This patch fixes the email_ss and url_ss field names, hardens the update script so "content" isn't required, and sets a fallback language and increase the threshold on language detection.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12784543" name="SOLR-8590.patch" size="2342" author="ehatcher" created="Tue, 26 Jan 2016 18:18:13 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2rwiv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>

<item>
            <title>[SOLR-8588] Add TopicStream to the streaming API to support publish/subscribe messaging</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8588</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;The TopicStream is a &lt;b&gt;publish/subscribe messaging service&lt;/b&gt; built on top of SolrCloud.  The TopicStream returns all &lt;b&gt;new&lt;/b&gt; documents for a specific query. Version numbers will be used as checkpoints for Topics to ensure single delivery of each document. When combined with the DaemonStream (&lt;a href="https://issues.apache.org/jira/browse/SOLR-8550" title="Add asynchronous DaemonStreams to the Streaming API" class="issue-link" data-issue-key="SOLR-8550"&gt;&lt;del&gt;SOLR-8550&lt;/del&gt;&lt;/a&gt;), Topics can provide continuous streaming. Sample syntax:&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
topic(checkpointCollection, dataCollection, id=&lt;span class="code-quote"&gt;"topicA"&lt;/span&gt;,  q=&lt;span class="code-quote"&gt;"awesome stuff"&lt;/span&gt; checkpointEvery=&lt;span class="code-quote"&gt;"1000"&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The checkpoint collection will be used to persist the topic checkpoints.&lt;/p&gt;

&lt;p&gt;Example combined with the DaemonStream:&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
daemon(topic(...)...)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When combined with &lt;a href="https://issues.apache.org/jira/browse/SOLR-7739" title="Lucene Classification Integration - UpdateRequestProcessor" class="issue-link" data-issue-key="SOLR-7739"&gt;&lt;del&gt;SOLR-7739&lt;/del&gt;&lt;/a&gt; this allows for messaging based on &lt;b&gt;machine learned&lt;/b&gt; classifications.&lt;/p&gt;

&lt;p&gt;The TopicStream supports 3 models of publish/subscribe messaging:&lt;/p&gt;

&lt;p&gt;1) &lt;b&gt;Request &amp;amp; response&lt;/b&gt;: In this model a topic(...) expression can be saved and executed at any time. In this scenario the TopicStream will always retrieve it's checkpoints and start from where it left off.&lt;/p&gt;

&lt;p&gt;2) &lt;b&gt;Continuous pull streaming&lt;/b&gt;: In this model you would wrap the TopicStream in a DaemonStream and call read() in a loop inside a java program.  This would provide a continuous stream of new content as it arrives in the index.&lt;/p&gt;

&lt;p&gt;3) &lt;b&gt;Continuous push streaming&lt;/b&gt;: In this model you would send an expression like this to the /stream handler: &lt;b&gt;daemon(update(topic(...)...)...)&lt;/b&gt;. This daemon process would run inside Solr and continuously stream new documents from the topic and push them to another SolrCloud collection. Other pushing expressions can be created to push documents in different ways or take other types of actions.&lt;/p&gt;

</description>
                <environment/>
        <key id="12933550">SOLR-8588</key>
            <summary>Add TopicStream to the streaming API to support publish/subscribe messaging</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="10">Implemented</resolution>
                                        <assignee username="joel.bernstein">Joel Bernstein</assignee>
                                    <reporter username="joel.bernstein">Joel Bernstein</reporter>
                        <labels>
                    </labels>
                <created>Fri, 22 Jan 2016 18:11:12 -0700</created>
                <updated>Fri, 19 Feb 2016 18:13:14 -0700</updated>
                            <resolved>Fri, 19 Feb 2016 18:13:14 -0700</resolved>
                                                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="15125455" author="joel.bernstein" created="Sun, 31 Jan 2016 12:01:04 -0700">&lt;p&gt;I think this ticket is the one I'm most excited about at the moment because it leverages so many of Solr's strengths. Topics can be arbitrary queries so they don't have to be registered in advance. It leverages Solr's transaction log and version number. SolrCloud replication provides scale and redundancy. Combined with DaemonStreams, topics can "live" inside Solr and continually push data, or can be embedded in client apps to provide continuous streaming.&lt;/p&gt;</comment>
                            <comment id="15146737" author="joel.bernstein" created="Sun, 14 Feb 2016 14:35:43 -0700">&lt;p&gt;First pass at the TopicStream implementation. Tests to follow.&lt;/p&gt;</comment>
                            <comment id="15147708" author="joel.bernstein" created="Mon, 15 Feb 2016 12:05:40 -0700">&lt;p&gt;Patch with first set of working tests.&lt;/p&gt;</comment>
                            <comment id="15147718" author="risdenk" created="Mon, 15 Feb 2016 12:23:19 -0700">&lt;p&gt;This code could be cleaner I think:&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
Collections.shuffle(shuffler, &lt;span class="code-keyword"&gt;new&lt;/span&gt; Random());
Replica rep = shuffler.get(0);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;replace with something like:&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
Random random = &lt;span class="code-keyword"&gt;new&lt;/span&gt; Random();
Replica rep = shuffler.get(random.nextInt(shuffler.size()));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The initialization of random could be done once I think.&lt;/p&gt;</comment>
                            <comment id="15147776" author="joel.bernstein" created="Mon, 15 Feb 2016 13:40:27 -0700">&lt;p&gt;Yep, this is nicer. I'll include this in the next patch.&lt;/p&gt;</comment>
                            <comment id="15147827" author="joel.bernstein" created="Mon, 15 Feb 2016 14:49:19 -0700">&lt;p&gt;Added simple test for &lt;b&gt;daemon(topic(...)....)&lt;/b&gt; continuous streaming.&lt;/p&gt;</comment>
                            <comment id="15151447" author="joel.bernstein" created="Wed, 17 Feb 2016 16:51:27 -0700">&lt;p&gt;Added tests for checkpointing during read() iteration.&lt;/p&gt;</comment>
                            <comment id="15151448" author="joel.bernstein" created="Wed, 17 Feb 2016 16:52:08 -0700">&lt;p&gt;Next step is manual testing.&lt;/p&gt;</comment>
                            <comment id="15154639" author="joel.bernstein" created="Fri, 19 Feb 2016 11:44:13 -0700">&lt;p&gt;Manual testing looks good. It turned up a connection leak, which is now fixed (I'll put up a new patch shortly). Just need to clean up a few things and prepare this for committal for 6.0.&lt;/p&gt;</comment>
                            <comment id="15155248" author="jira-bot" created="Fri, 19 Feb 2016 18:03:19 -0700">&lt;p&gt;Commit b2475bf9fdc59c02454f730a6cc4916cff03f862 in lucene-solr's branch refs/heads/master from jbernste&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b2475bf" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b2475bf&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8588" title="Add TopicStream to the streaming API to support publish/subscribe messaging" class="issue-link" data-issue-key="SOLR-8588"&gt;&lt;del&gt;SOLR-8588&lt;/del&gt;&lt;/a&gt;: Add TopicStream to the streaming API to support publish/subscribe messaging&lt;/p&gt;</comment>
                            <comment id="15155249" author="jira-bot" created="Fri, 19 Feb 2016 18:03:20 -0700">&lt;p&gt;Commit f9127a919ac212c4a5c36e66fb0d0c15a7867c0e in lucene-solr's branch refs/heads/master from jbernste&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f9127a9" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f9127a9&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8588" title="Add TopicStream to the streaming API to support publish/subscribe messaging" class="issue-link" data-issue-key="SOLR-8588"&gt;&lt;del&gt;SOLR-8588&lt;/del&gt;&lt;/a&gt;: Update CHANGES.txt&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12940590">SOLR-8706</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12902422">SOLR-8125</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12939063">SOLR-8679</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12841672">SOLR-7739</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12788338" name="SOLR-8588.patch" size="29550" author="joel.bernstein" created="Wed, 17 Feb 2016 16:51:27 -0700"/>
                            <attachment id="12787999" name="SOLR-8588.patch" size="26588" author="joel.bernstein" created="Mon, 15 Feb 2016 19:12:21 -0700"/>
                            <attachment id="12787985" name="SOLR-8588.patch" size="26457" author="joel.bernstein" created="Mon, 15 Feb 2016 14:49:19 -0700"/>
                            <attachment id="12787973" name="SOLR-8588.patch" size="25302" author="joel.bernstein" created="Mon, 15 Feb 2016 12:05:40 -0700"/>
                            <attachment id="12787875" name="SOLR-8588.patch" size="15899" author="joel.bernstein" created="Sun, 14 Feb 2016 14:35:43 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 15 Feb 2016 19:23:19 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2rvon:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8574] Implement ConnectionImpl.isValid() and DatabaseMetaDataImpl.getConnection()</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8574</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;2016-01-20 10:20:29.631 INFO   685 &lt;span class="error"&gt;&amp;#91;ExecutorRunner-pool-2-thread-2 - AbstractFacade.isValid&amp;#93;&lt;/span&gt; isValid() throws an exception. Physical connection: 'RootConnection' for: 'abc'. Will consider connection as valid&lt;br/&gt;
java.lang.UnsupportedOperationException&lt;br/&gt;
	at org.apache.solr.client.solrj.io.sql.ConnectionImpl.isValid(ConnectionImpl.java:284)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:497)&lt;br/&gt;
	at com.onseven.dbvis.h.B.C.(Z:2117)&lt;br/&gt;
	at com.onseven.dbvis.h.B.F$A.call(Z:1369)&lt;br/&gt;
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:745)&lt;/p&gt;</description>
                <environment/>
        <key id="12932763">SOLR-8574</key>
            <summary>Implement ConnectionImpl.isValid() and DatabaseMetaDataImpl.getConnection()</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12928403">SOLR-8502</parent>
                                    <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="10">Implemented</resolution>
                                        <assignee username="joel.bernstein">Joel Bernstein</assignee>
                                    <reporter username="risdenk">Kevin Risden</reporter>
                        <labels>
                    </labels>
                <created>Wed, 20 Jan 2016 09:21:55 -0700</created>
                <updated>Tue, 3 May 2016 16:58:14 -0700</updated>
                            <resolved>Wed, 27 Jan 2016 11:46:42 -0700</resolved>
                                    <version>master</version>
                                    <fixVersion>6.0</fixVersion>
                                    <component>SolrJ</component>
                        <due/>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="15108854" author="risdenk" created="Wed, 20 Jan 2016 09:33:27 -0700">&lt;p&gt;This isn't entirely necessary since DBVisualizer assumes the connection is valid.&lt;/p&gt;</comment>
                            <comment id="15118085" author="risdenk" created="Tue, 26 Jan 2016 14:32:29 -0700">&lt;p&gt;Added patch with tests.&lt;/p&gt;</comment>
                            <comment id="15119952" author="jira-bot" created="Wed, 27 Jan 2016 11:44:19 -0700">&lt;p&gt;Commit eeaf3eb96f2b37a935091cbfea7f0cc1aabc4fe5 in lucene-solr's branch refs/heads/master from jbernste&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=eeaf3eb" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=eeaf3eb&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8574" title="Implement ConnectionImpl.isValid() and DatabaseMetaDataImpl.getConnection()" class="issue-link" data-issue-key="SOLR-8574"&gt;&lt;del&gt;SOLR-8574&lt;/del&gt;&lt;/a&gt;: Implement ConnectionImpl.isValid() and DatabaseMetaDataImpl.getConnection()&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12784505" name="SOLR-8574.patch" size="3079" author="risdenk" created="Tue, 26 Jan 2016 14:32:29 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 27 Jan 2016 18:44:19 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2rqun:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8573] Implement ConnectionImpl,StatementImpl,ResultSetImpl clearWarnings and getWarnings</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8573</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;2016-01-20 10:20:30.877 WARN   685 &lt;span class="error"&gt;&amp;#91;ExecutorRunner-pool-2-thread-2 - C.&amp;#93;&lt;/span&gt; Internal error while executing: select fielda, count(fieldc) from test group by fielda&lt;br/&gt;
java.lang.UnsupportedOperationException&lt;br/&gt;
	at org.apache.solr.client.solrj.io.sql.StatementImpl.clearWarnings(StatementImpl.java:186)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:497)&lt;br/&gt;
	at com.onseven.dbvis.h.B.B.(Z:194)&lt;br/&gt;
	at com.onseven.dbvis.h.B.F$A.call(Z:1369)&lt;br/&gt;
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:745)&lt;/p&gt;</description>
                <environment/>
        <key id="12932761">SOLR-8573</key>
            <summary>Implement ConnectionImpl,StatementImpl,ResultSetImpl clearWarnings and getWarnings</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12928403">SOLR-8502</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="10">Implemented</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="risdenk">Kevin Risden</reporter>
                        <labels>
                    </labels>
                <created>Wed, 20 Jan 2016 09:21:31 -0700</created>
                <updated>Sat, 23 Jan 2016 21:02:19 -0700</updated>
                            <resolved>Sat, 23 Jan 2016 21:01:53 -0700</resolved>
                                    <version>6.0</version>
                                    <fixVersion>6.0</fixVersion>
                                    <component>SolrJ</component>
                        <due/>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="15108841" author="risdenk" created="Wed, 20 Jan 2016 09:28:21 -0700">&lt;p&gt;Added patch with tests. Warnings are always null currently.&lt;/p&gt;</comment>
                            <comment id="15109012" author="risdenk" created="Wed, 20 Jan 2016 10:37:46 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=joel.bernstein" class="user-hover" rel="joel.bernstein"&gt;Joel Bernstein&lt;/a&gt; - This is next step in getting DBVisualizer to work. Patch should be good to go.&lt;/p&gt;</comment>
                            <comment id="15113059" author="risdenk" created="Fri, 22 Jan 2016 14:01:17 -0700">&lt;p&gt;Implemented clearWarnings/getWarnings for Connection, Statement, and ResultSet. This is just a primitive implementation with some tests.&lt;/p&gt;</comment>
                            <comment id="15114185" author="joel.bernstein" created="Sat, 23 Jan 2016 21:01:39 -0700">&lt;p&gt;Just committed this to the new github repo. I don't believe it's connected to jira yet so here is the link to the commit:&lt;/p&gt;

&lt;p&gt;&lt;a href="https://github.com/apache/lucene-solr/commit/a3064d36bba0c613ca099aeda5af156fcf39ba76" class="external-link" rel="nofollow"&gt;https://github.com/apache/lucene-solr/commit/a3064d36bba0c613ca099aeda5af156fcf39ba76&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12783917" name="SOLR-8573.patch" size="5159" author="risdenk" created="Fri, 22 Jan 2016 14:01:17 -0700"/>
                            <attachment id="12783367" name="SOLR-8573.patch" size="2210" author="risdenk" created="Wed, 20 Jan 2016 09:28:21 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 24 Jan 2016 04:01:39 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2rqu7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8550] Add asynchronous DaemonStreams to the Streaming API</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8550</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Currently all streams in the Streaming API are synchronously &lt;b&gt;pulled&lt;/b&gt; by a client.&lt;/p&gt;

&lt;p&gt;It would be great to add the capability to have asyncronous &lt;b&gt;DaemonStreams&lt;/b&gt; that live within Solr that can &lt;b&gt;push&lt;/b&gt; content as well. This would facilite large scale alerting and background aggregation use cases.&lt;/p&gt;

</description>
                <environment/>
        <key id="12930195">SOLR-8550</key>
            <summary>Add asynchronous DaemonStreams to the Streaming API</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="joel.bernstein">Joel Bernstein</reporter>
                        <labels>
                    </labels>
                <created>Thu, 14 Jan 2016 10:13:50 -0700</created>
                <updated>Fri, 22 Jan 2016 18:17:34 -0700</updated>
                            <resolved>Fri, 22 Jan 2016 18:17:16 -0700</resolved>
                                    <version>6.0</version>
                                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="15098459" author="joel.bernstein" created="Thu, 14 Jan 2016 10:28:15 -0700">&lt;p&gt;The general design is to add a new DaemonStream which will be handled differently by the /stream handler. When the /stream handler sees an DaemonStream it will open it and just keep it around in a memory. The DaemonStream will have a thread that wakes up periodically and opens, reads, and closes it's underlying stream. Syntax would look like this:&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
daemon(alert())
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The AlertStream would be a new stream created in a different ticket. &lt;/p&gt;

&lt;p&gt;Parallel async streams should work fine as well, facilitating very large scale alerting systems:&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
parallel(daemon(alert()))
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In the parallel example the DaemonStream would be pushed to worker nodes where they would live.&lt;/p&gt;

&lt;p&gt;An example of background aggregation:&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
parallel(daemon(update(rollup(...))))
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15102979" author="joel.bernstein" created="Fri, 15 Jan 2016 21:42:20 -0700">&lt;p&gt;First attempt at the DaemonStream. No tests yet. &lt;/p&gt;</comment>
                            <comment id="15102985" author="joel.bernstein" created="Fri, 15 Jan 2016 21:54:22 -0700">&lt;p&gt;Added an Info Tuple to report stats kept by the DaemonStream&lt;/p&gt;</comment>
                            <comment id="15105538" author="risdenk" created="Mon, 18 Jan 2016 10:14:28 -0700">&lt;p&gt;Any thoughts about how a daemon stream be stopped/started/cancelled/removed? &lt;/p&gt;</comment>
                            <comment id="15105576" author="joel.bernstein" created="Mon, 18 Jan 2016 10:48:47 -0700">&lt;p&gt;I was thinking of adding simple admin commands to the /stream handler (list, stop, start, remove etc..)&lt;/p&gt;

&lt;p&gt;The DeamonStreams are also meant to be held onto outside of Solr by another application that wants continous streaming.&lt;/p&gt;</comment>
                            <comment id="15105594" author="joel.bernstein" created="Mon, 18 Jan 2016 10:58:33 -0700">&lt;p&gt;To give you an idea of where this is eventually headed, imagine a system with Daemons that are building models:&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
daemon(update(logit()))
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And then other Daemons that are alerting based on those models:&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
daemon(alert())
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is basically an AI driven alerting system.&lt;/p&gt;</comment>
                            <comment id="15105721" author="joel.bernstein" created="Mon, 18 Jan 2016 12:31:24 -0700">&lt;p&gt;New patch begins the work on the /stream handler. Initial patch just starts the DaemonStream and puts it in a map. A Tuple is returned which includes the core where the Daemon started. In parallel mode this will return a Tuple from each worker the Daemon was started on.&lt;/p&gt;</comment>
                            <comment id="15105920" author="joel.bernstein" created="Mon, 18 Jan 2016 15:52:01 -0700">&lt;p&gt;Added redimentary API for stoping, starting and listing DaemonStreams on the /stream handler&lt;/p&gt;</comment>
                            <comment id="15105928" author="joel.bernstein" created="Mon, 18 Jan 2016 16:02:36 -0700">&lt;p&gt;Added Thread state to info Tuple.  &lt;/p&gt;

&lt;p&gt;I think the next step is to start adding tests.&lt;/p&gt;</comment>
                            <comment id="15111274" author="joel.bernstein" created="Thu, 21 Jan 2016 13:53:29 -0700">&lt;p&gt;New patch making the DaemonStream Expressible&lt;/p&gt;</comment>
                            <comment id="15111516" author="joel.bernstein" created="Thu, 21 Jan 2016 15:31:26 -0700">&lt;p&gt;Added a simple test that iterates 10 times over a rollup. The data doesn't change underneath so the values are the same each time. This tests the internal thread and queue setup of the DaemonStream. It also demonstrates how a DaemonStream.read() blocks until there is new data in the queue populated by the underlying Stream. &lt;/p&gt;

&lt;p&gt;The RollupStream needed to be changed so that it resets it's state upon closing to support calling open() and close() multiple times on the same stream. Any Stream wrapped by the DaemonStream will need to do the same.&lt;/p&gt;</comment>
                            <comment id="15111581" author="joel.bernstein" created="Thu, 21 Jan 2016 16:14:53 -0700">&lt;p&gt;Expanded the tests to show that the rollup count changed after a new document was added to the index. The daemon stream was left open and the changed rollup count was streamed out after the new document was indexed.&lt;/p&gt;

&lt;p&gt;This tests the main functionality of the DaemonStream.&lt;/p&gt;

&lt;p&gt;The next step is to test the DaemonStream running inside of the /stream handler.&lt;/p&gt;</comment>
                            <comment id="15111687" author="joel.bernstein" created="Thu, 21 Jan 2016 17:38:02 -0700">&lt;p&gt;New patch that tests parallel DaemonStream's, running inside of the /stream handler, updating a collection. Still need to expand the tests to include the different actions that are supported.&lt;/p&gt;</comment>
                            <comment id="15111725" author="joel.bernstein" created="Thu, 21 Jan 2016 18:10:57 -0700">&lt;p&gt;New patch tests the list action.&lt;/p&gt;

&lt;p&gt;I think the next step is manual testing. If that looks good I think this ready to commit.&lt;/p&gt;</comment>
                            <comment id="15111859" author="joel.bernstein" created="Thu, 21 Jan 2016 20:25:49 -0700">&lt;p&gt;Added StreamExpressionToExpression test&lt;/p&gt;</comment>
                            <comment id="15112763" author="joel.bernstein" created="Fri, 22 Jan 2016 10:46:07 -0700">&lt;p&gt;Added error logging and a test that ensures the DaemonStream thread has been stopped when using the &lt;b&gt;stop&lt;/b&gt; action. This also exercises the &lt;b&gt;list&lt;/b&gt; action.&lt;/p&gt;

&lt;p&gt;These tests are passing every time now locally and a whole lot of things have to go right for these tests to pass. I'm feeling pretty good about committing this.&lt;/p&gt;</comment>
                            <comment id="15112888" author="jira-bot" created="Fri, 22 Jan 2016 12:07:17 -0700">&lt;p&gt;Commit 1726291 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=joel.bernstein" class="user-hover" rel="joel.bernstein"&gt;Joel Bernstein&lt;/a&gt; in branch 'dev/trunk'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1726291" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1726291&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8550" title="Add asynchronous DaemonStreams to the Streaming API" class="issue-link" data-issue-key="SOLR-8550"&gt;&lt;del&gt;SOLR-8550&lt;/del&gt;&lt;/a&gt;: Add asynchronous DaemonStreams to the Streaming API&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12932941">SOLR-8577</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12783871" name="SOLR-8550.patch" size="32404" author="joel.bernstein" created="Fri, 22 Jan 2016 10:46:07 -0700"/>
                            <attachment id="12783744" name="SOLR-8550.patch" size="31064" author="joel.bernstein" created="Thu, 21 Jan 2016 20:25:49 -0700"/>
                            <attachment id="12783725" name="SOLR-8550.patch" size="29311" author="joel.bernstein" created="Thu, 21 Jan 2016 18:10:57 -0700"/>
                            <attachment id="12783714" name="SOLR-8550.patch" size="28546" author="joel.bernstein" created="Thu, 21 Jan 2016 17:38:02 -0700"/>
                            <attachment id="12783700" name="SOLR-8550.patch" size="22068" author="joel.bernstein" created="Thu, 21 Jan 2016 16:14:53 -0700"/>
                            <attachment id="12783687" name="SOLR-8550.patch" size="20343" author="joel.bernstein" created="Thu, 21 Jan 2016 15:31:26 -0700"/>
                            <attachment id="12783669" name="SOLR-8550.patch" size="16042" author="joel.bernstein" created="Thu, 21 Jan 2016 13:53:29 -0700"/>
                            <attachment id="12782955" name="SOLR-8550.patch" size="12290" author="joel.bernstein" created="Mon, 18 Jan 2016 16:02:36 -0700"/>
                            <attachment id="12782954" name="SOLR-8550.patch" size="12229" author="joel.bernstein" created="Mon, 18 Jan 2016 15:52:01 -0700"/>
                            <attachment id="12782923" name="SOLR-8550.patch" size="10255" author="joel.bernstein" created="Mon, 18 Jan 2016 12:31:24 -0700"/>
                            <attachment id="12782868" name="SOLR-8550.patch" size="5709" author="joel.bernstein" created="Mon, 18 Jan 2016 05:05:16 -0700"/>
                            <attachment id="12782691" name="SOLR-8550.patch" size="5690" author="joel.bernstein" created="Fri, 15 Jan 2016 22:32:29 -0700"/>
                            <attachment id="12782690" name="SOLR-8550.patch" size="5682" author="joel.bernstein" created="Fri, 15 Jan 2016 22:31:35 -0700"/>
                            <attachment id="12782686" name="SOLR-8550.patch" size="5510" author="joel.bernstein" created="Fri, 15 Jan 2016 22:17:55 -0700"/>
                            <attachment id="12782685" name="SOLR-8550.patch" size="5129" author="joel.bernstein" created="Fri, 15 Jan 2016 22:02:20 -0700"/>
                            <attachment id="12782684" name="SOLR-8550.patch" size="4940" author="joel.bernstein" created="Fri, 15 Jan 2016 21:54:22 -0700"/>
                            <attachment id="12782681" name="SOLR-8550.patch" size="4300" author="joel.bernstein" created="Fri, 15 Jan 2016 21:42:20 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>17.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 18 Jan 2016 17:14:28 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2rb0f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8535] Support forcing define-lucene-javadoc-url to be local</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8535</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Today, unless the version name contains '-SNAPSHOT', the documentation will generate javadocs with external links, e.g. &lt;a href="http://lucene.apache.org/core/" class="external-link" rel="nofollow"&gt;http://lucene.apache.org/core/&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;For the same reasons given in &lt;a href="https://issues.apache.org/jira/browse/SOLR-8353" title="Support regex for skipping license checksums" class="issue-link" data-issue-key="SOLR-8353"&gt;&lt;del&gt;SOLR-8353&lt;/del&gt;&lt;/a&gt; (for jar checksums), it would be nice to support specifying a regex to support internal links for versions that do not contain '-SNAPSHOT'.  An example from &lt;a href="https://issues.apache.org/jira/browse/SOLR-8353" title="Support regex for skipping license checksums" class="issue-link" data-issue-key="SOLR-8353"&gt;&lt;del&gt;SOLR-8353&lt;/del&gt;&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;some of us have a fork of the build that has to deal with changing dependencies. Our build systems all get to work according to their needs - which is a good thing.&lt;/p&gt;&lt;/blockquote&gt;</description>
                <environment/>
        <key id="12929351">SOLR-8535</key>
            <summary>Support forcing define-lucene-javadoc-url to be local</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gchanan">Gregory Chanan</assignee>
                                    <reporter username="gchanan">Gregory Chanan</reporter>
                        <labels>
                    </labels>
                <created>Mon, 11 Jan 2016 19:22:29 -0700</created>
                <updated>Tue, 23 Feb 2016 03:40:21 -0700</updated>
                            <resolved>Wed, 13 Jan 2016 15:55:43 -0700</resolved>
                                                    <fixVersion>5.5</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>Build</component>
                        <due/>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="15095479" author="gchanan" created="Tue, 12 Jan 2016 19:21:17 -0700">&lt;p&gt;Changed the title, probably more straightforward to just make it a boolean property to use local paths.&lt;/p&gt;</comment>
                            <comment id="15097197" author="jira-bot" created="Wed, 13 Jan 2016 15:48:40 -0700">&lt;p&gt;Commit 1724520 from gchanan@apache.org in branch 'dev/trunk'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1724520" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1724520&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8535" title="Support forcing define-lucene-javadoc-url to be local" class="issue-link" data-issue-key="SOLR-8535"&gt;&lt;del&gt;SOLR-8535&lt;/del&gt;&lt;/a&gt;: Support forcing define-lucene-javadoc-url to be local&lt;/p&gt;</comment>
                            <comment id="15097198" author="jira-bot" created="Wed, 13 Jan 2016 15:49:00 -0700">&lt;p&gt;Commit 1724521 from gchanan@apache.org in branch 'dev/branches/branch_5x'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1724521" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1724521&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8535" title="Support forcing define-lucene-javadoc-url to be local" class="issue-link" data-issue-key="SOLR-8535"&gt;&lt;del&gt;SOLR-8535&lt;/del&gt;&lt;/a&gt;: Support forcing define-lucene-javadoc-url to be local&lt;/p&gt;</comment>
                            <comment id="15097213" author="gchanan" created="Wed, 13 Jan 2016 15:55:44 -0700">&lt;p&gt;Committed to 5.5 and 6.0.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12917063">SOLR-8353</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12781973" name="SOLR-8535.patch" size="843" author="gchanan" created="Tue, 12 Jan 2016 19:22:15 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 13 Jan 2016 22:48:40 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2r5t3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8522] ImplicitSnitch to support IPv4 fragment tags</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8522</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;This is a description from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;'s comment on &lt;a href="https://issues.apache.org/jira/browse/SOLR-8146" title="Allowing SolrJ CloudSolrClient to have preferred replica for query/read" class="issue-link" data-issue-key="SOLR-8146"&gt;SOLR-8146&lt;/a&gt;&lt;/p&gt;


&lt;h3&gt;&lt;a name="IPv4fragmenttags"&gt;&lt;/a&gt;IPv4 fragment tags&lt;/h3&gt;
&lt;p&gt;Lets assume a Solr node IPv4 address is &lt;tt&gt;192.93.255.255&lt;/tt&gt; .&lt;/p&gt;

&lt;p&gt;This is about enhancing the current &lt;tt&gt;ImplicitSnitch&lt;/tt&gt;  to support IP based tags like:&lt;/p&gt;

&lt;ul class="alternate" type="square"&gt;
	&lt;li&gt;&lt;tt&gt;hostfrag_1 = 255&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;hostfrag_2 = 255&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;hostfrag_3 = 93&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;hostfrag_4 = 192&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Note that IPv6 support will be implemented by a separate ticket&lt;/p&gt;

&lt;h3&gt;&lt;a name="Hostnamefragmenttags"&gt;&lt;/a&gt;Host name fragment tags&lt;/h3&gt;
&lt;p&gt;Lets assume a Solr node host name &lt;tt&gt;serv1.dc1.country1.apache.org&lt;/tt&gt; .&lt;/p&gt;

&lt;p&gt;This is about enhancing the current &lt;tt&gt;ImplicitSnitch&lt;/tt&gt;  to support  tags like:&lt;/p&gt;

&lt;ul class="alternate" type="square"&gt;
	&lt;li&gt;&lt;tt&gt;hostfrag_1 = org&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;hostfrag_2 = apache&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;hostfrag_3 = country1&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;hostfrag_4 = dc1&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;hostfrag_5 = serv1&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment/>
        <key id="12928617">SOLR-8522</key>
            <summary>ImplicitSnitch to support IPv4 fragment tags</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="noble.paul">Noble Paul</assignee>
                                    <reporter username="arcadius">Arcadius Ahouansou</reporter>
                        <labels>
                    </labels>
                <created>Fri, 8 Jan 2016 05:11:47 -0700</created>
                <updated>Tue, 23 Feb 2016 23:12:15 -0700</updated>
                            <resolved>Tue, 23 Feb 2016 01:02:14 -0700</resolved>
                                    <version>5.4</version>
                                    <fixVersion>6.0</fixVersion>
                                    <component>SolrCloud</component>
                        <due/>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="15089147" author="arcadius" created="Fri, 8 Jan 2016 05:35:00 -0700">&lt;p&gt;Hello &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;.&lt;br/&gt;
This is the initial patch for IPv4 tag support.&lt;br/&gt;
Please, let me know of any comment or suggestion you may have.&lt;/p&gt;

&lt;p&gt;Thank you very much.&lt;/p&gt;</comment>
                            <comment id="15097612" author="noble.paul" created="Wed, 13 Jan 2016 22:15:56 -0700">&lt;ul&gt;
	&lt;li&gt;The solr node string may not always be an IP address. It could be something like {[host:port}} . So IP address needs a lookup&lt;/li&gt;
	&lt;li&gt;Let's start from least significant to most significant. &lt;tt&gt;192.93.255.255&lt;/tt&gt; where &lt;tt&gt;ip_1=255&lt;/tt&gt; to &lt;tt&gt;ip_4=192&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;Do not blindly add a tag . Add if it is only requested&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15104043" author="arcadius" created="Sun, 17 Jan 2016 18:42:57 -0700">&lt;p&gt;Thank you very much &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;ul] for taking the time to look into this&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;The solr node string may not always be an IP address. It could be something like {[host:port}} . So IP address needs a lookup&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;You are right about this. I was not aware of this.&lt;br/&gt;
Turned out that a user could start Solr with -Dhost=someHostName.&lt;br/&gt;
Doing the lookup as suggested is quite simple. However, 1 host could have multiple public and private IPs. We could pick the first public one or something...&lt;/p&gt;

&lt;p&gt;This led me to start contemplating the idea of a more generic snitch that will deal with host names as well as IPs like&lt;br/&gt;
&lt;tt&gt;192.168.1.2 -&amp;gt; host_1=2, host_2=1, host_3=168, host_4=192&lt;/tt&gt;&lt;br/&gt;
and&lt;br/&gt;
&lt;tt&gt;serv1.dc1.london.uk.apache.org -&amp;gt; host_1=org, host_2=apache, host_3=uk, host_4=london, host_5=dc1, host_6=serv1&lt;/tt&gt; &lt;/p&gt;

&lt;p&gt;Any comment about this?&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;Let's start from least significant to most significant&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yes, makes sense&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;Do not blindly add a tag . Add if it is only requested&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The current implementation adds only the tags that are requested.&lt;br/&gt;
The one that are not requested are not added to the response.&lt;br/&gt;
This is tested in &lt;/p&gt;
&lt;ul class="alternate" type="square"&gt;
	&lt;li&gt;&lt;tt&gt;testGetTagsWithEmptyIPv4RequestedTag()&lt;/tt&gt; where no tag is requested -&amp;gt; none returned, and&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class="alternate" type="square"&gt;
	&lt;li&gt;&lt;tt&gt;testGetTagsWithIPv4RequestedTags_ip_2_ip_4()&lt;/tt&gt; where only 2 tags are requested leading to only 2 out of 4 being returned&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;Please let me know about the idea of a more generic snitch that could handle host names as well.&lt;/p&gt;

&lt;p&gt;Many thanks&lt;/p&gt;</comment>
                            <comment id="15104904" author="noble.paul" created="Mon, 18 Jan 2016 01:06:07 -0700">&lt;p&gt;It's OK whether you ad tags for host as well. just that it doesn't match with the description and title&lt;/p&gt;</comment>
                            <comment id="15107679" author="arcadius" created="Tue, 19 Jan 2016 16:39:08 -0700">&lt;p&gt;Hello &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;&lt;br/&gt;
I have made all suggested changes.&lt;br/&gt;
I have also added support for host names.&lt;br/&gt;
For now, the snitch name is in the format &lt;tt&gt;hostfrag_N&lt;/tt&gt; where N is a number.&lt;br/&gt;
I am open to new suggestions... especially about the name of the snitch.&lt;/p&gt;</comment>
                            <comment id="15115164" author="noble.paul" created="Mon, 25 Jan 2016 06:04:27 -0700">&lt;p&gt;The test cases have node strings given in the wrong format&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;&lt;a href="http://127.0.0.1:54869/oubz/collection1j" class="external-link" rel="nofollow"&gt;http://127.0.0.1:54869/oubz/collection1j&lt;/a&gt;&lt;/tt&gt; is wrong&lt;br/&gt;
&lt;tt&gt;127.0.0.1:54869_oubzj&lt;/tt&gt; is right&lt;/p&gt;</comment>
                            <comment id="15116328" author="arcadius" created="Mon, 25 Jan 2016 17:07:47 -0700">&lt;p&gt;Hello again &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;&lt;br/&gt;
Thank you very much for taking the time to have a look.&lt;/p&gt;

&lt;ul class="alternate" type="square"&gt;
	&lt;li&gt;I have changed the node format from &lt;tt&gt;&lt;a href="http://host:port/context/collection" class="external-link" rel="nofollow"&gt;http://host:port/context/collection&lt;/a&gt;&lt;/tt&gt; ... to &lt;tt&gt;host:port_context&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;To further simplify things, I have also removed all tests related to &lt;a href="https://issues.apache.org/jira/browse/SOLR-8523" title="ImplicitSnitch to support IPv6 based tags" class="issue-link" data-issue-key="SOLR-8523"&gt;SOLR-8523&lt;/a&gt; . Tests will be added later to &lt;a href="https://issues.apache.org/jira/browse/SOLR-8523" title="ImplicitSnitch to support IPv6 based tags" class="issue-link" data-issue-key="SOLR-8523"&gt;SOLR-8523&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;I need one clarification:&lt;/p&gt;

&lt;p&gt;In the original &lt;tt&gt;ImplicitSnitch.java&lt;/tt&gt;, we have:&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
Pattern hostAndPortPattern = Pattern.compile(&lt;span class="code-quote"&gt;"(?:https?:&lt;span class="code-comment"&gt;//)?([^:]+):(\\d+)"&lt;/span&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Is that regex accurate given that node names do not contain any &lt;tt&gt;http&lt;/tt&gt; or  &lt;tt&gt;https&lt;/tt&gt; in the format specified above?&lt;/p&gt;

&lt;p&gt;Thank you very much&lt;/p&gt;</comment>
                            <comment id="15118828" author="noble.paul" created="Wed, 27 Jan 2016 00:55:55 -0700">&lt;p&gt;I don't think this is complete&lt;/p&gt;

&lt;p&gt;imagine I provide &lt;tt&gt;serv1.dc1.london.uk.apache.org&lt;/tt&gt; as the host name, I should still be able to use &lt;tt&gt;ip_1&lt;/tt&gt; because evenntually &lt;tt&gt;serv1.dc1.london.uk.apache.org&lt;/tt&gt; should resolve to an ip address. &lt;/p&gt;</comment>
                            <comment id="15119051" author="arcadius" created="Wed, 27 Jan 2016 04:08:47 -0700">&lt;blockquote&gt;
&lt;p&gt;imagine I provide serv1.dc1.london.uk.apache.org as the host name, I should still be able to use ip_1 because evenntually serv1.dc1.london.uk.apache.org should &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yes, &lt;tt&gt;serv1.dc1.london.uk.apache.org&lt;/tt&gt; will eventually be resolved into an IP, but this will happen only outside of Solr scope and solr will only know of &lt;tt&gt;serv1.dc1.london.uk.apache.org&lt;/tt&gt; IMHO&lt;/p&gt;</comment>
                            <comment id="15119063" author="noble.paul" created="Wed, 27 Jan 2016 04:14:19 -0700">&lt;p&gt;Why? Why can't a user use IP_1 even if he uses host names&lt;/p&gt;</comment>
                            <comment id="15119067" author="arcadius" created="Wed, 27 Jan 2016 04:17:55 -0700">&lt;p&gt;Hello again &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;&lt;br/&gt;
From my understanding, a server could have multiple host names and multiple public IPs.&lt;/p&gt;

&lt;p&gt;And by simply starting solr without the &lt;tt&gt;-Dhost&lt;/tt&gt; switch, Solr will grab one of the assigned IPs and use it.&lt;br/&gt;
This sometimes is not desirable as it leads to issues ... and that is when  &lt;tt&gt;-Dhost&lt;/tt&gt;  is used to force Solr to use a provided host name or IP.&lt;/p&gt;

&lt;p&gt;I downloaded solr 5.4.1 and I ran&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;solr-5.4.1/bin$ ./solr start -e cloud -a "-Dhost=linux01"&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;Then, the output of &lt;br/&gt;
&lt;tt&gt;curl "http://localhost:8983/solr/admin/collections?action=clusterstatus&amp;amp;wt=json&amp;amp;indent=on"&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;is:&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
{
   &lt;span class="code-quote"&gt;"responseHeader"&lt;/span&gt;:{
      &lt;span class="code-quote"&gt;"status"&lt;/span&gt;:0,
      &lt;span class="code-quote"&gt;"QTime"&lt;/span&gt;:2
   },
   &lt;span class="code-quote"&gt;"cluster"&lt;/span&gt;:{
      &lt;span class="code-quote"&gt;"collections"&lt;/span&gt;:{
         &lt;span class="code-quote"&gt;"gettingstarted"&lt;/span&gt;:{
            &lt;span class="code-quote"&gt;"replicationFactor"&lt;/span&gt;:&lt;span class="code-quote"&gt;"2"&lt;/span&gt;,
            &lt;span class="code-quote"&gt;"shards"&lt;/span&gt;:{
               &lt;span class="code-quote"&gt;"shard1"&lt;/span&gt;:{
                  &lt;span class="code-quote"&gt;"range"&lt;/span&gt;:&lt;span class="code-quote"&gt;"80000000-ffffffff"&lt;/span&gt;,
                  &lt;span class="code-quote"&gt;"state"&lt;/span&gt;:&lt;span class="code-quote"&gt;"active"&lt;/span&gt;,
                  &lt;span class="code-quote"&gt;"replicas"&lt;/span&gt;:{
                     &lt;span class="code-quote"&gt;"core_node1"&lt;/span&gt;:{
                        &lt;span class="code-quote"&gt;"core"&lt;/span&gt;:&lt;span class="code-quote"&gt;"gettingstarted_shard1_replica1"&lt;/span&gt;,
                        &lt;span class="code-quote"&gt;"base_url"&lt;/span&gt;:&lt;span class="code-quote"&gt;"http:&lt;span class="code-comment"&gt;//linux01:8983/solr"&lt;/span&gt;,
&lt;/span&gt;                        &lt;span class="code-quote"&gt;"node_name"&lt;/span&gt;:&lt;span class="code-quote"&gt;"linux01:8983_solr"&lt;/span&gt;,
                        &lt;span class="code-quote"&gt;"state"&lt;/span&gt;:&lt;span class="code-quote"&gt;"active"&lt;/span&gt;
                     },
                     &lt;span class="code-quote"&gt;"core_node4"&lt;/span&gt;:{
                        &lt;span class="code-quote"&gt;"core"&lt;/span&gt;:&lt;span class="code-quote"&gt;"gettingstarted_shard1_replica2"&lt;/span&gt;,
                        &lt;span class="code-quote"&gt;"base_url"&lt;/span&gt;:&lt;span class="code-quote"&gt;"http:&lt;span class="code-comment"&gt;//linux01:7574/solr"&lt;/span&gt;,
&lt;/span&gt;                        &lt;span class="code-quote"&gt;"node_name"&lt;/span&gt;:&lt;span class="code-quote"&gt;"linux01:7574_solr"&lt;/span&gt;,
                        &lt;span class="code-quote"&gt;"state"&lt;/span&gt;:&lt;span class="code-quote"&gt;"active"&lt;/span&gt;,
                        &lt;span class="code-quote"&gt;"leader"&lt;/span&gt;:&lt;span class="code-quote"&gt;"&lt;span class="code-keyword"&gt;true&lt;/span&gt;"&lt;/span&gt;
                     }
                  }
               },
               &lt;span class="code-quote"&gt;"shard2"&lt;/span&gt;:{
                  &lt;span class="code-quote"&gt;"range"&lt;/span&gt;:&lt;span class="code-quote"&gt;"0-7fffffff"&lt;/span&gt;,
                  &lt;span class="code-quote"&gt;"state"&lt;/span&gt;:&lt;span class="code-quote"&gt;"active"&lt;/span&gt;,
                  &lt;span class="code-quote"&gt;"replicas"&lt;/span&gt;:{
                     &lt;span class="code-quote"&gt;"core_node2"&lt;/span&gt;:{
                        &lt;span class="code-quote"&gt;"core"&lt;/span&gt;:&lt;span class="code-quote"&gt;"gettingstarted_shard2_replica1"&lt;/span&gt;,
                        &lt;span class="code-quote"&gt;"base_url"&lt;/span&gt;:&lt;span class="code-quote"&gt;"http:&lt;span class="code-comment"&gt;//linux01:8983/solr"&lt;/span&gt;,
&lt;/span&gt;                        &lt;span class="code-quote"&gt;"node_name"&lt;/span&gt;:&lt;span class="code-quote"&gt;"linux01:8983_solr"&lt;/span&gt;,
                        &lt;span class="code-quote"&gt;"state"&lt;/span&gt;:&lt;span class="code-quote"&gt;"active"&lt;/span&gt;
                     },
                     &lt;span class="code-quote"&gt;"core_node3"&lt;/span&gt;:{
                        &lt;span class="code-quote"&gt;"core"&lt;/span&gt;:&lt;span class="code-quote"&gt;"gettingstarted_shard2_replica2"&lt;/span&gt;,
                        &lt;span class="code-quote"&gt;"base_url"&lt;/span&gt;:&lt;span class="code-quote"&gt;"http:&lt;span class="code-comment"&gt;//linux01:7574/solr"&lt;/span&gt;,
&lt;/span&gt;                        &lt;span class="code-quote"&gt;"node_name"&lt;/span&gt;:&lt;span class="code-quote"&gt;"linux01:7574_solr"&lt;/span&gt;,
                        &lt;span class="code-quote"&gt;"state"&lt;/span&gt;:&lt;span class="code-quote"&gt;"active"&lt;/span&gt;,
                        &lt;span class="code-quote"&gt;"leader"&lt;/span&gt;:&lt;span class="code-quote"&gt;"&lt;span class="code-keyword"&gt;true&lt;/span&gt;"&lt;/span&gt;
                     }
                  }
               }
            },
            &lt;span class="code-quote"&gt;"router"&lt;/span&gt;:{
               &lt;span class="code-quote"&gt;"name"&lt;/span&gt;:&lt;span class="code-quote"&gt;"compositeId"&lt;/span&gt;
            },
            &lt;span class="code-quote"&gt;"maxShardsPerNode"&lt;/span&gt;:&lt;span class="code-quote"&gt;"2"&lt;/span&gt;,
            &lt;span class="code-quote"&gt;"autoAddReplicas"&lt;/span&gt;:&lt;span class="code-quote"&gt;"&lt;span class="code-keyword"&gt;false&lt;/span&gt;"&lt;/span&gt;,
            &lt;span class="code-quote"&gt;"znodeVersion"&lt;/span&gt;:8,
            &lt;span class="code-quote"&gt;"configName"&lt;/span&gt;:&lt;span class="code-quote"&gt;"gettingstarted"&lt;/span&gt;
         }
      },
      &lt;span class="code-quote"&gt;"live_nodes"&lt;/span&gt;:[
         &lt;span class="code-quote"&gt;"linux01:7574_solr"&lt;/span&gt;,
         &lt;span class="code-quote"&gt;"linux01:8983_solr"&lt;/span&gt;
      ]
   }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Please note the line with&lt;br/&gt;
&lt;tt&gt;"base_url":"http://linux01:8983/solr"&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;So, any client (curl or apache httpClient) will be using URL of the form &lt;tt&gt;&lt;a href="http://linux01:8983/solr" class="external-link" rel="nofollow"&gt;http://linux01:8983/solr&lt;/a&gt;&lt;/tt&gt; &lt;br/&gt;
which as you said will be resolved into in IP, but this will happen outside of Solr IMHO.&lt;/p&gt;

&lt;p&gt;So, in my humble opinion (and correct me if I am wrong), Solr and the cluster assignment rules will know only about the host name "linux01"?&lt;/p&gt;


&lt;p&gt;Thank you very much &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt; for your time.&lt;/p&gt;</comment>
                            <comment id="15119070" author="arcadius" created="Wed, 27 Jan 2016 04:21:08 -0700">&lt;p&gt;Hi &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Let's say the host &lt;tt&gt;serv1.dc1.london.uk.apache.org&lt;/tt&gt; resolves into 3 public IPs.&lt;br/&gt;
Which one should I use then?&lt;/p&gt;

&lt;p&gt;Please read my other comment below&lt;/p&gt;</comment>
                            <comment id="15119075" author="noble.paul" created="Wed, 27 Jan 2016 04:27:12 -0700">&lt;p&gt;solr will only use the &lt;tt&gt;linux01&lt;/tt&gt; but that is not to say that ip cannot be used. It should be the preference of the user to choose &lt;tt&gt;ip_1&lt;/tt&gt; .  &lt;/p&gt;

&lt;p&gt;My suggestion is &lt;/p&gt;

&lt;p&gt;both &lt;tt&gt;host_1&lt;/tt&gt; and &lt;tt&gt;ip_1&lt;/tt&gt; should be valid and must work. If the node string is a host name , resolve the ip address and get the &lt;tt&gt;ip_1&lt;/tt&gt; value&lt;/p&gt;</comment>
                            <comment id="15119098" author="arcadius" created="Wed, 27 Jan 2016 04:42:31 -0700">&lt;p&gt;Resolving hostname-&amp;gt;IP is simple enough.&lt;/p&gt;

&lt;p&gt;However, when a host name resolves into multiple IPs, which one to choose?&lt;/p&gt;</comment>
                            <comment id="15119163" author="noble.paul" created="Wed, 27 Jan 2016 05:36:43 -0700">&lt;p&gt;just do &lt;br/&gt;
{{&lt;br/&gt;
InetAddress inetAddr = InetAddress.getByName("hostname");&lt;br/&gt;
}} &lt;/p&gt;</comment>
                            <comment id="15131489" author="arcadius" created="Wed, 3 Feb 2016 18:09:51 -0700">&lt;p&gt;Hello &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;&lt;br/&gt;
I have updated the patch to lookup ip addresses.&lt;br/&gt;
Thanks.&lt;/p&gt;</comment>
                            <comment id="15157040" author="noble.paul" created="Mon, 22 Feb 2016 07:22:43 -0700">&lt;p&gt;sorry for the delay. &lt;br/&gt;
 could you please update the patch to latest trunk and I shall commit this &lt;/p&gt;</comment>
                            <comment id="15158443" author="arcadius" created="Tue, 23 Feb 2016 00:16:41 -0700">&lt;p&gt;Patch updated to latest git master branch&lt;/p&gt;</comment>
                            <comment id="15158507" author="jira-bot" created="Tue, 23 Feb 2016 01:01:45 -0700">&lt;p&gt;Commit cf964326309feb7a5a41a3e4f22cad073807a097 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=cf96432" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=cf96432&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8522" title="ImplicitSnitch to support IPv4 fragment tags" class="issue-link" data-issue-key="SOLR-8522"&gt;&lt;del&gt;SOLR-8522&lt;/del&gt;&lt;/a&gt;: Make it possible to use ip fragments in replica placement rules , such as ip_1, ip_2 etc&lt;/p&gt;</comment>
                            <comment id="15159797" author="arcadius" created="Tue, 23 Feb 2016 15:41:48 -0700">&lt;p&gt;Thank you very much &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt; for your valuable help on this issue.&lt;/p&gt;</comment>
                            <comment id="15160230" author="jira-bot" created="Tue, 23 Feb 2016 23:12:15 -0700">&lt;p&gt;Commit cf964326309feb7a5a41a3e4f22cad073807a097 in lucene-solr's branch refs/heads/apiv2 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=cf96432" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=cf96432&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8522" title="ImplicitSnitch to support IPv4 fragment tags" class="issue-link" data-issue-key="SOLR-8522"&gt;&lt;del&gt;SOLR-8522&lt;/del&gt;&lt;/a&gt;: Make it possible to use ip fragments in replica placement rules , such as ip_1, ip_2 etc&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12928618">SOLR-8523</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12724740">SOLR-6220</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12903578">SOLR-8146</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12789147" name="SOLR-8522.patch" size="17674" author="arcadius" created="Tue, 23 Feb 2016 00:16:41 -0700"/>
                            <attachment id="12786155" name="SOLR-8522.patch" size="17840" author="arcadius" created="Wed, 3 Feb 2016 18:09:51 -0700"/>
                            <attachment id="12784275" name="SOLR-8522.patch" size="13936" author="arcadius" created="Mon, 25 Jan 2016 16:51:10 -0700"/>
                            <attachment id="12783216" name="SOLR-8522.patch" size="17258" author="arcadius" created="Tue, 19 Jan 2016 16:35:58 -0700"/>
                            <attachment id="12781205" name="SOLR-8522.patch" size="14023" author="arcadius" created="Fri, 8 Jan 2016 05:35:00 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 14 Jan 2016 05:15:56 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2r1af:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8517] Implement minimal set of get* methods in ResultSetImpl for column names</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8517</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;This is related to the ResultSetImpl for column indices but requires that more metadata be based back from the SQL handler in relation to column names. The SQL handler already knows about the column names and order but they aren't passed back to the client. SQL clients used the column names to display so this must be implemented for DBVisualizer to work properly.&lt;/p&gt;</description>
                <environment/>
        <key id="12928439">SOLR-8517</key>
            <summary>Implement minimal set of get* methods in ResultSetImpl for column names</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12928403">SOLR-8502</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="10">Implemented</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="risdenk">Kevin Risden</reporter>
                        <labels>
                    </labels>
                <created>Thu, 7 Jan 2016 13:47:23 -0700</created>
                <updated>Mon, 25 Jan 2016 19:41:28 -0700</updated>
                            <resolved>Mon, 25 Jan 2016 19:41:04 -0700</resolved>
                                    <version>6.0</version>
                                    <fixVersion>6.0</fixVersion>
                                    <component>SolrJ</component>
                        <due/>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="15112963" author="risdenk" created="Fri, 22 Jan 2016 12:53:17 -0700">&lt;p&gt;This patch adds some get* methods for column names and adds checks for closed ResultSet. It is a naive approach of casting the object from Tuple#get. It may make sense to add get* methods to Tuple like getLong and getDouble. &lt;/p&gt;</comment>
                            <comment id="15115292" author="risdenk" created="Mon, 25 Jan 2016 07:37:18 -0700">&lt;p&gt;Added some tests for getObject.&lt;/p&gt;</comment>
                            <comment id="15115383" author="risdenk" created="Mon, 25 Jan 2016 08:24:55 -0700">&lt;p&gt;Fixes a NPE with .toString() on the Tuple#getString method when manually testing. Use String.valueOf instead of toString()&lt;/p&gt;</comment>
                            <comment id="15115692" author="risdenk" created="Mon, 25 Jan 2016 11:18:57 -0700">&lt;p&gt;Created PR for this: &lt;a href="https://github.com/apache/lucene-solr/pull/3" class="external-link" rel="nofollow"&gt;https://github.com/apache/lucene-solr/pull/3&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15115778" author="risdenk" created="Mon, 25 Jan 2016 12:05:29 -0700">&lt;p&gt;Fixed merge issues on top of changes from &lt;a href="https://issues.apache.org/jira/browse/SOLR-8519" title="Implement ResultSetMetaDataImpl.getColumnCount()" class="issue-link" data-issue-key="SOLR-8519"&gt;&lt;del&gt;SOLR-8519&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15116530" author="joel.bernstein" created="Mon, 25 Jan 2016 19:34:06 -0700">&lt;p&gt;Working with this patch now. I made some changes to how numerics are handled. I believe all numerics will be converted to longs or doubles during the json de-serialization. To support SQL properly we need to support getInt, getFloat, getShort, getByte along with getLong and getDouble. So I changed the Numeric handling to cast to a Number and return the corresponding primitive type. If we want to add some safeguards to protect against truncation and loss of precision we can come back and do that in another ticket. &lt;/p&gt;</comment>
                            <comment id="15116533" author="joel.bernstein" created="Mon, 25 Jan 2016 19:38:13 -0700">&lt;p&gt;Commit: &lt;a href="https://github.com/apache/lucene-solr/commit/ce0069a75126ee9d9f2b82aaf380317562bf5f50" class="external-link" rel="nofollow"&gt;https://github.com/apache/lucene-solr/commit/ce0069a75126ee9d9f2b82aaf380317562bf5f50&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12928434">SOLR-8512</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12928434">SOLR-8512</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12784205" name="SOLR-8517.patch" size="6626" author="risdenk" created="Mon, 25 Jan 2016 12:05:29 -0700"/>
                            <attachment id="12784171" name="SOLR-8517.patch" size="6653" author="risdenk" created="Mon, 25 Jan 2016 08:24:55 -0700"/>
                            <attachment id="12784160" name="SOLR-8517.patch" size="6818" author="risdenk" created="Mon, 25 Jan 2016 07:37:18 -0700"/>
                            <attachment id="12783894" name="SOLR-8517.patch" size="4780" author="risdenk" created="Fri, 22 Jan 2016 12:53:17 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 26 Jan 2016 02:34:06 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2r06v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8512] Implement minimal set of get* methods in ResultSetImpl for column indices</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8512</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;SQL clients use the proper get* methods on the ResultSet to return items to be displayed. At minimum, the following methods should be implemented for column index:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;public Object getObject&lt;/li&gt;
	&lt;li&gt;public String getString&lt;/li&gt;
	&lt;li&gt;public boolean getBoolean&lt;/li&gt;
	&lt;li&gt;public short getShort&lt;/li&gt;
	&lt;li&gt;public int getInt&lt;/li&gt;
	&lt;li&gt;public long getLong&lt;/li&gt;
	&lt;li&gt;public float getFloat&lt;/li&gt;
	&lt;li&gt;public double getDouble&lt;/li&gt;
	&lt;li&gt;public BigDecimal getBigDecimal&lt;/li&gt;
	&lt;li&gt;public Date getDate&lt;/li&gt;
	&lt;li&gt;public Time getTime&lt;/li&gt;
	&lt;li&gt;public Timestamp getTimestamp&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment/>
        <key id="12928434">SOLR-8512</key>
            <summary>Implement minimal set of get* methods in ResultSetImpl for column indices</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12928403">SOLR-8502</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="10">Implemented</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="risdenk">Kevin Risden</reporter>
                        <labels>
                    </labels>
                <created>Thu, 7 Jan 2016 13:31:17 -0700</created>
                <updated>Mon, 25 Jan 2016 20:55:31 -0700</updated>
                            <resolved>Mon, 25 Jan 2016 20:55:02 -0700</resolved>
                                    <version>6.0</version>
                                    <fixVersion>6.0</fixVersion>
                                    <component>SolrJ</component>
                        <due/>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="15095518" author="risdenk" created="Tue, 12 Jan 2016 20:07:29 -0700">&lt;p&gt;Adding some notes here after thinking about this in relation to &lt;a href="https://issues.apache.org/jira/browse/SOLR-8002" title="Add column alias support to the Parallel SQL Interface " class="issue-link" data-issue-key="SOLR-8002"&gt;&lt;del&gt;SOLR-8002&lt;/del&gt;&lt;/a&gt; and a rough idea patch.&lt;/p&gt;

&lt;p&gt;Any reason to not always return a SelectStream from SQL handler instead of checking if there are columnAliases?&lt;/p&gt;

&lt;p&gt;The SelectStream can guarantee the tuples have the fields in the same order as the SQL statement. For example: select a, b, c from table; will result in tuple.get(0) being a, tuple.get(1) = b, etc. Without the SelectStream wrapping, the fields are in an arbitrary order.&lt;/p&gt;

&lt;p&gt;In addition to wrapping the result in SelectStream, this also requires that the columnAliases, reverseColumnAliases, and tuple.fields are LinkedHashMap instead of just plain HashMap to keep the keys in insertion order. I have a rough patch that has these changes just wasn't sure if it made sense to add to this or to a separate JIRA.&lt;/p&gt;</comment>
                            <comment id="15095540" author="joel.bernstein" created="Tue, 12 Jan 2016 20:35:54 -0700">&lt;p&gt;I like the idea of using the SelectStream. But I think the order will be lost by the JDBC driver. The JDBC driver uses a SolrStream under the covers which is using the JSONTupleStream. I believe the JSONTupleStream is going to lose the field order as it reads the stream in.&lt;/p&gt;



</comment>
                            <comment id="15095545" author="risdenk" created="Tue, 12 Jan 2016 20:41:17 -0700">&lt;p&gt;I can cleanup this patch and add some tests to TestSQLHandler and JdbcTest to check this works in the test cases tomorrow.&lt;/p&gt;

&lt;p&gt;From the limited manual testing I did, the order was not lost when coming back from the JSONTupleStream. The order was kept since the LinkedHashMap was serialized/deserialized properly. I tried it with simple select, limit, and grouping manually in a debugger and it looked ok.&lt;/p&gt;</comment>
                            <comment id="15096182" author="joel.bernstein" created="Wed, 13 Jan 2016 06:34:01 -0700">&lt;p&gt;This would also help with the visual display of Tuples. Rather then randomly ordering the columns, having a fixed column order is a nice improvement.&lt;/p&gt;</comment>
                            <comment id="15096236" author="risdenk" created="Wed, 13 Jan 2016 07:12:49 -0700">&lt;p&gt;This patch contains the fixes to preserve ordering of tuples by using the LinkedHashMap, implements get* for column indices in ResultSetImpl, and adds some tests to JdbcTest for this.&lt;/p&gt;</comment>
                            <comment id="15115317" author="risdenk" created="Mon, 25 Jan 2016 07:52:34 -0700">&lt;p&gt;Depends upon metadata from &lt;a href="https://issues.apache.org/jira/browse/SOLR-8519" title="Implement ResultSetMetaDataImpl.getColumnCount()" class="issue-link" data-issue-key="SOLR-8519"&gt;&lt;del&gt;SOLR-8519&lt;/del&gt;&lt;/a&gt; and implemented methods from &lt;a href="https://issues.apache.org/jira/browse/SOLR-8517" title="Implement minimal set of get* methods in ResultSetImpl for column names" class="issue-link" data-issue-key="SOLR-8517"&gt;&lt;del&gt;SOLR-8517&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15115322" author="risdenk" created="Mon, 25 Jan 2016 07:54:47 -0700">&lt;p&gt;Patch that builds upon metadata passing from &lt;a href="https://issues.apache.org/jira/browse/SOLR-8519" title="Implement ResultSetMetaDataImpl.getColumnCount()" class="issue-link" data-issue-key="SOLR-8519"&gt;&lt;del&gt;SOLR-8519&lt;/del&gt;&lt;/a&gt;. This is much simpler than modifying the underlying map of the tuples.&lt;/p&gt;</comment>
                            <comment id="15115783" author="risdenk" created="Mon, 25 Jan 2016 12:08:12 -0700">&lt;p&gt;Fixed merge issues on top of &lt;a href="https://issues.apache.org/jira/browse/SOLR-8519" title="Implement ResultSetMetaDataImpl.getColumnCount()" class="issue-link" data-issue-key="SOLR-8519"&gt;&lt;del&gt;SOLR-8519&lt;/del&gt;&lt;/a&gt; and &lt;a href="https://issues.apache.org/jira/browse/SOLR-8517" title="Implement minimal set of get* methods in ResultSetImpl for column names" class="issue-link" data-issue-key="SOLR-8517"&gt;&lt;del&gt;SOLR-8517&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15116548" author="risdenk" created="Mon, 25 Jan 2016 19:48:34 -0700">&lt;p&gt;Patch that takes into account changes from &lt;a href="https://issues.apache.org/jira/browse/SOLR-8517" title="Implement minimal set of get* methods in ResultSetImpl for column names" class="issue-link" data-issue-key="SOLR-8517"&gt;&lt;del&gt;SOLR-8517&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15116616" author="joel.bernstein" created="Mon, 25 Jan 2016 20:45:18 -0700">&lt;p&gt;Patch looks great. Running precommit now.&lt;/p&gt;</comment>
                            <comment id="15116629" author="joel.bernstein" created="Mon, 25 Jan 2016 20:54:42 -0700">&lt;p&gt;commit: &lt;a href="https://github.com/apache/lucene-solr/commit/0ff8d11367f8fe734abba9203d48be878f4ce7f2" class="external-link" rel="nofollow"&gt;https://github.com/apache/lucene-solr/commit/0ff8d11367f8fe734abba9203d48be878f4ce7f2&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12928439">SOLR-8517</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12928439">SOLR-8517</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12928445">SOLR-8519</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12928443">SOLR-8518</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12784321" name="SOLR-8512.patch" size="14155" author="risdenk" created="Mon, 25 Jan 2016 19:48:34 -0700"/>
                            <attachment id="12784207" name="SOLR-8512.patch" size="12058" author="risdenk" created="Mon, 25 Jan 2016 12:08:12 -0700"/>
                            <attachment id="12784164" name="SOLR-8512.patch" size="11821" author="risdenk" created="Mon, 25 Jan 2016 07:54:47 -0700"/>
                            <attachment id="12782055" name="SOLR-8512.patch" size="18200" author="risdenk" created="Wed, 13 Jan 2016 07:12:49 -0700"/>
                            <attachment id="12781981" name="sql-preserve-order.patch" size="7201" author="risdenk" created="Tue, 12 Jan 2016 20:07:29 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 13 Jan 2016 03:35:54 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2r05r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8507] Add information about database product name, product version, driver name, and driver version.</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8507</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;DBVisualizer asks for information about database product name, product version, driver name, and driver version. These should be implemented in DatabaseMetaDataImpl.&lt;/p&gt;

&lt;p&gt;2016-01-07 13:30:10.814 FINE    83 &lt;span class="error"&gt;&amp;#91;pool-3-thread-10 - E.&amp;#93;&lt;/span&gt; RootConnection: DatabaseMetaDataImpl.getDatabaseProductName()&lt;br/&gt;
2016-01-07 13:30:10.814 FINE    83 &lt;span class="error"&gt;&amp;#91;pool-3-thread-10 - E.&amp;#93;&lt;/span&gt; RootConnection: DatabaseMetaDataImpl.getDatabaseProductVersion()&lt;br/&gt;
2016-01-07 13:30:10.814 FINE    83 &lt;span class="error"&gt;&amp;#91;pool-3-thread-10 - E.&amp;#93;&lt;/span&gt; RootConnection: DatabaseMetaDataImpl.getDriverName()&lt;br/&gt;
2016-01-07 13:30:10.814 FINE    83 &lt;span class="error"&gt;&amp;#91;pool-3-thread-10 - E.&amp;#93;&lt;/span&gt; RootConnection: DatabaseMetaDataImpl.getDriverVersion()&lt;/p&gt;</description>
                <environment/>
        <key id="12928417">SOLR-8507</key>
            <summary>Add information about database product name, product version, driver name, and driver version.</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12928403">SOLR-8502</parent>
                                    <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="10">Implemented</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="risdenk">Kevin Risden</reporter>
                        <labels>
                    </labels>
                <created>Thu, 7 Jan 2016 12:39:24 -0700</created>
                <updated>Sat, 6 Feb 2016 18:26:56 -0700</updated>
                            <resolved>Sat, 6 Feb 2016 18:26:56 -0700</resolved>
                                    <version>6.0</version>
                                    <fixVersion>6.0</fixVersion>
                                    <component>SolrJ</component>
                        <due/>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="15087963" author="risdenk" created="Thu, 7 Jan 2016 12:42:15 -0700">&lt;p&gt;Requires &lt;a href="https://issues.apache.org/jira/browse/SOLR-8503" title="Implement org.apache.solr.client.solrj.io.sql.ConnectionImpl.getMetaData and getCatalog" class="issue-link" data-issue-key="SOLR-8503"&gt;&lt;del&gt;SOLR-8503&lt;/del&gt;&lt;/a&gt; to be merged first.&lt;/p&gt;</comment>
                            <comment id="15088010" author="risdenk" created="Thu, 7 Jan 2016 13:02:24 -0700">&lt;p&gt;No tests yet. Few questions about the approach:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Is there a way to parse Solr version strings already?&lt;/li&gt;
	&lt;li&gt;Should the Solr cluster be queried and use the minimum version number of all live nodes?&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15099291" author="joel.bernstein" created="Thu, 14 Jan 2016 18:34:23 -0700">&lt;p&gt;Let's just get the version from one node to keep it simple. Then we just need a few tests.&lt;/p&gt;</comment>
                            <comment id="15101933" author="risdenk" created="Fri, 15 Jan 2016 08:36:58 -0700">&lt;p&gt;I'm running into an issue when writing tests for the versions. The logic currently relies on querying /admin/info/system and pulling out the solr-spec-version. This doesn't seem to be populated during the tests if I query the test cluster. I found the following from SystemInfoHandler and p.getSpecificationVersion() is null during the tests. When I query that same url on a running Solr server from a trunk build it works just fine.&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
&lt;span class="code-keyword"&gt;private&lt;/span&gt; &lt;span class="code-keyword"&gt;static&lt;/span&gt; SimpleOrderedMap&amp;lt;&lt;span class="code-object"&gt;Object&lt;/span&gt;&amp;gt; getLuceneInfo() {
    SimpleOrderedMap&amp;lt;&lt;span class="code-object"&gt;Object&lt;/span&gt;&amp;gt; info = &lt;span class="code-keyword"&gt;new&lt;/span&gt; SimpleOrderedMap&amp;lt;&amp;gt;();

    Package p = SolrCore.class.getPackage();

    info.add( &lt;span class="code-quote"&gt;"solr-spec-version"&lt;/span&gt;, p.getSpecificationVersion() );
    info.add( &lt;span class="code-quote"&gt;"solr-impl-version"&lt;/span&gt;, p.getImplementationVersion() );
  
    p = LucenePackage.class.getPackage();

    info.add( &lt;span class="code-quote"&gt;"lucene-spec-version"&lt;/span&gt;, p.getSpecificationVersion() );
    info.add( &lt;span class="code-quote"&gt;"lucene-impl-version"&lt;/span&gt;, p.getImplementationVersion() );

    &lt;span class="code-keyword"&gt;return&lt;/span&gt; info;
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I compared the solrconfig-sql.xml to the one that is the default shipped with Solr. So two questions:&lt;br/&gt;
1) is the version not being populated since its not a full build?&lt;br/&gt;
2) if #1 is true, what is a better way to query the Solr Cluster versions?&lt;/p&gt;</comment>
                            <comment id="15102034" author="risdenk" created="Fri, 15 Jan 2016 09:36:49 -0700">&lt;p&gt;The same issue is going to happen with DatabaseMetaDataImpl getDriverVersion and getDriverName. These rely on this.getClass().getPackage() which has no package properties filled in during a test. The SystemInfoHandlerTest has no tests for SystemInfoHandler.getLuceneInfo which relies on the same Manifest information. The package information only seems to be populated from the Manifest info in a jar &lt;a href="https://docs.oracle.com/javase/tutorial/deployment/jar/packageman.html" class="external-link" rel="nofollow"&gt;https://docs.oracle.com/javase/tutorial/deployment/jar/packageman.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15102062" author="joel.bernstein" created="Fri, 15 Jan 2016 09:54:02 -0700">&lt;p&gt;How important are these properties in getting things running with DBVisualizer? Can we just leave these unimplemented for now and get DBVisualizer working without them?&lt;/p&gt;</comment>
                            <comment id="15102066" author="risdenk" created="Fri, 15 Jan 2016 09:56:50 -0700">&lt;p&gt;These are just metadata that would fill in some DBVisualizer fields but isn't completely necessary to get DBVisualizer to work.&lt;/p&gt;</comment>
                            <comment id="15102073" author="joel.bernstein" created="Fri, 15 Jan 2016 10:03:13 -0700">&lt;p&gt;Ok, then my gut instinct is to move on to another ticket. The only tricky part will be if not having this patch applied stops us from cleanly applying other patches. &lt;/p&gt;</comment>
                            <comment id="15102076" author="risdenk" created="Fri, 15 Jan 2016 10:05:08 -0700">&lt;p&gt;None of the other subtasks rely on this. I've tried to list dependencies properly by relating the JIRA tickets.&lt;/p&gt;</comment>
                            <comment id="15102079" author="joel.bernstein" created="Fri, 15 Jan 2016 10:06:23 -0700">&lt;p&gt;Great, let's move to the next one.&lt;/p&gt;</comment>
                            <comment id="15123830" author="risdenk" created="Fri, 29 Jan 2016 10:27:17 -0700">&lt;p&gt;Rebased on top of master. Tests are commented out still due to not being able to really test the package information stuff.&lt;/p&gt;</comment>
                            <comment id="15128744" author="joel.bernstein" created="Tue, 2 Feb 2016 11:32:45 -0700">&lt;p&gt;I think it makes sense to commit this now so since it's working with manual testing. Then come back in another ticket and work with the test framework to support these calls.&lt;/p&gt;

&lt;p&gt;I would like to make one change to the implementation though, which is to call only one node to get the version information. Calling each live node could be quite a large number of calls with a large cluster.&lt;/p&gt;</comment>
                            <comment id="15128877" author="risdenk" created="Tue, 2 Feb 2016 12:43:25 -0700">&lt;p&gt;Ah I thought I had fixed the issue with looping through all the nodes. I can update this later today most likely. I'll keep the loop just short circuit when the first node responds instead of comparing versions.&lt;/p&gt;</comment>
                            <comment id="15128937" author="risdenk" created="Tue, 2 Feb 2016 13:13:13 -0700">&lt;p&gt;Attached patch with commented out tests which short circuits when it finds first node that doesn't fail getting version information.&lt;/p&gt;</comment>
                            <comment id="15129043" author="joel.bernstein" created="Tue, 2 Feb 2016 14:15:34 -0700">&lt;p&gt;Read through patch and made some slight changes. It's now exiting out of the loop even if there is an error on first live node. I don't want to get into a situation where we cycle through each node getting errors. I'll attach a patch with the changes. I'll take a little time manually testing this with DbVisualizer before committing.&lt;/p&gt;

&lt;p&gt;Once this is committed do you feel we're ready to close out &lt;a href="https://issues.apache.org/jira/browse/SOLR-8502" title="Improve Solr JDBC Driver to support SQL Clients like DBVisualizer" class="issue-link" data-issue-key="SOLR-8502"&gt;&lt;del&gt;SOLR-8502&lt;/del&gt;&lt;/a&gt; and add it to CHANGES.txt?&lt;/p&gt;</comment>
                            <comment id="15129048" author="joel.bernstein" created="Tue, 2 Feb 2016 14:16:51 -0700">&lt;p&gt;Patch with slight changes on error handling.&lt;/p&gt;</comment>
                            <comment id="15129062" author="risdenk" created="Tue, 2 Feb 2016 14:27:23 -0700">&lt;p&gt;Yea that sounds good to me. I can move the remaining subtasks (&lt;a href="https://issues.apache.org/jira/browse/SOLR-8613" title="SolrJ JDBC - SQL queries with limit do not fail when a bad column is provided" class="issue-link" data-issue-key="SOLR-8613"&gt;SOLR-8613&lt;/a&gt;, &lt;a href="https://issues.apache.org/jira/browse/SOLR-8213" title="SolrJ JDBC support basic authentication" class="issue-link" data-issue-key="SOLR-8213"&gt;SOLR-8213&lt;/a&gt;, and &lt;a href="https://issues.apache.org/jira/browse/SOLR-8521" title="Add documentation for how to use Solr JDBC driver with SQL client like DB Visualizer" class="issue-link" data-issue-key="SOLR-8521"&gt;&lt;del&gt;SOLR-8521&lt;/del&gt;&lt;/a&gt;) from &lt;a href="https://issues.apache.org/jira/browse/SOLR-8502" title="Improve Solr JDBC Driver to support SQL Clients like DBVisualizer" class="issue-link" data-issue-key="SOLR-8502"&gt;&lt;del&gt;SOLR-8502&lt;/del&gt;&lt;/a&gt; to &lt;a href="https://issues.apache.org/jira/browse/SOLR-8125" title="Umbrella ticket for Streaming and SQL issues" class="issue-link" data-issue-key="SOLR-8125"&gt;SOLR-8125&lt;/a&gt;. &lt;/p&gt;</comment>
                            <comment id="15136088" author="jira-bot" created="Sat, 6 Feb 2016 18:24:17 -0700">&lt;p&gt;Commit dc6b1a68d28142a1ef85f497b6437cbd7f2777f0 in lucene-solr's branch refs/heads/master from jbernste&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=dc6b1a6" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=dc6b1a6&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8507" title="Add information about database product name, product version, driver name, and driver version." class="issue-link" data-issue-key="SOLR-8507"&gt;&lt;del&gt;SOLR-8507&lt;/del&gt;&lt;/a&gt;, &lt;a href="https://issues.apache.org/jira/browse/SOLR-8638" title="Implement ConnectionImpl setCatalog and setSchema" class="issue-link" data-issue-key="SOLR-8638"&gt;&lt;del&gt;SOLR-8638&lt;/del&gt;&lt;/a&gt;: Add information about database product name, product version, driver name, and driver version. Implement ConnectionImpl setCatalog and setSchema.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310060">
                    <name>Container</name>
                                            <outwardlinks description="contains">
                                        <issuelink>
            <issuekey id="12928416">SOLR-8506</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12928405">SOLR-8503</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12785865" name="SOLR-8507.patch" size="7042" author="joel.bernstein" created="Tue, 2 Feb 2016 14:16:51 -0700"/>
                            <attachment id="12785846" name="SOLR-8507.patch" size="7349" author="risdenk" created="Tue, 2 Feb 2016 13:13:13 -0700"/>
                            <attachment id="12785197" name="SOLR-8507.patch" size="6947" author="risdenk" created="Fri, 29 Jan 2016 10:27:17 -0700"/>
                            <attachment id="12781051" name="SOLR-8507.patch" size="5901" author="risdenk" created="Thu, 7 Jan 2016 13:02:24 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 15 Jan 2016 01:34:23 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2r01z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8502] Improve Solr JDBC Driver to support SQL Clients like DBVisualizer</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8502</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Currently when trying to connect to Solr with the JDBC driver with a SQL client the driver must implement more methods and metadata to allow connections. This JIRA is designed to act as an umbrella for the JDBC changes.&lt;/p&gt;

&lt;p&gt;An initial pass from a few months ago is here: &lt;a href="https://github.com/risdenk/lucene-solr/tree/expand-jdbc" class="external-link" rel="nofollow"&gt;https://github.com/risdenk/lucene-solr/tree/expand-jdbc&lt;/a&gt;. This needs to be broken up and create patches for the related sub tasks.&lt;/p&gt;</description>
                <environment/>
        <key id="12928403">SOLR-8502</key>
            <summary>Improve Solr JDBC Driver to support SQL Clients like DBVisualizer</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="10">Implemented</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="risdenk">Kevin Risden</reporter>
                        <labels>
                            <label>jdbc</label>
                    </labels>
                <created>Thu, 7 Jan 2016 12:02:52 -0700</created>
                <updated>Thu, 10 Mar 2016 14:22:31 -0700</updated>
                            <resolved>Sat, 6 Feb 2016 19:47:10 -0700</resolved>
                                    <version>master</version>
                                    <fixVersion>6.0</fixVersion>
                                    <component>SolrJ</component>
                        <due/>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                            <comments>
                            <comment id="15087922" author="joel.bernstein" created="Thu, 7 Jan 2016 12:25:58 -0700">&lt;p&gt;+1 this is an exciting ticket!&lt;/p&gt;</comment>
                            <comment id="15088070" author="risdenk" created="Thu, 7 Jan 2016 13:42:56 -0700">&lt;p&gt;Laid out an initial set of subtasks and an approximate order. Most of these are already done in &lt;a href="https://github.com/risdenk/lucene-solr/tree/expand-jdbc" class="external-link" rel="nofollow"&gt;https://github.com/risdenk/lucene-solr/tree/expand-jdbc&lt;/a&gt; so just need to spend the time breaking it out and adding tests.&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8503" title="Implement org.apache.solr.client.solrj.io.sql.ConnectionImpl.getMetaData and getCatalog" class="issue-link" data-issue-key="SOLR-8503"&gt;&lt;del&gt;SOLR-8503&lt;/del&gt;&lt;/a&gt; must be committed first since it adds a class DatabaseMetaDataImpl.&lt;/p&gt;</comment>
                            <comment id="15089503" author="risdenk" created="Fri, 8 Jan 2016 09:59:21 -0700">&lt;p&gt;The following filter can be used to look at the tickets that have patches, but are not committed/closed yet.&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/issues/?filter=12334493&amp;amp;jql=project%20%3D%20SOLR%20AND%20parent%20%3D%20SOLR-8502%20AND%20Flags%20%3D%20patch%20AND%20status%20not%20in%20(Fixed%2C%20Closed%2C%20Done%2C%20Invalid)%20and%20attachments%20is%20not%20EMPTY%20order%20by%20created%20ASC" class="external-link" rel="nofollow"&gt;https://issues.apache.org/jira/issues/?filter=12334493&amp;amp;jql=project%20%3D%20SOLR%20AND%20parent%20%3D%20SOLR-8502%20AND%20Flags%20%3D%20patch%20AND%20status%20not%20in%20(Fixed%2C%20Closed%2C%20Done%2C%20Invalid)%20and%20attachments%20is%20not%20EMPTY%20order%20by%20created%20ASC&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=joel.bernstein" class="user-hover" rel="joel.bernstein"&gt;Joel Bernstein&lt;/a&gt; - Can you take a look at these when you get a chance?&lt;/p&gt;</comment>
                            <comment id="15089556" author="joel.bernstein" created="Fri, 8 Jan 2016 10:22:38 -0700">&lt;p&gt;It looks like the jira filter is private. You can also just list the jira's that are ready for review.&lt;/p&gt;

&lt;p&gt;This is a high priority for Solr 6. So I'll definitely work with you to get the code reviewed and ready to be committed.  &lt;/p&gt;</comment>
                            <comment id="15089599" author="risdenk" created="Fri, 8 Jan 2016 10:51:10 -0700">&lt;p&gt;Here are some of the JIRAs are that are ready for review.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8503" title="Implement org.apache.solr.client.solrj.io.sql.ConnectionImpl.getMetaData and getCatalog" class="issue-link" data-issue-key="SOLR-8503"&gt;&lt;del&gt;SOLR-8503&lt;/del&gt;&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8507" title="Add information about database product name, product version, driver name, and driver version." class="issue-link" data-issue-key="SOLR-8507"&gt;&lt;del&gt;SOLR-8507&lt;/del&gt;&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8509" title="Determine test strategy and add tests for JDBC driver metadata." class="issue-link" data-issue-key="SOLR-8509"&gt;&lt;del&gt;SOLR-8509&lt;/del&gt;&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8511" title="Implement DatabaseMetaDataImpl.getURL()" class="issue-link" data-issue-key="SOLR-8511"&gt;&lt;del&gt;SOLR-8511&lt;/del&gt;&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8513" title="Implement ResultSetImpl.getMetaData()" class="issue-link" data-issue-key="SOLR-8513"&gt;&lt;del&gt;SOLR-8513&lt;/del&gt;&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8514" title="Implement StatementImpl.execute(String sql), StatementImpl.getResultSet(), and StatementImpl.getUpdateCount()" class="issue-link" data-issue-key="SOLR-8514"&gt;&lt;del&gt;SOLR-8514&lt;/del&gt;&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8515" title="Implement StatementImpl.getConnection" class="issue-link" data-issue-key="SOLR-8515"&gt;&lt;del&gt;SOLR-8515&lt;/del&gt;&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8516" title="Implement ResultSetImpl.getStatement" class="issue-link" data-issue-key="SOLR-8516"&gt;&lt;del&gt;SOLR-8516&lt;/del&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15102256" author="jira-bot" created="Fri, 15 Jan 2016 11:30:13 -0700">&lt;p&gt;Commit 1724867 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=joel.bernstein" class="user-hover" rel="joel.bernstein"&gt;Joel Bernstein&lt;/a&gt; in branch 'dev/trunk'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1724867" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1724867&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8502" title="Improve Solr JDBC Driver to support SQL Clients like DBVisualizer" class="issue-link" data-issue-key="SOLR-8502"&gt;&lt;del&gt;SOLR-8502&lt;/del&gt;&lt;/a&gt;: Implement DatabaseMetaDataImpl.getURL()&lt;/p&gt;</comment>
                            <comment id="15102297" author="jira-bot" created="Fri, 15 Jan 2016 11:56:01 -0700">&lt;p&gt;Commit 1724870 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=joel.bernstein" class="user-hover" rel="joel.bernstein"&gt;Joel Bernstein&lt;/a&gt; in branch 'dev/trunk'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1724870" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1724870&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8513" title="Implement ResultSetImpl.getMetaData()" class="issue-link" data-issue-key="SOLR-8513"&gt;&lt;del&gt;SOLR-8513&lt;/del&gt;&lt;/a&gt;,&lt;a href="https://issues.apache.org/jira/browse/SOLR-8502" title="Improve Solr JDBC Driver to support SQL Clients like DBVisualizer" class="issue-link" data-issue-key="SOLR-8502"&gt;&lt;del&gt;SOLR-8502&lt;/del&gt;&lt;/a&gt;: Implement ResultSetImpl.getMetaData()&lt;/p&gt;</comment>
                            <comment id="15107229" author="jira-bot" created="Tue, 19 Jan 2016 12:14:17 -0700">&lt;p&gt;Commit 1725595 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=joel.bernstein" class="user-hover" rel="joel.bernstein"&gt;Joel Bernstein&lt;/a&gt; in branch 'dev/trunk'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1725595" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1725595&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8515" title="Implement StatementImpl.getConnection" class="issue-link" data-issue-key="SOLR-8515"&gt;&lt;del&gt;SOLR-8515&lt;/del&gt;&lt;/a&gt;, &lt;a href="https://issues.apache.org/jira/browse/SOLR-8502" title="Improve Solr JDBC Driver to support SQL Clients like DBVisualizer" class="issue-link" data-issue-key="SOLR-8502"&gt;&lt;del&gt;SOLR-8502&lt;/del&gt;&lt;/a&gt;: Implement StatementImpl.getConnection&lt;/p&gt;</comment>
                            <comment id="15107466" author="jira-bot" created="Tue, 19 Jan 2016 14:25:39 -0700">&lt;p&gt;Commit 1725616 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=joel.bernstein" class="user-hover" rel="joel.bernstein"&gt;Joel Bernstein&lt;/a&gt; in branch 'dev/trunk'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1725616" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1725616&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8516" title="Implement ResultSetImpl.getStatement" class="issue-link" data-issue-key="SOLR-8516"&gt;&lt;del&gt;SOLR-8516&lt;/del&gt;&lt;/a&gt;, &lt;a href="https://issues.apache.org/jira/browse/SOLR-8502" title="Improve Solr JDBC Driver to support SQL Clients like DBVisualizer" class="issue-link" data-issue-key="SOLR-8502"&gt;&lt;del&gt;SOLR-8502&lt;/del&gt;&lt;/a&gt;: Implement ResultSetImpl.getStatement&lt;/p&gt;</comment>
                            <comment id="15107829" author="jira-bot" created="Tue, 19 Jan 2016 19:12:33 -0700">&lt;p&gt;Commit 1725662 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=joel.bernstein" class="user-hover" rel="joel.bernstein"&gt;Joel Bernstein&lt;/a&gt; in branch 'dev/trunk'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1725662" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1725662&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8514" title="Implement StatementImpl.execute(String sql), StatementImpl.getResultSet(), and StatementImpl.getUpdateCount()" class="issue-link" data-issue-key="SOLR-8514"&gt;&lt;del&gt;SOLR-8514&lt;/del&gt;&lt;/a&gt;, &lt;a href="https://issues.apache.org/jira/browse/SOLR-8502" title="Improve Solr JDBC Driver to support SQL Clients like DBVisualizer" class="issue-link" data-issue-key="SOLR-8502"&gt;&lt;del&gt;SOLR-8502&lt;/del&gt;&lt;/a&gt;: Implement StatementImpl.execute(String sql), StatementImpl.getResultSet(), and StatementImpl.getUpdateCount()&lt;/p&gt;</comment>
                            <comment id="15112916" author="risdenk" created="Fri, 22 Jan 2016 12:24:17 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=joel.bernstein" class="user-hover" rel="joel.bernstein"&gt;Joel Bernstein&lt;/a&gt; - Can you take a look at &lt;a href="https://issues.apache.org/jira/browse/SOLR-8573" title="Implement ConnectionImpl,StatementImpl,ResultSetImpl clearWarnings and getWarnings" class="issue-link" data-issue-key="SOLR-8573"&gt;&lt;del&gt;SOLR-8573&lt;/del&gt;&lt;/a&gt; and &lt;a href="https://issues.apache.org/jira/browse/SOLR-8519" title="Implement ResultSetMetaDataImpl.getColumnCount()" class="issue-link" data-issue-key="SOLR-8519"&gt;&lt;del&gt;SOLR-8519&lt;/del&gt;&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="15113111" author="joel.bernstein" created="Fri, 22 Jan 2016 14:24:45 -0700">&lt;p&gt;Looks like you've got a number of tickets ready to go. Can you make another list of jiras. I should be able to review and comment over the weekend. Because of the git migration we'll have to start the commits next week. I'll make a push next week to try and get as much in before the 6.0 release.&lt;/p&gt;</comment>
                            <comment id="15115325" author="risdenk" created="Mon, 25 Jan 2016 07:56:17 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=joel.bernstein" class="user-hover" rel="joel.bernstein"&gt;Joel Bernstein&lt;/a&gt; Here are some more tickets that are ready for review:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8519" title="Implement ResultSetMetaDataImpl.getColumnCount()" class="issue-link" data-issue-key="SOLR-8519"&gt;&lt;del&gt;SOLR-8519&lt;/del&gt;&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8517" title="Implement minimal set of get* methods in ResultSetImpl for column names" class="issue-link" data-issue-key="SOLR-8517"&gt;&lt;del&gt;SOLR-8517&lt;/del&gt;&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8512" title="Implement minimal set of get* methods in ResultSetImpl for column indices" class="issue-link" data-issue-key="SOLR-8512"&gt;&lt;del&gt;SOLR-8512&lt;/del&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;They have to be merged in that order based on dependencies. There might be slight conflicts between them, but easily addressed.&lt;/p&gt;</comment>
                            <comment id="15116566" author="risdenk" created="Mon, 25 Jan 2016 20:06:17 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8518" title="Implement ResultSetMetaDataImpl getColumnType and getColumnTypeName" class="issue-link" data-issue-key="SOLR-8518"&gt;&lt;del&gt;SOLR-8518&lt;/del&gt;&lt;/a&gt; has a patch available as well once &lt;a href="https://issues.apache.org/jira/browse/SOLR-8512" title="Implement minimal set of get* methods in ResultSetImpl for column indices" class="issue-link" data-issue-key="SOLR-8512"&gt;&lt;del&gt;SOLR-8512&lt;/del&gt;&lt;/a&gt; is done.&lt;/p&gt;</comment>
                            <comment id="15117303" author="risdenk" created="Tue, 26 Jan 2016 07:40:26 -0700">&lt;p&gt;Added screenshot-1.png to show that rough DBVisualizer is working. The following items are still "issues":&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;The columns are always returned as strings with getString since &lt;a href="https://issues.apache.org/jira/browse/SOLR-8518" title="Implement ResultSetMetaDataImpl getColumnType and getColumnTypeName" class="issue-link" data-issue-key="SOLR-8518"&gt;&lt;del&gt;SOLR-8518&lt;/del&gt;&lt;/a&gt; is not merged&lt;/li&gt;
	&lt;li&gt;ConnectionImpl.isValid() throws a warning that it is not implemented but assumes the connection is valid. &lt;a href="https://issues.apache.org/jira/browse/SOLR-8574" title="Implement ConnectionImpl.isValid() and DatabaseMetaDataImpl.getConnection()" class="issue-link" data-issue-key="SOLR-8574"&gt;&lt;del&gt;SOLR-8574&lt;/del&gt;&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;Column names and width are guessed by dbvisualizer but can be improved with &lt;a href="https://issues.apache.org/jira/browse/SOLR-8520" title="Implement ResultSetMetaDataImpl getColumnLabel(int column) and getColumnDisplaySize(int column)" class="issue-link" data-issue-key="SOLR-8520"&gt;&lt;del&gt;SOLR-8520&lt;/del&gt;&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;DBVisualizer cannot get info about the driver since some methods about versions/names aren't implemented. &lt;a href="https://issues.apache.org/jira/browse/SOLR-8507" title="Add information about database product name, product version, driver name, and driver version." class="issue-link" data-issue-key="SOLR-8507"&gt;&lt;del&gt;SOLR-8507&lt;/del&gt;&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;Catalog/schema info is not implemented so there is an error when trying to populate that info with DBVisualizer &lt;a href="https://issues.apache.org/jira/browse/SOLR-8508" title="Implement DatabaseMetaDataImpl.getCatalogs()" class="issue-link" data-issue-key="SOLR-8508"&gt;&lt;del&gt;SOLR-8508&lt;/del&gt;&lt;/a&gt; and &lt;a href="https://issues.apache.org/jira/browse/SOLR-8510" title="Implement DatabaseMetaDataImpl.getSchemas()" class="issue-link" data-issue-key="SOLR-8510"&gt;&lt;del&gt;SOLR-8510&lt;/del&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15117319" author="joel.bernstein" created="Tue, 26 Jan 2016 07:51:14 -0700">&lt;p&gt;This looks great! &lt;/p&gt;</comment>
                            <comment id="15117861" author="risdenk" created="Tue, 26 Jan 2016 12:54:47 -0700">&lt;p&gt;attached screenshot2.png to show DBVisualizer with printing proper types after &lt;a href="https://issues.apache.org/jira/browse/SOLR-8518" title="Implement ResultSetMetaDataImpl getColumnType and getColumnTypeName" class="issue-link" data-issue-key="SOLR-8518"&gt;&lt;del&gt;SOLR-8518&lt;/del&gt;&lt;/a&gt; was merged.&lt;/p&gt;</comment>
                            <comment id="15118515" author="risdenk" created="Tue, 26 Jan 2016 19:50:57 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=joel.bernstein" class="user-hover" rel="joel.bernstein"&gt;Joel Bernstein&lt;/a&gt; - Here are two more tickets ready for review:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8520" title="Implement ResultSetMetaDataImpl getColumnLabel(int column) and getColumnDisplaySize(int column)" class="issue-link" data-issue-key="SOLR-8520"&gt;&lt;del&gt;SOLR-8520&lt;/del&gt;&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8574" title="Implement ConnectionImpl.isValid() and DatabaseMetaDataImpl.getConnection()" class="issue-link" data-issue-key="SOLR-8574"&gt;&lt;del&gt;SOLR-8574&lt;/del&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15119420" author="risdenk" created="Wed, 27 Jan 2016 08:15:43 -0700">&lt;ul&gt;
	&lt;li&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8602" title="Implement ResultSetImpl.wasNull()" class="issue-link" data-issue-key="SOLR-8602"&gt;&lt;del&gt;SOLR-8602&lt;/del&gt;&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8603" title="Implement StatementImpl.getMoreResults()" class="issue-link" data-issue-key="SOLR-8603"&gt;&lt;del&gt;SOLR-8603&lt;/del&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15119427" author="risdenk" created="Wed, 27 Jan 2016 08:18:04 -0700">&lt;p&gt;This screenshot should be possible with the trunk build &lt;a href="https://builds.apache.org/job/Solr-Artifacts-trunk/2778/" class="external-link" rel="nofollow"&gt;https://builds.apache.org/job/Solr-Artifacts-trunk/2778/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15119775" author="joel.bernstein" created="Wed, 27 Jan 2016 09:55:46 -0700">&lt;p&gt;Ok, I'll work on these this afternoon.&lt;/p&gt;</comment>
                            <comment id="15120513" author="risdenk" created="Wed, 27 Jan 2016 17:35:24 -0700">&lt;p&gt;Including &lt;a href="https://issues.apache.org/jira/browse/SOLR-8520" title="Implement ResultSetMetaDataImpl getColumnLabel(int column) and getColumnDisplaySize(int column)" class="issue-link" data-issue-key="SOLR-8520"&gt;&lt;del&gt;SOLR-8520&lt;/del&gt;&lt;/a&gt;, &lt;a href="https://issues.apache.org/jira/browse/SOLR-8574" title="Implement ConnectionImpl.isValid() and DatabaseMetaDataImpl.getConnection()" class="issue-link" data-issue-key="SOLR-8574"&gt;&lt;del&gt;SOLR-8574&lt;/del&gt;&lt;/a&gt;, &lt;a href="https://issues.apache.org/jira/browse/SOLR-8603" title="Implement StatementImpl.getMoreResults()" class="issue-link" data-issue-key="SOLR-8603"&gt;&lt;del&gt;SOLR-8603&lt;/del&gt;&lt;/a&gt;, and &lt;a href="https://issues.apache.org/jira/browse/SOLR-8602" title="Implement ResultSetImpl.wasNull()" class="issue-link" data-issue-key="SOLR-8602"&gt;&lt;del&gt;SOLR-8602&lt;/del&gt;&lt;/a&gt;:&lt;/p&gt;

&lt;p&gt;DBVisualizer with screenshot-3.png&lt;/p&gt;

&lt;p&gt;JiSQL&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
java -cp /opt/jisql/lib/jisql-2.0.11.jar:/opt/jisql/lib/jopt-simple-3.2.jar:/opt/solr/dist/solrj-lib/*:/opt/solr/dist/solr-solrj-6.0.0-SNAPSHOT.jar com.xigole.util.sql.Jisql -user test -password test -driver org.apache.solr.client.solrj.io.sql.DriverImpl -cstring 'jdbc:solr:&lt;span class="code-comment"&gt;//192.168.1.237:9983?collection=test&amp;amp;aggregationMode=map_reduce' -c \; -query 'select fielda, fieldb, fieldc, fieldd_s, fielde_i from test limit 10;'
&lt;/span&gt;
SLF4J: Failed to load class &lt;span class="code-quote"&gt;"org.slf4j.impl.StaticLoggerBinder"&lt;/span&gt;.
SLF4J: Defaulting to no-operation (NOP) logger implementation
SLF4J: See http:&lt;span class="code-comment"&gt;//www.slf4j.org/codes.html#StaticLoggerBinder &lt;span class="code-keyword"&gt;for&lt;/span&gt; further details.
&lt;/span&gt;SLF4J: Failed to load class &lt;span class="code-quote"&gt;"org.slf4j.impl.StaticMDCBinder"&lt;/span&gt;.
SLF4J: Defaulting to no-operation MDCAdapter implementation.
SLF4J: See http:&lt;span class="code-comment"&gt;//www.slf4j.org/codes.html#no_static_mdc_binder &lt;span class="code-keyword"&gt;for&lt;/span&gt; further details.
&lt;/span&gt;fielda | fieldb | fieldc | fieldd_s | fielde_i |
-------+--------+--------+----------+----------|
    a1 |     b1 |      1 |       d1 |        1 |
    a2 |     b2 |      2 |       d1 |        2 |
    a1 |     b3 |      3 |     NULL |        1 |
    a1 |     b4 |      4 |       d2 |     NULL |
    a2 |     b2 |   NULL |       d2 |        2 |
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15121793" author="joel.bernstein" created="Thu, 28 Jan 2016 09:09:37 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=risdenk" class="user-hover" rel="risdenk"&gt;Kevin Risden&lt;/a&gt;, do we have enough working in DBVisualizer with the latest commit to declare victory on this ticket. If we do, we can close it out and add it to the CHANGES.txt for 6.0. If we can connect, run an aggregation query and chart the result I think that's a great start.&lt;/p&gt;

&lt;p&gt;The remaining issues listed on this ticket we can tackle individually. &lt;/p&gt;

&lt;p&gt;Or do you feel like we need to tackle the calalog and schema issues before closing this out?&lt;/p&gt;</comment>
                            <comment id="15123712" author="risdenk" created="Fri, 29 Jan 2016 09:36:02 -0700">&lt;p&gt;I think the following four tickets should be addressed. I outlined the reasons below:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8507" title="Add information about database product name, product version, driver name, and driver version." class="issue-link" data-issue-key="SOLR-8507"&gt;&lt;del&gt;SOLR-8507&lt;/del&gt;&lt;/a&gt; - This is more about user experience with DBVisualizer. After connecting, DBVisualizer displays this info to the user. There is an error/warning if this info is not available so hurts user experience.&lt;/li&gt;
	&lt;li&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8508" title="Implement DatabaseMetaDataImpl.getCatalogs()" class="issue-link" data-issue-key="SOLR-8508"&gt;&lt;del&gt;SOLR-8508&lt;/del&gt;&lt;/a&gt; / &lt;a href="https://issues.apache.org/jira/browse/SOLR-8510" title="Implement DatabaseMetaDataImpl.getSchemas()" class="issue-link" data-issue-key="SOLR-8510"&gt;&lt;del&gt;SOLR-8510&lt;/del&gt;&lt;/a&gt; - Both of these also seem to cause issues with DBVisualizer user experience. I haven't narrowed down what parts these are absolutely required for, but it would be nice to have them implemented to avoid the warnings that DBvisualizer shows.&lt;/li&gt;
	&lt;li&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8521" title="Add documentation for how to use Solr JDBC driver with SQL client like DB Visualizer" class="issue-link" data-issue-key="SOLR-8521"&gt;&lt;del&gt;SOLR-8521&lt;/del&gt;&lt;/a&gt; - Without documentation, using this would not be obvious. Maybe this ticket can be addressed after &lt;a href="https://issues.apache.org/jira/browse/SOLR-8502" title="Improve Solr JDBC Driver to support SQL Clients like DBVisualizer" class="issue-link" data-issue-key="SOLR-8502"&gt;&lt;del&gt;SOLR-8502&lt;/del&gt;&lt;/a&gt; is closed?&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15128752" author="joel.bernstein" created="Tue, 2 Feb 2016 11:36:39 -0700">&lt;p&gt;I think we can close out &lt;a href="https://issues.apache.org/jira/browse/SOLR-8502" title="Improve Solr JDBC Driver to support SQL Clients like DBVisualizer" class="issue-link" data-issue-key="SOLR-8502"&gt;&lt;del&gt;SOLR-8502&lt;/del&gt;&lt;/a&gt; before finishing &lt;a href="https://issues.apache.org/jira/browse/SOLR-8521" title="Add documentation for how to use Solr JDBC driver with SQL client like DB Visualizer" class="issue-link" data-issue-key="SOLR-8521"&gt;&lt;del&gt;SOLR-8521&lt;/del&gt;&lt;/a&gt;. I think we should add a short page of documentation specifically for the JDBC Driver and we can include a section about connecting with DBVisualizer.&lt;/p&gt;</comment>
                            <comment id="15128968" author="risdenk" created="Tue, 2 Feb 2016 13:31:21 -0700">&lt;p&gt;Including: &lt;a href="https://issues.apache.org/jira/browse/SOLR-8508" title="Implement DatabaseMetaDataImpl.getCatalogs()" class="issue-link" data-issue-key="SOLR-8508"&gt;&lt;del&gt;SOLR-8508&lt;/del&gt;&lt;/a&gt;, &lt;a href="https://issues.apache.org/jira/browse/SOLR-8510" title="Implement DatabaseMetaDataImpl.getSchemas()" class="issue-link" data-issue-key="SOLR-8510"&gt;&lt;del&gt;SOLR-8510&lt;/del&gt;&lt;/a&gt;, &lt;a href="https://issues.apache.org/jira/browse/SOLR-8631" title="Throw UnsupportedOperationException for DatabaseMetaDataImpl.getTypeInfo()" class="issue-link" data-issue-key="SOLR-8631"&gt;&lt;del&gt;SOLR-8631&lt;/del&gt;&lt;/a&gt;, and &lt;a href="https://issues.apache.org/jira/browse/SOLR-8507" title="Add information about database product name, product version, driver name, and driver version." class="issue-link" data-issue-key="SOLR-8507"&gt;&lt;del&gt;SOLR-8507&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;DBVisualizer with screenshot-4.png&lt;/p&gt;

&lt;p&gt;JiSQL&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
java -cp /opt/jisql/lib/jisql-2.0.11.jar:/opt/jisql/lib/jopt-simple-3.2.jar:/opt/solr/dist/solrj-lib/*:/opt/solr/dist/solr-solrj-6.0.0-SNAPSHOT.jar com.xigole.util.sql.Jisql -user test -password test -driver org.apache.solr.client.solrj.io.sql.DriverImpl -cstring 'jdbc:solr:&lt;span class="code-comment"&gt;//docker.vm:9983?collection=test&amp;amp;aggregationMode=map_reduce' -c \; -query 'select fielda, fieldb, fieldc, fieldd_s, fielde_i from test limit 10;'
&lt;/span&gt;
SLF4J: Failed to load class &lt;span class="code-quote"&gt;"org.slf4j.impl.StaticLoggerBinder"&lt;/span&gt;.
SLF4J: Defaulting to no-operation (NOP) logger implementation
SLF4J: See http:&lt;span class="code-comment"&gt;//www.slf4j.org/codes.html#StaticLoggerBinder &lt;span class="code-keyword"&gt;for&lt;/span&gt; further details.
&lt;/span&gt;SLF4J: Failed to load class &lt;span class="code-quote"&gt;"org.slf4j.impl.StaticMDCBinder"&lt;/span&gt;.
SLF4J: Defaulting to no-operation MDCAdapter implementation.
SLF4J: See http:&lt;span class="code-comment"&gt;//www.slf4j.org/codes.html#no_static_mdc_binder &lt;span class="code-keyword"&gt;for&lt;/span&gt; further details.
&lt;/span&gt;fielda | fieldb | fieldc | fieldd_s | fielde_i |
-------+--------+--------+----------+----------|
    a1 |     b1 |      1 |       d1 |        1 |
    a2 |     b2 |      2 |       d1 |        2 |
    a1 |     b3 |      3 |     NULL |        1 |
    a1 |     b4 |      4 |       d2 |     NULL |
    a2 |     b2 |   NULL |       d2 |        2 |
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15129050" author="joel.bernstein" created="Tue, 2 Feb 2016 14:19:03 -0700">&lt;p&gt;The screen shot looks good! &lt;/p&gt;

&lt;p&gt;I'll play around some with DbVisualizer in the next couple of days and commit &lt;a href="https://issues.apache.org/jira/browse/SOLR-8507" title="Add information about database product name, product version, driver name, and driver version." class="issue-link" data-issue-key="SOLR-8507"&gt;&lt;del&gt;SOLR-8507&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15129740" author="joel.bernstein" created="Tue, 2 Feb 2016 20:53:22 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=risdenk" class="user-hover" rel="risdenk"&gt;Kevin Risden&lt;/a&gt;, working on connecting with DbVisualizer but am currently stuck with following error:&lt;/p&gt;

&lt;p&gt;java.util.concurrent.TimeoutException: Could not connect to ZooKeeper localhost:9983 within 10000 ms&lt;/p&gt;

&lt;p&gt;I can make a JDBC connection using a command line client to that address though.&lt;/p&gt;

&lt;p&gt;Did you run into an issue like this?&lt;/p&gt;</comment>
                            <comment id="15130635" author="risdenk" created="Wed, 3 Feb 2016 09:24:34 -0700">&lt;p&gt;What does your connection string look like? Did you add all the jars from solrj-lib and the solrj jar to the user classpath when creating the Solr driver in DBVisualizer?&lt;/p&gt;</comment>
                            <comment id="15130639" author="risdenk" created="Wed, 3 Feb 2016 09:27:21 -0700">&lt;p&gt;As a side note, in DBVisualizer in the top menu there is a Tools dropdown that has "Debug Window...". If you open the Debug Window and under the Debug Log tab you can check both Debug DbVisualizer and Debug JDBC Drivers. That window will show low level errors and exceptions. The only error you should get is UnsupportedOperationException when getTypeInfo is called if you have &lt;a href="https://issues.apache.org/jira/browse/SOLR-8507" title="Add information about database product name, product version, driver name, and driver version." class="issue-link" data-issue-key="SOLR-8507"&gt;&lt;del&gt;SOLR-8507&lt;/del&gt;&lt;/a&gt; added.&lt;/p&gt;</comment>
                            <comment id="15130826" author="joel.bernstein" created="Wed, 3 Feb 2016 11:32:33 -0700">&lt;p&gt;I attached a couple of screen shots of the driver setup and connection window.&lt;/p&gt;</comment>
                            <comment id="15130837" author="joel.bernstein" created="Wed, 3 Feb 2016 11:36:05 -0700">&lt;p&gt;Here is the debug error:&lt;/p&gt;

&lt;p&gt;2016-02-03 08:52:38.855 INFO   955 &lt;span class="error"&gt;&amp;#91;ExecutorRunner-pool-3-thread-11 - G.&amp;#93;&lt;/span&gt; Exception while connecting Database Connection (1) (2)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;
	&lt;ul&gt;
		&lt;li&gt;
		&lt;ul&gt;
			&lt;li&gt;Database Properties ****************************&lt;br/&gt;
Alias: Database Connection (1) (2)&lt;br/&gt;
Settings Format: URL&lt;br/&gt;
URL: jdbc:solr://localhost:9983?collection=collection2&lt;br/&gt;
Driver: solr&lt;br/&gt;
Userid: &lt;br/&gt;
Preferred Database Type: auto&lt;br/&gt;
Current Database Type: generic&lt;br/&gt;
Preferred Profile: auto&lt;br/&gt;
Current Profile: null (not connected?)&lt;/li&gt;
		&lt;/ul&gt;
		&lt;ul class="alternate" type="square"&gt;
			&lt;li&gt;Object Type Settings ---------------------------&lt;br/&gt;
None&lt;/li&gt;
			&lt;li&gt;Overridden User Properties ---------------------&lt;br/&gt;
generic.AutoCommit = false&lt;br/&gt;
generic.ConnectionMode = Production&lt;/li&gt;
			&lt;li&gt;Overridden Driver Properties -------------------&lt;br/&gt;
None&lt;/li&gt;
		&lt;/ul&gt;
		&lt;ul&gt;
			&lt;li&gt;End Database Properties ************************&lt;/li&gt;
			&lt;li&gt;Driver Information *****************************&lt;br/&gt;
Name: solr&lt;br/&gt;
DefaultDriver: false&lt;br/&gt;
DefaultClass: org.apache.solr.client.solrj.io.sql.DriverImpl&lt;br/&gt;
Paths:&lt;br/&gt;
  Path: /Users/joelbernstein/solr-git/lucene-solr/solr/dist/solr-solrj-6.0.0-SNAPSHOT.jar&lt;br/&gt;
    Type: dynamic&lt;br/&gt;
    Class: org.apache.solr.client.solrj.io.sql.DriverImpl&lt;br/&gt;
  Path: /Users/joelbernstein/solr-git/lucene-solr/solr/dist/solrj-lib/commons-io-2.4.jar&lt;br/&gt;
    Type: dynamic&lt;br/&gt;
  Path: /Users/joelbernstein/solr-git/lucene-solr/solr/dist/solrj-lib/httpclient-4.4.1.jar&lt;br/&gt;
    Type: dynamic&lt;br/&gt;
  Path: /Users/joelbernstein/solr-git/lucene-solr/solr/dist/solrj-lib/httpcore-4.4.1.jar&lt;br/&gt;
    Type: dynamic&lt;br/&gt;
  Path: /Users/joelbernstein/solr-git/lucene-solr/solr/dist/solrj-lib/httpmime-4.4.1.jar&lt;br/&gt;
    Type: dynamic&lt;br/&gt;
  Path: /Users/joelbernstein/solr-git/lucene-solr/solr/dist/solrj-lib/jcl-over-slf4j-1.7.7.jar&lt;br/&gt;
    Type: dynamic&lt;br/&gt;
  Path: /Users/joelbernstein/solr-git/lucene-solr/solr/dist/solrj-lib/noggit-0.6.jar&lt;br/&gt;
    Type: dynamic&lt;br/&gt;
  Path: /Users/joelbernstein/solr-git/lucene-solr/solr/dist/solrj-lib/slf4j-api-1.7.7.jar&lt;br/&gt;
    Type: dynamic&lt;br/&gt;
  Path: /Users/joelbernstein/solr-git/lucene-solr/solr/dist/solrj-lib/stax2-api-3.1.4.jar&lt;br/&gt;
    Type: dynamic&lt;br/&gt;
  Path: /Users/joelbernstein/solr-git/lucene-solr/solr/dist/solrj-lib/woodstox-core-asl-4.4.1.jar&lt;br/&gt;
    Type: dynamic&lt;br/&gt;
  Path: /Users/joelbernstein/solr-git/lucene-solr/solr/dist/solrj-lib/zookeeper-3.4.6.jar&lt;br/&gt;
    Type: dynamic&lt;/li&gt;
			&lt;li&gt;End Driver Information *************************&lt;/li&gt;
			&lt;li&gt;Current Connection Message *********************&lt;br/&gt;
Disconnected.&lt;/li&gt;
			&lt;li&gt;End Current Connection Message *****************&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;2016-02-03 08:52:38.857 INFO   955 &lt;span class="error"&gt;&amp;#91;ExecutorRunner-pool-3-thread-11 - G.&amp;#93;&lt;/span&gt; Exception while connecting Database Connection (1) (2)&lt;br/&gt;
org.apache.solr.common.SolrException: java.util.concurrent.TimeoutException: Could not connect to ZooKeeper localhost:9983 within 10000 ms&lt;br/&gt;
	at org.apache.solr.common.cloud.SolrZkClient.&amp;lt;init&amp;gt;(SolrZkClient.java:182)&lt;br/&gt;
	at org.apache.solr.common.cloud.SolrZkClient.&amp;lt;init&amp;gt;(SolrZkClient.java:116)&lt;br/&gt;
	at org.apache.solr.common.cloud.SolrZkClient.&amp;lt;init&amp;gt;(SolrZkClient.java:106)&lt;br/&gt;
	at org.apache.solr.common.cloud.ZkStateReader.&amp;lt;init&amp;gt;(ZkStateReader.java:202)&lt;br/&gt;
	at org.apache.solr.client.solrj.impl.CloudSolrClient.connect(CloudSolrClient.java:467)&lt;br/&gt;
	at org.apache.solr.client.solrj.io.SolrClientCache.getCloudSolrClient(SolrClientCache.java:49)&lt;br/&gt;
	at org.apache.solr.client.solrj.io.sql.ConnectionImpl.&amp;lt;init&amp;gt;(ConnectionImpl.java:56)&lt;br/&gt;
	at org.apache.solr.client.solrj.io.sql.DriverImpl.connect(DriverImpl.java:75)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:497)&lt;br/&gt;
	at com.onseven.dbvis.h.B.D.(Z:1548)&lt;br/&gt;
	at com.onseven.dbvis.h.B.F$A.call(Z:1369)&lt;br/&gt;
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:745)&lt;br/&gt;
Caused by: java.util.concurrent.TimeoutException: Could not connect to ZooKeeper localhost:9983 within 10000 ms&lt;br/&gt;
	at org.apache.solr.common.cloud.ConnectionManager.waitForConnected(ConnectionManager.java:209)&lt;br/&gt;
	at org.apache.solr.common.cloud.SolrZkClient.&amp;lt;init&amp;gt;(SolrZkClient.java:174)&lt;br/&gt;
	... 17 more&lt;/p&gt;</comment>
                            <comment id="15130843" author="joel.bernstein" created="Wed, 3 Feb 2016 11:39:18 -0700">&lt;p&gt;This works fine from a command line java program:&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;

Connection con = DriverManager.getConnection(&lt;span class="code-quote"&gt;"jdbc:solr:&lt;span class="code-comment"&gt;//localhost:9983?collection=collection2"&lt;/span&gt;);
&lt;/span&gt; con.close();
 &lt;span class="code-object"&gt;System&lt;/span&gt;.out.println(&lt;span class="code-quote"&gt;"Done"&lt;/span&gt;);

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15131117" author="risdenk" created="Wed, 3 Feb 2016 14:01:59 -0700">&lt;p&gt;hmmmmm not sure why this is happening... I can try to reproduce later tonight. That error is straight from the Solr code and not from DBVisualizer.&lt;/p&gt;</comment>
                            <comment id="15131280" author="risdenk" created="Wed, 3 Feb 2016 15:34:26 -0700">&lt;p&gt;I downloaded the latest nightly build from &lt;a href="https://builds.apache.org/job/Solr-Artifacts-trunk/lastSuccessfulBuild/artifact/solr/package/" class="external-link" rel="nofollow"&gt;https://builds.apache.org/job/Solr-Artifacts-trunk/lastSuccessfulBuild/artifact/solr/package/&lt;/a&gt;, extracted the tgz, ran ./bin/solr start -c -f, and connected with DBVisualizer no problem. I didn't have an issue trying to connect to Zookeeper. How did you run Solr?&lt;/p&gt;</comment>
                            <comment id="15131296" author="joel.bernstein" created="Wed, 3 Feb 2016 15:45:51 -0700">&lt;p&gt;It's running SolrCloud with an embedded ZK. Since I can connect with a command line client I've ruled out Solr being the issue. I suspect there is something off about my DbVisualizer setup. I'll will give it another try in the next couple of days. &lt;/p&gt;

&lt;p&gt;Can you post a screenshot similar to the driver-setup screenshot attached to the ticket? I'll compare my local setup to your working screenshot.&lt;/p&gt;</comment>
                            <comment id="15131316" author="risdenk" created="Wed, 3 Feb 2016 15:56:25 -0700">&lt;p&gt;I've been meaning to put together a "getting started" guide. I'll use this as a chance to start one with some screenshots. &lt;/p&gt;</comment>
                            <comment id="15131440" author="risdenk" created="Wed, 3 Feb 2016 17:28:53 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=joel.bernstein" class="user-hover" rel="joel.bernstein"&gt;Joel Bernstein&lt;/a&gt; - I put together a step-by-step guide with screenshots to get DBVisualizer setup with Solr. It is attached to &lt;a href="https://issues.apache.org/jira/browse/SOLR-8521" title="Add documentation for how to use Solr JDBC driver with SQL client like DB Visualizer" class="issue-link" data-issue-key="SOLR-8521"&gt;&lt;del&gt;SOLR-8521&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15135959" author="joel.bernstein" created="Sat, 6 Feb 2016 12:25:39 -0700">&lt;p&gt;Attaching a screenshot with a working connection. All I did was restart DbVisualizer and the connection started working. &lt;/p&gt;

&lt;p&gt;I'll move on committing the remaining open tickets. I'll also create a new ticket to implement setMaxRows() on the Statement. This is the only error I see in the debug window and it will be extremely useful in ensuring users don't select entire result sets. The implementation will simply tack on a limit clause to the end of the SQL statement if it doesn't exist.&lt;/p&gt;

&lt;p&gt;After this work is done I'll close out this ticket and add &lt;a href="https://issues.apache.org/jira/browse/SOLR-8502" title="Improve Solr JDBC Driver to support SQL Clients like DBVisualizer" class="issue-link" data-issue-key="SOLR-8502"&gt;&lt;del&gt;SOLR-8502&lt;/del&gt;&lt;/a&gt; to CHANGES.txt for 6.0.&lt;/p&gt;</comment>
                            <comment id="15136067" author="joel.bernstein" created="Sat, 6 Feb 2016 17:04:11 -0700">&lt;p&gt;Added a screenshot of an aggregation query with aliases.&lt;/p&gt;</comment>
                            <comment id="15136108" author="jira-bot" created="Sat, 6 Feb 2016 19:45:22 -0700">&lt;p&gt;Commit c2eb76941eb604f6cdf7873cab9ea02175c69000 in lucene-solr's branch refs/heads/master from jbernste&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c2eb769" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c2eb769&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8502" title="Improve Solr JDBC Driver to support SQL Clients like DBVisualizer" class="issue-link" data-issue-key="SOLR-8502"&gt;&lt;del&gt;SOLR-8502&lt;/del&gt;&lt;/a&gt;: Improve Solr JDBC Driver to support SQL Clients like DBVisualizer&lt;/p&gt;</comment>
                            <comment id="15136109" author="joel.bernstein" created="Sat, 6 Feb 2016 19:47:10 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=risdenk" class="user-hover" rel="risdenk"&gt;Kevin Risden&lt;/a&gt;, great work on this ticket. This is a great feature for Solr 6.&lt;/p&gt;</comment>
                            <comment id="15136396" author="jira-bot" created="Sun, 7 Feb 2016 12:45:40 -0700">&lt;p&gt;Commit c2eb76941eb604f6cdf7873cab9ea02175c69000 in lucene-solr's branch refs/heads/jira/lucene-5438-nrt-replication from jbernste&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c2eb769" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c2eb769&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8502" title="Improve Solr JDBC Driver to support SQL Clients like DBVisualizer" class="issue-link" data-issue-key="SOLR-8502"&gt;&lt;del&gt;SOLR-8502&lt;/del&gt;&lt;/a&gt;: Improve Solr JDBC Driver to support SQL Clients like DBVisualizer&lt;/p&gt;</comment>
                            <comment id="15137730" author="risdenk" created="Mon, 8 Feb 2016 14:29:34 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=joel.bernstein" class="user-hover" rel="joel.bernstein"&gt;Joel Bernstein&lt;/a&gt; - Thanks for the quick reviews and getting these changes merged.&lt;/p&gt;

&lt;p&gt;There are some more improvements that can be made. Clicking around some of the areas in DBVisualizer can cause errors to pop up here and there. I found that more methods need to be implemented for SquirrelSQL to work. I'll create a new JIRA with subtasks to address these since this seemed to work well so far.&lt;/p&gt;</comment>
                            <comment id="15137759" author="risdenk" created="Mon, 8 Feb 2016 14:44:45 -0700">&lt;p&gt;Added &lt;a href="https://issues.apache.org/jira/browse/SOLR-8659" title="Improve Solr JDBC Driver to support more SQL Clients" class="issue-link" data-issue-key="SOLR-8659"&gt;SOLR-8659&lt;/a&gt; with some notes on what can continue to be improved.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12902422">SOLR-8125</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12859787">SOLR-7986</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12933820">SOLR-8593</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12939066">SOLR-8680</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12937649">SOLR-8659</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12946729">SOLR-8786</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310051">
                    <name>Supercedes</name>
                                            <outwardlinks description="supercedes">
                                        <issuelink>
            <issuekey id="12902992">SOLR-8138</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12786691" name="aggregation-query.png" size="1013296" author="joel.bernstein" created="Sat, 6 Feb 2016 17:04:11 -0700"/>
                            <attachment id="12786064" name="connection-screen-shot.png" size="1198095" author="joel.bernstein" created="Wed, 3 Feb 2016 11:31:48 -0700"/>
                            <attachment id="12786685" name="connection-working!.png" size="807830" author="joel.bernstein" created="Sat, 6 Feb 2016 12:25:39 -0700"/>
                            <attachment id="12786065" name="driver-setup.png" size="1284504" author="joel.bernstein" created="Wed, 3 Feb 2016 11:31:48 -0700"/>
                            <attachment id="12784416" name="screenshot-1.png" size="1509349" author="risdenk" created="Tue, 26 Jan 2016 07:37:03 -0700"/>
                            <attachment id="12784485" name="screenshot-2.png" size="1491499" author="risdenk" created="Tue, 26 Jan 2016 12:54:21 -0700"/>
                            <attachment id="12784787" name="screenshot-3.png" size="1516375" author="risdenk" created="Wed, 27 Jan 2016 17:35:01 -0700"/>
                            <attachment id="12785851" name="screenshot-4.png" size="1528635" author="risdenk" created="Tue, 2 Feb 2016 13:28:51 -0700"/>
                    </attachments>
                <subtasks>
                            <subtask id="12928405">SOLR-8503</subtask>
                            <subtask id="12928416">SOLR-8506</subtask>
                            <subtask id="12928417">SOLR-8507</subtask>
                            <subtask id="12928418">SOLR-8508</subtask>
                            <subtask id="12928428">SOLR-8509</subtask>
                            <subtask id="12928429">SOLR-8510</subtask>
                            <subtask id="12928430">SOLR-8511</subtask>
                            <subtask id="12928434">SOLR-8512</subtask>
                            <subtask id="12928435">SOLR-8513</subtask>
                            <subtask id="12928436">SOLR-8514</subtask>
                            <subtask id="12928437">SOLR-8515</subtask>
                            <subtask id="12928438">SOLR-8516</subtask>
                            <subtask id="12928439">SOLR-8517</subtask>
                            <subtask id="12928443">SOLR-8518</subtask>
                            <subtask id="12928445">SOLR-8519</subtask>
                            <subtask id="12928446">SOLR-8520</subtask>
                            <subtask id="12932761">SOLR-8573</subtask>
                            <subtask id="12932763">SOLR-8574</subtask>
                            <subtask id="12934475">SOLR-8602</subtask>
                            <subtask id="12934476">SOLR-8603</subtask>
                            <subtask id="12935834">SOLR-8631</subtask>
                            <subtask id="12936521">SOLR-8638</subtask>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 7 Jan 2016 19:25:58 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2qzyv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8466] Add support for UnInvertedField based faceting to FacetComponent</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8466</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;The new JSON Faceting API supports building an UnInvertedField to do faceting which would be beneficial to add to Solr FacetComponent.  This would provide additional options to implementors to choose the appropriate method of faceting for their particular use case.&lt;/p&gt;

&lt;h3&gt;&lt;a name="Summary"&gt;&lt;/a&gt;Summary&lt;/h3&gt;
&lt;p&gt;added facet.method=uif which invokes UnInvertedField (top level data structure). facet.prefix and facet.contains are not supported.  &lt;/p&gt;</description>
                <environment/>
        <key id="12924384">SOLR-8466</key>
            <summary>Add support for UnInvertedField based faceting to FacetComponent</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mkhludnev">Mikhail Khludnev</assignee>
                                    <reporter username="jej2003">Jamie Johnson</reporter>
                        <labels>
                    </labels>
                <created>Sat, 26 Dec 2015 20:32:21 -0700</created>
                <updated>Tue, 23 Feb 2016 03:40:00 -0700</updated>
                            <resolved>Wed, 10 Feb 2016 01:08:54 -0700</resolved>
                                    <version>5.0</version>
                    <version>5.1</version>
                    <version>5.2</version>
                    <version>5.2.1</version>
                    <version>5.3</version>
                    <version>5.3.1</version>
                    <version>5.4</version>
                                    <fixVersion>5.5</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>Facet Module</component>
                    <component>faceting</component>
                        <due/>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                <comments>
                            <comment id="15072031" author="jej2003" created="Sat, 26 Dec 2015 20:57:49 -0700">&lt;p&gt;Initial implementation to add support for UnInvertedField based faceting to FacetComponent&lt;/p&gt;</comment>
                            <comment id="15080530" author="billnbell" created="Sun, 3 Jan 2016 14:15:18 -0700">&lt;p&gt;This looks good, it appears to add facet.method=uif which it the way it was before.&lt;/p&gt;

&lt;p&gt;Are we ready to commit?&lt;/p&gt;
</comment>
                            <comment id="15080581" author="jej2003" created="Sun, 3 Jan 2016 16:42:01 -0700">&lt;p&gt;Correct, the patch adds facet.method=uif but I'd really like someone who is familiar with the JSON Faceting API to give this a go and make sure things look right.  &lt;/p&gt;</comment>
                            <comment id="15112930" author="mkhludnev" created="Fri, 22 Jan 2016 12:31:07 -0700">&lt;p&gt;Reviewing patch: SimpleFacets changes make sense, there is an test coverage (I suppose it's effective), but also there are many unnecessary changes like file moves. &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jej2003" class="user-hover" rel="jej2003"&gt;Jamie Johnson&lt;/a&gt; are you sure they can't be stripped off the patch? Also, pls name with jira ticket in according to tradition.     &lt;/p&gt;</comment>
                            <comment id="15113485" author="jej2003" created="Fri, 22 Jan 2016 19:27:01 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mkhludnev" class="user-hover" rel="mkhludnev"&gt;Mikhail Khludnev&lt;/a&gt;, I'm assuming you're referring to splitting out the FacetContext, FacetParser, FacetTopParser, FacetQueryParser, FacetFieldParser and FacetRangeParser?  If so FacetContext, FacetParser, FacetTopParser all are used by SimpleFacets.  It felt a little strange to leave the others (FacetQueryParser, FacetFieldParser and FacetRangeParser) as protected within FacetRequest after moving the others out but I could move them back if that makes more sense.  &lt;/p&gt;</comment>
                            <comment id="15113486" author="jej2003" created="Fri, 22 Jan 2016 19:27:24 -0700">&lt;p&gt;updated patch name&lt;/p&gt;</comment>
                            <comment id="15114241" author="mkhludnev" created="Sun, 24 Jan 2016 01:16:11 -0700">&lt;p&gt;ok. Attaching &lt;span class="nobr"&gt;&lt;a href="https://issues.apache.org/jira/secure/attachment/12786885/12786885_SOLR-8466.patch" title="SOLR-8466.patch attached to SOLR-8466"&gt;SOLR-8466.patch&lt;sup&gt;&lt;img class="rendericon" src="https://issues.apache.org/jira/images/icons/link_attachment_7.gif" height="7" width="7" align="absmiddle" alt="" border="0"/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;. I understood an encapsulation challenge. Instead of ripping json facet framework I introduce factory method &lt;tt&gt;o.a.s.s.facet.FacetProcessor.createProcessor(SolrQueryRequest, Map&amp;lt;String, Object&amp;gt;, DocSet)&lt;/tt&gt; that minimizes impact on codebase. &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yseeley%40gmail.com" class="user-hover" rel="yseeley@gmail.com"&gt;Yonik Seeley&lt;/a&gt; what's your perception about it? &lt;br/&gt;
I also removed exclude-aware docset calculation, because it's already handled at  &lt;tt&gt;..SimpleFacets.parseParams(String, String)&lt;/tt&gt;. So, far it lacks of test coverage for distributed faceting and fq exclusion. &lt;/p&gt;

&lt;p&gt;Opinions?  &lt;/p&gt;</comment>
                            <comment id="15114311" author="jej2003" created="Sun, 24 Jan 2016 06:26:00 -0700">&lt;p&gt;I like the approach as it's much less invasive.  In regards to testing isn't this just a matter of piggy backing on the existing distributed faceting/exclusion tests to add uif as a method?  I'm assuming those already exist?&lt;/p&gt;</comment>
                            <comment id="15131980" author="mkhludnev" created="Thu, 4 Feb 2016 01:57:19 -0700">&lt;p&gt;Here is desired coverage, I'm still tweaking cases in SimpleFacetsTest.java. work in progress..  &lt;/p&gt;</comment>
                            <comment id="15135178" author="yseeley@gmail.com" created="Fri, 5 Feb 2016 15:38:41 -0700">&lt;p&gt;+1, this approach looks fine.&lt;/p&gt;</comment>
                            <comment id="15136042" author="mkhludnev" created="Sat, 6 Feb 2016 15:45:45 -0700">&lt;p&gt;while thoroughly testing the &lt;span class="nobr"&gt;&lt;a href="https://issues.apache.org/jira/secure/attachment/12786885/12786885_SOLR-8466.patch" title="SOLR-8466.patch attached to SOLR-8466"&gt;SOLR-8466.patch&lt;sup&gt;&lt;img class="rendericon" src="https://issues.apache.org/jira/images/icons/link_attachment_7.gif" height="7" width="7" align="absmiddle" alt="" border="0"/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; I've found something &lt;a href="https://github.com/apache/lucene-solr/blob/master/solr/core/src/java/org/apache/solr/search/facet/FacetModule.java#L113" class="external-link" rel="nofollow"&gt;interesting&lt;/a&gt;. &lt;br/&gt;
&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jej2003" class="user-hover" rel="jej2003"&gt;Jamie Johnson&lt;/a&gt;, can't you get the same performance boost if you just specify &lt;tt&gt;facet.version=2&lt;/tt&gt; in addition to old-style Solr facet parameters?&lt;br/&gt;
&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yseeley%40gmail.com" class="user-hover" rel="yseeley@gmail.com"&gt;Yonik Seeley&lt;/a&gt; wdyt?   &lt;br/&gt;
Note: current patch incorrectly handles facet.sort=true/false but this finding makes all these redundant. &lt;/p&gt;</comment>
                            <comment id="15136174" author="mkhludnev" created="Sun, 7 Feb 2016 01:00:12 -0700">&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;Ok. I looked on it once again. if &lt;tt&gt;facet.version=2&lt;/tt&gt; is specified, it adds one more response elements from JSON facets. Thus, workaround shortens:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;to get old good UnInvertedField perfomance you don't need to change parameters to JSON, but just specify &lt;tt&gt;facet.version=2&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;and remove &lt;tt&gt;FacetComponent&lt;/tt&gt; from handler's components, leaving &lt;tt&gt;FacetModule&lt;/tt&gt; there.&lt;/li&gt;
	&lt;li&gt;However, response format is different and an app should be changed to consume one that makes the issue still sensible&lt;/li&gt;
&lt;/ol&gt;


&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
facet_counts={facet_queries={},facet_fields={key1={foo=1},key2={bar=1}},facet_dates={},facet_ranges={},facet_intervals={},facet_heatmaps={}},
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;vs&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
facets={count=2,key1={buckets=[{val=foo,count=1}]},key2={buckets=[{val=bar,count=1}]}}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15136385" author="mkhludnev" created="Sun, 7 Feb 2016 12:14:35 -0700">&lt;p&gt;work in progress.. fixed legacy sorting handling. Remaining issue is empty facets on certain trie field.  &lt;/p&gt;</comment>
                            <comment id="15136424" author="mkhludnev" created="Sun, 7 Feb 2016 13:34:51 -0700">&lt;p&gt;It seems like wasting a plenty of time on miserable thing.. &lt;br/&gt;
Here is the fix for testTrieFields failure. In fact it failed on empty result. I just enabling handling empty values..&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
            &lt;span class="code-keyword"&gt;if&lt;/span&gt;(mincount==0){
              topLevel.put(&lt;span class="code-quote"&gt;"processEmpty"&lt;/span&gt;, &lt;span class="code-keyword"&gt;true&lt;/span&gt;);
            }
...
..
              &lt;span class="code-comment"&gt;//&lt;span class="code-keyword"&gt;if&lt;/span&gt;((&lt;span class="code-object"&gt;Integer&lt;/span&gt;)som.get(&lt;span class="code-quote"&gt;"count"&lt;/span&gt;) &amp;gt; 0) {
&lt;/span&gt;                SimpleOrderedMap&amp;lt;&lt;span class="code-object"&gt;Object&lt;/span&gt;&amp;gt; asdf = (SimpleOrderedMap&amp;lt;&lt;span class="code-object"&gt;Object&lt;/span&gt;&amp;gt;) som.get(field);

                List&amp;lt;SimpleOrderedMap&amp;lt;&lt;span class="code-object"&gt;Object&lt;/span&gt;&amp;gt;&amp;gt; buckets = (List&amp;lt;SimpleOrderedMap&amp;lt;&lt;span class="code-object"&gt;Object&lt;/span&gt;&amp;gt;&amp;gt;)asdf.get(&lt;span class="code-quote"&gt;"buckets"&lt;/span&gt;);
                &lt;span class="code-keyword"&gt;for&lt;/span&gt;(SimpleOrderedMap&amp;lt;&lt;span class="code-object"&gt;Object&lt;/span&gt;&amp;gt; b : buckets) {
                  counts.add(b.get(&lt;span class="code-quote"&gt;"val"&lt;/span&gt;).toString(), (&lt;span class="code-object"&gt;Integer&lt;/span&gt;)b.get(&lt;span class="code-quote"&gt;"count"&lt;/span&gt;));
                }
                &lt;span class="code-keyword"&gt;if&lt;/span&gt;(missing) {
                  SimpleOrderedMap&amp;lt;&lt;span class="code-object"&gt;Object&lt;/span&gt;&amp;gt; missingCounts = (SimpleOrderedMap&amp;lt;&lt;span class="code-object"&gt;Object&lt;/span&gt;&amp;gt;) asdf.get(&lt;span class="code-quote"&gt;"missing"&lt;/span&gt;);
                  counts.add(&lt;span class="code-keyword"&gt;null&lt;/span&gt;, (&lt;span class="code-object"&gt;Integer&lt;/span&gt;)missingCounts.get(&lt;span class="code-quote"&gt;"count"&lt;/span&gt;));
                }
             &lt;span class="code-comment"&gt;// } &lt;span class="code-keyword"&gt;else&lt;/span&gt; &lt;span class="code-keyword"&gt;if&lt;/span&gt;(missing) {
&lt;/span&gt;             &lt;span class="code-comment"&gt;//   counts.add(&lt;span class="code-keyword"&gt;null&lt;/span&gt;, 0);
&lt;/span&gt;             &lt;span class="code-comment"&gt;// }
&lt;/span&gt;
            }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15136459" author="mkhludnev" created="Sun, 7 Feb 2016 14:31:11 -0700">&lt;p&gt;Attaching &lt;span class="nobr"&gt;&lt;a href="https://issues.apache.org/jira/secure/attachment/12786885/12786885_SOLR-8466.patch" title="SOLR-8466.patch attached to SOLR-8466"&gt;SOLR-8466.patch&lt;sup&gt;&lt;img class="rendericon" src="https://issues.apache.org/jira/images/icons/link_attachment_7.gif" height="7" width="7" align="absmiddle" alt="" border="0"/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; it never bypass empty processing.&lt;br/&gt;
remaining failure is &lt;br/&gt;
&lt;tt&gt;TestFaceting.testSimpleFacetCountsWithMultipleConfigurationsForSameField()&lt;/tt&gt;&lt;br/&gt;
the failures is really weird. for&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
q=id:[42+TO+47]&amp;amp;facet.field={!key%3Dfoo+facet.prefix%3DToo+}trait_ss&amp;amp;facet.field={!key%3Dbar+facet.limit%3D2+facet.sort%3Dfalse+}trait_ss&amp;amp;facet.method=uif&amp;amp;fq=id:[42+TO+45]&amp;amp;facet=&lt;span class="code-keyword"&gt;true&lt;/span&gt;&amp;amp;facet.zeros=&lt;span class="code-keyword"&gt;false&lt;/span&gt;&amp;amp;wt=xml
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;result is &lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
&amp;lt;result name=&lt;span class="code-quote"&gt;"response"&lt;/span&gt; numFound=&lt;span class="code-quote"&gt;"4"&lt;/span&gt; start=&lt;span class="code-quote"&gt;"0"&lt;/span&gt;&amp;gt;&amp;lt;doc&amp;gt;&amp;lt;&lt;span class="code-object"&gt;float&lt;/span&gt; name=&lt;span class="code-quote"&gt;"id"&lt;/span&gt;&amp;gt;42.0&amp;lt;/&lt;span class="code-object"&gt;float&lt;/span&gt;&amp;gt;&amp;lt;arr name=&lt;span class="code-quote"&gt;"trait_ss"&lt;/span&gt;&amp;gt;&amp;lt;str&amp;gt;Tool&amp;lt;/str&amp;gt;&amp;lt;str&amp;gt;Obnoxious&amp;lt;/str&amp;gt;&amp;lt;/arr&amp;gt;&amp;lt;str name=&lt;span class="code-quote"&gt;"name_s"&lt;/span&gt;&amp;gt;Zapp Brannigan&amp;lt;/str&amp;gt;&amp;lt;&lt;span class="code-object"&gt;long&lt;/span&gt; name=&lt;span class="code-quote"&gt;"_version_"&lt;/span&gt;&amp;gt;1525551790847688704&amp;lt;/&lt;span class="code-object"&gt;long&lt;/span&gt;&amp;gt;&amp;lt;/doc&amp;gt;&amp;lt;doc&amp;gt;&amp;lt;&lt;span class="code-object"&gt;float&lt;/span&gt; name=&lt;span class="code-quote"&gt;"id"&lt;/span&gt;&amp;gt;43.0&amp;lt;/&lt;span class="code-object"&gt;float&lt;/span&gt;&amp;gt;&amp;lt;str name=&lt;span class="code-quote"&gt;"title_s"&lt;/span&gt;&amp;gt;Democratic Order of Planets&amp;lt;/str&amp;gt;&amp;lt;&lt;span class="code-object"&gt;long&lt;/span&gt; name=&lt;span class="code-quote"&gt;"_version_"&lt;/span&gt;&amp;gt;1525551790851883008&amp;lt;/&lt;span class="code-object"&gt;long&lt;/span&gt;&amp;gt;&amp;lt;/doc&amp;gt;&amp;lt;doc&amp;gt;&amp;lt;&lt;span class="code-object"&gt;float&lt;/span&gt; name=&lt;span class="code-quote"&gt;"id"&lt;/span&gt;&amp;gt;44.0&amp;lt;/&lt;span class="code-object"&gt;float&lt;/span&gt;&amp;gt;&amp;lt;arr name=&lt;span class="code-quote"&gt;"trait_ss"&lt;/span&gt;&amp;gt;&amp;lt;str&amp;gt;Tool&amp;lt;/str&amp;gt;&amp;lt;/arr&amp;gt;&amp;lt;str name=&lt;span class="code-quote"&gt;"name_s"&lt;/span&gt;&amp;gt;The Zapper&amp;lt;/str&amp;gt;&amp;lt;&lt;span class="code-object"&gt;long&lt;/span&gt; name=&lt;span class="code-quote"&gt;"_version_"&lt;/span&gt;&amp;gt;1525551790878097408&amp;lt;/&lt;span class="code-object"&gt;long&lt;/span&gt;&amp;gt;&amp;lt;/doc&amp;gt;&amp;lt;doc&amp;gt;&amp;lt;&lt;span class="code-object"&gt;float&lt;/span&gt; name=&lt;span class="code-quote"&gt;"id"&lt;/span&gt;&amp;gt;45.0&amp;lt;/&lt;span class="code-object"&gt;float&lt;/span&gt;&amp;gt;&amp;lt;arr name=&lt;span class="code-quote"&gt;"trait_ss"&lt;/span&gt;&amp;gt;&amp;lt;str&amp;gt;Chauvinist&amp;lt;/str&amp;gt;&amp;lt;/arr&amp;gt;&amp;lt;str name=&lt;span class="code-quote"&gt;"title_s"&lt;/span&gt;&amp;gt;25 star General&amp;lt;/str&amp;gt;&amp;lt;&lt;span class="code-object"&gt;long&lt;/span&gt; name=&lt;span class="code-quote"&gt;"_version_"&lt;/span&gt;&amp;gt;1525551790881243136&amp;lt;/&lt;span class="code-object"&gt;long&lt;/span&gt;&amp;gt;&amp;lt;/doc&amp;gt;&amp;lt;/result&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;we definitely have &lt;tt&gt;Tool&lt;/tt&gt; twice but facet has only once! why??&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
&amp;lt;lst name=&lt;span class="code-quote"&gt;"facet_fields"&lt;/span&gt;&amp;gt;&amp;lt;lst name=&lt;span class="code-quote"&gt;"foo"&lt;/span&gt;&amp;gt;&amp;lt;&lt;span class="code-object"&gt;int&lt;/span&gt; name=&lt;span class="code-quote"&gt;"Tool"&lt;/span&gt;&amp;gt;1&amp;lt;/&lt;span class="code-object"&gt;int&lt;/span&gt;&amp;gt;&amp;lt;/lst&amp;gt;&amp;lt;lst name=&lt;span class="code-quote"&gt;"bar"&lt;/span&gt;&amp;gt;&amp;lt;&lt;span class="code-object"&gt;int&lt;/span&gt; name=&lt;span class="code-quote"&gt;"Chauvinist"&lt;/span&gt;&amp;gt;1&amp;lt;/&lt;span class="code-object"&gt;int&lt;/span&gt;&amp;gt;&amp;lt;&lt;span class="code-object"&gt;int&lt;/span&gt; name=&lt;span class="code-quote"&gt;"Obnoxious"&lt;/span&gt;&amp;gt;1&amp;lt;/&lt;span class="code-object"&gt;int&lt;/span&gt;&amp;gt;&amp;lt;/lst&amp;gt;&amp;lt;/lst&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;reasonably fails the assert &lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
&lt;span class="code-comment"&gt;//lst[@name='foo']/&lt;span class="code-object"&gt;int&lt;/span&gt;[@name='Tool'][.='2']&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;h2&gt;&lt;a name="Summary"&gt;&lt;/a&gt;Summary &lt;/h2&gt;
&lt;p&gt;It seems like a minor bug somewhere. If anyone from committer give his vote for it, I can extract these failures into ignored test, like it's done with &lt;tt&gt;SimpleFacetsTest.testFacetContainsUif()&lt;/tt&gt; in the patch, otherwise it seems like &lt;b&gt;no-commit&lt;/b&gt; for me.  &lt;/p&gt;</comment>
                            <comment id="15137597" author="mkhludnev" created="Mon, 8 Feb 2016 13:11:06 -0700">&lt;p&gt;aha... here are &lt;a href="https://github.com/apache/lucene-solr/blob/master/solr/core/src/java/org/apache/solr/search/facet/UnInvertedField.java#L448" class="external-link" rel="nofollow"&gt;TODO&lt;/a&gt;! the problem is omitting a multivalued occurrence when &lt;em&gt;prefix&lt;/em&gt; is provided. it's worse than with &lt;em&gt;contains&lt;/em&gt; which is just not supported. &lt;/p&gt;

&lt;p&gt;I'm going to throw error when &lt;em&gt;facet.prefix&lt;/em&gt; is requested along side with facet.mehod=uif &lt;/p&gt;</comment>
                            <comment id="15137641" author="dsmiley" created="Mon, 8 Feb 2016 13:39:34 -0700">&lt;p&gt;The loss of support for facet.prefix seems to be in &lt;a href="https://issues.apache.org/jira/browse/SOLR-7214" title="JSON Facet API" class="issue-link" data-issue-key="SOLR-7214"&gt;&lt;del&gt;SOLR-7214&lt;/del&gt;&lt;/a&gt; (JSON Facet API), May 16th 2015.&lt;/p&gt;</comment>
                            <comment id="15137651" author="yseeley@gmail.com" created="Mon, 8 Feb 2016 13:46:33 -0700">&lt;p&gt;Ummm, no... all use of UnInvertedField had been removed by &lt;a href="https://issues.apache.org/jira/browse/LUCENE-5666" title="Add UninvertingReader" class="issue-link" data-issue-key="LUCENE-5666"&gt;&lt;del&gt;LUCENE-5666&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;UnInvertedField in the facet package (i.e. the one that is part of the JSON Facet API) shares a common ancestry with the previous one, but it's different.&lt;br/&gt;
When I committed the JSON Facet API, I removed the other unused UnInvertedField (which was dead and non-working code at that point), and would have just caused more confusion.  There was already an issue open to remove that dead code.&lt;/p&gt;</comment>
                            <comment id="15137659" author="dsmiley" created="Mon, 8 Feb 2016 13:50:42 -0700">&lt;p&gt;Thanks for the clarification Yonik.  I see it's different; but nonetheless shares a ton in common.  It even seems to have the same class javadocs and same superclass.&lt;/p&gt;</comment>
                            <comment id="15137669" author="yseeley@gmail.com" created="Mon, 8 Feb 2016 13:55:46 -0700">&lt;p&gt;Like I say... common ancestry - it forked off from the original one.&lt;/p&gt;

&lt;p&gt;I don't remember details around the facet.prefix comment though... and facet prefixes do seem to work in the JSON Facet API (there are some prefix tests in TestJsonFacets)&lt;/p&gt;</comment>
                            <comment id="15137739" author="mkhludnev" created="Mon, 8 Feb 2016 14:35:08 -0700">&lt;p&gt;ok. Here is &lt;span class="nobr"&gt;&lt;a href="https://issues.apache.org/jira/secure/attachment/12786885/12786885_SOLR-8466.patch" title="SOLR-8466.patch attached to SOLR-8466"&gt;SOLR-8466.patch&lt;sup&gt;&lt;img class="rendericon" src="https://issues.apache.org/jira/images/icons/link_attachment_7.gif" height="7" width="7" align="absmiddle" alt="" border="0"/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; it prohibits prefix for uif, and tests ugly bypass this case. I'm going to commit it tomorrow, unless you stop me.   &lt;/p&gt;</comment>
                            <comment id="15139867" author="jira-bot" created="Tue, 9 Feb 2016 15:09:21 -0700">&lt;p&gt;Commit eac3bb9b32a45e5fc9faa54b372f89e25606a976 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mkhludnev" class="user-hover" rel="mkhludnev"&gt;Mikhail Khludnev&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=eac3bb9" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=eac3bb9&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8466" title="Add support for UnInvertedField based faceting to FacetComponent" class="issue-link" data-issue-key="SOLR-8466"&gt;&lt;del&gt;SOLR-8466&lt;/del&gt;&lt;/a&gt;: facet.method=uif for UnInvertedField faceting, like it was with 'fc' earlier.&lt;/p&gt;</comment>
                            <comment id="15139883" author="jira-bot" created="Tue, 9 Feb 2016 15:21:35 -0700">&lt;p&gt;Commit 93750292c258ca9361a9e3271fb2087be40557ec in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mkhludnev" class="user-hover" rel="mkhludnev"&gt;Mikhail Khludnev&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9375029" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9375029&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8466" title="Add support for UnInvertedField based faceting to FacetComponent" class="issue-link" data-issue-key="SOLR-8466"&gt;&lt;del&gt;SOLR-8466&lt;/del&gt;&lt;/a&gt;: fixing CHANGES.txt moving to 5.5.0 Features.&lt;/p&gt;</comment>
                            <comment id="15140010" author="jira-bot" created="Tue, 9 Feb 2016 16:37:52 -0700">&lt;p&gt;Commit c3cdb84dc60afb265441ca67714685e6bd16ca22 in lucene-solr's branch refs/heads/branch_5x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mkhludnev" class="user-hover" rel="mkhludnev"&gt;Mikhail Khludnev&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c3cdb84" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c3cdb84&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8466" title="Add support for UnInvertedField based faceting to FacetComponent" class="issue-link" data-issue-key="SOLR-8466"&gt;&lt;del&gt;SOLR-8466&lt;/del&gt;&lt;/a&gt;: facet.method=uif for UnInvertedField faceting, like it was with 'fc' earlier.&lt;/p&gt;</comment>
                            <comment id="15140019" author="mkhludnev" created="Tue, 9 Feb 2016 16:44:14 -0700">&lt;p&gt;committed in both. will check CI in a few hours. &lt;/p&gt;</comment>
                            <comment id="15140479" author="mkhludnev" created="Wed, 10 Feb 2016 01:08:54 -0700">&lt;p&gt;Thanks, &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jej2003" class="user-hover" rel="jej2003"&gt;Jamie Johnson&lt;/a&gt;!&lt;/p&gt;

&lt;p&gt;Colleagues, feedback is quite appreciated! Don't hesitate to check a nightly build!&lt;/p&gt;</comment>
                            <comment id="15140485" author="mkhludnev" created="Wed, 10 Feb 2016 01:12:55 -0700">&lt;p&gt;perhaps it's &lt;a href="https://issues.apache.org/jira/browse/SOLR-8155" title="json.facet - prefix parameter doesn&amp;#39;t work properly" class="issue-link" data-issue-key="SOLR-8155"&gt;&lt;del&gt;SOLR-8155&lt;/del&gt;&lt;/a&gt; ? &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                            <outwardlinks description="incorporates">
                                        <issuelink>
            <issuekey id="12896310">SOLR-8096</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12783973" name="8466.diff" size="52004" author="jej2003" created="Fri, 22 Jan 2016 19:27:24 -0700"/>
                            <attachment id="12786735" name="SOLR-8466-failure.txt" size="5717" author="mkhludnev" created="Sun, 7 Feb 2016 14:31:11 -0700"/>
                            <attachment id="12786885" name="SOLR-8466.patch" size="36488" author="mkhludnev" created="Mon, 8 Feb 2016 14:35:08 -0700"/>
                            <attachment id="12786734" name="SOLR-8466.patch" size="35974" author="mkhludnev" created="Sun, 7 Feb 2016 14:31:11 -0700"/>
                            <attachment id="12786730" name="SOLR-8466.patch" size="36541" author="mkhludnev" created="Sun, 7 Feb 2016 13:34:51 -0700"/>
                            <attachment id="12786728" name="SOLR-8466.patch" size="36437" author="mkhludnev" created="Sun, 7 Feb 2016 12:14:35 -0700"/>
                            <attachment id="12786690" name="SOLR-8466.patch" size="26584" author="mkhludnev" created="Sat, 6 Feb 2016 15:45:45 -0700"/>
                            <attachment id="12784052" name="SOLR-8466.patch" size="7930" author="mkhludnev" created="Sun, 24 Jan 2016 01:16:11 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 3 Jan 2016 21:15:18 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2qbkv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8461] CloudSolrStream and ParallelStream can choose replicas that are not active</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8461</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Currently CloudSolrStream and ParallelStream don't check the state of the replicas they route requests to. This can result in replicas that are not active receiving request.&lt;/p&gt;</description>
                <environment/>
        <key id="12924039">SOLR-8461</key>
            <summary>CloudSolrStream and ParallelStream can choose replicas that are not active</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="joel.bernstein">Joel Bernstein</assignee>
                                    <reporter username="joel.bernstein">Joel Bernstein</reporter>
                        <labels>
                    </labels>
                <created>Wed, 23 Dec 2015 10:14:16 -0700</created>
                <updated>Thu, 11 Feb 2016 08:58:21 -0700</updated>
                            <resolved>Thu, 11 Feb 2016 08:58:02 -0700</resolved>
                                                    <fixVersion>6.0</fixVersion>
                                    <component>SolrCloud</component>
                        <due/>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="15070798" author="caomanhdat" created="Thu, 24 Dec 2015 02:20:10 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=joel.bernstein" class="user-hover" rel="joel.bernstein"&gt;Joel Bernstein&lt;/a&gt; I will try to working on this issue. Can you assign it to me?&lt;/p&gt;</comment>
                            <comment id="15071096" author="joel.bernstein" created="Thu, 24 Dec 2015 08:48:32 -0700">&lt;p&gt;I'm not sure if I can assign it to you. I believe a committer is typically the assignee. But feel free to post a patch and I'll review and commit when it's ready. You'll be referenced in CHANGES.txt.&lt;/p&gt;</comment>
                            <comment id="15071394" author="caomanhdat" created="Fri, 25 Dec 2015 00:35:01 -0700">&lt;p&gt;First attempt, &lt;br/&gt;
I just dont know how to write unit test for this issue. Any hint?&lt;/p&gt;</comment>
                            <comment id="15071610" author="joel.bernstein" created="Fri, 25 Dec 2015 06:29:49 -0700">&lt;p&gt;I think all needs to be done here is to check the state of replica before adding to the list of replicas to choose from.&lt;/p&gt;

&lt;p&gt;As long as all existing tests pass after this change then it should be committed.&lt;/p&gt;
</comment>
                            <comment id="15071617" author="caomanhdat" created="Fri, 25 Dec 2015 06:42:29 -0700">&lt;p&gt;It quite trivial patch if you said so. I just afraid of replica being down after create SolrStream and before open it.&lt;/p&gt;</comment>
                            <comment id="15071659" author="joel.bernstein" created="Fri, 25 Dec 2015 09:32:08 -0700">&lt;p&gt;Yes, this is a quick fix just to resolve the choosing of inactive replicas.&lt;/p&gt;

&lt;p&gt;From a testing standpoint we can investigate the Chaos Monkey behavior on the streaming tests.&lt;/p&gt;</comment>
                            <comment id="15074719" author="caomanhdat" created="Wed, 30 Dec 2015 00:23:52 -0700">&lt;p&gt;Added unit test.&lt;/p&gt;</comment>
                            <comment id="15074750" author="varunthacker" created="Wed, 30 Dec 2015 00:49:24 -0700">&lt;p&gt;Hi &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=caomanhdat" class="user-hover" rel="caomanhdat"&gt;Cao Manh Dat&lt;/a&gt; ,&lt;/p&gt;

&lt;p&gt;Patch looks great! Couple of comments -&lt;br/&gt;
1. With the patch we check if the replica is active, we should also also check if the replica's nodeName belongs in the live nodes list. This is required for a scenario like this - Someone kills the node using "kill -9 &amp;lt;pid&amp;gt;" / OOM crash . In the cluster state that replica will still show us "active". HttpSolrCall#getCoreByCollection does the same thing &lt;br/&gt;
2. Maybe move the code into a function - say "getActiveReplicasForCollection" ? The both CloudSolrStream and ParallelSteam can reuse it.&lt;/p&gt;</comment>
                            <comment id="15074759" author="caomanhdat" created="Wed, 30 Dec 2015 01:00:43 -0700">&lt;blockquote&gt;
&lt;p&gt;1. With the patch we check if the replica is active, we should also also check if the replica's nodeName belongs in the live nodes list. This is required for a scenario like this - Someone kills the node using "kill -9 &amp;lt;pid&amp;gt;" / OOM crash . In the cluster state that replica will still show us "active". HttpSolrCall#getCoreByCollection does the same thing &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Very nice suggestion, I Will update it now.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;2. Maybe move the code into a function - say "getActiveReplicasForCollection" ? The both CloudSolrStream and ParallelSteam can reuse it.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Cant do that. In ParallelStream, we just wanna find enough workers, dont care about what collection/shard that replica belong to. In CloudSolrStream, for each collection we will randomly find a replica per shard.&lt;/p&gt;</comment>
                            <comment id="15074772" author="caomanhdat" created="Wed, 30 Dec 2015 01:17:32 -0700">&lt;p&gt;New patch based on &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varunthacker" class="user-hover" rel="varunthacker"&gt;Varun Thacker&lt;/a&gt; suggestion.&lt;/p&gt;</comment>
                            <comment id="15074858" author="varunthacker" created="Wed, 30 Dec 2015 02:42:19 -0700">&lt;p&gt;How about we add this method to ClusterState.java and make use of this?&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
&lt;span class="code-keyword"&gt;public&lt;/span&gt; List&amp;lt;Replica&amp;gt; getActiveReplicas(&lt;span class="code-object"&gt;String&lt;/span&gt; collection, &lt;span class="code-object"&gt;String&lt;/span&gt; sliceName) {
    Slice slice = getSlice(collection, sliceName);
    &lt;span class="code-keyword"&gt;if&lt;/span&gt; (slice == &lt;span class="code-keyword"&gt;null&lt;/span&gt;) &lt;span class="code-keyword"&gt;return&lt;/span&gt; &lt;span class="code-keyword"&gt;null&lt;/span&gt;;
    List&amp;lt;Replica&amp;gt; activeReplicas = &lt;span class="code-keyword"&gt;new&lt;/span&gt; ArrayList&amp;lt;&amp;gt;();
    &lt;span class="code-keyword"&gt;for&lt;/span&gt; (Replica replica : slice.getReplicas()) {
      &lt;span class="code-keyword"&gt;if&lt;/span&gt; (liveNodes.contains(replica.getNodeName()) &amp;amp;&amp;amp; replica.getState() == Replica.State.ACTIVE) {
        activeReplicas.add(replica);
      }
    }
    &lt;span class="code-keyword"&gt;return&lt;/span&gt; activeReplicas;
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15074900" author="caomanhdat" created="Wed, 30 Dec 2015 03:14:12 -0700">&lt;p&gt;New patch based on the snippet of &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varunthacker" class="user-hover" rel="varunthacker"&gt;Varun Thacker&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15125615" author="joel.bernstein" created="Sun, 31 Jan 2016 18:53:08 -0700">&lt;p&gt;Thanks for the patch &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=caomanhdat" class="user-hover" rel="caomanhdat"&gt;Cao Manh Dat&lt;/a&gt;. I'll start reviewing the patch shortly.  I'm also considering adding an Executor to the StreamContext so each stream doesn't create an executer of it's own for connecting to the replicas. But I'll start from the patch provided by &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=caomanhdat" class="user-hover" rel="caomanhdat"&gt;Cao Manh Dat&lt;/a&gt; and expand from there.&lt;/p&gt;</comment>
                            <comment id="15126330" author="stephlag" created="Mon, 1 Feb 2016 07:54:44 -0700">&lt;p&gt;I'm trying to gather all issues related to SolrCloud that affects Solr 5.4. Can you affect SolrCloud component to this issue ?&lt;/p&gt;</comment>
                            <comment id="15126348" author="joel.bernstein" created="Mon, 1 Feb 2016 08:02:21 -0700">&lt;p&gt;This bug is only in trunk so it only effects the 6.0 release&lt;/p&gt;</comment>
                            <comment id="15126359" author="joel.bernstein" created="Mon, 1 Feb 2016 08:07:52 -0700">&lt;p&gt;Actually I'm wrong. These classes are in 5x. I'll update the component.&lt;/p&gt;</comment>
                            <comment id="15142804" author="joel.bernstein" created="Thu, 11 Feb 2016 07:33:47 -0700">&lt;p&gt;Patch with minimal changes to address the issue. With Solr 6.0 coming very soon, I felt it made sense to make this patch as small as possible.&lt;/p&gt;

&lt;p&gt;I will open another ticket to explore some of the ideas in this ticket around the resiliency of streaming requests.&lt;/p&gt;</comment>
                            <comment id="15142924" author="jira-bot" created="Thu, 11 Feb 2016 08:55:09 -0700">&lt;p&gt;Commit 8eb58cc00015f65d120f4ebd921cc4be2ee4c30d in lucene-solr's branch refs/heads/master from jbernste&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=8eb58cc" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=8eb58cc&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8461" title="CloudSolrStream and ParallelStream can choose replicas that are not active" class="issue-link" data-issue-key="SOLR-8461"&gt;&lt;del&gt;SOLR-8461&lt;/del&gt;&lt;/a&gt;: CloudSolrStream and ParallelStream can choose replicas that are not active&lt;/p&gt;</comment>
                            <comment id="15142925" author="jira-bot" created="Thu, 11 Feb 2016 08:55:10 -0700">&lt;p&gt;Commit 35337e8cf278ab445c3a8d1b5d256d80fb23aa7e in lucene-solr's branch refs/heads/master from jbernste&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=35337e8" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=35337e8&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8461" title="CloudSolrStream and ParallelStream can choose replicas that are not active" class="issue-link" data-issue-key="SOLR-8461"&gt;&lt;del&gt;SOLR-8461&lt;/del&gt;&lt;/a&gt;: Update CHANGES.txt&lt;/p&gt;</comment>
                            <comment id="15142928" author="joel.bernstein" created="Thu, 11 Feb 2016 08:57:47 -0700">&lt;p&gt;Thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=caomanhdat" class="user-hover" rel="caomanhdat"&gt;Cao Manh Dat&lt;/a&gt; and &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varunthacker" class="user-hover" rel="varunthacker"&gt;Varun Thacker&lt;/a&gt;!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12902422">SOLR-8125</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12787475" name="SOLR-8461.patch" size="3218" author="joel.bernstein" created="Thu, 11 Feb 2016 07:33:47 -0700"/>
                            <attachment id="12779944" name="SOLR-8461.patch" size="7531" author="caomanhdat" created="Wed, 30 Dec 2015 03:14:12 -0700"/>
                            <attachment id="12779921" name="SOLR-8461.patch" size="6488" author="caomanhdat" created="Wed, 30 Dec 2015 01:17:32 -0700"/>
                            <attachment id="12779918" name="SOLR-8461.patch" size="5405" author="caomanhdat" created="Wed, 30 Dec 2015 00:23:52 -0700"/>
                            <attachment id="12779515" name="SOLR-8461.patch" size="1635" author="caomanhdat" created="Fri, 25 Dec 2015 06:42:29 -0700"/>
                            <attachment id="12779498" name="SOLR-8461.patch" size="4879" author="caomanhdat" created="Fri, 25 Dec 2015 00:35:01 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 24 Dec 2015 09:20:10 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2q9in:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8449] Multiple restores on the same core does not work</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8449</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Hi all, I facing the following issue with Solr 5.2.1 and the ongoing version 5.4.&lt;br/&gt;
The restore functionality is not working under Linux and causing an exception on Windows machines each time you want to restore an existing backup twice or even more.&lt;/p&gt;

&lt;p&gt;Steps to reproduce:&lt;br/&gt;
1. Start a Solr instance pointing the solr_home to e.g. the example-DIH  folder.&lt;br/&gt;
2. Select a core, e.g. the solr core.&lt;br/&gt;
3. Switch to the Documents tab&lt;br/&gt;
4. Add a document &lt;/p&gt;
{id:1,title:change.me}
&lt;p&gt;5. Do a backup with the following API call /solr/replication?command=backup&amp;amp;name=test&lt;br/&gt;
The backup defaults to the location solr_home/solr/data/snapshot.test&lt;br/&gt;
6. Add a document to the index &lt;/p&gt;
{id:2,title:change.me}
&lt;p&gt;. Now there a two document in the index.&lt;br/&gt;
7. Restore the back with the following call /solr/replication?command=restore&amp;amp;name=test&lt;br/&gt;
New index location solr_home/solr/data/restore.snapshot.test is created without any physical file in it, except the file write.lock. Num Docs is now 1 as expected!&lt;br/&gt;
8. Add a document to the index &lt;/p&gt;
{id:3,title:change.me}
&lt;p&gt;. Now there a two document in the index.&lt;br/&gt;
9. Restore the same previous created back again with the following call /solr/replication?command=restore&amp;amp;name=test. Notice, there are still 2 docs in the index!!!&lt;br/&gt;
10. Try to restore again, but still the same, 2 docs in the index&lt;br/&gt;
11. Shut down Solr, you will see the index folder solr_home/solr/data/restore.snapshot.test disappears.&lt;br/&gt;
12. Restart Solr. You will notice the following log entry Solr index directory solr_home/solr/data/restore.snapshot.test doesnt exist. Creating new index, and indeed the Index is empty, showing 0 documents.&lt;br/&gt;
13. After the restart, I tried to restore the existing backup again without any results&lt;/p&gt;

&lt;p&gt;I thing this behavior in not intended!!!&lt;/p&gt;

&lt;p&gt;Even more Problems arise when you run Solr on a Windows machine.&lt;br/&gt;
After step 10 a folder index is created under solr_home/solr/data/ with a write.lock file in it. After that, the following exception is thrown: &lt;br/&gt;
Error closing IndexWriter&lt;br/&gt;
java.lang.IllegalStateException: file: MMapDirectory@D:\solr\Solr_versions\solr-5.2.1\...restore.snapshot.test lockFactory=org.apache.lucene.store.Nat&lt;br/&gt;
iveFSLockFactory@3d3d7a0e appears both in delegate and in cache&lt;/p&gt;

&lt;p&gt;The log file from the Windows test is attached.&lt;/p&gt;

&lt;p&gt;Let me know if you have problems reproducing the same behavior,&lt;/p&gt;

&lt;p&gt;Regards Johannes&lt;/p&gt;</description>
                <environment>&lt;p&gt;SUSE Linux Enterprise Server 11 (64 bit) and Windows 7 Prof SP1&lt;/p&gt;</environment>
        <key id="12923415">SOLR-8449</key>
            <summary>Multiple restores on the same core does not work</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="varunthacker">Varun Thacker</assignee>
                                    <reporter username="jomarley">Johannes Brucher</reporter>
                        <labels>
                            <label>Backup/Restore</label>
                    </labels>
                <created>Mon, 21 Dec 2015 05:40:42 -0700</created>
                <updated>Thu, 21 Apr 2016 17:28:36 -0700</updated>
                            <resolved>Thu, 21 Apr 2016 17:20:24 -0700</resolved>
                                    <version>5.2.1</version>
                    <version>5.4</version>
                                    <fixVersion>5.5.1</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>replication (java)</component>
                    <component>replication (scripts)</component>
                        <due/>
                            <votes>2</votes>
                                    <watches>7</watches>
                                                                <comments>
                            <comment id="15066406" author="jomarley" created="Mon, 21 Dec 2015 05:44:09 -0700">&lt;p&gt;Exceptions from the windows 7 restore test attached...&lt;/p&gt;</comment>
                            <comment id="15108995" author="varunthacker" created="Wed, 20 Jan 2016 10:28:49 -0700">&lt;blockquote&gt;&lt;p&gt;4. Add a document&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Do you call commit after that?&lt;/p&gt;</comment>
                            <comment id="15110268" author="jomarley" created="Thu, 21 Jan 2016 01:27:06 -0700">&lt;p&gt;I uploaded the document via the Admin UI/Core/Documents tab.&lt;br/&gt;
I think using this tab will automatically perform a commit in the background I guess, because after adding the doc its in the index.&lt;/p&gt;

&lt;p&gt;But to answer your question, after step 4 i did not explicitly call a commit statment!&lt;/p&gt;</comment>
                            <comment id="15110881" author="varunthacker" created="Thu, 21 Jan 2016 09:46:53 -0700">&lt;p&gt;Patch which fixes the problem.&lt;/p&gt;

&lt;p&gt;Previously we never supported restoring the same backup . Hence this bug was found.&lt;/p&gt;

&lt;p&gt;I've tried it manually and it works with the steps listed out here. Still need to write some tests before committing this&lt;/p&gt;</comment>
                            <comment id="15181616" author="varunthacker" created="Sat, 5 Mar 2016 00:38:54 -0700">&lt;p&gt;Patch which fixes the problem and updated test case which will fail without the fix .&lt;/p&gt;

&lt;p&gt;The patch is a low risk fix. So &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nknize" class="user-hover" rel="nknize"&gt;Nicholas Knize&lt;/a&gt; cool if we backport it to 6.0 as well?&lt;/p&gt;</comment>
                            <comment id="15181759" author="nknize" created="Sat, 5 Mar 2016 08:46:02 -0700">&lt;p&gt;+1 for 6.0 backport &lt;/p&gt;</comment>
                            <comment id="15181874" author="jira-bot" created="Sat, 5 Mar 2016 15:43:36 -0700">&lt;p&gt;Commit 4381018b77f019ce2c579240538177b546ff3d86 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varunthacker" class="user-hover" rel="varunthacker"&gt;Varun Thacker&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=4381018" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=4381018&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8449" title="Multiple restores on the same core does not work" class="issue-link" data-issue-key="SOLR-8449"&gt;&lt;del&gt;SOLR-8449&lt;/del&gt;&lt;/a&gt;: Fix the core restore functionality to allow restoring multiple times on the same core&lt;/p&gt;</comment>
                            <comment id="15181875" author="jira-bot" created="Sat, 5 Mar 2016 15:44:12 -0700">&lt;p&gt;Commit cb4a91eb7c61678939cd65d739ed57c4335181a3 in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varunthacker" class="user-hover" rel="varunthacker"&gt;Varun Thacker&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=cb4a91e" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=cb4a91e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8449" title="Multiple restores on the same core does not work" class="issue-link" data-issue-key="SOLR-8449"&gt;&lt;del&gt;SOLR-8449&lt;/del&gt;&lt;/a&gt;: Fix the core restore functionality to allow restoring multiple times on the same core&lt;/p&gt;</comment>
                            <comment id="15181876" author="jira-bot" created="Sat, 5 Mar 2016 15:45:07 -0700">&lt;p&gt;Commit be021fcf6f3c87ab5ed51fb0f5dbfd08d752a899 in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varunthacker" class="user-hover" rel="varunthacker"&gt;Varun Thacker&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=be021fc" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=be021fc&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8449" title="Multiple restores on the same core does not work" class="issue-link" data-issue-key="SOLR-8449"&gt;&lt;del&gt;SOLR-8449&lt;/del&gt;&lt;/a&gt;: Fix the core restore functionality to allow restoring multiple times on the same core&lt;/p&gt;</comment>
                            <comment id="15181877" author="varunthacker" created="Sat, 5 Mar 2016 15:46:03 -0700">&lt;p&gt;Thanks Johannes! This is now fixed for 6.0&lt;/p&gt;</comment>
                            <comment id="15252968" author="anshumg" created="Thu, 21 Apr 2016 16:04:40 -0700">&lt;p&gt;back porting for 5.5.1&lt;/p&gt;</comment>
                            <comment id="15253071" author="anshumg" created="Thu, 21 Apr 2016 17:28:36 -0700">&lt;p&gt;branch_5x:&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
commit 443fd2d29a4326a2d483c33bcbfeb7e2f636f250
Author: Varun Thacker &amp;lt;varunthacker1989@gmail.com&amp;gt;
Date:   Sat Mar 5 13:15:19 2016 +0530

    SOLR-8449: Fix the core restore functionality to allow restoring multiple times on the same core
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;branch_5_5&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
commit efb7d4463ee5f1146ee193a46f6a146ca3f48d67
Author: Varun Thacker &amp;lt;varunthacker1989@gmail.com&amp;gt;
Date:   Sat Mar 5 13:15:19 2016 +0530

    SOLR-8449: Fix the core restore functionality to allow restoring multiple times on the same core
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12791612" name="SOLR-8449.patch" size="3870" author="varunthacker" created="Sat, 5 Mar 2016 00:38:54 -0700"/>
                            <attachment id="12783608" name="SOLR-8449.patch" size="1644" author="varunthacker" created="Thu, 21 Jan 2016 09:46:53 -0700"/>
                            <attachment id="12778817" name="log_windows7_sp1.txt" size="46984" author="jomarley" created="Mon, 21 Dec 2015 05:44:09 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 20 Jan 2016 17:28:49 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2q5o7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8423] DELETESHARD should cleanup the instance and data directory, like DELETEREPLICA</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8423</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;DELETESHARD only cleans up the index directory and not the instance/data directory. DELETEREPLICA on the other hand cleans up the data and instance directory.&lt;/p&gt;

&lt;p&gt;DELETESHARD should clean up the instance and data directory, so that we don't leak disk space on executing the command.&lt;/p&gt;

&lt;p&gt;If we think this would break back-compat, though I don't see why this should not clean up the instance dir, we should at least provide an option to clean up everything and make it default in 6.0.&lt;/p&gt;</description>
                <environment/>
        <key id="12922318">SOLR-8423</key>
            <summary>DELETESHARD should cleanup the instance and data directory, like DELETEREPLICA</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="anshumg">Anshum Gupta</assignee>
                                    <reporter username="anshumg">Anshum Gupta</reporter>
                        <labels>
                    </labels>
                <created>Wed, 16 Dec 2015 03:06:32 -0700</created>
                <updated>Tue, 5 Apr 2016 19:45:09 -0700</updated>
                            <resolved>Thu, 3 Mar 2016 16:01:33 -0700</resolved>
                                                    <fixVersion>6.0</fixVersion>
                    <fixVersion>master</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="15060299" author="erickerickson" created="Wed, 16 Dec 2015 10:02:22 -0700">&lt;p&gt;I don't think this breaks back-compat 'cause I don't see any promises in the docs &lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/wink.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt; But I vaguely recall that this was to clean up stale cluster states without having to directly edit the ZK node, so maybe nobody thought about it?&lt;/p&gt;

&lt;p&gt;I might advocate an option to keep at least the data directory just on general principles here though. I'm thinking of the case where the user is explicitly controlling routing, say time-series data. Does it make sense to delete/create shards to hide/show some time-interval? I have to admit this is a &lt;em&gt;theoretical&lt;/em&gt; use-case, haven't seen anyone actually ask for it so feel free to ignore...&lt;/p&gt;</comment>
                            <comment id="15061728" author="anshumg" created="Thu, 17 Dec 2015 01:42:32 -0700">&lt;p&gt;Patch without a test. I'll add a test for this and also need to find a better param for supporting deletion without cleaning up of the instance directory (like right now). In this patch, it's called &lt;em&gt;safedelete&lt;/em&gt;.&lt;/p&gt;</comment>
                            <comment id="15061776" author="shaie" created="Thu, 17 Dec 2015 02:23:40 -0700">&lt;p&gt;So with this patch, the default is that we delete the index + instance + data directory, but if the user wants, he can request a &lt;em&gt;safedelete&lt;/em&gt; and the behavior goes back to what it is today? I'm fine with that.&lt;/p&gt;</comment>
                            <comment id="15061798" author="shalinmangar" created="Thu, 17 Dec 2015 02:39:03 -0700">&lt;p&gt;Why not just use the existing deleteInstanceDir and deleteDataDir core admin params (and default them to true)? It is not obvious to me what 'safedelete' means.&lt;/p&gt;</comment>
                            <comment id="15061804" author="anshumg" created="Thu, 17 Dec 2015 02:47:22 -0700">&lt;p&gt;I just wanted to keep it easy for users and I think adding a single flag is an easier option.&lt;br/&gt;
Also, we want to set both those to true and I personally feel that deleteInstanceDir/deleteDataDir being set to true is a little less intuitive.&lt;/p&gt;</comment>
                            <comment id="15061813" author="shalinmangar" created="Thu, 17 Dec 2015 02:54:44 -0700">&lt;p&gt;This is easy for the users. No need to remember what a new vague sounding parameter does. deleteInstanceDir/deleteDataDir is as explicit as it gets. &lt;/p&gt;

&lt;p&gt;What the hell is a safedelete anyway?&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;We don't accidentally delete other's data?&lt;/li&gt;
	&lt;li&gt;We don't delete our data?&lt;/li&gt;
	&lt;li&gt;We ensure that data is actually deleted and cannot be recovered?&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;If you really want to keep things simple for users, do what deletereplica already does i.e. deletes instance dir, data dir, index automatically as we did in &lt;a href="https://issues.apache.org/jira/browse/SOLR-6072" title="The &amp;#39;deletereplica&amp;#39; API should remove the data and instance directory default" class="issue-link" data-issue-key="SOLR-6072"&gt;&lt;del&gt;SOLR-6072&lt;/del&gt;&lt;/a&gt;. No switch necessary to control that. If you want to implement a way to control what gets deleted, implement it for both deleteshard and deletereplica and even better, just have deleteshard internally call deletereplica and avoid the code duplication.&lt;/p&gt;</comment>
                            <comment id="15061880" author="anshumg" created="Thu, 17 Dec 2015 03:47:33 -0700">&lt;p&gt;As I said, the name of the param was just something I put in there.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;need to find a better param for supporting deletion without cleaning up of the instance directory (like right now). In this patch, it's called safedelete.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;As far as reusing the current params is concerned, I'll go with your suggestion and put up another patch. I used CoreAdmin calls directly because I didn't want to stack up more tasks for the Overseer. It however makes sense to just refactor the coreadmin call code and reuse that.&lt;/p&gt;

&lt;p&gt;P.S: The meaning of 'safedelete' would have been clear through the ref guide/documentation. The difference between instance/data/index directory can get a little complicated for users though, specially as we're trying to move away from Core admin calls being exposed to end users (via http api).&lt;/p&gt;</comment>
                            <comment id="15062003" author="markrmiller@gmail.com" created="Thu, 17 Dec 2015 05:55:26 -0700">&lt;blockquote&gt;&lt;p&gt;deleteInstanceDir and deleteDataDir &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Probably best to be consistent in naming these params - especially given the behavior is the same. At least on 5x. On 6x, would still be nice to be consistent, but we could change how it works if we had ideas to improve it.&lt;/p&gt;</comment>
                            <comment id="15067858" author="anshumg" created="Tue, 22 Dec 2015 02:37:42 -0700">&lt;p&gt;Patch that uses deleteDataDir, deleteInstanceDir and defaults them to true.&lt;br/&gt;
It now also supports setting those to false for DELETESHARD and DELETEREPLICA.&lt;/p&gt;</comment>
                            <comment id="15068033" author="shalinmangar" created="Tue, 22 Dec 2015 05:10:24 -0700">&lt;p&gt;Thanks Anshum. Looks good to me. We need a test though.&lt;/p&gt;</comment>
                            <comment id="15068039" author="anshumg" created="Tue, 22 Dec 2015 05:13:41 -0700">&lt;p&gt;Right, working on that. Got stuck up with something else.&lt;/p&gt;</comment>
                            <comment id="15176259" author="anshumg" created="Wed, 2 Mar 2016 11:59:36 -0700">&lt;p&gt;Patch with tests. I'll commit this once the 6.0 work is in place.&lt;/p&gt;</comment>
                            <comment id="15178507" author="jira-bot" created="Thu, 3 Mar 2016 12:55:25 -0700">&lt;p&gt;Commit 9c777ab5adfd07e49310a5fb091d8bac611ef0ba in lucene-solr's branch refs/heads/master from anshum&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9c777ab" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9c777ab&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8423" title="DELETESHARD should cleanup the instance and data directory, like DELETEREPLICA" class="issue-link" data-issue-key="SOLR-8423"&gt;&lt;del&gt;SOLR-8423&lt;/del&gt;&lt;/a&gt;: DeleteShard and DeleteReplica should cleanup instance and data directory by default and add support for optionally retaining the directories&lt;/p&gt;</comment>
                            <comment id="15178679" author="jira-bot" created="Thu, 3 Mar 2016 14:51:59 -0700">&lt;p&gt;Commit 638b145376baea5281273bb90cedd8f69fecfa9f in lucene-solr's branch refs/heads/branch_6x from anshum&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=638b145" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=638b145&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8423" title="DELETESHARD should cleanup the instance and data directory, like DELETEREPLICA" class="issue-link" data-issue-key="SOLR-8423"&gt;&lt;del&gt;SOLR-8423&lt;/del&gt;&lt;/a&gt;: DeleteShard and DeleteReplica should cleanup instance and data directory by default and add support for optionally retaining the directories&lt;/p&gt;</comment>
                            <comment id="15178687" author="jira-bot" created="Thu, 3 Mar 2016 14:58:46 -0700">&lt;p&gt;Commit ca03639e6d5fbae924060fdb0b087189bb65a75d in lucene-solr's branch refs/heads/branch_6_0 from anshum&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ca03639" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ca03639&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8423" title="DELETESHARD should cleanup the instance and data directory, like DELETEREPLICA" class="issue-link" data-issue-key="SOLR-8423"&gt;&lt;del&gt;SOLR-8423&lt;/del&gt;&lt;/a&gt;: DeleteShard and DeleteReplica should cleanup instance and data directory by default and add support for optionally retaining the directories&lt;/p&gt;</comment>
                            <comment id="15227580" author="hossman" created="Tue, 5 Apr 2016 19:28:08 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anshumg" class="user-hover" rel="anshumg"&gt;Anshum Gupta&lt;/a&gt;, &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalinmangar" class="user-hover" rel="shalinmangar"&gt;Shalin Shekhar Mangar&lt;/a&gt;, &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com" class="user-hover" rel="markrmiller@gmail.com"&gt;Mark Miller&lt;/a&gt; - can one of you please review the ref guide edits i made for this issue...&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;a href="https://cwiki.apache.org/confluence/pages/diffpagesbyversion.action?pageId=32604284&amp;amp;selectedPageVersions=156&amp;amp;selectedPageVersions=157" class="external-link" rel="nofollow"&gt;https://cwiki.apache.org/confluence/pages/diffpagesbyversion.action?pageId=32604284&amp;amp;selectedPageVersions=156&amp;amp;selectedPageVersions=157&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href="https://cwiki.apache.org/confluence/pages/diffpagesbyversion.action?pageId=61339928&amp;amp;selectedPageVersions=5&amp;amp;selectedPageVersions=6" class="external-link" rel="nofollow"&gt;https://cwiki.apache.org/confluence/pages/diffpagesbyversion.action?pageId=61339928&amp;amp;selectedPageVersions=5&amp;amp;selectedPageVersions=6&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;(It was a little confusing to me how to document this clearly since, AFAICT, &lt;em&gt;all&lt;/em&gt; the params default to "true", regardless of what other params the user might set to "false", so setting &lt;tt&gt;deleteInstanceDir=false&lt;/tt&gt; by itself doesn't seem to do anything very useful &amp;#8211; the dataDir (and index) is still deleted because deleteDatadDir defaults to true.)&lt;/p&gt;</comment>
                            <comment id="15227586" author="anshumg" created="Tue, 5 Apr 2016 19:29:55 -0700">&lt;p&gt;I'll take a look.&lt;/p&gt;</comment>
                            <comment id="15227602" author="anshumg" created="Tue, 5 Apr 2016 19:45:09 -0700">&lt;p&gt;You are right about deleteInstanceDir not doing anything by itself as the data directory would still be deleted by default and deleteDataDir has a similar issue. This calls for a JIRA but in terms of documenting this, we might have to ask users to set both of them to false for 6.0.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12790992" name="SOLR-8423.patch" size="16969" author="anshumg" created="Wed, 2 Mar 2016 11:59:36 -0700"/>
                            <attachment id="12779020" name="SOLR-8423.patch" size="3372" author="anshumg" created="Tue, 22 Dec 2015 02:37:42 -0700"/>
                            <attachment id="12778210" name="SOLR-8423.patch" size="1750" author="anshumg" created="Thu, 17 Dec 2015 01:42:32 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 16 Dec 2015 17:02:22 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2pywn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8420] Date statistics: sumOfSquares overflows long</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8420</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;The values for Dates are large enough that squaring them overflows a "long" field. This should be converted to a double. &lt;/p&gt;

&lt;p&gt;StatsValuesFactory.java, line 755 DateStatsValues#updateTypeSpecificStats Add a cast to double &lt;/p&gt;

&lt;p&gt;sumOfSquares += ( (double)value * value * count);&lt;/p&gt;</description>
                <environment/>
        <key id="12922128">SOLR-8420</key>
            <summary>Date statistics: sumOfSquares overflows long</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tomasflobbe">Toms Fernndez Lbbe</assignee>
                                    <reporter username="tomsolr">Tom Hill</reporter>
                        <labels>
                    </labels>
                <created>Tue, 15 Dec 2015 13:20:07 -0700</created>
                <updated>Thu, 21 Apr 2016 15:31:19 -0700</updated>
                            <resolved>Thu, 21 Apr 2016 15:31:19 -0700</resolved>
                                    <version>5.4</version>
                                    <fixVersion>5.5.1</fixVersion>
                    <fixVersion>6.0</fixVersion>
                    <fixVersion>master</fixVersion>
                                    <component>SearchComponents - other</component>
                        <due/>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="15064346" author="tomsolr" created="Fri, 18 Dec 2015 11:00:03 -0700">&lt;p&gt;Fixes overflow in stddev, too.&lt;/p&gt;

&lt;p&gt;Not ready to commit. I still have to fix a rounding error in TestDistributed.&lt;/p&gt;</comment>
                            <comment id="15068793" author="tomsolr" created="Tue, 22 Dec 2015 15:01:44 -0700">&lt;p&gt;Just a quick demo of why TestDistributedSearch is failing, when running with the patch.&lt;/p&gt;

&lt;p&gt;When TestDistributedSearch#test is run with two partitions, it gets a slightly different value than when run on one partition. &lt;/p&gt;

&lt;p&gt;The two results are &lt;br/&gt;
100010100011010110010111011100111101011001010000011100001000110&lt;br/&gt;
100010100011010110010111011100111101011001010000011100001000101&lt;/p&gt;

&lt;p&gt;This matches the numbers seen in TestDistributedSearch.&lt;/p&gt;

&lt;p&gt;It looks like we need to add some delta into the compare for doubles in &lt;/p&gt;

&lt;p&gt;BaseDistributedSearchTestCase#public static String compare(Object a, Object b, int flags, Map&amp;lt;String, Integer&amp;gt; handle)&lt;/p&gt;</comment>
                            <comment id="15069489" author="cpoerschke" created="Wed, 23 Dec 2015 03:29:27 -0700">&lt;p&gt;sumOfSquares overflow, interesting. I wonder if &lt;tt&gt;DateStatsValues&lt;/tt&gt;'s &lt;tt&gt;private long sum = 0;&lt;/tt&gt; might perhaps become &lt;tt&gt;double&lt;/tt&gt; also (similar to &lt;tt&gt;NumericStatsValues&lt;/tt&gt;'s sum being a double already).&lt;/p&gt;</comment>
                            <comment id="15073165" author="tomsolr" created="Mon, 28 Dec 2015 14:28:32 -0700">&lt;p&gt;Certainly could be changed. Looks like it currently would overflow if you are looking at more than 6 million+ dates, which is a pretty small number today.&lt;/p&gt;

&lt;p&gt;Downside is small loss of precision for smaller datasets.&lt;/p&gt;

&lt;p&gt;I think it probably should be changed. I'll update the patch.&lt;/p&gt;
</comment>
                            <comment id="15107737" author="tomasflobbe" created="Tue, 19 Jan 2016 17:28:18 -0700">&lt;blockquote&gt;&lt;p&gt;I wonder if DateStatsValues's private long sum = 0; might perhaps become double also (similar to NumericStatsValues's sum being a double already).&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yes, I think it should. This should also change the output, currently it's a date like:&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-xml"&gt;
&lt;span class="code-tag"&gt;&amp;lt;date name=&lt;span class="code-quote"&gt;"sum"&lt;/span&gt;&amp;gt;&lt;/span&gt;122366-06-12T21:06:06Z&lt;span class="code-tag"&gt;&amp;lt;/date&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15141720" author="tomasflobbe" created="Wed, 10 Feb 2016 14:38:20 -0700">&lt;p&gt;I created &lt;a href="https://issues.apache.org/jira/browse/SOLR-8671" title="Date statistics: make &amp;quot;sum&amp;quot; a double instead of a long/date" class="issue-link" data-issue-key="SOLR-8671"&gt;&lt;del&gt;SOLR-8671&lt;/del&gt;&lt;/a&gt; for this particular change&lt;/p&gt;</comment>
                            <comment id="15142019" author="tomasflobbe" created="Wed, 10 Feb 2016 17:24:20 -0700">&lt;p&gt;While looking at this patch I noticed that in the line 841 of &lt;tt&gt;TestDistributedSearch&lt;/tt&gt; it says:&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
rsp = query(&lt;span class="code-quote"&gt;"q"&lt;/span&gt;, &lt;span class="code-quote"&gt;"*:*"&lt;/span&gt;, &lt;span class="code-quote"&gt;"rows"&lt;/span&gt;, &lt;span class="code-quote"&gt;"0"&lt;/span&gt;, &lt;span class="code-quote"&gt;"stats"&lt;/span&gt;, &lt;span class="code-quote"&gt;"&lt;span class="code-keyword"&gt;true&lt;/span&gt;"&lt;/span&gt;,
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;but was intended to be&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
rsp = query(&lt;span class="code-quote"&gt;"q"&lt;/span&gt;, q, &lt;span class="code-quote"&gt;"rows"&lt;/span&gt;, &lt;span class="code-quote"&gt;"0"&lt;/span&gt;, &lt;span class="code-quote"&gt;"stats"&lt;/span&gt;, &lt;span class="code-quote"&gt;"&lt;span class="code-keyword"&gt;true&lt;/span&gt;"&lt;/span&gt;,
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;We should fix that as part of this Jira too.&lt;/p&gt;</comment>
                            <comment id="15159469" author="tomsolr" created="Tue, 23 Feb 2016 12:17:58 -0700">&lt;p&gt;This latest version of the path adds an allowance in tests for floating point errors in computations for specific stats. &lt;/p&gt;

&lt;p&gt;It also fixes the error in the test that Tomas noted.&lt;/p&gt;</comment>
                            <comment id="15160003" author="tomasflobbe" created="Tue, 23 Feb 2016 18:13:09 -0700">&lt;p&gt;Thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tomsolr" class="user-hover" rel="tomsolr"&gt;Tom Hill&lt;/a&gt;, patch looks good to me, will commit shortly&lt;/p&gt;</comment>
                            <comment id="15166625" author="tomasflobbe" created="Wed, 24 Feb 2016 19:52:51 -0700">&lt;p&gt;Minor change, FUZZY comparison passes in case of both numbers being NaN, made the accepted ratio a constant and added some javadocs to FUZZY flag&lt;/p&gt;</comment>
                            <comment id="15166636" author="jira-bot" created="Wed, 24 Feb 2016 20:04:50 -0700">&lt;p&gt;Commit 730d10f145378b164a93d63b82a02dcf7f2fdf14 in lucene-solr's branch refs/heads/master from Tomas Fernandez Lobbe&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=730d10f" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=730d10f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8420" title="Date statistics: sumOfSquares overflows long" class="issue-link" data-issue-key="SOLR-8420"&gt;&lt;del&gt;SOLR-8420&lt;/del&gt;&lt;/a&gt;: Fix long overflow in sumOfSquares for Date statistics&lt;/p&gt;

&lt;p&gt;Casted operations to double. Changed the test to support a percentage error given the FUZZY flag in doubles&lt;/p&gt;</comment>
                            <comment id="15252721" author="anshumg" created="Thu, 21 Apr 2016 14:01:00 -0700">&lt;p&gt;Reopening to back port for 5.5.1&lt;/p&gt;</comment>
                            <comment id="15252816" author="jira-bot" created="Thu, 21 Apr 2016 14:49:27 -0700">&lt;p&gt;Commit 2beccf469f9e07eb5a05fef9ec3f869d6da4008a in lucene-solr's branch refs/heads/branch_5x from Tomas Fernandez Lobbe&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=2beccf4" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=2beccf4&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8420" title="Date statistics: sumOfSquares overflows long" class="issue-link" data-issue-key="SOLR-8420"&gt;&lt;del&gt;SOLR-8420&lt;/del&gt;&lt;/a&gt;: Fix long overflow in sumOfSquares for Date statistics&lt;/p&gt;

&lt;p&gt;Casted operations to double. Changed the test to support a percentage error given the FUZZY flag in doubles&lt;/p&gt;</comment>
                            <comment id="15252869" author="jira-bot" created="Thu, 21 Apr 2016 15:14:54 -0700">&lt;p&gt;Commit f9acafbd917b7970b29f12e0c637612d2cd216f7 in lucene-solr's branch refs/heads/branch_5_5 from Tomas Fernandez Lobbe&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f9acafb" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f9acafb&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8420" title="Date statistics: sumOfSquares overflows long" class="issue-link" data-issue-key="SOLR-8420"&gt;&lt;del&gt;SOLR-8420&lt;/del&gt;&lt;/a&gt;: Fix long overflow in sumOfSquares for Date statistics&lt;/p&gt;

&lt;p&gt;Casted operations to double. Changed the test to support a percentage error given the FUZZY flag in doubles&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12789275" name="0001-Fix-overflow-in-date-statistics.patch" size="7995" author="tomsolr" created="Tue, 23 Feb 2016 12:17:58 -0700"/>
                            <attachment id="12778530" name="0001-Fix-overflow-in-date-statistics.patch" size="3918" author="tomsolr" created="Fri, 18 Dec 2015 11:00:03 -0700"/>
                            <attachment id="12777818" name="0001-Fix-overflow-in-date-statistics.patch" size="3641" author="tomsolr" created="Tue, 15 Dec 2015 13:20:54 -0700"/>
                            <attachment id="12789853" name="SOLR-8420.patch" size="8263" author="tomasflobbe" created="Wed, 24 Feb 2016 19:52:51 -0700"/>
                            <attachment id="12779138" name="StdDev.java" size="1314" author="tomsolr" created="Tue, 22 Dec 2015 15:01:44 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 23 Dec 2015 10:29:27 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2pxqf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8416] The collections create API should return after all replicas are active. </title>
                <link>https://issues.apache.org/jira/browse/SOLR-8416</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Currently the collection creation API returns once all cores are created. In large cluster the cores may not be alive for some period of time after cores are created. For any thing requested during that period, Solr appears unstable and can return failure. Therefore it's better  the collection creation API waits for all cores to become alive and returns after that.&lt;/p&gt;</description>
                <environment/>
        <key id="12921802">SOLR-8416</key>
            <summary>The collections create API should return after all replicas are active. </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="4" iconUrl="https://issues.apache.org/jira/images/icons/statuses/reopened.png" description="This issue was once resolved, but the resolution was deemed incorrect. From here issues are either marked assigned or resolved.">Reopened</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="markrmiller@gmail.com">Mark Miller</assignee>
                                    <reporter username="michael.sun">Michael Sun</reporter>
                        <labels>
                    </labels>
                <created>Mon, 14 Dec 2015 15:34:31 -0700</created>
                <updated>Mon, 9 May 2016 08:41:45 -0700</updated>
                                                            <fixVersion>5.5.1</fixVersion>
                    <fixVersion>6.0</fixVersion>
                    <fixVersion>master</fixVersion>
                                    <component>SolrCloud</component>
                        <due/>
                            <votes>1</votes>
                                    <watches>9</watches>
                                                                <comments>
                            <comment id="15060396" author="michael.sun" created="Wed, 16 Dec 2015 10:52:59 -0700">&lt;p&gt;A patch is uploaded. Here are some thoughts:&lt;/p&gt;

&lt;p&gt;1. The patch pulls shard status from zk and returns if they are all active during preset time or throw exception.  An alternative is to wait for zk notifications but I am not sure how much is the gain.&lt;br/&gt;
2. The total wait time should be configurable to fit large cluster. Is it good to be a solr config or collection config? It's more natural to be collection config but it may be easy for user if it's a solr config that can be set in CM.&lt;/p&gt;
</comment>
                            <comment id="15060419" author="markrmiller@gmail.com" created="Wed, 16 Dec 2015 10:59:39 -0700">&lt;p&gt;Thanks for the patch, a couple comments:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Usually it's better to use SolrException over RuntimeException&lt;/li&gt;
	&lt;li&gt;Where you catch the interrupted exception, you should restore the interrupted status.&lt;/li&gt;
	&lt;li&gt;The failure exception should probably give detail on which replicas were not found to be live and ACTIVE.&lt;/li&gt;
	&lt;li&gt;Should not use hard coded 'active' but the relevant constants.&lt;/li&gt;
	&lt;li&gt;Should probably check if the replicas node is listed under live nodes as well as if it's active?&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15060441" author="markrmiller@gmail.com" created="Wed, 16 Dec 2015 11:11:16 -0700">&lt;blockquote&gt;&lt;p&gt;1. The patch pulls shard status from zk and returns if they are all active during preset time or throw exception. An alternative is to wait for zk notifications but I am not sure how much is the gain.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I agree, the complication is probably not worth it.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;Is it good to be a solr config or collection config?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I would make it a solr config - we need that ease of use at least. Later, if someone wants to override per collection or something, we can look at adding that in a way that you can override.&lt;/p&gt;</comment>
                            <comment id="15060912" author="michael.sun" created="Wed, 16 Dec 2015 14:29:49 -0700">&lt;p&gt;Thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com" class="user-hover" rel="markrmiller@gmail.com"&gt;Mark Miller&lt;/a&gt; for reviewing.  &lt;/p&gt;</comment>
                            <comment id="15061258" author="gchanan" created="Wed, 16 Dec 2015 18:03:54 -0700">&lt;p&gt;The patch claims to be looking at all shards being active but is actually looking at all replicas being active, right?  It's also inconsistent with the other creation commands now, e.g. CREATESHARD/ADDREPLICA will return as soon as the replicas are created while this will wait until all the replicas are active.&lt;/p&gt;

&lt;p&gt;From a client perspective, what do you actually want?  I don't think it's that all replicas are active at one time; given a large enough cluster that can be unlikely.  Some possibilities:&lt;br/&gt;
1) all the replicas were able to become active (you'd have to track this separately)&lt;br/&gt;
2) the collection is "usable" from the client &amp;#8211; each shard has a leader that is live and active?&lt;/p&gt;</comment>
                            <comment id="15061272" author="michael.sun" created="Wed, 16 Dec 2015 18:20:28 -0700">&lt;blockquote&gt;&lt;p&gt;the collection is "usable" from the client  each shard has a leader that is live and active?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;From client perspective, the collection or cluster is usable if the leader is active. However if high load of indexing starts before all replica becomes active, I am not sure if there will be too much sync traffic once replica starts. &lt;/p&gt;</comment>
                            <comment id="15061287" author="markrmiller@gmail.com" created="Wed, 16 Dec 2015 18:32:15 -0700">&lt;p&gt;Yeah, the load is a good point. It's a lot harder to go active once a load is started. And you would hope that right after creating the collection, everything would actually be healthy, but I see Greg's point too. I've always wrestled a bit with these ideas when considering this feature. It's not easy to make everything happy.&lt;/p&gt;</comment>
                            <comment id="15061319" author="gchanan" created="Wed, 16 Dec 2015 19:03:06 -0700">&lt;p&gt;I'd see what hbase or other systems do.&lt;/p&gt;</comment>
                            <comment id="15061338" author="michael.sun" created="Wed, 16 Dec 2015 19:23:45 -0700">&lt;p&gt;Yeah. It's not easy to make tradeoff, in particular optimized for large cluster and high load like this. In addition to looking at other systems, another choice (which probably always works) is to add an option to allow user to decide if Solr should wait for all shard leaders to be active or all replicas at run time.&lt;/p&gt;

&lt;p&gt;The additional option need to be documented and adds a bit to the learning curve for users. But in general it won't create much burden since users usually are prepared to do some extra optimization for large cluster under high load. &lt;/p&gt;</comment>
                            <comment id="15062197" author="michael.sun" created="Thu, 17 Dec 2015 08:35:39 -0700">&lt;p&gt;Just upload an updated patch for discussion. Here is the changes&lt;/p&gt;

&lt;p&gt;1. add a property to set max wait time&lt;br/&gt;
2. add a property to decide if it waits for all shard leaders to be active or all replicas&lt;br/&gt;
3. fix issues in &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com" class="user-hover" rel="markrmiller@gmail.com"&gt;Mark Miller&lt;/a&gt;'s review except for the following one.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Should probably check if the replicas node is listed under live nodes as well as if it's active?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com" class="user-hover" rel="markrmiller@gmail.com"&gt;Mark Miller&lt;/a&gt; Can you give me more details about it? Thanks.&lt;/p&gt;</comment>
                            <comment id="15062370" author="markrmiller@gmail.com" created="Thu, 17 Dec 2015 10:19:18 -0700">&lt;blockquote&gt;&lt;p&gt;Should probably check if the replicas node is listed under live nodes as well as if it's active?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Can you give me more details about it?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;For technical reasons, the actual state of a replica is a combination of whether it's ephemeral live node exists in zookeeper and the state listed in the cluster state. We make a best effort on shutdown to publish DOWN for all the states, but it's simply best effort and crashes and other probably common things can mean any state is in the cluster state. You can really only count on it being an accurate state if you also check that the node is live. The ClusterState object has a helper method for this if I remember right. &lt;/p&gt;</comment>
                            <comment id="15062659" author="michael.sun" created="Thu, 17 Dec 2015 12:46:28 -0700">&lt;p&gt;Here is an updated patch which includes checking for live nodes. Thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com" class="user-hover" rel="markrmiller@gmail.com"&gt;Mark Miller&lt;/a&gt; for suggestion.&lt;/p&gt;</comment>
                            <comment id="15063934" author="markrmiller@gmail.com" created="Fri, 18 Dec 2015 06:13:55 -0700">&lt;p&gt;Thanks Michael,&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Looks like a bunch of imports were moved above the license header?&lt;/li&gt;
	&lt;li&gt;We probably want to use real solr.xml config for this. Or make it params for the collection create call with reasonable defaults. We generally only use system properties for kind of internal fail safe options we don't expect to really be used. I'd be fine with reasonable defaults that could be overridden per collection create call, but we could also allow the defaults to be configurable via solr.xml.
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
+    &lt;span class="code-object"&gt;Integer&lt;/span&gt; numRetries = &lt;span class="code-object"&gt;Integer&lt;/span&gt;.getInteger(&lt;span class="code-quote"&gt;"createCollectionWaitTimeTillActive"&lt;/span&gt;, 10);
+    &lt;span class="code-object"&gt;Boolean&lt;/span&gt; checkLeaderOnly = &lt;span class="code-object"&gt;Boolean&lt;/span&gt;.getBoolean(&lt;span class="code-quote"&gt;"createCollectionCheckLeaderActive"&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;We should handle the checked exceptions this might throw like we do in other spots rather than use a catch-all Exception. There should be plenty of code to reference where we handle keeper and interrupted exception and do the right thing for each.
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
+      &lt;span class="code-keyword"&gt;try&lt;/span&gt; {
+        zkStateReader.updateClusterState();
+        clusterState = zkStateReader.getClusterState();
+      }  &lt;span class="code-keyword"&gt;catch&lt;/span&gt; (Exception e) {
+        &lt;span class="code-keyword"&gt;throw&lt;/span&gt; &lt;span class="code-keyword"&gt;new&lt;/span&gt; SolrException(ErrorCode.SERVER_ERROR, &lt;span class="code-quote"&gt;"Can't connect to zk server"&lt;/span&gt;, e);
+      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;I'd probably combine the following into one IF statement:
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
+          &lt;span class="code-keyword"&gt;if&lt;/span&gt; (!clusterState.liveNodesContain(replica.getNodeName())) {
+            replicaNotAlive = replica.getCoreUrl();
+            nodeNotLive = replica.getNodeName();
+            &lt;span class="code-keyword"&gt;break&lt;/span&gt;;
+          }
+          &lt;span class="code-keyword"&gt;if&lt;/span&gt; (!state.equals(Replica.State.ACTIVE.toString())) {
+            replicaNotAlive = replica.getCoreUrl();
+            replicaState = state;
+            &lt;span class="code-keyword"&gt;break&lt;/span&gt;;
+          }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;Should probably restore interrupt status and throw a SolrException.
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
+      &lt;span class="code-keyword"&gt;try&lt;/span&gt; {
+        &lt;span class="code-object"&gt;Thread&lt;/span&gt;.sleep(1000);
+      } &lt;span class="code-keyword"&gt;catch&lt;/span&gt; (InterruptedException e) {
+        &lt;span class="code-object"&gt;Thread&lt;/span&gt;.currentThread().interrupt();
+      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;I'm not sure the return message is quite right. If a nodes state is not ACTIVE, it does not mean it's not Live. It can be DOWN and live or RECOVERING and Live, etc. A replica is either Live or not and then has a Live State if and only if it is Live.&lt;/li&gt;
	&lt;li&gt;Needs some tests.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15097315" author="michael.sun" created="Wed, 13 Jan 2016 16:56:57 -0700">&lt;p&gt;Thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com" class="user-hover" rel="markrmiller@gmail.com"&gt;Mark Miller&lt;/a&gt; for review. I made a patch with all fixes except for tests. Can you give me some suggestion about how to design test for it? I can add a verification in CollectionsAPIDistributedZkTest.createCollection()  to replace waitForRecoveriesToFinish(). But to test the patch completely, it seems to me that it requires injection of delays or failure in core creation which I didn't find a good way to do. &lt;/p&gt;</comment>
                            <comment id="15098194" author="markrmiller@gmail.com" created="Thu, 14 Jan 2016 07:47:33 -0700">&lt;blockquote&gt;&lt;p&gt;requires injection of delays or failure in core creation which I didn't find a good way to do&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This has been lacking in our test framework for a long time for a variety of reasons. I recently started working on something to inject faults though - we have to have it.&lt;/p&gt;

&lt;p&gt;Take a look at &lt;a href="https://github.com/apache/lucene-solr/blob/trunk/solr/core/src/java/org/apache/solr/util/TestInjection.java" class="external-link" rel="nofollow"&gt;https://github.com/apache/lucene-solr/blob/trunk/solr/core/src/java/org/apache/solr/util/TestInjection.java&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;We should use it carefully, and in the right places, but I think testing collection creation fail cases fits the bill.&lt;/p&gt;

&lt;p&gt;We use assertions to call the fault injection methods so that they cannot be called by mistake in production (Solr tests require assertions are on, and we don't properly support running with assertions on in production).&lt;/p&gt;</comment>
                            <comment id="15098800" author="michael.sun" created="Thu, 14 Jan 2016 13:35:48 -0700">&lt;p&gt;It's great you have been working on injection. I can use it as an example. Thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com" class="user-hover" rel="markrmiller@gmail.com"&gt;Mark Miller&lt;/a&gt; for suggestion.&lt;/p&gt;</comment>
                            <comment id="15102583" author="michael.sun" created="Fri, 15 Jan 2016 15:24:47 -0700">&lt;p&gt;Here is the patch with delay in core creation injected to simulate slow core creation or recovering situations in real world scenarios. Basically it extends the TestInjection.java to inject delay.&lt;/p&gt;

&lt;p&gt;The patch also clean up the code for configurations, exceptions and error messages.&lt;br/&gt;
cc &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com" class="user-hover" rel="markrmiller@gmail.com"&gt;Mark Miller&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15117617" author="markrmiller@gmail.com" created="Tue, 26 Jan 2016 10:42:40 -0700">&lt;p&gt;I have to spend a bit of time playing with this manually still, but latest patch looks great!&lt;/p&gt;</comment>
                            <comment id="15138097" author="markrmiller@gmail.com" created="Mon, 8 Feb 2016 17:21:15 -0700">&lt;p&gt;I've started making a few changes - all the tests were not yet consistently passing, and I had some thoughts about things we might improve.&lt;/p&gt;

&lt;p&gt;I'd still like to look at not waiting for replicas we know failed creating, but it's a little tricky.&lt;/p&gt;

&lt;p&gt;Here is my current progress attached.&lt;/p&gt;</comment>
                            <comment id="15139001" author="markrmiller@gmail.com" created="Tue, 9 Feb 2016 07:38:36 -0700">&lt;p&gt;Another patch, I think this is almost ready. I punted for now on making it not wait for specific failures (there are some annoying complications around error reporting atm), but I made some other improvements.&lt;/p&gt;</comment>
                            <comment id="15141508" author="michael.sun" created="Wed, 10 Feb 2016 12:37:52 -0700">&lt;p&gt;Ah yes, it makes sense to skip waiting for replicas to be alive for async calls or in case there is failure. &lt;/p&gt;

&lt;p&gt;One question, it uses both rsp.getException() and response.getResponse().get("exception"). Are they pointing to the same exception? Thanks.&lt;/p&gt;

&lt;p&gt;Also there seems a typo error that return is not included.&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
    &lt;span class="code-keyword"&gt;if&lt;/span&gt; (response.getResponse().get(&lt;span class="code-quote"&gt;"failure"&lt;/span&gt;) != &lt;span class="code-keyword"&gt;null&lt;/span&gt;) {
      &lt;span class="code-comment"&gt;// TODO: we should not wait &lt;span class="code-keyword"&gt;for&lt;/span&gt; Replicas we know failed
&lt;/span&gt;    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15141566" author="markrmiller@gmail.com" created="Wed, 10 Feb 2016 13:08:32 -0700">&lt;blockquote&gt;&lt;p&gt;Are they pointing to the same exception? &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;rsp.getException happens when the response is not code 200 okay - but the collections API works a little different in that sometimes it will put failures and exceptions in a call that returns 200 okay. We just check both cases.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Also there seems a typo error that return is not included.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Not waiting for individual replicas that did not create is left as a TODO there, we don't want to do anything yet.&lt;/p&gt;

&lt;p&gt;I also moved the waiting code to the CollectionsHandler. I think it's more efficient and 'safer' to pull the waiting out of the Overseer processing.&lt;/p&gt;

&lt;p&gt;I think we can commit this as a good start and use further JIRA's to make any improvements.&lt;/p&gt;</comment>
                            <comment id="15141911" author="michael.sun" created="Wed, 10 Feb 2016 16:08:47 -0700">&lt;p&gt;I see. Thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com" class="user-hover" rel="markrmiller@gmail.com"&gt;Mark Miller&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15154879" author="markrmiller@gmail.com" created="Fri, 19 Feb 2016 14:15:58 -0700">&lt;p&gt;For some reason the commit doesn't seem to have been tagged in JIRA. This is committed though. SHA:31437c9b43cf93128e284e278470a39b2012a6cb&lt;/p&gt;</comment>
                            <comment id="15154897" author="markrmiller@gmail.com" created="Fri, 19 Feb 2016 14:34:58 -0700">&lt;p&gt;Thanks Michael!&lt;/p&gt;</comment>
                            <comment id="15189832" author="erickerickson" created="Thu, 10 Mar 2016 12:39:38 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com" class="user-hover" rel="markrmiller@gmail.com"&gt;Mark Miller&lt;/a&gt; The fix version is just "master". I found the entry in CHANGES.txt in 6x and trunk, should 6x be added to the fix versions?&lt;/p&gt;</comment>
                            <comment id="15248578" author="anshumg" created="Tue, 19 Apr 2016 13:36:35 -0700">&lt;p&gt;Opening to back port for 5.5.1.&lt;/p&gt;</comment>
                            <comment id="15248865" author="jira-bot" created="Tue, 19 Apr 2016 16:06:08 -0700">&lt;p&gt;Commit a494ac95fc2c22004d89952f7262ceac8368b6c9 in lucene-solr's branch refs/heads/branch_5x from markrmiller&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=a494ac9" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=a494ac9&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8416" title="The collections create API should return after all replicas are active. " class="issue-link" data-issue-key="SOLR-8416"&gt;SOLR-8416&lt;/a&gt;: The collections create API should return after all replicas are active.&lt;/p&gt;</comment>
                            <comment id="15248931" author="jira-bot" created="Tue, 19 Apr 2016 16:37:02 -0700">&lt;p&gt;Commit 4c88ea5532c2e23d7b29ba88ce41e19f7c58e691 in lucene-solr's branch refs/heads/branch_5_5 from markrmiller&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=4c88ea5" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=4c88ea5&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8416" title="The collections create API should return after all replicas are active. " class="issue-link" data-issue-key="SOLR-8416"&gt;SOLR-8416&lt;/a&gt;: The collections create API should return after all replicas are active.&lt;/p&gt;</comment>
                            <comment id="15251837" author="markrmiller@gmail.com" created="Thu, 21 Apr 2016 05:43:57 -0700">&lt;blockquote&gt;&lt;p&gt;The fix version is just "master". I found the entry in CHANGES.txt in 6x and trunk, should 6x be added to the fix versions?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;master was supposed to be renamed to 6.&lt;/p&gt;</comment>
                            <comment id="15252030" author="anshumg" created="Thu, 21 Apr 2016 08:10:59 -0700">&lt;p&gt;Think you accidentally removed the 5.5.1 fix version &lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/smile.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt;. I had back ported this to be released with 5.5.1. I'll add that fix version back.&lt;/p&gt;</comment>
                            <comment id="15276523" author="stephlag" created="Mon, 9 May 2016 08:41:45 -0700">&lt;p&gt;Can you close the issue as it is commited on the 5.5 branch?&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12841998">SOLR-7745</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12787072" name="SOLR-8416.patch" size="23837" author="markrmiller@gmail.com" created="Tue, 9 Feb 2016 07:38:36 -0700"/>
                            <attachment id="12786961" name="SOLR-8416.patch" size="26037" author="markrmiller@gmail.com" created="Mon, 8 Feb 2016 17:21:15 -0700"/>
                            <attachment id="12782621" name="SOLR-8416.patch" size="18861" author="michael.sun" created="Fri, 15 Jan 2016 15:21:42 -0700"/>
                            <attachment id="12778319" name="SOLR-8416.patch" size="8660" author="michael.sun" created="Thu, 17 Dec 2015 12:44:52 -0700"/>
                            <attachment id="12778264" name="SOLR-8416.patch" size="8471" author="michael.sun" created="Thu, 17 Dec 2015 08:33:09 -0700"/>
                            <attachment id="12778050" name="SOLR-8416.patch" size="2301" author="michael.sun" created="Wed, 16 Dec 2015 10:51:05 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 16 Dec 2015 17:59:39 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 hours ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2pvq7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>

<item>
            <title>[SOLR-8409] Complex q param in Streaming Expression results in a bad query</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8409</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;When providing an expression like &lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
stream=search(people, fl=&lt;span class="code-quote"&gt;"id,first"&lt;/span&gt;, sort=&lt;span class="code-quote"&gt;"first asc"&lt;/span&gt;, q=&lt;span class="code-quote"&gt;"presentTitles:\"&lt;/span&gt;chief executive officer\&lt;span class="code-quote"&gt;" AND age:[36 TO *]"&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;the following error is seen.&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
no field name specified in query and no &lt;span class="code-keyword"&gt;default&lt;/span&gt; specified via 'df' param
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I believe the issue is related to the \" (escaped quotes) and the spaces in the q field. If I remove the spaces then the query returns results as expected (though I've yet to validate if those results are accurate).&lt;/p&gt;

&lt;p&gt;This requires some investigation to get down to the root cause. I would like to fix it before Solr 6 is cut.&lt;/p&gt;</description>
                <environment/>
        <key id="12921368">SOLR-8409</key>
            <summary>Complex q param in Streaming Expression results in a bad query</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dpgove">Dennis Gove</assignee>
                                    <reporter username="dpgove">Dennis Gove</reporter>
                        <labels>
                            <label>streaming</label>
                            <label>streaming_api</label>
                    </labels>
                <created>Fri, 11 Dec 2015 19:46:56 -0700</created>
                <updated>Tue, 19 Apr 2016 19:36:56 -0700</updated>
                            <resolved>Tue, 19 Apr 2016 19:36:56 -0700</resolved>
                                    <version>master</version>
                                    <fixVersion>6.0</fixVersion>
                    <fixVersion>master</fixVersion>
                                    <component>SolrJ</component>
                        <due/>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="15053981" author="dpgove" created="Fri, 11 Dec 2015 19:59:12 -0700">&lt;p&gt;I've been unable to replicate this in a unit test but have seen it in a fully packaged version of trunk. (ant package was run and then the tarball was unpacked).&lt;/p&gt;

&lt;p&gt;Differences between unit test and packaged version:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;unit test is using dynamic fields while packaged version is using static fields&lt;/li&gt;
	&lt;li&gt;unit test is not going through the StreamHandler&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15053995" author="joel.bernstein" created="Fri, 11 Dec 2015 20:15:48 -0700">&lt;p&gt;What does the query look like after the Streaming Expression been's parsed?&lt;/p&gt;</comment>
                            <comment id="15053998" author="dpgove" created="Fri, 11 Dec 2015 20:23:33 -0700">&lt;p&gt;It looks like this&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
presentTitles:\&lt;span class="code-quote"&gt;"chief executive officer\"&lt;/span&gt; AND age:[36 TO *]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I suspect that the \" is the culprit here because the streaming expression parser does not remove the \ before the quote. As such, and this is a hunch, I suspect that the query parser is seeing \" and not considering it a quote that is starting a phase but instead a quote that is just part of the string being searched.&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
chief executive officer
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I believe this can be fixed by adding logic into the expression parser that will transform \" into " and in fact I've written that code (very simple) but my lack of ability to replicate in a unit test is preventing me from ensuring the issue is actually fixed.&lt;/p&gt;</comment>
                            <comment id="15054004" author="dpgove" created="Fri, 11 Dec 2015 20:30:14 -0700">&lt;p&gt;Backing up my hunch is that if I change the q to be &lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
presentTitles:\&lt;span class="code-quote"&gt;"chief\"&lt;/span&gt; AND age:[36 TO *]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I get results back but  a very small subset of the results I would expect to get back.&lt;/p&gt;

&lt;p&gt;I've yet to visually verify the source data but I would guess that there is a record containing a field value&lt;br/&gt;
&amp;lt;presentTitles&amp;gt;"chief"&amp;lt;/presentTitles&amp;gt;&lt;/p&gt;

&lt;p&gt;I'll check for that the next time I'm looking into this (by Monday I suspect) but I'd wager that I'll find it. &lt;/p&gt;</comment>
                            <comment id="15056147" author="dpgove" created="Mon, 14 Dec 2015 08:47:44 -0700">&lt;p&gt;This patch &lt;b&gt;appears&lt;/b&gt; to fix the issues. Still am unable to replicate in a unit test but I have confirmed that the issue I was seeing in a packaged setup is fixed with this patch. &lt;/p&gt;

&lt;p&gt;I'll want to wait until I can get a replicated test before I commit this.&lt;/p&gt;</comment>
                            <comment id="15057921" author="dpgove" created="Tue, 15 Dec 2015 04:44:58 -0700">&lt;p&gt;Interestingly, if I leave the q param out entirely I don't see any raised exception. Also, if I leave out a field to filter on I also don't see any raised exception. I've confirmed the solrconfig-streaming.xml doesn't include either default q or df settings so I'd expect to see an exception in both of these cases.&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
search(collection1, fl=&lt;span class="code-quote"&gt;"id,a_s,a_i,a_f"&lt;/span&gt;, sort=&lt;span class="code-quote"&gt;"a_f asc, a_i asc"&lt;/span&gt;)
search(collection1, fl=&lt;span class="code-quote"&gt;"id,a_s,a_i,a_f"&lt;/span&gt;, sort=&lt;span class="code-quote"&gt;"a_f asc, a_i asc"&lt;/span&gt;, q=&lt;span class="code-quote"&gt;"foo"&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15057983" author="dpgove" created="Tue, 15 Dec 2015 05:31:25 -0700">&lt;p&gt;I take that back. The file schema-streaming.xml contains the default query field&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
&amp;lt;defaultSearchField&amp;gt;text&amp;lt;/defaultSearchField&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If I comment out that setting then I am able to replicate the failure described in this ticket - finally. I will create a couple valid tests replicating the issue and will commit the fix as soon as I can.&lt;/p&gt;</comment>
                            <comment id="15128297" author="joel.bernstein" created="Tue, 2 Feb 2016 07:15:13 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dpgove" class="user-hover" rel="dpgove"&gt;Dennis Gove&lt;/a&gt;, this looks like it's almost ready to go. Still shooting to get this in for 6.0?&lt;/p&gt;</comment>
                            <comment id="15129772" author="dpgove" created="Tue, 2 Feb 2016 21:40:36 -0700">&lt;p&gt;Yeah. Planning to commit tomorrow.&lt;/p&gt;</comment>
                            <comment id="15131494" author="dpgove" created="Wed, 3 Feb 2016 18:14:58 -0700">&lt;p&gt;This new patch ensures that escaped quotes in the parameters of a CloudSolrStream stream are properly re-escaped when converting back to a string expression. This is necessary for situations where the expression is passed off to workers.&lt;/p&gt;

&lt;p&gt;Note the comment in CloudSolrStream&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
      &lt;span class="code-comment"&gt;// SOLR-8409: This is a special &lt;span class="code-keyword"&gt;case&lt;/span&gt; where the params contain a " character
&lt;/span&gt;      &lt;span class="code-comment"&gt;// Do note that in any other BASE streams with parameters where a " might come into play
&lt;/span&gt;      &lt;span class="code-comment"&gt;// that &lt;span class="code-keyword"&gt;this&lt;/span&gt; same replacement needs to take place.
&lt;/span&gt;      value = value.replace(&lt;span class="code-quote"&gt;"\"&lt;/span&gt;&lt;span class="code-quote"&gt;", "&lt;/span&gt;\\\"");
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I hope that this comment is heeded if additional base streams dealing with solr params are ever added.&lt;/p&gt;</comment>
                            <comment id="15131563" author="joel.bernstein" created="Wed, 3 Feb 2016 19:02:55 -0700">&lt;p&gt;One thing to check is how the SQLHandler is handling quotes. All queries are quoted by default. The TupleStreams are first built through constructors but they are serialized to streaming expressions and sent to worker nodes. Somehow we never tripped this bug in that scenario. &lt;/p&gt;</comment>
                            <comment id="15131579" author="joel.bernstein" created="Wed, 3 Feb 2016 19:12:50 -0700">&lt;p&gt;Just tried to trip this bug with this test case:&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
params.put(CommonParams.QT, &lt;span class="code-quote"&gt;"/sql"&lt;/span&gt;);
      params.put(&lt;span class="code-quote"&gt;"numWorkers"&lt;/span&gt;, &lt;span class="code-quote"&gt;"2"&lt;/span&gt;);
      params.put(&lt;span class="code-quote"&gt;"stmt"&lt;/span&gt;, &lt;span class="code-quote"&gt;"select str_s, count(*), sum(field_i), min(field_i), max(field_i), avg(field_i) from collection1 where text='XXXX XXXX' group by str_s order by sum(field_i) asc limit 2"&lt;/span&gt;);

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This would have a query like this: text:"XXXX XXXX" which would be serialized and sent to workers. It works, so somehow the serialization was handling things. &lt;/p&gt;</comment>
                            <comment id="15131624" author="dpgove" created="Wed, 3 Feb 2016 19:52:33 -0700">&lt;p&gt;I believe if it were changed to &lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
text=&lt;span class="code-quote"&gt;"XXXX XXXX"&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;it would trip the failure. The issue is with double quotes because double quotes are used to wrap the parameter values. So a q param of&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
search(....., q=&lt;span class="code-quote"&gt;"text:\"&lt;/span&gt;XXXX XXXX\"", ..... )
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;would show the issue.&lt;/p&gt;

&lt;p&gt;The issue is that the q param given to Solr cannot include the \" and should instead include just the " around XXXX XXXX. So, to deal with that we have to replace \" with ". That then also requires that on the toExpression(...) we have to replace " with \".&lt;/p&gt;</comment>
                            <comment id="15131627" author="jira-bot" created="Wed, 3 Feb 2016 19:58:41 -0700">&lt;p&gt;Commit 3528cc32cb634137cf389beaa9ecdc2036588d96 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dpgove" class="user-hover" rel="dpgove"&gt;Dennis Gove&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3528cc3" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3528cc3&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8409" title="Complex q param in Streaming Expression results in a bad query" class="issue-link" data-issue-key="SOLR-8409"&gt;&lt;del&gt;SOLR-8409&lt;/del&gt;&lt;/a&gt;: Ensures that quotes in solr params (eg. q param) are properly handled&lt;/p&gt;</comment>
                            <comment id="15131660" author="joel.bernstein" created="Wed, 3 Feb 2016 20:33:54 -0700">&lt;p&gt;Ok this interesting. What's below is before this patch:&lt;/p&gt;

&lt;p&gt;I ran this test, which I expected to break because the parser would have trouble with quotes inside the quotes. I was surprised to find that it worked perfectly.&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
 expression = StreamExpressionParser.parse(&lt;span class="code-quote"&gt;"parallel(collection1,"&lt;/span&gt;
                                              + &lt;span class="code-quote"&gt;"rollup("&lt;/span&gt;
                                                + &lt;span class="code-quote"&gt;"search(collection1, q=\"&lt;/span&gt;a_s:(\&lt;span class="code-quote"&gt;"hello0\"&lt;/span&gt; OR \&lt;span class="code-quote"&gt;"hello3\"&lt;/span&gt; OR \&lt;span class="code-quote"&gt;"hello4\"&lt;/span&gt;)\&lt;span class="code-quote"&gt;", fl=\"&lt;/span&gt;a_s,a_i,a_f\&lt;span class="code-quote"&gt;", sort=\"&lt;/span&gt;a_s asc\&lt;span class="code-quote"&gt;", partitionKeys=\"&lt;/span&gt;a_s\&lt;span class="code-quote"&gt;"),"&lt;/span&gt;
                                                + &lt;span class="code-quote"&gt;"over=\"&lt;/span&gt;a_s\&lt;span class="code-quote"&gt;","&lt;/span&gt;
                                                + &lt;span class="code-quote"&gt;"sum(a_i),"&lt;/span&gt;
                                                + &lt;span class="code-quote"&gt;"sum(a_f),"&lt;/span&gt;
                                                + &lt;span class="code-quote"&gt;"min(a_i),"&lt;/span&gt;
                                                + &lt;span class="code-quote"&gt;"min(a_f),"&lt;/span&gt;
                                                + &lt;span class="code-quote"&gt;"max(a_i),"&lt;/span&gt;
                                                + &lt;span class="code-quote"&gt;"max(a_f),"&lt;/span&gt;
                                                + &lt;span class="code-quote"&gt;"avg(a_i),"&lt;/span&gt;
                                                + &lt;span class="code-quote"&gt;"avg(a_f),"&lt;/span&gt;
                                                + &lt;span class="code-quote"&gt;"count(*)"&lt;/span&gt;
                                              + &lt;span class="code-quote"&gt;"),"&lt;/span&gt;
                                              + &lt;span class="code-quote"&gt;"workers=\"&lt;/span&gt;2\&lt;span class="code-quote"&gt;", zkHost=\"&lt;/span&gt;&lt;span class="code-quote"&gt;"+zkServer.getZkAddress()+"&lt;/span&gt;\&lt;span class="code-quote"&gt;", sort=\"&lt;/span&gt;a_s asc\&lt;span class="code-quote"&gt;")"&lt;/span&gt;
                                              );
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Below is the what was sent to the workers. Notice the quotes are not escaped at all:&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
rollup(search(collection1,q=&lt;span class="code-quote"&gt;"a_s:("&lt;/span&gt;hello0&lt;span class="code-quote"&gt;" OR "&lt;/span&gt;hello3&lt;span class="code-quote"&gt;" OR "&lt;/span&gt;hello4&lt;span class="code-quote"&gt;")"&lt;/span&gt;,fl=&lt;span class="code-quote"&gt;"a_s,a_i,a_f"&lt;/span&gt;,sort=&lt;span class="code-quote"&gt;"a_s asc"&lt;/span&gt;,partitionKeys=a_s,zkHost=&lt;span class="code-quote"&gt;"127.0.0.1:52813/solr"&lt;/span&gt;),over=a_s,sum(a_i),sum(a_f),min(a_i),min(a_f),max(a_i),max(a_f),avg(a_i),avg(a_f),count(*))

rollup(search(collection1,q=&lt;span class="code-quote"&gt;"a_s:("&lt;/span&gt;hello0&lt;span class="code-quote"&gt;" OR "&lt;/span&gt;hello3&lt;span class="code-quote"&gt;" OR "&lt;/span&gt;hello4&lt;span class="code-quote"&gt;")"&lt;/span&gt;,fl=&lt;span class="code-quote"&gt;"a_s,a_i,a_f"&lt;/span&gt;,sort=&lt;span class="code-quote"&gt;"a_s asc"&lt;/span&gt;,partitionKeys=a_s,zkHost=&lt;span class="code-quote"&gt;"127.0.0.1:52813/solr"&lt;/span&gt;),over=a_s,sum(a_i),sum(a_f),min(a_i),min(a_f),max(a_i),max(a_f),avg(a_i),avg(a_f),count(*))
 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Below is what was sent from the workers to the shards. Notice that the query is correct. &lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
   [junit4]   2&amp;gt; 36804 INFO  (qtp1665513927-67) [n:127.0.0.1:52821_ c:collection1 s:shard2 r:core_node1 x:collection1] o.a.s.c.S.Request [collection1]  webapp= path=/select params={q=a_s:(&lt;span class="code-quote"&gt;"hello0"&lt;/span&gt;+OR+&lt;span class="code-quote"&gt;"hello3"&lt;/span&gt;+OR+&lt;span class="code-quote"&gt;"hello4"&lt;/span&gt;)&amp;amp;distrib=&lt;span class="code-keyword"&gt;false&lt;/span&gt;&amp;amp;fl=a_s,a_i,a_f&amp;amp;fq={!hash+workers%3D2+worker%3D0}&amp;amp;sort=a_s+asc&amp;amp;partitionKeys=a_s&amp;amp;wt=json&amp;amp;version=2.2} hits=3 status=0 QTime=1
   [junit4]   2&amp;gt; 36804 INFO  (qtp637545437-123) [n:127.0.0.1:52829_ c:collection1 s:shard2 r:core_node3 x:collection1] o.a.s.c.S.Request [collection1]  webapp= path=/select params={q=a_s:(&lt;span class="code-quote"&gt;"hello0"&lt;/span&gt;+OR+&lt;span class="code-quote"&gt;"hello3"&lt;/span&gt;+OR+&lt;span class="code-quote"&gt;"hello4"&lt;/span&gt;)&amp;amp;distrib=&lt;span class="code-keyword"&gt;false&lt;/span&gt;&amp;amp;fl=a_s,a_i,a_f&amp;amp;fq={!hash+workers%3D2+worker%3D1}&amp;amp;sort=a_s+asc&amp;amp;partitionKeys=a_s&amp;amp;wt=json&amp;amp;version=2.2} hits=3 status=0 QTime=1
   [junit4]   2&amp;gt; 36804 INFO  (qtp682745908-97) [n:127.0.0.1:52825_ c:collection1 s:shard1 r:core_node2 x:collection1] o.a.s.c.S.Request [collection1]  webapp= path=/select params={q=a_s:(&lt;span class="code-quote"&gt;"hello0"&lt;/span&gt;+OR+&lt;span class="code-quote"&gt;"hello3"&lt;/span&gt;+OR+&lt;span class="code-quote"&gt;"hello4"&lt;/span&gt;)&amp;amp;distrib=&lt;span class="code-keyword"&gt;false&lt;/span&gt;&amp;amp;fl=a_s,a_i,a_f&amp;amp;fq={!hash+workers%3D2+worker%3D1}&amp;amp;sort=a_s+asc&amp;amp;partitionKeys=a_s&amp;amp;wt=json&amp;amp;version=2.2} hits=1 status=0 QTime=0
   [junit4]   2&amp;gt; 36804 INFO  (qtp682745908-471) [n:127.0.0.1:52825_ c:collection1 s:shard1 r:core_node2 x:collection1] o.a.s.c.S.Request [collection1]  webapp= path=/select params={q=a_s:(&lt;span class="code-quote"&gt;"hello0"&lt;/span&gt;+OR+&lt;span class="code-quote"&gt;"hello3"&lt;/span&gt;+OR+&lt;span class="code-quote"&gt;"hello4"&lt;/span&gt;)&amp;amp;distrib=&lt;span class="code-keyword"&gt;false&lt;/span&gt;&amp;amp;fl=a_s,a_i,a_f&amp;amp;fq={!hash+workers%3D2+worker%3D0}&amp;amp;sort=a_s+asc&amp;amp;partitionKeys=a_s&amp;amp;wt=json&amp;amp;version=2.2} hits=3 status=0 QTime=0
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So it appears that the parser doesn't even need the quotes nested within quotes to be escaped. I'm assuming that's because it's splitting on the comma and the equals sign and then removing the outer quotes.&lt;/p&gt;
</comment>
                            <comment id="15131674" author="dpgove" created="Wed, 3 Feb 2016 20:46:51 -0700">&lt;p&gt;Try putting a space inside the quote for the q param. That is where I saw the failure that prompted this ticket. So&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
search(collection1, q=\&lt;span class="code-quote"&gt;"a_s:(\"&lt;/span&gt;hello0 hellospace\&lt;span class="code-quote"&gt;" OR \"&lt;/span&gt;hello3\&lt;span class="code-quote"&gt;" OR \"&lt;/span&gt;hello4\&lt;span class="code-quote"&gt;")\"&lt;/span&gt;, fl=\&lt;span class="code-quote"&gt;"a_s,a_i,a_f\"&lt;/span&gt;, sort=\&lt;span class="code-quote"&gt;"a_s asc\"&lt;/span&gt;, partitionKeys=\&lt;span class="code-quote"&gt;"a_s\"&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15132259" author="joel.bernstein" created="Thu, 4 Feb 2016 05:54:51 -0700">&lt;p&gt;It took me while to grasp this ticket because it's so hard to reproduce the exception. But I think I've got it now. Basically the instructions to users are:&lt;/p&gt;

&lt;p&gt;If you have to use quotes in your query then escape the quotes:&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
search(collection1, q=&lt;span class="code-quote"&gt;"blah \"&lt;/span&gt;stuff stuff\&lt;span class="code-quote"&gt;" blah"&lt;/span&gt;, ...)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I'll do some more testing with the SQLHandler to make sure everything is working properly with the quotes.&lt;/p&gt;</comment>
                            <comment id="15134470" author="jira-bot" created="Fri, 5 Feb 2016 10:02:14 -0700">&lt;p&gt;Commit 3528cc32cb634137cf389beaa9ecdc2036588d96 in lucene-solr's branch refs/heads/lucene-6997 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dpgove" class="user-hover" rel="dpgove"&gt;Dennis Gove&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3528cc3" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3528cc3&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8409" title="Complex q param in Streaming Expression results in a bad query" class="issue-link" data-issue-key="SOLR-8409"&gt;&lt;del&gt;SOLR-8409&lt;/del&gt;&lt;/a&gt;: Ensures that quotes in solr params (eg. q param) are properly handled&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12902422">SOLR-8125</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12786156" name="SOLR-8409.patch" size="5599" author="dpgove" created="Wed, 3 Feb 2016 18:14:58 -0700"/>
                            <attachment id="12777482" name="SOLR-8409.patch" size="972" author="dpgove" created="Mon, 14 Dec 2015 08:47:44 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 12 Dec 2015 03:15:48 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2pt2f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8377] Unnecessary for loop in ReplicaAssigner.tryAllPermutations()</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8377</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Unused for loop in ReplicaAssigner.tryAllPermutations().&lt;/p&gt;</description>
                <environment/>
        <key id="12919164">SOLR-8377</key>
            <summary>Unnecessary for loop in ReplicaAssigner.tryAllPermutations()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="noble.paul">Noble Paul</assignee>
                                    <reporter username="kelvin.tan">Kelvin Tan</reporter>
                        <labels>
                    </labels>
                <created>Fri, 4 Dec 2015 22:18:46 -0700</created>
                <updated>Mon, 22 Feb 2016 18:03:23 -0700</updated>
                            <resolved>Mon, 22 Feb 2016 18:03:23 -0700</resolved>
                                    <version>5.3</version>
                                    <fixVersion>6.0</fixVersion>
                                    <component>SolrCloud</component>
                        <due/>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="15042657" author="kelvin.tan" created="Fri, 4 Dec 2015 22:19:11 -0700">&lt;p&gt;Patch removing the loop in question.&lt;/p&gt;</comment>
                            <comment id="15158062" author="jira-bot" created="Mon, 22 Feb 2016 18:02:45 -0700">&lt;p&gt;Commit eb1f8e2409c56a915bf8b88c19b7f6f66823a7f9 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=eb1f8e2" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=eb1f8e2&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8377" title="Unnecessary for loop in ReplicaAssigner.tryAllPermutations()" class="issue-link" data-issue-key="SOLR-8377"&gt;&lt;del&gt;SOLR-8377&lt;/del&gt;&lt;/a&gt; removed an unnecessary for loop&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12775917" name="1.patch" size="1434" author="kelvin.tan" created="Fri, 4 Dec 2015 22:19:11 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 23 Feb 2016 01:02:45 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2pfzr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8375] ReplicaAssigner rejects valid positions</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8375</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;ReplicaAssigner rejects any position for which a rule does not return NODE_CAN_BE_ASSIGNED.&lt;/p&gt;

&lt;p&gt;However, if the rule's shard does not apply to the position's shard, Rule returns NOT_APPLICABLE. This is not taken into account, and thus valid rules are being rejected at the moment. &lt;/p&gt;

</description>
                <environment/>
        <key id="12919153">SOLR-8375</key>
            <summary>ReplicaAssigner rejects valid positions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="noble.paul">Noble Paul</assignee>
                                    <reporter username="kelvin.tan">Kelvin Tan</reporter>
                        <labels>
                    </labels>
                <created>Fri, 4 Dec 2015 19:05:18 -0700</created>
                <updated>Sun, 24 Apr 2016 06:24:04 -0700</updated>
                            <resolved>Thu, 21 Apr 2016 15:30:28 -0700</resolved>
                                    <version>5.3</version>
                                    <fixVersion>5.5.1</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>SolrCloud</component>
                        <due/>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="15042575" author="kelvin.tan" created="Fri, 4 Dec 2015 19:06:32 -0700">&lt;p&gt;Patch attached against trunk.&lt;/p&gt;</comment>
                            <comment id="15157927" author="noble.paul" created="Mon, 22 Feb 2016 16:17:33 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kelvin.tan" class="user-hover" rel="kelvin.tan"&gt;Kelvin Tan&lt;/a&gt; This fix looks fine . could you give me a rule+ state combination for a testcase?&lt;/p&gt;</comment>
                            <comment id="15173244" author="jira-bot" created="Mon, 29 Feb 2016 22:20:05 -0700">&lt;p&gt;Commit e44eebf39d62cb68e123c68ac94cecc700ae1087 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e44eebf" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e44eebf&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8375" title="ReplicaAssigner rejects valid positions" class="issue-link" data-issue-key="SOLR-8375"&gt;&lt;del&gt;SOLR-8375&lt;/del&gt;&lt;/a&gt;: ReplicaAssigner rejects valid nodes&lt;/p&gt;</comment>
                            <comment id="15174035" author="jira-bot" created="Tue, 1 Mar 2016 10:06:49 -0700">&lt;p&gt;Commit e44eebf39d62cb68e123c68ac94cecc700ae1087 in lucene-solr's branch refs/heads/jira/&lt;a href="https://issues.apache.org/jira/browse/SOLR-445" title="Update Handlers abort with bad documents" class="issue-link" data-issue-key="SOLR-445"&gt;&lt;del&gt;SOLR-445&lt;/del&gt;&lt;/a&gt; from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e44eebf" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e44eebf&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8375" title="ReplicaAssigner rejects valid positions" class="issue-link" data-issue-key="SOLR-8375"&gt;&lt;del&gt;SOLR-8375&lt;/del&gt;&lt;/a&gt;: ReplicaAssigner rejects valid nodes&lt;/p&gt;</comment>
                            <comment id="15252734" author="anshumg" created="Thu, 21 Apr 2016 14:05:40 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt; there's no fix version on this JIRA though there's a change log entry for 6.0. I'm back porting this for 5.5.1 so just wanted to be sure that it was missed accidentally and it's not something that's still open.&lt;br/&gt;
Can you confirm?&lt;/p&gt;</comment>
                            <comment id="15252818" author="jira-bot" created="Thu, 21 Apr 2016 14:49:29 -0700">&lt;p&gt;Commit 3c6ef10e9e3455fc5027a2f45b889dd1c025d055 in lucene-solr's branch refs/heads/branch_5x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3c6ef10" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3c6ef10&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8375" title="ReplicaAssigner rejects valid positions" class="issue-link" data-issue-key="SOLR-8375"&gt;&lt;del&gt;SOLR-8375&lt;/del&gt;&lt;/a&gt;: ReplicaAssigner rejects valid nodes&lt;/p&gt;</comment>
                            <comment id="15252871" author="jira-bot" created="Thu, 21 Apr 2016 15:14:56 -0700">&lt;p&gt;Commit 38156552730eb5865297f28f5660f5427c43d56a in lucene-solr's branch refs/heads/branch_5_5 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3815655" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3815655&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8375" title="ReplicaAssigner rejects valid positions" class="issue-link" data-issue-key="SOLR-8375"&gt;&lt;del&gt;SOLR-8375&lt;/del&gt;&lt;/a&gt;: ReplicaAssigner rejects valid nodes&lt;/p&gt;</comment>
                            <comment id="15255585" author="noble.paul" created="Sun, 24 Apr 2016 06:24:04 -0700">&lt;p&gt;It's fixed&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12789089" name="SOLR-8375.patch" size="1579" author="noble.paul" created="Mon, 22 Feb 2016 16:17:58 -0700"/>
                            <attachment id="12775899" name="patch.txt" size="1004" author="kelvin.tan" created="Fri, 4 Dec 2015 19:06:32 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 22 Feb 2016 23:17:33 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2pfxb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8285] Ensure the /export handler works with NULL field values.</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8285</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description/>
                <environment/>
        <key id="12912626">SOLR-8285</key>
            <summary>Ensure the /export handler works with NULL field values.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="10">Implemented</resolution>
                                        <assignee username="joel.bernstein">Joel Bernstein</assignee>
                                    <reporter username="erickerickson">Erick Erickson</reporter>
                        <labels>
                    </labels>
                <created>Thu, 12 Nov 2015 15:08:30 -0700</created>
                <updated>Sun, 31 Jan 2016 11:29:34 -0700</updated>
                            <resolved>Sun, 31 Jan 2016 11:29:34 -0700</resolved>
                                                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>1</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="15122335" author="joel.bernstein" created="Thu, 28 Jan 2016 14:27:11 -0700">&lt;p&gt;Patch with the first pass at handling nulls in both sort fields and the export field list.&lt;/p&gt;

&lt;p&gt;Null fields for strings and multi-value fields will be left off the record. Numeric nulls are sent as zero. &lt;/p&gt;

&lt;p&gt;Test are needed.&lt;/p&gt;</comment>
                            <comment id="15122393" author="joel.bernstein" created="Thu, 28 Jan 2016 15:08:13 -0700">&lt;p&gt;Patch with existing TestSortingResponseWriter tests passing. Some tests were adjusted to match the NULL format.&lt;/p&gt;</comment>
                            <comment id="15124408" author="joel.bernstein" created="Fri, 29 Jan 2016 16:08:39 -0700">&lt;p&gt;Added a testNulls() method to the StreamExpressionTest. The SortingResponseWriter test has some null testing built in also but it's much easier to test the /export handler through a Streaming Expression.&lt;/p&gt;

&lt;p&gt;Also we'll need a way to compare the behavior of nulls from both the /select handler and the /export handler to make sure we have something that works for the SQLHandler. The StreamExpressionTest is the right place to switch back and forth between the two handlers.&lt;/p&gt;

&lt;p&gt;More tests to come.&lt;/p&gt;</comment>
                            <comment id="15125443" author="jira-bot" created="Sun, 31 Jan 2016 11:27:40 -0700">&lt;p&gt;Commit e20820a04d1aff5ccde64b7183308454bda62fef in lucene-solr's branch refs/heads/master from jbernste&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e20820a" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e20820a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8285" title="Ensure the /export handler works with NULL field values." class="issue-link" data-issue-key="SOLR-8285"&gt;&lt;del&gt;SOLR-8285&lt;/del&gt;&lt;/a&gt;: Ensure the /export handler works with NULL field values&lt;/p&gt;</comment>
                            <comment id="15125444" author="jira-bot" created="Sun, 31 Jan 2016 11:27:41 -0700">&lt;p&gt;Commit 14a2c16ca4243e5f26b776639cb03ec5cefe3d2b in lucene-solr's branch refs/heads/master from jbernste&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=14a2c16ca" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=14a2c16ca&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8285" title="Ensure the /export handler works with NULL field values." class="issue-link" data-issue-key="SOLR-8285"&gt;&lt;del&gt;SOLR-8285&lt;/del&gt;&lt;/a&gt;: Update CHANGES.txt&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12913012">SOLR-8291</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12934811">SOLR-8613</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12902422">SOLR-8125</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12785280" name="SOLR-8285.patch" size="13238" author="joel.bernstein" created="Fri, 29 Jan 2016 16:08:39 -0700"/>
                            <attachment id="12785029" name="SOLR-8285.patch" size="10722" author="joel.bernstein" created="Thu, 28 Jan 2016 15:08:13 -0700"/>
                            <attachment id="12785026" name="SOLR-8285.patch" size="7583" author="joel.bernstein" created="Thu, 28 Jan 2016 14:27:11 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 28 Jan 2016 21:27:11 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2obqv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8220] Read field from docValues for non stored fields</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8220</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Many times a value will be both stored="true" and docValues="true" which requires redundant data to be stored on disk. Since reading from docValues is both efficient and a common practice (facets, analytics, streaming, etc), reading values from docValues when a stored version of the field does not exist would be a valuable disk usage optimization.&lt;/p&gt;

&lt;p&gt;The only caveat with this that I can see would be for multiValued fields as they would always be returned sorted in the docValues approach. I believe this is a fair compromise.&lt;/p&gt;

&lt;p&gt;I've done a rough implementation for this as a field transform, but I think it should live closer to where stored fields are loaded in the SolrIndexSearcher.&lt;/p&gt;

&lt;p&gt;Two open questions/observations:&lt;/p&gt;

&lt;p&gt;1) There doesn't seem to be a standard way to read values for docValues, facets, analytics, streaming, etc, all seem to be doing their own ways, perhaps some of this logic should be centralized.&lt;/p&gt;

&lt;p&gt;2) What will the API behavior be? (Below is my proposed implementation)&lt;br/&gt;
Parameters for fl:&lt;/p&gt;
&lt;ul class="alternate" type="square"&gt;
	&lt;li&gt;fl="docValueField"
	&lt;ul class="alternate" type="square"&gt;
		&lt;li&gt;return field from docValue if the field is not stored and in docValues, if the field is stored return it from stored fields&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;fl="*"
	&lt;ul class="alternate" type="square"&gt;
		&lt;li&gt;return only stored fields&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;fl="+"
	&lt;ul class="alternate" type="square"&gt;
		&lt;li&gt;return stored fields and docValue fields&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;2a - would be easiest implementation and might be sufficient for a first pass. 2b - is current behavior&lt;/p&gt;</description>
                <environment/>
        <key id="12908420">SOLR-8220</key>
            <summary>Read field from docValues for non stored fields</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="shalinmangar">Shalin Shekhar Mangar</assignee>
                                    <reporter username="k317h">Keith Laban</reporter>
                        <labels>
                    </labels>
                <created>Tue, 27 Oct 2015 18:25:41 -0700</created>
                <updated>Sat, 27 Feb 2016 01:31:56 -0700</updated>
                            <resolved>Sat, 27 Feb 2016 01:31:56 -0700</resolved>
                                                    <fixVersion>5.5</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>2</votes>
                                    <watches>12</watches>
                                                                <comments>
                            <comment id="14977537" author="erickerickson" created="Tue, 27 Oct 2015 18:33:38 -0700">&lt;p&gt;The only surprising behavior I see with this approach is that indexing 2.0 would return different values when returned from docValues and when returned from stored, the DV return might be something like 1.9999999999999999 or even 2.0000000000000 would be a "surprise".&lt;/p&gt;

&lt;p&gt;I'm not against the idea, just want this out there.&lt;/p&gt;

&lt;p&gt;And one side benefit that's not entirely obvious. In sharded situations, the first pass returns the candidate list ID and "sort criteria". The way it's written last I knew was it returned stored values, which required decompression because it gets the stored field. If all the sort fields were DV, then we wouldn't have to do this.&lt;/p&gt;

&lt;p&gt;This can't be the complete story since you can index but not store a sort field and distributed works, but it's one path I believe I've seen. It's an open question how to wire that in to standard search for a field that's stored, and a DV field.&lt;/p&gt;</comment>
                            <comment id="14977575" author="yseeley@gmail.com" created="Tue, 27 Oct 2015 19:11:52 -0700">&lt;blockquote&gt;&lt;p&gt;reading values from docValues when a stored version of the field does not exist would be a valuable disk usage optimization.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1, and I've heard a number of users request this.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;1) There doesn't seem to be a standard way to read values for docValues, facets, analytics, streaming, etc, all seem to be doing their own ways, perhaps some of this logic should be centralized.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;See ReturnFields / ResultContext, that's currently where stored field handling is centralized, and handles anywhere a field list (or pseudo-fields / transformers) is specified.&lt;/p&gt;

&lt;p&gt;+1 for 2a as a first pass.&lt;br/&gt;
For bonus points, prevent stored fields from being loaded at all when not needed.  This gets us a big step closer to having the normal request handler have the same performance as "/export".&lt;/p&gt;

&lt;p&gt;Looking beyond the first pass, it might be nice to use docValues as more of a first-class alternate "stored" mechanism, and consider them part of "*".  If for some reason it's desirable to treat some docValues fields as stored, and others not, we could introduce a flag on &amp;lt;field&amp;gt; in the schema.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The only caveat with this that I can see would be for multiValued fields as they would always be returned sorted in the docValues approach. I believe this is a fair compromise.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This shouldn't be much of a concern for approach 2a, but another future option would be to add explicit set types, and also implement list-type multi-valued docValues fields... prob using binary docValues under the covers).&lt;/p&gt;</comment>
                            <comment id="14977591" author="yseeley@gmail.com" created="Tue, 27 Oct 2015 19:17:16 -0700">&lt;blockquote&gt;&lt;p&gt;The way it's written last I knew was it returned stored values, which required decompression because it gets the stored field.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Right, we should change this (and this issue may handle that out-of-the-box, if we chose not to store the "id" field).&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;If all the sort fields were DV, then we wouldn't have to do this.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The sort field values returned in the first phase of distributed search aren't obtained from stored field values.&lt;/p&gt;</comment>
                            <comment id="14977592" author="erickerickson" created="Tue, 27 Oct 2015 19:17:47 -0700">&lt;p&gt;I'm not talking about sorting here. The sorting during scoring certainly uses DV values.&lt;/p&gt;

&lt;p&gt;Here's the sequence (two shards, no followers, rows=10, illustrating with just the action on shard2)&lt;br/&gt;
1&amp;gt; shard1 gets the incoming request&lt;br/&gt;
2&amp;gt; shard1 sends a sub-request for candidate top 10 to shard2&lt;br/&gt;
3&amp;gt; shard2 returns its candidate top 10 to shard1. This return packet has the top 10 doc IDs and sort criteria.&lt;br/&gt;
4&amp;gt;  shard1 combines the lists of candidate top 10 docs and picks the true top 10&lt;br/&gt;
5&amp;gt; shard1 asks shard2 for the docs that came from shard2 and made it into the sorted top 10 list.&lt;/p&gt;

&lt;p&gt;What I'm talking about is step &amp;lt;3&amp;gt;. Last I knew, this did not use the DV fields, but pulled the stored value thus decompressing. &lt;/p&gt;

&lt;p&gt;I'm not sure how this is resolved for fields that aren't stored, there must be a fallback. Or I'm missing something here, wouldn't be the first time. Maybe Yonik's idea of making DV fields more "first class citizens" would just take care of the issue entirely.&lt;/p&gt;</comment>
                            <comment id="14977601" author="erickerickson" created="Tue, 27 Oct 2015 19:26:54 -0700">&lt;p&gt;bq: The sort field values returned in the first phase of distributed search aren't obtained from stored field values.&lt;/p&gt;

&lt;p&gt;Thanks, I suspect I was inappropriately generalizing from the &amp;lt;uniqueKey&amp;gt;..... Which answers how sort values get returned from non-stored fields....&lt;/p&gt;

&lt;p&gt;I suspect that practically it doesn't matter since to get a single field you have to decompress a 16K block, so getting the ID to be fetched from the DV field should be a win...&lt;/p&gt;</comment>
                            <comment id="14977602" author="yseeley@gmail.com" created="Tue, 27 Oct 2015 19:27:33 -0700">&lt;blockquote&gt;&lt;p&gt;3&amp;gt; shard2 returns its candidate top 10 to shard1. This return packet has the top 10 doc IDs and sort criteria.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We currently pull the sort criteria from the field comparators implementing the sort:&lt;br/&gt;
&lt;a href="https://github.com/apache/lucene-solr/blob/trunk/solr/core/src/java/org/apache/solr/handler/component/QueryComponent.java#L638" class="external-link" rel="nofollow"&gt;https://github.com/apache/lucene-solr/blob/trunk/solr/core/src/java/org/apache/solr/handler/component/QueryComponent.java#L638&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14979837" author="dsmiley" created="Wed, 28 Oct 2015 22:22:50 -0700">&lt;p&gt;FYI I have a patch in &lt;a href="https://issues.apache.org/jira/browse/SOLR-5478" title="Speed-up distributed search with high rows param or deep paging by transforming docId&amp;#39;s to uniqueKey via memory docValues" class="issue-link" data-issue-key="SOLR-5478"&gt;SOLR-5478&lt;/a&gt;, and I've done it without patching Solr as well using a different technique.&lt;/p&gt;</comment>
                            <comment id="14980449" author="ichattopadhyaya" created="Thu, 29 Oct 2015 06:50:01 -0700">&lt;p&gt;+1 to doing this. I think this will be useful for &lt;a href="https://issues.apache.org/jira/browse/SOLR-5944" title="Support updates of numeric DocValues" class="issue-link" data-issue-key="SOLR-5944"&gt;SOLR-5944&lt;/a&gt;, and was anyway planning to split this functionality out into its own issue. Also, if we go forward with &amp;#95;version&amp;#95; field as docvalues field, then this becomes important. In current Solr, the way to read non-stored docValues fields is to use a function query, field(mydvfield). &lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=k317h" class="user-hover" rel="k317h"&gt;Keith Laban&lt;/a&gt; Are you planning to work on this / have a patch for this? If not, then I can give it a try and have &lt;a href="https://issues.apache.org/jira/browse/SOLR-5944" title="Support updates of numeric DocValues" class="issue-link" data-issue-key="SOLR-5944"&gt;SOLR-5944&lt;/a&gt; depend on it.&lt;/p&gt;</comment>
                            <comment id="14980479" author="yseeley@gmail.com" created="Thu, 29 Oct 2015 07:10:05 -0700">&lt;blockquote&gt;&lt;p&gt;+1 to doing this. I think this will be useful for &lt;a href="https://issues.apache.org/jira/browse/SOLR-5944" title="Support updates of numeric DocValues" class="issue-link" data-issue-key="SOLR-5944"&gt;SOLR-5944&lt;/a&gt;, and was anyway planning to split this functionality out into its own issue.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Ah, right, atomic updates needs this functionality as well if we are to allow docValues fields that aren't stored.&lt;br/&gt;
In that case I'll amend my previous comments around ResultContext... that's appropriate for decorating documents as they are being returned, but perhaps not low enough level for other use cases.&lt;/p&gt;

&lt;p&gt;edit: I'm basically agreeing with Keith's original observation - "I think it should live closer to where stored fields are loaded in the SolrIndexSearcher."&lt;/p&gt;</comment>
                            <comment id="14980731" author="k317h" created="Thu, 29 Oct 2015 09:34:05 -0700">&lt;p&gt;There are two approaches I can see:&lt;/p&gt;

&lt;p&gt;1) implement a new type of StoredFieldReader which is aware of field type (i.e. does it have docValues, is it stored). This reader would delegate between reading from docValues or the stored fields&lt;/p&gt;

&lt;p&gt;2) in the &lt;a href="https://github.com/apache/lucene-solr/blob/trunk/solr/core/src/java/org/apache/solr/search/SolrIndexSearcher.java#L736" class="external-link" rel="nofollow"&gt;SolrIndexSearcher.doc&lt;/a&gt; function do two passes. first pass to get stored fields, a second pass to get docValues. This can go a step further to make the SetNonLazyFieldSelector aware of docValues fields and instruct the the reader to not load fields which are known to be in docValues.&lt;/p&gt;


&lt;p&gt;thoughts?&lt;/p&gt;

&lt;p&gt;edit: Would approach number 2 effect how fields are loaded lazyily (LazyDocument)?&lt;/p&gt;</comment>
                            <comment id="15006212" author="k317h" created="Sun, 15 Nov 2015 21:16:49 -0700">&lt;p&gt;adding an initial attempt at this patch. What does everyone think about taking an approach like this?&lt;/p&gt;

&lt;p&gt;This patch will decorate a document with docValue values after the stored values have been read. For now it skips multivalued fields and only reads from docValues if FL is specified and the field is not stored.&lt;/p&gt;

&lt;p&gt;Some problems I noticed with this approach are:&lt;/p&gt;

&lt;p&gt;1) LazyDocument doesn't support a notion of loading from docValues, without&lt;br/&gt;
mucking around in there I can't see a way apply the docValues before caching&lt;br/&gt;
because of various FLs.&lt;/p&gt;

&lt;p&gt;2) There is no metadata (that I can find) stored for each document that says&lt;br/&gt;
whether it has an unstored docValue field, so efficiently loading docValues&lt;br/&gt;
fields based on FL=* would be difficult. The only possibly way right now is to&lt;br/&gt;
iterate over all schema fields looking for the viable docValue fields for each&lt;br/&gt;
matched document.&lt;/p&gt;

&lt;p&gt;3) More of a question: What kind of FieldType should be created when adding&lt;br/&gt;
these docValues to the document?&lt;/p&gt;


&lt;p&gt;I have an alternate patch that attempts to preload stored values from docValues&lt;br/&gt;
before handing over to the IndexReader.  Those fields are then skipped later&lt;br/&gt;
on.  It passes tests, but it's not a very elegent approach. And also has&lt;br/&gt;
its limitations; it only works when FL is specified and it wouldn't&lt;br/&gt;
work on the cached hit of the document if a field is loaded with LazyDocument.&lt;/p&gt;</comment>
                            <comment id="15006538" author="ichattopadhyaya" created="Mon, 16 Nov 2015 04:18:59 -0700">&lt;p&gt;Thanks for the patch, Keith. &lt;br/&gt;
I couldn't apply the patch. Is this based on trunk? I saw that SolrIndexSearcher.doc() method returns &lt;tt&gt;StoredDocument&lt;/tt&gt; on trunk, but it seems your patch assumes a &lt;tt&gt;Document&lt;/tt&gt;.&lt;br/&gt;
If this isn't based on trunk, can you please re-work the patch and update it to trunk? Also, an SVN patch would be easier for most developers to work with.&lt;/p&gt;</comment>
                            <comment id="15006551" author="ichattopadhyaya" created="Mon, 16 Nov 2015 04:33:52 -0700">&lt;p&gt;Updated your patch to trunk (svn) with no changes to your logic. I'll review it soon.&lt;/p&gt;</comment>
                            <comment id="15006669" author="yseeley@gmail.com" created="Mon, 16 Nov 2015 06:44:06 -0700">&lt;blockquote&gt;
&lt;p&gt;2) There is no metadata (that I can find) stored for each document that says&lt;br/&gt;
whether it has an unstored docValue field, so efficiently loading docValues&lt;br/&gt;
fields based on FL=* would be difficult.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;In SolrIndexSearcher there is&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
  &lt;span class="code-keyword"&gt;private&lt;/span&gt; &lt;span class="code-keyword"&gt;final&lt;/span&gt; FieldInfos fieldInfos;
  &lt;span class="code-keyword"&gt;private&lt;/span&gt; &lt;span class="code-keyword"&gt;final&lt;/span&gt; Collection&amp;lt;&lt;span class="code-object"&gt;String&lt;/span&gt;&amp;gt; fieldNames;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;That gives you the full set of fields actually in-use by the index.  Useful for dealing with dynamicFields, where the names aren't explicitly listed in the schema.&lt;/p&gt;

&lt;p&gt;In the future, perhaps we should have some meta-data about what fields each document contains.&lt;/p&gt;</comment>
                            <comment id="15007068" author="k317h" created="Mon, 16 Nov 2015 11:29:04 -0700">&lt;p&gt;Thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ichattopadhyaya" class="user-hover" rel="ichattopadhyaya"&gt;Ishan Chattopadhyaya&lt;/a&gt;, this is my first time submitting a patch. This was originally done against 5.3.1 in the future i'll submit it based on trunk. &lt;/p&gt;

&lt;p&gt;I also noticed that there is a bug in the patch I submited. &lt;/p&gt;

&lt;p&gt;The line which reads &lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
&lt;span class="code-keyword"&gt;if&lt;/span&gt;(&lt;span class="code-keyword"&gt;null&lt;/span&gt; == sf){
  &lt;span class="code-keyword"&gt;return&lt;/span&gt; doc;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;should be&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
&lt;span class="code-keyword"&gt;if&lt;/span&gt;(&lt;span class="code-keyword"&gt;null&lt;/span&gt; == sf){
  &lt;span class="code-keyword"&gt;continue&lt;/span&gt;;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yseeley%40gmail.com" class="user-hover" rel="yseeley@gmail.com"&gt;Yonik Seeley&lt;/a&gt; I think that we definitely need something like that. Currently CompressingStoredFieldsReader.visitDocument needs to visit the whole document in stored field to know which fields there are. Ideally we would 1) be able to avoid doing any work in stored fields if they can instead by read out of docValues. 2) have a mechanism for LazyDocument to know to read the lazy field from docValues instead of from stored fields. 3) know about values which aren't stored but should be read from docValues.&lt;/p&gt;</comment>
                            <comment id="15007091" author="yseeley@gmail.com" created="Mon, 16 Nov 2015 11:41:30 -0700">&lt;blockquote&gt;&lt;p&gt;1) be able to avoid doing any work in stored fields if they can instead by read out of docValues.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We should be able to do this optimization regardless?  For the fields requested, we can check the schema to see if they have docValues.&lt;/p&gt;</comment>
                            <comment id="15007093" author="k317h" created="Mon, 16 Nov 2015 11:43:15 -0700">&lt;p&gt;I'm talking more specifically about the "FL=*" scenario &lt;/p&gt;</comment>
                            <comment id="15007107" author="k317h" created="Mon, 16 Nov 2015 11:52:07 -0700">&lt;p&gt;And for the specified FL scenario, LazyDocument assumes all the possible fields have been accounted for in the document and the not yet loaded fields have a bit offset for quick access in the future. Right now there's no way to cache a partially loaded document unless the whole stored document is visited to pre populate the lazy field with the required information. &lt;/p&gt;</comment>
                            <comment id="15008058" author="ichattopadhyaya" created="Mon, 16 Nov 2015 22:06:46 -0700">&lt;p&gt;Here's an alternate patch (&lt;a href="https://issues.apache.org/jira/browse/SOLR-8220" title="Read field from docValues for non stored fields" class="issue-link" data-issue-key="SOLR-8220"&gt;&lt;del&gt;SOLR-8220&lt;/del&gt;&lt;/a&gt;-ishan.patch) for this functionality. Uses the same hooks that you've created, i.e. decorateDocValueFields(), and uses your unit tests.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Changed the handling of single valued dv fields to have less code,&lt;/li&gt;
	&lt;li&gt;Adds support for multivalued dv fields support,&lt;/li&gt;
	&lt;li&gt;In your patch, &lt;tt&gt;fl=*,mydvfield&lt;/tt&gt; wasn't working. Fixed this.&lt;/li&gt;
	&lt;li&gt;Added a &lt;tt&gt;~&lt;sub&gt;&lt;/tt&gt; glob, similar to &lt;tt&gt;*&lt;/tt&gt;. &lt;tt&gt;fl=&lt;/sub&gt;&lt;/tt&gt; here means: return all conventional stored fields and all non stored docvalues.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Some cleanup / refactoring and a few tests might be needed.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;1) be able to avoid doing any work in stored fields if they can instead by read out of docValues.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Good point, this optimization would be useful. Not done in this patch, though.&lt;/p&gt;</comment>
                            <comment id="15008090" author="ichattopadhyaya" created="Mon, 16 Nov 2015 22:37:21 -0700">&lt;p&gt;Updated last patch to use FieldInfos, since searcher.getSchema().getFields() doesn't have the dynamic fields. Modified the test to randomly test the &lt;tt&gt;fl&lt;/tt&gt; parameter with ~ or the dv field name itself.&lt;/p&gt;</comment>
                            <comment id="15008302" author="janhoy" created="Tue, 17 Nov 2015 01:55:09 -0700">&lt;p&gt;How about using &lt;tt&gt;fl=&amp;#42;&amp;#42;&lt;/tt&gt; as glob instead of &lt;tt&gt;&amp;#126;&lt;/tt&gt;? In Lucene, &lt;tt&gt;~&lt;/tt&gt; normally indicates fuzziness of some kind, while &lt;tt&gt;**&lt;/tt&gt; in ant lingo means all items recursively... Not important though &lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/smile.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt;&lt;/p&gt;</comment>
                            <comment id="15008382" author="ichattopadhyaya" created="Tue, 17 Nov 2015 02:41:58 -0700">&lt;p&gt;&lt;tt&gt;**&lt;/tt&gt; seems like a better idea than ~. I couldn't get + to work, as Keith suggested, I guess it was getting confused with a positive sign.&lt;/p&gt;</comment>
                            <comment id="15009100" author="ichattopadhyaya" created="Tue, 17 Nov 2015 10:38:33 -0700">&lt;p&gt;My patch causes a regression with score fields, I'll look into it in a while.&lt;/p&gt;</comment>
                            <comment id="15009192" author="k317h" created="Tue, 17 Nov 2015 11:29:35 -0700">&lt;p&gt;I see some potential issues here, mostly performance concerns:&lt;/p&gt;

&lt;p&gt;1)&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
  &lt;span class="code-keyword"&gt;if&lt;/span&gt; (wantsAllNonStoredDocValues) {
    Set&amp;lt;&lt;span class="code-object"&gt;String&lt;/span&gt;&amp;gt; dvFields = &lt;span class="code-keyword"&gt;new&lt;/span&gt; HashSet&amp;lt;&amp;gt;();
    &lt;span class="code-keyword"&gt;for&lt;/span&gt; (&lt;span class="code-object"&gt;int&lt;/span&gt; i=0; i&amp;lt;fieldInfos.size(); i++) {
      &lt;span class="code-keyword"&gt;if&lt;/span&gt; (fieldInfos.fieldInfo(i) != &lt;span class="code-keyword"&gt;null&lt;/span&gt; &amp;amp;&amp;amp; fieldInfos.fieldInfo(i).getDocValuesType() != DocValuesType.NONE) {
        dvFields.add(fieldInfos.fieldInfo(i).name);
      }
    }
    fields = dvFields;
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This could potentially be very expensive to compute for every singe field for ever single document and also add unnecessary GC pressure by creating new HashSet for all the fields for every single document.&lt;/p&gt;

&lt;p&gt;2) &lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
doc.getField(fieldName)==&lt;span class="code-keyword"&gt;null&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 

&lt;p&gt;the doc fields are a list so this will be O( n ) for each lookup.&lt;/p&gt;

&lt;p&gt;3) Re multivalued fields: doing introspection for every single value for field for every document is not fast.&lt;/p&gt;

&lt;p&gt;4) &lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
SchemaField schemaField = schema.getField(fieldName);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;this throws an exception if the field name is not in the schema (think typos in FL)&lt;/p&gt;

&lt;p&gt;5)&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
FunctionValues values = schemaField.getType().getValueSource(schemaField, &lt;span class="code-keyword"&gt;null&lt;/span&gt;).getValues(&lt;span class="code-keyword"&gt;null&lt;/span&gt;, getLeafReader().getContext());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This creates a whole bunch of new objects which could be slow and cause a lot of GC pressure, although it may not be an issue.&lt;/p&gt;


</comment>
                            <comment id="15011570" author="ichattopadhyaya" created="Wed, 18 Nov 2015 11:12:32 -0700">&lt;p&gt;Thanks for the review, Keith.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;1. &lt;span class="error"&gt;&amp;#91;...&amp;#93;&lt;/span&gt; This could potentially be very expensive to compute for every singe field for ever single document and also add unnecessary GC pressure by creating new HashSet for all the fields for every single document.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I was aware of this, and wanted to fix this as part of the "cleanup / refactoring" I promised.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;&lt;tt&gt;doc.getField(fieldName)==null&lt;/tt&gt; the doc fields are a list so this will be O( n ) for each lookup.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I used that to ensure we're not re-adding unstored docvalues a second time to the same document. This is necessary here so that we don't re-add such fields to a document was obtained from the documentCache and already has all unstored docvalues in it. I can create a set of fields inside the &lt;tt&gt;StoredDocument&lt;/tt&gt; class so that a hasField lookup can be speeded up. However, given that it is a Lucene class, I have left this be. Any suggestions?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;3) Re multivalued fields: doing introspection for every single value for field for every document is not fast.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think it shouldn't be a problem. In modern JVMs, the &lt;tt&gt;instanceof&lt;/tt&gt; has negligible cost. However, I will do it once per multivalued field in my next patch.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;4) &lt;tt&gt;SchemaField schemaField = schema.getField(fieldName);&lt;/tt&gt; this throws an exception if the field name is not in the schema (think typos in FL)&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;If it is a dynamic field, it will still work; a wrong field name won't work here. Shouldn't a wrong field name throw an exception, rather than silently dropping it? I am split either ways.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;This creates a whole bunch of new objects which could be slow and cause a lot of GC pressure, although it may not be an issue.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I think this creates at most only the value source object, which isn't too bad. Internally, it uses the docvalues API.&lt;/p&gt;</comment>
                            <comment id="15011760" author="k317h" created="Wed, 18 Nov 2015 12:29:49 -0700">&lt;blockquote&gt;&lt;p&gt;I used that to ensure we're not re-adding unstored docvalues a second time to the same document. This is necessary here so that we don't re-add such fields to a document was obtained from the documentCache and already has all unstored docvalues in it. I can create a set of fields inside the StoredDocument class so that a hasField lookup can be speeded up. However, given that it is a Lucene class, I have left this be. Any suggestions?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This shouldn't be an issue since the hook is called after caching is done. This could get really expensive if you are getting a few thousand documents that have hundreds of fields. I think the real issue is how do we cache this efficiently. I think that will require modifying LazyDocument, (see my comments above)&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;If it is a dynamic field, it will still work; a wrong field name won't work here. Shouldn't a wrong field name throw an exception, rather than silently dropping it? I am split either ways.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This is more a backwards compat thing. What is current behavior for stored fields?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I think this creates at most only the value source object, which isn't too bad. Internally, it uses the docvalues API.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;for a string field, getValueSource creates a new StrFieldSource and getValues creates a new DocTermsIndexDocValues. Both of these closures add overhead especially if you're doing this hundreds of times for thousands of documents&lt;/p&gt;
</comment>
                            <comment id="15011854" author="ichattopadhyaya" created="Wed, 18 Nov 2015 13:01:29 -0700">&lt;blockquote&gt;&lt;p&gt;This shouldn't be an issue since the hook is called after caching is done.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Even if this is called after the document has been added to the cache, this decorate() method changes the same doc object that has been added to the cache. And hence, next time the document is fetched from the cache, it will contain the previously decorated docvalues as part of the stored doc from the cache. &lt;/p&gt;

&lt;p&gt;I'll look at what it will take to modify the LazyDocument to make this work differently. Are you already looking into it, or have some thoughts around it?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Both of these closures add overhead especially if you're doing this hundreds of times for thousands of documents&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yes, that makes sense; I hadn't noticed the second object getting created. We should avoid this overhead if possible.&lt;/p&gt;</comment>
                            <comment id="15011884" author="yseeley@gmail.com" created="Wed, 18 Nov 2015 13:26:34 -0700">&lt;blockquote&gt;&lt;p&gt;Added a ~ glob, similar to *. fl= here means: return all conventional stored fields and all non stored docvalues.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Purely from an interface perspective (I haven't looked at the code), it feels like this should be transparent.&lt;br/&gt;
It would be nice to be able to transition from an indexed+stored field to an indexed+docValues field and not have any of the clients know/care.&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
fl=myfield  &lt;span class="code-comment"&gt;// returns from either stored or docValues
&lt;/span&gt;fl=*_i         &lt;span class="code-comment"&gt;// returns all stored or docValues fields ending in _i
&lt;/span&gt;fl=*            &lt;span class="code-comment"&gt;// returns all stored fields and all docValues fields that are not stored&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If there is a need to distinguish between docValues as an alternative to a stored field, and docValues as an implementation detail that you don't want to return to the user (say you transitioned from an indexed-only field to an indexed+docValues field  or docValues-only field), then we could introduce a field flag for the schema.&lt;br/&gt;
Something like includeInStored=true/false or asStored=true/false&lt;/p&gt;</comment>
                            <comment id="15011925" author="k317h" created="Wed, 18 Nov 2015 13:45:23 -0700">&lt;blockquote&gt;&lt;p&gt;If there is a need to distinguish between docValues as an alternative to a stored field&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think this would be the case only for multi valued fields at least until we had an alternative version of docValue multi valued preserving the original field (i.e. not sorted, not set) using something like BinaryDocValues underneath as you mentioned earlier. &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I'll look at what it will take to modify the LazyDocument to make this work differently. Are you already looking into it, or have some thoughts around it?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Doing this properly requires us to be able to know all the possibly docValue fields on a document upfront and a way for LazyDocument to be able to load the lazy field from doc values. &lt;/p&gt;

&lt;p&gt;A large goal of this should be to have the ability to skip reading stored fields altogether if the field requirement is fully satisfied by docValues. However I'm not sure if using docValues would be more efficient than stored fields when all the fields are being returned. &lt;/p&gt;</comment>
                            <comment id="15011950" author="yseeley@gmail.com" created="Wed, 18 Nov 2015 13:57:14 -0700">&lt;blockquote&gt;&lt;p&gt;I think this would be the case only for multi valued fields at least until we had an alternative version of docValue multi valued preserving the original field (i.e. not sorted, not set) using something like BinaryDocValues underneath as you mentioned earlier.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yup, I agree.  I think this is just a case of us having incomplete type support.  We need to distinguish between multiValued and setValued in general.&lt;/p&gt;</comment>
                            <comment id="15011981" author="ichattopadhyaya" created="Wed, 18 Nov 2015 14:15:48 -0700">&lt;p&gt;Updated patch. This has:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Now uses &lt;tt&gt;**&lt;/tt&gt; for returning all non-stored docvalues fields.&lt;/li&gt;
	&lt;li&gt;Using docvalues API directly for single valued fields (instead of valuesource api)&lt;/li&gt;
	&lt;li&gt;Few cleanups here and there.&lt;/li&gt;
&lt;/ul&gt;

</comment>
                            <comment id="15012035" author="ichattopadhyaya" created="Wed, 18 Nov 2015 14:34:30 -0700">&lt;blockquote&gt;&lt;p&gt;Purely from an interface perspective (I haven't looked at the code), it feels like this should be transparent.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;That makes sense, having &lt;tt&gt;*&lt;/tt&gt; return all stored and non-stored docvalues. &lt;/p&gt;</comment>
                            <comment id="15012076" author="yseeley@gmail.com" created="Wed, 18 Nov 2015 14:51:01 -0700">&lt;p&gt;The set of fields that have docValues and are not stored can be computed once per index snapshot (from the FieldInfos+schema).&lt;br/&gt;
There should be no performance impact if there are no un-stored docValues fields in use.&lt;/p&gt;</comment>
                            <comment id="15012103" author="ichattopadhyaya" created="Wed, 18 Nov 2015 14:55:56 -0700">&lt;blockquote&gt;&lt;p&gt;The set of fields that have docValues and are not stored can be computed once per index snapshot (from the FieldInfos+schema).&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;That is what I have done at the time of searcher creation (in SolrIndexSearcher's constructor) in my last patch. Does that sound fine?&lt;/p&gt;</comment>
                            <comment id="15012580" author="yseeley@gmail.com" created="Wed, 18 Nov 2015 18:45:14 -0700">&lt;blockquote&gt;&lt;p&gt;Does that sound fine?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yep.  Seems like we will only have a perf issue when we have many sparse un-stored docValue fields.  At that point it might make sense to have a separate docValues field that contains the list of fields for the document.  That can be saved for a future optimization though.&lt;/p&gt;</comment>
                            <comment id="15012633" author="erickerickson" created="Wed, 18 Nov 2015 19:14:02 -0700">&lt;p&gt;Given that stored values are compressed in 16k blocks and to return a single field from the stored data requires decompressing 16K, how much effect do LazyDocuments really have any more? I don't know, just askin'&lt;/p&gt;

&lt;p&gt;Since docValues avoids decompressing 16k per doc, disk seeks and the like I strongly suspect that it is vastly more efficient than getting the stored values. That's how Streaming Aggregation can return on 200k-400k docs/second.&lt;/p&gt;

&lt;p&gt;All that said, I suspect that there are negligible savings (or perhaps even costs) in mixing the two, i.e. if &lt;em&gt;any&lt;/em&gt; field to be returned is not DV, you might as well return all the fields from the stored data.&lt;/p&gt;

&lt;p&gt;Testing would tell though.&lt;/p&gt;</comment>
                            <comment id="15012754" author="k317h" created="Wed, 18 Nov 2015 21:11:23 -0700">&lt;p&gt;Added a patch based on &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ichattopadhyaya" class="user-hover" rel="ichattopadhyaya"&gt;Ishan Chattopadhyaya&lt;/a&gt; latest patch.&lt;br/&gt;
needs to be perf tested.&lt;/p&gt;

&lt;p&gt;Theoretical optimization, will skip reading from stored fields if all the requested fields are available in docValues. (changes mostly to DocStreamer)&lt;br/&gt;
Caveats being:&lt;/p&gt;
&lt;ul class="alternate" type="square"&gt;
	&lt;li&gt;Cannot optimize if any fields are multi valued.&lt;/li&gt;
	&lt;li&gt;Cannot optimize for * queries.&lt;/li&gt;
	&lt;li&gt;Does not cache the document (slower in the long run?)
	&lt;ul class="alternate" type="square"&gt;
		&lt;li&gt;How can we cache? using doc.getField, perhaps? or LazyDocument?&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15012778" author="k317h" created="Wed, 18 Nov 2015 21:34:20 -0700">&lt;p&gt;reformatted patch to be svn style and cleaned up code from last update&lt;/p&gt;</comment>
                            <comment id="15012795" author="ichattopadhyaya" created="Wed, 18 Nov 2015 21:55:22 -0700">&lt;blockquote&gt;&lt;p&gt;Caveats being:&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I think we can live with those caveats for now, and optimize later. A docValues fields containing list of other docValues fields sounds nice for a later optimization. Given that this is a functional improvement, as is, over what we have today (i.e. no ability to return nonstored docValues), we should carry on with it and optimize later to address those caveats.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Theoretical optimization, will skip reading from stored fields if all the requested fields are available in docValues. (changes mostly to DocStreamer)&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Sounds good. It would be interesting to perf test this to measure the performance gains with doing this.&lt;/p&gt;</comment>
                            <comment id="15012826" author="yseeley@gmail.com" created="Wed, 18 Nov 2015 22:24:48 -0700">&lt;p&gt;Back in the day, LazyField actually had a pointer directly into the index where the field value could be read.&lt;br/&gt;
That got remove from Lucene at some point, and was replaced with something just for compat sake IIRC that had an N^2 bug... doc was loaded on each lazy-field access, which Hoss found/fixed.  But that leaves less performance benefit to using LazyDocument.  On a quick look, it seems to load all lazy fields at once when the first lazy field is touched.  I guess these days it's more of a memory optimization than a performance one.&lt;/p&gt;

&lt;p&gt;Might be worth considering new approaches (we can break back compat in trunk for 6.0).&lt;br/&gt;
Or maybe subclass LazyDocument and do something different for docValues fields.&lt;/p&gt;</comment>
                            <comment id="15013356" author="ichattopadhyaya" created="Thu, 19 Nov 2015 04:14:53 -0700">&lt;p&gt;Updated the patch with a minor one line fix in the multi-valued string field case:&lt;/p&gt;
&lt;div class="preformatted panel" style="border-width: 1px;"&gt;&lt;div class="preformattedContent panelContent"&gt;
&lt;pre&gt;             doc.add(schemaField.getType().createField(schemaField, values.lookupOrd(i).utf8ToString(), 1f));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Fyi, since I had already copied over the multivalued fields support from &lt;a href="https://issues.apache.org/jira/browse/SOLR-8276" title="Atomic updates &amp;amp; RTG don&amp;#39;t work with non-stored docvalues" class="issue-link" data-issue-key="SOLR-8276"&gt;&lt;del&gt;SOLR-8276&lt;/del&gt;&lt;/a&gt; patch to this patch earlier, I've made &lt;a href="https://issues.apache.org/jira/browse/SOLR-8276" title="Atomic updates &amp;amp; RTG don&amp;#39;t work with non-stored docvalues" class="issue-link" data-issue-key="SOLR-8276"&gt;&lt;del&gt;SOLR-8276&lt;/del&gt;&lt;/a&gt; depend on this issue. So, if we fix this issue now, we'll be able to fix (a) search results with non stored docvalues, (b) RTG of documents containing non stored docvalues, (c) atomic updates of documents containing non stored docvalues (for updates to both regular fields as well as non stored docvalues). I will make &lt;a href="https://issues.apache.org/jira/browse/SOLR-5944" title="Support updates of numeric DocValues" class="issue-link" data-issue-key="SOLR-5944"&gt;SOLR-5944&lt;/a&gt; depend on this now, and update the patch there.&lt;/p&gt;</comment>
                            <comment id="15013542" author="k317h" created="Thu, 19 Nov 2015 06:33:16 -0700">&lt;p&gt;I'm not sure how this should be handled. &lt;/p&gt;

&lt;p&gt;&lt;a href="https://github.com/apache/lucene-solr/blob/trunk/lucene/core/src/java/org/apache/lucene/document/Field.java#L241" class="external-link" rel="nofollow"&gt;https://github.com/apache/lucene-solr/blob/trunk/lucene/core/src/java/org/apache/lucene/document/Field.java#L241&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;needs to be modified to&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
    &lt;span class="code-keyword"&gt;if&lt;/span&gt; (!type.stored() &amp;amp;&amp;amp; type.indexOptions() == IndexOptions.NONE &amp;amp;&amp;amp; type.docValuesType() != DocValuesType.NONE) {
      &lt;span class="code-keyword"&gt;throw&lt;/span&gt; &lt;span class="code-keyword"&gt;new&lt;/span&gt; IllegalArgumentException(&lt;span class="code-quote"&gt;"it doesn't make sense to have a field that "&lt;/span&gt;
        + &lt;span class="code-quote"&gt;"is neither indexed nor stored nor docValues"&lt;/span&gt;);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15013555" author="ichattopadhyaya" created="Thu, 19 Nov 2015 06:44:03 -0700">&lt;p&gt;I think you meant a &lt;tt&gt;type.docValuesType() == DocValuesType.NONE&lt;/tt&gt;. I agree, we should make the change.&lt;/p&gt;</comment>
                            <comment id="15013633" author="ichattopadhyaya" created="Thu, 19 Nov 2015 07:51:15 -0700">&lt;blockquote&gt;
&lt;div class="preformatted panel" style="border-width: 1px;"&gt;&lt;div class="preformattedContent panelContent"&gt;
&lt;pre&gt;fl=myfield  // returns from either stored or docValues
fl=*_i         // returns all stored or docValues fields ending in _i
fl=*            // returns all stored fields and all docValues fields that are not stored
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;
&lt;p&gt;This is a TODO. Also, need to add more tests around multivalued fields (here and in &lt;a href="https://issues.apache.org/jira/browse/SOLR-8276" title="Atomic updates &amp;amp; RTG don&amp;#39;t work with non-stored docvalues" class="issue-link" data-issue-key="SOLR-8276"&gt;&lt;del&gt;SOLR-8276&lt;/del&gt;&lt;/a&gt;).&lt;br/&gt;
As for LazyFields for non stored docvalues, I think it is an optimization that we can deal with later in a separate issue. Doing what we have in this patch itself is progress. If some committer can please take this forward, can we get this in for 5.4?&lt;br/&gt;
Keith, do you wish to tackle the above TODO (and other todo items)? If so, I will focus on &lt;a href="https://issues.apache.org/jira/browse/SOLR-5944" title="Support updates of numeric DocValues" class="issue-link" data-issue-key="SOLR-5944"&gt;SOLR-5944&lt;/a&gt; for now.&lt;/p&gt;</comment>
                            <comment id="15013699" author="k317h" created="Thu, 19 Nov 2015 08:28:52 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yseeley%40gmail.com" class="user-hover" rel="yseeley@gmail.com"&gt;Yonik Seeley&lt;/a&gt;: re. * vs **&lt;/p&gt;

&lt;p&gt;I'm all for using just one glob pattern &lt;tt&gt;*&lt;/tt&gt; for both doc values and stored, however I think its worth it to consider the philosophical implications on backwards compat. While it won't break anything it does introduce some unexpected behavior without much warning or a way to disable it.&lt;/p&gt;

&lt;p&gt;I propose we add a &lt;tt&gt;fl.wildcardDV=true&lt;/tt&gt; option to turn on this behavior in Solr 5x but enable it by default in 6. We can optionally later add a field type option where you can use docValues but not have the field returned in your result set. &lt;/p&gt;


&lt;p&gt;Ishan I can tackle those.&lt;/p&gt;

&lt;p&gt;Regarding my earlier update about modifying &lt;tt&gt;Field&lt;/tt&gt;, its doesn't seem as trivial as I originally thought as &lt;tt&gt;createField&lt;/tt&gt; doesn't set &lt;tt&gt;DocValuesType&lt;/tt&gt; there is a separate field that gets created for doc values after &lt;tt&gt;createField&lt;/tt&gt; is called for the first time. I'm not sure what the implications of modifying this behavior would be. I think it's ok to leave this limitation in for now.&lt;/p&gt;</comment>
                            <comment id="15013814" author="k317h" created="Thu, 19 Nov 2015 09:38:52 -0700">&lt;p&gt;Created &lt;a href="https://issues.apache.org/jira/browse/SOLR-8316" title="Allow a field to be stored=false indexed=false docValues=true" class="issue-link" data-issue-key="SOLR-8316"&gt;SOLR-8316&lt;/a&gt; for my last point&lt;/p&gt;</comment>
                            <comment id="15013915" author="yseeley@gmail.com" created="Thu, 19 Nov 2015 10:08:31 -0700">&lt;blockquote&gt;&lt;p&gt;I think you meant a type.docValuesType() == DocValuesType.NONE. I agree, we should make the change.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I don't think some of the Lucene folks want docValues modeled as stored fields at the Lucene level.&lt;/p&gt;

&lt;p&gt;One possible option is just move to something higher lievel like SolrDocument.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I propose we add a &lt;tt&gt;fl.wildcardDV=true&lt;/tt&gt; option to turn on this behavior in Solr 5x but enable it by default in 6.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;We could bump the schema number to change the default, and that would enable the folks on 5x to get transparent migration from stored fields to docValues if they want w/o having to change clients / query params.&lt;/p&gt;

&lt;p&gt;And if finer grained control is desirable, a schema field flag actAsStored=true (or whatever better name people come up with) could have it's default set differently based on the schema version.&lt;/p&gt;
</comment>
                            <comment id="15018489" author="ichattopadhyaya" created="Fri, 20 Nov 2015 11:42:01 -0700">&lt;blockquote&gt;
&lt;p&gt; We are adding fields retrieved from docValues by doing the following:&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
doc.add(schemaField.getType().createField(schemaField, sdv.get(docid).utf8ToString(), 1.0f));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;this &lt;tt&gt;createField&lt;/tt&gt; call is returning &lt;tt&gt;null&lt;/tt&gt; based on the code I wrote above. Perhaps we need to create fields differently, or change how &lt;tt&gt;createField&lt;/tt&gt; works.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;&lt;span class="error"&gt;&amp;#91;Referencing this comment from SOLR-8316&amp;#93;&lt;/span&gt;. Can we "decorate" the SolrDocument in DocStreamer instead of trying to do that with the StoredDocument from lucene? That will give us the benefits: (a) we won't need to fix &lt;a href="https://issues.apache.org/jira/browse/SOLR-8316" title="Allow a field to be stored=false indexed=false docValues=true" class="issue-link" data-issue-key="SOLR-8316"&gt;SOLR-8316&lt;/a&gt; (although I still don't understand how it affects the work here, since I thought the createField was doing its job and consequently the tests were passing. Maybe I'm missing something), (b) we can leave the StoredDocument as is, and not change it from under the document cache (which is probably an awkward thing with the current patch), (c) it has efficient containsKey(), if needed, so the linear &lt;tt&gt;O&amp;#40;n&amp;#41;&lt;/tt&gt; cost can be avoided. Though, point b will mean we won't need containsKey() anyway.&lt;br/&gt;
This also means that &lt;a href="https://issues.apache.org/jira/browse/SOLR-8276" title="Atomic updates &amp;amp; RTG don&amp;#39;t work with non-stored docvalues" class="issue-link" data-issue-key="SOLR-8276"&gt;&lt;del&gt;SOLR-8276&lt;/del&gt;&lt;/a&gt; will have to change, and there we will have to decorate a SolrInputDocument instead of a SolrDocument. &lt;br/&gt;
Keith, Yonik, what do you think?&lt;/p&gt;</comment>
                            <comment id="15018760" author="k317h" created="Fri, 20 Nov 2015 13:50:40 -0700">&lt;p&gt;It looks like calling &lt;tt&gt;createFields&lt;/tt&gt; instead actually creates both the fields we need. &lt;/p&gt;

&lt;p&gt;I was able to change decoration to something like this&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
SortedDocValues sdv = leafReader.getSortedDocValues(fieldName);
&lt;span class="code-keyword"&gt;for&lt;/span&gt;(StorableField s: schemaField.getType().createFields(schemaField, sdv.get(docid).utf8ToString(), 1.0f)) {
  &lt;span class="code-keyword"&gt;if&lt;/span&gt;(s != &lt;span class="code-keyword"&gt;null&lt;/span&gt;) doc.add(s);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;which makes the the SortedDocValueField get added to the document properly, but when trying to write the string value later on it doesn't write anything because the implementation in &lt;tt&gt;Field&lt;/tt&gt; doesn't know how to write a &lt;tt&gt;BytesRef&lt;/tt&gt;. We can override this is in &lt;tt&gt;SortedDocValueField&lt;/tt&gt; but all of that stuff is in lucene code. It looks like &lt;tt&gt;StrField#createFields&lt;/tt&gt; converts the string value to a &lt;tt&gt;BytesRef&lt;/tt&gt; for the constructors of the doc values fields.&lt;/p&gt;


&lt;p&gt;I'm still a bit confused how &lt;a href="https://issues.apache.org/jira/browse/SOLR-8276" title="Atomic updates &amp;amp; RTG don&amp;#39;t work with non-stored docvalues" class="issue-link" data-issue-key="SOLR-8276"&gt;&lt;del&gt;SOLR-8276&lt;/del&gt;&lt;/a&gt; works for you, i get a NPE when trying pull back the non-indexed/non-stored field in the current impl.&lt;/p&gt;</comment>
                            <comment id="15018805" author="ichattopadhyaya" created="Fri, 20 Nov 2015 14:14:08 -0700">&lt;blockquote&gt;&lt;p&gt;I'm still a bit confused how &lt;a href="https://issues.apache.org/jira/browse/SOLR-8276" title="Atomic updates &amp;amp; RTG don&amp;#39;t work with non-stored docvalues" class="issue-link" data-issue-key="SOLR-8276"&gt;&lt;del&gt;SOLR-8276&lt;/del&gt;&lt;/a&gt; works for you, i get a NPE when trying pull back the non-indexed/non-stored field in the current impl.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I added another document (id=4) to the test at &lt;a href="https://issues.apache.org/jira/browse/SOLR-8276" title="Atomic updates &amp;amp; RTG don&amp;#39;t work with non-stored docvalues" class="issue-link" data-issue-key="SOLR-8276"&gt;&lt;del&gt;SOLR-8276&lt;/del&gt;&lt;/a&gt;. I see no problems whatsoever with string dv fields (single valued), which internally uses SortedDocValues. The test passes fine. Also, the test at BasicFunctionalityTest works fine with the &lt;tt&gt;test_s_dvo&lt;/tt&gt; field. Both &lt;a href="https://issues.apache.org/jira/browse/SOLR-8276" title="Atomic updates &amp;amp; RTG don&amp;#39;t work with non-stored docvalues" class="issue-link" data-issue-key="SOLR-8276"&gt;&lt;del&gt;SOLR-8276&lt;/del&gt;&lt;/a&gt; and the latter test use the latest patch here. So, as per the tests, the createField seems to do its job. Am I missing something?&lt;/p&gt;

&lt;p&gt;However, beyond this point, should we avoid using the schemaField.getType().createField() for fields in the StoredDocument (lucene) and instead do this decoration on the SolrDocument which is created from this StoredDocument? (See my comment before this one). I can try to put together a strawman patch for this approach, if you suggest, to see if it works.&lt;/p&gt;</comment>
                            <comment id="15021333" author="k317h" created="Sun, 22 Nov 2015 18:32:04 -0700">&lt;p&gt;I changed &lt;tt&gt;decorateDocValueFields&lt;/tt&gt; to operate based on a &lt;tt&gt;SolrDocument&lt;/tt&gt; instead of a lucene &lt;tt&gt;StoredDocument&lt;/tt&gt; and no longer relies on createField (and it now works on non-stored/non-indexed fields). Also includes a test for the non-stored/non-indexed field type.&lt;/p&gt;

&lt;p&gt;In this patch I also removed code related to &lt;tt&gt;&amp;#42;&amp;#42;&lt;/tt&gt; in favor of &lt;tt&gt;*&lt;/tt&gt; for docValue related fields. Still TODO is to make this behavior only apply to a new schema version.&lt;/p&gt;</comment>
                            <comment id="15025584" author="ichattopadhyaya" created="Tue, 24 Nov 2015 15:31:34 -0700">&lt;p&gt;Updating the patch with the following changes:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Since this decorate method would be used from the RealTimeGetComponent as well, and there it will have to decorate a SolrInputDocument, I've changed the method to handle both a SolrDocument and SolrInputDocument, depending on what is sent in.&lt;/li&gt;
	&lt;li&gt;The BasicFunctionalityTest was failing for me since it depended on a field "test_s_dv", which didn't exist in the schema. I've added that to the schema.xml.&lt;/li&gt;
	&lt;li&gt;Added a javadoc for the decorate method.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Keith, please review. If you think these changes make sense, then I'll base &lt;a href="https://issues.apache.org/jira/browse/SOLR-8276" title="Atomic updates &amp;amp; RTG don&amp;#39;t work with non-stored docvalues" class="issue-link" data-issue-key="SOLR-8276"&gt;&lt;del&gt;SOLR-8276&lt;/del&gt;&lt;/a&gt; on this one. As you mentioned, the schema version check is still a TODO.&lt;/p&gt;</comment>
                            <comment id="15025652" author="ichattopadhyaya" created="Tue, 24 Nov 2015 16:06:41 -0700">&lt;p&gt;Just noticed, EnumFieldTest.testEnumSort() fails with the last patch (and the one before it) when the severity_dv is chosen as the enum field. I think we're handling the enum dv fields incorrectly.&lt;/p&gt;</comment>
                            <comment id="15025686" author="k317h" created="Tue, 24 Nov 2015 16:21:45 -0700">&lt;p&gt;I'm working on a separate patch which fixes EnumField, it also adds support for "*_dv" type queries. I'll take a look at merging your change in too. Do you think it would be worth adding an interface for SolrDocument and SolrInputDocument to implement which includes &lt;tt&gt;containsKey} and {{addField&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="15025770" author="ichattopadhyaya" created="Tue, 24 Nov 2015 17:06:42 -0700">&lt;p&gt;I was thinking of doing exactly that! &lt;a href="https://issues.apache.org/jira/browse/SOLR-8339" title="SolrDocument and SolrInputDocument should have a common interface" class="issue-link" data-issue-key="SOLR-8339"&gt;&lt;del&gt;SOLR-8339&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15028962" author="shalinmangar" created="Thu, 26 Nov 2015 08:11:35 -0700">&lt;p&gt;Guys, sorry for not paying attention to this earlier but on a quick reading through the comments and an offline conversation with Ishan, I want to point out a few things.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Theoretical optimization, will skip reading from stored fields if all the requested fields are available in docValues&lt;/p&gt;&lt;/blockquote&gt;

&lt;blockquote&gt;&lt;p&gt;I don't think some of the Lucene folks want docValues modeled as stored fields at the Lucene level.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;From a performance perspective, reading values from DocValues always (if they exist) can be horrible because each field access in docvalues may need a random disk seek, whereas, all stored fields for a document are kept together and need only 1 random seek and a sequential block read. That, and the fact that docvalues aren't in the document cache makes me think that we should not model docvalues as a stored field and treat them equivalently. At least not without supporting benchmarks.&lt;/p&gt;

&lt;p&gt;So my suggestion is that we not mix the two issues i.e. keep this issue focused on adding syntactic sugar to read field from doc values for non-stored fields in whatever ways proposed. By the way, this is already possible using the 'field' DocTransformer e.g. fl=field(my_dv_field)&lt;/p&gt;</comment>
                            <comment id="15029079" author="ichattopadhyaya" created="Thu, 26 Nov 2015 09:32:36 -0700">&lt;blockquote&gt;&lt;p&gt;So my suggestion is that we not mix the two issues&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I've created &lt;a href="https://issues.apache.org/jira/browse/SOLR-8344" title="Decide default when requested fields are both column and row stored." class="issue-link" data-issue-key="SOLR-8344"&gt;SOLR-8344&lt;/a&gt; to deal with that optimization of reading stored valued fields from docvalues, so that we can focus only on the non-stored dv case (which is a functionality improvement/new feature, as opposed to an optimization).&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;By the way, this is already possible using the 'field' DocTransformer e.g. fl=field(my_dv_field)&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Indeed. This currently doesn't work for multivalued fields.&lt;/p&gt;

&lt;p&gt;On a different note, if we are going to tackle only the non-stored docValues fields for now in this issue, does it now make sense to do this, &lt;b&gt;performance wise&lt;/b&gt;, at the DocTransformer instead of the SolrIndexSearcher? If done that way, the RTG and atomic updates for such non-stored dv fields will work if we also use a doctransformer after the searcher has returned the docs. &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yseeley%40gmail.com" class="user-hover" rel="yseeley@gmail.com"&gt;Yonik Seeley&lt;/a&gt;, &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickerickson" class="user-hover" rel="erickerickson"&gt;Erick Erickson&lt;/a&gt;, &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalinmangar" class="user-hover" rel="shalinmangar"&gt;Shalin Shekhar Mangar&lt;/a&gt; do you have any thoughts/recommendation, please?&lt;/p&gt;</comment>
                            <comment id="15031289" author="k317h" created="Sun, 29 Nov 2015 20:34:14 -0700">&lt;blockquote&gt;&lt;p&gt;From a performance perspective, reading values from DocValues always (if they exist) can be horrible because each field access in docvalues may need a random disk seek, whereas, all stored fields for a document are kept together and need only 1 random seek and a sequential block read.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I agree that reading values from DocValues always can be horrible, my line of thinking was that if you are asking for one or two fields from a large document and they are both dv and stored reading from dv would likely be much more efficient. It might make more sense to be able to get those values explicitly from docValues using the the transformer, or have some logic that can determine when it is more efficient. That should be discussed further in &lt;a href="https://issues.apache.org/jira/browse/SOLR-8344" title="Decide default when requested fields are both column and row stored." class="issue-link" data-issue-key="SOLR-8344"&gt;SOLR-8344&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;At this point the question that remains; should we move forward with these patches and move logic for retrieving dv fields to SolrIndexSearcher, leaving out &lt;tt&gt;&amp;#42;&lt;/tt&gt;, &lt;tt&gt;&amp;#42;&amp;#95;foo&lt;/tt&gt; and other &lt;em&gt;optimizations&lt;/em&gt; for now? i.e. retrieve fields by name, if they exist in dv, but are not stored.&lt;/p&gt;</comment>
                            <comment id="15031910" author="yseeley@gmail.com" created="Mon, 30 Nov 2015 08:07:49 -0700">&lt;blockquote&gt;&lt;p&gt;From a performance perspective, reading values from DocValues always (if they exist) can be horrible because each field access in docvalues may need a random disk seek, whereas, all stored fields for a document are kept together and need only 1 random seek and a sequential block read.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;A few points:&lt;/p&gt;
&lt;ul class="alternate" type="square"&gt;
	&lt;li&gt;stored fields also require decompression (more overhead)&lt;/li&gt;
	&lt;li&gt;use of stored fields and docvalues at the same time is less memory efficient - the stored fields will also take up needed disk cache (although hopefully the OS will figure out which it should cache more aggressively&lt;/li&gt;
	&lt;li&gt;presumably one has docvalues because they need to be used, and they need to be fast... i.e. they already need to be cached.&lt;/li&gt;
	&lt;li&gt;if one as a small set of fields that are normally retrieved, it seems like a win again.&lt;/li&gt;
	&lt;li&gt;a &lt;b&gt;very&lt;/b&gt; common case these days is that the entire index fits in memory.&lt;/li&gt;
	&lt;li&gt;we're in the SSD era, and multiple "seeks" will still be more expensive if not cached, but much less so (and less so over time as non-volatile storage keeps improving)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;It seems like this should be a big win for the common case, and the ability to reindex your data or change config and not have to change the clients is important IMO.  It's like being able to reindex a date to a trie-date and have the clients not care.  We can already reindex a field as docValues, and sort, facet, do analytics, without changing client requests.  Optimizations to field value retrieval (or optionally removing redundantly stored data) should be the same.&lt;/p&gt;</comment>
                            <comment id="15031935" author="shalinmangar" created="Mon, 30 Nov 2015 08:16:52 -0700">&lt;blockquote&gt;&lt;p&gt;It seems like this should be a big win for the common case, and the ability to reindex your data or change config and not have to change the clients is important IMO.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It sounds like you are arguing for a common way to access docvalues and stored fields using the 'fl' parameter. I'm +1 to that.&lt;/p&gt;

&lt;p&gt;But are you also arguing for always loading fields from docvalues even if they are stored?&lt;/p&gt;</comment>
                            <comment id="15032230" author="shalinmangar" created="Mon, 30 Nov 2015 11:40:47 -0700">&lt;blockquote&gt;&lt;p&gt;On a different note, if we are going to tackle only the non-stored docValues fields for now in this issue, does it now make sense to do this, performance wise, at the DocTransformer instead of the SolrIndexSearcher?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I don't think there's any difference performance-wise. Changes to DocStreamer should be enough as it is called only for writing the response and not the entire result-set.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;At this point the question that remains; should we move forward with these patches and move logic for retrieving dv fields to SolrIndexSearcher, leaving out *, *_foo and other optimizations for now? i.e. retrieve fields by name, if they exist in dv, but are not stored.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1 let's create a patch to retrieve fields by name, if they exist in dv, but are not stored. I also like Yonik's idea of bumping the schema version to have fl=* return all fields (stored + non-stored docvalues) in 5.x and to include both by default in trunk (6.x). So +1 to that as well.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;a very common case these days is that the entire index fits in memory.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I propose a middle ground. Let's use Lucene's spinning disk utility method and prefer docvalues if we detect a SSD and fallback to reading from stored fields otherwise. Let's discuss this optimization in &lt;a href="https://issues.apache.org/jira/browse/SOLR-8344" title="Decide default when requested fields are both column and row stored." class="issue-link" data-issue-key="SOLR-8344"&gt;SOLR-8344&lt;/a&gt; and keep the two issues separate.&lt;/p&gt;</comment>
                            <comment id="15033868" author="yseeley@gmail.com" created="Tue, 1 Dec 2015 08:29:52 -0700">&lt;blockquote&gt;&lt;p&gt;It sounds like you are arguing for a common way to access docvalues and stored fields using the 'fl' parameter. I'm +1 to that.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Ah, ok... I mis-read your previous comment of "i.e. keep this issue focused on adding syntactic sugar to read field from doc values for non-stored fields" as advocating for new syntax for "fl" to load from non-stored docValue fields.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Let's discuss this optimization in &lt;a href="https://issues.apache.org/jira/browse/SOLR-8344" title="Decide default when requested fields are both column and row stored." class="issue-link" data-issue-key="SOLR-8344"&gt;SOLR-8344&lt;/a&gt; and keep the two issues separate.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I didn't really see it as separate (it depends on how you look at it),  I see it more as, we have a new feature that treats docValues as "column-stored".  What should the default behavior be when all requested fields are both column-stored and row-stored? I think we can make progress + commit this issue separately, but should still come at &lt;a href="https://issues.apache.org/jira/browse/SOLR-8344" title="Decide default when requested fields are both column and row stored." class="issue-link" data-issue-key="SOLR-8344"&gt;SOLR-8344&lt;/a&gt; "fresh" (i.e. not put the burden of proof on one default more than the other).&lt;/p&gt;</comment>
                            <comment id="15033899" author="shalinmangar" created="Tue, 1 Dec 2015 08:46:04 -0700">&lt;p&gt;Agreed. Let's wrap this up. &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ichattopadhyaya" class="user-hover" rel="ichattopadhyaya"&gt;Ishan Chattopadhyaya&lt;/a&gt; or &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=k317h" class="user-hover" rel="k317h"&gt;Keith Laban&lt;/a&gt;, can one of you put up an updated patch? I can review and commit.&lt;/p&gt;</comment>
                            <comment id="15033903" author="ichattopadhyaya" created="Tue, 1 Dec 2015 08:46:55 -0700">&lt;p&gt;Updating the patch.&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Only tackles non-stored docvalues.&lt;/li&gt;
	&lt;li&gt;Depends on the refactoring performed at &lt;a href="https://issues.apache.org/jira/browse/SOLR-8339" title="SolrDocument and SolrInputDocument should have a common interface" class="issue-link" data-issue-key="SOLR-8339"&gt;&lt;del&gt;SOLR-8339&lt;/del&gt;&lt;/a&gt;.&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="15033926" author="k317h" created="Tue, 1 Dec 2015 08:54:16 -0700">&lt;p&gt;I found some issues with the way this patch works and have some updated tests in separate patch which I haven't uploaded, I need to clean it up a bit and can submit it tonight.&lt;/p&gt;

&lt;p&gt;One issues I found is that if a document doesn't have a field value for a dv field it will get an empty value in the response, we should probably check with in the doc value api for docs with field, to make sure that that document had a value. &lt;/p&gt;</comment>
                            <comment id="15033973" author="ichattopadhyaya" created="Tue, 1 Dec 2015 09:18:39 -0700">&lt;p&gt;Afaik, there's no way to discern if a singly valued non-stored dv field was added to the document or not, since a singly valued dv field either gets the value provided during the indexing or it picks up the default. Any suggestions how to deal with that?&lt;/p&gt;</comment>
                            <comment id="15034013" author="erickerickson" created="Tue, 1 Dec 2015 09:36:08 -0700">&lt;p&gt;Deleting, see discussion at &lt;a href="https://issues.apache.org/jira/browse/SOLR-8344" title="Decide default when requested fields are both column and row stored." class="issue-link" data-issue-key="SOLR-8344"&gt;SOLR-8344&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15034017" author="yseeley@gmail.com" created="Tue, 1 Dec 2015 09:36:57 -0700">&lt;p&gt;For strings, an ord of -1 is "missing"&lt;br/&gt;
For numerics, you can use DocValues.getDocsWithField();&lt;/p&gt;</comment>
                            <comment id="15034055" author="ichattopadhyaya" created="Tue, 1 Dec 2015 09:53:35 -0700">&lt;blockquote&gt;&lt;p&gt;have some updated tests in separate patch which I haven't uploaded, I need to clean it up a bit and can submit it tonight.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I've fixed the issue in this updated patch, thanks to Yonik's suggestion. Keith, looking forward to the tests.&lt;/p&gt;</comment>
                            <comment id="15035235" author="k317h" created="Tue, 1 Dec 2015 21:13:47 -0700">&lt;ul class="alternate" type="square"&gt;
	&lt;li&gt;Removed leaked in &lt;tt&gt;SolrBaseDocument&lt;/tt&gt; references&lt;/li&gt;
	&lt;li&gt;Fixed support for EnumField (single and multi valued)&lt;/li&gt;
	&lt;li&gt;Fixed support for &lt;tt&gt;*_i&lt;/tt&gt; type globs&lt;/li&gt;
	&lt;li&gt;Removed tests from &lt;tt&gt;BasicFuntionalityTests&lt;/tt&gt; and moved them to a new test class along with its own test schema.&lt;/li&gt;
	&lt;li&gt;Added more robust testing including multivalued field testing&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15035238" author="k317h" created="Tue, 1 Dec 2015 21:15:55 -0700">&lt;p&gt;This still needs work around bumping the schema version, this impl changes the default behavior for globs&lt;/p&gt;</comment>
                            <comment id="15035256" author="k317h" created="Tue, 1 Dec 2015 21:42:42 -0700">&lt;p&gt;Crushed one more bug with multivalued fields being added on docs without that value and a test for it&lt;/p&gt;</comment>
                            <comment id="15035288" author="k317h" created="Tue, 1 Dec 2015 22:13:01 -0700">&lt;p&gt;One more patch.. It looks like at some point the logic for &lt;tt&gt;onlyPseudoFields&lt;/tt&gt; was modified to something that may not work, so reverting that line back to the original.&lt;/p&gt;</comment>
                            <comment id="15035704" author="ichattopadhyaya" created="Wed, 2 Dec 2015 05:14:42 -0700">&lt;p&gt;Looks good, Keith. I was wondering why you chose to name the test file and the schema file as "TestStoredDocValues" and "schema-stored-docvalues.xml", whereas we are dealing with only non-stored docvalues in this issue?&lt;/p&gt;

&lt;p&gt;I've updated the patch to now check for the schema version to be &amp;gt;=1.6. Please review, and feel free to refactor further. We'll have to add a test (using a schema version &amp;lt; 1.6) to ensure backcompat behaviour is not broken.&lt;/p&gt;</comment>
                            <comment id="15035712" author="ichattopadhyaya" created="Wed, 2 Dec 2015 05:21:16 -0700">&lt;blockquote&gt;&lt;p&gt;Removed leaked in SolrBaseDocument references&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;The intention of using SolrDocumentBase, instead of SolrDocument, was so that &lt;a href="https://issues.apache.org/jira/browse/SOLR-8276" title="Atomic updates &amp;amp; RTG don&amp;#39;t work with non-stored docvalues" class="issue-link" data-issue-key="SOLR-8276"&gt;&lt;del&gt;SOLR-8276&lt;/del&gt;&lt;/a&gt; can use the same decorate method on a SolrInputDocument. I've re-added the SolrDocumentBase reference, which is implemented in &lt;a href="https://issues.apache.org/jira/browse/SOLR-8339" title="SolrDocument and SolrInputDocument should have a common interface" class="issue-link" data-issue-key="SOLR-8339"&gt;&lt;del&gt;SOLR-8339&lt;/del&gt;&lt;/a&gt;. Please apply &lt;a href="https://issues.apache.org/jira/browse/SOLR-8339" title="SolrDocument and SolrInputDocument should have a common interface" class="issue-link" data-issue-key="SOLR-8339"&gt;&lt;del&gt;SOLR-8339&lt;/del&gt;&lt;/a&gt; first, and then apply/work with this patch.&lt;/p&gt;</comment>
                            <comment id="15036165" author="ichattopadhyaya" created="Wed, 2 Dec 2015 10:16:04 -0700">&lt;blockquote&gt;&lt;p&gt;I've updated the patch to now check for the schema version to be &amp;gt;=1.6&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;In the patch, I did some clumsy &amp;gt;= check for a float. Would've been better to just check for &amp;gt; 1.5. I'll fix it with the next patch.&lt;br/&gt;
I'm working on bumping up the version of the schema for the out of the box configsets.&lt;/p&gt;</comment>
                            <comment id="15036219" author="ichattopadhyaya" created="Wed, 2 Dec 2015 10:38:17 -0700">&lt;blockquote&gt;&lt;p&gt;I've updated the patch to now check for the schema version to be &amp;gt;=1.6&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;As per an offline discussion with &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hossman" class="user-hover" rel="hossman"&gt;Hoss Man&lt;/a&gt;, he mentioned that in the past we've never tied runtime behaviour with specific schema versions. He suggested, as did Yonik above I think, that we use some attribute like docValueAsIfStored=true/false (with a default of false for previous schema versions).&lt;br/&gt;
I'll try to tackle this and update the patch, and drop the naive check for schema version.&lt;/p&gt;</comment>
                            <comment id="15036972" author="k317h" created="Wed, 2 Dec 2015 17:48:12 -0700">&lt;p&gt;My only concern is that we may have to add a flag for this and for whatever we decide in &lt;a href="https://issues.apache.org/jira/browse/SOLR-8344" title="Decide default when requested fields are both column and row stored." class="issue-link" data-issue-key="SOLR-8344"&gt;SOLR-8344&lt;/a&gt; which is just going to add to he confusion. Thoughts?&lt;/p&gt;</comment>
                            <comment id="15055436" author="ichattopadhyaya" created="Sun, 13 Dec 2015 22:37:27 -0700">&lt;p&gt;Updating the patch to bump the version up to 1.6.&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Renamed Keith's TestStoredDocValues to TestNonStoredDocValues. Renamed the corresponding schema file too.&lt;/li&gt;
	&lt;li&gt;Adds useDocValuesAsStored parameter (true/false) to schema file. It defaults to true &amp;gt;= 1.6 version of schema.&lt;/li&gt;
	&lt;li&gt;Changing all 1.5 version schema files (test and examples) to 1.6. This will help catch bugs/unexpected behaviour.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;The patch is failing a few tests with very poor error reporting. Here's a reproducible failure after applying this patch:&lt;br/&gt;
Test suite: TestManagedSchemaDynamicFieldResource, Seed: -Dtests.seed=C0DE559FF2A0799&lt;br/&gt;
Looking into the failure.&lt;/p&gt;</comment>
                            <comment id="15055523" author="ichattopadhyaya" created="Sun, 13 Dec 2015 23:48:25 -0700">&lt;blockquote&gt;
&lt;p&gt;The patch is failing a few tests with very poor error reporting. Here's a reproducible failure after applying this patch:&lt;br/&gt;
Test suite: TestManagedSchemaDynamicFieldResource, Seed: -Dtests.seed=C0DE559FF2A0799&lt;br/&gt;
Looking into the failure.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;It seems this test fails even without the patch. Filed &lt;a href="https://issues.apache.org/jira/browse/SOLR-8411" title="TestManagedSchemaDynamicFieldResource failing reproducibly" class="issue-link" data-issue-key="SOLR-8411"&gt;&lt;del&gt;SOLR-8411&lt;/del&gt;&lt;/a&gt; for this. However, with this patch, still 5-6 tests fail. But I've so far been unable to reproduce any of them.&lt;/p&gt;</comment>
                            <comment id="15056973" author="ichattopadhyaya" created="Mon, 14 Dec 2015 16:32:07 -0700">&lt;p&gt;It seems the failures on trunk were unrelated to this patch, and possibly related to the Jetty upgrade to 9.3. To verify this, I ported the patch to branch5x (attached the patch) and it passes all tests.&lt;/p&gt;

&lt;p&gt;TODO: Make sure managed schema can handle the newly added useDocValuesAsStored parameter in the schema (test for persistence across edits to managed schema).&lt;/p&gt;

&lt;p&gt;Apart from the TODO item, can &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=k317h" class="user-hover" rel="k317h"&gt;Keith Laban&lt;/a&gt; and &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalinmangar" class="user-hover" rel="shalinmangar"&gt;Shalin Shekhar Mangar&lt;/a&gt; please review the patch (the trunk one)?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;My only concern is that we may have to add a flag for this and for whatever we decide in &lt;a href="https://issues.apache.org/jira/browse/SOLR-8344" title="Decide default when requested fields are both column and row stored." class="issue-link" data-issue-key="SOLR-8344"&gt;SOLR-8344&lt;/a&gt; which is just going to add to he confusion. Thoughts?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I think the &lt;tt&gt;useDocValuesAsStored&lt;/tt&gt; parameter in the schema is generically named enough to be reused for &lt;a href="https://issues.apache.org/jira/browse/SOLR-8344" title="Decide default when requested fields are both column and row stored." class="issue-link" data-issue-key="SOLR-8344"&gt;SOLR-8344&lt;/a&gt;, if needed. For more fine-grained per-field control, we can introduce another parameter if needed. We can discuss that in &lt;a href="https://issues.apache.org/jira/browse/SOLR-8344" title="Decide default when requested fields are both column and row stored." class="issue-link" data-issue-key="SOLR-8344"&gt;SOLR-8344&lt;/a&gt; itself.&lt;/p&gt;</comment>
                            <comment id="15057310" author="ichattopadhyaya" created="Mon, 14 Dec 2015 21:07:04 -0700">&lt;p&gt;Updated the patch.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;TODO: Make sure managed schema can handle the newly added useDocValuesAsStored parameter in the schema (test for persistence across edits to managed schema).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Added support for writing back (persisting) of this flag when used with managed schema.&lt;/p&gt;</comment>
                            <comment id="15058168" author="shalinmangar" created="Tue, 15 Dec 2015 08:01:10 -0700">&lt;p&gt;Hi Ishan, you have misunderstood the "useDocValuesAsStored" parameter. It is supposed to be per-field and not on the entire schema so that you can selectively disable it on fields that you don't want to be treated as if they were stored.&lt;/p&gt;</comment>
                            <comment id="15061305" author="ichattopadhyaya" created="Wed, 16 Dec 2015 18:49:51 -0700">&lt;p&gt;Updated the patch to have the useDocValuesAsStored attribute on a per field basis (instead of being at schema's top level).&lt;/p&gt;</comment>
                            <comment id="15061581" author="shalinmangar" created="Wed, 16 Dec 2015 23:36:30 -0700">&lt;p&gt;Thanks Ishan.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;The SolrIndexSearcher.decorateDocValueFields method has a honourUseDVsAsStoredFlag which is always true. We can remove it?&lt;/li&gt;
	&lt;li&gt;Same for SolrIndexSearcher.getNonStoredDocValuesFieldNames?&lt;/li&gt;
	&lt;li&gt;The wantsAllFields flag added to SolrIndexSearcher.doc doesn't seem necessary. I guess it was added because the patch adds non stored doc values fields to the 'fnames' but if we can separate out stored fnames from the non-stored doc values to be returned then we can remove this param from both SolrIndexSearcher.doc and SolrIndexSearcher.getNonStoredDocValuesFieldNames&lt;/li&gt;
	&lt;li&gt;The pattern matching in the DocStreamer constructor makes a bit nervous. Where is the pattern matching done for current stored fields?&lt;/li&gt;
	&lt;li&gt;The conditional logic in SolrIndexSearcher.decorateDocValueFields for multi-valued fields is too complicated! Can we please simplify this?&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="15063717" author="ichattopadhyaya" created="Fri, 18 Dec 2015 02:01:09 -0700">&lt;p&gt;Thanks for your review, Shalin. I've updated the patch to address your suggestions.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The SolrIndexSearcher.decorateDocValueFields method has a honourUseDVsAsStoredFlag which is always true. We can remove it?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Same for SolrIndexSearcher.getNonStoredDocValuesFieldNames?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Refactored the decorateDocValues() a bit to not send in wantsAllFields flag to the method and to handle it at the DocsStreamer itself. Hence, now, the decorateDocValues() method takes in only the field names it needs to do anything about; the filtering for non-stored dvs is taken care of at DocsStreamer.next() itself. &lt;/p&gt;

&lt;p&gt;Since, for the &lt;tt&gt;fl=&amp;#42;&lt;/tt&gt; case, we need all non-stored DVs that have &lt;tt&gt;useDocValuesAsStored&lt;/tt&gt;=true, but for the general filtering case of &lt;tt&gt;fl=dv1,dv2&lt;/tt&gt; we need to filter using all non-stored DVs (irrespective of the useDocValuesAsStored flag), I've retained this true/false logic in the getNonStoredDocValuesFieldNames() method. Renamed that method, however, to call it &lt;tt&gt;getNonStoredDVs(boolean onlyUseDocValuesAsStored)&lt;/tt&gt; and added a clear javadoc to this effect.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;The wantsAllFields flag added to SolrIndexSearcher.doc doesn't seem necessary. I guess it was added because the patch adds non stored doc values fields to the 'fnames' but if we can separate out stored fnames from the non-stored doc values to be returned then we can remove this param from both SolrIndexSearcher.doc and SolrIndexSearcher.getNonStoredDocValuesFieldNames&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I think the original motivation was to deal with cases &lt;tt&gt;fl=&amp;#42;,nonstoredDv1&lt;/tt&gt;. Here, the idea initially was that &lt;tt&gt;&amp;#42;&lt;/tt&gt; returns all stored fields, and nonstoredDv1 is added to it. But now, since &lt;tt&gt;&amp;#42;&lt;/tt&gt; takes care of all stored and non-stored dvs, this logic isn't needed. So, this wantsAllFields flag was a left over from a previous patch which I've now removed.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The pattern matching in the DocStreamer constructor makes a bit nervous. Where is the pattern matching done for current stored fields?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Keith can weigh in on this better. However, I had a look, and found that responseWriters (e.g. JSONResponseWriter) get the whole SolrDocument at the &lt;tt&gt;writeSolrDocument()&lt;/tt&gt; method, from where it does the following call to drop fields it doesn't need:&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
    &lt;span class="code-keyword"&gt;for&lt;/span&gt; (&lt;span class="code-object"&gt;String&lt;/span&gt; fname : doc.getFieldNames()) {
      &lt;span class="code-keyword"&gt;if&lt;/span&gt; (returnFields!= &lt;span class="code-keyword"&gt;null&lt;/span&gt; &amp;amp;&amp;amp; !returnFields.wantsField(fname)) {
        &lt;span class="code-keyword"&gt;continue&lt;/span&gt;;
      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This wantsField() call uses wildcard handling.&lt;br/&gt;
So, reviewing this information, it seems like our handling of this at the DocsStreamer is fine here. It doesn't look costly to me, since it is performed only when fl has a pattern, and that pattern is checked against only non-stored DVs. Do you think there's something better that can be done which I'm missing?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The conditional logic in SolrIndexSearcher.decorateDocValueFields for multi-valued fields is too complicated! Can we please simplify this?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Made it simpler. &lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/smile.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt;&lt;/p&gt;</comment>
                            <comment id="15063741" author="ichattopadhyaya" created="Fri, 18 Dec 2015 02:16:23 -0700">&lt;p&gt;Btw, just found out that not all query paths actually use a DocsStreamer. I am checking as to what this could be down to.&lt;br/&gt;
EDIT: Sorry, I was seeing ghosts. Was trying this from the admin UI, but I hadn't set the breakpoint properly.&lt;/p&gt;</comment>
                            <comment id="15067566" author="erickerickson" created="Mon, 21 Dec 2015 22:14:50 -0700">&lt;p&gt;WARNING: I'm stealing this code and back-porting to 4.x for my own purposes so this may not pertain to 5x. And I'm not very up on the low-level details.&lt;/p&gt;

&lt;p&gt;But this loop for reading multiValued fields puts &lt;em&gt;all&lt;/em&gt; the multivalued fields for &lt;em&gt;all&lt;/em&gt; the docs on the shard into each doc:&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
&lt;span class="code-keyword"&gt;if&lt;/span&gt; (values != &lt;span class="code-keyword"&gt;null&lt;/span&gt; &amp;amp;&amp;amp; DocValues.getDocsWithField(atomicReader, fieldName).get(docid)) {
    values.setDocument(docid);
    &lt;span class="code-keyword"&gt;if&lt;/span&gt; (values.getValueCount() &amp;gt; 0) {
              List&amp;lt;&lt;span class="code-object"&gt;Object&lt;/span&gt;&amp;gt; outValues = &lt;span class="code-keyword"&gt;new&lt;/span&gt; LinkedList&amp;lt;&lt;span class="code-object"&gt;Object&lt;/span&gt;&amp;gt;();
              &lt;span class="code-keyword"&gt;for&lt;/span&gt; (&lt;span class="code-object"&gt;int&lt;/span&gt; i = 0; i &amp;lt; values.getValueCount(); i++) { &lt;span class="code-comment"&gt;// Iterates more than just &lt;span class="code-keyword"&gt;this&lt;/span&gt; doc, I think all of them!
&lt;/span&gt;        
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I had more luck with &lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
          &lt;span class="code-keyword"&gt;if&lt;/span&gt; (values != &lt;span class="code-keyword"&gt;null&lt;/span&gt;) {
            values.setDocument(docid);
            List&amp;lt;&lt;span class="code-object"&gt;Object&lt;/span&gt;&amp;gt; outValues = &lt;span class="code-keyword"&gt;new&lt;/span&gt; LinkedList&amp;lt;&lt;span class="code-object"&gt;Object&lt;/span&gt;&amp;gt;();
            &lt;span class="code-keyword"&gt;for&lt;/span&gt; (&lt;span class="code-object"&gt;int&lt;/span&gt; ord = (&lt;span class="code-object"&gt;int&lt;/span&gt;) values.nextOrd(); ord != SortedSetDocValues.NO_MORE_ORDS; ord = (&lt;span class="code-object"&gt;int&lt;/span&gt;) values.nextOrd()) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Note that I also think this is unnecessary in the if test, the loop above doesn't do anything bad if there are docs with empty fields: &lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
DocValues.getDocsWithField(atomicReader, fieldName).get(docid)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I changed it to just if (values != null). But I did have to test outValues.size() &amp;gt; 0  before doing the addField after the loop or I got empty braces in the output doc.&lt;/p&gt;

&lt;p&gt;Again let me emphasize that &lt;br/&gt;
1&amp;gt; I don't know this code well, so take this with a grain of salt&lt;br/&gt;
2&amp;gt; I needed this for a one-off on the 4.x code line and this may work with 5x just fine as-is. Needless to say what I'm doing will never make into the official project....&lt;/p&gt;

&lt;p&gt;But this saved me a TON of work, glad you're tackling this!&lt;/p&gt;</comment>
                            <comment id="15068027" author="shalinmangar" created="Tue, 22 Dec 2015 05:07:50 -0700">&lt;p&gt;Thanks Ishan.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Since, for the fl=* case, we need all non-stored DVs that have useDocValuesAsStored=true, but for the general filtering case of fl=dv1,dv2 we need to filter using all non-stored DVs (irrespective of the useDocValuesAsStored flag)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Okay I see what you are saying. The useDocValuesAsStored=true default applies when you request all fields but if you are explicitly asking for a field then we can return it from DVs even if it was marked as useDocValuesAsStored=false. I have mixed feelings about this but I can see where it can be useful e.g. 1st phase of distributed search.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;. However, I had a look, and found that responseWriters (e.g. JSONResponseWriter) get the whole SolrDocument at the writeSolrDocument() method, from where it does the following call to drop fields it doesn't need&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Hmm, yeah, we can't do that with doc values, it'd be too expensive.&lt;/p&gt;

&lt;p&gt;Is there a test which creates a new field with useDocValuesAsStored as true and separately as false using the schema API? I'm assuming you will address Erick's concern above about multi-valued fields.&lt;/p&gt;</comment>
                            <comment id="15068075" author="ichattopadhyaya" created="Tue, 22 Dec 2015 05:59:21 -0700">&lt;blockquote&gt;&lt;p&gt;Is there a test which creates a new field with useDocValuesAsStored as true and separately as false using the schema API?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I had added SchemaVersionSpecificBehaviorTest to test for these various true/false cases. However, there is no useDocValuesAsStored=false case with checking of output. I'll add such a test.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I'm assuming you will address Erick's concern above about multi-valued fields.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I'm working through them. So far as I can see, both the current loop with values.getValueCount() and what Erick suggested as a loop are running identically, i.e values.getValueCount() is indeed returning the count of values per document. But I am adding a test to prove it.&lt;/p&gt;

&lt;p&gt;For the &lt;tt&gt;DocValues.getDocsWithField(atomicReader, fieldName).get(docid)&lt;/tt&gt;, not having it was resulting in empty fields being returned for documents that weren't supposed to have an docValue (the user never added a docValue for that document during indexing). Again, I think I should add a specific test for that, testing for the number of fields returned (maybe there already is one from Keith, but I'll check again).&lt;/p&gt;</comment>
                            <comment id="15068319" author="erickerickson" created="Tue, 22 Dec 2015 09:10:29 -0700">&lt;p&gt;bq: For the DocValues.getDocsWithField(atomicReader, fieldName).get(docid), not having it was resulting in empty fields being returned for documents that weren't supposed to have an docValue (the user never added a docValue for that document during indexing).&lt;/p&gt;

&lt;p&gt;Right, I had to add a test at the end to avoid that. I didn't track the code thoroughly, but does the DocValues.getDocsWithField allocate a BitSet or just return a pre-existing instance? Or even cache the BitSet somewhere? If it allocates a new BitSet (or even fills up a cache entry), the test at the end might be much less expensive. I didn't track it down though, and if it returns a reference to a cached bitset that will be created &lt;em&gt;anyway&lt;/em&gt;, then it's just a style thing....&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
 &lt;span class="code-keyword"&gt;if&lt;/span&gt; (outValues.size() &amp;gt; 0) {
   sdoc.addField()....
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As for whether the loop returns all values in the field, I saw this "by inspection" on the techproducts example (with a few mods for adding docValues="true" to the schema). Again, though, this is 4.x after I hacked a backport and put it in an entirely different place in the code, specifically NOT a visitor pattern. So it's entirely possible that the semantics have changed or hacking it into a different part of the code base has a different context.  A test would settle it for all time though.&lt;/p&gt;</comment>
                            <comment id="15069706" author="ichattopadhyaya" created="Wed, 23 Dec 2015 08:02:23 -0700">&lt;p&gt;Added tests for the previous two scenarios.&lt;br/&gt;
@Erick, thanks for the catch, the values.getValueCount() wasn't working indeed, and only after adding the test for it could I catch it.&lt;/p&gt;

&lt;p&gt;Shalin, Erick, please review this latest patch. Thanks.&lt;/p&gt;</comment>
                            <comment id="15070052" author="ichattopadhyaya" created="Wed, 23 Dec 2015 12:06:35 -0700">&lt;blockquote&gt;&lt;p&gt;does the DocValues.getDocsWithField allocate a BitSet or just return a pre-existing instance&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;While I tried to track it down, I thought it is backed by a pre-existing bitset instance, as created at the leaf reader level. I didn't think it was a performance concern. Could someone confirm this understanding, please? Moreover, since Yonik suggested its use, I was more confident about using it.&lt;/p&gt;</comment>
                            <comment id="15070581" author="erickerickson" created="Wed, 23 Dec 2015 21:46:01 -0700">&lt;p&gt;LGTM as far as not returning all the DV values with each doc.&lt;/p&gt;
</comment>
                            <comment id="15071044" author="shalinmangar" created="Thu, 24 Dec 2015 07:12:32 -0700">&lt;p&gt;Changes:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;DocStreamer calculates dv fields to return in the constructor for every scenario instead of doing conditional logic and set intersection in next(). Also uses HashSet instead of Treeset (we don't care about order)&lt;/li&gt;
	&lt;li&gt;Renamed nonStoredDVs in SolrIndexSearcher to allNonStoredDVs&lt;/li&gt;
	&lt;li&gt;Added simple javadocs describing allNonStoredDVs and nonStoredDVsUsedAsStored&lt;/li&gt;
	&lt;li&gt;Reformatted new code according to the project code style&lt;/li&gt;
	&lt;li&gt;Fixed formatting in schema-nonstored-docvalues.xml which failed precommit (tabs instead of spaces)&lt;/li&gt;
	&lt;li&gt;Added a basic sanity test in TestUseDocValuesAsStored.testNonStoredDocValueFieldsOnEmptyIndex to assert that no exceptions are thrown on unknown fields with various fl combinations.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Ishan, can you please add a test which uses the schema API to add/modify a field with the useDocValuesAsStored parameter set to true (default), explicitly false and then true again?&lt;/p&gt;</comment>
                            <comment id="15071046" author="shalinmangar" created="Thu, 24 Dec 2015 07:13:21 -0700">&lt;p&gt;With the right patch this time.&lt;/p&gt;</comment>
                            <comment id="15071059" author="shalinmangar" created="Thu, 24 Dec 2015 07:33:49 -0700">&lt;ol&gt;
	&lt;li&gt;Added a null check in DocStreamer so that we do not try to decorate dv fields if none are required&lt;/li&gt;
	&lt;li&gt;Deletes all docs in testNonStoredDocValueFieldsOnEmptyIndex before running any test&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="15071193" author="erickerickson" created="Thu, 24 Dec 2015 12:09:32 -0700">&lt;p&gt;When we do the docs, we do need to include a warning about ordering. multiValued fields are returned in sorted order when returned from DV fields, not the original order, right?&lt;/p&gt;

&lt;p&gt;Up until now, we've promised that multiValued fields are returned in the same order they were inserted into the document so two MV fields can be treated like parallel arrays. This will &lt;em&gt;not&lt;/em&gt; be true of DV fields that are multiValued, correct?&lt;/p&gt;

&lt;p&gt;Suggested text would be something like:&lt;/p&gt;

&lt;p&gt;"Returning stored fields from docValues (default in schema versions 1.6+) returns multiValued fields in sorted order. If you require the older behavior of multiValued fields being returned in the original insertion order, set useDocValuesAsStored="false" for the individual fields or make sure your schema version is &amp;lt; 1.6. This does &lt;em&gt;not&lt;/em&gt; require re-indexing."&lt;/p&gt;
</comment>
                            <comment id="15071393" author="ichattopadhyaya" created="Fri, 25 Dec 2015 00:26:08 -0700">&lt;blockquote&gt;&lt;p&gt;Ishan, can you please add a test which uses the schema API to add/modify a field with the useDocValuesAsStored parameter set to true (default), explicitly false and then true again?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Added two extra tests:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;TestUseDocValuesAsStored.testManagedSchema() for testing with managed schema.&lt;/li&gt;
	&lt;li&gt;TestUseDocValuesAsStored2 suite for testing with Schema API.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Also, renamed the test methods in TestUseDocValuesAsStored to shorter/simpler names.&lt;/p&gt;</comment>
                            <comment id="15071395" author="ichattopadhyaya" created="Fri, 25 Dec 2015 00:35:44 -0700">&lt;p&gt;Erick, this patch (8220) returns DVs only for non-stored fields. So, before this change, the users had no way of returning their multivalued non-stored fields (even field() didn't work). However, your suggested text (as is) is spot on once we have this and 8344 in. &lt;/p&gt;

&lt;p&gt;For this issue, I think we should document this caveat to suggest that if insertion order for multivalued fields is important for you, then have your field stored=true (and that this work is not for you).&lt;/p&gt;</comment>
                            <comment id="15071421" author="shalinmangar" created="Fri, 25 Dec 2015 01:25:58 -0700">&lt;p&gt;Improved Ishan's new managed schema test to actually add documents and assert query responses in different scenarios.&lt;/p&gt;

&lt;p&gt;Just to recap, following is the behavior of "fl" with doc value fields with the latest patch:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;All doc value fields in schema version 1.6 are useDocValuesAsStored=true by default&lt;/li&gt;
	&lt;li&gt;fl=`*` will return all stored=true and useDocValuesAsStored=true fields&lt;/li&gt;
	&lt;li&gt;fl=`&lt;b&gt;,a1` will return all stored=true and useDocValuesAsStored=true fields. If the 'a1' field is useDocValuesAsStored=false then it will *NOT&lt;/b&gt; be returned even though it was explicitly asked for.&lt;/li&gt;
	&lt;li&gt;fl=`a*` will match the specified pattern against only stored=true and useDocValuesAsStored=true fields.&lt;/li&gt;
	&lt;li&gt;fl=`a1` will return a1 as long as it is stored=true or docValues=true (i.e. useDocValuesAsStored does not matter if a field is explicitly requested)&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="15071474" author="ichattopadhyaya" created="Fri, 25 Dec 2015 02:53:43 -0700">&lt;p&gt;Updating the patch:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;SolrIndexSearcher's getNonStoredDVs() method now returns unmodifiable sets of field names&lt;/li&gt;
	&lt;li&gt;Added another method in ReturnFields and SolrReturnFields which returns the additionally requested field names, irrespective of a wantsAll (&lt;tt&gt;&amp;#42;&lt;/tt&gt;) being present in the fl=. This is an overloaded getLuceneFieldNames() with a boolean parameter to "ignoreWantsAll". Is there something better we can name it to?&lt;/li&gt;
	&lt;li&gt;Now fl=*,a3 case also returns a3, irrespective of whether a3 has useDocValuesAsStored. (This change was made in DocsStreamer's constructor, under:
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
    &lt;span class="code-comment"&gt;// add non-stored DV fields that may have been requested
&lt;/span&gt;    &lt;span class="code-keyword"&gt;if&lt;/span&gt; (rctx.getReturnFields().wantsAllFields())  {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalinmangar" class="user-hover" rel="shalinmangar"&gt;Shalin Shekhar Mangar&lt;/a&gt; Please feel free to drop changes for points 2, 3, if you think this doesn't make sense from a usecase point of view.&lt;/p&gt;</comment>
                            <comment id="15071496" author="ichattopadhyaya" created="Fri, 25 Dec 2015 03:34:54 -0700">&lt;p&gt;Added a code comment to the previous patch. Plus very minor cleanup at DocsStreamer's constructor.&lt;/p&gt;</comment>
                            <comment id="15072092" author="shalinmangar" created="Sun, 27 Dec 2015 01:33:41 -0700">&lt;p&gt;Thanks Ishan.&lt;/p&gt;

&lt;p&gt;Changes:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Create unmodifiable map in SolrIndexSearcher's constructor so that we don't create unmodifiable instances on every call to SolrIndexSearcher.getNonStoredDVs&lt;/li&gt;
	&lt;li&gt;Fixed javadocs for ReturnFields.getLuceneFieldNames to note that it can return null even if ignoreWantsAll=true&lt;/li&gt;
	&lt;li&gt;Optimized field selection in DocsStreamer to create fewer objects. We iterate over requested field names and do intersection in the loop.&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="15072094" author="shalinmangar" created="Sun, 27 Dec 2015 02:00:18 -0700">&lt;ol&gt;
	&lt;li&gt;Removed extra license header in schema-non-stored-docvalues.xml which failed the parsing&lt;/li&gt;
	&lt;li&gt;Fixed the code comment in TestUseDocValuesAsStored2.java that is no longer valid now that we return useDocValuesAsStored=false field if they are explicitly requested in addition to all fields.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;I'll commit this shortly.&lt;/p&gt;</comment>
                            <comment id="15072112" author="ichattopadhyaya" created="Sun, 27 Dec 2015 03:04:42 -0700">&lt;p&gt;+1, LGTM.&lt;/p&gt;</comment>
                            <comment id="15072115" author="jira-bot" created="Sun, 27 Dec 2015 03:27:02 -0700">&lt;p&gt;Commit 1721795 from shalin@apache.org in branch 'dev/trunk'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1721795" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1721795&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8220" title="Read field from docValues for non stored fields" class="issue-link" data-issue-key="SOLR-8220"&gt;&lt;del&gt;SOLR-8220&lt;/del&gt;&lt;/a&gt;: Read field from DocValues for non stored fields&lt;/p&gt;</comment>
                            <comment id="15072116" author="ichattopadhyaya" created="Sun, 27 Dec 2015 03:49:13 -0700">&lt;p&gt;Thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalinmangar" class="user-hover" rel="shalinmangar"&gt;Shalin Shekhar Mangar&lt;/a&gt; for your commit, and Keith, Yonik and Erick for your inputs.&lt;/p&gt;

&lt;p&gt;I suggest we change:&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
+  Also note that returning stored fields from docValues (&lt;span class="code-keyword"&gt;default&lt;/span&gt; in schema versions 1.6+) returns multiValued
+  fields in sorted order. If you require the older behavior of multiValued fields being returned in the
+  original insertion order, set useDocValuesAsStored=&lt;span class="code-quote"&gt;"&lt;span class="code-keyword"&gt;false&lt;/span&gt;"&lt;/span&gt; &lt;span class="code-keyword"&gt;for&lt;/span&gt; the individual fields or make
+  sure your schema version is &amp;lt; 1.6. This does not require re-indexing.
+  See SOLR-8220 &lt;span class="code-keyword"&gt;for&lt;/span&gt; more details.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;to &lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
+  Also note that &lt;span class="code-keyword"&gt;while&lt;/span&gt; returning non-stored fields from docValues (&lt;span class="code-keyword"&gt;default&lt;/span&gt; in schema versions 1.6+, unless useDocValuesAsStored is &lt;span class="code-keyword"&gt;false&lt;/span&gt;), the values of a multi-valued
+  field are returned in sorted order. If you require the multi-valued fields to be returned in the
+  original insertion order, then make your multi-valued field as stored. This requires re-indexing.
+  See SOLR-8220 &lt;span class="code-keyword"&gt;for&lt;/span&gt; more details.
 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I think the first text block is relevant once &lt;a href="https://issues.apache.org/jira/browse/SOLR-8344" title="Decide default when requested fields are both column and row stored." class="issue-link" data-issue-key="SOLR-8344"&gt;SOLR-8344&lt;/a&gt; goes in. In this issue, we're just introducing new behaviour of returning non-stored values from DVs.&lt;/p&gt;</comment>
                            <comment id="15072140" author="jira-bot" created="Sun, 27 Dec 2015 05:35:31 -0700">&lt;p&gt;Commit 1721808 from shalin@apache.org in branch 'dev/trunk'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1721808" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1721808&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8220" title="Read field from docValues for non stored fields" class="issue-link" data-issue-key="SOLR-8220"&gt;&lt;del&gt;SOLR-8220&lt;/del&gt;&lt;/a&gt;: Improve upgrade notes in CHANGES.txt&lt;/p&gt;</comment>
                            <comment id="15072178" author="shalinmangar" created="Sun, 27 Dec 2015 09:11:46 -0700">&lt;p&gt;Patch for branch_5x.&lt;/p&gt;</comment>
                            <comment id="15072182" author="dsmiley" created="Sun, 27 Dec 2015 09:25:38 -0700">&lt;p&gt;I've been following this since inception with passing interest and wish I had the time this holiday to comment before Shalin committing.  Based on Shalin's summary a couple days ago, &lt;tt&gt;fl=&amp;#42;&lt;/tt&gt; will return these doc-values only fields that have useDocValuesAsStored=true, and it will be true by default going forward.  My only concern with this is that it's common-place to index an original input value of text 2 ways &amp;#8211; one for keyword search (marked stored as well), and another copyField target that isn't stored, isn't indexed, but has docValues for faceting or sorting.  Now, this value will be returned twice from &lt;tt&gt;fl=&amp;#42;&lt;/tt&gt;.  Granted the user could set useDocValuesAsStored=false on these fields, and that's not a big deal to do so nor a big deal to forget to do so.  Is this not lost on Ishan &amp;amp; Shalin who are putting the work into this issue or is this just a recognized trade-off?  It didn't have to be this way.  It could have designed such that &lt;tt&gt;fl=&amp;#42;&lt;/tt&gt; is only for stored fields and those &lt;em&gt;explicitly&lt;/em&gt; setting useDocValuesAsStored=true.&lt;/p&gt;</comment>
                            <comment id="15072185" author="ichattopadhyaya" created="Sun, 27 Dec 2015 09:46:33 -0700">&lt;p&gt;David, do you think having the copyField targets to have useDocValuesAsStored as false in our example schemas partly alleviates the problem? &lt;/p&gt;

&lt;p&gt;In fact, I was planning to open another issue to add a few more dynamic field types that have stored=false, docValues=true in the example schemas. I can add this change to copyFields too, if it makes sense.&lt;/p&gt;

&lt;p&gt;Or, rather, do you prefer useDocValuesAsStored to be false by default and turned on on-demand? I think that will make adoption harder, and make it harder for us (or iow more of an abrupt change for user) to get rid of stored fields (even if it makes sense performance wise some day). Having this as the default now (i.e. useDocValuesAsStored=true) would make the transition less abrupt. What do you think?&lt;/p&gt;</comment>
                            <comment id="15072233" author="dsmiley" created="Sun, 27 Dec 2015 13:31:45 -0700">&lt;p&gt;Rule #5 is very surprising to me, as it seems to conflict with #3 in that it ignores useDocValuesAsStored. What is the rationale?  If the field is both Stored And DV then from where is it returned?  I REALLY hope not DV since it then wouldn't respect value ordering. &lt;/p&gt;</comment>
                            <comment id="15072234" author="shalinmangar" created="Sun, 27 Dec 2015 13:39:43 -0700">&lt;p&gt;The idea is that if you have explicitly asked for that field then we find a way to return it, if possible. If it is both stored and DV then it returns from stored.&lt;/p&gt;</comment>
                            <comment id="15072241" author="shalinmangar" created="Sun, 27 Dec 2015 13:48:00 -0700">&lt;blockquote&gt;&lt;p&gt;It didn't have to be this way. It could have designed such that fl=* is only for stored fields and those explicitly setting useDocValuesAsStored=true.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Let me take a step back. The way I think about useDocValuesAsStored is that it gives a hint to Solr that this field &lt;b&gt;can&lt;/b&gt; be retrieved from DocValues. But that doesn't necessarily mean that we will always retrieve it from DocValues. Later, in &lt;a href="https://issues.apache.org/jira/browse/SOLR-8344" title="Decide default when requested fields are both column and row stored." class="issue-link" data-issue-key="SOLR-8344"&gt;SOLR-8344&lt;/a&gt; we will implement some heuristics to choose whether to retrieve from stored or from DV if both are enabled.&lt;/p&gt;

&lt;p&gt;So, by making useDocValuesAsStored=true as default, we don't tie our hands in &lt;a href="https://issues.apache.org/jira/browse/SOLR-8344" title="Decide default when requested fields are both column and row stored." class="issue-link" data-issue-key="SOLR-8344"&gt;SOLR-8344&lt;/a&gt; and we'd be free to choose as we desire. But if the user wants a field to never be &lt;b&gt;automatically&lt;/b&gt; retrieved from DocValues then he can set useDocValuesAsStored=false. Keep in mind that this is only for automatic selection and if the user wants to explicitly retrieve a field by specifying its full name (no globbing) in the 'fl' parameter then we respect his/her wishes and retrieve from DV if necessary.&lt;/p&gt;

&lt;p&gt;Maybe useDocValuesAsStored is a bad name and 'autoDocValuesAsStored' conveys the meaning better?&lt;/p&gt;</comment>
                            <comment id="15072243" author="jira-bot" created="Sun, 27 Dec 2015 13:52:47 -0700">&lt;p&gt;Commit 1721844 from shalin@apache.org in branch 'dev/branches/branch_5x'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1721844" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1721844&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8220" title="Read field from docValues for non stored fields" class="issue-link" data-issue-key="SOLR-8220"&gt;&lt;del&gt;SOLR-8220&lt;/del&gt;&lt;/a&gt;: Read field from DocValues for non stored fields&lt;/p&gt;</comment>
                            <comment id="15072244" author="dsmiley" created="Sun, 27 Dec 2015 13:58:31 -0700">&lt;p&gt;Ok then Rule #5 makes perfect sense to me. #3 is questionable to me; hard to clearly explain the rules to someone.  So useDocValuesAsStored is only considered when FL contains an asterisk?  If so, I wonder if it should be named to reflect that somehow. Like "flWildcard". With a name like that, it would be useful to set to false on a stored field. &lt;/p&gt;</comment>
                            <comment id="15072246" author="shalinmangar" created="Sun, 27 Dec 2015 14:14:43 -0700">&lt;p&gt;#3 was fixed in later patches. In the committed code, if you request a field explicitly then it will be returned either from stored or from DV.&lt;/p&gt;</comment>
                            <comment id="15072249" author="dsmiley" created="Sun, 27 Dec 2015 14:23:32 -0700">&lt;p&gt;How about two Boolean settings:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;matchesFlGlob&lt;/tt&gt; defaults to whatever &lt;tt&gt;stored&lt;/tt&gt; is. Very straight forward to describe; no special exceptions. Useful to set to either true or false in different circumstances depending if it's stored or DV. This would be a separate issue.&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;autoDocValuesAsStored&lt;/tt&gt; defaults to whatever &lt;tt&gt;docValues&lt;/tt&gt; is.  I'm not sure how to define it honestly other than to say it doesn't have to do with fl globbing. Maybe it could prevent fl choosing the field even if explicitly ?&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15072281" author="yseeley@gmail.com" created="Sun, 27 Dec 2015 16:10:03 -0700">&lt;blockquote&gt;&lt;p&gt;copyField target that isn't stored, isn't indexed, but has docValues for faceting or sorting.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Going forward, why wouldn't one just use docValues on the original field?&lt;br/&gt;
Anyway the copyField thing presents ambiguities for atomic updates as well... it's not specific to "fl".  Whatever we support for that can be used for "fl" as well (for instance, determinging that the copyField target isn't a "real" field because the source is already stored/docValued or something).&lt;/p&gt;

&lt;p&gt;It seems like going forward, people will benefit by adjusting their mental model to "it's just a different way of storing... row stored or column stored."  To a new user, why would one not get all stored fields back?  If column stored option had been present in Lucene from the start, that's probably how it would have been implemented in Solr from the start.&lt;/p&gt;</comment>
                            <comment id="15072357" author="shalinmangar" created="Sun, 27 Dec 2015 19:38:48 -0700">&lt;blockquote&gt;&lt;p&gt;matchesFlGlob defaults to whatever stored is. Very straight forward to describe; no special exceptions. Useful to set to either true or false in different circumstances depending if it's stored or DV. This would be a separate issue.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I don't think we need that level of configurability? Keep in mind that every parameter that we add also needs to be explained to a new user. Having trained people on Solr, explaining the difference between stored/indexed/docvalues is confusing enough. We should avoid adding more complexity if we can. This is another reason why I wanted useDocValuesAsStored to be true by default and un-specified/hidden in all default schemas.&lt;/p&gt;

&lt;p&gt;Also I don't really understand your reasons for adding such a parameter. Globbing is allowed on doc values field as long as &lt;tt&gt;useDocValuesAsStored=true&lt;/tt&gt;. In the committed patch, you can do &lt;tt&gt;fl=a,b,c,d*&lt;/tt&gt; and have &lt;tt&gt;d*&lt;/tt&gt; match all docvalues fields which are &lt;tt&gt;useDocValuesAsStored=true&lt;/tt&gt;. But if you set &lt;tt&gt;useDocValuesAsStored=false&lt;/tt&gt; then globbing will not work. What am I missing?&lt;/p&gt;</comment>
                            <comment id="15072397" author="ichattopadhyaya" created="Sun, 27 Dec 2015 21:05:43 -0700">&lt;p&gt;Right, in the last patch from me (and maybe the second last too) &lt;span class="error"&gt;&amp;#91;0&amp;#93;&lt;/span&gt;, I introduced returning any additional fields with &amp;#42; even if those additional fields are non-stored DVs with useDocValuesAsStored=false. Hence, Shalin's point 3 now should read something like:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;3. &lt;tt&gt;fl=&amp;#42;,a1&lt;/tt&gt; will return all stored=true fields and useDocValuesAsStored=true DV fields. If the 'a1' field is a stored=false DV field with useDocValuesAsStored=false then it will also be returned because it was explicitly asked for.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;span class="error"&gt;&amp;#91;0&amp;#93;&lt;/span&gt; - &lt;a href="https://issues.apache.org/jira/browse/SOLR-8220?focusedCommentId=15071474&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15071474" class="external-link" rel="nofollow"&gt;https://issues.apache.org/jira/browse/SOLR-8220?focusedCommentId=15071474&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15071474&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15072425" author="dsmiley" created="Sun, 27 Dec 2015 22:11:33 -0700">&lt;blockquote&gt;&lt;p&gt;(Yonik) Going forward, why wouldn't one just use docValues on the original field?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The main reason is that for returning the top-X docs with more than a few fields, row storage will probably be faster than columnar storage, performance-wise.  So at index time you can pay for both if you need columnar for other reasons (sorting/faceting).  Another reason is to retain a particular ordering for multi-valued fields.  Another reason is that Solr's highlighters don't read from docValues (solvable).&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;(Ishan) David, do you think having the copyField targets to have useDocValuesAsStored as false in our example schemas partly alleviates the problem?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, we should do that.  Ideally most users wouldn't want to monkey with such parameters (IMO).  But most schemas I've seen have at least one occurrence of an original input string indexed two ways for search &amp;amp; sorting/faceting.  And if our example schemas do, thus motivating us to set it to false for these fields, it just re-confirms my point.&lt;/p&gt;

&lt;p&gt;Shalin: I very much care about ease of documenting/explaining this; I thought my comments showed I care.  I guess we just see this issue differently.  I'm coming around to a new interpretation of what useDocValuesAsStored is, as it was committed and today clarified by you and Ishan.  It basically means will a 'fl' glob match the DV field or not.  If my understanding is true, then I think this is evidence I'm on to something with my "matchesFlGlob" suggestion.  You are free to disagree but I think it's extremely easy to document/describe/teach etc. what matchesFlGlob means, particularly if it's scope is expanded to apply to stored fields too.&lt;/p&gt;

&lt;p&gt;FWIW I'll be on IRC.  My attempts to ping you haven't received a response.&lt;/p&gt;</comment>
                            <comment id="15072712" author="shalinmangar" created="Mon, 28 Dec 2015 06:21:56 -0700">&lt;p&gt;I had a chat with David on IRC. In summary, his objections are:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;The primary is the default  are stored=false &amp;amp; docValues=true returned from globs by default (whatever we name the field/fieldtype attributes). It would be set to false often, assuming  many schemas index text both ways?&lt;/li&gt;
	&lt;li&gt;Globs only match a DV field if useDocValuesAsStored=true and so the property name should be indicative of that&lt;/li&gt;
	&lt;li&gt;Perhaps if we have a matchesFlGlob parameter we would then have no need for useDocValuesAsStored?&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;I was of the opinion that matchesFlGlob=true is not a great name because what if we use JSON request API in future and there's no "fl" so to speak. David then also suggested an alternate name e.g. matchesReturnGlob: whether a glob (asterisk) pattern in an fl parameter (or equivalent) will match this field.  Applies to stored or docValues fields.  Defaults to what stored is set to.&lt;/p&gt;

&lt;p&gt;I'm still not sure about this, David. What does stored=true, matchesReturnGlob=false mean? Should that even be allowed?&lt;/p&gt;

&lt;p&gt;Replying to some of your earlier points:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;The main reason is that for returning the top-X docs with more than a few fields, row storage will probably be faster than columnar storage, performance-wise.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Agreed, and that's why we need to figure out the specifics in &lt;a href="https://issues.apache.org/jira/browse/SOLR-8344" title="Decide default when requested fields are both column and row stored." class="issue-link" data-issue-key="SOLR-8344"&gt;SOLR-8344&lt;/a&gt; so that we choose the right way of retrieval.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Another reason is to retain a particular ordering for multi-valued fields&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We can make always try to use stored values for multi-valued fields in &lt;a href="https://issues.apache.org/jira/browse/SOLR-8344" title="Decide default when requested fields are both column and row stored." class="issue-link" data-issue-key="SOLR-8344"&gt;SOLR-8344&lt;/a&gt;.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Another reason is that Solr's highlighters don't read from docValues (solvable).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Why is this a reason for not using DocValues on the original field?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Ideally most users wouldn't want to monkey with such parameters (IMO). But most schemas I've seen have at least one occurrence of an original input string indexed two ways for search &amp;amp; sorting/faceting. And if our example schemas do, thus motivating us to set it to false for these fields, it just re-confirms my point.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The thing is the  copy fields you refer to are deliberately added and I think it should be okay to expect that users will choose the value for useDocValuesAsStored according to their use-cases for such fields. It is also common for people to have docValues=true and stored=true together just because they believe that it isn't possible to retrieve doc values. &lt;/p&gt;

&lt;p&gt;What do you think?&lt;/p&gt;</comment>
                            <comment id="15072789" author="yseeley@gmail.com" created="Mon, 28 Dec 2015 08:02:31 -0700">&lt;blockquote&gt;
&lt;p&gt;&amp;gt; (Yonik) Going forward, why wouldn't one just use docValues on the original field [ rather than a copyField ] ?&lt;br/&gt;
The main reason is that for returning the top-X docs with more than a few fields, row storage will probably be faster than columnar storage, performance-wise.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;If one still wants to use row-stored for performance tweaks (the exact cross-over point will hopefully be determined by &lt;a href="https://issues.apache.org/jira/browse/SOLR-8344" title="Decide default when requested fields are both column and row stored." class="issue-link" data-issue-key="SOLR-8344"&gt;SOLR-8344&lt;/a&gt;), then they can still do that, and it makes sense to do both row-stored and column-stored on the original field.  Sorry if it wasn't clear, but that was my original point.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;It [ useDocValuesAsStored ] basically means will a 'fl' glob match the DV field or not.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;That's only one aspect.  Every place that "uses" stored fields should treat DV field as a stored field.  It also affects streaming expressions / SQL, highlighting, partial updates, etc.&lt;/p&gt;

&lt;p&gt;Although I can see why you might think that at first - the fact that the current implementation does return fl=exact_field_name even when useDocValuesAsStored=false was a surprise to me as well.  I don't see it as a big deal though (more like a minor syntactic shortcut for a pseudo field).&lt;/p&gt;

&lt;p&gt;To me, useDocValuesAsStored=false means "this isn't really a stored field... it's just an implementation artifact for some query-time feature we need".&lt;/p&gt;</comment>
                            <comment id="15072846" author="dsmiley" created="Mon, 28 Dec 2015 08:59:38 -0700">&lt;p&gt;To be clear I'm not -1 on this; just -0.&lt;/p&gt;

&lt;p&gt;I get the gist of the intent with what is committed.  Thanks for clarifying guys.&lt;/p&gt;

&lt;p&gt;I think what may &lt;em&gt;reduce&lt;/em&gt; the need for users to know about / touch useDocValuesAsStored (what I hope for) is if conventionally, stored &amp;amp; doc-values fields are the same field, and then we put tokenized text into some other field, indexed=true stored=false docValues=false if we also need keyword search on the field in question.  I think this is what Yonik is suggesting.  The only annoyance with this is highlighting &amp;#8211; the highlighters expect the stored text to be at the same field name as both the query &amp;amp; index.  &lt;tt&gt;hl.requireFieldMatch&lt;/tt&gt; could be set to false but that's a blunt instrument and isn't even supported by the postings highlighter.  Nonetheless I think this could be solved in another issue.&lt;/p&gt;

&lt;p&gt;Can and should the default/example schemas be adjusted to fit the aforementioned conventions?  Then we wouldn't have any want to set useDocValuesAsStored in them.&lt;/p&gt;</comment>
                            <comment id="15092491" author="erickerickson" created="Mon, 11 Jan 2016 12:03:42 -0700">&lt;p&gt;Hmmm, one implication that I just realized (yeah, I'm slow sometimes). In addition to the output from a DV field being reordered, identical values are collapsed since it's a SortedSet under the covers, right? So if I have a MultiValued DocValues field and put in "memory", "memory", "memory", then all I get back from the DV field is one copy of "memory".&lt;/p&gt;

&lt;p&gt;Since the guarantee that multiValued fields return data in the same order inserted when returning the Stored value is not true of returning DV values, this is perhaps no biggie. IMO it does deserve a comment when we do the docs for this though.&lt;/p&gt;</comment>
                            <comment id="15092500" author="yseeley@gmail.com" created="Mon, 11 Jan 2016 12:09:30 -0700">&lt;p&gt;Yep... I commented earlier that we should prob add an explicit "set" type/flag in the future.  It can make sense to have a field that preserves order/instances and one that doesn't.&lt;/p&gt;</comment>
                            <comment id="15154456" author="ichattopadhyaya" created="Fri, 19 Feb 2016 09:27:17 -0700">&lt;p&gt;Notes for the reference guide:&lt;/p&gt;

&lt;p&gt;Page: &lt;a href="https://cwiki.apache.org/confluence/display/solr/Defining+Fields" class="external-link" rel="nofollow"&gt;https://cwiki.apache.org/confluence/display/solr/Defining+Fields&lt;/a&gt;&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
Property=useDocValuesAsStored
Description=If the field has docValues enabled, setting &lt;span class="code-keyword"&gt;this&lt;/span&gt; to &lt;span class="code-keyword"&gt;true&lt;/span&gt; would allow the field to be treated as regular stored fields (even &lt;span class="code-keyword"&gt;if&lt;/span&gt; it has stored=&lt;span class="code-keyword"&gt;false&lt;/span&gt;). This means that &lt;span class="code-keyword"&gt;this&lt;/span&gt; field would be returned alongside regular stored fields that are returned using the fl parameter.
Values=&lt;span class="code-keyword"&gt;true&lt;/span&gt; or &lt;span class="code-keyword"&gt;false&lt;/span&gt;
Implicit &lt;span class="code-keyword"&gt;default&lt;/span&gt;=&lt;span class="code-keyword"&gt;false&lt;/span&gt; &lt;span class="code-keyword"&gt;for&lt;/span&gt; schema versions &amp;lt;1.6, &lt;span class="code-keyword"&gt;true&lt;/span&gt; &lt;span class="code-keyword"&gt;for&lt;/span&gt; schema versions &amp;gt;=1.6
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;Page: &lt;a href="https://cwiki.apache.org/confluence/display/solr/DocValues" class="external-link" rel="nofollow"&gt;https://cwiki.apache.org/confluence/display/solr/DocValues&lt;/a&gt;&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
&amp;lt;New section&amp;gt; Retrieving docValues during search:

Field values retrieved during search queries are typically returned from stored values. However, starting with schema version 1.6, all non-stored docValues fields will be also returned along with other stored fields when all fields (or pattern matching globs) are specified to be returned (e.g. fl=*) &lt;span class="code-keyword"&gt;for&lt;/span&gt; search queries. This behavior can be turned on and off by setting useDocValuesAsStored parameter &lt;span class="code-keyword"&gt;for&lt;/span&gt; a field or a field type to &lt;span class="code-keyword"&gt;true&lt;/span&gt; (implicit &lt;span class="code-keyword"&gt;default&lt;/span&gt; since schema version 1.6) or &lt;span class="code-keyword"&gt;false&lt;/span&gt; (implicit &lt;span class="code-keyword"&gt;default&lt;/span&gt; till schema version 1.5). See https:&lt;span class="code-comment"&gt;//cwiki.apache.org/confluence/display/solr/Defining+Fields
&lt;/span&gt;
Note that enabling &lt;span class="code-keyword"&gt;this&lt;/span&gt; property has performance implications because DocValues are column-oriented and may therefore incur additional cost to retrieve &lt;span class="code-keyword"&gt;for&lt;/span&gt; each returned document. Also note that &lt;span class="code-keyword"&gt;while&lt;/span&gt; returning non-stored fields from docValues (&lt;span class="code-keyword"&gt;default&lt;/span&gt; in schema versions 1.6+, unless useDocValuesAsStored is &lt;span class="code-keyword"&gt;false&lt;/span&gt;), the values of a multi-valued field are returned in sorted order (and not insertion order). If you require the multi-valued fields to be returned in the original insertion order, then make your multi-valued field as stored (such a change requires re-indexing).
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Page: &lt;a href="https://cwiki.apache.org/confluence/display/solr/Common+Query+Parameters#CommonQueryParameters-Thefl%28FieldList%29Parameter" class="external-link" rel="nofollow"&gt;https://cwiki.apache.org/confluence/display/solr/Common+Query+Parameters#CommonQueryParameters-Thefl%28FieldList%29Parameter&lt;/a&gt;&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
Note: Starting with schema version 1.6, &lt;span class="code-keyword"&gt;if&lt;/span&gt; there are non-stored fields with docValues enabled in the index, then a pattern glob like * in the fl parameter will retrieve those fields. This is not the &lt;span class="code-keyword"&gt;case&lt;/span&gt; &lt;span class="code-keyword"&gt;if&lt;/span&gt; those fields have explicitly useDocValuesAsStored as &lt;span class="code-keyword"&gt;false&lt;/span&gt; in their field definition (see https:&lt;span class="code-comment"&gt;//cwiki.apache.org/confluence/display/solr/Defining+Fields) or the schema version is &amp;lt;1.6. However, something like fl=dvfield or fl=*,dvfield (say dvfield is a non-stored field with docValues enabled) would retrieve the dvfield irrespective of the useDocValuesAsStored value. (See SOLR-8220 &lt;span class="code-keyword"&gt;for&lt;/span&gt; more details)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Could someone please review and update the ref guide with the above information? And please feel free to reorganize, modify, drop, or rephrase any of this.&lt;/p&gt;</comment>
                            <comment id="15170463" author="shalinmangar" created="Sat, 27 Feb 2016 01:31:56 -0700">&lt;p&gt;This was released in 5.5 so I am resolving this.&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley" class="user-hover" rel="dsmiley"&gt;David Smiley&lt;/a&gt; &amp;#8211; please open new issues if you want to change this feature for 6.0 in any way.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12916484">SOLR-8344</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12680349">SOLR-5478</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12914534">SOLR-8316</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12915972">SOLR-8339</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12912071">SOLR-8276</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12777612" name="SOLR-8220-5x.patch" size="71805" author="ichattopadhyaya" created="Mon, 14 Dec 2015 16:32:07 -0700"/>
                            <attachment id="12779586" name="SOLR-8220-branch_5x.patch" size="112681" author="shalinmangar" created="Sun, 27 Dec 2015 09:11:46 -0700"/>
                            <attachment id="12773080" name="SOLR-8220-ishan.patch" size="18232" author="ichattopadhyaya" created="Wed, 18 Nov 2015 14:17:44 -0700"/>
                            <attachment id="12773079" name="SOLR-8220-ishan.patch" size="18327" author="ichattopadhyaya" created="Wed, 18 Nov 2015 14:15:48 -0700"/>
                            <attachment id="12772665" name="SOLR-8220-ishan.patch" size="17043" author="ichattopadhyaya" created="Mon, 16 Nov 2015 22:37:21 -0700"/>
                            <attachment id="12772654" name="SOLR-8220-ishan.patch" size="15873" author="ichattopadhyaya" created="Mon, 16 Nov 2015 22:06:46 -0700"/>
                            <attachment id="12779575" name="SOLR-8220.patch" size="112742" author="shalinmangar" created="Sun, 27 Dec 2015 02:00:18 -0700"/>
                            <attachment id="12779573" name="SOLR-8220.patch" size="113556" author="shalinmangar" created="Sun, 27 Dec 2015 01:33:41 -0700"/>
                            <attachment id="12779508" name="SOLR-8220.patch" size="106087" author="ichattopadhyaya" created="Fri, 25 Dec 2015 03:34:54 -0700"/>
                            <attachment id="12779507" name="SOLR-8220.patch" size="106068" author="ichattopadhyaya" created="Fri, 25 Dec 2015 02:53:43 -0700"/>
                            <attachment id="12779501" name="SOLR-8220.patch" size="109713" author="shalinmangar" created="Fri, 25 Dec 2015 01:25:58 -0700"/>
                            <attachment id="12779497" name="SOLR-8220.patch" size="102214" author="ichattopadhyaya" created="Fri, 25 Dec 2015 00:26:08 -0700"/>
                            <attachment id="12779448" name="SOLR-8220.patch" size="99621" author="shalinmangar" created="Thu, 24 Dec 2015 07:33:49 -0700"/>
                            <attachment id="12779447" name="SOLR-8220.patch" size="99515" author="shalinmangar" created="Thu, 24 Dec 2015 07:13:21 -0700"/>
                            <attachment id="12779446" name="SOLR-8220.patch" size="99320" author="shalinmangar" created="Thu, 24 Dec 2015 07:12:32 -0700"/>
                            <attachment id="12779250" name="SOLR-8220.patch" size="84150" author="ichattopadhyaya" created="Wed, 23 Dec 2015 08:02:23 -0700"/>
                            <attachment id="12778457" name="SOLR-8220.patch" size="83025" author="ichattopadhyaya" created="Fri, 18 Dec 2015 02:01:09 -0700"/>
                            <attachment id="12778159" name="SOLR-8220.patch" size="84293" author="ichattopadhyaya" created="Wed, 16 Dec 2015 18:49:51 -0700"/>
                            <attachment id="12777659" name="SOLR-8220.patch" size="76550" author="ichattopadhyaya" created="Mon, 14 Dec 2015 21:07:04 -0700"/>
                            <attachment id="12777395" name="SOLR-8220.patch" size="74839" author="ichattopadhyaya" created="Sun, 13 Dec 2015 22:37:27 -0700"/>
                            <attachment id="12775268" name="SOLR-8220.patch" size="23356" author="ichattopadhyaya" created="Wed, 2 Dec 2015 05:21:16 -0700"/>
                            <attachment id="12775266" name="SOLR-8220.patch" size="23348" author="ichattopadhyaya" created="Wed, 2 Dec 2015 05:14:42 -0700"/>
                            <attachment id="12775212" name="SOLR-8220.patch" size="23463" author="k317h" created="Tue, 1 Dec 2015 22:13:01 -0700"/>
                            <attachment id="12775210" name="SOLR-8220.patch" size="23754" author="k317h" created="Tue, 1 Dec 2015 21:42:42 -0700"/>
                            <attachment id="12775208" name="SOLR-8220.patch" size="23499" author="k317h" created="Tue, 1 Dec 2015 21:13:47 -0700"/>
                            <attachment id="12775070" name="SOLR-8220.patch" size="18295" author="ichattopadhyaya" created="Tue, 1 Dec 2015 09:53:35 -0700"/>
                            <attachment id="12775054" name="SOLR-8220.patch" size="18538" author="ichattopadhyaya" created="Tue, 1 Dec 2015 08:46:55 -0700"/>
                            <attachment id="12774179" name="SOLR-8220.patch" size="18852" author="ichattopadhyaya" created="Tue, 24 Nov 2015 15:31:34 -0700"/>
                            <attachment id="12773756" name="SOLR-8220.patch" size="18678" author="k317h" created="Sun, 22 Nov 2015 18:32:04 -0700"/>
                            <attachment id="12773224" name="SOLR-8220.patch" size="20437" author="ichattopadhyaya" created="Thu, 19 Nov 2015 04:14:53 -0700"/>
                            <attachment id="12773167" name="SOLR-8220.patch" size="21345" author="k317h" created="Wed, 18 Nov 2015 21:34:20 -0700"/>
                            <attachment id="12773166" name="SOLR-8220.patch" size="21316" author="k317h" created="Wed, 18 Nov 2015 21:11:23 -0700"/>
                            <attachment id="12772472" name="SOLR-8220.patch" size="8456" author="ichattopadhyaya" created="Mon, 16 Nov 2015 04:33:52 -0700"/>
                            <attachment id="12772443" name="SOLR-8220.patch" size="9700" author="k317h" created="Sun, 15 Nov 2015 21:16:49 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>34.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 28 Oct 2015 01:33:38 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2nlwf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8155] json.facet - prefix parameter doesn't work properly</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8155</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;When using prefix in nested facets, not all values are found.&lt;br/&gt;
In the following query, I use facet with prefix in both old way (facet.field) and new way (json.facet).&lt;br/&gt;
In old way, I get 5 values. In new way I get only 3.&lt;/p&gt;

&lt;p&gt;This is the field definition in the schema:&lt;br/&gt;
&amp;lt;field name="topics_f" type="string" indexed="true" stored="true" required="false" multiValued="true" /&amp;gt;&lt;/p&gt;

&lt;p&gt;When I add to the schema docValues="true" the issue is solved.&lt;/p&gt;

&lt;p&gt;Query:&lt;/p&gt;

&lt;p&gt;&lt;a href="http://localhost:8983/solr/mycore/select?q=*%3A*&amp;amp;rows=0&amp;amp;wt=json&amp;amp;indent=true&amp;amp;facet=true&amp;amp;facet.field=topics_f&amp;amp;facet.prefix=2&amp;amp;json.facet=" class="external-link" rel="nofollow"&gt;http://localhost:8983/solr/mycore/select?q=*%3A*&amp;amp;rows=0&amp;amp;wt=json&amp;amp;indent=true&amp;amp;facet=true&amp;amp;facet.field=topics_f&amp;amp;facet.prefix=2&amp;amp;json.facet=&lt;/a&gt;{trendFieldFacet:{type:terms,%20field:topics_f,%20%20prefix:%222%22%20}}&lt;/p&gt;

&lt;p&gt;Response:&lt;/p&gt;

&lt;p&gt;{&lt;br/&gt;
  "responseHeader": {&lt;br/&gt;
    "status": 0,&lt;br/&gt;
    "QTime": 0,&lt;br/&gt;
    "params": {&lt;br/&gt;
      "q": "&lt;b&gt;:&lt;/b&gt;",&lt;br/&gt;
      "json.facet": "{trendFieldFacet:{type:terms, field:topics_f,  prefix:\"2\" }}",&lt;br/&gt;
      "facet.field": "topics_f",&lt;br/&gt;
      "indent": "true",&lt;br/&gt;
      "facet.prefix": "2",&lt;br/&gt;
      "rows": "0",&lt;br/&gt;
      "wt": "json",&lt;br/&gt;
      "facet": "true",&lt;br/&gt;
      "_": "1444566142012"&lt;br/&gt;
    }&lt;br/&gt;
  },&lt;br/&gt;
  "response": &lt;/p&gt;
{
    "numFound": 17,
    "start": 0,
    "docs": []
  }
&lt;p&gt;,&lt;br/&gt;
  "facet_counts": {&lt;br/&gt;
    "facet_queries": {},&lt;br/&gt;
    "facet_fields": &lt;/p&gt;
{
      "topics_f": [
        "2/device/iphone",
        4,
        "2/device/samsung",
        4,
        "2/city/london",
        1,
        "2/city/rome",
        1,
        "2/device/other",
        1
      ]
    }
&lt;p&gt;,&lt;br/&gt;
    "facet_dates": {},&lt;br/&gt;
    "facet_ranges": {},&lt;br/&gt;
    "facet_intervals": {},&lt;br/&gt;
    "facet_heatmaps": {}&lt;br/&gt;
  },&lt;br/&gt;
  "facets": {&lt;br/&gt;
    "count": 17,&lt;br/&gt;
    "trendFieldFacet": {&lt;br/&gt;
      "buckets": [&lt;br/&gt;
        &lt;/p&gt;
{
          "val": "2/device/iphone",
          "count": 4
        }
&lt;p&gt;,&lt;br/&gt;
        &lt;/p&gt;
{
          "val": "2/device/samsung",
          "count": 4
        }
&lt;p&gt;,&lt;/p&gt;
        {
          "val": "2/device/other",
          "count": 1
        }
&lt;p&gt;      ]&lt;br/&gt;
    }&lt;br/&gt;
  }&lt;br/&gt;
}&lt;/p&gt;</description>
                <environment/>
        <key id="12904035">SOLR-8155</key>
            <summary>json.facet - prefix parameter doesn't work properly</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yseeley@gmail.com">Yonik Seeley</assignee>
                                    <reporter username="yonesher">Yosi Nesher</reporter>
                        <labels>
                    </labels>
                <created>Sun, 11 Oct 2015 06:17:49 -0700</created>
                <updated>Mon, 11 Apr 2016 11:12:02 -0700</updated>
                            <resolved>Sat, 5 Mar 2016 16:57:31 -0700</resolved>
                                    <version>5.3</version>
                                    <fixVersion>5.5.1</fixVersion>
                    <fixVersion>5.6</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>Facet Module</component>
                        <due/>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="15140484" author="mkhludnev" created="Wed, 10 Feb 2016 01:12:16 -0700">&lt;p&gt;I think I see it while working on &lt;a href="https://issues.apache.org/jira/browse/SOLR-8466" title="Add support for UnInvertedField based faceting to FacetComponent" class="issue-link" data-issue-key="SOLR-8466"&gt;&lt;del&gt;SOLR-8466&lt;/del&gt;&lt;/a&gt;. There is a testcase for older facets, which reproduces the issue. I'm going to port it for json.facets.&lt;/p&gt;</comment>
                            <comment id="15146206" author="mkhludnev" created="Sat, 13 Feb 2016 14:31:38 -0700">&lt;p&gt;attaching a failing test &lt;span class="nobr"&gt;&lt;a href="https://issues.apache.org/jira/secure/attachment/12791643/12791643_SOLR-8155.patch" title="SOLR-8155.patch attached to SOLR-8155"&gt;SOLR-8155.patch&lt;sup&gt;&lt;img class="rendericon" src="https://issues.apache.org/jira/images/icons/link_attachment_7.gif" height="7" width="7" align="absmiddle" alt="" border="0"/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="15181898" author="yseeley@gmail.com" created="Sat, 5 Mar 2016 16:41:49 -0700">&lt;p&gt;OK, so there was a bug in the generic accumulation code used when there was a facet prefix or when a bucket sort other than count was used.&lt;br/&gt;
This patch fixes the bug and re-enables facet.prefix when facet.method=uif (&lt;a href="https://issues.apache.org/jira/browse/SOLR-8466" title="Add support for UnInvertedField based faceting to FacetComponent" class="issue-link" data-issue-key="SOLR-8466"&gt;&lt;del&gt;SOLR-8466&lt;/del&gt;&lt;/a&gt;) and enables the test code for that as well.&lt;/p&gt;</comment>
                            <comment id="15181902" author="jira-bot" created="Sat, 5 Mar 2016 16:47:57 -0700">&lt;p&gt;Commit 85557261431f9314253ebe282eb6d400bf7cae03 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org" class="user-hover" rel="yonik@apache.org"&gt;Yonik Seeley&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=8555726" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=8555726&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8155" title="json.facet - prefix parameter doesn&amp;#39;t work properly" class="issue-link" data-issue-key="SOLR-8155"&gt;&lt;del&gt;SOLR-8155&lt;/del&gt;&lt;/a&gt;: fix UnInvertedField.collectDocsGeneric, used for facet.prefix or non-count sorting&lt;/p&gt;</comment>
                            <comment id="15181906" author="jira-bot" created="Sat, 5 Mar 2016 16:52:50 -0700">&lt;p&gt;Commit 4d5a33e9ba2cdd40ef1ff0230deae895fa517279 in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org" class="user-hover" rel="yonik@apache.org"&gt;Yonik Seeley&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=4d5a33e" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=4d5a33e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8155" title="json.facet - prefix parameter doesn&amp;#39;t work properly" class="issue-link" data-issue-key="SOLR-8155"&gt;&lt;del&gt;SOLR-8155&lt;/del&gt;&lt;/a&gt;: fix UnInvertedField.collectDocsGeneric, used for facet.prefix or non-count sorting&lt;/p&gt;</comment>
                            <comment id="15181907" author="jira-bot" created="Sat, 5 Mar 2016 16:53:03 -0700">&lt;p&gt;Commit 1b332b1da5fa490a541ea46823c6681501549113 in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org" class="user-hover" rel="yonik@apache.org"&gt;Yonik Seeley&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=1b332b1" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=1b332b1&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8155" title="json.facet - prefix parameter doesn&amp;#39;t work properly" class="issue-link" data-issue-key="SOLR-8155"&gt;&lt;del&gt;SOLR-8155&lt;/del&gt;&lt;/a&gt;: fix UnInvertedField.collectDocsGeneric, used for facet.prefix or non-count sorting&lt;/p&gt;</comment>
                            <comment id="15181912" author="yseeley@gmail.com" created="Sat, 5 Mar 2016 16:57:31 -0700">&lt;p&gt;OK, this fix will be in 6.0&lt;br/&gt;
If we have a future 5.x release, we should backport at that time.&lt;/p&gt;</comment>
                            <comment id="15235628" author="jira-bot" created="Mon, 11 Apr 2016 11:08:04 -0700">&lt;p&gt;Commit 0073ba9700d5df7b00d77a5d5dd831316f138042 in lucene-solr's branch refs/heads/branch_5x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org" class="user-hover" rel="yonik@apache.org"&gt;Yonik Seeley&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=0073ba9" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=0073ba9&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8155" title="json.facet - prefix parameter doesn&amp;#39;t work properly" class="issue-link" data-issue-key="SOLR-8155"&gt;&lt;del&gt;SOLR-8155&lt;/del&gt;&lt;/a&gt;: fix UnInvertedField.collectDocsGeneric, used for facet.prefix or non-count sorting&lt;/p&gt;</comment>
                            <comment id="15235638" author="jira-bot" created="Mon, 11 Apr 2016 11:11:16 -0700">&lt;p&gt;Commit c3446734a2b6dccd8092f5672651779223076dac in lucene-solr's branch refs/heads/branch_5_5 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org" class="user-hover" rel="yonik@apache.org"&gt;Yonik Seeley&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c344673" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c344673&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8155" title="json.facet - prefix parameter doesn&amp;#39;t work properly" class="issue-link" data-issue-key="SOLR-8155"&gt;&lt;del&gt;SOLR-8155&lt;/del&gt;&lt;/a&gt;: fix UnInvertedField.collectDocsGeneric, used for facet.prefix or non-count sorting&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12791643" name="SOLR-8155.patch" size="7536" author="yseeley@gmail.com" created="Sat, 5 Mar 2016 16:41:49 -0700"/>
                            <attachment id="12787834" name="SOLR-8155.patch" size="4072" author="mkhludnev" created="Sat, 13 Feb 2016 14:31:38 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 10 Feb 2016 08:12:16 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2mv2n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8145] bin/solr script oom_killer arg incorrect</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8145</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;I noticed the oom_killer script wasn't working in our 5.2 deployment.&lt;/p&gt;

&lt;p&gt;In the &lt;tt&gt;bin/solr&lt;/tt&gt; script, the &lt;tt&gt;OnOutOfMemoryError&lt;/tt&gt; option is being passed as an arg to the jar rather than to the JVM.  I moved it ahead of &lt;tt&gt;-jar&lt;/tt&gt; and verified it shows up in the JVM args in the UI.&lt;/p&gt;

&lt;div class="preformatted panel" style="border-width: 1px;"&gt;&lt;div class="preformattedContent panelContent"&gt;
&lt;pre&gt;   # run Solr in the background
    nohup "$JAVA" "${SOLR_START_OPTS[@]}" $SOLR_ADDL_ARGS -jar start.jar \
    "-XX:OnOutOfMemoryError=$SOLR_TIP/bin/oom_solr.sh $SOLR_PORT $SOLR_LOGS_DIR" "${SOLR_JETTY_CONFIG[@]}" \
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Also, I'm not sure what the &lt;tt&gt;SOLR_PORT&lt;/tt&gt; and &lt;tt&gt;SOLR_LOGS_DIR&lt;/tt&gt; args are doing--they don't appear to be positional arguments to the jar.&lt;/p&gt;

&lt;p&gt;Attaching a patch against 5.2.&lt;/p&gt;</description>
                <environment/>
        <key id="12903454">SOLR-8145</key>
            <summary>bin/solr script oom_killer arg incorrect</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thelabdude">Timothy Potter</assignee>
                                    <reporter username="nated">Nate Dire</reporter>
                        <labels>
                    </labels>
                <created>Thu, 8 Oct 2015 12:18:20 -0700</created>
                <updated>Thu, 21 Apr 2016 17:33:31 -0700</updated>
                            <resolved>Thu, 21 Apr 2016 17:22:23 -0700</resolved>
                                    <version>5.2.1</version>
                                    <fixVersion>5.5.1</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>scripts and tools</component>
                        <due/>
                            <votes>3</votes>
                                    <watches>12</watches>
                                                                <comments>
                            <comment id="15024286" author="jurian" created="Tue, 24 Nov 2015 04:12:43 -0700">&lt;p&gt;SOLR_PORT and SOLR_LOGS_DIR are arguments for the oom_solr.sh script and are required for proper OOM handling. I've updated your patch and verified that it's working now.&lt;/p&gt;</comment>
                            <comment id="15024305" author="jurian" created="Tue, 24 Nov 2015 04:29:25 -0700">&lt;p&gt;Updated patch with proper svn diff instead of just diff&lt;/p&gt;</comment>
                            <comment id="15169299" author="jmlucjav" created="Fri, 26 Feb 2016 09:45:56 -0700">&lt;p&gt;I was going to submit a PR when I found this. &lt;/p&gt;

&lt;p&gt;Something like this, so trivial and so important for a robust production system should have been merged already, please make it into 6.0 at least.&lt;/p&gt;

&lt;p&gt;I verified it works on Linux/Windows with jdk8. &lt;/p&gt;

&lt;p&gt;Also, if you are worried about the submitter's comment about  SOLR_PORT and SOLR_LOGS_DIR, the patch is handling them correctly, they are just parameters for the oom killer script, so the patch is correct.&lt;/p&gt;</comment>
                            <comment id="15169372" author="elyograg" created="Fri, 26 Feb 2016 10:30:59 -0700">&lt;p&gt;Just noticed this because of the comment today.  Don't know how I missed it before.&lt;/p&gt;

&lt;p&gt;This could explain &lt;a href="https://issues.apache.org/jira/browse/SOLR-8539" title="Solr queries swallows up OutOfMemoryErrors" class="issue-link" data-issue-key="SOLR-8539"&gt;SOLR-8539&lt;/a&gt; and other similar problems.&lt;/p&gt;</comment>
                            <comment id="15169579" author="dragonsinth" created="Fri, 26 Feb 2016 12:09:53 -0700">&lt;p&gt;I've always just given this special handling in my own installation.  My bin/solr script is edited to use a specific env var:&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
diff --git a/solr/bin/solr b/solr/bin/solr
index 85cd550..0e383b5 100755
--- a/solr/bin/solr
+++ b/solr/bin/solr
@@ -1315,7 +1315,8 @@ function launch_solr() {
 
   &lt;span class="code-keyword"&gt;if&lt;/span&gt; [ &lt;span class="code-quote"&gt;"$run_in_foreground"&lt;/span&gt; == &lt;span class="code-quote"&gt;"&lt;span class="code-keyword"&gt;true&lt;/span&gt;"&lt;/span&gt; ]; then
     echo -e &lt;span class="code-quote"&gt;"\nStarting Solr$IN_CLOUD_MODE on port $SOLR_PORT from $SOLR_SERVER_DIR\n"&lt;/span&gt;
-    exec &lt;span class="code-quote"&gt;"$JAVA"&lt;/span&gt; &lt;span class="code-quote"&gt;"${SOLR_START_OPTS[@]}"&lt;/span&gt; $SOLR_ADDL_ARGS -jar start.jar &lt;span class="code-quote"&gt;"${SOLR_JETTY_CONFIG[@]}"&lt;/span&gt;
+    # scottb: OOMKILLER needs &lt;span class="code-keyword"&gt;super&lt;/span&gt; special handling
+    exec &lt;span class="code-quote"&gt;"$JAVA"&lt;/span&gt; &lt;span class="code-quote"&gt;"${SOLR_START_OPTS[@]}"&lt;/span&gt; &lt;span class="code-quote"&gt;"${OOMKILLER:=-Dno.oom.killer}"&lt;/span&gt; $SOLR_ADDL_ARGS -jar start.jar &lt;span class="code-quote"&gt;"${SOLR_JETTY_CONFIG[@]}"&lt;/span&gt;
   &lt;span class="code-keyword"&gt;else&lt;/span&gt;
     # run Solr in the background
     nohup &lt;span class="code-quote"&gt;"$JAVA"&lt;/span&gt; &lt;span class="code-quote"&gt;"${SOLR_START_OPTS[@]}"&lt;/span&gt; $SOLR_ADDL_ARGS -jar start.jar \
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Then I just setup OOMKILLER in the calling script to be something like&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
'-XX:OnOutOfMemoryError=exec ' + os.path.abspath('killjava.sh')
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;At that point, you can get by with a super simple killjava.sh:&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
#!/bin/bash
kill -9 $PPID
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The current scheme seems super complicated.&lt;/p&gt;</comment>
                            <comment id="15172602" author="thelabdude" created="Mon, 29 Feb 2016 14:00:02 -0700">&lt;p&gt;thanks for the patch, I'll get this committed soon&lt;/p&gt;</comment>
                            <comment id="15176157" author="jira-bot" created="Wed, 2 Mar 2016 11:24:43 -0700">&lt;p&gt;Commit 80801a2738c10ace30eca549fe5daadb88989c32 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thelabdude" class="user-hover" rel="thelabdude"&gt;Timothy Potter&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=80801a2" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=80801a2&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8145" title="bin/solr script oom_killer arg incorrect" class="issue-link" data-issue-key="SOLR-8145"&gt;&lt;del&gt;SOLR-8145&lt;/del&gt;&lt;/a&gt;: Fix position of OOM killer script when starting Solr in the background&lt;/p&gt;</comment>
                            <comment id="15176191" author="jira-bot" created="Wed, 2 Mar 2016 11:33:36 -0700">&lt;p&gt;Commit e1033d965414b34b990070bb87c509364a7f4194 in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thelabdude" class="user-hover" rel="thelabdude"&gt;Timothy Potter&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e1033d9" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e1033d9&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8145" title="bin/solr script oom_killer arg incorrect" class="issue-link" data-issue-key="SOLR-8145"&gt;&lt;del&gt;SOLR-8145&lt;/del&gt;&lt;/a&gt;: Fix position of OOM killer script when starting Solr in the background&lt;/p&gt;</comment>
                            <comment id="15176206" author="jira-bot" created="Wed, 2 Mar 2016 11:37:28 -0700">&lt;p&gt;Commit b17c57f072b65106f2689d2f9ea6a5ca14e492e0 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thelabdude" class="user-hover" rel="thelabdude"&gt;Timothy Potter&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b17c57f" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b17c57f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8145" title="bin/solr script oom_killer arg incorrect" class="issue-link" data-issue-key="SOLR-8145"&gt;&lt;del&gt;SOLR-8145&lt;/del&gt;&lt;/a&gt;: mention fix in solr/CHANGES.txt&lt;/p&gt;</comment>
                            <comment id="15176212" author="jira-bot" created="Wed, 2 Mar 2016 11:38:45 -0700">&lt;p&gt;Commit ddd019fac0d9eff352a4a17a62d9a9654f7bdc86 in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thelabdude" class="user-hover" rel="thelabdude"&gt;Timothy Potter&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ddd019f" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ddd019f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8145" title="bin/solr script oom_killer arg incorrect" class="issue-link" data-issue-key="SOLR-8145"&gt;&lt;del&gt;SOLR-8145&lt;/del&gt;&lt;/a&gt;: mention fix in solr/CHANGES.txt&lt;/p&gt;</comment>
                            <comment id="15176224" author="thelabdude" created="Wed, 2 Mar 2016 11:43:33 -0700">&lt;p&gt;Thanks for the patch &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jurian" class="user-hover" rel="jurian"&gt;Jurian Broertjes&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="15176680" author="dragonsinth" created="Wed, 2 Mar 2016 16:08:32 -0700">&lt;p&gt;BTW: why is there no oomkiller when run in foreground?&lt;/p&gt;</comment>
                            <comment id="15176719" author="thelabdude" created="Wed, 2 Mar 2016 16:37:49 -0700">&lt;blockquote&gt;&lt;p&gt;BTW: why is there no oomkiller when run in foreground?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I don't even think we should support a foreground mode as it doesn't seem to add any value to me and you have to pass a special flag to activate it. Are people running SolrCloud in production in foreground mode? The OOM killer is really so that you don't have a zombie node that OOM'd in your cluster. That said, if you think the OOM killer is needed in fg mode for some reason, then open a new JIRA (this one is done) and post a patch please.&lt;/p&gt;</comment>
                            <comment id="15176812" author="elyograg" created="Wed, 2 Mar 2016 17:30:24 -0700">&lt;blockquote&gt;&lt;p&gt;Are people running SolrCloud in production in foreground mode?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think this is commonly used when users create a service for Windows, but there isn't an OOM killer script for Windows.&lt;/p&gt;

&lt;p&gt;I think that the only time somebody would run in foreground mode on *NIX is when they are troubleshooting, mostly to see the console logging.  I think that running the OOM killer even in foreground mode makes sense.&lt;/p&gt;

&lt;p&gt;A separate question (probably requiring a new issue):  Regardless of foreground/background, should there be an environment variable that can be set to disable the OOM killer?  Like foreground mode, this would be for troubleshooting.&lt;/p&gt;</comment>
                            <comment id="15176823" author="dragonsinth" created="Wed, 2 Mar 2016 17:35:55 -0700">&lt;p&gt;We always run solr in foreground, because we handle app process management at a higher level.  When we call bin/solr we already have a pidfile setup, stderr and stdout piped, etc-- so it's vital we run it in foreground to get the `exec` and maintain process identity.  But we still need oom killer, so that it will die fast and our process watcher will restart it.&lt;/p&gt;</comment>
                            <comment id="15177941" author="jira-bot" created="Thu, 3 Mar 2016 08:23:15 -0700">&lt;p&gt;Commit cc8af0d3e8e9bbd933947dae7307d0b09eb146da in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thelabdude" class="user-hover" rel="thelabdude"&gt;Timothy Potter&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=cc8af0d" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=cc8af0d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8145" title="bin/solr script oom_killer arg incorrect" class="issue-link" data-issue-key="SOLR-8145"&gt;&lt;del&gt;SOLR-8145&lt;/del&gt;&lt;/a&gt;: Fix position of OOM killer script when starting Solr in the background&lt;br/&gt;
(cherry picked from commit e1033d9)&lt;/p&gt;</comment>
                            <comment id="15177942" author="jira-bot" created="Thu, 3 Mar 2016 08:23:16 -0700">&lt;p&gt;Commit b21927818c30ea2d3defab3d94c19225dc2452c8 in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thelabdude" class="user-hover" rel="thelabdude"&gt;Timothy Potter&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b219278" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b219278&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8145" title="bin/solr script oom_killer arg incorrect" class="issue-link" data-issue-key="SOLR-8145"&gt;&lt;del&gt;SOLR-8145&lt;/del&gt;&lt;/a&gt;: mention fix in solr/CHANGES.txt&lt;br/&gt;
(cherry picked from commit ddd019f)&lt;/p&gt;</comment>
                            <comment id="15187188" author="thelabdude" created="Wed, 9 Mar 2016 07:51:51 -0700">&lt;p&gt;btw - I was concerned I introduced this bug originally so wanted to track down the change that introduced this, looks like here -&amp;gt; &lt;a href="https://github.com/apache/lucene-solr/commit/83969f44a0e9d4f282fa96f94870a039f9307287#diff-eb1341c1a8dc785e1d27d5a9d2c7a2e4" class="external-link" rel="nofollow"&gt;https://github.com/apache/lucene-solr/commit/83969f44a0e9d4f282fa96f94870a039f9307287#diff-eb1341c1a8dc785e1d27d5a9d2c7a2e4&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15208792" author="elyograg" created="Wed, 23 Mar 2016 10:14:37 -0700">&lt;p&gt;There's a bonus to this bugfix.  It also removes the following warning logged by Jetty when Solr starts:&lt;/p&gt;

&lt;div class="preformatted panel" style="border-width: 1px;"&gt;&lt;div class="preformattedContent panelContent"&gt;
&lt;pre&gt;WARNING: System properties and/or JVM args set.  Consider using --dry-run or --exec
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15210400" author="nimlhug" created="Thu, 24 Mar 2016 08:23:42 -0700">&lt;p&gt;Any chance this can be fixed in 5.5.1? &lt;/p&gt;</comment>
                            <comment id="15252939" author="anshumg" created="Thu, 21 Apr 2016 15:47:52 -0700">&lt;p&gt;backport for 5.5.1&lt;/p&gt;</comment>
                            <comment id="15253082" author="anshumg" created="Thu, 21 Apr 2016 17:33:31 -0700">&lt;p&gt;branch_5x:&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
commit 9b00006773120cee43e762e254216ca03eafa75e
Author: thelabdude &amp;lt;thelabdude@gmail.com&amp;gt;
Date:   Wed Mar 2 11:22:27 2016 -0700

    SOLR-8145: Fix position of OOM killer script when starting Solr in the background
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;branch_5_5&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
commit 851a6029e889860951fdb480bf2d658c89639862
Author: thelabdude &amp;lt;thelabdude@gmail.com&amp;gt;
Date:   Wed Mar 2 11:22:27 2016 -0700

    SOLR-8145: Fix position of OOM killer script when starting Solr in the background
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12770388">SOLR-7043</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12774045" name="SOLR-8145.patch" size="835" author="jurian" created="Tue, 24 Nov 2015 04:29:25 -0700"/>
                            <attachment id="12774041" name="SOLR-8145.patch" size="784" author="jurian" created="Tue, 24 Nov 2015 04:12:43 -0700"/>
                            <attachment id="12765661" name="SOLR-8145.patch" size="781" author="nated" created="Thu, 8 Oct 2015 12:24:24 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 24 Nov 2015 11:12:43 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2mro7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8135] SolrCloudExampleTest.testLoadDocsIntoGettingStartedCollection reproducible failure</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8135</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;No idea what's going on here, noticed it while testing out an unrelated patch &amp;#8211; seed reproduces against pristine trunk...&lt;/p&gt;

&lt;div class="preformatted panel" style="border-width: 1px;"&gt;&lt;div class="preformattedContent panelContent"&gt;
&lt;pre&gt;   [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=SolrCloudExampleTest -Dtests.method=testLoadDocsIntoGettingStartedCollection -Dtests.seed=59EA523FFF6CB60F -Dtests.slow=true -Dtests.locale=es_MX -Dtests.timezone=Africa/Porto-Novo -Dtests.asserts=true -Dtests.file.encoding=ISO-8859-1
   [junit4] FAILURE 49.5s | SolrCloudExampleTest.testLoadDocsIntoGettingStartedCollection &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: java.lang.AssertionError: Delete action failed!
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([59EA523FFF6CB60F:4A896050CE030FA9]:0)
   [junit4]    &amp;gt; 	at org.apache.solr.cloud.SolrCloudExampleTest.doTestDeleteAction(SolrCloudExampleTest.java:169)
   [junit4]    &amp;gt; 	at org.apache.solr.cloud.SolrCloudExampleTest.testLoadDocsIntoGettingStartedCollection(SolrCloudExampleTest.java:145)
   [junit4]    &amp;gt; 	at org.apache.solr.BaseDistributedSearchTestCase$ShardsRepeatRule$ShardsFixedStatement.callStatement(BaseDistributedSearchTestCase.java:963)
   [junit4]    &amp;gt; 	at org.apache.solr.BaseDistributedSearchTestCase$ShardsRepeatRule$ShardsStatement.evaluate(BaseDistributedSearchTestCase.java:938)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment/>
        <key id="12902849">SOLR-8135</key>
            <summary>SolrCloudExampleTest.testLoadDocsIntoGettingStartedCollection reproducible failure</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="noble.paul">Noble Paul</assignee>
                                    <reporter username="hossman">Hoss Man</reporter>
                        <labels>
                    </labels>
                <created>Tue, 6 Oct 2015 16:24:06 -0700</created>
                <updated>Thu, 10 Mar 2016 12:29:40 -0700</updated>
                            <resolved>Thu, 10 Mar 2016 12:29:40 -0700</resolved>
                                    <version>master</version>
                                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="14945992" author="hossman" created="Tue, 6 Oct 2015 16:27:37 -0700">&lt;p&gt;attaching ant output testing against...&lt;/p&gt;

&lt;div class="preformatted panel" style="border-width: 1px;"&gt;&lt;div class="preformattedContent panelContent"&gt;
&lt;pre&gt;hossman@tray:~/lucene/dev$ svnversion &amp;amp;&amp;amp; svn info | grep URL
1707150
URL: https://svn.apache.org/repos/asf/lucene/dev/trunk
Relative URL: ^/lucene/dev/trunk
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;with command...&lt;/p&gt;

&lt;div class="preformatted panel" style="border-width: 1px;"&gt;&lt;div class="preformattedContent panelContent"&gt;
&lt;pre&gt;ANT_ARGS="" ant test -Dtestcase=SolrCloudExampleTest -Dtests.method=testLoadDocsIntoGettingStartedCollection -Dtests.seed=59EA523FFF6CB60F -Dtests.slow=true -Dtests.locale=es_MX -Dtests.timezone=Africa/Porto-Novo -Dtests.asserts=true -Dtests.file.encoding=ISO-8859-1 &amp;gt; SOLR-8135.failure.log
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14961867" author="jira-bot" created="Sat, 17 Oct 2015 05:00:57 -0700">&lt;p&gt;Commit 1709142 from shalin@apache.org in branch 'dev/trunk'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1709142" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1709142&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8135" title="SolrCloudExampleTest.testLoadDocsIntoGettingStartedCollection reproducible failure" class="issue-link" data-issue-key="SOLR-8135"&gt;&lt;del&gt;SOLR-8135&lt;/del&gt;&lt;/a&gt;: Disable test until it can be fixed&lt;/p&gt;</comment>
                            <comment id="14961868" author="jira-bot" created="Sat, 17 Oct 2015 05:01:55 -0700">&lt;p&gt;Commit 1709143 from shalin@apache.org in branch 'dev/branches/branch_5x'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1709143" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1709143&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8135" title="SolrCloudExampleTest.testLoadDocsIntoGettingStartedCollection reproducible failure" class="issue-link" data-issue-key="SOLR-8135"&gt;&lt;del&gt;SOLR-8135&lt;/del&gt;&lt;/a&gt;: Disable test until it can be fixed&lt;/p&gt;</comment>
                            <comment id="14961877" author="thetaphi" created="Sat, 17 Oct 2015 05:29:21 -0700">&lt;p&gt;failed also on almost any build on Jenkins (2 of 3 builds failed). Thanks for disabling. I was afraid to do this...&lt;/p&gt;</comment>
                            <comment id="14962604" author="gus_heck" created="Sun, 18 Oct 2015 13:15:54 -0700">&lt;p&gt;also with &lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;ant test  -Dtestcase=SolrCloudExampleTest -Dtests.method=testLoadDocsIntoGettingStartedCollection -Dtests.seed=D7797CB78640592B -Dtests.slow=&lt;span class="code-keyword"&gt;true&lt;/span&gt; -Dtests.locale=mt_MT -Dtests.timezone=Jamaica -Dtests.asserts=&lt;span class="code-keyword"&gt;true&lt;/span&gt; -Dtests.file.encoding=US-ASCII &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;on 5.x&lt;/p&gt;</comment>
                            <comment id="14963604" author="thelabdude" created="Mon, 19 Oct 2015 09:57:11 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt; Can you take a look at this failure? From the logs, it looks like something is breaking in the config overlay / refresh layer when a collection is being deleted. There's nothing wrong with this test.&lt;/p&gt;</comment>
                            <comment id="14964038" author="erickerickson" created="Mon, 19 Oct 2015 13:56:48 -0700">&lt;p&gt;I did notice that if I added any code that delayed for 15 seconds after the doTestConfigUpdate call in that test that it would succeed. Just hacking around for clues I tried looking at the ZK state to see if we were missing a state change and I didn't see any (looking at ZK state and seeing if any nodes weren't active). If I either looped for 15 seconds looking for not active states &lt;em&gt;or&lt;/em&gt; just slept for 15 seconds, the test would consistently pass.&lt;/p&gt;

&lt;p&gt;I may have a bit of time to look at this on the flight home tonight.....&lt;/p&gt;

&lt;p&gt;And if I commented out the doUpdateConfig, it would succeed.&lt;/p&gt;

&lt;p&gt;None of which helps pinpoint what's going on, but helps me get a clue where to &lt;em&gt;start&lt;/em&gt; looking...&lt;/p&gt;</comment>
                            <comment id="14964325" author="erickerickson" created="Mon, 19 Oct 2015 17:44:39 -0700">&lt;p&gt;So far, this patch keeps the test from failing. I hacked this in on the hint that buried in the failure case was a message about "could not reload core blah blah blah" and the fact that if I commented out the update config bits the test succeeded.&lt;/p&gt;

&lt;p&gt;Maybe a race condition between multiple API calls modifying the configs and core reloading? This patch forces the collection to reload as part of updating the config...&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt; &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com" class="user-hover" rel="markrmiller@gmail.com"&gt;Mark Miller&lt;/a&gt; &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org" class="user-hover" rel="yonik@apache.org"&gt;Yonik Seeley&lt;/a&gt;&lt;br/&gt;
This feels like a band-aid though. I see in the ref guide that listeners are registered on the zknode and reloads happen sometime although I'm unclear on what exactly triggers them. It seems like any modification of the config file should be atomic in the sense that as long as the updates are valid, any core reloads should get a config that loads successfully. How do we guarantee atomic reads/writes of the config files? Especially when the read path is different than the write path?&lt;/p&gt;

&lt;p&gt;I don't have the logs right now, so I don't have a good sense of what in core reload was really failing, I'll see if I can get some of that info.&lt;/p&gt;

&lt;p&gt;NOTE: I'm on a plane so I could only beast this lightly. Nevertheless, I never got 4 successful runs before this patch and got 16 with the patch so it certainly seems in the right neighborhood. I'll be able to give it a more thorough spin when I'm not on battery. Assuming we think this is the right fix.&lt;/p&gt;</comment>
                            <comment id="14964522" author="erickerickson" created="Mon, 19 Oct 2015 21:59:24 -0700">
&lt;p&gt;Here's all the stack trace related to reloading the core I could find on a failure run.&lt;/p&gt;

&lt;p&gt;&lt;span class="error"&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt; 50808 INFO  (SolrConfigHandler-refreshconf) &lt;span class="error"&gt;&amp;#91;n:127.0.0.1:52555_cib c:gettingstarted s:shard2 r:core_node2 x:gettingstarted_shard2_replica2&amp;#93;&lt;/span&gt; o.a.s.c.ConfigSetProperties Did not find ConfigSet properties, assuming default properties: Can't find resource 'configsetprops.json' in classpath or '/configs/gettingstarted', cwd=/Users/Erick/apache/solr/beast-tmp/3/J0&lt;br/&gt;
   &lt;span class="error"&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt; 50808 INFO  (SolrConfigHandler-refreshconf) &lt;span class="error"&gt;&amp;#91;n:127.0.0.1:52555_cib c:gettingstarted s:shard2 r:core_node2 x:gettingstarted_shard2_replica2&amp;#93;&lt;/span&gt; o.a.s.c.CoreContainer Reloading SolrCore 'gettingstarted_shard2_replica2' using configuration from collection gettingstarted&lt;br/&gt;
   &lt;span class="error"&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt; 50808 ERROR (SolrConfigHandler-refreshconf) &lt;span class="error"&gt;&amp;#91;n:127.0.0.1:52555_cib c:gettingstarted s:shard2 r:core_node2 x:gettingstarted_shard2_replica2&amp;#93;&lt;/span&gt; o.a.s.h.SolrConfigHandler Unable to refresh conf &lt;br/&gt;
   &lt;span class="error"&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt; org.apache.solr.common.SolrException: Unable to reload core &lt;span class="error"&gt;&amp;#91;gettingstarted_shard2_replica2&amp;#93;&lt;/span&gt;&lt;br/&gt;
   &lt;span class="error"&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt;  at org.apache.solr.core.CoreContainer.reload(CoreContainer.java:837)&lt;br/&gt;
   &lt;span class="error"&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt;  at org.apache.solr.core.SolrCore$11.run(SolrCore.java:2602)&lt;br/&gt;
   &lt;span class="error"&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt;  at org.apache.solr.handler.SolrConfigHandler$Command$1.run(SolrConfigHandler.java:212)&lt;br/&gt;
   &lt;span class="error"&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt; Caused by: java.lang.IllegalStateException: IndexWriter has been closed&lt;br/&gt;
   &lt;span class="error"&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt;  at org.apache.solr.update.SolrCoreState.increfSolrCoreState(SolrCoreState.java:53)&lt;br/&gt;
   &lt;span class="error"&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt;  at org.apache.solr.core.SolrCore.reload(SolrCore.java:462)&lt;br/&gt;
   &lt;span class="error"&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt;  at org.apache.solr.core.CoreContainer.reload(CoreContainer.java:832)&lt;/p&gt;

</comment>
                            <comment id="14965162" author="markrmiller@gmail.com" created="Tue, 20 Oct 2015 07:21:42 -0700">&lt;p&gt;Thanks Erick, looks like a reload is somehow triggering after the core is already closed?&lt;/p&gt;</comment>
                            <comment id="14965275" author="erickerickson" created="Tue, 20 Oct 2015 08:44:29 -0700">&lt;p&gt;An 80 iteration beast of the test ran fine last night with this patch. And yes, I did remove the badapple notation.&lt;/p&gt;

&lt;p&gt;I'm pretty convinced this is &lt;em&gt;not&lt;/em&gt; the right fix though, it just helps identify the problem area.&lt;/p&gt;</comment>
                            <comment id="14965288" author="erickerickson" created="Tue, 20 Oct 2015 08:55:31 -0700">&lt;p&gt;Mark:&lt;/p&gt;

&lt;p&gt;That's my assumption, got a full day today so can't do anything on it until at least this evening though.&lt;/p&gt;</comment>
                            <comment id="15129334" author="thelabdude" created="Tue, 2 Feb 2016 16:27:02 -0700">&lt;p&gt;I can fix the test to wait longer after it issues a config change but that will mask a race condition that the SolrConfigHandler refreshconf thread attempts to refresh a core that is being shutdown down.&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
   [junit4]   2&amp;gt; 42606 INFO  (qtp1036148039-29) [n:127.0.0.1:58528_    ] o.a.s.c.SolrCore [gettingstarted_shard1_replica1]  CLOSING SolrCore org.apache.solr.core.SolrCore@53fda895
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and then later in the log, you have: &lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
   [junit4]   2&amp;gt; 42629 INFO  (SolrConfigHandler-refreshconf) [n:127.0.0.1:58528_ c:gettingstarted s:shard1 r:core_node4 x:gettingstarted_shard1_replica1] o.a.s.c.ConfigSetProperties Did not find ConfigSet properties, assuming &lt;span class="code-keyword"&gt;default&lt;/span&gt; properties: Can't find resource 'configsetprops.json' in classpath or '/configs/gettingstarted', cwd=/home/hossman/lucene/dev/solr/build/solr-core/test/J0
   [junit4]   2&amp;gt; 42629 INFO  (SolrConfigHandler-refreshconf) [n:127.0.0.1:58528_ c:gettingstarted s:shard1 r:core_node4 x:gettingstarted_shard1_replica1] o.a.s.c.CoreContainer Reloading SolrCore 'gettingstarted_shard1_replica1' using configuration from collection gettingstarted
   [junit4]   2&amp;gt; 42630 ERROR (SolrConfigHandler-refreshconf) [n:127.0.0.1:58528_ c:gettingstarted s:shard1 r:core_node4 x:gettingstarted_shard1_replica1] o.a.s.h.SolrConfigHandler Unable to refresh conf
   [junit4]   2&amp;gt; org.apache.solr.common.SolrException: Unable to reload core [gettingstarted_shard1_replica1]
   [junit4]   2&amp;gt;        at org.apache.solr.core.CoreContainer.reload(CoreContainer.java:837)
   [junit4]   2&amp;gt;        at org.apache.solr.core.SolrCore$11.run(SolrCore.java:2602)
   [junit4]   2&amp;gt;        at org.apache.solr.handler.SolrConfigHandler$Command$1.run(SolrConfigHandler.java:212)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I see some checks for whether the core is closed, so maybe there's nothing we can do better to detect this race condition, but would appreciate if &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt; could take a closer look at the checks? If not, the only fix here is to wait longer for the config changes to take effect before issuing the delete.&lt;/p&gt;</comment>
                            <comment id="15129380" author="thelabdude" created="Tue, 2 Feb 2016 16:57:33 -0700">&lt;p&gt;The other interesting thing to note is that the SolrConfigHandler does try to wait up to 30 seconds for agreement across all cores, but that does not mean the config has been applied on all cores, apparently. For instance, in the log you see:&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
   [junit4]   2&amp;gt; 41864 INFO  (qtp1735783147-155) [n:127.0.0.1:35628_ c:gettingstarted s:shard2 r:core_node1 x:gettingstarted_shard2_replica2] o.a.s.h.SolrConfigHandler Took 905.0ms to set the property overlay to be of version 0 &lt;span class="code-keyword"&gt;for&lt;/span&gt; collection gettingstarted
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But there is still config loading activity going on in the cores after this point, so that wait is somewhat misleading. I still think the fix here is to have the test wait longer before issuing the delete, but we should also revisit whether the SolrConfigHandler can do better at detecting a core is shutting down?&lt;/p&gt;</comment>
                            <comment id="15129422" author="thelabdude" created="Tue, 2 Feb 2016 17:16:04 -0700">&lt;p&gt;Chatting with &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hossman_lucene%40fucit.org" class="user-hover" rel="hossman_lucene@fucit.org"&gt;Chris Hostetter&lt;/a&gt;, it seems like the SolrConfigHandler should be able to leverage the CloseHook support in SolrCore to be able to detect a core is being closed and stop its attempts at refreshing config.&lt;/p&gt;

&lt;p&gt;Moreover, as I thought about the previous comment some more, I actually think the true bug here is the config handler returns before the config change has been applied (it seems from the log anyway) ... not sure why anyone would want a config update request to return to them before the change has been applied across the cluster? Seems hard for a client app to reason about whether a change is fully applied or not with the way things are w/o adding arbitrary waits, which would just be a bandaid in the SolrCloudExampleTest.&lt;/p&gt;</comment>
                            <comment id="15129987" author="noble.paul" created="Wed, 3 Feb 2016 00:57:42 -0700">&lt;p&gt;Diagnosis: This happens because of a race condition. We have multiple threads in parallel that invoked an unload/or reload. Race condition caused one of the threads to fail. In our code any failure in reload() would put this core as a permanent failure. It is not a failure , it is just that two threads simultaneously tried to perform the reload/unload. &lt;/p&gt;

&lt;p&gt;Solution: We need to handle this Exception differently . So I just created a new Exception called &lt;tt&gt;CoreIsClosedException&lt;/tt&gt; this wouldn't add the core to permanently failed cores as &lt;tt&gt;IndexWriter has been closed&lt;/tt&gt;. &lt;/p&gt;

&lt;p&gt;Follow Question up for others : If I'm trying to perform a reload and it fails , should we retry?&lt;/p&gt;</comment>
                            <comment id="15130645" author="erickerickson" created="Wed, 3 Feb 2016 09:36:46 -0700">&lt;p&gt;I can reasonably reliably get this to fail over night (14 out of 1,000) with the following error, so let me know if there's a patch I can try:&lt;/p&gt;

&lt;p&gt;&amp;gt; Throwable #1: java.lang.AssertionError: Delete action failed!&lt;br/&gt;
   &lt;span class="error"&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;    &amp;gt; 	at __randomizedtesting.SeedInfo.seed(&lt;span class="error"&gt;&amp;#91;ECD502B89BFAF991:FFB630D7AA954037&amp;#93;&lt;/span&gt;:0)&lt;br/&gt;
   &lt;span class="error"&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;    &amp;gt; 	at org.apache.solr.cloud.SolrCloudExampleTest.doTestDeleteAction(SolrCloudExampleTest.java:171)&lt;br/&gt;
   &lt;span class="error"&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;    &amp;gt; 	at org.apache.solr.cloud.SolrCloudExampleTest.testLoadDocsIntoGettingStartedCollection(SolrCloudExampleTest.java:147)&lt;br/&gt;
   &lt;span class="error"&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;    &amp;gt; 	at org.apache.solr.BaseDistributedSearchTestCase$ShardsRepeatRule$ShardsFixedStatement.callStatement(BaseDistributedSearchTestCase.java:965)&lt;br/&gt;
   &lt;span class="error"&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;    &amp;gt; 	at org.apache.solr.BaseDistributedSearchTestCase$ShardsRepeatRule$ShardsStatement.evaluate(BaseDistributedSearchTestCase.java:940)&lt;br/&gt;
   &lt;span class="error"&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;    &amp;gt; 	at java.lang.Thread.run(Thread.java:745)&lt;/p&gt;</comment>
                            <comment id="15130774" author="erickerickson" created="Wed, 3 Feb 2016 10:59:06 -0700">&lt;p&gt;This feels a little like a band-aid. If I'm reading this right, the sequence is this:&lt;/p&gt;

&lt;p&gt;1&amp;gt; the test changes the configs, kicking off reloads for the cores&lt;br/&gt;
2&amp;gt; the test deletes the collection&lt;/p&gt;

&lt;p&gt;&amp;lt;2&amp;gt; happens before &amp;lt;1&amp;gt; is complete, thus the race as the reload doesn't get around to reloading the core after the delete happens and the core is closed. Is this about right?&lt;/p&gt;

&lt;p&gt;Tim's comment about a delay suggests that if we waited for the config changes to complete reloading before continuing the test we'd be OK. It seems like a better option would be to have Solr not start the delete while reloads were pending. Or more generally not start carrying out one command while another potentially conflicting operation was being carried.&lt;/p&gt;

&lt;p&gt;Not sure how hard having Solr be smart enough to delay "potentially conflicting" operations would be though.&lt;/p&gt;</comment>
                            <comment id="15131652" author="noble.paul" created="Wed, 3 Feb 2016 20:23:32 -0700">&lt;blockquote&gt;&lt;p&gt;This feels a little like a band-aid. &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Erick, I'm not trying to make this test pass. This is a more serious issue. A race condition should not put a core in an unrecoverable error situation. This would cause SolrCloud to lose replicas randomly. I'm surprised users have not experienced it yet . So, this fix must be done anyway. &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Tim's comment about a delay suggests that if we waited for the config changes to complete reloading before continuing the test we'd be OK&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;That is fine if you wish to just avoid hitting the race condition. But in this case we should be glad that this test has uncovered a race condition&lt;/p&gt;</comment>
                            <comment id="15131762" author="erickerickson" created="Wed, 3 Feb 2016 22:33:02 -0700">&lt;p&gt;Noble:&lt;/p&gt;

&lt;p&gt;Well, perhaps I phrased things poorly, so let's start over and not even consider the test.&lt;/p&gt;

&lt;p&gt;bq: A race condition should not put a core in an unrecoverable error situation&lt;/p&gt;

&lt;p&gt;Totally agree. If I understand the patch though, the reload operation and the delete operation are competing. In this particular case the reload was caused by changing the configs, but that's largely immaterial. The delete got in there before the reload operation and closed the core. What happens with throwing this new exception is that the reload operation still fails in the sense that the core is still unavailable right? I don't quite see how throwing a new exception and catching it but not adding it to the failures list changes the fact that the core failed to reload; it's still unavailable. How does it ever recover?&lt;/p&gt;

&lt;p&gt;Or are you saying that in this case, since the core is deleted it really doesn't &lt;em&gt;need&lt;/em&gt; to recover? That still doesn't seem to cover the general case of the core being closed during a reload operation. There's a comment somewhere in the code that perhaps the reload should be retried. It'll still fail in this case, but are there others where reloading will succeed and thus we should retry?&lt;/p&gt;

&lt;p&gt;All that said, it'll be at least tomorrow night before I can beast this patch....&lt;/p&gt;


</comment>
                            <comment id="15131772" author="noble.paul" created="Wed, 3 Feb 2016 22:42:35 -0700">&lt;p&gt;the CoreContainer.coreInitFailures is a map which is intended to track a core that  has failed to load, most likely due to unrecoverable errors (such as index corruption).  This prevents other operations as well (such as delete) because any operation involving that core would consult this map  .A race condition is not unrecoverable. Imagine the race condition didn't occur, the core would not have been entered into this unrecoverable list and that is the expected behavior &lt;/p&gt;</comment>
                            <comment id="15189592" author="erickerickson" created="Thu, 10 Mar 2016 10:26:50 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt; Should we commit this? I just beasted this for 1,00 runs last night. I saw some failures, but they were either "zombie threads" or "suite timeout exceeded" which I don't think are relevant to this code.&lt;/p&gt;</comment>
                            <comment id="15189597" author="noble.paul" created="Thu, 10 Mar 2016 10:30:55 -0700">&lt;p&gt;it surely would have avoided the failures. I was asking for a second opinion from others to review the code and confirm there are no unintended consequences.&lt;/p&gt;

&lt;p&gt;I guess we should commit this and get this into 6.0 anyway&lt;/p&gt;</comment>
                            <comment id="15189786" author="jira-bot" created="Thu, 10 Mar 2016 12:20:09 -0700">&lt;p&gt;Commit 8cc978b53b1299a27de492d7114cd2d4e353b6cb in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=8cc978b" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=8cc978b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8135" title="SolrCloudExampleTest.testLoadDocsIntoGettingStartedCollection reproducible failure" class="issue-link" data-issue-key="SOLR-8135"&gt;&lt;del&gt;SOLR-8135&lt;/del&gt;&lt;/a&gt;: SolrCloudExampleTest.testLoadDocsIntoGettingStartedCollection reproducible failure&lt;/p&gt;</comment>
                            <comment id="15189794" author="jira-bot" created="Thu, 10 Mar 2016 12:24:08 -0700">&lt;p&gt;Commit 6689e1c55a7efffadb18d25179d9d87c121af5d0 in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=6689e1c" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=6689e1c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8135" title="SolrCloudExampleTest.testLoadDocsIntoGettingStartedCollection reproducible failure" class="issue-link" data-issue-key="SOLR-8135"&gt;&lt;del&gt;SOLR-8135&lt;/del&gt;&lt;/a&gt;: SolrCloudExampleTest.testLoadDocsIntoGettingStartedCollection reproducible failure&lt;/p&gt;</comment>
                            <comment id="15189795" author="jira-bot" created="Thu, 10 Mar 2016 12:24:09 -0700">&lt;p&gt;Commit 96b059c9dd67eef3a49da63d388fac7f4d3809f2 in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=96b059c" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=96b059c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8135" title="SolrCloudExampleTest.testLoadDocsIntoGettingStartedCollection reproducible failure" class="issue-link" data-issue-key="SOLR-8135"&gt;&lt;del&gt;SOLR-8135&lt;/del&gt;&lt;/a&gt;: SolrCloudExampleTest.testLoadDocsIntoGettingStartedCollection reproducible failure&lt;/p&gt;</comment>
                            <comment id="15189801" author="jira-bot" created="Thu, 10 Mar 2016 12:27:44 -0700">&lt;p&gt;Commit 4a795ee371c1bb19285cca0fb7336807f6e2840f in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=4a795ee" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=4a795ee&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8135" title="SolrCloudExampleTest.testLoadDocsIntoGettingStartedCollection reproducible failure" class="issue-link" data-issue-key="SOLR-8135"&gt;&lt;del&gt;SOLR-8135&lt;/del&gt;&lt;/a&gt;: typo in comment&lt;/p&gt;</comment>
                            <comment id="15189807" author="jira-bot" created="Thu, 10 Mar 2016 12:29:31 -0700">&lt;p&gt;Commit 72f6261f55b6d851d071c8358a05b52e019416c9 in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=72f6261" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=72f6261&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8135" title="SolrCloudExampleTest.testLoadDocsIntoGettingStartedCollection reproducible failure" class="issue-link" data-issue-key="SOLR-8135"&gt;&lt;del&gt;SOLR-8135&lt;/del&gt;&lt;/a&gt;: SolrCloudExampleTest.testLoadDocsIntoGettingStartedCollection reproducible failure&lt;/p&gt;</comment>
                            <comment id="15189808" author="jira-bot" created="Thu, 10 Mar 2016 12:29:33 -0700">&lt;p&gt;Commit d3f310a18d3c7787219515e82b76d18ef6a8e050 in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d3f310a" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d3f310a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8135" title="SolrCloudExampleTest.testLoadDocsIntoGettingStartedCollection reproducible failure" class="issue-link" data-issue-key="SOLR-8135"&gt;&lt;del&gt;SOLR-8135&lt;/del&gt;&lt;/a&gt;: SolrCloudExampleTest.testLoadDocsIntoGettingStartedCollection reproducible failure&lt;/p&gt;</comment>
                            <comment id="15189809" author="jira-bot" created="Thu, 10 Mar 2016 12:29:34 -0700">&lt;p&gt;Commit a774273c641b7f95b09da9440ef43f24f5207584 in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=a774273" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=a774273&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8135" title="SolrCloudExampleTest.testLoadDocsIntoGettingStartedCollection reproducible failure" class="issue-link" data-issue-key="SOLR-8135"&gt;&lt;del&gt;SOLR-8135&lt;/del&gt;&lt;/a&gt;: typo in comment&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12903200">SOLR-8142</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12765283" name="SOLR-8135.failure.log" size="937487" author="hossman" created="Tue, 6 Oct 2015 16:27:37 -0700"/>
                            <attachment id="12785982" name="SOLR-8135.patch" size="5137" author="noble.paul" created="Wed, 3 Feb 2016 00:57:42 -0700"/>
                            <attachment id="12767506" name="SOLR-8135.patch" size="2036" author="erickerickson" created="Mon, 19 Oct 2015 17:44:39 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 17 Oct 2015 12:00:57 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2mnxz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8082] can't query against negative float or double values when indexed="false" docValues="true" multiValued="false"</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8082</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Haven't dug into this yet, but something is evidently wrong in how the DocValues based queries get build for single valued float or double fields when negative numbers are involved.&lt;/p&gt;

&lt;p&gt;Steps to reproduce...&lt;/p&gt;

&lt;div class="preformatted panel" style="border-width: 1px;"&gt;&lt;div class="preformattedContent panelContent"&gt;
&lt;pre&gt;$ bin/solr -e schemaless -noprompt
...
$ curl -X POST -H 'Content-type:application/json' --data-binary '{ "add-field":{ "name":"f_dv_multi", "type":"tfloat", "stored":"true", "indexed":"false", "docValues":"true", "multiValued":"true" }, "add-field":{ "name":"f_dv_single", "type":"tfloat", "stored":"true", "indexed":"false", "docValues":"true", "multiValued":"false" } }' http://localhost:8983/solr/gettingstarted/schema
{
  "responseHeader":{
    "status":0,
    "QTime":84}}
$ curl -X POST -H 'Content-type:application/json' --data-binary '[{"id":"test", "f_dv_multi":-4.3, "f_dv_single":-4.3}]' 'http://localhost:8983/solr/gettingstarted/update/json/docs?commit=true'
{"responseHeader":{"status":0,"QTime":57}}
$ curl 'http://localhost:8983/solr/gettingstarted/query?q=f_dv_multi:"-4.3"'
{
  "responseHeader":{
    "status":0,
    "QTime":5,
    "params":{
      "q":"f_dv_multi:\"-4.3\""}},
  "response":{"numFound":1,"start":0,"docs":[
      {
        "id":"test",
        "f_dv_multi":[-4.3],
        "f_dv_single":-4.3,
        "_version_":1512962117004689408}]
  }}
$ curl 'http://localhost:8983/solr/gettingstarted/query?q=f_dv_single:"-4.3"'
{
  "responseHeader":{
    "status":0,
    "QTime":5,
    "params":{
      "q":"f_dv_single:\"-4.3\""}},
  "response":{"numFound":0,"start":0,"docs":[]
  }}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Explicit range queries (which is how numeric "field" queries are implemented under the cover) are equally problematic...&lt;/p&gt;

&lt;div class="preformatted panel" style="border-width: 1px;"&gt;&lt;div class="preformattedContent panelContent"&gt;
&lt;pre&gt;$ curl 'http://localhost:8983/solr/gettingstarted/query?q=f_dv_multi:%5B-4.3+TO+-4.3%5D'
{
  "responseHeader":{
    "status":0,
    "QTime":0,
    "params":{
      "q":"f_dv_multi:[-4.3 TO -4.3]"}},
  "response":{"numFound":1,"start":0,"docs":[
      {
        "id":"test",
        "f_dv_multi":[-4.3],
        "f_dv_single":-4.3,
        "_version_":1512962117004689408}]
  }}
$ curl 'http://localhost:8983/solr/gettingstarted/query?q=f_dv_single:%5B-4.3+TO+-4.3%5D'
{
  "responseHeader":{
    "status":0,
    "QTime":0,
    "params":{
      "q":"f_dv_single:[-4.3 TO -4.3]"}},
  "response":{"numFound":0,"start":0,"docs":[]
  }}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment/>
        <key id="12895270">SOLR-8082</key>
            <summary>can't query against negative float or double values when indexed="false" docValues="true" multiValued="false"</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="steve_rowe">Steve Rowe</assignee>
                                    <reporter username="hossman">Hoss Man</reporter>
                        <labels>
                    </labels>
                <created>Mon, 21 Sep 2015 15:13:57 -0700</created>
                <updated>Wed, 27 Apr 2016 16:54:08 -0700</updated>
                            <resolved>Wed, 27 Apr 2016 16:54:08 -0700</resolved>
                                                    <fixVersion>5.5.1</fixVersion>
                    <fixVersion>5.6</fixVersion>
                    <fixVersion>6.0</fixVersion>
                    <fixVersion>6.1</fixVersion>
                    <fixVersion>master</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="14903674" author="hossman" created="Tue, 22 Sep 2015 16:46:49 -0700">&lt;p&gt;the attached patch demonstrates the breadth of the problems i've found with queries against &lt;em&gt;negative&lt;/em&gt; values in both float and double based docvalues (only) fields &amp;#8211; ie: queries in which DocValuesRangeQuery is used instead of the inverted index (via NumericRangeQuery)&lt;/p&gt;

&lt;p&gt;I'm still not really clear what the root bug / fix is, but best i can tell this is ultimately about a disconnect between how the DocValuesRangeQuery objects are built at query time (using NumericUtils.floatToSortableInt and NumericUtils.doubleToSortableLong) vs how the NumericDocValuesField objects are build at index time (using Float.floatToIntBits and Double.doubleToLongBits)&lt;/p&gt;

&lt;p&gt;My bare bones understanding is that both places should be using NumericUtils.floatToSortableInt and NumericUtils.doubleToSortableLong &amp;#8211; but (besides being a back compat break on how the values are written to disk) if that's the case then why does sorting work for negative float values today? (see DocValuesTest.testDocValuesSorting2, which &amp;#8211; in addition to many faceting tests &amp;#8211; broke when i experimented with using NumericUtils.floatToSortableInt and NumericUtils.doubleToSortableLong to build the NumericDocValuesField in TrieField.createFields)&lt;/p&gt;

&lt;p&gt;Can anyone explain to me:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;when/why floatToIntBits &amp;amp; doubleToLongBits should be used instead of floatToSortableInt &amp;amp; doubleToSortableLong&lt;/li&gt;
	&lt;li&gt;how to fix these tests so they pass and queries against negative float / double values will work?&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14903676" author="hossman" created="Tue, 22 Sep 2015 16:48:26 -0700">&lt;p&gt;updated summary &amp;amp; description to capture new info (affects doubles, only seems to affect negative values)&lt;/p&gt;</comment>
                            <comment id="15193588" author="ichattopadhyaya" created="Mon, 14 Mar 2016 09:34:27 -0700">&lt;p&gt;Probably related to &lt;a href="https://issues.apache.org/jira/browse/SOLR-8838" title="Returning non-stored docValues is incorrect for floats and doubles" class="issue-link" data-issue-key="SOLR-8838"&gt;&lt;del&gt;SOLR-8838&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15195456" author="ichattopadhyaya" created="Tue, 15 Mar 2016 08:11:34 -0700">&lt;p&gt;Here's a summary of my understanding / observations:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Floats and doubles need to be converted to longs before writing them to NumericDocValues.&lt;/li&gt;
	&lt;li&gt;We have two options, Double.doubleToLongBits() and NumericUtils.doubleToSortableLong(). For positive doubles, both these methods return the same long value, but different ones for negative doubles.&lt;/li&gt;
	&lt;li&gt;Currently, we use Double.doubleToLongBits() to write these doubles/floats. Hence, to use term query against such docValues, we should use the same method with the query value, but current code uses NumericUtils.doubleToSortableLong() during querying and hence term queries against negative values fail. Similarly, range queries also fail when min is negative.&lt;/li&gt;
	&lt;li&gt;I tried changing initial writing logic to use NumericUtils.doubleToSortableLong(). With this change, both term queries and range queries work, but sorting fails (when there are negative values). That is counter intuitive, since the individual long values themselves are in sorted order. Since this is an intrusive change that breaks backcompat, I didn't investigate deeper to understand why this is happening.&lt;/li&gt;
	&lt;li&gt;To arrive at a least intrusive fix, I tried changing the range query logic to split out the queries into two distinct ranges (negatives and positives) using a boolean query. I had to do this since the Double.doubleToLongBits() values are not monotonically increasing (they are decreasing for Double.MIN_VALUE to 0, but increasing for 0 to Double.MAX_VALUE).&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Attached the patch for the last point, which I think is the least intrusive way to pull things together so that they work. When the range query crosses the 0 boundary, there are two dv range queries which is less efficient, but better than not working at all (which is the case today). The patch passes the tests, but it might benefit from some neater refactoring.&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hossman" class="user-hover" rel="hossman"&gt;Hoss Man&lt;/a&gt; Can you please review? Do you think there's a cleaner way to do this?&lt;/p&gt;</comment>
                            <comment id="15195459" author="ichattopadhyaya" created="Tue, 15 Mar 2016 08:14:00 -0700">&lt;blockquote&gt;&lt;p&gt;if that's the case then why does sorting work for negative float values today?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It is something even I was unable to figure out and surprises me, since the converted long values currently written to disk (as a result of Double.doubleToLongBits()) are not monotonic.&lt;/p&gt;</comment>
                            <comment id="15197467" author="ichattopadhyaya" created="Wed, 16 Mar 2016 08:09:19 -0700">&lt;p&gt;Tackling some boundary cases, added another test (testFloatRangeQuery). This is still WIP, I'm working on:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;A randomized test for ranges&lt;/li&gt;
	&lt;li&gt;Cleanup / refactor&lt;/li&gt;
	&lt;li&gt;Better handling and testing around inclusion operators&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;This approach looks clumsy, but might be the least intrusive way of getting this to work? Once done with this patch, I'll take a shot at evaluating, once again, as to possibly rewriting the logic for writing floats/doubles as longs into docValues.&lt;/p&gt;</comment>
                            <comment id="15197578" author="ichattopadhyaya" created="Wed, 16 Mar 2016 09:07:15 -0700">&lt;p&gt;Updated the patch, refactored the fix and a test. Still WIP and the above TODO items are not here.&lt;/p&gt;</comment>
                            <comment id="15199455" author="ichattopadhyaya" created="Thu, 17 Mar 2016 05:59:41 -0700">&lt;p&gt;Updating the patch. This contains a randomized test, which I am currently beasting now.&lt;br/&gt;
This depends on a patch for a bug I found during testing this, &lt;a href="https://issues.apache.org/jira/browse/LUCENE-7111" title="DocValuesRangeQuery.newLongRange behaves incorrectly for Long.MAX_VALUE and Long.MIN_VALUE" class="issue-link" data-issue-key="LUCENE-7111"&gt;&lt;del&gt;LUCENE-7111&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;If the beasting goes fine, I think this is a fix that behaves correctly. But, still not sure if this is the best fix to have, since there possibly exists another alternative (which I'll look into after this) to write the longs in sortable order itself.&lt;/p&gt;</comment>
                            <comment id="15199538" author="yseeley@gmail.com" created="Thu, 17 Mar 2016 06:47:16 -0700">&lt;p&gt;Building a boolean query is the slowest option of all (will look up all the values twice and has overhead)... coverting to a float/double would be faster (that should actually be a no-op... so it would be down to how fast the floating point comparisons are vs long comparisons).  If we did want to keep things in "long" space rather than converting, then perhaps just create our own version that does an additional comparison when needed.&lt;/p&gt;

&lt;p&gt;I was going to suggest that we could also just try the built-in range support in valuesource &lt;br/&gt;
FunctionValues.getRangeScorer()... but I forgot to bring back the "only match docs with a value" patch from heliosearch.&lt;/p&gt;</comment>
                            <comment id="15199598" author="ichattopadhyaya" created="Thu, 17 Mar 2016 07:22:27 -0700">&lt;blockquote&gt;&lt;p&gt;Building a boolean query is the slowest option of all (will look up all the values twice and has overhead)... coverting to a float/double would be faster &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Do you mean that instead of using the DocValuesRangeQuery.newLongRange(), we write something on our own which converts the longs back to floats/doubles and then compares those floats/doubles?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;If we did want to keep things in "long" space rather than converting, then perhaps just create our own version that does an additional comparison when needed.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Do you think the NumericUtils.doubleToSortableLong() is a good choice for converting float/double to longs, instead of Double.doubleToLongBits() which is currently used? I think this would ensure that the range queries would just work out of the box without such handling of special cases. Also, is it okay to change the way we convert floats/doubles to longs in terms of backward compatibility?&lt;/p&gt;</comment>
                            <comment id="15199673" author="yseeley@gmail.com" created="Thu, 17 Mar 2016 08:06:31 -0700">&lt;blockquote&gt;&lt;p&gt;Do you mean that instead of using the DocValuesRangeQuery.newLongRange(), we write something on our own which converts the longs back to floats/doubles and then compares those floats/doubles?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yeah, that's one way.&lt;br/&gt;
But maybe we should go ahead and fix ValueSourceRangeFilter to not match documents w/o a value in the field.  It's arguably a bug (and only existed historically because we didn't have info about what fields had a value for numerics, and didn't have exists()) and 6.0 is the perfect time to make the change.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Do you think the NumericUtils.doubleToSortableLong() is a good choice for converting float/double to longs, instead of Double.doubleToLongBits() which is currently used?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Both have their advantages... while sortable longs might be convenient when operating in the "long" space, it would slow things down when converting back to a double.  &lt;/p&gt;</comment>
                            <comment id="15199978" author="hossman" created="Thu, 17 Mar 2016 10:22:10 -0700">&lt;blockquote&gt;&lt;p&gt;Building a boolean query is the slowest option of all (will look up all the values twice and has overhead)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;"A patch in jira ready to be committed is worth two hypothetical patches no one has contributed yet."&lt;/p&gt;

&lt;p&gt;As things stand today, a query where either end point is less then 0  is completely broken &amp;#8211; a "slow" boolean query that is correct sounds better to me then the broken behavior &amp;#8211; even if it's just a short term gap for 6.0 and we have plans for a better solution down the road.  Particularly since (unless i'm missing something) any existing situation where the code works correctly today will continue to work correctly with the same performance after this patch (ie: purely positive ranges will continue to be implemented w/o a BQ using a purely positive range query.)&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;But maybe we should go ahead and fix ValueSourceRangeFilter to not match documents w/o a value in the field. It's arguably a bug&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That seems like it should be broken out into a distinct $new_jira since it has larger implications/impacts.  (if we want to make this issue blocked by $new_jira then so be it, but they should still be distinct issues)&lt;/p&gt;</comment>
                            <comment id="15200232" author="yseeley@gmail.com" created="Thu, 17 Mar 2016 12:45:56 -0700">&lt;blockquote&gt;&lt;p&gt;a "slow" boolean query that is correct sounds better to me then the broken behavior&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Hopefully no one is suggesting that we not fix this (somehow) for 6.0&lt;br/&gt;
I was just using the opportunity to fix another bug that would also help with this one.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;That seems like it should be broken out&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That's what  &lt;a href="https://issues.apache.org/jira/browse/SOLR-8867" title="frange / ValueSourceRangeFilter / FunctionValues.getRangeScorer should not match documents w/o a value" class="issue-link" data-issue-key="SOLR-8867"&gt;SOLR-8867&lt;/a&gt; is about.&lt;/p&gt;</comment>
                            <comment id="15200248" author="ichattopadhyaya" created="Thu, 17 Mar 2016 12:53:54 -0700">&lt;blockquote&gt;&lt;p&gt;Hopefully no one is suggesting that we not fix this (somehow) for 6.0&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I think seems this like a bad enough bug for us to fix right away, also given our latest push for using all fields with docvalues and also given the push for having some of them unstored. With range queries completely broken, I think we should push for it for 6.0, or a 6.0.1 if not ready right away. I think it is safe to do so, as long as a targeted fix doesn't make things worse than what it already is. What do you think? &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org" class="user-hover" rel="yonik@apache.org"&gt;Yonik Seeley&lt;/a&gt; &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hossman" class="user-hover" rel="hossman"&gt;Hoss Man&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15200800" author="yseeley@gmail.com" created="Thu, 17 Mar 2016 18:48:44 -0700">&lt;p&gt;Here's an updated patch that uses the same method as &lt;/p&gt;
{!frange}
&lt;p&gt; for a range query.  I took the conservative approach and just replaced the boolean query in the previous patch, leaving the previous non-negative ranges untouched.&lt;/p&gt;

&lt;p&gt;Thanks to the excellent tests in the previous patches,  it helped uncover a limitation in ValueSourceRangeFilter that prevented including infinite endpoints.&lt;/p&gt;

&lt;p&gt;I had to make one change to the tests: I removed -0 as a special value in testFloatAndDoubleRangeQueryRandom.  Since -0 == +0, any range including one should include the other.  I don't think we should support or guarantee behavior of "different zeros" in any case - way to many potential bugs, and it limits us from an implementation standpoint (different bit patterns for equivalent values).&lt;/p&gt;</comment>
                            <comment id="15201502" author="ichattopadhyaya" created="Fri, 18 Mar 2016 07:05:59 -0700">&lt;p&gt;Thanks Yonik, the patch looks good. The test is passing for me.&lt;br/&gt;
Do you think we should rely on FunctionRangeQuery for the entire number line, or should we just use this for the negative range? To me, both looked similar in terms of performance.&lt;/p&gt;</comment>
                            <comment id="15201515" author="yseeley@gmail.com" created="Fri, 18 Mar 2016 07:12:10 -0700">&lt;blockquote&gt;&lt;p&gt;Do you think we should rely on FunctionRangeQuery for the entire number line&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Perhaps eventually?  I was trying to be conservative and not create any performance regressions for the stuff that does work.&lt;br/&gt;
I don't have time for performance tests right now (and I know from looking that the frange stuff can be sped up as well in a lot of places... we no longer need to wrap a filter, exists() looks slow in many function value implementations, etc.)  May be better to tackle that stuff after 6.0&lt;/p&gt;</comment>
                            <comment id="15201529" author="ichattopadhyaya" created="Fri, 18 Mar 2016 07:19:46 -0700">&lt;p&gt;Indeed! +1 to fixing the issue for 6.0 with the current patch (except for the stale comment &lt;tt&gt;If min is negative (or -0d) and max is positive (or +0d), then issue two range queries&lt;/tt&gt;, which was left over an older patch).&lt;/p&gt;</comment>
                            <comment id="15202927" author="steve_rowe" created="Sat, 19 Mar 2016 12:17:13 -0700">&lt;p&gt;Patch with a few minor cleanups:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;In &lt;tt&gt;TrieField.getRangeQueryForFloatDoubleDocValues()&lt;/tt&gt;:
	&lt;ul&gt;
		&lt;li&gt;Made constants for invariants (bits for infinities and zeros), in case the compiler isn't smart enough to do that.&lt;/li&gt;
		&lt;li&gt;Added parens in a couple of expressions to improve legibility.&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;In &lt;tt&gt;DocValuesTest&lt;/tt&gt;:
	&lt;ul&gt;
		&lt;li&gt;In &lt;tt&gt;testFloatAndDoubleRangeQueryRandom()&lt;/tt&gt;:
		&lt;ul&gt;
			&lt;li&gt;Converted several &lt;tt&gt;fieldName[i].equals("floatdv") ? ... : ...&lt;/tt&gt; trinary operators to use (float,double) tuples (like the other values in this test), using lambdas.&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
		&lt;li&gt;In &lt;tt&gt;testFloatAndDoubleRangeQuery()&lt;/tt&gt;:
		&lt;ul&gt;
			&lt;li&gt;&lt;tt&gt;negativeInfinity[1]&lt;/tt&gt; fixed: Float-&amp;gt;Double&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;&lt;blockquote&gt;&lt;p&gt;+1 to fixing the issue for 6.0 with the current patch (except for the stale comment &lt;tt&gt;If min is negative (or -0d) and max is positive (or +0d), then issue two range queries&lt;/tt&gt;, which was left over an older patch).&lt;/p&gt;&lt;/blockquote&gt;
	&lt;ul&gt;
		&lt;li&gt;The patch fixes this too: &lt;tt&gt;s/two range queries/FunctionRangeQuery/&lt;/tt&gt;&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I'll commit tomorrow if no objections and nobody else gets to it first.&lt;/p&gt;</comment>
                            <comment id="15203103" author="ichattopadhyaya" created="Sat, 19 Mar 2016 21:42:07 -0700">&lt;p&gt;+1, LGTM.&lt;/p&gt;</comment>
                            <comment id="15203521" author="jira-bot" created="Sun, 20 Mar 2016 13:56:01 -0700">&lt;p&gt;Commit 49d5ec02a2015ddd80059d46788b723b25cb5491 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe" class="user-hover" rel="steve_rowe"&gt;Steve Rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=49d5ec0" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=49d5ec0&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8082" title="can&amp;#39;t query against negative float or double values when indexed=&amp;quot;false&amp;quot; docValues=&amp;quot;true&amp;quot; multiValued=&amp;quot;false&amp;quot;" class="issue-link" data-issue-key="SOLR-8082"&gt;&lt;del&gt;SOLR-8082&lt;/del&gt;&lt;/a&gt;: Can't query against negative float or double values when indexed='false' docValues='true' multiValued='false'&lt;/p&gt;</comment>
                            <comment id="15203523" author="jira-bot" created="Sun, 20 Mar 2016 13:57:09 -0700">&lt;p&gt;Commit 2668ff5abb16e867f9f770d1da65457161b52cda in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe" class="user-hover" rel="steve_rowe"&gt;Steve Rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=2668ff5" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=2668ff5&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8082" title="can&amp;#39;t query against negative float or double values when indexed=&amp;quot;false&amp;quot; docValues=&amp;quot;true&amp;quot; multiValued=&amp;quot;false&amp;quot;" class="issue-link" data-issue-key="SOLR-8082"&gt;&lt;del&gt;SOLR-8082&lt;/del&gt;&lt;/a&gt;: Can't query against negative float or double values when indexed='false' docValues='true' multiValued='false'&lt;/p&gt;</comment>
                            <comment id="15203525" author="jira-bot" created="Sun, 20 Mar 2016 13:57:44 -0700">&lt;p&gt;Commit c3d0276b2f50ca6c1b8dd1298fc2e214c4020dbf in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe" class="user-hover" rel="steve_rowe"&gt;Steve Rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c3d0276" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c3d0276&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8082" title="can&amp;#39;t query against negative float or double values when indexed=&amp;quot;false&amp;quot; docValues=&amp;quot;true&amp;quot; multiValued=&amp;quot;false&amp;quot;" class="issue-link" data-issue-key="SOLR-8082"&gt;&lt;del&gt;SOLR-8082&lt;/del&gt;&lt;/a&gt;: Can't query against negative float or double values when indexed='false' docValues='true' multiValued='false'&lt;/p&gt;</comment>
                            <comment id="15203561" author="jira-bot" created="Sun, 20 Mar 2016 16:09:28 -0700">&lt;p&gt;Commit b2a4003d4c91d2e7e8f46b546bf1ac988b95ad3f in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi" class="user-hover" rel="thetaphi"&gt;Uwe Schindler&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b2a4003" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b2a4003&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8082" title="can&amp;#39;t query against negative float or double values when indexed=&amp;quot;false&amp;quot; docValues=&amp;quot;true&amp;quot; multiValued=&amp;quot;false&amp;quot;" class="issue-link" data-issue-key="SOLR-8082"&gt;&lt;del&gt;SOLR-8082&lt;/del&gt;&lt;/a&gt;: Fix forbidden APIs&lt;/p&gt;</comment>
                            <comment id="15203562" author="jira-bot" created="Sun, 20 Mar 2016 16:10:20 -0700">&lt;p&gt;Commit 1d98753e2e3b4a30b799c4a15dcbea25c279979e in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi" class="user-hover" rel="thetaphi"&gt;Uwe Schindler&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=1d98753" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=1d98753&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8082" title="can&amp;#39;t query against negative float or double values when indexed=&amp;quot;false&amp;quot; docValues=&amp;quot;true&amp;quot; multiValued=&amp;quot;false&amp;quot;" class="issue-link" data-issue-key="SOLR-8082"&gt;&lt;del&gt;SOLR-8082&lt;/del&gt;&lt;/a&gt;: Fix forbidden APIs&lt;/p&gt;</comment>
                            <comment id="15203563" author="jira-bot" created="Sun, 20 Mar 2016 16:11:21 -0700">&lt;p&gt;Commit 8c0271cbb8ff82dd3c218bcbad5834905e489273 in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi" class="user-hover" rel="thetaphi"&gt;Uwe Schindler&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=8c0271c" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=8c0271c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8082" title="can&amp;#39;t query against negative float or double values when indexed=&amp;quot;false&amp;quot; docValues=&amp;quot;true&amp;quot; multiValued=&amp;quot;false&amp;quot;" class="issue-link" data-issue-key="SOLR-8082"&gt;&lt;del&gt;SOLR-8082&lt;/del&gt;&lt;/a&gt;: Fix forbidden APIs&lt;/p&gt;</comment>
                            <comment id="15256553" author="anshumg" created="Mon, 25 Apr 2016 09:36:00 -0700">&lt;p&gt;Is this something that should make it's way to 5x too? &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yseeley%40gmail.com" class="user-hover" rel="yseeley@gmail.com"&gt;Yonik Seeley&lt;/a&gt;, &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe" class="user-hover" rel="steve_rowe"&gt;Steve Rowe&lt;/a&gt;, &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ichattopadhyaya" class="user-hover" rel="ichattopadhyaya"&gt;Ishan Chattopadhyaya&lt;/a&gt;, and others who were involved here ?&lt;/p&gt;</comment>
                            <comment id="15256763" author="steve_rowe" created="Mon, 25 Apr 2016 11:40:24 -0700">&lt;p&gt;Yes &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anshumg" class="user-hover" rel="anshumg"&gt;Anshum Gupta&lt;/a&gt;, I think it would make sense for 5x too.&lt;/p&gt;</comment>
                            <comment id="15256871" author="ichattopadhyaya" created="Mon, 25 Apr 2016 12:34:53 -0700">&lt;p&gt;Yes, Anshum. I think this should be backported to 5x, and also released as part of 5.5.1.&lt;/p&gt;</comment>
                            <comment id="15260729" author="steve_rowe" created="Wed, 27 Apr 2016 11:45:20 -0700">&lt;p&gt;Reopening to backport to branch_5x and branch_5_5. &lt;/p&gt;</comment>
                            <comment id="15261186" author="jira-bot" created="Wed, 27 Apr 2016 16:28:28 -0700">&lt;p&gt;Commit 79636a73fc1543fa69bdc5081f3fb20e108fce75 in lucene-solr's branch refs/heads/branch_5x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe" class="user-hover" rel="steve_rowe"&gt;Steve Rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=79636a7" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=79636a7&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8082" title="can&amp;#39;t query against negative float or double values when indexed=&amp;quot;false&amp;quot; docValues=&amp;quot;true&amp;quot; multiValued=&amp;quot;false&amp;quot;" class="issue-link" data-issue-key="SOLR-8082"&gt;&lt;del&gt;SOLR-8082&lt;/del&gt;&lt;/a&gt;: Can't query against negative float or double values when indexed='false' docValues='true' multiValued='false'&lt;/p&gt;</comment>
                            <comment id="15261233" author="jira-bot" created="Wed, 27 Apr 2016 16:53:18 -0700">&lt;p&gt;Commit f0f9081e345030dd8946fb0141b4315c193a88ce in lucene-solr's branch refs/heads/branch_5_5 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe" class="user-hover" rel="steve_rowe"&gt;Steve Rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f0f9081" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f0f9081&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8082" title="can&amp;#39;t query against negative float or double values when indexed=&amp;quot;false&amp;quot; docValues=&amp;quot;true&amp;quot; multiValued=&amp;quot;false&amp;quot;" class="issue-link" data-issue-key="SOLR-8082"&gt;&lt;del&gt;SOLR-8082&lt;/del&gt;&lt;/a&gt;: Can't query against negative float or double values when indexed='false' docValues='true' multiValued='false'&lt;/p&gt;</comment>
                            <comment id="15261235" author="steve_rowe" created="Wed, 27 Apr 2016 16:54:08 -0700">&lt;p&gt;In backporting to branch_5x I had to convert some lambdas to functors (for Java7), and was all ready to push, but when I pulled and got Yoniks &lt;a href="https://issues.apache.org/jira/browse/SOLR-8886" title="TrieField.toObject(IndexableField) can&amp;#39;t handle docValues" class="issue-link" data-issue-key="SOLR-8886"&gt;&lt;del&gt;SOLR-8886&lt;/del&gt;&lt;/a&gt; changes, there were conflicts, and attempts at merging brought in a shitload of extraneous crap, so I changed strategies: I applied the commit diffs from the two master commits on this issue with &lt;tt&gt;patch&lt;/tt&gt; and fixed up the rejects manually.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12721235">SOLR-6168</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12951075">LUCENE-7111</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12951240">SOLR-8867</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12949751">SOLR-8838</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12794376" name="SOLR-8082.patch" size="35012" author="steve_rowe" created="Sat, 19 Mar 2016 12:17:13 -0700"/>
                            <attachment id="12794104" name="SOLR-8082.patch" size="34585" author="yseeley@gmail.com" created="Thu, 17 Mar 2016 18:48:44 -0700"/>
                            <attachment id="12793973" name="SOLR-8082.patch" size="33394" author="ichattopadhyaya" created="Thu, 17 Mar 2016 05:59:41 -0700"/>
                            <attachment id="12793773" name="SOLR-8082.patch" size="20766" author="ichattopadhyaya" created="Wed, 16 Mar 2016 09:20:42 -0700"/>
                            <attachment id="12793768" name="SOLR-8082.patch" size="19573" author="ichattopadhyaya" created="Wed, 16 Mar 2016 09:07:15 -0700"/>
                            <attachment id="12793759" name="SOLR-8082.patch" size="19079" author="ichattopadhyaya" created="Wed, 16 Mar 2016 08:09:19 -0700"/>
                            <attachment id="12793552" name="SOLR-8082.patch" size="16488" author="ichattopadhyaya" created="Tue, 15 Mar 2016 08:11:34 -0700"/>
                            <attachment id="12761761" name="SOLR-8082.patch" size="9890" author="hossman" created="Tue, 22 Sep 2015 16:46:49 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 14 Mar 2016 16:34:27 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 week, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ldd3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-8035] Move solr/webapp to solr/server/solr-webapp</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8035</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Let's move solr/webapp &lt;b&gt;source&lt;/b&gt; files to their final actual distro destination.  This facilitates folks editing the UI in real-time (save change, refresh in browser) rather than having to "stop, ant server, restart" to see a change.&lt;/p&gt;</description>
                <environment/>
        <key id="12863212">SOLR-8035</key>
            <summary>Move solr/webapp to solr/server/solr-webapp</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="ehatcher">Erik Hatcher</assignee>
                                    <reporter username="ehatcher">Erik Hatcher</reporter>
                        <labels>
                    </labels>
                <created>Thu, 10 Sep 2015 14:43:26 -0700</created>
                <updated>Wed, 17 Feb 2016 13:28:10 -0700</updated>
                                                            <fixVersion>6.0</fixVersion>
                                    <component>UI</component>
                        <due/>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="14739667" author="ehatcher" created="Thu, 10 Sep 2015 14:48:49 -0700">&lt;p&gt;Here's a patch that moves the solr/webapp directory and adjusts the build files and svn ignores. &lt;/p&gt;

&lt;p&gt;What else is needed?&lt;/p&gt;</comment>
                            <comment id="14739673" author="ehatcher" created="Thu, 10 Sep 2015 14:50:38 -0700">&lt;p&gt;Sorry, that's a large patch - but really just svn move plus some build/ignore tweaks.  Here's just the build changes:&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
Index: solr/build.xml
===================================================================
--- solr/build.xml	(revision 1702327)
+++ solr/build.xml	(working copy)
@@ -316,7 +316,7 @@
     &amp;lt;license-check-macro dir=&lt;span class="code-quote"&gt;"${basedir}"&lt;/span&gt; licensedir=&lt;span class="code-quote"&gt;"${common-solr.dir}/licenses"&lt;/span&gt;&amp;gt;
       &amp;lt;additional-excludes&amp;gt;
         &amp;lt;exclude name=&lt;span class="code-quote"&gt;"example/exampledocs/post.jar"&lt;/span&gt; /&amp;gt;
-        &amp;lt;exclude name=&lt;span class="code-quote"&gt;"server/solr-webapp/**"&lt;/span&gt; /&amp;gt;
+        &amp;lt;!--&amp;lt;exclude name=&lt;span class="code-quote"&gt;"server/solr-webapp/**"&lt;/span&gt; /&amp;gt;--&amp;gt;
         &amp;lt;exclude name=&lt;span class="code-quote"&gt;"&lt;span class="code-keyword"&gt;package&lt;/span&gt;/**"&lt;/span&gt;/&amp;gt;
       &amp;lt;/additional-excludes&amp;gt;
       &amp;lt;additional-filters&amp;gt;
@@ -376,7 +376,7 @@
         &amp;lt;include name=&lt;span class="code-quote"&gt;"start.jar"&lt;/span&gt; /&amp;gt;
         &amp;lt;include name=&lt;span class="code-quote"&gt;"logs/*"&lt;/span&gt; /&amp;gt;
         &amp;lt;include name=&lt;span class="code-quote"&gt;"webapps"&lt;/span&gt; /&amp;gt;
-        &amp;lt;include name=&lt;span class="code-quote"&gt;"solr-webapp/**/*"&lt;/span&gt; /&amp;gt;
+        &amp;lt;!--&amp;lt;include name=&lt;span class="code-quote"&gt;"solr-webapp/**/*"&lt;/span&gt; /&amp;gt;--&amp;gt;
         &amp;lt;exclude name=&lt;span class="code-quote"&gt;"**/.gitignore"&lt;/span&gt; /&amp;gt;
       &amp;lt;/fileset&amp;gt;      
     &amp;lt;/delete&amp;gt;
Index: solr/webapp/build.xml
===================================================================
--- solr/webapp/build.xml	(revision 1702327)
+++ solr/webapp/build.xml	(working copy)
@@ -40,9 +40,9 @@
           description=&lt;span class="code-quote"&gt;"Creates the Webapp folder &lt;span class="code-keyword"&gt;for&lt;/span&gt; distribution."&lt;/span&gt;
           depends=&lt;span class="code-quote"&gt;"dist-core, dist-solrj, lucene-jars-to-solr"&lt;/span&gt;&amp;gt;
     &amp;lt;ant dir=&lt;span class="code-quote"&gt;"${common-solr.dir}"&lt;/span&gt; inheritall=&lt;span class="code-quote"&gt;"&lt;span class="code-keyword"&gt;false&lt;/span&gt;"&lt;/span&gt; target=&lt;span class="code-quote"&gt;"contribs-add-to-webapp"&lt;/span&gt;/&amp;gt;
-    &amp;lt;mkdir dir=&lt;span class="code-quote"&gt;"${server.dir}/solr-webapp/webapp"&lt;/span&gt;/&amp;gt;
+    &amp;lt;!--&amp;lt;mkdir dir=&lt;span class="code-quote"&gt;"${server.dir}/solr-webapp/webapp"&lt;/span&gt;/&amp;gt;--&amp;gt;
     &amp;lt;copy todir=&lt;span class="code-quote"&gt;"${server.dir}/solr-webapp/webapp"&lt;/span&gt;&amp;gt;
-      &amp;lt;fileset dir=&lt;span class="code-quote"&gt;"web"&lt;/span&gt; excludes=&lt;span class="code-quote"&gt;"${exclude.from.webapp}"&lt;/span&gt;/&amp;gt;
+      &amp;lt;!--&amp;lt;fileset dir=&lt;span class="code-quote"&gt;"web"&lt;/span&gt; excludes=&lt;span class="code-quote"&gt;"${exclude.from.webapp}"&lt;/span&gt;/&amp;gt;--&amp;gt;
       &amp;lt;fileset dir=&lt;span class="code-quote"&gt;"${dest}/web"&lt;/span&gt; excludes=&lt;span class="code-quote"&gt;"${exclude.from.war}"&lt;/span&gt;/&amp;gt; &amp;lt;!-- contribs' additions --&amp;gt;
     &amp;lt;/copy&amp;gt;
     &amp;lt;mkdir dir=&lt;span class="code-quote"&gt;"${server.dir}/solr-webapp/webapp/WEB-INF/lib"&lt;/span&gt;/&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14739732" author="elyograg" created="Thu, 10 Sep 2015 15:24:12 -0700">&lt;p&gt;I tried to grasp what this is doing from the patch, and couldn't really figure it out ... could I persuade you to give us the "svn move" command you used?&lt;/p&gt;</comment>
                            <comment id="14739874" author="ehatcher" created="Thu, 10 Sep 2015 16:55:35 -0700">&lt;p&gt;Sure thing &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=elyograg" class="user-hover" rel="elyograg"&gt;Shawn Heisey&lt;/a&gt; - I just recreated it (before I had done it with intellij but reverted and did it all command-line).   I'll upload a new patch that's just the build changes.  Apply the patch, run these commands and then "ant server".  Modifying any of the files under server/solr-webapp/webapp (maybe we can get rid of this "webapp" directory too and move things up a level?) are visible with just a browser refresh.&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
# current ignores are webapp and jsp, I don't think we need jsp ignored any more &lt;span class="code-keyword"&gt;do&lt;/span&gt; we?
svn propdel svn:ignore server/solr-webapp

svn mv webapp/web/ server/solr-webapp/webapp
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14739880" author="ehatcher" created="Thu, 10 Sep 2015 16:59:18 -0700">&lt;p&gt;Here's a simplified trunk patch (solr/ directory rooted) to go along with the previous commands.&lt;/p&gt;</comment>
                            <comment id="14739940" author="elyograg" created="Thu, 10 Sep 2015 17:51:40 -0700">&lt;p&gt;Ok, with that explanation and a glance at branch_5x, it all makes much more sense now.&lt;/p&gt;

&lt;p&gt;Thinking about the possible implications of moving one directory up (server/solr-webapp instead of server/solr-webapp/webapp), the only possible downside I can think of is that it will require more careful attention when upgrading Solr, and that's not much of a downside.&lt;/p&gt;

&lt;p&gt;Speaking of upgrading Solr, I have opened &lt;a href="https://issues.apache.org/jira/browse/SOLR-8036" title="Include step-by-step instructions and a script to upgrade an existing Solr install" class="issue-link" data-issue-key="SOLR-8036"&gt;SOLR-8036&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14739985" author="ehatcher" created="Thu, 10 Sep 2015 18:30:27 -0700">&lt;p&gt;Also, "svn propset svn:ignore lib server/solr-webapp/webapp/WEB-INF" is needed too.&lt;/p&gt;</comment>
                            <comment id="14741306" author="dsmiley" created="Fri, 11 Sep 2015 11:32:26 -0700">&lt;p&gt;+1 awesome&lt;/p&gt;</comment>
                            <comment id="14741604" author="markrmiller@gmail.com" created="Fri, 11 Sep 2015 15:01:51 -0700">&lt;p&gt;Might want to do a find for the old path in the files. I know a few scripts point to the old location at least.&lt;/p&gt;</comment>
                            <comment id="14741777" author="ehatcher" created="Fri, 11 Sep 2015 17:24:23 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com" class="user-hover" rel="markrmiller@gmail.com"&gt;Mark Miller&lt;/a&gt; - I didn't find anything that pointed to the "source" (solr/webapp), just ones that point to server/solr-webapp/webapp so we should be fine there, but definitely noted when/if we move things up a level.   In addition to the path I attached here, I did also find that ExternalPaths..java needed the change to make JettyWebappTest happy again.&lt;/p&gt;

&lt;p&gt;If there's something else that needs to change that I've missed, let me know.&lt;/p&gt;</comment>
                            <comment id="14742057" author="markrmiller@gmail.com" created="Sat, 12 Sep 2015 06:38:53 -0700">&lt;p&gt;Ah okay.&lt;/p&gt;</comment>
                            <comment id="14742187" author="upayavira" created="Sat, 12 Sep 2015 11:46:15 -0700">&lt;p&gt;I haven't had a chance to try the patch, but from what I understand of it, it will make UI development substantially easier. Many thanks!&lt;/p&gt;</comment>
                            <comment id="14987086" author="upayavira" created="Tue, 3 Nov 2015 04:02:53 -0700">&lt;p&gt;Just to note, I'm mulling on whether we might actually &lt;b&gt;need&lt;/b&gt; a build process.&lt;/p&gt;

&lt;p&gt;We have two conflicting needs:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;development time: change a file - commit it&lt;/li&gt;
	&lt;li&gt;build time: minify/merge/etc&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The latter currently isn't being done at all. There are many JS tools out there that do the equivalent of Ivy dependency management, and others that minify CSS/JS/HTML and then merge those files into a smaller number of files, such that the overall HTTP payload of the UI could be substantially reduced. For local loads this has never been an issue, but I have been to visit hosted Solr servers where the UI fails to load due to poor network connectivity.&lt;/p&gt;

&lt;p&gt;Ideally, "ant run" would run the UI in place, whereas "ant server" would execute a build process and produce minfied files/etc.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12755282" name="SOLR-8035.patch" size="2091" author="ehatcher" created="Thu, 10 Sep 2015 16:59:18 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 10 Sep 2015 22:24:12 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            26 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2k0uv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>

<item>
            <title>[SOLR-8002] Add column alias support to the Parallel SQL Interface </title>
                <link>https://issues.apache.org/jira/browse/SOLR-8002</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Currently field aliases are not supported for SQL queries against SQL Handler. E.g. below SQL query&lt;/p&gt;

&lt;p&gt; select id,name as product_name from techproducts limit 20&lt;/p&gt;

&lt;p&gt;currently fails as data returned contains still "name" as the field/column key than product_name&lt;/p&gt;</description>
                <environment/>
        <key id="12861170">SOLR-8002</key>
            <summary>Add column alias support to the Parallel SQL Interface </summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="joel.bernstein">Joel Bernstein</assignee>
                                    <reporter username="susheel2777@gmail.com">Susheel Kumar</reporter>
                        <labels>
                    </labels>
                <created>Tue, 1 Sep 2015 15:58:40 -0700</created>
                <updated>Tue, 12 Jan 2016 20:34:35 -0700</updated>
                            <resolved>Tue, 12 Jan 2016 13:48:13 -0700</resolved>
                                    <version>master</version>
                                    <fixVersion>6.0</fixVersion>
                                    <component>search</component>
                        <due/>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="14726539" author="joel.bernstein" created="Tue, 1 Sep 2015 18:14:27 -0700">&lt;p&gt;This is actually a new feature request. The SQL interface doesn't yet support field aliases.&lt;/p&gt;

&lt;p&gt;Also, &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=susheel2777%40gmail.com" class="user-hover" rel="susheel2777@gmail.com"&gt;Susheel Kumar&lt;/a&gt; patches are welcome!&lt;/p&gt;

&lt;p&gt;I'll be happy to review any patches in this area.&lt;/p&gt;</comment>
                            <comment id="14727352" author="dpgove" created="Wed, 2 Sep 2015 06:41:31 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-7669" title="Add SelectStream to Streaming API" class="issue-link" data-issue-key="SOLR-7669"&gt;&lt;del&gt;SOLR-7669&lt;/del&gt;&lt;/a&gt; adds a SelectStream to the streaming and expression apis. It includes support for both aliases and operations and might be a good basis for adding these features to the SQL api.&lt;/p&gt;</comment>
                            <comment id="14727429" author="joel.bernstein" created="Wed, 2 Sep 2015 07:35:26 -0700">&lt;p&gt;This makes sense. I haven't had a chance to review &lt;a href="https://issues.apache.org/jira/browse/SOLR-7669" title="Add SelectStream to Streaming API" class="issue-link" data-issue-key="SOLR-7669"&gt;&lt;del&gt;SOLR-7669&lt;/del&gt;&lt;/a&gt; yet. &lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=susheel2777%40gmail.com" class="user-hover" rel="susheel2777@gmail.com"&gt;Susheel Kumar&lt;/a&gt;, if you're working on a patch you might want to see if you can work with the SelectStream. You'll need to apply the patch from &lt;a href="https://issues.apache.org/jira/browse/SOLR-7669" title="Add SelectStream to Streaming API" class="issue-link" data-issue-key="SOLR-7669"&gt;&lt;del&gt;SOLR-7669&lt;/del&gt;&lt;/a&gt; as it's not yet in trunk.&lt;/p&gt;</comment>
                            <comment id="14728447" author="susheel2777@gmail.com" created="Wed, 2 Sep 2015 20:18:15 -0700">&lt;p&gt;Sure, Joel.  Let me start looking into the patch &lt;a href="https://issues.apache.org/jira/browse/SOLR-7669" title="Add SelectStream to Streaming API" class="issue-link" data-issue-key="SOLR-7669"&gt;&lt;del&gt;SOLR-7669&lt;/del&gt;&lt;/a&gt;. &lt;/p&gt;</comment>
                            <comment id="14736174" author="susheel2777@gmail.com" created="Tue, 8 Sep 2015 22:02:17 -0700">&lt;p&gt;Hi Joel, Davis,&lt;/p&gt;

&lt;p&gt;Just to clarify that utilizing the SelectStream in SQL api (SQLHandler.java) would require transforming the SQL expression into SOLR streaming expressions for SelectStream to work. So for e.g. SQL expression&lt;/p&gt;

&lt;p&gt;select id, field_i, str_s from collection1 where text='XXXX' order by field_i desc  &lt;/p&gt;

&lt;p&gt;would be transformed to Solr Streaming expression &lt;/p&gt;

&lt;p&gt;search(collection1, q="text:XXXX", fl="id,field_i,str_s", sort="field_i desc")&lt;/p&gt;

&lt;p&gt;Please let me know your thoughts &amp;amp; if that is the correct understanding.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Susheel&lt;/p&gt;



</comment>
                            <comment id="14736974" author="dpgove" created="Wed, 9 Sep 2015 07:49:27 -0700">&lt;p&gt;Before I give my thoughts on this I do want to just put into writing an important note that I think will help frame the conversation.  &lt;/p&gt;

&lt;p&gt;None of the Streaming classes require the use of streaming expressions. Streaming Expressions is just a way to turn a human readable expression into valid streaming constructs. You can, if you want, just create instances of streaming classes without ever thinking about expressions. The SQL api (in SQLHandler.java) currently works this way.&lt;/p&gt;

&lt;p&gt;That said, I do feel that expressions are the easiest and clearest way to interact with Streams. They provide a very concrete yet expressive way to turn a streaming query into objects that do all the actual work. And they are bi-directional in that you can turn a set of stream objects into an expression as easily as you can turn an expression into a set of stream objects. From a user's perspective I find expressions easier to understand than even standard Solr queries, particularly when performing things like aggregations, top, and joins. I can look at an expression and know exactly what I should expect to receive as a result.&lt;/p&gt;

&lt;p&gt;I'm not adverse to the your suggestion that we create a pipeline of SQL Statement -&amp;gt; Expression -&amp;gt; Stream object. That said, I don't think it would be good idea (from a performance perspective) to create a streaming expression in string format. Ie, "SELECT fieldA FROM collection1 WHERE fieldB = 1" -&amp;gt; search(collection1, fl="fieldA", q="fieldB:1"). I would instead suggest that we turn a SQL statement into a StreamExpression object. This would remove the need to reparse a string just to end up with a StreamExpression object. For example, the above SQL statement could be turned into a StreamExpression with the code&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
  StreamExpression expression = &lt;span class="code-keyword"&gt;new&lt;/span&gt; StreamExpression(&lt;span class="code-quote"&gt;"search"&lt;/span&gt;)
      .withParameter(&lt;span class="code-keyword"&gt;new&lt;/span&gt; StreamExpressionValue(&lt;span class="code-quote"&gt;"collection1"&lt;/span&gt;))
      .withParameter(&lt;span class="code-keyword"&gt;new&lt;/span&gt; StreamExpressionNamedParameter(&lt;span class="code-quote"&gt;"fl"&lt;/span&gt;,&lt;span class="code-quote"&gt;"fieldA"&lt;/span&gt;))
      .withParameter(&lt;span class="code-keyword"&gt;new&lt;/span&gt; StreamExpressionNamedParameter(&lt;span class="code-quote"&gt;"q"&lt;/span&gt;,&lt;span class="code-quote"&gt;"fieldB:1"&lt;/span&gt;));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;which can then be turned into a Stream with&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
  TupleStream stream = streamFactory.constructStream(expression);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Thinking about this wrt the string representation of an expression, we really end up with a rather clear pipeline of &lt;span class="error"&gt;&amp;#91;SQL Statement | String Expression&amp;#93;&lt;/span&gt; -&amp;gt; StreamExpression -&amp;gt; TupleStream. This pipeline makes it very clear that whatever your input format is you only need to convert it into a StreamExpression object and that's it - all the other work of creating a stream from a StreamExpression object is already done. &lt;/p&gt;

&lt;p&gt;I think this is the correct approach.&lt;/p&gt;</comment>
                            <comment id="14737002" author="joel.bernstein" created="Wed, 9 Sep 2015 08:06:07 -0700">&lt;p&gt;Actually the SQLHandler serializes to a StreamingExpression when the Streaming API objects are sent to worker nodes. As a general rule I think that &lt;b&gt;all&lt;/b&gt; built-in Solr features that use the Streaming API should serialize to StreamingExpressions for parallel operations, because it's extremely efficient.&lt;/p&gt;

</comment>
                            <comment id="14737016" author="joel.bernstein" created="Wed, 9 Sep 2015 08:15:32 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=susheel2777%40gmail.com" class="user-hover" rel="susheel2777@gmail.com"&gt;Susheel Kumar&lt;/a&gt;, this ticket is actually pretty tricky to get started with, especially because &lt;a href="https://issues.apache.org/jira/browse/SOLR-7903" title="Add the FacetStream to the Streaming API and Wire It Into the SQLHandler" class="issue-link" data-issue-key="SOLR-7903"&gt;&lt;del&gt;SOLR-7903&lt;/del&gt;&lt;/a&gt; is very close to being committed. Once &lt;a href="https://issues.apache.org/jira/browse/SOLR-7903" title="Add the FacetStream to the Streaming API and Wire It Into the SQLHandler" class="issue-link" data-issue-key="SOLR-7903"&gt;&lt;del&gt;SOLR-7903&lt;/del&gt;&lt;/a&gt; is committed it will also need field alias support.&lt;/p&gt;

&lt;p&gt;My gut feeling is that it would be more effective to work on &lt;a href="https://issues.apache.org/jira/browse/SOLR-7986" title="JDBC Driver for SQL Interface" class="issue-link" data-issue-key="SOLR-7986"&gt;&lt;del&gt;SOLR-7986&lt;/del&gt;&lt;/a&gt;. The other nice thing about working on the JDBC driver is that it will provide another set of overlapping tests of the SQLHandler going into the Solr 6 release.&lt;/p&gt;</comment>
                            <comment id="14737018" author="dpgove" created="Wed, 9 Sep 2015 08:15:56 -0700">&lt;p&gt;I was thinking more in the initial parsing of the SQL statement. At that point perhaps create a StreamExpression object. If I'm reading the code correctly it appears to go directly from a SQL statement to a Stream object.&lt;/p&gt;</comment>
                            <comment id="14737025" author="joel.bernstein" created="Wed, 9 Sep 2015 08:22:35 -0700">&lt;p&gt;Ah, just read your post more closely. Building up a Streaming Expression first rather then going directly to the Streaming API object is an interesting approach that I hadn't thought of. I'll take a look at how the SQLHandler is doing things and see what that would look like building up a Streaming Expression directly.&lt;/p&gt;</comment>
                            <comment id="14738005" author="susheel2777@gmail.com" created="Wed, 9 Sep 2015 19:11:26 -0700">&lt;p&gt;Thanks, Dennis for the explanation &amp;amp; I agree with the approach that either SQL statement or String Expression would be converted to Stream Expression object.&lt;/p&gt;</comment>
                            <comment id="14738038" author="susheel2777@gmail.com" created="Wed, 9 Sep 2015 19:35:49 -0700">&lt;p&gt;Agree, Joel that this is tricky to start.  I'll anyway continue with more tests and will look into &lt;a href="https://issues.apache.org/jira/browse/SOLR-7986" title="JDBC Driver for SQL Interface" class="issue-link" data-issue-key="SOLR-7986"&gt;&lt;del&gt;SOLR-7986&lt;/del&gt;&lt;/a&gt; as well.  &lt;/p&gt;</comment>
                            <comment id="15093218" author="joel.bernstein" created="Mon, 11 Jan 2016 20:22:19 -0700">&lt;p&gt;I've been mulling over the best way to implement alias support. Here is one possibility:&lt;/p&gt;

&lt;p&gt;1) During the parsing collect the field &lt;del&gt;&amp;gt; alias map and alias&lt;/del&gt;&amp;gt;field map. We'll need both directions for the implementation. Attach these maps to the SQLVisitor.&lt;br/&gt;
2) Wrap the outer most TupleStream in a SelectStream that includes field -&amp;gt; alias translation. This will take care of outputing the column aliases in the Tuple.&lt;br/&gt;
3) Add reverse alias translation to the ORDER BY, GROUP BY, and HAVING clauses.  This will support using column alias's in these clauses. &lt;/p&gt;</comment>
                            <comment id="15094614" author="joel.bernstein" created="Tue, 12 Jan 2016 12:37:33 -0700">&lt;p&gt;Patch with full alias support and tests. Aliases are supported for &lt;b&gt;columns&lt;/b&gt; and &lt;b&gt;functions&lt;/b&gt; and can be used in GROUP BY, ORDER BY and HAVING clauses.&lt;/p&gt;

&lt;p&gt;Aliases are not supported in the WHERE clause which is consistent with the SQL spec.&lt;/p&gt;</comment>
                            <comment id="15094650" author="joel.bernstein" created="Tue, 12 Jan 2016 12:55:53 -0700">&lt;p&gt;Added a test for aliases when running aggregates without grouping.&lt;/p&gt;</comment>
                            <comment id="15094914" author="jira-bot" created="Tue, 12 Jan 2016 13:47:34 -0700">&lt;p&gt;Commit 1724319 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=joel.bernstein" class="user-hover" rel="joel.bernstein"&gt;Joel Bernstein&lt;/a&gt; in branch 'dev/trunk'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1724319" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1724319&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8002" title="Add column alias support to the Parallel SQL Interface " class="issue-link" data-issue-key="SOLR-8002"&gt;&lt;del&gt;SOLR-8002&lt;/del&gt;&lt;/a&gt;: Add column alias support to the Parallel SQL Interface&lt;/p&gt;</comment>
                            <comment id="15094951" author="jira-bot" created="Tue, 12 Jan 2016 14:12:05 -0700">&lt;p&gt;Commit 1724323 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=joel.bernstein" class="user-hover" rel="joel.bernstein"&gt;Joel Bernstein&lt;/a&gt; in branch 'dev/trunk'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1724323" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1724323&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8002" title="Add column alias support to the Parallel SQL Interface " class="issue-link" data-issue-key="SOLR-8002"&gt;&lt;del&gt;SOLR-8002&lt;/del&gt;&lt;/a&gt;: Added more test cases&lt;/p&gt;</comment>
                            <comment id="15095511" author="risdenk" created="Tue, 12 Jan 2016 19:59:16 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=joel.bernstein" class="user-hover" rel="joel.bernstein"&gt;Joel Bernstein&lt;/a&gt; Any reason to not always return a SelectStream instead of checking if there are columnAliases?&lt;/p&gt;

&lt;p&gt;I'm thinking about the JDBC implementation of get*() by index. The SelectStream can guarantee the tuples have the fields in the same order as the SQL statement. For example: select a, b, c from table; will result in tuple.get(0) being a, tuple.get(1) = b, etc. Without the SelectStream wrapping, the fields are in an arbitrary order.&lt;/p&gt;

&lt;p&gt;In addition to wrapping the result in SelectStream, this also requires that the columnAliases, reverseColumnAliases, and tuple.fields are LinkedHashMap instead of just plain HashMap to keep the keys in insertion order. I have a rough patch that has these changes just wasn't sure if it made sense to add to this or to a separate JIRA.&lt;/p&gt;</comment>
                            <comment id="15095519" author="risdenk" created="Tue, 12 Jan 2016 20:08:00 -0700">&lt;p&gt;added my thoughts and rough patch to &lt;a href="https://issues.apache.org/jira/browse/SOLR-8512" title="Implement minimal set of get* methods in ResultSetImpl for column indices" class="issue-link" data-issue-key="SOLR-8512"&gt;&lt;del&gt;SOLR-8512&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15095528" author="dpgove" created="Tue, 12 Jan 2016 20:21:00 -0700">&lt;p&gt;I think this is one of those situations where what one almost always sees in a JDBC implementation can actually be reversed. Normally in a JDBC implementation when someone asks for a value via columnName that name will be translated to a columnIdx and that index will be used to lookup the actual value. But because values are keyed by columnName in the tuple I think it could just be reversed where when asking for a value by columnIndex the index could be translated to the columnName and that name used to lookup the actual value. &lt;/p&gt;

&lt;p&gt;This removes the need to depend on order of the fields in the tuple.&lt;/p&gt;</comment>
                            <comment id="15095529" author="joel.bernstein" created="Tue, 12 Jan 2016 20:21:20 -0700">&lt;p&gt;Yep, this makes perfect sense.&lt;/p&gt;</comment>
                            <comment id="15095531" author="joel.bernstein" created="Tue, 12 Jan 2016 20:25:56 -0700">&lt;p&gt;Just mulling over the linkedHashMap, not sure how well that will serialize in JSON.&lt;/p&gt;</comment>
                            <comment id="15095533" author="risdenk" created="Tue, 12 Jan 2016 20:32:27 -0700">&lt;blockquote&gt;
&lt;p&gt;But because values are keyed by columnName in the tuple I think it could just be reversed where when asking for a value by columnIndex the index could be translated to the columnName and that name used to lookup the actual value.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I agree that looking up by index could be translated into column name, but that requires that the mapping of name to index or vice versa to be available at the driver. Currently, there is no metadata that keeps track of positional index to column name that gets passed back from the SQLHandler. I had a working solution that added some metadata to the stream (and had to change the JSONTupleStream parsing) and that seemed awkward/wrong. Maybe there is a better way to pass the metadata back from the SQL handler?&lt;/p&gt;

&lt;p&gt;The least intrusive to me seems to me to be that the Tuple object be able to keep its fields in order and not only by name. I don't know how to enforce this though other than maybe using the LinkedHashMap and some tests to ensure that a new stream doesn't cause issues.&lt;/p&gt;</comment>
                            <comment id="15095536" author="risdenk" created="Tue, 12 Jan 2016 20:34:35 -0700">&lt;blockquote&gt;
&lt;p&gt;Just mulling over the linkedHashMap, not sure how well that will serialize in JSON.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It seems to serialize just fine from the tests I was running with the patch on &lt;a href="https://issues.apache.org/jira/browse/SOLR-8512" title="Implement minimal set of get* methods in ResultSetImpl for column indices" class="issue-link" data-issue-key="SOLR-8512"&gt;&lt;del&gt;SOLR-8512&lt;/del&gt;&lt;/a&gt;. It serializes just like a regular Map and when it gets deserialized by the JSONTupleStream it comes out as a LinkedHashMap and gets cast as a regular Map. This would be the expected behavior from what I can tell.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12830870">SOLR-7560</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12902422">SOLR-8125</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12781901" name="SOLR-8002.patch" size="26465" author="joel.bernstein" created="Tue, 12 Jan 2016 12:55:53 -0700"/>
                            <attachment id="12781898" name="SOLR-8002.patch" size="25123" author="joel.bernstein" created="Tue, 12 Jan 2016 12:37:33 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 2 Sep 2015 01:14:27 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2jogv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-7858] Make Angular UI default</title>
                <link>https://issues.apache.org/jira/browse/SOLR-7858</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Angular UI is very close to feature complete. Once &lt;a href="https://issues.apache.org/jira/browse/SOLR-7856" title="Tidy up exception handling in AngularJS UI" class="issue-link" data-issue-key="SOLR-7856"&gt;&lt;del&gt;SOLR-7856&lt;/del&gt;&lt;/a&gt; is dealt with, it should function well in most cases. I propose that, as soon as 5.3 has been released, we make the Angular UI default, ready for the 5.4 release. We can then fix any more bugs as they are found, but more importantly start working on the features that were the reason for doing this work in the first place.&lt;/p&gt;</description>
                <environment/>
        <key id="12850808">SOLR-7858</key>
            <summary>Make Angular UI default</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="upayavira">Upayavira</assignee>
                                    <reporter username="upayavira">Upayavira</reporter>
                        <labels>
                    </labels>
                <created>Sat, 1 Aug 2015 14:17:23 -0700</created>
                <updated>Thu, 10 Mar 2016 17:04:43 -0700</updated>
                            <resolved>Thu, 10 Mar 2016 17:04:43 -0700</resolved>
                                                    <fixVersion>6.0</fixVersion>
                                    <component>web gui</component>
                        <due/>
                            <votes>3</votes>
                                    <watches>7</watches>
                                                                <comments>
                            <comment id="14743271" author="upayavira" created="Mon, 14 Sep 2015 02:46:40 -0700">&lt;p&gt;patch that adds simple links to old/new UI.&lt;/p&gt;</comment>
                            <comment id="14743281" author="upayavira" created="Mon, 14 Sep 2015 02:50:32 -0700">&lt;p&gt;I'm pretty much ready to switch to the Angular UI for 5.4. With the attached patch, I'll add links between the old and new UIs in case people find issues in the new one. I've added an &lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/information.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt; information link that will, I'm planning, link to a wiki page (not confluence) describing the change between them, asking for people to report issues in the new one.&lt;/p&gt;

&lt;p&gt;I am also planning that &lt;a href="https://issues.apache.org/jira/browse/SOLR-4388" title="Admin UI - SolrCloud - expose Collections API" class="issue-link" data-issue-key="SOLR-4388"&gt;&lt;del&gt;SOLR-4388&lt;/del&gt;&lt;/a&gt; be completed for 5.4, at least a first pass.&lt;/p&gt;

&lt;p&gt;I'd appreciate a few votes for this ticket - to tell me that some people have actually played with the new UI rather than just liking the idea!!&lt;/p&gt;</comment>
                            <comment id="14805361" author="jira-bot" created="Fri, 18 Sep 2015 03:28:21 -0700">&lt;p&gt;Commit 1703801 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=upayavira" class="user-hover" rel="upayavira"&gt;Upayavira&lt;/a&gt; in branch 'dev/trunk'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1703801" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1703801&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-7858" title="Make Angular UI default" class="issue-link" data-issue-key="SOLR-7858"&gt;&lt;del&gt;SOLR-7858&lt;/del&gt;&lt;/a&gt; Add links between old and new UI&lt;/p&gt;</comment>
                            <comment id="14805363" author="jira-bot" created="Fri, 18 Sep 2015 03:28:39 -0700">&lt;p&gt;Commit 1703802 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=upayavira" class="user-hover" rel="upayavira"&gt;Upayavira&lt;/a&gt; in branch 'dev/branches/branch_5x'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1703802" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1703802&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-7858" title="Make Angular UI default" class="issue-link" data-issue-key="SOLR-7858"&gt;&lt;del&gt;SOLR-7858&lt;/del&gt;&lt;/a&gt; Add links between old and new UI&lt;/p&gt;</comment>
                            <comment id="14900063" author="jira-bot" created="Sun, 20 Sep 2015 13:53:53 -0700">&lt;p&gt;Commit 1704193 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=upayavira" class="user-hover" rel="upayavira"&gt;Upayavira&lt;/a&gt; in branch 'dev/trunk'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1704193" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1704193&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-7858" title="Make Angular UI default" class="issue-link" data-issue-key="SOLR-7858"&gt;&lt;del&gt;SOLR-7858&lt;/del&gt;&lt;/a&gt; Fix info link to point to newly created wiki page&lt;/p&gt;</comment>
                            <comment id="14900064" author="jira-bot" created="Sun, 20 Sep 2015 13:54:17 -0700">&lt;p&gt;Commit 1704194 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=upayavira" class="user-hover" rel="upayavira"&gt;Upayavira&lt;/a&gt; in branch 'dev/branches/branch_5x'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1704194" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1704194&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-7858" title="Make Angular UI default" class="issue-link" data-issue-key="SOLR-7858"&gt;&lt;del&gt;SOLR-7858&lt;/del&gt;&lt;/a&gt; Fix info link to point to newly created wiki page&lt;/p&gt;</comment>
                            <comment id="14900411" author="upayavira" created="Mon, 21 Sep 2015 02:13:49 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hossman_lucene%40fucit.org" class="user-hover" rel="hossman_lucene@fucit.org"&gt;Chris Hostetter&lt;/a&gt; I recall you had suggestions as to how we go about releasing the new UI, but I haven't been able to track them down. Are you able to repeat them here? (in terms of which URLs are used, and for what).&lt;/p&gt;

&lt;p&gt;My proposal would be to leave the current UI as index.html, and have /solr/ point at it, and then move admin.html to original.html, such that /solr/original.html will point to the old UI.&lt;/p&gt;</comment>
                            <comment id="14900829" author="elyograg" created="Mon, 21 Sep 2015 08:30:58 -0700">&lt;p&gt;I would like to have the URL seen in the browser include something to make it obvious that it's the admin UI, so users are not tempted to grab the URL in their browser (containing the # character) and use it as a base URL for a client program.  The number of times that I've seen this on the mailing list and the IRC channel is an indication that the users are being easily confused.&lt;/p&gt;

&lt;p&gt;Having something like "admin#" or "admin/#/" (whatever makes sense for the code) in the URL would likely eliminate that confusion for most people.  Even "index.html" in the URL (which the new UI has now) would be helpful, but using the word "admin" in some way would be better.&lt;/p&gt;</comment>
                            <comment id="14901732" author="hossman" created="Mon, 21 Sep 2015 18:22:54 -0700">
&lt;blockquote&gt;&lt;p&gt;Chris Hostetter I recall you had suggestions as to how we go about releasing the new UI, but I haven't been able to track them down. ...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;a href="http://mail-archives.apache.org/mod_mbox/lucene-dev/201504.mbox/%3Calpine.DEB.2.02.1504301121010.19000@frisbee%3E" class="external-link" rel="nofollow"&gt;http://mail-archives.apache.org/mod_mbox/lucene-dev/201504.mbox/%3Calpine.DEB.2.02.1504301121010.19000@frisbee%3E&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;

&lt;p&gt;My suggestion, along the lines of what we did with the previous UI &lt;br/&gt;
change...&lt;/p&gt;

&lt;p&gt;1) ensure that the new UI is fully functional in 5x using an alt path &lt;br/&gt;
(believe this is already true?)&lt;/p&gt;

&lt;p&gt;2) add an "Upgrading" note to CHANGES.txt for 5.2 directing people to &lt;br/&gt;
the new "experimental" UI and the URL to access it, note that it &lt;br/&gt;
will likely become the default in 5.3 and users are encouraged to try it &lt;br/&gt;
out and file bugs if they notice any problems.&lt;/p&gt;

&lt;p&gt;3) update trunk so that it &lt;b&gt;is&lt;/b&gt; the default UI, and make the old UI &lt;br/&gt;
available at some alternate path (eg "/solr/old_ui").  Add an Upgrading &lt;br/&gt;
note pointing out that the URLs may be slightly different, and how to &lt;br/&gt;
access the old UI if they have problems&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;backport trunk changes (#3) to 5x for 5.3 (or later if problems/delays&lt;br/&gt;
pop up)&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;

&lt;p&gt;And: &lt;a href="http://mail-archives.apache.org/mod_mbox/lucene-dev/201504.mbox/%3Calpine.DEB.2.02.1504301414460.19000@frisbee%3E" class="external-link" rel="nofollow"&gt;http://mail-archives.apache.org/mod_mbox/lucene-dev/201504.mbox/%3Calpine.DEB.2.02.1504301414460.19000@frisbee%3E&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;...&lt;br/&gt;
We might want to tweak those URLs slightly to be a little less confusing &lt;br/&gt;
... ie "old.html" and "new.html" (at least until after 5.3) ... i mean, i &lt;br/&gt;
just the paragraph you rwote above, but w/o looking at it i've already &lt;br/&gt;
forgoten if "index.html" is hte new one or hte old one.&lt;/p&gt;

&lt;p&gt;So imagine if a 5.2 user has in their browser...&lt;/p&gt;

&lt;p&gt;	&lt;a href="http://localhost:8983/solr/admin.html#/collection1" class="external-link" rel="nofollow"&gt;http://localhost:8983/solr/admin.html#/collection1&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;...and is trying to remember if this is the new one (that they should get &lt;br/&gt;
use to / help test) or the fuly qualified name of the old one that is &lt;br/&gt;
going away.&lt;/p&gt;

&lt;p&gt;Likewise imagine if a 5.42 user sees the same URL, and reads a note that &lt;br/&gt;
the "old UI" is going to be removed in 6.0 and is trying to figure out if &lt;br/&gt;
that affects him.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;A few followup comments...&lt;/p&gt;

&lt;p&gt;a) that "step 3" above (changing hte defualt on trunk first) is &lt;b&gt;really&lt;/b&gt; important ... you want that change to sit on trunk for a good while, so that devs working on trunk and manually testing things are &lt;b&gt;using&lt;/b&gt; the new UI anytime they run stuff on trunk, and helping to find problems &amp;#8211; even if no users "try" the new UI in the released versions of Solr&lt;/p&gt;

&lt;p&gt;b) not sure why i didn't mention it before, but adding a generic header to all of the "old" UI pages warning people that they are using the old UI and here is a link to the new UI is something that should definitely be added once the default is changed (it could be added even before the default is changed with ome wording tweaks: "Please try the new UI.." vs "You are looking at the old deprecated UI, please switch to....") to help reduce the # of bug reports / feature requests we get about the old UI and to reduce user frustration (ie; they see in some future release notes that there is a new collection admin screen, but they can't find it when they load "the admin UI" bookmark they have.)&lt;/p&gt;

&lt;hr /&gt;

&lt;blockquote&gt;&lt;p&gt;Having something like "admin#" or "admin/#/" (whatever makes sense for the code) in the URL would likely eliminate that confusion for most people. Even "index.html" in the URL (which the new UI has now) would be helpful, but using the word "admin" in some way would be better.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;In the long term, I don't know if this is will actually help things or decrease novice user confusion (the URLs, when loaded in a browser, is already clearly a UI, will making the UI urls longer really help people notice "oh hey, maybe this UI based URL isn't a URL that programtic client code should talk to" ?)  but if this approach is taken it should be &lt;em&gt;very&lt;/em&gt; carefully considered in terms of how it impacts "reserved words" for things like collection names.&lt;/p&gt;

&lt;p&gt;It's annoying enough if we (in the short term) have reserved paths like "/old.ui.html" but if you try to use "/admin" as a prefix to indicate that it's for the UI, you'll probably break things like /admin/cores and /admin/collections &amp;#8211; let alone the long term impacts of saying something like "You can't have a collection named 'ui' because of the '/ui'." etc...&lt;/p&gt;</comment>
                            <comment id="14902247" author="upayavira" created="Tue, 22 Sep 2015 01:51:38 -0700">&lt;p&gt;Thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hossman_lucene%40fucit.org" class="user-hover" rel="hossman_lucene@fucit.org"&gt;Chris Hostetter&lt;/a&gt; for your rich perspective.&lt;/p&gt;

&lt;p&gt;Firstly, to answer your question: yes, the new UI has been in trunk/5x since 5.2. As to whether it has been functional, there are a lot less bugs than there were, although you are right to observe that it needs usage.&lt;/p&gt;

&lt;p&gt;= o =&lt;br/&gt;
URLs:&lt;/p&gt;

&lt;p&gt;In your comments you were concerned about how a user would be able to find out which UI they are using and what the purpose of the change is. I've added links at the top right of the old, and new UIs to switch between them, and a &lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/help_16.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt; link that points to a wiki page explaining further. I hope this does sufficient in terms of messaging - although your suggestion of a banner saying "this is the old UI, go try the new one--&amp;gt;" seems like a good idea.&lt;/p&gt;

&lt;p&gt;Personally, I'd support a redirect from &lt;a href="http://localhost:8983/" class="external-link" rel="nofollow"&gt;http://localhost:8983/&lt;/a&gt; and &lt;a href="http://localhost:8983/solr/" class="external-link" rel="nofollow"&gt;http://localhost:8983/solr/&lt;/a&gt; to &lt;a href="http://localhost:8983/solr/admin/" class="external-link" rel="nofollow"&gt;http://localhost:8983/solr/admin/&lt;/a&gt; and host the entire UI there. You mention the risk of URL overlap, but we already have that issue, in more dangerous ways, with files in the UI using the URL space that end-users access. At least if we switched to /admin/, we would only be in conflict with ourselves, in which case it is infinitely more manageable. And, it is already pretty much a given that 'admin' wouldn't work as a collection name.&lt;/p&gt;

&lt;p&gt;I would, however, suggest we keep this for trunk/6.0. As a code change, it is small. As a usability one, it is much bigger.&lt;/p&gt;

&lt;p&gt;= o =&lt;/p&gt;

&lt;p&gt;Based upon your suggestions, my release proposal and schedule would be:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;5x already has links between old/new UIs so users of 5.4 will be able to get to the new one easily&lt;/li&gt;
	&lt;li&gt;There is also a ? link that points to a wiki page explaining the change and asking for bug reports&lt;/li&gt;
	&lt;li&gt;Add a banner saying "go try the new UI" on the old one, both in trunk and 5x&lt;/li&gt;
	&lt;li&gt;Change URLs in trunk straight away so that the new UI is the default (old one as /original-ui.html)&lt;/li&gt;
	&lt;li&gt;Add a note in CHANGES.txt for 5.4 stating clearly that it will become default in 5.5.&lt;/li&gt;
	&lt;li&gt;Assuming no major clangers, for 5.5, change the URLs to make the new default (old one is /original-ui.html)&lt;/li&gt;
	&lt;li&gt;For trunk, change the UI to serve from /admin/. Files remain in the same location.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14903015" author="noble.paul" created="Tue, 22 Sep 2015 10:15:13 -0700">&lt;p&gt;As we plan to move to V2 API in 6.0 we plan to not restrict a collection name other that the well known ones (&lt;tt&gt;_cluster&lt;/tt&gt;, &lt;tt&gt;_node&lt;/tt&gt; etc ) . The UI is something that could live in a special dir such as &lt;tt&gt;/solr/_admin/index.html&lt;/tt&gt; or &lt;tt&gt;/solr/_ui/index.html&lt;/tt&gt;. All the other files also must move out of the top level . For instance, js , css and images also move under the path &lt;tt&gt;/solr/_admin/&lt;/tt&gt; or &lt;tt&gt;/solr/_ui/&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;We should make these changes in 5x itself and keep redirect rules for old-&amp;gt; new. In 6.0 we should get rid of the rules as well&lt;/p&gt;
</comment>
                            <comment id="14903064" author="upayavira" created="Tue, 22 Sep 2015 10:45:07 -0700">&lt;p&gt;@noble.paul I am unsure who the "we" is you are referring to. As I understand it, you and one other have had a private discussion and on the basis of that some public discussion has occurred, without a conclusion as yet. That doesn't, to me, constitute a community wide agreement that the URL structure will be changing according to your proposal, does it?&lt;/p&gt;

&lt;p&gt;Your suggestion is not that different to what I have already proposed - that everything (css/etc too) live under /admin, along with the admin APIs. The only URL we need to keep consistent is the /solr/ one, which must redirect somewhere sensible, which could be _admin/ or _ui/ or whatever.&lt;/p&gt;</comment>
                            <comment id="14903181" author="noble.paul" created="Tue, 22 Sep 2015 11:42:02 -0700">&lt;blockquote&gt;&lt;p&gt;I am unsure who the "we" is you are referring to.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;"we" means Solr project. If a feature is built and committed, it is a part of the project. &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;As I understand it, you and one other have had a private discussion and on the basis of that some public discussion has occurred, without a conclusion as yet.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Aren't all features built like that? . one developer coming up with a suggestion and then the interested developers would comment/vote on the idea. &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;That doesn't, to me, constitute a community wide agreement that the URL structure will be changing according to your proposal, does it?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The proposal was for v2 APIs . The idea is to have fewer top level names that could conflict with collection names. &lt;/p&gt;

&lt;p&gt;What do you mean when you say community wide agreement? I don't think any feature gets all people to vote for it. &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Your suggestion is not that different to what I have already proposed - that everything (css/etc too) live under /admin, along with the admin APIs. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, we are not suggesting very different things. The reason I prepended an underscore is to avoid conflicts with real collection names. In that aspect &lt;tt&gt;/_admin/&lt;/tt&gt; is better than &lt;tt&gt;admin&lt;/tt&gt; .&lt;/p&gt;


</comment>
                            <comment id="14946743" author="jira-bot" created="Wed, 7 Oct 2015 05:03:46 -0700">&lt;p&gt;Commit 1707269 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=upayavira" class="user-hover" rel="upayavira"&gt;Upayavira&lt;/a&gt; in branch 'dev/trunk'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1707269" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1707269&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-4388" title="Admin UI - SolrCloud - expose Collections API" class="issue-link" data-issue-key="SOLR-4388"&gt;&lt;del&gt;SOLR-4388&lt;/del&gt;&lt;/a&gt; &lt;a href="https://issues.apache.org/jira/browse/SOLR-7858" title="Make Angular UI default" class="issue-link" data-issue-key="SOLR-7858"&gt;&lt;del&gt;SOLR-7858&lt;/del&gt;&lt;/a&gt; &lt;a href="https://issues.apache.org/jira/browse/SOLR-7666" title="Umbrella ticket for Angular JS post-5.2.1 issues" class="issue-link" data-issue-key="SOLR-7666"&gt;&lt;del&gt;SOLR-7666&lt;/del&gt;&lt;/a&gt; update CHANGES.txt&lt;/p&gt;</comment>
                            <comment id="14946746" author="jira-bot" created="Wed, 7 Oct 2015 05:04:02 -0700">&lt;p&gt;Commit 1707270 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=upayavira" class="user-hover" rel="upayavira"&gt;Upayavira&lt;/a&gt; in branch 'dev/branches/branch_5x'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1707270" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1707270&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-4388" title="Admin UI - SolrCloud - expose Collections API" class="issue-link" data-issue-key="SOLR-4388"&gt;&lt;del&gt;SOLR-4388&lt;/del&gt;&lt;/a&gt; &lt;a href="https://issues.apache.org/jira/browse/SOLR-7858" title="Make Angular UI default" class="issue-link" data-issue-key="SOLR-7858"&gt;&lt;del&gt;SOLR-7858&lt;/del&gt;&lt;/a&gt; &lt;a href="https://issues.apache.org/jira/browse/SOLR-7666" title="Umbrella ticket for Angular JS post-5.2.1 issues" class="issue-link" data-issue-key="SOLR-7666"&gt;&lt;del&gt;SOLR-7666&lt;/del&gt;&lt;/a&gt; update CHANGES.txt&lt;/p&gt;</comment>
                            <comment id="14966168" author="upayavira" created="Tue, 20 Oct 2015 20:08:23 -0700">&lt;p&gt;Today, whilst giving a private demo of the UI, I spotted some major bugs - for example, the facet/spellcheck/highlighting options on the query pane didn't work.&lt;/p&gt;

&lt;p&gt;This is the sort of thing that needs to be tracked down and found before we switch the new UI to the default, as it will severely impact on user experience if we don't.&lt;/p&gt;</comment>
                            <comment id="14968446" author="markrmiller@gmail.com" created="Wed, 21 Oct 2015 20:30:31 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=upayavira" class="user-hover" rel="upayavira"&gt;Upayavira&lt;/a&gt;, is there a spot that talks about the param we discussed in these comments I'm missing?&lt;/p&gt;

&lt;p&gt;Any chance we can create a JIRA issue just for that task and I'll jump on it?&lt;/p&gt;</comment>
                            <comment id="14968925" author="upayavira" created="Thu, 22 Oct 2015 03:27:58 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com" class="user-hover" rel="markrmiller@gmail.com"&gt;Mark Miller&lt;/a&gt; the ticket is here: &lt;a href="https://issues.apache.org/jira/browse/SOLR-8074" title="LoadAdminUIServlet directly references admin.html" class="issue-link" data-issue-key="SOLR-8074"&gt;&lt;del&gt;SOLR-8074&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14972288" author="upayavira" created="Fri, 23 Oct 2015 19:23:08 -0700">&lt;p&gt;Patch that adds this "warning" message to the top of the new UI, so as to distinguish it more clearly from the original one:&lt;/p&gt;

&lt;p&gt;"This is an experimental UI. Report bugs &lt;em&gt;here&lt;/em&gt;. For the old UI click &lt;em&gt;here&lt;/em&gt;"&lt;/p&gt;</comment>
                            <comment id="14972291" author="upayavira" created="Fri, 23 Oct 2015 19:25:30 -0700">&lt;p&gt;correct "warning" patch&lt;/p&gt;</comment>
                            <comment id="14972294" author="jira-bot" created="Fri, 23 Oct 2015 19:27:21 -0700">&lt;p&gt;Commit 1710300 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=upayavira" class="user-hover" rel="upayavira"&gt;Upayavira&lt;/a&gt; in branch 'dev/trunk'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1710300" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1710300&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-7858" title="Make Angular UI default" class="issue-link" data-issue-key="SOLR-7858"&gt;&lt;del&gt;SOLR-7858&lt;/del&gt;&lt;/a&gt; Add a warning message to the angular UI&lt;/p&gt;</comment>
                            <comment id="14972295" author="jira-bot" created="Fri, 23 Oct 2015 19:27:57 -0700">&lt;p&gt;Commit 1710301 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=upayavira" class="user-hover" rel="upayavira"&gt;Upayavira&lt;/a&gt; in branch 'dev/branches/branch_5x'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1710301" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1710301&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-7858" title="Make Angular UI default" class="issue-link" data-issue-key="SOLR-7858"&gt;&lt;del&gt;SOLR-7858&lt;/del&gt;&lt;/a&gt; Add a warning message to the angular UI&lt;/p&gt;</comment>
                            <comment id="14972305" author="upayavira" created="Fri, 23 Oct 2015 19:44:50 -0700">&lt;p&gt;Patch that makes angular UI default in trunk.&lt;/p&gt;

&lt;p&gt;Before committing, another is needed that uses LoadAdminUIServlet to load index.html in 5.x, but doesn't (yet) make it the default.&lt;/p&gt;</comment>
                            <comment id="14972321" author="upayavira" created="Fri, 23 Oct 2015 20:05:16 -0700">&lt;p&gt;Patch to make index.html use LoadAdminUIServlet. This gets it $&lt;/p&gt;
{version}
&lt;p&gt; replacement and protection against click-jacking.&lt;/p&gt;</comment>
                            <comment id="14972323" author="jira-bot" created="Fri, 23 Oct 2015 20:06:05 -0700">&lt;p&gt;Commit 1710303 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=upayavira" class="user-hover" rel="upayavira"&gt;Upayavira&lt;/a&gt; in branch 'dev/trunk'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1710303" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1710303&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-7858" title="Make Angular UI default" class="issue-link" data-issue-key="SOLR-7858"&gt;&lt;del&gt;SOLR-7858&lt;/del&gt;&lt;/a&gt; Make Angular UI default in trunk&lt;/p&gt;</comment>
                            <comment id="14972325" author="jira-bot" created="Fri, 23 Oct 2015 20:06:57 -0700">&lt;p&gt;Commit 1710304 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=upayavira" class="user-hover" rel="upayavira"&gt;Upayavira&lt;/a&gt; in branch 'dev/branches/branch_5x'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1710304" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1710304&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-7858" title="Make Angular UI default" class="issue-link" data-issue-key="SOLR-7858"&gt;&lt;del&gt;SOLR-7858&lt;/del&gt;&lt;/a&gt; Switch index.html to use LoadAdminUIServlet on 5x branch&lt;/p&gt;</comment>
                            <comment id="14972509" author="shalinmangar" created="Sat, 24 Oct 2015 02:53:59 -0700">&lt;p&gt;The last commit has broken JettyWebappTest which fails 100% of the times with the following:&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
Stack Trace:
java.lang.NullPointerException
        at __randomizedtesting.SeedInfo.seed([BF1D2DE333F380A3:87CFCEB054981B1C]:0)
        at org.apache.solr.client.solrj.embedded.JettyWebappTest.testAdminUI(JettyWebappTest.java:115)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I believe the attached patch should fix this but I don't know enough about this piece so a review is welcome.&lt;/p&gt;

&lt;p&gt;In future, please be more careful before committing stuff (and be around to watch jenkins for a while!)&lt;/p&gt;</comment>
                            <comment id="14972539" author="jira-bot" created="Sat, 24 Oct 2015 04:40:09 -0700">&lt;p&gt;Commit 1710333 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=upayavira" class="user-hover" rel="upayavira"&gt;Upayavira&lt;/a&gt; in branch 'dev/trunk'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1710333" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1710333&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-7858" title="Make Angular UI default" class="issue-link" data-issue-key="SOLR-7858"&gt;&lt;del&gt;SOLR-7858&lt;/del&gt;&lt;/a&gt; Add web.xml changes&lt;/p&gt;</comment>
                            <comment id="14972550" author="upayavira" created="Sat, 24 Oct 2015 04:48:29 -0700">&lt;p&gt;More care needed from me.&lt;/p&gt;

&lt;p&gt;Firstly, I failed to commit changes to web.xml that were needed, which broke the build.&lt;/p&gt;

&lt;p&gt;Then, to fix it, I inadvertently committed changes that aren't ready, along with the web.xml change.&lt;/p&gt;

&lt;p&gt;At least the build is fixed. I will revert the remaining changes soon, and commit them against the correct ticket.&lt;/p&gt;</comment>
                            <comment id="14972649" author="jira-bot" created="Sat, 24 Oct 2015 08:26:28 -0700">&lt;p&gt;Commit 1710356 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=upayavira" class="user-hover" rel="upayavira"&gt;Upayavira&lt;/a&gt; in branch 'dev/trunk'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1710356" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1710356&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-7858" title="Make Angular UI default" class="issue-link" data-issue-key="SOLR-7858"&gt;&lt;del&gt;SOLR-7858&lt;/del&gt;&lt;/a&gt; revert premature commit&lt;/p&gt;</comment>
                            <comment id="14987137" author="jira-bot" created="Tue, 3 Nov 2015 04:43:38 -0700">&lt;p&gt;Commit 1712260 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=upayavira" class="user-hover" rel="upayavira"&gt;Upayavira&lt;/a&gt; in branch 'dev/trunk'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1712260" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1712260&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-7858" title="Make Angular UI default" class="issue-link" data-issue-key="SOLR-7858"&gt;&lt;del&gt;SOLR-7858&lt;/del&gt;&lt;/a&gt; Make default URL=/&lt;/p&gt;</comment>
                            <comment id="14987183" author="upayavira" created="Tue, 3 Nov 2015 05:25:59 -0700">&lt;p&gt;Notes for reference on tasks to make UI default in 5x:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;move admin.html to old.html&lt;/li&gt;
	&lt;li&gt;fix links in index.html to point to old.html&lt;/li&gt;
	&lt;li&gt;remove "warning" message with a 'go to original UI' link&lt;/li&gt;
	&lt;li&gt;set the ROOT_URL="/" in app.js&lt;/li&gt;
	&lt;li&gt;update web.xml (ref to admin.html, and welcome-file)&lt;/li&gt;
	&lt;li&gt;probably more...&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15190186" author="jira-bot" created="Thu, 10 Mar 2016 16:49:05 -0700">&lt;p&gt;Commit 937a41489f78aa32efb5e65dcc4e60e9bae19431 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=upayavira" class="user-hover" rel="upayavira"&gt;Upayavira&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=937a414" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=937a414&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-7858" title="Make Angular UI default" class="issue-link" data-issue-key="SOLR-7858"&gt;&lt;del&gt;SOLR-7858&lt;/del&gt;&lt;/a&gt; - update links between new/old UIs for 6.x release&lt;/p&gt;</comment>
                            <comment id="15190191" author="jira-bot" created="Thu, 10 Mar 2016 16:50:43 -0700">&lt;p&gt;Commit c18d3521a47727f2c0a4a4455db3cbaf1c6570bd in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=upayavira" class="user-hover" rel="upayavira"&gt;Upayavira&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c18d352" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c18d352&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-7858" title="Make Angular UI default" class="issue-link" data-issue-key="SOLR-7858"&gt;&lt;del&gt;SOLR-7858&lt;/del&gt;&lt;/a&gt; - update links between new/old UIs for 6.x release&lt;/p&gt;</comment>
                            <comment id="15190192" author="jira-bot" created="Thu, 10 Mar 2016 16:50:44 -0700">&lt;p&gt;Commit 77d233bc01894c33f02178898dd3368b51902a11 in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=upayavira" class="user-hover" rel="upayavira"&gt;Upayavira&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=77d233b" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=77d233b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-7858" title="Make Angular UI default" class="issue-link" data-issue-key="SOLR-7858"&gt;&lt;del&gt;SOLR-7858&lt;/del&gt;&lt;/a&gt; - update links between new/old UIs for 6.x release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12894986">SOLR-8074</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12941097">SOLR-8713</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12768477" name="SOLR-7858-2.patch" size="1998" author="upayavira" created="Fri, 23 Oct 2015 19:25:30 -0700"/>
                            <attachment id="12768478" name="SOLR-7858-3.patch" size="7990" author="upayavira" created="Fri, 23 Oct 2015 19:44:50 -0700"/>
                            <attachment id="12768482" name="SOLR-7858-4.patch" size="509" author="upayavira" created="Fri, 23 Oct 2015 20:05:16 -0700"/>
                            <attachment id="12768506" name="SOLR-7858-fix.patch" size="1377" author="shalinmangar" created="Sat, 24 Oct 2015 02:53:59 -0700"/>
                            <attachment id="12755697" name="SOLR-7858.patch" size="2126" author="upayavira" created="Mon, 14 Sep 2015 02:46:40 -0700"/>
                            <attachment id="12755695" name="new ui link.png" size="23563" author="upayavira" created="Mon, 14 Sep 2015 02:42:55 -0700"/>
                            <attachment id="12755694" name="original UI link.png" size="24047" author="upayavira" created="Mon, 14 Sep 2015 02:41:54 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 18 Sep 2015 10:28:21 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2i7tz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-7555] Display total space and available space in Admin</title>
                <link>https://issues.apache.org/jira/browse/SOLR-7555</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Frequently I have access to the Solr Admin console, but not the underlying server, and I'm curious how much space remains available.   This little patch exposes total Volume size as well as the usable space remaining:&lt;/p&gt;

&lt;p&gt;&lt;img src="https://monosnap.com/file/VqlReekCFwpK6utI3lP18fbPqrGI4b.png" align="absmiddle" border="0" /&gt;&lt;/p&gt;

&lt;p&gt;I'm not sure if this is the best place to put this, as every shard will share the same data, so maybe it should be on the top level Dashboard?  Also not sure what to call the fields! &lt;/p&gt;</description>
                <environment/>
        <key id="12830532">SOLR-7555</key>
            <summary>Display total space and available space in Admin</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="ehatcher">Erik Hatcher</assignee>
                                    <reporter username="epugh">Eric Pugh</reporter>
                        <labels>
                    </labels>
                <created>Sun, 17 May 2015 14:11:22 -0700</created>
                <updated>Wed, 17 Feb 2016 13:52:05 -0700</updated>
                                            <version>5.1</version>
                                    <fixVersion>6.0</fixVersion>
                                    <component>web gui</component>
                        <due/>
                            <votes>0</votes>
                                    <watches>10</watches>
                                                                <comments>
                            <comment id="14556103" author="mariusneo" created="Fri, 22 May 2015 05:46:03 -0700">&lt;p&gt;In case this functionality is needed, here is a patch for it for both classic and angular UI versions.&lt;/p&gt;</comment>
                            <comment id="14556154" author="upayavira" created="Fri, 22 May 2015 06:45:08 -0700">&lt;p&gt;The question here is whether we should report the disk usage on a per core basis, or on the main index page. I can see an argument for both. It would be good to have a little graph on the right hand side of the main page showing how much space is left.&lt;/p&gt;

&lt;p&gt;Patch looks fine to me!&lt;/p&gt;</comment>
                            <comment id="14556336" author="ehatcher" created="Fri, 22 May 2015 08:38:44 -0700">&lt;p&gt;How's this play out if the index is stored in HDFS?    I see it using java.nio's Files and Paths API, which concerns me that this might break when the index is on a different kind of beast.   I'll await feedback that this scenario is ok before committing this patch - but good idea!  &lt;/p&gt;</comment>
                            <comment id="14558692" author="mariusneo" created="Mon, 25 May 2015 22:04:32 -0700">&lt;p&gt;Another patch already exists in &lt;a href="https://issues.apache.org/jira/browse/SOLR-7556" title="Display total space and available space in Admin" class="issue-link" data-issue-key="SOLR-7556"&gt;&lt;del&gt;SOLR-7556&lt;/del&gt;&lt;/a&gt;. It also doesn't take into account the situation when the Solr instance runs on top of hdfs&lt;/p&gt;</comment>
                            <comment id="14559182" author="epugh" created="Tue, 26 May 2015 07:36:05 -0700">&lt;p&gt;I am re-attaching this patch from &lt;a href="https://issues.apache.org/jira/browse/SOLR-7556" title="Display total space and available space in Admin" class="issue-link" data-issue-key="SOLR-7556"&gt;&lt;del&gt;SOLR-7556&lt;/del&gt;&lt;/a&gt;, and closing &lt;a href="https://issues.apache.org/jira/browse/SOLR-7556" title="Display total space and available space in Admin" class="issue-link" data-issue-key="SOLR-7556"&gt;&lt;del&gt;SOLR-7556&lt;/del&gt;&lt;/a&gt;.  Tonight I will try it out with Solr running on HDFS to see what happens, and thought that would be an issue.&lt;/p&gt;</comment>
                            <comment id="14559187" author="epugh" created="Tue, 26 May 2015 07:38:14 -0700">&lt;p&gt;I had the same question.    I like the "little graph", and that was why I was providing both the total size, and free available in both bytes and human friendly.   bytes for the scaling on the graph.&lt;/p&gt;

&lt;p&gt;If you only have a single drive, then having it at the top level makes sense.  But if you have multiple drives, then you would need to show all of them, or jsut have it at the core level...?&lt;/p&gt;</comment>
                            <comment id="14559217" author="upayavira" created="Tue, 26 May 2015 08:08:11 -0700">&lt;p&gt;What seems reasonable to me is to, on the main screen, show whichever partition SOLR_HOME exists on, on the core pages, show the partitions that the cores exist on. They may be the same, they may not.&lt;/p&gt;</comment>
                            <comment id="14560122" author="epugh" created="Tue, 26 May 2015 16:33:10 -0700">&lt;p&gt;Great!     So, if that is the direction, then it seems like a different variable should be populated?  Cause I am explicitly looking at Data Dir at the core level...&lt;/p&gt;</comment>
                            <comment id="14560127" author="epugh" created="Tue, 26 May 2015 16:38:18 -0700">&lt;p&gt;So &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ehatcher" class="user-hover" rel="ehatcher"&gt;Erik Hatcher&lt;/a&gt; and &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marius_neo" class="user-hover" rel="marius_neo"&gt;Marius Grama&lt;/a&gt;, it looks like there is a method on the Directory.java called fileLength, that is implemented by FSDirectory and HDFSDirectory separately.  &lt;/p&gt;

&lt;p&gt;I'm now thinking that I add a method called availableSpace and totalSpace to Directory.java, and then implement those separately?    &lt;/p&gt;
</comment>
                            <comment id="14560398" author="mariusneo" created="Tue, 26 May 2015 21:44:48 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=epugh" class="user-hover" rel="epugh"&gt;Eric Pugh&lt;/a&gt; maybe this information could be of help when trying to get the file system statistics in hdfs : &lt;/p&gt;

&lt;ul class="alternate" type="square"&gt;
	&lt;li&gt;&lt;a href="https://hadoop.apache.org/docs/current/api/org/apache/hadoop/fs/FsStatus.html" class="external-link" rel="nofollow"&gt;https://hadoop.apache.org/docs/current/api/org/apache/hadoop/fs/FsStatus.html&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href="https://hadoop.apache.org/docs/current/api/org/apache/hadoop/fs/FileSystem.html#getStatus%28org.apache.hadoop.fs.Path%29" class="external-link" rel="nofollow"&gt;https://hadoop.apache.org/docs/current/api/org/apache/hadoop/fs/FileSystem.html#getStatus%28org.apache.hadoop.fs.Path%29&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14561438" author="epugh" created="Wed, 27 May 2015 11:28:04 -0700">&lt;p&gt;Here is an updated patch.  I moved the method spaceAvailable and spaceTotal  to the abstract Directory class, and then implemented it for the various classes that extended it.   I don't love that this change touches the Lucene package, as I've never really gone deep there before, and it feels rather invasive!   &lt;/p&gt;

&lt;p&gt;I also changed the format of the response to mimic the how the memory hands back both human formatted and raw data.&lt;/p&gt;</comment>
                            <comment id="14561441" author="epugh" created="Wed, 27 May 2015 11:28:30 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mariusneo" class="user-hover" rel="mariusneo"&gt;Marius Grama&lt;/a&gt;this was perfect!&lt;/p&gt;</comment>
                            <comment id="14561545" author="upayavira" created="Wed, 27 May 2015 12:19:43 -0700">&lt;p&gt;Extending the Directory class seems like a pretty major step - one that should get far wider coverage in its own ticket, I'd say.&lt;/p&gt;

&lt;p&gt;However, a simpler way to do it would be to have a DiskSpaceAwareDirectory interface that provides the necessary methods. Then, the API can only offer disk usage values from Directory objects that implement that interface.&lt;/p&gt;

&lt;p&gt;Dunno if that pattern is used at all in Lucene/Solr though.&lt;/p&gt;</comment>
                            <comment id="14561575" author="epugh" created="Wed, 27 May 2015 12:36:40 -0700">&lt;p&gt;Humm...   You know, I saw that RAMDirectory implemented a interface called Accountable that was for tracking memory usage.    So we could modify the HdfsDirectory and FSDirectory to implement that. &lt;/p&gt;

&lt;p&gt;Then in SystemInfoHandler we do a instanceof check, and then pull that data?&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ehatcher" class="user-hover" rel="ehatcher"&gt;Erik Hatcher&lt;/a&gt; &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mariusneo" class="user-hover" rel="mariusneo"&gt;Marius Grama&lt;/a&gt; what do you guys think?&lt;/p&gt;</comment>
                            <comment id="14561597" author="thetaphi" created="Wed, 27 May 2015 12:51:43 -0700">&lt;p&gt;Please use another interface for this kind of stuff. Accountable is solely for heap usage. There is still a lot of stuff missing to make that information properly availabe in Solr. You can check with it, e.g. how much heap the term dictionary or the norms take in an index.&lt;/p&gt;

&lt;p&gt;but disk space should be handled differently.&lt;/p&gt;</comment>
                            <comment id="14566295" author="epugh" created="Sat, 30 May 2015 18:54:13 -0700">&lt;p&gt;Makes sense.   I am working on another patch that based on the above DiskSpaceAwareDirectory interface suggestion.&lt;/p&gt;</comment>
                            <comment id="14566306" author="epugh" created="Sat, 30 May 2015 19:33:05 -0700">&lt;p&gt;Here is a patch that implements the DiskSpaceAwareDirectory interface.  The actual .java class is attached separately.&lt;/p&gt;</comment>
                            <comment id="14567365" author="ehatcher" created="Mon, 1 Jun 2015 07:36:24 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=epugh" class="user-hover" rel="epugh"&gt;Eric Pugh&lt;/a&gt; I think the DiskSpaceAwareDirectory addition should be a LUCENE JIRA to get that in first, as I imagine that might be a debatable addition at the Lucene level.   Personally, though, I think the logic for how/if to get the disk info should be in SystemInfoHandler itself, as there already is an instanceof check in the patch already - building upon that to include only the Directory implementations supported for this information.&lt;/p&gt;</comment>
                            <comment id="14567382" author="epugh" created="Mon, 1 Jun 2015 07:47:47 -0700">&lt;p&gt;Ugh..   So this is getting rather more complex then I expected.    Sigh.    So, are you suggesting that instead of adding DiskSpaceAwareDirectory as an interface, I just add a instanceOf check for HdfsDirectory and FSDirectory, and then call the method?&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
&lt;span class="code-keyword"&gt;if&lt;/span&gt; (directory instanceOf HdfsDirectory) {
  totalSpace = ((HdfsDirectory)directory).getTotalSpace()
elseif (directory instanceOf FSDirectory) {
  totalSpace = ((FSDirectory)directory).getTotalSpace()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Would that approach be acceptable, and then I don't add a new interface, and the changes are localized to FSDirectory and HdfsDirectory.&lt;/p&gt;

&lt;p&gt;Eric&lt;/p&gt;</comment>
                            <comment id="14567388" author="ehatcher" created="Mon, 1 Jun 2015 07:57:16 -0700">&lt;blockquote&gt;&lt;p&gt;So this is getting rather more complex then I expected.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Actually simpler &lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/smile.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt; since you can keep all the changes Solr-side rather than having to work through modifying Lucene itself.  And maybe you don't even need those additional methods in HdfsDirectory or FSDirectory if you can get at the data you need inside an if/else in SystemInfoHandler.&lt;/p&gt;</comment>
                            <comment id="14567394" author="romseygeek" created="Mon, 1 Jun 2015 08:01:18 -0700">&lt;p&gt;How about adding the methods to DirectoryFactory instead?&lt;/p&gt;</comment>
                            <comment id="14567433" author="epugh" created="Mon, 1 Jun 2015 08:29:06 -0700">&lt;p&gt;I see...   So in response to &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ehatcher" class="user-hover" rel="ehatcher"&gt;Erik Hatcher&lt;/a&gt;, for FSDirectory, the getPath() that I need is public, and for HdfsDirectory, the getFileSystem is public.    So I can put the logic on there if I cast to the actuall Directory class.&lt;/p&gt;

&lt;p&gt;If I add the methods to DirectoryFactory, then that is werid for MockDirectoryFactory and RAMDirectoryFactory.  I could add it to HdfsDirectoryFActory and STandardDirectoryFactory however.  &lt;/p&gt;

&lt;p&gt;Thoughts?   &lt;/p&gt;</comment>
                            <comment id="14567457" author="ehatcher" created="Mon, 1 Jun 2015 08:42:06 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=romseygeek" class="user-hover" rel="romseygeek"&gt;Alan Woodward&lt;/a&gt; why in the factory?   While in SystemInfoHandler, to get the available/total space data, the factory isn't really in the mix any more.   It seems ok to me to keep all this just in SystemInfoHandler - and just show "N/A" if the Directory implementation being used isn't supported.&lt;/p&gt;</comment>
                            <comment id="14567991" author="epugh" created="Mon, 1 Jun 2015 14:00:26 -0700">&lt;p&gt;Reworked patch to just change the SystemInfoHandler.java, no changes to various Directory classes...&lt;/p&gt;</comment>
                            <comment id="14567996" author="epugh" created="Mon, 1 Jun 2015 14:03:12 -0700">&lt;p&gt;So each version seems to be slightly less intrusive, so v4 has the least amount of change.  It's also the least "flexible" from the stand point that any other Directory that is created, that isn't a FsDirectory or HdfsDirectory will require a change in SystemInfoHandler.java as well...&lt;/p&gt;</comment>
                            <comment id="14569116" author="epugh" created="Tue, 2 Jun 2015 06:51:03 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ehatcher" class="user-hover" rel="ehatcher"&gt;Erik Hatcher&lt;/a&gt; &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=upayavira" class="user-hover" rel="upayavira"&gt;Upayavira&lt;/a&gt; I'd love to here your thoughts on the v4 patch.  I was hoping to get this in for 5.2, though I think I missed the cut...&lt;/p&gt;</comment>
                            <comment id="14569311" author="ehatcher" created="Tue, 2 Jun 2015 08:50:14 -0700">&lt;p&gt;this patch adds the total/available to the new Angular admin UI too (maybe was in a previous patch and got dropped?) and adjusts the test to always use "solr.RAMDirectoryFactory" (without this, I &lt;em&gt;think&lt;/em&gt; the randomized testing would have eventually selected a non-RAMDirectoryFactory and failed).&lt;/p&gt;

&lt;p&gt;Looks good to me.  I'll let &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=upayavira" class="user-hover" rel="upayavira"&gt;Upayavira&lt;/a&gt; and &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dep4b" class="user-hover" rel="dep4b"&gt;David Eric Pugh&lt;/a&gt; double check, and then I'm happy to commit.  &lt;/p&gt;

&lt;p&gt;And yeah, we missed the 5.2 deadline, sorry.&lt;/p&gt;</comment>
                            <comment id="14569331" author="ehatcher" created="Tue, 2 Jun 2015 09:00:05 -0700">&lt;blockquote&gt;&lt;p&gt;It's also the least "flexible" from the stand point that any other Directory that is created, that isn't a FsDirectory or HdfsDirectory will require a change in SystemInfoHandler.java as well&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;True, but it gets it in for 5.3 at least (and what other Directory implementations are folks using that are missed?).  If you're interested in making it more flexible with the DiskSpaceAware thing, file a LUCENE JIRA and pursue it from that angle and we can refactor the guts of the system info handler once that change is made.&lt;/p&gt;</comment>
                            <comment id="14569408" author="epugh" created="Tue, 2 Jun 2015 09:47:08 -0700">&lt;p&gt;Thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ehatcher" class="user-hover" rel="ehatcher"&gt;Erik Hatcher&lt;/a&gt; for the patch, and the clean up on the RAMDirectory in the unit test, I didn't quite have that worked out!   Looking forward to having this in 5.3!&lt;/p&gt;</comment>
                            <comment id="14570164" author="ehatcher" created="Tue, 2 Jun 2015 19:32:10 -0700">&lt;p&gt;I hit a problem in testing.  Attaching the latest patch (note code commented out in SystemInfoHandler to isolate the test failure).  &lt;/p&gt;

&lt;p&gt;This line causes another Directory to be created it appears:&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
Directory directory = core.getDirectoryFactory().get(core.getIndexDir(), DirContext.DEFAULT, core.getSolrConfig().indexConfig.lockType);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and the test infrastructure catches it when running `ant test -Dtestcase=SystemInfoHandlerTest` with this:&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
   [junit4]   2&amp;gt; 8008 INFO  (SUITE-SystemInfoHandlerTest-seed#[FF2F1F4755E3E1D4]-worker) [    x:collection1] o.a.s.c.CachingDirectoryFactory Closing RAMDirectoryFactory - 2 directories currently being tracked
   [junit4]   2&amp;gt; 20450 ERROR (SUITE-SystemInfoHandlerTest-seed#[FF2F1F4755E3E1D4]-worker) [    x:collection1] o.a.s.c.CachingDirectoryFactory Timeout waiting &lt;span class="code-keyword"&gt;for&lt;/span&gt; all directory ref counts to be released - gave up waiting on CachedDir&amp;lt;&amp;lt;refCount=2;path=/Users/erikhatcher/dev/trunk/solr/build/solr-core/test/J0/temp/solr.handler.admin.SystemInfoHandlerTest FF2F1F4755E3E1D4-001/init-core-data-001/index;done=&lt;span class="code-keyword"&gt;false&lt;/span&gt;&amp;gt;&amp;gt;
   [junit4]   2&amp;gt; 20452 ERROR (SUITE-SystemInfoHandlerTest-seed#[FF2F1F4755E3E1D4]-worker) [    x:collection1] o.a.s.c.CachingDirectoryFactory Error closing directory:org.apache.solr.common.SolrException: Timeout waiting &lt;span class="code-keyword"&gt;for&lt;/span&gt; all directory ref counts to be released - gave up waiting on CachedDir&amp;lt;&amp;lt;refCount=2;path=/Users/erikhatcher/dev/trunk/solr/build/solr-core/test/J0/temp/solr.handler.admin.SystemInfoHandlerTest FF2F1F4755E3E1D4-001/init-core-data-001/index;done=&lt;span class="code-keyword"&gt;false&lt;/span&gt;&amp;gt;&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Punting back to &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dep4b" class="user-hover" rel="dep4b"&gt;David Eric Pugh&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14573219" author="ehatcher" created="Thu, 4 Jun 2015 10:38:31 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=epugh" class="user-hover" rel="epugh"&gt;Eric Pugh&lt;/a&gt; I tinkered with this a little more though still didn't have full success, but a call to DirectoryFactory#release(directory) gets the test case passing.  I still had issues with /admin/system working properly though, but maybe you can add in the #release and get it working?&lt;/p&gt;</comment>
                            <comment id="14575717" author="epugh" created="Sat, 6 Jun 2015 06:19:03 -0700">&lt;p&gt;So this is a great example why having awesome unit testing framework helps us!  I didn't know about the "increment/decrement" of directory objects.   The unit test + your help showed me.   So now it appears to be passing.   I'm updating patch.&lt;/p&gt;</comment>
                            <comment id="14575734" author="epugh" created="Sat, 6 Jun 2015 07:11:38 -0700">&lt;p&gt;This version of the patch file incorporates the improvements to the test case that Erik provided, and properly releases the Directory object after it being used, so it passes the tests.&lt;/p&gt;</comment>
                            <comment id="14576346" author="ehatcher" created="Sun, 7 Jun 2015 10:18:04 -0700">&lt;p&gt;The one remaining question I have is about the release, as the directory released may not be the one gotten from the core (when the directory is instanceof FilterDirectory).  I think there might need to be another variable in the mix to hold on to the original and release that one instead.  &lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=epugh" class="user-hover" rel="epugh"&gt;Eric Pugh&lt;/a&gt; - maybe one more round on seeing if we can get another test case in there to test an actual directory instance that is also an instance of FilterDirectory?   (sorry, but yeah good thing the tests catch these things!)&lt;/p&gt;</comment>
                            <comment id="14605846" author="ehatcher" created="Mon, 29 Jun 2015 09:24:17 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=epugh" class="user-hover" rel="epugh"&gt;Eric Pugh&lt;/a&gt; - ping - happy to get this committed after resolving the issue in my last comment.  &lt;/p&gt;</comment>
                            <comment id="14652028" author="epugh" created="Mon, 3 Aug 2015 09:00:40 -0700">&lt;p&gt;Will submit update tonight!&lt;/p&gt;</comment>
                            <comment id="15027008" author="ehatcher" created="Wed, 25 Nov 2015 09:09:16 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=epugh" class="user-hover" rel="epugh"&gt;Eric Pugh&lt;/a&gt; been a long night &lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/smile.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt;  pushing to post-5.4&lt;/p&gt;</comment>
                            <comment id="15151147" author="jkrupan" created="Wed, 17 Feb 2016 13:50:32 -0700">&lt;p&gt;I recently noticed that quite a few of the Amazon EC2 instance types have two or more local SSD storage devices. Should Solr display "total space" across all available local devices or just for the storage device on which Solr appears to be configured? If the instance supports EBS-only, I presume it would be total for EBS that the instance type supports.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12830533">SOLR-7556</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12830533">SOLR-7556</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12736388" name="DiskSpaceAwareDirectory.java" size="1656" author="epugh" created="Sat, 30 May 2015 19:33:05 -0700"/>
                            <attachment id="12735333" name="SOLR-7555-display_disk_space.patch" size="6486" author="epugh" created="Tue, 26 May 2015 07:36:04 -0700"/>
                            <attachment id="12735652" name="SOLR-7555-display_disk_space_v2.patch" size="16200" author="epugh" created="Wed, 27 May 2015 11:28:04 -0700"/>
                            <attachment id="12736387" name="SOLR-7555-display_disk_space_v3.patch" size="11507" author="epugh" created="Sat, 30 May 2015 19:33:05 -0700"/>
                            <attachment id="12736661" name="SOLR-7555-display_disk_space_v4.patch" size="9650" author="epugh" created="Mon, 1 Jun 2015 14:00:26 -0700"/>
                            <attachment id="12738169" name="SOLR-7555-display_disk_space_v5.patch" size="9964" author="epugh" created="Sat, 6 Jun 2015 07:11:38 -0700"/>
                            <attachment id="12737067" name="SOLR-7555.patch" size="10011" author="ehatcher" created="Tue, 2 Jun 2015 19:32:10 -0700"/>
                            <attachment id="12736870" name="SOLR-7555.patch" size="10946" author="ehatcher" created="Tue, 2 Jun 2015 08:50:14 -0700"/>
                            <attachment id="12734812" name="SOLR-7555.patch" size="4263" author="mariusneo" created="Fri, 22 May 2015 05:46:03 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 22 May 2015 12:46:03 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2eufb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>

<item>
            <title>[SOLR-7543] Create GraphQuery that allows graph traversal as a query operator.</title>
                <link>https://issues.apache.org/jira/browse/SOLR-7543</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;I have a GraphQuery that I implemented a long time back that allows a user to specify a "startQuery" to identify which documents to start graph traversal from.  It then gathers up the edge ids for those documents , optionally applies an additional filter.  The query is then re-executed continually until no new edge ids are identified.  I am currently hosting this code up at &lt;a href="https://github.com/kwatters/solrgraph" class="external-link" rel="nofollow"&gt;https://github.com/kwatters/solrgraph&lt;/a&gt; and I would like to work with the community to get some feedback and ultimately get it committed back in as a lucene query.&lt;/p&gt;

&lt;p&gt;Here's a bit more of a description of the parameters for the query / graph traversal:&lt;/p&gt;

&lt;p&gt;q - the initial start query that identifies the universe of documents to start traversal from.&lt;br/&gt;
fromField - the field name that contains the node id&lt;br/&gt;
toField - the name of the field that contains the edge id(s).&lt;br/&gt;
traversalFilter - this is an additional query that can be supplied to limit the scope of graph traversal to just the edges that satisfy the traversalFilter query.&lt;br/&gt;
maxDepth - integer specifying how deep the breadth first search should go.&lt;br/&gt;
returnStartNodes - boolean to determine if the documents that matched the original "q" should be returned as part of the graph.&lt;br/&gt;
onlyLeafNodes - boolean that filters the graph query to only return documents/nodes that have no edges.&lt;/p&gt;

&lt;p&gt;We identify a set of documents with "q" as any arbitrary lucene query.  It will collect the values in the fromField, create an OR query with those values , optionally apply an additional constraint from the "traversalFilter" and walk the result set until no new edges are detected.  Traversal can also be stopped at N hops away as defined with the maxDepth.  This is a BFS (Breadth First Search) algorithm.  Cycle detection is done by not revisiting the same document for edge extraction.  &lt;/p&gt;

&lt;p&gt;This query operator does not keep track of how you arrived at the document, but only that the traversal did arrive at the document.&lt;/p&gt;</description>
                <environment/>
        <key id="12829683">SOLR-7543</key>
            <summary>Create GraphQuery that allows graph traversal as a query operator.</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yseeley@gmail.com">Yonik Seeley</assignee>
                                    <reporter username="kwatters">Kevin Watters</reporter>
                        <labels>
                    </labels>
                <created>Wed, 13 May 2015 13:57:53 -0700</created>
                <updated>Wed, 27 Apr 2016 11:42:56 -0700</updated>
                            <resolved>Fri, 9 Oct 2015 14:28:22 -0700</resolved>
                                                    <fixVersion>6.0</fixVersion>
                                    <component>search</component>
                        <due/>
                            <votes>3</votes>
                                    <watches>13</watches>
                                                                <comments>
                            <comment id="14543949" author="yseeley@gmail.com" created="Thu, 14 May 2015 09:22:08 -0700">&lt;p&gt;Cool stuff!&lt;br/&gt;
Lets just focus on the interface/semantics of the qparser - the rest is implementation detail and can be further optimized later.&lt;/p&gt;

&lt;p&gt;Since this sort of looks like a multi-step join, perhaps use the same convention of using the primary value (or v) as the start query?&lt;/p&gt;

{!graph fromField=f1 toField=f2 ...}
&lt;p&gt;my_start_query&lt;br/&gt;
Which is equivalent to &lt;/p&gt;
{!graph fromField=f1 toField=f2 ... v=my_start_query}

&lt;p&gt;Actually, looking at join again, it uses "from" and "to" - should we use those or stick with "fromField" and "toField"?&lt;/p&gt;</comment>
                            <comment id="14543982" author="kwatters" created="Thu, 14 May 2015 09:43:56 -0700">&lt;p&gt;Hi Yonik,  thanks for chiming in!  Yup, you can think of this as a multi-step join.  In fact,  I use the graph operator with a maxDepth of 1 to implement an inner join.&lt;br/&gt;
I like things to be consistent (it's easier for others to grok that way), we can rename the fromField and the toField to be "from" and "to". When it comes to the GraphQueryParser(Plugin),  I'm open to whatever the community likes and whatever is consistent with the other parsers out there. &lt;br/&gt;
 (I've always been a bit thrown by the !parser_name syntax, which is why I also have a client side object model so that I programmatically build up an expression, I serialize that expression over to my custom parser that deserializes and converts into the appropriate lucene query objects.  ).  I suppose I just want to make sure that the  "v=my_start_query"  can be any arbitrary lucene query.   &lt;br/&gt;
I also still need to work up some richer examples and test cases as part of this ticket.&lt;/p&gt;</comment>
                            <comment id="14544003" author="yseeley@gmail.com" created="Thu, 14 May 2015 09:52:47 -0700">&lt;blockquote&gt;&lt;p&gt;I've always been a bit thrown by the !parser_name syntax&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yeah, but I think doing it like all the other qparsers is best for now... and then we can add support for JSON along with the rest of them later (there's a ticket open... just haven't gotten around to it yet).&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I suppose I just want to make sure that the "v=my_start_query" can be any arbitrary lucene query. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yep, just use the qparser framework and then the query (or queries) can be of any type parseable by another qparser (including another graph qparser for instance).&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
        baseParser = subQuery(localParams.get(QueryParsing.V), &lt;span class="code-keyword"&gt;null&lt;/span&gt;);
        Query q = baseParser.getQuery();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14544713" author="dpgove" created="Thu, 14 May 2015 18:14:04 -0700">&lt;p&gt;For interface/semantics, I think this might be able to benefit from the Expression stuff recently added for streams (&lt;a href="https://issues.apache.org/jira/browse/SOLR-7377" title="SOLR Streaming Expressions" class="issue-link" data-issue-key="SOLR-7377"&gt;&lt;del&gt;SOLR-7377&lt;/del&gt;&lt;/a&gt;). With that, you could do something like&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
graph(root=search(collection1, q=&lt;span class="code-quote"&gt;"&amp;lt;some query&amp;gt;"&lt;/span&gt;, fl=&lt;span class="code-quote"&gt;"&amp;lt;used fields&amp;gt;"&lt;/span&gt;), traverse=search(collection1, q=&lt;span class="code-quote"&gt;"&amp;lt;some dynamic query&amp;gt;"&lt;/span&gt;,fl=&lt;span class="code-quote"&gt;"&amp;lt;used fields&amp;gt;"&lt;/span&gt;), on=&lt;span class="code-quote"&gt;"parent.field=child.field"&lt;/span&gt;, maxDepth=5, returnRoot=&lt;span class="code-keyword"&gt;true&lt;/span&gt;, returnOnlyLeaf=&lt;span class="code-keyword"&gt;false&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This would also allow you to do other things like make use of stream merging, uniquing, etc....&lt;/p&gt;

&lt;p&gt;Would even allow for tree traversal across multiple collections.&lt;/p&gt;</comment>
                            <comment id="14545546" author="kwatters" created="Fri, 15 May 2015 07:07:42 -0700">&lt;p&gt;Interesting Dennis,  I wasn't aware of &lt;a href="https://issues.apache.org/jira/browse/SOLR-7377" title="SOLR Streaming Expressions" class="issue-link" data-issue-key="SOLR-7377"&gt;&lt;del&gt;SOLR-7377&lt;/del&gt;&lt;/a&gt;,  I'll have to take a bit more time to understand what that means in the context of the graph query.  I'm not sure how cross collection graph traversal will play with my implementation.  Issue is, my lucene graph query currently is local to a single shard/core.  I have been chatting with &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=joel.bernstein" class="user-hover" rel="joel.bernstein"&gt;Joel Bernstein&lt;/a&gt; about the distributed graph traversal use case, and I think there is a play for streaming aggregation there.  There is one line that needs to be coordinated/synchronized across the cluster to do the distributed graph traversal, I think that's where the streaming stuff comes in.  &lt;br/&gt;
I like the idea of renaming   "returnStartNodes" to "returnRoot" ... less words and hopefully more descriptive of what is happening, (same for returnOnlyLeaf  .. )  maybe the word "nodes" is redundant, and it obscures that it's really just a "document" at the end of the day.&lt;/p&gt;</comment>
                            <comment id="14545604" author="dpgove" created="Fri, 15 May 2015 07:47:30 -0700">&lt;p&gt;This might be crazy, but would allow a little more flexibility on what to return&lt;/p&gt;

&lt;p&gt;return="Root | Leaf"  =&amp;gt; would return documents that are either in the root, or a leaf.&lt;br/&gt;
return="Root &amp;amp; Leaf" =&amp;gt; would return documents that are in root and are leafs themselves (no children)&lt;br/&gt;
return="Leaf | Children&amp;gt;4" =&amp;gt; would return documents that are leaf or have more than 4 children.&lt;/p&gt;</comment>
                            <comment id="14545858" author="steff1193" created="Fri, 15 May 2015 10:43:06 -0700">&lt;p&gt;Sounds interesting. I can't help thinking that this will help users do only one particular graph'ish search. But there are millions of other graph'ish searches one might want to do. The solution here might be too specific. A while back I wrote a Solr indexing-backend for the Titan graph database. We can do a storage-backend as well. Putting a full blown graph database on top of Solr (by supporting indexing- and potentially storage-backends for e.g. Titan) might be the way to go instead, so that we will not end up with lots and lots of very specific graph-search query-parsers/resolvers. And this way you will get all the other cool stuff from a full blown graph database - e.g. I liked playing with Titans REPL. Just a thought&lt;/p&gt;</comment>
                            <comment id="14546031" author="kwatters" created="Fri, 15 May 2015 12:17:21 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steff1193" class="user-hover" rel="steff1193"&gt;Per Steffensen&lt;/a&gt;  My mantra here is relates to something I heard once.  &lt;cite&gt;"A graph is a filter on top of your data."-someone&lt;/cite&gt;  So, I'm offering this implementation up to solve that use case.  Analytics on top of that graph would be acheived via faceting or streaming aggregation.  Maybe there's something that Titan could leverage from this implementation?  There are some starting plans on doing a distributed version of this query operator.  &lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dpgove" class="user-hover" rel="dpgove"&gt;Dennis Gove&lt;/a&gt; Interesting syntax.  The usecase of children &amp;gt; 4 isn't currently supported in my impl.  My impl doesn't have any history of the paths through the graph.  It only has the bitset that represents the matched documents.  I wanted to keep it as lean as possible.  We could start keeping around additional data structures during the traversal to count, but that can get very expensive very quickly.  My goal/desire here is to keep the memory usage to one bitset.&lt;/p&gt;</comment>
                            <comment id="14546062" author="dpgove" created="Fri, 15 May 2015 12:37:59 -0700">&lt;p&gt;I'm with you on wanting to keep the memory usage as low as possible - I thought maybe you had that info hanging around already. In either case, I think this syntax might lower the bar to entry for usage, especially if people are already using streaming aggregation for other things. &lt;/p&gt;</comment>
                            <comment id="14547645" author="steff1193" created="Mon, 18 May 2015 00:35:04 -0700">&lt;blockquote&gt;&lt;p&gt;"A graph is a filter on top of your data."&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes I completely agree!&lt;/p&gt;

&lt;p&gt;It is just that, as far a I understand the discussion here, it is not just the very simple basics for doing graphs on top of Solr. Seems like you design for a specific "query" that you can do with a graph database: start at some docs --&amp;gt; recursively follow links/edges (up to) maxDepth times --&amp;gt; then return to me all nodes/vertices you came across (or just the leaves). This is one particular graph traversal you can do, but if you just implemented the graph-basics as a Titan search-backend you could perform all kinds of graph "queries" with the Titan search-tool Gremlin (&lt;a href="https://github.com/tinkerpop/gremlin/wiki" class="external-link" rel="nofollow"&gt;https://github.com/tinkerpop/gremlin/wiki&lt;/a&gt;) - that is more like a full graph-solution on top of Solr.&lt;/p&gt;

&lt;p&gt;I just realized from the Titan main-page (&lt;a href="http://thinkaurelius.github.io/titan/" class="external-link" rel="nofollow"&gt;http://thinkaurelius.github.io/titan/&lt;/a&gt;) that there is now some kind of integration with Solr. There wasnt when I did my implementation, but never mind, I mainly did it to understand how Titan works.&lt;/p&gt;

&lt;p&gt;It is not that I do not like this issue &lt;a href="https://issues.apache.org/jira/browse/SOLR-7543" title="Create GraphQuery that allows graph traversal as a query operator." class="issue-link" data-issue-key="SOLR-7543"&gt;&lt;del&gt;SOLR-7543&lt;/del&gt;&lt;/a&gt;. I definitely would love to see graphs on top of Solr. I am just trying to take a step back or and look at a more generic approach to all this graph stuff&lt;/p&gt;</comment>
                            <comment id="14549615" author="kwatters" created="Mon, 18 May 2015 18:27:36 -0700">&lt;p&gt;Hi &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steff1193" class="user-hover" rel="steff1193"&gt;Per Steffensen&lt;/a&gt; I agree we want to do all sorts of great types of graph queries.  Problem is, as soon as you take the step to maintain metadata about the graph traversal, the memory requirements for such an operation can be huge.&lt;/p&gt;

&lt;p&gt;The way I see it is there are likely 3 things to do to close the gap:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Make the traversalFilter a more complex datastructure (like an array), to allow different filters at different graph traversal levels.&lt;/li&gt;
	&lt;li&gt;accumulate a "weight" field on the traversed edges as part of the relevancy score (currently no ranking is done)&lt;/li&gt;
	&lt;li&gt;maintain the history of edges that traverse into a node.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;All of these could be considered for future functionality, but it would really take some re-thinking of how it all works.  For now, having the functionality to apply the graph as a filter to the result set is the goal.&lt;/p&gt;

&lt;p&gt;In many cases, if you nest these graph queries, and the documents are structured properly, you should still be able to achieve the result that you desire, but we'd have to take that on a case by case basis.&lt;/p&gt;</comment>
                            <comment id="14549652" author="kwatters" created="Mon, 18 May 2015 18:54:05 -0700">&lt;p&gt;Ok, my initial graph query parser is handling the following syntax&lt;/p&gt;

{!graph from="node_field" to="edge_field" returnRoot="true" returnOnlyLeaf="false" maxDepth=-1 traversalFilter=foo:bar}
&lt;p&gt;id:doc_8&lt;/p&gt;

&lt;p&gt;The above would start traversal at doc_8 and only walk nodes that have a field foo containing the value bar.  This seems to be (more) consistent with the rest of the query parsers.&lt;/p&gt;</comment>
                            <comment id="14550031" author="joel.bernstein" created="Tue, 19 May 2015 01:27:54 -0700">&lt;p&gt;Thanks for the nice contribution &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kwatters" class="user-hover" rel="kwatters"&gt;Kevin Watters&lt;/a&gt;!&lt;/p&gt;

&lt;p&gt;A couple of thoughts on the discussion particularly on &lt;b&gt;general&lt;/b&gt; VS &lt;b&gt;specific&lt;/b&gt; use case. I think this ticket covers a useful specific usecase, particularly for access control. And I suspect people will find other interesting uses for this type of graph query. It works for non-distributed graph traversals which is where we can do all kinds of low level things to improve performance. &lt;/p&gt;

&lt;p&gt;But it's also an opportunity to open the discussion about the generic use case which will be distributed graph queries. &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steff1193" class="user-hover" rel="steff1193"&gt;Per Steffensen&lt;/a&gt; mentions a Titan integration which would be very useful. But also as &lt;span class="error"&gt;&amp;#91;~dgove1&amp;#93;&lt;/span&gt; mentions Streaming Expressions provides us with an elegant framework for all kinds of parallel computing tasks. I think it's worth exploring how to model parallel graph joins using the Streaming Expression language and the Streaming API.&lt;/p&gt;</comment>
                            <comment id="14550438" author="yseeley@gmail.com" created="Tue, 19 May 2015 06:34:05 -0700">&lt;p&gt;Syntax looks good Kevin, having an initial simple syntax certainly doesn't preclude adding other syntaxes (or integrations) later.  Can you put up a patch?&lt;/p&gt;</comment>
                            <comment id="14550544" author="kwatters" created="Tue, 19 May 2015 07:40:58 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yseeley%40gmail.com" class="user-hover" rel="yseeley@gmail.com"&gt;Yonik Seeley&lt;/a&gt; , right now, it builds against 4.x  If I submit a patch, should be done for trunk, or is a 4.x branch ok? I'm just finishing up the unit tests, either way, I hope to have a patch submitted by the end of the week.&lt;/p&gt;</comment>
                            <comment id="14550560" author="yseeley@gmail.com" created="Tue, 19 May 2015 07:50:43 -0700">&lt;p&gt;You can submit a patch against 4x (or whatever you want).  Before it's committed, it will need to be against trunk though.&lt;br/&gt;
That doesn't necessarily mean that you have to do the work to get it on trunk... if the port is too hard or you don't have time, you can put up what you have and others may be able to help.&lt;/p&gt;</comment>
                            <comment id="14943355" author="kwatters" created="Mon, 5 Oct 2015 06:25:11 -0700">&lt;p&gt;Patch with GraphQuery / parsers / unit tests.&lt;/p&gt;</comment>
                            <comment id="14945785" author="yseeley@gmail.com" created="Tue, 6 Oct 2015 14:00:10 -0700">&lt;p&gt;Thanks Kevin,&lt;br/&gt;
I just uploaded a patch with some minor improvements, including:&lt;/p&gt;

&lt;p&gt;Slightly simplified some of the parameter parsing... example:&lt;br/&gt;
From:&lt;br/&gt;
boolean onlyLeafNodes = Boolean.valueOf(localParams.get("returnOnlyLeaf", "false"));&lt;br/&gt;
To:&lt;br/&gt;
boolean onlyLeafNodes = localParams.getBool("returnOnlyLeaf", false);&lt;/p&gt;

&lt;p&gt;Simplified some of the query handling, for instance:&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
    SolrParams params = getParams();
    SolrParams solrParams = SolrParams.wrapDefaults(localParams, params);
    QParser baseParser = subQuery(solrParams.get(QueryParsing.V), &lt;span class="code-keyword"&gt;null&lt;/span&gt;);
    &lt;span class="code-comment"&gt;// grab the graph query options / defaults
&lt;/span&gt;    Query rootNodeQuery = baseParser.getQuery();  
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Was replaced with&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
    Query rootNodeQuery = subQuery(localParams.get(QueryParsing.V), &lt;span class="code-keyword"&gt;null&lt;/span&gt;).getQuery();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I rewrote buildFrontierQuery to use TermsQuery instead of BooleanQuery (more efficient for this use case, and no 1024 limit).&lt;/p&gt;

&lt;p&gt;I also marked FrontierQuery as internal and made it package protected... it's an implementation detail and it feels like&lt;br/&gt;
we could get rid of it in the future.&lt;/p&gt;

&lt;p&gt;Unless anyone has ideas of how to improve the current interface, I think this is ready to commit! (at least to trunk)  We can continue to make more optimizations to the implementation at any point.&lt;/p&gt;</comment>
                            <comment id="14945822" author="kwatters" created="Tue, 6 Oct 2015 14:16:22 -0700">&lt;p&gt;Nice improvements!  The new TermsQuery, that definitely is a nice fit for this type of query.  (though that code path is only active if useAutn=false so it doesn't do the automaton compilation. )&lt;br/&gt;
Looks good to me, lets roll with it!&lt;/p&gt;</comment>
                            <comment id="14951223" author="jira-bot" created="Fri, 9 Oct 2015 14:27:05 -0700">&lt;p&gt;Commit 1707818 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org" class="user-hover" rel="yonik@apache.org"&gt;Yonik Seeley&lt;/a&gt; in branch 'dev/trunk'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1707818" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1707818&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-7543" title="Create GraphQuery that allows graph traversal as a query operator." class="issue-link" data-issue-key="SOLR-7543"&gt;&lt;del&gt;SOLR-7543&lt;/del&gt;&lt;/a&gt;: basic graph traversal query&lt;/p&gt;</comment>
                            <comment id="14951227" author="yseeley@gmail.com" created="Fri, 9 Oct 2015 14:28:22 -0700">&lt;p&gt;Committed.  Thanks Kevin!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12765254" name="SOLR-7543.patch" size="44932" author="yseeley@gmail.com" created="Tue, 6 Oct 2015 14:00:10 -0700"/>
                            <attachment id="12765007" name="SOLR-7543.patch" size="45668" author="kwatters" created="Mon, 5 Oct 2015 06:25:11 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 14 May 2015 16:22:08 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            30 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ep8v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-7525] Add ComplementStream to the Streaming API and Streaming Expressions</title>
                <link>https://issues.apache.org/jira/browse/SOLR-7525</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;This ticket adds a ComplementStream to the Streaming API and Streaming Expression language.&lt;/p&gt;

&lt;p&gt;The ComplementStream will wrap two TupleStreams (StreamA, StreamB) and emit Tuples from StreamA that are not in StreamB.&lt;/p&gt;

&lt;p&gt;Streaming API Syntax:&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
ComplementStream cstream = &lt;span class="code-keyword"&gt;new&lt;/span&gt; ComplementStream(streamA, streamB, comp);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Streaming Expression syntax:&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
complement(search(...), search(...), on(...))
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Internal implementation will rely on the ReducerStream. The ComplementStream can be parallelized using the ParallelStream.&lt;/p&gt;</description>
                <environment/>
        <key id="12829047">SOLR-7525</key>
            <summary>Add ComplementStream to the Streaming API and Streaming Expressions</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="10">Implemented</resolution>
                                        <assignee username="dpgove">Dennis Gove</assignee>
                                    <reporter username="joel.bernstein">Joel Bernstein</reporter>
                        <labels>
                    </labels>
                <created>Mon, 11 May 2015 19:27:39 -0700</created>
                <updated>Wed, 13 Jan 2016 10:42:25 -0700</updated>
                            <resolved>Wed, 13 Jan 2016 10:42:25 -0700</resolved>
                                                    <fixVersion>6.0</fixVersion>
                    <fixVersion>master</fixVersion>
                                    <component>SolrJ</component>
                        <due/>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="14976307" author="dpgove" created="Tue, 27 Oct 2015 05:42:55 -0700">&lt;p&gt;I've got a patch for this that also includes an IntersectStream (return tuples from streamA that also exist in streamB). I just want to add some additional tests before a post the patch.&lt;/p&gt;</comment>
                            <comment id="14981511" author="dpgove" created="Thu, 29 Oct 2015 15:58:28 -0700">&lt;p&gt;Includes both ComplementStream and IntersectStream. All tests pass.&lt;/p&gt;

&lt;p&gt;Depends on &lt;a href="https://issues.apache.org/jira/browse/SOLR-8198" title="Change ReducerStream to use StreamEqualitor instead of StreamComparator" class="issue-link" data-issue-key="SOLR-8198"&gt;&lt;del&gt;SOLR-8198&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15052115" author="joel.bernstein" created="Thu, 10 Dec 2015 20:51:19 -0700">&lt;p&gt;Ah, I didn't realize there was already a patch for this. I can add the parallel tests tomorrow.&lt;/p&gt;</comment>
                            <comment id="15063407" author="gerlowskija" created="Thu, 17 Dec 2015 21:14:31 -0700">&lt;p&gt;Hi all.&lt;/p&gt;

&lt;p&gt;I wanted to take a stab at adding the missing parallel tests that Joel&lt;br/&gt;
alluded to in his most recent comment.&lt;/p&gt;

&lt;p&gt;When I went to pull it down though, I realized that this patch no longer&lt;br/&gt;
applies cleanly on top of the recent changes to ReduceOperation/ReducerStream.&lt;/p&gt;

&lt;p&gt;To main highlights of the recent ReducerStream changes are:&lt;br/&gt;
  1.) ReducerStream now requires a ReducerOperation.&lt;br/&gt;
  2.) (Currently), the only ReducerOperation implementation is &lt;tt&gt;GroupOperation&lt;/tt&gt;&lt;br/&gt;
  3.) &lt;tt&gt;GroupOperation&lt;/tt&gt; requires a &lt;tt&gt;StreamComparator&lt;/tt&gt;, and an int 'size'.  The &lt;br/&gt;
      size is used to limit the number of tuples to hold on to in each grouping.&lt;br/&gt;
      When the upper bound is reached, the least tuple is dropped (according to the &lt;br/&gt;
      comparator).&lt;br/&gt;
  4.) The only &lt;tt&gt;StreamComparator&lt;/tt&gt; implementations are &lt;tt&gt;FieldComparator&lt;/tt&gt;, and &lt;br/&gt;
      &lt;tt&gt;MultiFieldComparator&lt;/tt&gt;, both of which require a field name.&lt;/p&gt;

&lt;p&gt;The net effect of these changes is that IntersectStream and ComplementStream need&lt;br/&gt;
a field name at creation time (because they rely on ReducerStream, which relies on&lt;br/&gt;
ReducerOperation, which...).&lt;/p&gt;

&lt;p&gt;As I see it, &lt;tt&gt;IntersectStream&lt;/tt&gt; and &lt;tt&gt;ComplementStream&lt;/tt&gt; shouldn't need&lt;br/&gt;
this chain of objects.  AFAICT, since their job is to do logical operations,&lt;br/&gt;
it'd be wrong for their internal &lt;tt&gt;ReducerStream&lt;/tt&gt; to drop tuples based on an&lt;br/&gt;
arbitrary limit.  And since we don't want to drop tuples, there's no need for a&lt;br/&gt;
StreamComparator either.&lt;/p&gt;

&lt;p&gt;Two resolutions come to mind here:&lt;br/&gt;
  1.) Modify GroupOperation so that the 'size' (and comparator) can be optional.&lt;br/&gt;
  2.) Create a no-op StreamComparator, or one that always returns "equal", to pass&lt;br/&gt;
      into the existing GroupOperation.&lt;/p&gt;

&lt;p&gt;I'm leaning towards the first option.  It seems more generally useful, and creating&lt;br/&gt;
a no-op class seems like a bit of a hack.&lt;/p&gt;

&lt;p&gt;Anyone have opinions/thoughts on this?  Have I missed something obvious/simple here,&lt;br/&gt;
or misread the code entirely?  Is there another option to resolve this conflict that&lt;br/&gt;
I missed?&lt;/p&gt;

&lt;p&gt;In any case, just wanted to get some feedback on the best way to resolve this change&lt;br/&gt;
before I move onto actually adding the new tests.&lt;/p&gt;</comment>
                            <comment id="15063456" author="dpgove" created="Thu, 17 Dec 2015 21:55:30 -0700">&lt;p&gt;I'll rebase this off trunk so it is a little cleaner but I think the use of ReducerStream still holds. &lt;/p&gt;

&lt;p&gt;The purpose of Complement and Intersect is to return tuples in A which either do or do not exist in B. The tuples in B aren't used for anything and are dropped as soon as possible. The reason they make use of the ReducerStream is because B having 1 instance of some tuple found in A is the same as B having 100 instances of some tuple found in A. Whether its 1 or 100 the tuple exists in B so its twin in A can either be returned from A or not. For this reason the size of the ReducerStream can always just be 1 because we only care about the first one and all others can be dropped from B. The fieldName (or fieldNames because you can do an intersect on N fields) provided to the ReducerStream are the fields the Intersect or Complement streams are acting on. &lt;/p&gt;

&lt;p&gt;Essentially, the goal is to take all the tuples in B and reduce them down to a unique list of tuples where uniqueness is defined over the fields that the intersect or complement is being checked over. Given that B is a set of unique tuples it is much easier to know when to move onto the next tuple in B.&lt;/p&gt;

&lt;p&gt;I'll take a look at the GroupOperation but I would suspect that it can use a StreamEqualitor instead of a StreamComparator. A comparator allows order while an equalitor just checks if they are equal. There may be a reason it allows for ordering, though.&lt;/p&gt;</comment>
                            <comment id="15063898" author="joel.bernstein" created="Fri, 18 Dec 2015 05:33:16 -0700">&lt;p&gt;Let's not change the GroupOperation because it has useful functionality. Let's create a new ReduceOperation that behaves the way we need it to.&lt;/p&gt;

&lt;p&gt;The main reason for adding ReduceOperations was so that we could specialize the reduce behavior.&lt;/p&gt;</comment>
                            <comment id="15064009" author="gerlowskija" created="Fri, 18 Dec 2015 07:39:01 -0700">&lt;blockquote&gt;&lt;p&gt;the tuples in B aren't used for anything and are dropped as soon as possible. The reason they make use of the ReducerStream is because B having 1 instance of some tuple found in A is the same as B having 100 instances of some tuple found in A. Whether its 1 or 100 the tuple exists in B so its twin in A can either be returned from A or not. For this reason the size of the ReducerStream can always just be 1&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Ah, this makes sense now.  I was misreading &lt;tt&gt;ReducerStream&lt;/tt&gt;.  That makes most of the rest of my comment invalid.  But, learn something new every day I guess...Looking forward to seeing your update to the patch, so I can get a better idea of how this should work.  Thanks for the clarification Dennis.&lt;/p&gt;</comment>
                            <comment id="15064830" author="dpgove" created="Fri, 18 Dec 2015 14:51:53 -0700">&lt;p&gt;Rebases off of trunk and adds a DistinctOperation for use in the ReducerStream. The DistinctOperation ensures that for any given group only a single tuple will be returned. Currently it is implemented to return the first tuple in a group but a possible enhancement down the road could be to support a parameter asking for some other tuple in the group (such as the first in a sub-sorted list).&lt;/p&gt;

&lt;p&gt;Also, while implementing this I realized that the UniqueStream can be refactored to be just a type of ReducerStream with DistinctOperation. &lt;del&gt;That change is not included in this patch but will be done under a separate ticket.&lt;/del&gt;&lt;/p&gt;

&lt;p&gt;Also of note, I'm not sure if the getChildren() function declared in TupleStream is necessary any longer. If I recall correctly that function was used by the StreamHandler when passing streams to workers but since all that has been changed to pass the result of toExpression(....)  I think we can get rid of the getChildren() function. I will explore that possibility.&lt;/p&gt;</comment>
                            <comment id="15064846" author="dpgove" created="Fri, 18 Dec 2015 15:05:41 -0700">&lt;p&gt;As it turns out IntersectStream and ComplementStream can both make use of a UniqueStream which makes use of a ReducerStream. As such this new patch implements Intersect and Complement with streamB as an instance of UniqueStream. UniqueStream is changed to be implemented as a type of ReducerStream.&lt;/p&gt;</comment>
                            <comment id="15065531" author="gerlowskija" created="Sat, 19 Dec 2015 14:02:53 -0700">&lt;p&gt;Hey Dennis, question about the new patch.&lt;/p&gt;

&lt;p&gt;Is there a reason that &lt;tt&gt;DistinctOperation&lt;/tt&gt; was created with a ctor taking in a &lt;tt&gt;StreamExpression&lt;/tt&gt; and a &lt;tt&gt;StreamFactory&lt;/tt&gt;?  Is there a reason that both ctors call into an empty &lt;tt&gt;init()&lt;/tt&gt; function? Is that a consistency/style thing that we're trying to stick to in this part of the code (keep all the &lt;tt&gt;ReduceOperation&lt;/tt&gt; implementations structured similarly).  Or is there a technical reason for this?&lt;/p&gt;

&lt;p&gt;Other than that question, everything looks good to me.&lt;/p&gt;</comment>
                            <comment id="15065536" author="dpgove" created="Sat, 19 Dec 2015 14:12:46 -0700">&lt;p&gt;Yes, you hit that right on the head. It was for consistency in the structure of Expressible classes. Also, currently it's implemented to return the first seen tuple in a group. However, I could see an enhancement where one could provide a selector to choose maybe the last seen, or the first based on some alternative order. For example, were someone to use the DistinctOperation in an expression it would currently look like this &lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
distinct()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;but I could also see it looking like one of these&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
distinct(first, sort=&lt;span class="code-quote"&gt;"fieldA desc, fieldB desc"&lt;/span&gt;)
distinct(first, having=&lt;span class="code-quote"&gt;"fieldA != &lt;span class="code-keyword"&gt;null&lt;/span&gt;"&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Essentially, although not currently supported it would be possible to expand the reducer operations to support complex selectors when a choice over which tuple to select is required.&lt;/p&gt;

&lt;p&gt;All that said, for now it's just for consistency.&lt;/p&gt;</comment>
                            <comment id="15065793" author="gerlowskija" created="Sun, 20 Dec 2015 07:59:21 -0700">&lt;p&gt;I added two test clauses in &lt;tt&gt;StreamExpressionTest&lt;/tt&gt; that combine the use of Complement/Intersect with a &lt;tt&gt;ParallelStream&lt;/tt&gt;.  &lt;tt&gt;testParallelComplementStream&lt;/tt&gt; and &lt;tt&gt;testParallelIntersectStream&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Hopefully this is what Joel was looking for when he mentioned that this could use some parallel tests.&lt;/p&gt;</comment>
                            <comment id="15075387" author="gerlowskija" created="Wed, 30 Dec 2015 13:46:26 -0700">&lt;p&gt;Uh, oh.  When I uploaded my recent patch, I neglected to &lt;tt&gt;svn add&lt;/tt&gt; some files that Dennis had created in his prior revision.&lt;/p&gt;

&lt;p&gt;This updated patch fixes the prior mistake.&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=joel.bernstein" class="user-hover" rel="joel.bernstein"&gt;Joel Bernstein&lt;/a&gt; Is there anything else you were looking for test-wise on this patch?  I added tests that mirrored the parallel-tests from other streams, but I might've missed something.&lt;/p&gt;</comment>
                            <comment id="15075420" author="joel.bernstein" created="Wed, 30 Dec 2015 14:32:16 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gerlowskija" class="user-hover" rel="gerlowskija"&gt;Jason Gerlowski&lt;/a&gt;, the latest patch looks pretty far along. I may add a few more tests before committing but it's pretty close.&lt;br/&gt;
Thanks for your work on this!&lt;/p&gt;</comment>
                            <comment id="15096377" author="dpgove" created="Wed, 13 Jan 2016 08:51:28 -0700">&lt;p&gt;Rebased against trunk&lt;/p&gt;</comment>
                            <comment id="15096654" author="jira-bot" created="Wed, 13 Jan 2016 10:41:42 -0700">&lt;p&gt;Commit 1724468 from dpgove@apache.org in branch 'dev/trunk'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1724468" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1724468&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-7525" title="Add ComplementStream to the Streaming API and Streaming Expressions" class="issue-link" data-issue-key="SOLR-7525"&gt;&lt;del&gt;SOLR-7525&lt;/del&gt;&lt;/a&gt;: Add ComplementStream and IntersectStream to the Streaming API and Streaming Expressions&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12902422">SOLR-8125</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12902422">SOLR-8125</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12782075" name="SOLR-7525.patch" size="36208" author="dpgove" created="Wed, 13 Jan 2016 08:51:28 -0700"/>
                            <attachment id="12780042" name="SOLR-7525.patch" size="35500" author="gerlowskija" created="Wed, 30 Dec 2015 13:46:26 -0700"/>
                            <attachment id="12778740" name="SOLR-7525.patch" size="17164" author="gerlowskija" created="Sun, 20 Dec 2015 07:59:21 -0700"/>
                            <attachment id="12778606" name="SOLR-7525.patch" size="33078" author="dpgove" created="Fri, 18 Dec 2015 15:05:41 -0700"/>
                            <attachment id="12778603" name="SOLR-7525.patch" size="28406" author="dpgove" created="Fri, 18 Dec 2015 14:51:53 -0700"/>
                            <attachment id="12769659" name="SOLR-7525.patch" size="20279" author="dpgove" created="Thu, 29 Oct 2015 15:58:28 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 27 Oct 2015 12:42:55 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2elh3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-7339] Upgrade Jetty from 9.2 to 9.3</title>
                <link>https://issues.apache.org/jira/browse/SOLR-7339</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Jetty 9.3 offers support for HTTP/2. Interest in HTTP/2 or its predecessor SPDY was shown in &lt;a href="https://issues.apache.org/jira/browse/SOLR-6699" class="external-link" rel="nofollow"&gt;SOLR-6699&lt;/a&gt; and &lt;a href="http://markmail.org/message/jyhcmwexn65gbdsx" class="external-link" rel="nofollow"&gt;on the mailing list&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Among the HTTP/2 benefits over HTTP/1.1 relevant to Solr are:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;multiplexing requests over a single TCP connection ("streams")&lt;/li&gt;
	&lt;li&gt;canceling a single request without closing the TCP connection&lt;/li&gt;
	&lt;li&gt;removing &lt;a href="https://http2.github.io/faq/#why-is-http2-multiplexed" class="external-link" rel="nofollow"&gt;head-of-line blocking&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;header compression&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Caveats:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Jetty 9.3 is at M2, not released.&lt;/li&gt;
	&lt;li&gt;Full Solr support for HTTP/2 would require more work than just upgrading Jetty. The server configuration would need to change and a new HTTP client (&lt;a href="https://github.com/eclipse/jetty.project/tree/master/jetty-http2" class="external-link" rel="nofollow"&gt;Jetty's own client&lt;/a&gt;, &lt;a href="http://square.github.io/okhttp/" class="external-link" rel="nofollow"&gt;Square's OkHttp&lt;/a&gt;, &lt;a href="https://github.com/http2/http2-spec/wiki/Implementations" class="external-link" rel="nofollow"&gt;etc.&lt;/a&gt;) would need to be selected and wired up. Perhaps this is worthy of a branch?&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment/>
        <key id="12787439">SOLR-7339</key>
            <summary>Upgrade Jetty from 9.2 to 9.3</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="markrmiller@gmail.com">Mark Miller</assignee>
                                    <reporter username="greggny3">Gregg Donovan</reporter>
                        <labels>
                    </labels>
                <created>Wed, 1 Apr 2015 11:50:41 -0700</created>
                <updated>Sun, 20 Mar 2016 17:43:25 -0700</updated>
                            <resolved>Wed, 16 Mar 2016 22:50:05 -0700</resolved>
                                                    <fixVersion>6.0</fixVersion>
                    <fixVersion>master</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>12</watches>
                                                                <comments>
                            <comment id="14391351" author="shalinmangar" created="Wed, 1 Apr 2015 13:11:22 -0700">&lt;p&gt;Yep, we're going to Jetty 9 soon. See &lt;a href="https://issues.apache.org/jira/browse/SOLR-4839" title="Jetty 9" class="issue-link" data-issue-key="SOLR-4839"&gt;&lt;del&gt;SOLR-4839&lt;/del&gt;&lt;/a&gt; where I already upgraded to Jetty 9.2 in trunk so that we could go to SPDY but then SPDY was deprecated and HTTP/2 will come out in 9.3. So my next plan is to target 9.3 as soon as it is out and then use Jetty's HTTP client throughout. In the meanwhile, I'll port Jetty 9.2 to 5.x branches after 5.1 is released.&lt;/p&gt;

&lt;p&gt;If you don't mind, I will close this issue and we can continue the discussion on &lt;a href="https://issues.apache.org/jira/browse/SOLR-4839" title="Jetty 9" class="issue-link" data-issue-key="SOLR-4839"&gt;&lt;del&gt;SOLR-4839&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14391377" author="greggny3" created="Wed, 1 Apr 2015 13:25:50 -0700">&lt;p&gt;My apologies! I didn't realize &lt;a href="https://issues.apache.org/jira/browse/SOLR-4839" title="Jetty 9" class="issue-link" data-issue-key="SOLR-4839"&gt;&lt;del&gt;SOLR-4839&lt;/del&gt;&lt;/a&gt; was still open. I have a trunk patch for part of Jetty 9.2-&amp;gt;9.3. Which ticket should I add that to?&lt;/p&gt;</comment>
                            <comment id="14391391" author="shalinmangar" created="Wed, 1 Apr 2015 13:32:55 -0700">&lt;p&gt;Hmm, you bring up a good point. You can attach the patch here on this issue itself. I'll link this with &lt;a href="https://issues.apache.org/jira/browse/SOLR-4839" title="Jetty 9" class="issue-link" data-issue-key="SOLR-4839"&gt;&lt;del&gt;SOLR-4839&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I don't think we will push a jetty m2 release to trunk so we can keep &lt;a href="https://issues.apache.org/jira/browse/SOLR-4839" title="Jetty 9" class="issue-link" data-issue-key="SOLR-4839"&gt;&lt;del&gt;SOLR-4839&lt;/del&gt;&lt;/a&gt; for the move to 9.2 and then use this issue for the 9.3 upgrade.&lt;/p&gt;</comment>
                            <comment id="14391465" author="greggny3" created="Wed, 1 Apr 2015 14:07:53 -0700">&lt;p&gt;Partial patch to move from Jetty 9.2 to 9.3M2. A few tests are fixed but HttpPartitionTest.test stalled out for a few hours and SolrExampleStreamingTest.testUpdateField fails.&lt;/p&gt;</comment>
                            <comment id="14391466" author="greggny3" created="Wed, 1 Apr 2015 14:08:30 -0700">&lt;p&gt;Thanks, Shalin. I'll update the ticket title to reflect that this builds on &lt;a href="https://issues.apache.org/jira/browse/SOLR-4839" title="Jetty 9" class="issue-link" data-issue-key="SOLR-4839"&gt;&lt;del&gt;SOLR-4839&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14568519" author="billnbell" created="Mon, 1 Jun 2015 21:52:06 -0700">&lt;p&gt;&lt;a href="http://central.maven.org/maven2/org/eclipse/jetty/jetty-distribution/9.3.0.RC0/" class="external-link" rel="nofollow"&gt;http://central.maven.org/maven2/org/eclipse/jetty/jetty-distribution/9.3.0.RC0/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;RC0 released&lt;/p&gt;</comment>
                            <comment id="14587673" author="thetaphi" created="Tue, 16 Jun 2015 01:33:10 -0700">&lt;p&gt;9.3.0 was finally released on Jun 12: &lt;a href="https://dev.eclipse.org/mhonarc/lists/jetty-announce/msg00080.html" class="external-link" rel="nofollow"&gt;https://dev.eclipse.org/mhonarc/lists/jetty-announce/msg00080.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Please keep in mind, that we can do the upgrade only on trunk, because Jety 9.3 requires Java 8 as minimum requirement.&lt;/p&gt;</comment>
                            <comment id="14702549" author="billnbell" created="Tue, 18 Aug 2015 23:05:07 -0700">&lt;p&gt;Java 7 is EOL&lt;/p&gt;

&lt;p&gt;Java SE 7 End of Public Updates Notice&lt;br/&gt;
After April 2015, Oracle will no longer post updates of Java SE 7 to its public download sites. Existing Java SE 7 downloads already posted as of April 2015 will remain accessible in the Java Archive on the Oracle Technology Network. Developers and end-users are encouraged to update to more recent Java SE versions that remain available for public download in order to continue receiving public updates and security enhancements. &lt;/p&gt;

&lt;p&gt;&lt;a href="https://www.java.com/en/download/faq/java_7.xml" class="external-link" rel="nofollow"&gt;https://www.java.com/en/download/faq/java_7.xml&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14702560" author="shalinmangar" created="Tue, 18 Aug 2015 23:17:15 -0700">&lt;p&gt;See &lt;a href="https://issues.apache.org/jira/browse/LUCENE-6722" title="Java 8 as the minimum supported JVM version for branch_5x" class="issue-link" data-issue-key="LUCENE-6722"&gt;&lt;del&gt;LUCENE-6722&lt;/del&gt;&lt;/a&gt; for the Java 8 discussion. The consensus is to move to Java 8 in 6.x and keep 5.x releases on Java 7.&lt;/p&gt;</comment>
                            <comment id="15032415" author="shalinmangar" created="Mon, 30 Nov 2015 13:33:45 -0700">&lt;p&gt;Patch to upgrade trunk to Jetty 9.3.6.v20151106&lt;/p&gt;</comment>
                            <comment id="15033045" author="jira-bot" created="Mon, 30 Nov 2015 21:21:36 -0700">&lt;p&gt;Commit 1717377 from shalin@apache.org in branch 'dev/trunk'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1717377" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1717377&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-7339" title="Upgrade Jetty from 9.2 to 9.3" class="issue-link" data-issue-key="SOLR-7339"&gt;&lt;del&gt;SOLR-7339&lt;/del&gt;&lt;/a&gt;: Upgrade Jetty to v9.3.6.v20151106&lt;/p&gt;</comment>
                            <comment id="15033101" author="shalinmangar" created="Mon, 30 Nov 2015 22:10:08 -0700">&lt;p&gt;This is a trunk-only feature (requires Java8) so backporting to 5x is not necessary.&lt;/p&gt;

&lt;p&gt;Thanks Gregg!&lt;/p&gt;</comment>
                            <comment id="15033522" author="shalinmangar" created="Tue, 1 Dec 2015 04:09:07 -0700">&lt;p&gt;Oops, this broke the tests because Jetty 9.3 removed the GzipFilter functionality but didn't actually remove the filter class!&lt;/p&gt;

&lt;p&gt;I'll test with the fix that Greg has given in his original patch.&lt;/p&gt;</comment>
                            <comment id="15033665" author="jira-bot" created="Tue, 1 Dec 2015 06:23:09 -0700">&lt;p&gt;Commit 1717431 from shalin@apache.org in branch 'dev/trunk'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1717431" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1717431&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-7339" title="Upgrade Jetty from 9.2 to 9.3" class="issue-link" data-issue-key="SOLR-7339"&gt;&lt;del&gt;SOLR-7339&lt;/del&gt;&lt;/a&gt;: Use GzipHandler instead of GzipFilter&lt;/p&gt;</comment>
                            <comment id="15033865" author="shalinmangar" created="Tue, 1 Dec 2015 08:28:02 -0700">&lt;p&gt;There's still a curious failure in SolrExampleStreamingBinaryTest.testUpdateField which runs into connection reset errors with the new jetty and I'm not sure why.&lt;/p&gt;</comment>
                            <comment id="15034495" author="jira-bot" created="Tue, 1 Dec 2015 13:12:21 -0700">&lt;p&gt;Commit 1717512 from shalin@apache.org in branch 'dev/trunk'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1717512" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1717512&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-7339" title="Upgrade Jetty from 9.2 to 9.3" class="issue-link" data-issue-key="SOLR-7339"&gt;&lt;del&gt;SOLR-7339&lt;/del&gt;&lt;/a&gt;: Disabling testUpdateField until we can fix the underlying issue&lt;/p&gt;</comment>
                            <comment id="15034670" author="greggny3" created="Tue, 1 Dec 2015 15:01:52 -0700">&lt;p&gt;Thanks, &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalinmangar" class="user-hover" rel="shalinmangar"&gt;Shalin Shekhar Mangar&lt;/a&gt;! &lt;/p&gt;

&lt;p&gt;Wireshark dumps of SolrExampleStreamingBinaryTest.testUpdateField show Jetty 9.3 sends an RST after the expected "HTTP 409 Conflict" and Jetty 9.2 does not. I haven't figured out what's changed in 9.3 that leads to this, though.&lt;/p&gt;</comment>
                            <comment id="15034746" author="greggny3" created="Tue, 1 Dec 2015 15:33:17 -0700">&lt;p&gt;Attached are the Wireshark files for 9.2 (right before the 9.3 commits) and with the 9.3 commits. &lt;/p&gt;</comment>
                            <comment id="15036185" author="joakime" created="Wed, 2 Dec 2015 10:23:36 -0700">&lt;p&gt;The Jetty Project developers took a look at this and ...&lt;/p&gt;

&lt;p&gt;If you turn on DEBUG logging for Jetty, you'll see that the test does not send correct data to the server.&lt;br/&gt;
The request that fails sends data using chunked encoding, but sends one chunk of length 0x59, but does not send the terminal chunk.&lt;br/&gt;
The logs show Jetty reporting that the processing is complete but with unconsumed input, and therefore closes the connection.&lt;br/&gt;
Could this be a Solr client bug in disguise?&lt;/p&gt;

&lt;p&gt;Look at the attached SolrExampleStreamingBinaryTest.testUpdateField-jetty93.pcapng&lt;/p&gt;

&lt;p&gt;Filter: tcp.stream eq 4&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
POST /solr/collection1/update?wt=javabin&amp;amp;version=2 HTTP/1.1
User-Agent: Solr[org.apache.solr.client.solrj.impl.HttpSolrClient] 1.0
Content-Type: application/javabin
Transfer-Encoding: chunked
Host: 127.0.0.1:52488
Connection: Keep-Alive

59
...&amp;amp;params..&amp;amp;delByQ..'docsMap.....?...."id&amp;amp;unique.)_version_....4.....'price_f
..#setT...
HTTP/1.1 409 Conflict
Date: Tue, 01 Dec 2015 19:44:38 GMT
Content-Type: application/octet-stream
Content-Length: 144
Server: Jetty(9.3.6.v20151106)

....responseHeader..&amp;amp;statusY..%QTimeP..%error..#msg?4version conflict &lt;span class="code-keyword"&gt;for&lt;/span&gt; unique expected=1519385657324077057 actual=1519385657324077056.$codeY.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15036273" author="ichattopadhyaya" created="Wed, 2 Dec 2015 11:06:11 -0700">&lt;p&gt;Yesterday, I ran the same test using a debugger, and I put a breakpoint at SolrCore.postDecorateResponse's first line (and subsequently I hit resume at every instance of the breakpoint), then the test passes. I suspect there is some timing issue here. I couldn't find anything obvious. Even tried upgrading to the November release of the jetty-server artifacts, same results.&lt;/p&gt;</comment>
                            <comment id="15037870" author="jira-bot" created="Thu, 3 Dec 2015 07:54:28 -0700">&lt;p&gt;Commit 1717777 from shalin@apache.org in branch 'dev/trunk'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1717777" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1717777&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-7339" title="Upgrade Jetty from 9.2 to 9.3" class="issue-link" data-issue-key="SOLR-7339"&gt;&lt;del&gt;SOLR-7339&lt;/del&gt;&lt;/a&gt;: Remove http2-parent as a dependency because it is only a pom and thus fails our maven builds&lt;/p&gt;</comment>
                            <comment id="15037874" author="shalinmangar" created="Thu, 3 Dec 2015 07:56:19 -0700">&lt;p&gt;Thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=joakime" class="user-hover" rel="joakime"&gt;Joakim Erdfelt&lt;/a&gt;. I'll dig into why this is happening. As Ishan pointed out, adding a breakpoint in the test makes it pass so there's a subtle race condition somewhere.&lt;/p&gt;</comment>
                            <comment id="15065807" author="shalinmangar" created="Sun, 20 Dec 2015 08:30:49 -0700">&lt;p&gt;Comparing the debug output from Jetty 9.2.13.v20150730, I see that Solr's behavior has remained the same but Jetty now closes the connection on unconsumed input. I also found that HttpClient by default will retry 3 times when such a thing happens which is clearly not right. Adding params.set(HttpClientUtil.PROP_USE_RETRY, false); to the HttpSolrClient constructor disables those retries. I think we should add that anyway even though it doesn't help fix these failures.&lt;/p&gt;</comment>
                            <comment id="15066465" author="markrmiller@gmail.com" created="Mon, 21 Dec 2015 06:56:13 -0700">&lt;blockquote&gt;&lt;p&gt;I think we should add that anyway even though it doesn't help fix these failures.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Let's open a separate issue for that. Internal HttpClient usage should be getting an instance setup with the Retry policy that we want. I'm a little skeptical that we just want to hard code it as off in the HttpSolrClient constructor, but perhaps there is something to dig into there.&lt;/p&gt;

&lt;p&gt;This upgrade is a bit scary at the moment. I see in one of the repeatable connection reset issues, hard coding the Locale to English for the test makes it pass. Other issues don't seem to relate to the Locale. Unless we can get to the bottom of this quickly, we may want to pull this back and get a handle a better handle on the problems before putting it in.&lt;/p&gt;</comment>
                            <comment id="15066487" author="shalinmangar" created="Mon, 21 Dec 2015 07:17:29 -0700">&lt;blockquote&gt;&lt;p&gt;Let's open a separate issue for that. Internal HttpClient usage should be getting an instance setup with the Retry policy that we want. I'm a little skeptical that we just want to hard code it as off in the HttpSolrClient constructor, but perhaps there is something to dig into there.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I opened &lt;a href="https://issues.apache.org/jira/browse/SOLR-8450" title="Our HttpClient retry policy is too permissive." class="issue-link" data-issue-key="SOLR-8450"&gt;&lt;del&gt;SOLR-8450&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;This upgrade is a bit scary at the moment. I see in one of the repeatable connection reset issues, hard coding the Locale to English for the test makes it pass. Other issues don't seem to relate to the Locale. Unless we can get to the bottom of this quickly, we may want to pull this back and get a handle a better handle on the problems before putting it in.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Agreed. Let's give it a day or two. If we can't find the root cause, I will revert this upgrade.&lt;/p&gt;</comment>
                            <comment id="15066701" author="markrmiller@gmail.com" created="Mon, 21 Dec 2015 09:55:36 -0700">&lt;p&gt;The above test does not easily replicate for me.&lt;/p&gt;

&lt;p&gt;For someone that it does, could you give this patch a shot?&lt;/p&gt;

&lt;div class="preformatted panel" style="border-width: 1px;"&gt;&lt;div class="preformattedContent panelContent"&gt;
&lt;pre&gt;Index: solr/solrj/src/java/org/apache/solr/client/solrj/impl/HttpSolrClient.java
===================================================================
--- solr/solrj/src/java/org/apache/solr/client/solrj/impl/HttpSolrClient.java	(revision 1720969)
+++ solr/solrj/src/java/org/apache/solr/client/solrj/impl/HttpSolrClient.java	(working copy)
@@ -589,14 +589,16 @@
       throw new SolrServerException(
           "IOException occured when talking to server at: " + getBaseURL(), e);
     } finally {
-      if (respBody != null &amp;amp;&amp;amp; shouldClose) {
-        try {
-          respBody.close();
-        } catch (IOException e) {
-          log.error("", e);
-        } finally {
-          if (!success) {
-            method.abort();
+      try {
+        if (!success) {
+          method.abort();
+        }
+      } finally {
+        if (respBody != null &amp;amp;&amp;amp; shouldClose) {
+          try {
+            respBody.close();
+          } catch (IOException e) {
+            log.error("", e);
           }
         }
       }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15066716" author="markrmiller@gmail.com" created="Mon, 21 Dec 2015 10:07:54 -0700">&lt;p&gt;I moved the method abort call out of 'shouldClose' - it doesn't seem like it should be tied up in that.&lt;/p&gt;

&lt;p&gt;I also made it first. I was just kind of guessing on that, but it looks like it should be first according to: &lt;a href="https://hc.apache.org/httpcomponents-client-ga/httpclient/examples/org/apache/http/examples/client/ClientAbortMethod.java" class="external-link" rel="nofollow"&gt;https://hc.apache.org/httpcomponents-client-ga/httpclient/examples/org/apache/http/examples/client/ClientAbortMethod.java&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15066735" author="ichattopadhyaya" created="Mon, 21 Dec 2015 10:22:01 -0700">&lt;p&gt;Mark, I applied your patch and ran the test, but the test still fails with the following output. It appears to be the same as what I saw without your patch, but the exact error isn't clear to me from that output.&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
[ishan@x230 solr]$ ant clean test -Dtestcase=SolrExampleStreamingBinaryTest -Dtests.method=testUpdateField
...
ivy-configure:
[ivy:configure] :: loading settings :: file = /home/ishan/code/lucene-solr-svn/lucene/ivy-settings.xml

resolve:

init:

compile-core:

validate:

resolve-groovy:

-init-totals:

-test:
    [mkdir] Created dir: /home/ishan/code/lucene-solr-svn/solr/build/solr-solrj/test
    [mkdir] Created dir: /home/ishan/code/lucene-solr-svn/solr/build/solr-solrj/test/temp
   [junit4] &amp;lt;JUnit4&amp;gt; says ! Master seed: EC056F9D893F1A9A
   [junit4] Executing 1 suite with 1 JVM.
   [junit4] 
   [junit4] Started J0 PID(1129@x230).
   [junit4] Suite: org.apache.solr.client.solrj.embedded.SolrExampleStreamingBinaryTest
   [junit4]   2&amp;gt; Creating dataDir: /home/ishan/code/lucene-solr-svn/solr/build/solr-solrj/test/J0/temp/solr.client.solrj.embedded.SolrExampleStreamingBinaryTest_EC056F9D893F1A9A-001/init-core-data-001
   [junit4]   2&amp;gt; 0    INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    ] o.a.s.SolrTestCaseJ4 ####initCore
   [junit4]   2&amp;gt; 2    INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    ] o.a.s.SolrTestCaseJ4 ####initCore end
   [junit4]   2&amp;gt; 6    INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    ] o.a.s.SolrTestCaseJ4 Writing core.properties file to /home/ishan/code/lucene-solr-svn/solr/build/solr-solrj/test/J0/temp/solr.client.solrj.embedded.SolrExampleStreamingBinaryTest_EC056F9D893F1A9A-001/tempDir-002/cores/core
   [junit4]   2&amp;gt; 46   INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    ] o.e.j.u.log Logging initialized @2663ms
   [junit4]   2&amp;gt; 277  INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    ] o.e.j.s.Server jetty-9.3.6.v20151106
   [junit4]   2&amp;gt; 323  INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    ] o.e.j.s.h.ContextHandler Started o.e.j.s.ServletContextHandler@6ec49310{/solr,&lt;span class="code-keyword"&gt;null&lt;/span&gt;,AVAILABLE}
   [junit4]   2&amp;gt; 339  INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    ] o.e.j.s.ServerConnector Started ServerConnector@3b2c45{HTTP/1.1,[http/1.1]}{127.0.0.1:33129}
   [junit4]   2&amp;gt; 339  INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    ] o.e.j.s.Server Started @2960ms
   [junit4]   2&amp;gt; 340  INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    ] o.a.s.c.s.e.JettySolrRunner Jetty properties: {hostContext=/solr, hostPort=33129, configSetBaseDir=/home/ishan/code/lucene-solr-svn/solr/build/solr-solrj/test/J0/temp/solr.client.solrj.embedded.SolrExampleStreamingBinaryTest_EC056F9D893F1A9A-001/tempDir-001, coreRootDirectory=/home/ishan/code/lucene-solr-svn/solr/build/solr-solrj/test/J0/temp/solr.client.solrj.embedded.SolrExampleStreamingBinaryTest_EC056F9D893F1A9A-001/tempDir-002/cores}
   [junit4]   2&amp;gt; 349  INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    ] o.a.s.s.SolrDispatchFilter SolrDispatchFilter.init(): sun.misc.Launcher$AppClassLoader@4e0e2f2a
   [junit4]   2&amp;gt; 385  INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    ] o.a.s.c.SolrResourceLoader &lt;span class="code-keyword"&gt;new&lt;/span&gt; SolrResourceLoader &lt;span class="code-keyword"&gt;for&lt;/span&gt; directory: '/home/ishan/code/lucene-solr-svn/solr/build/solr-solrj/test/J0/temp/solr.client.solrj.embedded.SolrExampleStreamingBinaryTest_EC056F9D893F1A9A-001/tempDir-001'
   [junit4]   2&amp;gt; 391  INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    ] o.a.s.c.SolrResourceLoader JNDI not configured &lt;span class="code-keyword"&gt;for&lt;/span&gt; solr (NoInitialContextEx)
   [junit4]   2&amp;gt; 393  INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    ] o.a.s.c.SolrResourceLoader using system property solr.solr.home: /home/ishan/code/lucene-solr-svn/solr/build/solr-solrj/test/J0/temp/solr.client.solrj.embedded.SolrExampleStreamingBinaryTest_EC056F9D893F1A9A-001/tempDir-001
   [junit4]   2&amp;gt; 401  INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    ] o.a.s.c.SolrXmlConfig Loading container configuration from /home/ishan/code/lucene-solr-svn/solr/build/solr-solrj/test/J0/temp/solr.client.solrj.embedded.SolrExampleStreamingBinaryTest_EC056F9D893F1A9A-001/tempDir-001/solr.xml
   [junit4]   2&amp;gt; 914  INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    ] o.a.s.c.CorePropertiesLocator Config-defined core root directory: /home/ishan/code/lucene-solr-svn/solr/build/solr-solrj/test/J0/temp/solr.client.solrj.embedded.SolrExampleStreamingBinaryTest_EC056F9D893F1A9A-001/tempDir-001
   [junit4]   2&amp;gt; 970  INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    ] o.a.s.c.CoreContainer New CoreContainer 62491411
   [junit4]   2&amp;gt; 970  INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    ] o.a.s.c.CoreContainer Loading cores into CoreContainer [instanceDir=/home/ishan/code/lucene-solr-svn/solr/build/solr-solrj/test/J0/temp/solr.client.solrj.embedded.SolrExampleStreamingBinaryTest_EC056F9D893F1A9A-001/tempDir-001]
   [junit4]   2&amp;gt; 971  WARN  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    ] o.a.s.c.CoreContainer Couldn't add files from /home/ishan/code/lucene-solr-svn/solr/build/solr-solrj/test/J0/temp/solr.client.solrj.embedded.SolrExampleStreamingBinaryTest_EC056F9D893F1A9A-001/tempDir-001/lib to classpath: /home/ishan/code/lucene-solr-svn/solr/build/solr-solrj/test/J0/temp/solr.client.solrj.embedded.SolrExampleStreamingBinaryTest_EC056F9D893F1A9A-001/tempDir-001/lib
   [junit4]   2&amp;gt; 997  INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    ] o.a.s.h.c.HttpShardHandlerFactory created with socketTimeout : 600000,connTimeout : 60000,maxConnectionsPerHost : 20,maxConnections : 10000,corePoolSize : 0,maximumPoolSize : 2147483647,maxThreadIdleTime : 5,sizeOfQueue : -1,fairnessPolicy : &lt;span class="code-keyword"&gt;false&lt;/span&gt;,useRetries : &lt;span class="code-keyword"&gt;false&lt;/span&gt;,
   [junit4]   2&amp;gt; 1212 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    ] o.a.s.u.UpdateShardHandler Creating UpdateShardHandler HTTP client with params: socketTimeout=600000&amp;amp;connTimeout=60000&amp;amp;retry=&lt;span class="code-keyword"&gt;true&lt;/span&gt;
   [junit4]   2&amp;gt; 1217 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    ] o.a.s.l.LogWatcher SLF4J impl is org.slf4j.impl.Log4jLoggerFactory
   [junit4]   2&amp;gt; 1219 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    ] o.a.s.l.LogWatcher Registering Log Listener [Log4j (org.slf4j.impl.Log4jLoggerFactory)]
   [junit4]   2&amp;gt; 1223 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    ] o.a.s.c.CoreContainer Security conf doesn't exist. Skipping setup &lt;span class="code-keyword"&gt;for&lt;/span&gt; authorization module.
   [junit4]   2&amp;gt; 1224 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    ] o.a.s.c.CoreContainer No authentication plugin used.
   [junit4]   2&amp;gt; 1337 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    ] o.a.s.c.CorePropertiesLocator Looking &lt;span class="code-keyword"&gt;for&lt;/span&gt; core definitions underneath /home/ishan/code/lucene-solr-svn/solr/build/solr-solrj/test/J0/temp/solr.client.solrj.embedded.SolrExampleStreamingBinaryTest_EC056F9D893F1A9A-001/tempDir-001
   [junit4]   2&amp;gt; 1347 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    ] o.a.s.c.CoreDescriptor Created CoreDescriptor: {name=collection1, config=solrconfig.xml, loadOnStartup=&lt;span class="code-keyword"&gt;true&lt;/span&gt;, schema=schema.xml, configSetProperties=configsetprops.json, &lt;span class="code-keyword"&gt;transient&lt;/span&gt;=&lt;span class="code-keyword"&gt;false&lt;/span&gt;, dataDir=data/}
   [junit4]   2&amp;gt; 1347 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    ] o.a.s.c.CorePropertiesLocator Found core collection1 in /home/ishan/code/lucene-solr-svn/solr/build/solr-solrj/test/J0/temp/solr.client.solrj.embedded.SolrExampleStreamingBinaryTest_EC056F9D893F1A9A-001/tempDir-001/collection1
   [junit4]   2&amp;gt; 1348 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    ] o.a.s.c.CorePropertiesLocator Found 1 core definitions
   [junit4]   2&amp;gt; 1354 INFO  (coreLoadExecutor-6-thread-1) [    ] o.a.s.c.SolrResourceLoader &lt;span class="code-keyword"&gt;new&lt;/span&gt; SolrResourceLoader &lt;span class="code-keyword"&gt;for&lt;/span&gt; directory: '/home/ishan/code/lucene-solr-svn/solr/build/solr-solrj/test/J0/temp/solr.client.solrj.embedded.SolrExampleStreamingBinaryTest_EC056F9D893F1A9A-001/tempDir-001/collection1'
   [junit4]   2&amp;gt; 1354 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    ] o.a.s.s.SolrDispatchFilter user.dir=/home/ishan/code/lucene-solr-svn/solr/build/solr-solrj/test/J0
   [junit4]   2&amp;gt; 1354 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    ] o.a.s.s.SolrDispatchFilter SolrDispatchFilter.init() done
   [junit4]   2&amp;gt; 1354 INFO  (coreLoadExecutor-6-thread-1) [    ] o.a.s.c.SolrResourceLoader JNDI not configured &lt;span class="code-keyword"&gt;for&lt;/span&gt; solr (NoInitialContextEx)
   [junit4]   2&amp;gt; 1355 INFO  (coreLoadExecutor-6-thread-1) [    ] o.a.s.c.SolrResourceLoader using system property solr.solr.home: /home/ishan/code/lucene-solr-svn/solr/build/solr-solrj/test/J0/temp/solr.client.solrj.embedded.SolrExampleStreamingBinaryTest_EC056F9D893F1A9A-001/tempDir-001
   [junit4]   2&amp;gt; 1541 INFO  (coreLoadExecutor-6-thread-1) [    ] o.a.s.c.SolrConfig current version of requestparams : -1
   [junit4]   2&amp;gt; 1548 INFO  (coreLoadExecutor-6-thread-1) [    ] o.a.s.c.SolrConfig Adding specified lib dirs to &lt;span class="code-object"&gt;ClassLoader&lt;/span&gt;
   [junit4]   2&amp;gt; 1551 WARN  (coreLoadExecutor-6-thread-1) [    ] o.a.s.c.SolrConfig Couldn't add files from /home/ishan/code/lucene-solr-svn/solr/build/solr-solrj/test/J0/temp/solr.client.solrj.embedded.SolrExampleStreamingBinaryTest_EC056F9D893F1A9A-001/tempDir-001/collection1/../../../../contrib/extraction/lib filtered by .*\.jar to classpath: /home/ishan/code/lucene-solr-svn/solr/build/solr-solrj/test/J0/temp/solr.client.solrj.embedded.SolrExampleStreamingBinaryTest_EC056F9D893F1A9A-001/tempDir-001/collection1/../../../../contrib/extraction/lib
   [junit4]   2&amp;gt; 1551 WARN  (coreLoadExecutor-6-thread-1) [    ] o.a.s.c.SolrConfig Couldn't add files from /home/ishan/code/lucene-solr-svn/solr/build/solr-solrj/test/J0/temp/solr.client.solrj.embedded.SolrExampleStreamingBinaryTest_EC056F9D893F1A9A-001/tempDir-001/collection1/../../../../dist filtered by solr-cell-\d.*\.jar to classpath: /home/ishan/code/lucene-solr-svn/solr/build/solr-solrj/test/J0/temp/solr.client.solrj.embedded.SolrExampleStreamingBinaryTest_EC056F9D893F1A9A-001/tempDir-001/collection1/../../../../dist
   [junit4]   2&amp;gt; 1551 WARN  (coreLoadExecutor-6-thread-1) [    ] o.a.s.c.SolrConfig Couldn't add files from /home/ishan/code/lucene-solr-svn/solr/build/solr-solrj/test/J0/temp/solr.client.solrj.embedded.SolrExampleStreamingBinaryTest_EC056F9D893F1A9A-001/tempDir-001/collection1/../../../../contrib/clustering/lib filtered by .*\.jar to classpath: /home/ishan/code/lucene-solr-svn/solr/build/solr-solrj/test/J0/temp/solr.client.solrj.embedded.SolrExampleStreamingBinaryTest_EC056F9D893F1A9A-001/tempDir-001/collection1/../../../../contrib/clustering/lib
   [junit4]   2&amp;gt; 1552 WARN  (coreLoadExecutor-6-thread-1) [    ] o.a.s.c.SolrConfig Couldn't add files from /home/ishan/code/lucene-solr-svn/solr/build/solr-solrj/test/J0/temp/solr.client.solrj.embedded.SolrExampleStreamingBinaryTest_EC056F9D893F1A9A-001/tempDir-001/collection1/../../../../dist filtered by solr-clustering-\d.*\.jar to classpath: /home/ishan/code/lucene-solr-svn/solr/build/solr-solrj/test/J0/temp/solr.client.solrj.embedded.SolrExampleStreamingBinaryTest_EC056F9D893F1A9A-001/tempDir-001/collection1/../../../../dist
   [junit4]   2&amp;gt; 1552 WARN  (coreLoadExecutor-6-thread-1) [    ] o.a.s.c.SolrConfig Couldn't add files from /home/ishan/code/lucene-solr-svn/solr/build/solr-solrj/test/J0/temp/solr.client.solrj.embedded.SolrExampleStreamingBinaryTest_EC056F9D893F1A9A-001/tempDir-001/collection1/../../../../contrib/langid/lib filtered by .*\.jar to classpath: /home/ishan/code/lucene-solr-svn/solr/build/solr-solrj/test/J0/temp/solr.client.solrj.embedded.SolrExampleStreamingBinaryTest_EC056F9D893F1A9A-001/tempDir-001/collection1/../../../../contrib/langid/lib
   [junit4]   2&amp;gt; 1552 WARN  (coreLoadExecutor-6-thread-1) [    ] o.a.s.c.SolrConfig Couldn't add files from /home/ishan/code/lucene-solr-svn/solr/build/solr-solrj/test/J0/temp/solr.client.solrj.embedded.SolrExampleStreamingBinaryTest_EC056F9D893F1A9A-001/tempDir-001/collection1/../../../../dist filtered by solr-langid-\d.*\.jar to classpath: /home/ishan/code/lucene-solr-svn/solr/build/solr-solrj/test/J0/temp/solr.client.solrj.embedded.SolrExampleStreamingBinaryTest_EC056F9D893F1A9A-001/tempDir-001/collection1/../../../../dist
   [junit4]   2&amp;gt; 1553 WARN  (coreLoadExecutor-6-thread-1) [    ] o.a.s.c.SolrConfig Couldn't add files from /home/ishan/code/lucene-solr-svn/solr/build/solr-solrj/test/J0/temp/solr.client.solrj.embedded.SolrExampleStreamingBinaryTest_EC056F9D893F1A9A-001/tempDir-001/collection1/../../../../contrib/velocity/lib filtered by .*\.jar to classpath: /home/ishan/code/lucene-solr-svn/solr/build/solr-solrj/test/J0/temp/solr.client.solrj.embedded.SolrExampleStreamingBinaryTest_EC056F9D893F1A9A-001/tempDir-001/collection1/../../../../contrib/velocity/lib
   [junit4]   2&amp;gt; 1553 WARN  (coreLoadExecutor-6-thread-1) [    ] o.a.s.c.SolrConfig Couldn't add files from /home/ishan/code/lucene-solr-svn/solr/build/solr-solrj/test/J0/temp/solr.client.solrj.embedded.SolrExampleStreamingBinaryTest_EC056F9D893F1A9A-001/tempDir-001/collection1/../../../../dist filtered by solr-velocity-\d.*\.jar to classpath: /home/ishan/code/lucene-solr-svn/solr/build/solr-solrj/test/J0/temp/solr.client.solrj.embedded.SolrExampleStreamingBinaryTest_EC056F9D893F1A9A-001/tempDir-001/collection1/../../../../dist
   [junit4]   2&amp;gt; 1622 INFO  (coreLoadExecutor-6-thread-1) [    ] o.a.s.u.SolrIndexConfig IndexWriter infoStream solr logging is enabled
   [junit4]   2&amp;gt; 1641 INFO  (coreLoadExecutor-6-thread-1) [    ] o.a.s.c.SolrConfig Using Lucene MatchVersion: 6.0.0
   [junit4]   2&amp;gt; 1910 INFO  (coreLoadExecutor-6-thread-1) [    ] o.a.s.c.SolrConfig Loaded SolrConfig: solrconfig.xml
   [junit4]   2&amp;gt; 1980 INFO  (coreLoadExecutor-6-thread-1) [    ] o.a.s.s.IndexSchema [collection1] Schema name=example
   [junit4]   2&amp;gt; 3186 INFO  (coreLoadExecutor-6-thread-1) [    ] o.a.s.s.IndexSchema unique key field: id
   [junit4]   2&amp;gt; 3567 INFO  (coreLoadExecutor-6-thread-1) [    ] o.a.s.r.RestManager Registered ManagedResource impl org.apache.solr.&lt;span class="code-keyword"&gt;rest&lt;/span&gt;.schema.analysis.ManagedWordSetResource &lt;span class="code-keyword"&gt;for&lt;/span&gt; path /schema/analysis/stopwords/english
   [junit4]   2&amp;gt; 3569 INFO  (coreLoadExecutor-6-thread-1) [    ] o.a.s.r.RestManager Registered ManagedResource impl org.apache.solr.&lt;span class="code-keyword"&gt;rest&lt;/span&gt;.schema.analysis.ManagedSynonymFilterFactory$SynonymManager &lt;span class="code-keyword"&gt;for&lt;/span&gt; path /schema/analysis/synonyms/english
   [junit4]   2&amp;gt; 3579 INFO  (coreLoadExecutor-6-thread-1) [    ] o.a.s.r.RestManager Added observer of type org.apache.solr.&lt;span class="code-keyword"&gt;rest&lt;/span&gt;.schema.analysis.ManagedStopFilterFactory to existing ManagedResource /schema/analysis/stopwords/english
   [junit4]   2&amp;gt; 3580 INFO  (coreLoadExecutor-6-thread-1) [    ] o.a.s.r.RestManager Added observer of type org.apache.solr.&lt;span class="code-keyword"&gt;rest&lt;/span&gt;.schema.analysis.ManagedSynonymFilterFactory to existing ManagedResource /schema/analysis/synonyms/english
   [junit4]   2&amp;gt; 3610 INFO  (coreLoadExecutor-6-thread-1) [    ] o.a.s.s.FileExchangeRateProvider Reloading exchange rates from file currency.xml
   [junit4]   2&amp;gt; 3619 INFO  (coreLoadExecutor-6-thread-1) [    ] o.a.s.s.FileExchangeRateProvider Reloading exchange rates from file currency.xml
   [junit4]   2&amp;gt; 3678 INFO  (coreLoadExecutor-6-thread-1) [    ] o.a.s.c.ConfigSetProperties Did not find ConfigSet properties, assuming &lt;span class="code-keyword"&gt;default&lt;/span&gt; properties: Can't find resource 'configsetprops.json' in classpath or '/home/ishan/code/lucene-solr-svn/solr/build/solr-solrj/test/J0/temp/solr.client.solrj.embedded.SolrExampleStreamingBinaryTest_EC056F9D893F1A9A-001/tempDir-001/collection1'
   [junit4]   2&amp;gt; 3679 INFO  (coreLoadExecutor-6-thread-1) [    ] o.a.s.c.CoreContainer Creating SolrCore 'collection1' using configuration from instancedir /home/ishan/code/lucene-solr-svn/solr/build/solr-solrj/test/J0/temp/solr.client.solrj.embedded.SolrExampleStreamingBinaryTest_EC056F9D893F1A9A-001/tempDir-001/collection1
   [junit4]   2&amp;gt; 3753 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.c.SolrCore org.apache.solr.core.MockDirectoryFactory
   [junit4]   2&amp;gt; 3765 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.c.SolrCore [[collection1] ] Opening &lt;span class="code-keyword"&gt;new&lt;/span&gt; SolrCore at [/home/ishan/code/lucene-solr-svn/solr/build/solr-solrj/test/J0/temp/solr.client.solrj.embedded.SolrExampleStreamingBinaryTest_EC056F9D893F1A9A-001/tempDir-001/collection1], dataDir=[/home/ishan/code/lucene-solr-svn/solr/build/solr-solrj/test/J0/temp/solr.client.solrj.embedded.SolrExampleStreamingBinaryTest_EC056F9D893F1A9A-001/tempDir-001/collection1/data/]
   [junit4]   2&amp;gt; 3768 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.c.JmxMonitoredMap No JMX servers found, not exposing Solr information with JMX.
   [junit4]   2&amp;gt; 3782 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.c.SolrCore [[collection1] ] Added SolrEventListener &lt;span class="code-keyword"&gt;for&lt;/span&gt; newSearcher: [org.apache.solr.core.QuerySenderListener{queries=[]}]
   [junit4]   2&amp;gt; 3782 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.c.SolrCore [[collection1] ] Added SolrEventListener &lt;span class="code-keyword"&gt;for&lt;/span&gt; firstSearcher: [org.apache.solr.core.QuerySenderListener{queries=[{q=&lt;span class="code-keyword"&gt;static&lt;/span&gt; firstSearcher warming in solrconfig.xml}]}]
   [junit4]   2&amp;gt; 3816 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.c.CachingDirectoryFactory &lt;span class="code-keyword"&gt;return&lt;/span&gt; &lt;span class="code-keyword"&gt;new&lt;/span&gt; directory &lt;span class="code-keyword"&gt;for&lt;/span&gt; /home/ishan/code/lucene-solr-svn/solr/build/solr-solrj/test/J0/temp/solr.client.solrj.embedded.SolrExampleStreamingBinaryTest_EC056F9D893F1A9A-001/tempDir-001/collection1/data
   [junit4]   2&amp;gt; 3816 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.c.SolrCore New index directory detected: old=&lt;span class="code-keyword"&gt;null&lt;/span&gt; &lt;span class="code-keyword"&gt;new&lt;/span&gt;=/home/ishan/code/lucene-solr-svn/solr/build/solr-solrj/test/J0/temp/solr.client.solrj.embedded.SolrExampleStreamingBinaryTest_EC056F9D893F1A9A-001/tempDir-001/collection1/data/index/
   [junit4]   2&amp;gt; 3817 WARN  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.c.SolrCore [collection1] Solr index directory '/home/ishan/code/lucene-solr-svn/solr/build/solr-solrj/test/J0/temp/solr.client.solrj.embedded.SolrExampleStreamingBinaryTest_EC056F9D893F1A9A-001/tempDir-001/collection1/data/index' doesn't exist. Creating &lt;span class="code-keyword"&gt;new&lt;/span&gt; index...
   [junit4]   2&amp;gt; 3834 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.c.CachingDirectoryFactory &lt;span class="code-keyword"&gt;return&lt;/span&gt; &lt;span class="code-keyword"&gt;new&lt;/span&gt; directory &lt;span class="code-keyword"&gt;for&lt;/span&gt; /home/ishan/code/lucene-solr-svn/solr/build/solr-solrj/test/J0/temp/solr.client.solrj.embedded.SolrExampleStreamingBinaryTest_EC056F9D893F1A9A-001/tempDir-001/collection1/data/index
   [junit4]   2&amp;gt; 3884 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [IFD][coreLoadExecutor-6-thread-1]: init: current segments file is &lt;span class="code-quote"&gt;"segments"&lt;/span&gt;; deletionPolicy=org.apache.solr.core.IndexDeletionPolicyWrapper@6f2663c1
   [junit4]   2&amp;gt; 3886 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [IFD][coreLoadExecutor-6-thread-1]: now checkpoint "" [0 segments ; isCommit = &lt;span class="code-keyword"&gt;false&lt;/span&gt;]
   [junit4]   2&amp;gt; 3886 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [IFD][coreLoadExecutor-6-thread-1]: 0 msec to checkpoint
   [junit4]   2&amp;gt; 3886 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][coreLoadExecutor-6-thread-1]: init: create=&lt;span class="code-keyword"&gt;true&lt;/span&gt;
   [junit4]   2&amp;gt; 3887 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][coreLoadExecutor-6-thread-1]: 
   [junit4]   2&amp;gt; dir=MockDirectoryWrapper(RAMDirectory@6cdff2a lockFactory=org.apache.lucene.store.SingleInstanceLockFactory@3a55f217)
   [junit4]   2&amp;gt; index=
   [junit4]   2&amp;gt; version=6.0.0
   [junit4]   2&amp;gt; analyzer=org.apache.solr.update.SolrIndexConfig$DelayedSchemaAnalyzer
   [junit4]   2&amp;gt; ramBufferSizeMB=100.0
   [junit4]   2&amp;gt; maxBufferedDocs=-1
   [junit4]   2&amp;gt; maxBufferedDeleteTerms=-1
   [junit4]   2&amp;gt; mergedSegmentWarmer=&lt;span class="code-keyword"&gt;null&lt;/span&gt;
   [junit4]   2&amp;gt; delPolicy=org.apache.solr.core.IndexDeletionPolicyWrapper
   [junit4]   2&amp;gt; commit=&lt;span class="code-keyword"&gt;null&lt;/span&gt;
   [junit4]   2&amp;gt; openMode=CREATE
   [junit4]   2&amp;gt; similarity=org.apache.solr.search.similarities.SchemaSimilarityFactory$1
   [junit4]   2&amp;gt; mergeScheduler=ConcurrentMergeScheduler: maxThreadCount=-1, maxMergeCount=-1, ioThrottle=&lt;span class="code-keyword"&gt;true&lt;/span&gt;
   [junit4]   2&amp;gt; codec=Lucene60
   [junit4]   2&amp;gt; infoStream=org.apache.solr.update.LoggingInfoStream
   [junit4]   2&amp;gt; mergePolicy=[TieredMergePolicy: maxMergeAtOnce=10, maxMergeAtOnceExplicit=30, maxMergedSegmentMB=5120.0, floorSegmentMB=2.0, forceMergeDeletesPctAllowed=10.0, segmentsPerTier=10.0, maxCFSSegmentSizeMB=8.796093022207999E12, noCFSRatio=0.1
   [junit4]   2&amp;gt; indexerThreadPool=org.apache.lucene.index.DocumentsWriterPerThreadPool@7af6e178
   [junit4]   2&amp;gt; readerPooling=&lt;span class="code-keyword"&gt;false&lt;/span&gt;
   [junit4]   2&amp;gt; perThreadHardLimitMB=1945
   [junit4]   2&amp;gt; useCompoundFile=&lt;span class="code-keyword"&gt;false&lt;/span&gt;
   [junit4]   2&amp;gt; commitOnClose=&lt;span class="code-keyword"&gt;true&lt;/span&gt;
   [junit4]   2&amp;gt; writer=org.apache.solr.update.SolrIndexWriter@ae71d24
   [junit4]   2&amp;gt; 
   [junit4]   2&amp;gt; 3901 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][coreLoadExecutor-6-thread-1]: MMapDirectory.UNMAP_SUPPORTED=&lt;span class="code-keyword"&gt;true&lt;/span&gt;
   [junit4]   2&amp;gt; 3902 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][coreLoadExecutor-6-thread-1]: now flush at close
   [junit4]   2&amp;gt; 3902 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][coreLoadExecutor-6-thread-1]:   start flush: applyAllDeletes=&lt;span class="code-keyword"&gt;true&lt;/span&gt;
   [junit4]   2&amp;gt; 3902 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][coreLoadExecutor-6-thread-1]:   index before flush 
   [junit4]   2&amp;gt; 3902 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [DW][coreLoadExecutor-6-thread-1]: startFullFlush
   [junit4]   2&amp;gt; 3903 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [DW][coreLoadExecutor-6-thread-1]: coreLoadExecutor-6-thread-1 finishFullFlush success=&lt;span class="code-keyword"&gt;true&lt;/span&gt;
   [junit4]   2&amp;gt; 3903 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][coreLoadExecutor-6-thread-1]: apply all deletes during flush
   [junit4]   2&amp;gt; 3903 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][coreLoadExecutor-6-thread-1]: now apply all deletes &lt;span class="code-keyword"&gt;for&lt;/span&gt; all segments maxDoc=0
   [junit4]   2&amp;gt; 3907 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [BD][coreLoadExecutor-6-thread-1]: prune sis=segments:  minGen=9223372036854775807 packetCount=0
   [junit4]   2&amp;gt; 3910 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [MS][coreLoadExecutor-6-thread-1]: initDynamicDefaults spins=&lt;span class="code-keyword"&gt;true&lt;/span&gt; maxThreadCount=1 maxMergeCount=6
   [junit4]   2&amp;gt; 3911 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [MS][coreLoadExecutor-6-thread-1]: updateMergeThreads ioThrottle=&lt;span class="code-keyword"&gt;true&lt;/span&gt; targetMBPerSec=10240.0 MB/sec
   [junit4]   2&amp;gt; 3911 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [MS][coreLoadExecutor-6-thread-1]: now merge
   [junit4]   2&amp;gt; 3911 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [MS][coreLoadExecutor-6-thread-1]:   index: 
   [junit4]   2&amp;gt; 3911 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [MS][coreLoadExecutor-6-thread-1]:   no more merges pending; now &lt;span class="code-keyword"&gt;return&lt;/span&gt;
   [junit4]   2&amp;gt; 3911 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][coreLoadExecutor-6-thread-1]: waitForMerges
   [junit4]   2&amp;gt; 3911 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][coreLoadExecutor-6-thread-1]: waitForMerges done
   [junit4]   2&amp;gt; 3912 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][coreLoadExecutor-6-thread-1]: commit: start
   [junit4]   2&amp;gt; 3912 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][coreLoadExecutor-6-thread-1]: commit: enter lock
   [junit4]   2&amp;gt; 3912 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][coreLoadExecutor-6-thread-1]: commit: now prepare
   [junit4]   2&amp;gt; 3912 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][coreLoadExecutor-6-thread-1]: prepareCommit: flush
   [junit4]   2&amp;gt; 3912 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][coreLoadExecutor-6-thread-1]:   index before flush 
   [junit4]   2&amp;gt; 3912 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [DW][coreLoadExecutor-6-thread-1]: startFullFlush
   [junit4]   2&amp;gt; 3912 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][coreLoadExecutor-6-thread-1]: apply all deletes during flush
   [junit4]   2&amp;gt; 3912 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][coreLoadExecutor-6-thread-1]: now apply all deletes &lt;span class="code-keyword"&gt;for&lt;/span&gt; all segments maxDoc=0
   [junit4]   2&amp;gt; 3912 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [BD][coreLoadExecutor-6-thread-1]: prune sis=segments:  minGen=9223372036854775807 packetCount=0
   [junit4]   2&amp;gt; 3913 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [DW][coreLoadExecutor-6-thread-1]: coreLoadExecutor-6-thread-1 finishFullFlush success=&lt;span class="code-keyword"&gt;true&lt;/span&gt;
   [junit4]   2&amp;gt; 3913 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][coreLoadExecutor-6-thread-1]: startCommit(): start
   [junit4]   2&amp;gt; 3913 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][coreLoadExecutor-6-thread-1]: startCommit index= changeCount=2
   [junit4]   2&amp;gt; 3921 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][coreLoadExecutor-6-thread-1]: startCommit: wrote pending segments file &lt;span class="code-quote"&gt;"pending_segments_1"&lt;/span&gt;
   [junit4]   2&amp;gt; 3921 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][coreLoadExecutor-6-thread-1]: done all syncs: []
   [junit4]   2&amp;gt; 3921 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][coreLoadExecutor-6-thread-1]: commit: pendingCommit != &lt;span class="code-keyword"&gt;null&lt;/span&gt;
   [junit4]   2&amp;gt; 3922 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][coreLoadExecutor-6-thread-1]: commit: done writing segments file &lt;span class="code-quote"&gt;"segments_1"&lt;/span&gt;
   [junit4]   2&amp;gt; 3923 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [IFD][coreLoadExecutor-6-thread-1]: now checkpoint "" [0 segments ; isCommit = &lt;span class="code-keyword"&gt;true&lt;/span&gt;]
   [junit4]   2&amp;gt; 3928 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.c.SolrDeletionPolicy SolrDeletionPolicy.onCommit: commits: num=1
   [junit4]   2&amp;gt; 	commit{dir=MockDirectoryWrapper(RAMDirectory@6cdff2a lockFactory=org.apache.lucene.store.SingleInstanceLockFactory@3a55f217),segFN=segments_1,generation=1}
   [junit4]   2&amp;gt; 3930 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.c.SolrDeletionPolicy newest commit generation = 1
   [junit4]   2&amp;gt; 3930 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [IFD][coreLoadExecutor-6-thread-1]: 7 msec to checkpoint
   [junit4]   2&amp;gt; 3931 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][coreLoadExecutor-6-thread-1]: commit: took 18.6 msec
   [junit4]   2&amp;gt; 3931 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][coreLoadExecutor-6-thread-1]: commit: done
   [junit4]   2&amp;gt; 3931 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][coreLoadExecutor-6-thread-1]: rollback
   [junit4]   2&amp;gt; 3931 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][coreLoadExecutor-6-thread-1]: all running merges have aborted
   [junit4]   2&amp;gt; 3931 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][coreLoadExecutor-6-thread-1]: rollback: done finish merges
   [junit4]   2&amp;gt; 3931 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [DW][coreLoadExecutor-6-thread-1]: abort
   [junit4]   2&amp;gt; 3931 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [DW][coreLoadExecutor-6-thread-1]: done abort success=&lt;span class="code-keyword"&gt;true&lt;/span&gt;
   [junit4]   2&amp;gt; 3931 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][coreLoadExecutor-6-thread-1]: rollback: infos=
   [junit4]   2&amp;gt; 3932 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [IFD][coreLoadExecutor-6-thread-1]: now checkpoint "" [0 segments ; isCommit = &lt;span class="code-keyword"&gt;false&lt;/span&gt;]
   [junit4]   2&amp;gt; 3933 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [IFD][coreLoadExecutor-6-thread-1]: 0 msec to checkpoint
   [junit4]   2&amp;gt; 3935 INFO  (OldIndexDirectoryCleanupThreadForCore-collection1) [    x:collection1] o.a.s.c.SolrCore Looking &lt;span class="code-keyword"&gt;for&lt;/span&gt; old index directories to cleanup &lt;span class="code-keyword"&gt;for&lt;/span&gt; core collection1 in /home/ishan/code/lucene-solr-svn/solr/build/solr-solrj/test/J0/temp/solr.client.solrj.embedded.SolrExampleStreamingBinaryTest_EC056F9D893F1A9A-001/tempDir-001/collection1/data/
   [junit4]   2&amp;gt; 3935 WARN  (OldIndexDirectoryCleanupThreadForCore-collection1) [    x:collection1] o.a.s.c.DirectoryFactory /home/ishan/code/lucene-solr-svn/solr/build/solr-solrj/test/J0/temp/solr.client.solrj.embedded.SolrExampleStreamingBinaryTest_EC056F9D893F1A9A-001/tempDir-001/collection1/data/ does not point to a valid data directory; skipping clean-up of old index directories.
   [junit4]   2&amp;gt; 3942 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.c.PluginBag queryResponseWriter : 'velocity' created with startup=lazy 
   [junit4]   2&amp;gt; 3957 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.r.XSLTResponseWriter xsltCacheLifetimeSeconds=5
   [junit4]   2&amp;gt; 4408 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.c.SolrCore no updateRequestProcessorChain defined as &lt;span class="code-keyword"&gt;default&lt;/span&gt;, creating implicit &lt;span class="code-keyword"&gt;default&lt;/span&gt;
   [junit4]   2&amp;gt; 4510 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.h.l.XMLLoader xsltCacheLifetimeSeconds=60
   [junit4]   2&amp;gt; 4517 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.h.l.XMLLoader xsltCacheLifetimeSeconds=60
   [junit4]   2&amp;gt; 4523 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.h.l.XMLLoader xsltCacheLifetimeSeconds=60
   [junit4]   2&amp;gt; 4524 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.h.l.XMLLoader xsltCacheLifetimeSeconds=60
   [junit4]   2&amp;gt; 4666 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.c.PluginBag requestHandler : '/update/extract' created with startup=lazy 
   [junit4]   2&amp;gt; 4666 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.c.PluginBag requestHandler : '/analysis/field' created with startup=lazy 
   [junit4]   2&amp;gt; 4666 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.c.PluginBag requestHandler : '/analysis/document' created with startup=lazy 
   [junit4]   2&amp;gt; 4671 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.c.PluginBag requestHandler : '/spell' created with startup=lazy 
   [junit4]   2&amp;gt; 4671 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.c.PluginBag requestHandler : '/suggest' created with startup=lazy 
   [junit4]   2&amp;gt; 4671 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.c.PluginBag requestHandler : '/tvrh' created with startup=lazy 
   [junit4]   2&amp;gt; 4671 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.c.PluginBag requestHandler : '/terms' created with startup=lazy 
   [junit4]   2&amp;gt; 4672 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.c.PluginBag requestHandler : '/elevate' created with startup=lazy 
   [junit4]   2&amp;gt; 4672 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.c.RequestHandlers Registered paths: /admin/mbeans,/browse,/update/json/docs,/admin/luke,/export,/get,/admin/properties,/elevate,/update/json,/admin/threads,/query,/analysis/field,/analysis/document,/spell,/update/csv,/sql,/tvrh,/select,/admin/segments,/admin/system,/suggest,/replication,/config,/stream,/schema,/admin/plugins,/admin/logging,/admin/ping,/update,/admin/file,/debug/dump,/terms,/update/extract
   [junit4]   2&amp;gt; 4677 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.c.SolrCore Using &lt;span class="code-keyword"&gt;default&lt;/span&gt; statsCache cache: org.apache.solr.search.stats.LocalStatsCache
   [junit4]   2&amp;gt; 4698 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.UpdateHandler Using UpdateLog implementation: org.apache.solr.update.UpdateLog
   [junit4]   2&amp;gt; 4698 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.UpdateLog Initializing UpdateLog: dataDir= defaultSyncLevel=FLUSH numRecordsToKeep=100 maxNumLogsToKeep=10 numVersionBuckets=65536
   [junit4]   2&amp;gt; 4711 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.CommitTracker Hard AutoCommit: &lt;span class="code-keyword"&gt;if&lt;/span&gt; uncommited &lt;span class="code-keyword"&gt;for&lt;/span&gt; 15000ms; 
   [junit4]   2&amp;gt; 4711 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.CommitTracker Soft AutoCommit: disabled
   [junit4]   2&amp;gt; 4714 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [IFD][coreLoadExecutor-6-thread-1]: init: current segments file is &lt;span class="code-quote"&gt;"segments_1"&lt;/span&gt;; deletionPolicy=org.apache.solr.core.IndexDeletionPolicyWrapper@6f2663c1
   [junit4]   2&amp;gt; 4714 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [IFD][coreLoadExecutor-6-thread-1]: init: load commit &lt;span class="code-quote"&gt;"segments_1"&lt;/span&gt;
   [junit4]   2&amp;gt; 4714 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.c.SolrDeletionPolicy SolrDeletionPolicy.onInit: commits: num=1
   [junit4]   2&amp;gt; 	commit{dir=MockDirectoryWrapper(RAMDirectory@6cdff2a lockFactory=org.apache.lucene.store.SingleInstanceLockFactory@3a55f217),segFN=segments_1,generation=1}
   [junit4]   2&amp;gt; 4714 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.c.SolrDeletionPolicy newest commit generation = 1
   [junit4]   2&amp;gt; 4715 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [IFD][coreLoadExecutor-6-thread-1]: now checkpoint "" [0 segments ; isCommit = &lt;span class="code-keyword"&gt;false&lt;/span&gt;]
   [junit4]   2&amp;gt; 4715 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [IFD][coreLoadExecutor-6-thread-1]: 0 msec to checkpoint
   [junit4]   2&amp;gt; 4715 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][coreLoadExecutor-6-thread-1]: init: create=&lt;span class="code-keyword"&gt;false&lt;/span&gt;
   [junit4]   2&amp;gt; 4715 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][coreLoadExecutor-6-thread-1]: 
   [junit4]   2&amp;gt; dir=MockDirectoryWrapper(RAMDirectory@6cdff2a lockFactory=org.apache.lucene.store.SingleInstanceLockFactory@3a55f217)
   [junit4]   2&amp;gt; index=
   [junit4]   2&amp;gt; version=6.0.0
   [junit4]   2&amp;gt; analyzer=org.apache.solr.update.SolrIndexConfig$DelayedSchemaAnalyzer
   [junit4]   2&amp;gt; ramBufferSizeMB=100.0
   [junit4]   2&amp;gt; maxBufferedDocs=-1
   [junit4]   2&amp;gt; maxBufferedDeleteTerms=-1
   [junit4]   2&amp;gt; mergedSegmentWarmer=&lt;span class="code-keyword"&gt;null&lt;/span&gt;
   [junit4]   2&amp;gt; delPolicy=org.apache.solr.core.IndexDeletionPolicyWrapper
   [junit4]   2&amp;gt; commit=&lt;span class="code-keyword"&gt;null&lt;/span&gt;
   [junit4]   2&amp;gt; openMode=APPEND
   [junit4]   2&amp;gt; similarity=org.apache.solr.search.similarities.SchemaSimilarityFactory$1
   [junit4]   2&amp;gt; mergeScheduler=ConcurrentMergeScheduler: maxThreadCount=-1, maxMergeCount=-1, ioThrottle=&lt;span class="code-keyword"&gt;true&lt;/span&gt;
   [junit4]   2&amp;gt; codec=Lucene60
   [junit4]   2&amp;gt; infoStream=org.apache.solr.update.LoggingInfoStream
   [junit4]   2&amp;gt; mergePolicy=[TieredMergePolicy: maxMergeAtOnce=10, maxMergeAtOnceExplicit=30, maxMergedSegmentMB=5120.0, floorSegmentMB=2.0, forceMergeDeletesPctAllowed=10.0, segmentsPerTier=10.0, maxCFSSegmentSizeMB=8.796093022207999E12, noCFSRatio=0.1
   [junit4]   2&amp;gt; indexerThreadPool=org.apache.lucene.index.DocumentsWriterPerThreadPool@72e55de6
   [junit4]   2&amp;gt; readerPooling=&lt;span class="code-keyword"&gt;false&lt;/span&gt;
   [junit4]   2&amp;gt; perThreadHardLimitMB=1945
   [junit4]   2&amp;gt; useCompoundFile=&lt;span class="code-keyword"&gt;false&lt;/span&gt;
   [junit4]   2&amp;gt; commitOnClose=&lt;span class="code-keyword"&gt;true&lt;/span&gt;
   [junit4]   2&amp;gt; writer=org.apache.solr.update.SolrIndexWriter@4bc2b3b8
   [junit4]   2&amp;gt; 
   [junit4]   2&amp;gt; 4715 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][coreLoadExecutor-6-thread-1]: MMapDirectory.UNMAP_SUPPORTED=&lt;span class="code-keyword"&gt;true&lt;/span&gt;
   [junit4]   2&amp;gt; 4719 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][coreLoadExecutor-6-thread-1]: flush at getReader
   [junit4]   2&amp;gt; 4719 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [DW][coreLoadExecutor-6-thread-1]: startFullFlush
   [junit4]   2&amp;gt; 4720 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][coreLoadExecutor-6-thread-1]: apply all deletes during flush
   [junit4]   2&amp;gt; 4720 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][coreLoadExecutor-6-thread-1]: now apply all deletes &lt;span class="code-keyword"&gt;for&lt;/span&gt; all segments maxDoc=0
   [junit4]   2&amp;gt; 4720 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [BD][coreLoadExecutor-6-thread-1]: prune sis=segments_1:  minGen=9223372036854775807 packetCount=0
   [junit4]   2&amp;gt; 4724 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][coreLoadExecutor-6-thread-1]: incRefDeleter &lt;span class="code-keyword"&gt;for&lt;/span&gt; NRT reader version=2 segments=
   [junit4]   2&amp;gt; 4724 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][coreLoadExecutor-6-thread-1]: &lt;span class="code-keyword"&gt;return&lt;/span&gt; reader version=2 reader=StandardDirectoryReader(segments_1:2:nrt)
   [junit4]   2&amp;gt; 4724 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [DW][coreLoadExecutor-6-thread-1]: coreLoadExecutor-6-thread-1 finishFullFlush success=&lt;span class="code-keyword"&gt;true&lt;/span&gt;
   [junit4]   2&amp;gt; 4724 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][coreLoadExecutor-6-thread-1]: getReader took 5 msec
   [junit4]   2&amp;gt; 4754 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.s.SolrIndexSearcher Opening Searcher@68f8abc5[collection1] main
   [junit4]   2&amp;gt; 4767 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.r.ManagedResourceStorage File-based storage initialized to use dir: /home/ishan/code/lucene-solr-svn/solr/build/solr-solrj/test/J0/temp/solr.client.solrj.embedded.SolrExampleStreamingBinaryTest_EC056F9D893F1A9A-001/tempDir-001/collection1/conf
   [junit4]   2&amp;gt; 4768 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.r.RestManager Initializing RestManager with initArgs: {storageDir=/home/ishan/code/lucene-solr-svn/solr/build/solr-solrj/test/J0/temp/solr.client.solrj.embedded.SolrExampleStreamingBinaryTest_EC056F9D893F1A9A-001/tempDir-001/collection1/conf}
   [junit4]   2&amp;gt; 4770 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.r.ManagedResourceStorage Reading _rest_managed.json using file:dir=/home/ishan/code/lucene-solr-svn/solr/build/solr-solrj/test/J0/temp/solr.client.solrj.embedded.SolrExampleStreamingBinaryTest_EC056F9D893F1A9A-001/tempDir-001/collection1/conf
   [junit4]   2&amp;gt; 4774 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.r.ManagedResourceStorage Loaded LinkedHashMap at path _rest_managed.json using file:dir=/home/ishan/code/lucene-solr-svn/solr/build/solr-solrj/test/J0/temp/solr.client.solrj.embedded.SolrExampleStreamingBinaryTest_EC056F9D893F1A9A-001/tempDir-001/collection1/conf
   [junit4]   2&amp;gt; 4775 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.r.ManagedResource Loaded initArgs {} &lt;span class="code-keyword"&gt;for&lt;/span&gt; /&lt;span class="code-keyword"&gt;rest&lt;/span&gt;/managed
   [junit4]   2&amp;gt; 4775 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.r.RestManager Initializing 2 registered ManagedResources
   [junit4]   2&amp;gt; 4775 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.r.ManagedResourceStorage Reading _schema_analysis_stopwords_english.json using file:dir=/home/ishan/code/lucene-solr-svn/solr/build/solr-solrj/test/J0/temp/solr.client.solrj.embedded.SolrExampleStreamingBinaryTest_EC056F9D893F1A9A-001/tempDir-001/collection1/conf
   [junit4]   2&amp;gt; 4777 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.r.ManagedResourceStorage Loaded LinkedHashMap at path _schema_analysis_stopwords_english.json using file:dir=/home/ishan/code/lucene-solr-svn/solr/build/solr-solrj/test/J0/temp/solr.client.solrj.embedded.SolrExampleStreamingBinaryTest_EC056F9D893F1A9A-001/tempDir-001/collection1/conf
   [junit4]   2&amp;gt; 4777 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.r.ManagedResource Loaded initArgs {ignoreCase=&lt;span class="code-keyword"&gt;true&lt;/span&gt;} &lt;span class="code-keyword"&gt;for&lt;/span&gt; /schema/analysis/stopwords/english
   [junit4]   2&amp;gt; 4777 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.r.s.a.ManagedWordSetResource Loaded 35 words &lt;span class="code-keyword"&gt;for&lt;/span&gt; /schema/analysis/stopwords/english
   [junit4]   2&amp;gt; 4778 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.r.ManagedResource Notified 2 observers of /schema/analysis/stopwords/english
   [junit4]   2&amp;gt; 4778 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.r.ManagedResourceStorage Reading _schema_analysis_synonyms_english.json using file:dir=/home/ishan/code/lucene-solr-svn/solr/build/solr-solrj/test/J0/temp/solr.client.solrj.embedded.SolrExampleStreamingBinaryTest_EC056F9D893F1A9A-001/tempDir-001/collection1/conf
   [junit4]   2&amp;gt; 4779 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.r.ManagedResourceStorage Loaded LinkedHashMap at path _schema_analysis_synonyms_english.json using file:dir=/home/ishan/code/lucene-solr-svn/solr/build/solr-solrj/test/J0/temp/solr.client.solrj.embedded.SolrExampleStreamingBinaryTest_EC056F9D893F1A9A-001/tempDir-001/collection1/conf
   [junit4]   2&amp;gt; 4779 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.r.ManagedResource Loaded initArgs {ignoreCase=&lt;span class="code-keyword"&gt;true&lt;/span&gt;,format=solr} &lt;span class="code-keyword"&gt;for&lt;/span&gt; /schema/analysis/synonyms/english
   [junit4]   2&amp;gt; 4780 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.r.s.a.ManagedSynonymFilterFactory Loaded 3 synonym mappings &lt;span class="code-keyword"&gt;for&lt;/span&gt; /schema/analysis/synonyms/english
   [junit4]   2&amp;gt; 4786 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.r.ManagedResource Notified 2 observers of /schema/analysis/synonyms/english
   [junit4]   2&amp;gt; 4806 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.h.c.SpellCheckComponent Initializing spell checkers
   [junit4]   2&amp;gt; 4818 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.s.DirectSolrSpellChecker init: {name=&lt;span class="code-keyword"&gt;default&lt;/span&gt;,field=text,classname=solr.DirectSolrSpellChecker,distanceMeasure=internal,accuracy=0.5,maxEdits=2,minPrefix=1,maxInspections=5,minQueryLength=4,maxQueryFrequency=0.01}
   [junit4]   2&amp;gt; 4838 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.h.c.SpellCheckComponent No queryConverter defined, using &lt;span class="code-keyword"&gt;default&lt;/span&gt; converter
   [junit4]   2&amp;gt; 4840 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.h.c.SuggestComponent Initializing SuggestComponent
   [junit4]   2&amp;gt; 4846 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.s.s.SolrSuggester init: {name=mySuggester,lookupImpl=FuzzyLookupFactory,dictionaryImpl=DocumentDictionaryFactory,field=cat,weightField=price,suggestAnalyzerFieldType=string,buildOnStartup=&lt;span class="code-keyword"&gt;false&lt;/span&gt;}
   [junit4]   2&amp;gt; 4915 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.s.s.SolrSuggester Dictionary loaded with params: {name=mySuggester,lookupImpl=FuzzyLookupFactory,dictionaryImpl=DocumentDictionaryFactory,field=cat,weightField=price,suggestAnalyzerFieldType=string,buildOnStartup=&lt;span class="code-keyword"&gt;false&lt;/span&gt;}
   [junit4]   2&amp;gt; 4919 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.h.c.QueryElevationComponent Loading QueryElevation from: /home/ishan/code/lucene-solr-svn/solr/build/solr-solrj/test/J0/temp/solr.client.solrj.embedded.SolrExampleStreamingBinaryTest_EC056F9D893F1A9A-001/tempDir-001/collection1/conf/elevate.xml
   [junit4]   2&amp;gt; 5012 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.h.ReplicationHandler Commits will be reserved &lt;span class="code-keyword"&gt;for&lt;/span&gt;  10000
   [junit4]   2&amp;gt; 5045 INFO  (searcherExecutor-7-thread-1-processing-x:collection1) [    x:collection1] o.a.s.c.QuerySenderListener QuerySenderListener sending requests to Searcher@68f8abc5[collection1] main{ExitableDirectoryReader(UninvertingDirectoryReader())}
   [junit4]   2&amp;gt; 5057 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.UpdateLog Looking up max value of version field to seed version buckets
   [junit4]   2&amp;gt; 5058 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.VersionInfo Refreshing highest value of _version_ &lt;span class="code-keyword"&gt;for&lt;/span&gt; 65536 version buckets from index
   [junit4]   2&amp;gt; 5058 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.VersionInfo No terms found &lt;span class="code-keyword"&gt;for&lt;/span&gt; _version_, cannot seed version bucket highest value from index
   [junit4]   2&amp;gt; 5058 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.UpdateLog Could not find max version in index or recent updates, using &lt;span class="code-keyword"&gt;new&lt;/span&gt; clock 1521188368712466432
   [junit4]   2&amp;gt; 5076 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.u.UpdateLog Took 17.0ms to seed version buckets with highest version 1521188368712466432
   [junit4]   2&amp;gt; 5084 INFO  (coreLoadExecutor-6-thread-1) [    x:collection1] o.a.s.c.CoreContainer registering core: collection1
   [junit4]   2&amp;gt; 5209 INFO  (searcherExecutor-7-thread-1-processing-x:collection1) [    x:collection1] o.a.s.c.S.Request [collection1]  webapp=&lt;span class="code-keyword"&gt;null&lt;/span&gt; path=&lt;span class="code-keyword"&gt;null&lt;/span&gt; params={q=&lt;span class="code-keyword"&gt;static&lt;/span&gt;+firstSearcher+warming+in+solrconfig.xml&amp;amp;distrib=&lt;span class="code-keyword"&gt;false&lt;/span&gt;&amp;amp;event=firstSearcher} hits=0 status=0 QTime=158
   [junit4]   2&amp;gt; 5210 INFO  (searcherExecutor-7-thread-1-processing-x:collection1) [    x:collection1] o.a.s.c.QuerySenderListener QuerySenderListener done.
   [junit4]   2&amp;gt; 5210 INFO  (searcherExecutor-7-thread-1-processing-x:collection1) [    x:collection1] o.a.s.h.c.SpellCheckComponent Loading spell index &lt;span class="code-keyword"&gt;for&lt;/span&gt; spellchecker: &lt;span class="code-keyword"&gt;default&lt;/span&gt;
   [junit4]   2&amp;gt; 5211 INFO  (searcherExecutor-7-thread-1-processing-x:collection1) [    x:collection1] o.a.s.h.c.SpellCheckComponent Loading spell index &lt;span class="code-keyword"&gt;for&lt;/span&gt; spellchecker: wordbreak
   [junit4]   2&amp;gt; 5212 INFO  (searcherExecutor-7-thread-1-processing-x:collection1) [    x:collection1] o.a.s.c.SolrCore [collection1] Registered &lt;span class="code-keyword"&gt;new&lt;/span&gt; searcher Searcher@68f8abc5[collection1] main{ExitableDirectoryReader(UninvertingDirectoryReader())}
   [junit4]   2&amp;gt; 5355 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    ] o.a.s.SolrJettyTestBase Jetty Assigned Port#33129
   [junit4]   2&amp;gt; 5370 INFO  (TEST-SolrExampleStreamingBinaryTest.testUpdateField-seed#[EC056F9D893F1A9A]) [    ] o.a.s.SolrTestCaseJ4 ###Starting testUpdateField
   [junit4]   2&amp;gt; 5749 INFO  (qtp1842250958-20) [    x:collection1] o.a.s.u.LoggingInfoStream [DW][qtp1842250958-20]: anyChanges? numDocsInRam=0 deletes=&lt;span class="code-keyword"&gt;true&lt;/span&gt; hasTickets:&lt;span class="code-keyword"&gt;false&lt;/span&gt; pendingChangesInFullFlush: &lt;span class="code-keyword"&gt;false&lt;/span&gt;
   [junit4]   2&amp;gt; 5750 INFO  (qtp1842250958-20) [    x:collection1] o.a.s.u.LoggingInfoStream [DW][qtp1842250958-20]: anyChanges? numDocsInRam=0 deletes=&lt;span class="code-keyword"&gt;true&lt;/span&gt; hasTickets:&lt;span class="code-keyword"&gt;false&lt;/span&gt; pendingChangesInFullFlush: &lt;span class="code-keyword"&gt;false&lt;/span&gt;
   [junit4]   2&amp;gt; 5750 INFO  (qtp1842250958-20) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][qtp1842250958-20]: nrtIsCurrent: infoVersion matches: &lt;span class="code-keyword"&gt;true&lt;/span&gt;; DW changes: &lt;span class="code-keyword"&gt;true&lt;/span&gt;; BD changes: &lt;span class="code-keyword"&gt;false&lt;/span&gt;
   [junit4]   2&amp;gt; 5750 INFO  (qtp1842250958-20) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][qtp1842250958-20]: flush at getReader
   [junit4]   2&amp;gt; 5750 INFO  (qtp1842250958-20) [    x:collection1] o.a.s.u.LoggingInfoStream [DW][qtp1842250958-20]: startFullFlush
   [junit4]   2&amp;gt; 5750 INFO  (qtp1842250958-20) [    x:collection1] o.a.s.u.LoggingInfoStream [DW][qtp1842250958-20]: anyChanges? numDocsInRam=0 deletes=&lt;span class="code-keyword"&gt;true&lt;/span&gt; hasTickets:&lt;span class="code-keyword"&gt;false&lt;/span&gt; pendingChangesInFullFlush: &lt;span class="code-keyword"&gt;false&lt;/span&gt;
   [junit4]   2&amp;gt; 5751 INFO  (qtp1842250958-20) [    x:collection1] o.a.s.u.LoggingInfoStream [DW][qtp1842250958-20]: qtp1842250958-20: flush naked frozen global deletes
   [junit4]   2&amp;gt; 5761 INFO  (qtp1842250958-20) [    x:collection1] o.a.s.u.LoggingInfoStream [BD][qtp1842250958-20]: push deletes  1 deleted queries bytesUsed=80 segmentPrivate?=&lt;span class="code-keyword"&gt;false&lt;/span&gt; delGen=2 packetCount=1 totBytesUsed=80
   [junit4]   2&amp;gt; 5762 INFO  (qtp1842250958-20) [    x:collection1] o.a.s.u.LoggingInfoStream [DW][qtp1842250958-20]: flush: push buffered updates:  1 deleted queries bytesUsed=80
   [junit4]   2&amp;gt; 5762 INFO  (qtp1842250958-20) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][qtp1842250958-20]: apply all deletes during flush
   [junit4]   2&amp;gt; 5762 INFO  (qtp1842250958-20) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][qtp1842250958-20]: now apply all deletes &lt;span class="code-keyword"&gt;for&lt;/span&gt; all segments maxDoc=0
   [junit4]   2&amp;gt; 5762 INFO  (qtp1842250958-20) [    x:collection1] o.a.s.u.LoggingInfoStream [BD][qtp1842250958-20]: prune sis=segments_1:  minGen=9223372036854775807 packetCount=1
   [junit4]   2&amp;gt; 5762 INFO  (qtp1842250958-20) [    x:collection1] o.a.s.u.LoggingInfoStream [BD][qtp1842250958-20]: pruneDeletes: prune 1 packets; 0 packets remain
   [junit4]   2&amp;gt; 5762 INFO  (qtp1842250958-20) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][qtp1842250958-20]: incRefDeleter &lt;span class="code-keyword"&gt;for&lt;/span&gt; NRT reader version=2 segments=
   [junit4]   2&amp;gt; 5762 INFO  (qtp1842250958-20) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][qtp1842250958-20]: &lt;span class="code-keyword"&gt;return&lt;/span&gt; reader version=2 reader=StandardDirectoryReader(segments_1:2:nrt)
   [junit4]   2&amp;gt; 5762 INFO  (qtp1842250958-20) [    x:collection1] o.a.s.u.LoggingInfoStream [DW][qtp1842250958-20]: qtp1842250958-20 finishFullFlush success=&lt;span class="code-keyword"&gt;true&lt;/span&gt;
   [junit4]   2&amp;gt; 5763 INFO  (qtp1842250958-20) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][qtp1842250958-20]: getReader took 13 msec
   [junit4]   2&amp;gt; 5763 INFO  (qtp1842250958-20) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][qtp1842250958-20]: decRefDeleter &lt;span class="code-keyword"&gt;for&lt;/span&gt; NRT reader version=2 segments=
   [junit4]   2&amp;gt; 5781 INFO  (qtp1842250958-20) [    x:collection1] o.a.s.u.p.LogUpdateProcessorFactory [collection1]  webapp=/solr path=/update params={wt=javabin&amp;amp;version=2}{deleteByQuery=*:* (-1521188369410818048)} 0 86
   [junit4]   2&amp;gt; 5867 INFO  (qtp1842250958-19) [    x:collection1] o.a.s.u.DirectUpdateHandler2 start commit{,optimize=&lt;span class="code-keyword"&gt;false&lt;/span&gt;,openSearcher=&lt;span class="code-keyword"&gt;true&lt;/span&gt;,waitSearcher=&lt;span class="code-keyword"&gt;true&lt;/span&gt;,expungeDeletes=&lt;span class="code-keyword"&gt;false&lt;/span&gt;,softCommit=&lt;span class="code-keyword"&gt;false&lt;/span&gt;,prepareCommit=&lt;span class="code-keyword"&gt;false&lt;/span&gt;}
   [junit4]   2&amp;gt; 5868 INFO  (qtp1842250958-19) [    x:collection1] o.a.s.u.DirectUpdateHandler2 No uncommitted changes. Skipping IW.commit.
   [junit4]   2&amp;gt; 5870 INFO  (qtp1842250958-19) [    x:collection1] o.a.s.c.SolrCore SolrIndexSearcher has not changed - not re-opening: org.apache.solr.search.SolrIndexSearcher
   [junit4]   2&amp;gt; 5875 INFO  (qtp1842250958-19) [    x:collection1] o.a.s.u.DirectUpdateHandler2 end_commit_flush
   [junit4]   2&amp;gt; 5876 INFO  (qtp1842250958-19) [    x:collection1] o.a.s.u.p.LogUpdateProcessorFactory [collection1]  webapp=/solr path=/update params={waitSearcher=&lt;span class="code-keyword"&gt;true&lt;/span&gt;&amp;amp;commit=&lt;span class="code-keyword"&gt;true&lt;/span&gt;&amp;amp;softCommit=&lt;span class="code-keyword"&gt;false&lt;/span&gt;&amp;amp;wt=javabin&amp;amp;version=2}{commit=} 0 10
   [junit4]   2&amp;gt; 6160 INFO  (qtp1842250958-18) [    x:collection1] o.a.s.u.p.LogUpdateProcessorFactory [collection1]  webapp=/solr path=/update params={wt=javabin&amp;amp;version=2}{add=[unique (1521188369615290368)]} 0 250
   [junit4]   2&amp;gt; 6164 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.DirectUpdateHandler2 start commit{,optimize=&lt;span class="code-keyword"&gt;false&lt;/span&gt;,openSearcher=&lt;span class="code-keyword"&gt;true&lt;/span&gt;,waitSearcher=&lt;span class="code-keyword"&gt;true&lt;/span&gt;,expungeDeletes=&lt;span class="code-keyword"&gt;false&lt;/span&gt;,softCommit=&lt;span class="code-keyword"&gt;false&lt;/span&gt;,prepareCommit=&lt;span class="code-keyword"&gt;false&lt;/span&gt;}
   [junit4]   2&amp;gt; 6165 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][qtp1842250958-21]: commit: start
   [junit4]   2&amp;gt; 6165 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][qtp1842250958-21]: commit: enter lock
   [junit4]   2&amp;gt; 6165 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][qtp1842250958-21]: commit: now prepare
   [junit4]   2&amp;gt; 6165 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][qtp1842250958-21]: prepareCommit: flush
   [junit4]   2&amp;gt; 6165 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][qtp1842250958-21]:   index before flush 
   [junit4]   2&amp;gt; 6165 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.LoggingInfoStream [DW][qtp1842250958-21]: startFullFlush
   [junit4]   2&amp;gt; 6166 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.LoggingInfoStream [DW][qtp1842250958-21]: anyChanges? numDocsInRam=1 deletes=&lt;span class="code-keyword"&gt;true&lt;/span&gt; hasTickets:&lt;span class="code-keyword"&gt;false&lt;/span&gt; pendingChangesInFullFlush: &lt;span class="code-keyword"&gt;false&lt;/span&gt;
   [junit4]   2&amp;gt; 6166 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.LoggingInfoStream [DWFC][qtp1842250958-21]: addFlushableState DocumentsWriterPerThread [pendingDeletes=gen=0, segment=_0, aborted=&lt;span class="code-keyword"&gt;false&lt;/span&gt;, numDocsInRAM=1, deleteQueue=DWDQ: [ generation: 2 ]]
   [junit4]   2&amp;gt; 6170 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.LoggingInfoStream [DWPT][qtp1842250958-21]: flush postings as segment _0 numDocs=1
   [junit4]   2&amp;gt; 6209 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.LoggingInfoStream [DWPT][qtp1842250958-21]: &lt;span class="code-keyword"&gt;new&lt;/span&gt; segment has 0 deleted docs
   [junit4]   2&amp;gt; 6209 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.LoggingInfoStream [DWPT][qtp1842250958-21]: &lt;span class="code-keyword"&gt;new&lt;/span&gt; segment has no vectors; norms; no docValues; prox; freqs
   [junit4]   2&amp;gt; 6209 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.LoggingInfoStream [DWPT][qtp1842250958-21]: flushedFiles=[_0_Lucene50_0.doc, _0_Lucene50_0.tim, _0_Lucene50_0.pos, _0.nvd, _0.fdx, _0_Lucene50_0.tip, _0.fdt, _0.nvm, _0.fnm]
   [junit4]   2&amp;gt; 6209 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.LoggingInfoStream [DWPT][qtp1842250958-21]: flushed codec=Lucene60
   [junit4]   2&amp;gt; 6212 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.LoggingInfoStream [DWPT][qtp1842250958-21]: flushed: segment=_0 ramUsed=0.103 MB newFlushedSize=0.002 MB docs/MB=660.312
   [junit4]   2&amp;gt; 6214 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.LoggingInfoStream [DWPT][qtp1842250958-21]: flush time 43.661953 msec
   [junit4]   2&amp;gt; 6217 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.LoggingInfoStream [DW][qtp1842250958-21]: publishFlushedSegment seg-&lt;span class="code-keyword"&gt;private&lt;/span&gt; updates=&lt;span class="code-keyword"&gt;null&lt;/span&gt;
   [junit4]   2&amp;gt; 6217 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][qtp1842250958-21]: publishFlushedSegment
   [junit4]   2&amp;gt; 6219 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.LoggingInfoStream [BD][qtp1842250958-21]: push deletes  1 deleted terms (unique count=1) bytesUsed=1072 segmentPrivate?=&lt;span class="code-keyword"&gt;false&lt;/span&gt; delGen=4 packetCount=1 totBytesUsed=1072
   [junit4]   2&amp;gt; 6219 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][qtp1842250958-21]: publish sets newSegment delGen=5 seg=_0(6.0.0):C1
   [junit4]   2&amp;gt; 6220 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.LoggingInfoStream [IFD][qtp1842250958-21]: now checkpoint &lt;span class="code-quote"&gt;"_0(6.0.0):C1"&lt;/span&gt; [1 segments ; isCommit = &lt;span class="code-keyword"&gt;false&lt;/span&gt;]
   [junit4]   2&amp;gt; 6220 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.LoggingInfoStream [IFD][qtp1842250958-21]: 0 msec to checkpoint
   [junit4]   2&amp;gt; 6220 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][qtp1842250958-21]: apply all deletes during flush
   [junit4]   2&amp;gt; 6220 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][qtp1842250958-21]: now apply all deletes &lt;span class="code-keyword"&gt;for&lt;/span&gt; all segments maxDoc=1
   [junit4]   2&amp;gt; 6220 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.LoggingInfoStream [BD][qtp1842250958-21]: applyDeletes: open segment readers took 0 msec
   [junit4]   2&amp;gt; 6220 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.LoggingInfoStream [BD][qtp1842250958-21]: applyDeletes: infos=[_0(6.0.0):C1] packetCount=1
   [junit4]   2&amp;gt; 6221 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.LoggingInfoStream [BD][qtp1842250958-21]: applyDeletes took 0 msec &lt;span class="code-keyword"&gt;for&lt;/span&gt; 1 segments, 0 newly deleted docs (query deletes), 0 visited terms, allDeleted=&lt;span class="code-keyword"&gt;null&lt;/span&gt;
   [junit4]   2&amp;gt; 6221 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.LoggingInfoStream [BD][qtp1842250958-21]: prune sis=segments_1: _0(6.0.0):C1 minGen=5 packetCount=1
   [junit4]   2&amp;gt; 6221 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.LoggingInfoStream [BD][qtp1842250958-21]: pruneDeletes: prune 1 packets; 0 packets remain
   [junit4]   2&amp;gt; 6221 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.LoggingInfoStream [DW][qtp1842250958-21]: qtp1842250958-21 finishFullFlush success=&lt;span class="code-keyword"&gt;true&lt;/span&gt;
   [junit4]   2&amp;gt; 6221 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.LoggingInfoStream [TMP][qtp1842250958-21]: findMerges: 1 segments
   [junit4]   2&amp;gt; 6223 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.LoggingInfoStream [TMP][qtp1842250958-21]:   seg=_0(6.0.0):C1 size=0.002 MB [floored]
   [junit4]   2&amp;gt; 6223 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.LoggingInfoStream [TMP][qtp1842250958-21]:   allowedSegmentCount=1 vs count=1 (eligible count=1) tooBigCount=0
   [junit4]   2&amp;gt; 6223 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.LoggingInfoStream [MS][qtp1842250958-21]: initDynamicDefaults spins=&lt;span class="code-keyword"&gt;true&lt;/span&gt; maxThreadCount=1 maxMergeCount=6
   [junit4]   2&amp;gt; 6223 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.LoggingInfoStream [MS][qtp1842250958-21]: now merge
   [junit4]   2&amp;gt; 6223 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.LoggingInfoStream [MS][qtp1842250958-21]:   index: _0(6.0.0):C1
   [junit4]   2&amp;gt; 6223 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.LoggingInfoStream [MS][qtp1842250958-21]:   no more merges pending; now &lt;span class="code-keyword"&gt;return&lt;/span&gt;
   [junit4]   2&amp;gt; 6223 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][qtp1842250958-21]: startCommit(): start
   [junit4]   2&amp;gt; 6223 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][qtp1842250958-21]: startCommit index=_0(6.0.0):C1 changeCount=4
   [junit4]   2&amp;gt; 6224 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][qtp1842250958-21]: startCommit: wrote pending segments file &lt;span class="code-quote"&gt;"pending_segments_2"&lt;/span&gt;
   [junit4]   2&amp;gt; 6225 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][qtp1842250958-21]: done all syncs: [_0.si, _0_Lucene50_0.doc, _0_Lucene50_0.tim, _0_Lucene50_0.pos, _0.nvd, _0.fdx, _0_Lucene50_0.tip, _0.fdt, _0.nvm, _0.fnm]
   [junit4]   2&amp;gt; 6225 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][qtp1842250958-21]: commit: pendingCommit != &lt;span class="code-keyword"&gt;null&lt;/span&gt;
   [junit4]   2&amp;gt; 6225 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][qtp1842250958-21]: commit: done writing segments file &lt;span class="code-quote"&gt;"segments_2"&lt;/span&gt;
   [junit4]   2&amp;gt; 6225 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.LoggingInfoStream [IFD][qtp1842250958-21]: now checkpoint &lt;span class="code-quote"&gt;"_0(6.0.0):C1"&lt;/span&gt; [1 segments ; isCommit = &lt;span class="code-keyword"&gt;true&lt;/span&gt;]
   [junit4]   2&amp;gt; 6225 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.c.SolrDeletionPolicy SolrDeletionPolicy.onCommit: commits: num=2
   [junit4]   2&amp;gt; 	commit{dir=MockDirectoryWrapper(RAMDirectory@6cdff2a lockFactory=org.apache.lucene.store.SingleInstanceLockFactory@3a55f217),segFN=segments_1,generation=1}
   [junit4]   2&amp;gt; 	commit{dir=MockDirectoryWrapper(RAMDirectory@6cdff2a lockFactory=org.apache.lucene.store.SingleInstanceLockFactory@3a55f217),segFN=segments_2,generation=2}
   [junit4]   2&amp;gt; 6225 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.c.SolrDeletionPolicy newest commit generation = 2
   [junit4]   2&amp;gt; 6226 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.LoggingInfoStream [IFD][qtp1842250958-21]: deleteCommits: now decRef commit &lt;span class="code-quote"&gt;"segments_1"&lt;/span&gt;
   [junit4]   2&amp;gt; 6226 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.LoggingInfoStream [IFD][qtp1842250958-21]: delete &lt;span class="code-quote"&gt;"segments_1"&lt;/span&gt;
   [junit4]   2&amp;gt; 6226 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.LoggingInfoStream [IFD][qtp1842250958-21]: 1 msec to checkpoint
   [junit4]   2&amp;gt; 6226 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][qtp1842250958-21]: commit: took 60.7 msec
   [junit4]   2&amp;gt; 6226 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][qtp1842250958-21]: commit: done
   [junit4]   2&amp;gt; 6226 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][qtp1842250958-21]: nrtIsCurrent: infoVersion matches: &lt;span class="code-keyword"&gt;false&lt;/span&gt;; DW changes: &lt;span class="code-keyword"&gt;false&lt;/span&gt;; BD changes: &lt;span class="code-keyword"&gt;false&lt;/span&gt;
   [junit4]   2&amp;gt; 6226 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][qtp1842250958-21]: flush at getReader
   [junit4]   2&amp;gt; 6227 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.LoggingInfoStream [DW][qtp1842250958-21]: startFullFlush
   [junit4]   2&amp;gt; 6227 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][qtp1842250958-21]: apply all deletes during flush
   [junit4]   2&amp;gt; 6227 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][qtp1842250958-21]: now apply all deletes &lt;span class="code-keyword"&gt;for&lt;/span&gt; all segments maxDoc=1
   [junit4]   2&amp;gt; 6227 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.LoggingInfoStream [BD][qtp1842250958-21]: applyDeletes: open segment readers took 0 msec
   [junit4]   2&amp;gt; 6227 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.LoggingInfoStream [BD][qtp1842250958-21]: applyDeletes: no segments; skipping
   [junit4]   2&amp;gt; 6227 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.LoggingInfoStream [BD][qtp1842250958-21]: prune sis=segments_2: _0(6.0.0):C1 minGen=5 packetCount=0
   [junit4]   2&amp;gt; 6255 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][qtp1842250958-21]: incRefDeleter &lt;span class="code-keyword"&gt;for&lt;/span&gt; NRT reader version=6 segments=_0(6.0.0):C1
   [junit4]   2&amp;gt; 6255 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][qtp1842250958-21]: &lt;span class="code-keyword"&gt;return&lt;/span&gt; reader version=6 reader=StandardDirectoryReader(segments_2:6:nrt _0(6.0.0):C1)
   [junit4]   2&amp;gt; 6255 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.LoggingInfoStream [DW][qtp1842250958-21]: qtp1842250958-21 finishFullFlush success=&lt;span class="code-keyword"&gt;true&lt;/span&gt;
   [junit4]   2&amp;gt; 6255 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][qtp1842250958-21]: getReader took 29 msec
   [junit4]   2&amp;gt; 6258 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.s.SolrIndexSearcher Opening Searcher@71c2b84c[collection1] main
   [junit4]   2&amp;gt; 6261 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.DirectUpdateHandler2 end_commit_flush
   [junit4]   2&amp;gt; 6261 INFO  (searcherExecutor-7-thread-1-processing-x:collection1) [    x:collection1] o.a.s.c.QuerySenderListener QuerySenderListener sending requests to Searcher@71c2b84c[collection1] main{ExitableDirectoryReader(UninvertingDirectoryReader(Uninverting(_0(6.0.0):C1)))}
   [junit4]   2&amp;gt; 6261 INFO  (searcherExecutor-7-thread-1-processing-x:collection1) [    x:collection1] o.a.s.c.QuerySenderListener QuerySenderListener done.
   [junit4]   2&amp;gt; 6261 INFO  (searcherExecutor-7-thread-1-processing-x:collection1) [    x:collection1] o.a.s.c.SolrCore [collection1] Registered &lt;span class="code-keyword"&gt;new&lt;/span&gt; searcher Searcher@71c2b84c[collection1] main{ExitableDirectoryReader(UninvertingDirectoryReader(Uninverting(_0(6.0.0):C1)))}
   [junit4]   2&amp;gt; 6261 INFO  (searcherExecutor-7-thread-1-processing-x:collection1) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][searcherExecutor-7-thread-1-processing-x:collection1]: decRefDeleter &lt;span class="code-keyword"&gt;for&lt;/span&gt; NRT reader version=2 segments=
   [junit4]   2&amp;gt; 6261 INFO  (qtp1842250958-21) [    x:collection1] o.a.s.u.p.LogUpdateProcessorFactory [collection1]  webapp=/solr path=/update params={waitSearcher=&lt;span class="code-keyword"&gt;true&lt;/span&gt;&amp;amp;commit=&lt;span class="code-keyword"&gt;true&lt;/span&gt;&amp;amp;softCommit=&lt;span class="code-keyword"&gt;false&lt;/span&gt;&amp;amp;wt=javabin&amp;amp;version=2}{commit=} 0 98
   [junit4]   2&amp;gt; 6286 INFO  (qtp1842250958-22) [    x:collection1] o.a.s.c.S.Request [collection1]  webapp=/solr path=/select params={q=*:*&amp;amp;fl=id,price_f,name,_version_&amp;amp;wt=javabin&amp;amp;version=2} hits=1 status=0 QTime=13
   [junit4]   2&amp;gt; 6329 INFO  (qtp1842250958-15) [    x:collection1] o.a.s.u.p.LogUpdateProcessorFactory [collection1]  webapp=/solr path=/update params={wt=javabin&amp;amp;version=2}{} 0 37
   [junit4]   2&amp;gt; 6542 INFO  (concurrentUpdateScheduler-3-thread-1-processing-http:&lt;span class="code-comment"&gt;////127.0.0.1:33129//solr//collection1) [    ] o.a.h.i.c.SystemDefaultHttpClient I/O exception (java.net.SocketException) caught when processing request to {}-&amp;gt;http://127.0.0.1:33129: Connection reset
&lt;/span&gt;   [junit4]   2&amp;gt; 6542 INFO  (concurrentUpdateScheduler-3-thread-1-processing-http:&lt;span class="code-comment"&gt;////127.0.0.1:33129//solr//collection1) [    ] o.a.h.i.c.SystemDefaultHttpClient Retrying request to {}-&amp;gt;http://127.0.0.1:33129
&lt;/span&gt;   [junit4]   2&amp;gt; 6545 INFO  (qtp1842250958-18) [    x:collection1] o.a.s.u.p.LogUpdateProcessorFactory [collection1]  webapp=/solr path=/update params={wt=javabin&amp;amp;version=2}{} 0 1
   [junit4]   2&amp;gt; 6793 INFO  (concurrentUpdateScheduler-3-thread-1-processing-http:&lt;span class="code-comment"&gt;////127.0.0.1:33129//solr//collection1) [    ] o.a.h.i.c.SystemDefaultHttpClient I/O exception (java.net.SocketException) caught when processing request to {}-&amp;gt;http://127.0.0.1:33129: Connection reset
&lt;/span&gt;   [junit4]   2&amp;gt; 6793 INFO  (concurrentUpdateScheduler-3-thread-1-processing-http:&lt;span class="code-comment"&gt;////127.0.0.1:33129//solr//collection1) [    ] o.a.h.i.c.SystemDefaultHttpClient Retrying request to {}-&amp;gt;http://127.0.0.1:33129
&lt;/span&gt;   [junit4]   2&amp;gt; 6795 INFO  (qtp1842250958-19) [    x:collection1] o.a.s.u.p.LogUpdateProcessorFactory [collection1]  webapp=/solr path=/update params={wt=javabin&amp;amp;version=2}{} 0 0
   [junit4]   2&amp;gt; 7045 INFO  (concurrentUpdateScheduler-3-thread-1-processing-http:&lt;span class="code-comment"&gt;////127.0.0.1:33129//solr//collection1) [    ] o.a.h.i.c.SystemDefaultHttpClient I/O exception (java.net.SocketException) caught when processing request to {}-&amp;gt;http://127.0.0.1:33129: Connection reset
&lt;/span&gt;   [junit4]   2&amp;gt; 7046 INFO  (concurrentUpdateScheduler-3-thread-1-processing-http:&lt;span class="code-comment"&gt;////127.0.0.1:33129//solr//collection1) [    ] o.a.h.i.c.SystemDefaultHttpClient Retrying request to {}-&amp;gt;http://127.0.0.1:33129
&lt;/span&gt;   [junit4]   2&amp;gt; 7050 INFO  (qtp1842250958-16) [    x:collection1] o.a.s.u.p.LogUpdateProcessorFactory [collection1]  webapp=/solr path=/update params={wt=javabin&amp;amp;version=2}{} 0 0
   [junit4]   2&amp;gt; 7303 INFO  (qtp1842250958-20) [    x:collection1] o.a.s.u.DirectUpdateHandler2 start commit{,optimize=&lt;span class="code-keyword"&gt;false&lt;/span&gt;,openSearcher=&lt;span class="code-keyword"&gt;true&lt;/span&gt;,waitSearcher=&lt;span class="code-keyword"&gt;true&lt;/span&gt;,expungeDeletes=&lt;span class="code-keyword"&gt;false&lt;/span&gt;,softCommit=&lt;span class="code-keyword"&gt;false&lt;/span&gt;,prepareCommit=&lt;span class="code-keyword"&gt;false&lt;/span&gt;}
   [junit4]   2&amp;gt; 7303 INFO  (qtp1842250958-20) [    x:collection1] o.a.s.u.DirectUpdateHandler2 No uncommitted changes. Skipping IW.commit.
   [junit4]   2&amp;gt; 7303 INFO  (qtp1842250958-20) [    x:collection1] o.a.s.c.SolrCore SolrIndexSearcher has not changed - not re-opening: org.apache.solr.search.SolrIndexSearcher
   [junit4]   2&amp;gt; 7303 INFO  (qtp1842250958-20) [    x:collection1] o.a.s.u.DirectUpdateHandler2 end_commit_flush
   [junit4]   2&amp;gt; 7303 INFO  (qtp1842250958-20) [    x:collection1] o.a.s.u.p.LogUpdateProcessorFactory [collection1]  webapp=/solr path=/update params={waitSearcher=&lt;span class="code-keyword"&gt;true&lt;/span&gt;&amp;amp;commit=&lt;span class="code-keyword"&gt;true&lt;/span&gt;&amp;amp;softCommit=&lt;span class="code-keyword"&gt;false&lt;/span&gt;&amp;amp;wt=javabin&amp;amp;version=2}{commit=} 0 1
   [junit4]   2&amp;gt; 7305 INFO  (TEST-SolrExampleStreamingBinaryTest.testUpdateField-seed#[EC056F9D893F1A9A]) [    ] o.a.s.SolrTestCaseJ4 ###Ending testUpdateField
   [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=SolrExampleStreamingBinaryTest -Dtests.method=testUpdateField -Dtests.seed=EC056F9D893F1A9A -Dtests.slow=&lt;span class="code-keyword"&gt;true&lt;/span&gt; -Dtests.locale=es -Dtests.timezone=America/Dawson -Dtests.asserts=&lt;span class="code-keyword"&gt;true&lt;/span&gt; -Dtests.file.encoding=ISO-8859-1
   [junit4] FAILURE 1.96s | SolrExampleStreamingBinaryTest.testUpdateField &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: java.lang.AssertionError: ConcurrentUpdateSolrClient did not report an error
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([EC056F9D893F1A9A:B976C5C949170A5C]:0)
   [junit4]    &amp;gt; 	at org.apache.solr.client.solrj.SolrExampleTests.testUpdateField(SolrExampleTests.java:1633)
   [junit4]    &amp;gt; 	at java.lang.&lt;span class="code-object"&gt;Thread&lt;/span&gt;.run(&lt;span class="code-object"&gt;Thread&lt;/span&gt;.java:745)
   [junit4]   2&amp;gt; 7325 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    ] o.e.j.s.ServerConnector Stopped ServerConnector@3b2c45{HTTP/1.1,[http/1.1]}{127.0.0.1:0}
   [junit4]   2&amp;gt; 7326 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    ] o.a.s.c.CoreContainer Shutting down CoreContainer instance=62491411
   [junit4]   2&amp;gt; 7326 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    x:collection1] o.a.s.c.SolrCore [collection1]  CLOSING SolrCore org.apache.solr.core.SolrCore@450e9f8d
   [junit4]   2&amp;gt; 7327 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    x:collection1] o.a.s.u.DirectUpdateHandler2 closing DirectUpdateHandler2{commits=3,autocommit maxTime=15000ms,autocommits=0,soft autocommits=0,optimizes=0,rollbacks=0,expungeDeletes=0,docsPending=0,adds=0,deletesById=0,deletesByQuery=0,errors=0,cumulative_adds=1,cumulative_deletesById=0,cumulative_deletesByQuery=1,cumulative_errors=0,transaction_logs_total_size=191,transaction_logs_total_number=2}
   [junit4]   2&amp;gt; 7328 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    x:collection1] o.a.s.u.SolrCoreState Closing SolrCoreState
   [junit4]   2&amp;gt; 7329 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    x:collection1] o.a.s.u.DefaultSolrCoreState SolrCoreState ref count has reached 0 - closing IndexWriter
   [junit4]   2&amp;gt; 7329 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    x:collection1] o.a.s.u.DefaultSolrCoreState closing IndexWriter with IndexWriterCloser
   [junit4]   2&amp;gt; 7334 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker]: now flush at close
   [junit4]   2&amp;gt; 7334 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker]:   start flush: applyAllDeletes=&lt;span class="code-keyword"&gt;true&lt;/span&gt;
   [junit4]   2&amp;gt; 7334 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker]:   index before flush _0(6.0.0):C1
   [junit4]   2&amp;gt; 7334 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    x:collection1] o.a.s.u.LoggingInfoStream [DW][SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker]: startFullFlush
   [junit4]   2&amp;gt; 7334 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    x:collection1] o.a.s.u.LoggingInfoStream [DW][SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker]: SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker finishFullFlush success=&lt;span class="code-keyword"&gt;true&lt;/span&gt;
   [junit4]   2&amp;gt; 7334 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker]: apply all deletes during flush
   [junit4]   2&amp;gt; 7334 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker]: now apply all deletes &lt;span class="code-keyword"&gt;for&lt;/span&gt; all segments maxDoc=1
   [junit4]   2&amp;gt; 7334 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    x:collection1] o.a.s.u.LoggingInfoStream [BD][SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker]: applyDeletes: open segment readers took 0 msec
   [junit4]   2&amp;gt; 7334 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    x:collection1] o.a.s.u.LoggingInfoStream [BD][SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker]: applyDeletes: no segments; skipping
   [junit4]   2&amp;gt; 7334 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    x:collection1] o.a.s.u.LoggingInfoStream [BD][SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker]: prune sis=segments_2: _0(6.0.0):C1 minGen=5 packetCount=0
   [junit4]   2&amp;gt; 7335 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    x:collection1] o.a.s.u.LoggingInfoStream [MS][SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker]: updateMergeThreads ioThrottle=&lt;span class="code-keyword"&gt;true&lt;/span&gt; targetMBPerSec=10240.0 MB/sec
   [junit4]   2&amp;gt; 7335 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    x:collection1] o.a.s.u.LoggingInfoStream [MS][SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker]: now merge
   [junit4]   2&amp;gt; 7335 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    x:collection1] o.a.s.u.LoggingInfoStream [MS][SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker]:   index: _0(6.0.0):C1
   [junit4]   2&amp;gt; 7335 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    x:collection1] o.a.s.u.LoggingInfoStream [MS][SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker]:   no more merges pending; now &lt;span class="code-keyword"&gt;return&lt;/span&gt;
   [junit4]   2&amp;gt; 7335 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker]: waitForMerges
   [junit4]   2&amp;gt; 7335 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker]: waitForMerges done
   [junit4]   2&amp;gt; 7335 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker]: commit: start
   [junit4]   2&amp;gt; 7335 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker]: commit: enter lock
   [junit4]   2&amp;gt; 7335 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker]: commit: now prepare
   [junit4]   2&amp;gt; 7335 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker]: prepareCommit: flush
   [junit4]   2&amp;gt; 7335 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker]:   index before flush _0(6.0.0):C1
   [junit4]   2&amp;gt; 7335 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    x:collection1] o.a.s.u.LoggingInfoStream [DW][SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker]: startFullFlush
   [junit4]   2&amp;gt; 7336 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker]: apply all deletes during flush
   [junit4]   2&amp;gt; 7336 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker]: now apply all deletes &lt;span class="code-keyword"&gt;for&lt;/span&gt; all segments maxDoc=1
   [junit4]   2&amp;gt; 7336 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    x:collection1] o.a.s.u.LoggingInfoStream [BD][SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker]: applyDeletes: open segment readers took 0 msec
   [junit4]   2&amp;gt; 7336 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    x:collection1] o.a.s.u.LoggingInfoStream [BD][SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker]: applyDeletes: no segments; skipping
   [junit4]   2&amp;gt; 7336 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    x:collection1] o.a.s.u.LoggingInfoStream [BD][SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker]: prune sis=segments_2: _0(6.0.0):C1 minGen=5 packetCount=0
   [junit4]   2&amp;gt; 7336 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    x:collection1] o.a.s.u.LoggingInfoStream [DW][SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker]: SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker finishFullFlush success=&lt;span class="code-keyword"&gt;true&lt;/span&gt;
   [junit4]   2&amp;gt; 7336 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker]: startCommit(): start
   [junit4]   2&amp;gt; 7336 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker]:   skip startCommit(): no changes pending
   [junit4]   2&amp;gt; 7336 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker]: commit: pendingCommit == &lt;span class="code-keyword"&gt;null&lt;/span&gt;; skip
   [junit4]   2&amp;gt; 7337 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker]: commit: took 1.2 msec
   [junit4]   2&amp;gt; 7337 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker]: commit: done
   [junit4]   2&amp;gt; 7337 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker]: rollback
   [junit4]   2&amp;gt; 7337 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker]: all running merges have aborted
   [junit4]   2&amp;gt; 7337 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker]: rollback: done finish merges
   [junit4]   2&amp;gt; 7337 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    x:collection1] o.a.s.u.LoggingInfoStream [DW][SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker]: abort
   [junit4]   2&amp;gt; 7337 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    x:collection1] o.a.s.u.LoggingInfoStream [DW][SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker]: done abort success=&lt;span class="code-keyword"&gt;true&lt;/span&gt;
   [junit4]   2&amp;gt; 7337 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    x:collection1] o.a.s.u.LoggingInfoStream [IW][SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker]: rollback: infos=_0(6.0.0):C1
   [junit4]   2&amp;gt; 7337 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    x:collection1] o.a.s.u.LoggingInfoStream [IFD][SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker]: now checkpoint &lt;span class="code-quote"&gt;"_0(6.0.0):C1"&lt;/span&gt; [1 segments ; isCommit = &lt;span class="code-keyword"&gt;false&lt;/span&gt;]
   [junit4]   2&amp;gt; 7337 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    x:collection1] o.a.s.u.LoggingInfoStream [IFD][SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker]: 0 msec to checkpoint
   [junit4]   2&amp;gt; 7338 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    x:collection1] o.a.s.c.SolrCore [collection1] Closing main searcher on request.
   [junit4]   2&amp;gt; 7348 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    x:collection1] o.a.s.c.CachingDirectoryFactory Closing MockDirectoryFactory - 2 directories currently being tracked
   [junit4]   2&amp;gt; 7349 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    x:collection1] o.a.s.c.CachingDirectoryFactory looking to close /home/ishan/code/lucene-solr-svn/solr/build/solr-solrj/test/J0/temp/solr.client.solrj.embedded.SolrExampleStreamingBinaryTest_EC056F9D893F1A9A-001/tempDir-001/collection1/data [CachedDir&amp;lt;&amp;lt;refCount=0;path=/home/ishan/code/lucene-solr-svn/solr/build/solr-solrj/test/J0/temp/solr.client.solrj.embedded.SolrExampleStreamingBinaryTest_EC056F9D893F1A9A-001/tempDir-001/collection1/data;done=&lt;span class="code-keyword"&gt;false&lt;/span&gt;&amp;gt;&amp;gt;]
   [junit4]   2&amp;gt; 7349 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    x:collection1] o.a.s.c.CachingDirectoryFactory Closing directory: /home/ishan/code/lucene-solr-svn/solr/build/solr-solrj/test/J0/temp/solr.client.solrj.embedded.SolrExampleStreamingBinaryTest_EC056F9D893F1A9A-001/tempDir-001/collection1/data
   [junit4]   2&amp;gt; 7349 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    x:collection1] o.a.s.c.CachingDirectoryFactory looking to close /home/ishan/code/lucene-solr-svn/solr/build/solr-solrj/test/J0/temp/solr.client.solrj.embedded.SolrExampleStreamingBinaryTest_EC056F9D893F1A9A-001/tempDir-001/collection1/data/index [CachedDir&amp;lt;&amp;lt;refCount=0;path=/home/ishan/code/lucene-solr-svn/solr/build/solr-solrj/test/J0/temp/solr.client.solrj.embedded.SolrExampleStreamingBinaryTest_EC056F9D893F1A9A-001/tempDir-001/collection1/data/index;done=&lt;span class="code-keyword"&gt;false&lt;/span&gt;&amp;gt;&amp;gt;]
   [junit4]   2&amp;gt; 7350 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    x:collection1] o.a.s.c.CachingDirectoryFactory Closing directory: /home/ishan/code/lucene-solr-svn/solr/build/solr-solrj/test/J0/temp/solr.client.solrj.embedded.SolrExampleStreamingBinaryTest_EC056F9D893F1A9A-001/tempDir-001/collection1/data/index
   [junit4]   2&amp;gt; 7352 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    x:collection1] o.e.j.s.h.ContextHandler Stopped o.e.j.s.ServletContextHandler@6ec49310{/solr,&lt;span class="code-keyword"&gt;null&lt;/span&gt;,UNAVAILABLE}
   [junit4]   2&amp;gt; 7355 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[EC056F9D893F1A9A]-worker) [    ] o.a.s.SolrTestCaseJ4 ###deleteCore
   [junit4]   2&amp;gt; NOTE: leaving temporary files on disk at: /home/ishan/code/lucene-solr-svn/solr/build/solr-solrj/test/J0/temp/solr.client.solrj.embedded.SolrExampleStreamingBinaryTest_EC056F9D893F1A9A-001
   [junit4]   2&amp;gt; NOTE: test params are: codec=Asserting(Lucene60): {}, docValues:{}, sim=ClassicSimilarity, locale=es, timezone=America/Dawson
   [junit4]   2&amp;gt; NOTE: Linux 4.2.8-300.fc23.x86_64 amd64/Oracle Corporation 1.8.0_65 (64-bit)/cpus=4,threads=1,free=131111776,total=251658240
   [junit4]   2&amp;gt; NOTE: All tests run in &lt;span class="code-keyword"&gt;this&lt;/span&gt; JVM: [SolrExampleStreamingBinaryTest]
   [junit4] Completed [1/1 (1!)] in 8.61s, 1 test, 1 failure &amp;lt;&amp;lt;&amp;lt; FAILURES!
   [junit4] 
   [junit4] 
   [junit4] Tests with failures [seed: EC056F9D893F1A9A]:
   [junit4]   - org.apache.solr.client.solrj.embedded.SolrExampleStreamingBinaryTest.testUpdateField
   [junit4] 
   [junit4] 
   [junit4] JVM J0:     1.04 ..    10.55 =     9.51s
   [junit4] Execution time total: 10 seconds
   [junit4] Tests summary: 1 suite, 1 test, 1 failure

BUILD FAILED
/home/ishan/code/lucene-solr-svn/solr/build.xml:246: The following error occurred &lt;span class="code-keyword"&gt;while&lt;/span&gt; executing &lt;span class="code-keyword"&gt;this&lt;/span&gt; line:
/home/ishan/code/lucene-solr-svn/solr/common-build.xml:516: The following error occurred &lt;span class="code-keyword"&gt;while&lt;/span&gt; executing &lt;span class="code-keyword"&gt;this&lt;/span&gt; line:
/home/ishan/code/lucene-solr-svn/lucene/common-build.xml:1436: The following error occurred &lt;span class="code-keyword"&gt;while&lt;/span&gt; executing &lt;span class="code-keyword"&gt;this&lt;/span&gt; line:
/home/ishan/code/lucene-solr-svn/lucene/common-build.xml:991: There were test failures: 1 suite, 1 test, 1 failure [seed: EC056F9D893F1A9A]

Total time: 2 minutes 45 seconds
[ishan@x230 solr]$ 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15066737" author="markrmiller@gmail.com" created="Mon, 21 Dec 2015 10:23:46 -0700">&lt;p&gt;Yeah, I just hit the fail for the first time as well. (with the patch applied).&lt;/p&gt;

&lt;p&gt;Thanks for the confirm.&lt;/p&gt;

&lt;p&gt;I filed &lt;a href="https://issues.apache.org/jira/browse/SOLR-8451" title="We should not call method.abort in HttpSolrClient and HttpSolrCall#remoteQuery should not close streams." class="issue-link" data-issue-key="SOLR-8451"&gt;&lt;del&gt;SOLR-8451&lt;/del&gt;&lt;/a&gt; for the above change.&lt;/p&gt;</comment>
                            <comment id="15066745" author="markrmiller@gmail.com" created="Mon, 21 Dec 2015 10:29:09 -0700">&lt;blockquote&gt;&lt;p&gt;but the exact error isn't clear to me from that output.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It's tripping: assertTrue("ConcurrentUpdateSolrClient did not report an error", concurrentClient.lastError.getMessage().contains("Conflict"));&lt;/p&gt;

&lt;p&gt;Is that the same fail as without the patch? I assume so, but just to confirm.&lt;/p&gt;</comment>
                            <comment id="15066756" author="ichattopadhyaya" created="Mon, 21 Dec 2015 10:34:43 -0700">&lt;p&gt;Right, same as without the patch. Here's the relevant part of the log from a run without the patch.&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
   [junit4]   2&amp;gt; 6916 INFO  (TEST-SolrExampleStreamingBinaryTest.testUpdateField-seed#[DD2B3DCB4B87359]) [    ] o.a.s.SolrTestCaseJ4 ###Ending testUpdateField
   [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=SolrExampleStreamingBinaryTest -Dtests.method=testUpdateField -Dtests.seed=DD2B3DCB4B87359 -Dtests.slow=&lt;span class="code-keyword"&gt;true&lt;/span&gt; -Dtests.locale=it_IT -Dtests.timezone=Europe/Skopje -Dtests.asserts=&lt;span class="code-keyword"&gt;true&lt;/span&gt; -Dtests.file.encoding=UTF-8
   [junit4] FAILURE 2.03s | SolrExampleStreamingBinaryTest.testUpdateField &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: java.lang.AssertionError: ConcurrentUpdateSolrClient did not report an error
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([DD2B3DCB4B87359:58A119887490639F]:0)
   [junit4]    &amp;gt; 	at org.apache.solr.client.solrj.SolrExampleTests.testUpdateField(SolrExampleTests.java:1633)
   [junit4]    &amp;gt; 	at java.lang.&lt;span class="code-object"&gt;Thread&lt;/span&gt;.run(&lt;span class="code-object"&gt;Thread&lt;/span&gt;.java:745)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15066781" author="markrmiller@gmail.com" created="Mon, 21 Dec 2015 10:49:16 -0700">&lt;p&gt;So that fail seems pretty odd.&lt;/p&gt;

&lt;p&gt;We can only hit that fail if: !(client instanceof HttpSolrClient)&lt;/p&gt;

&lt;p&gt;And client can only be HttpSolrClient or EmbeddedSolrServer. It should not be EmbeddedSolrServer, because we make a Jetty for this test and presumably a Jetty is involved in this connection reset business. So we really expect that client to be an HttpSolrClient don't we?&lt;/p&gt;

&lt;p&gt;So how do we get to this fail message below unless we are using EmbeddedSolrServer?&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
      client.add(doc);
      &lt;span class="code-keyword"&gt;if&lt;/span&gt;(client &lt;span class="code-keyword"&gt;instanceof&lt;/span&gt; HttpSolrClient) { &lt;span class="code-comment"&gt;//XXX concurrent client reports exceptions differently
&lt;/span&gt;        fail(&lt;span class="code-quote"&gt;"Operation should &lt;span class="code-keyword"&gt;throw&lt;/span&gt; an exception!"&lt;/span&gt;);
      } &lt;span class="code-keyword"&gt;else&lt;/span&gt; {
        client.commit(); &lt;span class="code-comment"&gt;//just to be sure the client has sent the doc
&lt;/span&gt;        ErrorTrackingConcurrentUpdateSolrClient concurrentClient = (ErrorTrackingConcurrentUpdateSolrClient) client;
        assertNotNull(&lt;span class="code-quote"&gt;"ConcurrentUpdateSolrClient did not report an error"&lt;/span&gt;, concurrentClient.lastError);
        assertTrue(&lt;span class="code-quote"&gt;"ConcurrentUpdateSolrClient did not report correct error: "&lt;/span&gt; + concurrentClient.lastError.getMessage(), concurrentClient.lastError.getMessage().contains(&lt;span class="code-quote"&gt;"Conflict"&lt;/span&gt;));
      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15066795" author="markrmiller@gmail.com" created="Mon, 21 Dec 2015 10:55:01 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ichattopadhyaya" class="user-hover" rel="ichattopadhyaya"&gt;Ishan Chattopadhyaya&lt;/a&gt;, could you try making:  'public static JettySolrRunner jetty' in SolrJettyTestBase volatile?&lt;/p&gt;</comment>
                            <comment id="15066825" author="ichattopadhyaya" created="Mon, 21 Dec 2015 11:17:54 -0700">&lt;p&gt;I changed it to "public volatile static JettySolrRunner jetty", and without your patch. Still same error:&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
   [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=SolrExampleStreamingBinaryTest -Dtests.method=testUpdateField -Dtests.seed=C198E930F63ED207 -Dtests.slow=&lt;span class="code-keyword"&gt;true&lt;/span&gt; -Dtests.locale=es_PR -Dtests.timezone=America/Martinique -Dtests.asserts=&lt;span class="code-keyword"&gt;true&lt;/span&gt; -Dtests.file.encoding=US-ASCII
   [junit4] FAILURE 2.00s | SolrExampleStreamingBinaryTest.testUpdateField &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: java.lang.AssertionError: ConcurrentUpdateSolrClient did not report an error
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([C198E930F63ED207:94EB43643616C2C1]:0)
   [junit4]    &amp;gt; 	at org.apache.solr.client.solrj.SolrExampleTests.testUpdateField(SolrExampleTests.java:1633)
   [junit4]    &amp;gt; 	at java.lang.&lt;span class="code-object"&gt;Thread&lt;/span&gt;.run(&lt;span class="code-object"&gt;Thread&lt;/span&gt;.java:745)
   [junit4]   2&amp;gt; 7502 INFO  (SUITE-SolrExampleStreamingBinaryTest-seed#[C198E930F63ED207]-worker) [    ] o.e.j.s.ServerConnector Stopped ServerConnector@66fa0f59{HTTP/1.1,[http/1.1]}{127.0.0.1:0}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In a few hours, I can trace through and find out the exact class of the client, and compare with what is the corresponding behaviour on branch_5x for this test.&lt;/p&gt;</comment>
                            <comment id="15066832" author="markrmiller@gmail.com" created="Mon, 21 Dec 2015 11:26:38 -0700">&lt;blockquote&gt;&lt;p&gt;So that fail seems pretty odd.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Okay, sorry, I thought SolrExampleBinaryTest was hitting this, I was working from the wrong test. It's SolrExampleStreamingBinaryTest. I can't easily reproduce a fail in either one, but I have seen it happen in some test runs.&lt;/p&gt;</comment>
                            <comment id="15066863" author="shalinmangar" created="Mon, 21 Dec 2015 11:49:37 -0700">&lt;p&gt;Yeah, it is ConcurrentHttpSolrClient. The tracked exception in this case is a connection reset exception and not a "Conflict".&lt;/p&gt;</comment>
                            <comment id="15066933" author="markrmiller@gmail.com" created="Mon, 21 Dec 2015 12:24:59 -0700">&lt;p&gt;I don't know how to solve this for the general case. Especially for streaming, with this behavior we really need make sure the exception gets set on the response rather than cutting off the request while the client is still sending.&lt;/p&gt;

&lt;p&gt;For this particular version issue with this container behavior, you need something like the following instead of throwing an exception, though we probably want something more general and that plays nicer with doFinish:&lt;/p&gt;

&lt;p&gt;SolrException e = new SolrException(ErrorCode.CONFLICT, "version conflict for " + cmd.getPrintableId() + " expected=" + versionOnUpdate + " actual=" + foundVersion);;&lt;br/&gt;
rsp.setException(e);&lt;br/&gt;
return true;&lt;/p&gt;</comment>
                            <comment id="15067107" author="markrmiller@gmail.com" created="Mon, 21 Dec 2015 14:40:55 -0700">&lt;p&gt;I filed &lt;a href="https://issues.apache.org/jira/browse/SOLR-8453" title="Jetty update from 9.2 to 9.3 causes the server to reset formerly legitimate client connections." class="issue-link" data-issue-key="SOLR-8453"&gt;&lt;del&gt;SOLR-8453&lt;/del&gt;&lt;/a&gt; to deal with this SolrExampleStreamingBinaryTest fail issue.&lt;/p&gt;</comment>
                            <comment id="15068087" author="markrmiller@gmail.com" created="Tue, 22 Dec 2015 06:16:53 -0700">&lt;p&gt;My patch for &lt;a href="https://issues.apache.org/jira/browse/SOLR-8453" title="Jetty update from 9.2 to 9.3 causes the server to reset formerly legitimate client connections." class="issue-link" data-issue-key="SOLR-8453"&gt;&lt;del&gt;SOLR-8453&lt;/del&gt;&lt;/a&gt; seems to solve pretty much all the connection resets I have been seeing except for the Locale issue. SolrExampleBinaryTest, TestManagedSchemaDynamicFieldResource and a bunch of others can fail with the wrong Locale.&lt;/p&gt;</comment>
                            <comment id="15069011" author="markrmiller@gmail.com" created="Tue, 22 Dec 2015 18:39:52 -0700">&lt;blockquote&gt;&lt;p&gt;My patch for &lt;a href="https://issues.apache.org/jira/browse/SOLR-8453" title="Jetty update from 9.2 to 9.3 causes the server to reset formerly legitimate client connections." class="issue-link" data-issue-key="SOLR-8453"&gt;&lt;del&gt;SOLR-8453&lt;/del&gt;&lt;/a&gt; seems to solve pretty much all the connection resets I have been seeing except for the Locale issue.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;So this still stands. I think I've solved the general issue with the patch in &lt;a href="https://issues.apache.org/jira/browse/SOLR-8453" title="Jetty update from 9.2 to 9.3 causes the server to reset formerly legitimate client connections." class="issue-link" data-issue-key="SOLR-8453"&gt;&lt;del&gt;SOLR-8453&lt;/del&gt;&lt;/a&gt;. I'm still banging around with it, but it's looking pretty good on my machine.&lt;/p&gt;

&lt;p&gt;I still think we probably have to roll this update back because it appears to break Solr under certain default Locales. We should probably try and isolate what is causing it so we can file a bug, but we would still need to wait for a good version.&lt;/p&gt;</comment>
                            <comment id="15069089" author="markrmiller@gmail.com" created="Tue, 22 Dec 2015 20:26:38 -0700">&lt;p&gt;It's not very often, but I seem to see the following pop up after the update and don't remember it being an issue before (for a long time anyway):&lt;/p&gt;

&lt;p&gt;  &lt;span class="error"&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt; 327513 ERROR (TEST-BasicDistributedZk2Test.test-seed#&lt;span class="error"&gt;&amp;#91;EAADE41C3F03EAEF&amp;#93;&lt;/span&gt;) &lt;span class="error"&gt;&amp;#91;n:127.0.0.1:38892_i c:collection1 s:shard1 r:core_node2 x:collection1&amp;#93;&lt;/span&gt; o.a.s.c.ChaosMonkey Could not get the port to start jetty again&lt;br/&gt;
   &lt;span class="error"&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt; java.net.BindException: Address already in use&lt;/p&gt;</comment>
                            <comment id="15069122" author="markrmiller@gmail.com" created="Tue, 22 Dec 2015 21:08:30 -0700">&lt;p&gt;Interesting exception in a CollectionsAPIDistributedZkTest fail:&lt;/p&gt;

&lt;div class="preformatted panel" style="border-width: 1px;"&gt;&lt;div class="preformattedContent panelContent"&gt;
&lt;pre&gt;   [junit4]   2&amp;gt; 232756 ERROR (qtp543233699-1130) [n:127.0.0.1:43044_kqam    ] o.a.s.s.HttpSolrCall null:org.apache.solr.common.SolrException: Error trying to proxy request for url: http://127.0.0.1:34586/kqam/awholynewcollection_0/select
   [junit4]   2&amp;gt; 	at org.apache.solr.servlet.HttpSolrCall.remoteQuery(HttpSolrCall.java:591)
   [junit4]   2&amp;gt; 	at org.apache.solr.servlet.HttpSolrCall.call(HttpSolrCall.java:441)
   [junit4]   2&amp;gt; 	at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:226)
   [junit4]   2&amp;gt; 	at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:184)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1668)
   [junit4]   2&amp;gt; 	at org.apache.solr.client.solrj.embedded.JettySolrRunner$DebugFilter.doFilter(JettySolrRunner.java:111)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1668)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.servlets.GzipFilter.doFilter(GzipFilter.java:45)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1668)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:581)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:224)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1158)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:511)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:185)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1090)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.server.handler.gzip.GzipHandler.handle(GzipHandler.java:437)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:119)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.server.Server.handle(Server.java:517)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:308)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:242)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:261)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:95)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.io.SelectChannelEndPoint$2.run(SelectChannelEndPoint.java:75)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.produceAndRun(ExecuteProduceConsume.java:213)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.run(ExecuteProduceConsume.java:147)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:654)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:572)
   [junit4]   2&amp;gt; 	at java.lang.Thread.run(Thread.java:745)
   [junit4]   2&amp;gt; Caused by: java.io.IOException: Response header too large
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.http.HttpGenerator.generateResponse(HttpGenerator.java:404)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.server.HttpConnection$SendCallback.process(HttpConnection.java:678)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.util.IteratingCallback.processing(IteratingCallback.java:241)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.util.IteratingCallback.iterate(IteratingCallback.java:224)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.server.HttpConnection.send(HttpConnection.java:509)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.server.HttpChannel.sendResponse(HttpChannel.java:668)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.server.HttpChannel.write(HttpChannel.java:722)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.server.handler.gzip.GzipHttpOutputInterceptor.commit(GzipHttpOutputInterceptor.java:201)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.server.handler.gzip.GzipHttpOutputInterceptor.write(GzipHttpOutputInterceptor.java:100)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.server.HttpOutput.write(HttpOutput.java:177)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.server.HttpOutput.write(HttpOutput.java:163)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.server.HttpOutput.write(HttpOutput.java:413)
   [junit4]   2&amp;gt; 	at org.apache.commons.io.IOUtils.copyLarge(IOUtils.java:1793)
   [junit4]   2&amp;gt; 	at org.apache.commons.io.IOUtils.copyLarge(IOUtils.java:1769)
   [junit4]   2&amp;gt; 	at org.apache.solr.servlet.HttpSolrCall.remoteQuery(HttpSolrCall.java:582)
   [junit4]   2&amp;gt; 	... 28 more
   [junit4]   2&amp;gt; Caused by: java.nio.BufferOverflowException
   [junit4]   2&amp;gt; 	at java.nio.Buffer.nextPutIndex(Buffer.java:521)
   [junit4]   2&amp;gt; 	at java.nio.HeapByteBuffer.put(HeapByteBuffer.java:169)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.http.HttpGenerator.putSanitisedValue(HttpGenerator.java:982)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.http.HttpGenerator.putTo(HttpGenerator.java:998)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.http.HttpGenerator.generateHeaders(HttpGenerator.java:711)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.http.HttpGenerator.generateResponse(HttpGenerator.java:389)
   [junit4]   2&amp;gt; 	... 42 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15069551" author="shalinmangar" created="Wed, 23 Dec 2015 05:06:44 -0700">&lt;blockquote&gt;&lt;p&gt;I still think we probably have to roll this update back because it appears to break Solr under certain default Locales. We should probably try and isolate what is causing it so we can file a bug, but we would still need to wait for a good version.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Makes sense. I'll revert.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Interesting exception in a CollectionsAPIDistributedZkTest fail:&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I don't think that is caused by the jetty upgrade because it happens on 5x and 5.4 branches too. I had opened &lt;a href="https://issues.apache.org/jira/browse/SOLR-8380" title="CollectionsAPIDistributedZkTest frequent failures with non ok status: 500, message:Server Error" class="issue-link" data-issue-key="SOLR-8380"&gt;SOLR-8380&lt;/a&gt; to track it.&lt;/p&gt;</comment>
                            <comment id="15069580" author="thetaphi" created="Wed, 23 Dec 2015 05:33:50 -0700">&lt;blockquote&gt;&lt;p&gt;We should probably try and isolate what is causing it so we can file a bug, but we would still need to wait for a good version.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;...maybe suggest to Jetty people that they use forbidden-apis with &lt;tt&gt;jdk-unsafe&lt;/tt&gt; bundled signatures! &lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/smile.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt;&lt;/p&gt;</comment>
                            <comment id="15072099" author="shalinmangar" created="Sun, 27 Dec 2015 02:22:18 -0700">&lt;p&gt;Patch to revert all Jetty9.3 related changes&lt;/p&gt;</comment>
                            <comment id="15087555" author="markrmiller@gmail.com" created="Thu, 7 Jan 2016 08:14:41 -0700">&lt;p&gt;We should probably commit that patch - trunk fails are quite noisy now.&lt;/p&gt;

&lt;p&gt;I think I've tracked down the other issue in &lt;a href="https://issues.apache.org/jira/browse/SOLR-8453" title="Jetty update from 9.2 to 9.3 causes the server to reset formerly legitimate client connections." class="issue-link" data-issue-key="SOLR-8453"&gt;&lt;del&gt;SOLR-8453&lt;/del&gt;&lt;/a&gt;. I'm thinking it's a Jetty bug. So I think two bugs are currently preventing us from upgrading.&lt;/p&gt;

&lt;p&gt;I sent an email to the Jetty dev list to ask about the issue in &lt;a href="https://issues.apache.org/jira/browse/SOLR-8453" title="Jetty update from 9.2 to 9.3 causes the server to reset formerly legitimate client connections." class="issue-link" data-issue-key="SOLR-8453"&gt;&lt;del&gt;SOLR-8453&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15087601" author="shalinmangar" created="Thu, 7 Jan 2016 08:46:34 -0700">&lt;p&gt;Thanks a lot Mark for looking into this. I'll revert the jetty upgrade for now.&lt;/p&gt;</comment>
                            <comment id="15087761" author="jira-bot" created="Thu, 7 Jan 2016 10:51:59 -0700">&lt;p&gt;Commit 1723604 from shalin@apache.org in branch 'dev/trunk'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1723604" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1723604&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-7339" title="Upgrade Jetty from 9.2 to 9.3" class="issue-link" data-issue-key="SOLR-7339"&gt;&lt;del&gt;SOLR-7339&lt;/del&gt;&lt;/a&gt;: Revert Jetty 9.3 upgrade&lt;/p&gt;</comment>
                            <comment id="15087814" author="markrmiller@gmail.com" created="Thu, 7 Jan 2016 11:21:48 -0700">&lt;blockquote&gt;&lt;p&gt;The request that fails sends data using chunked encoding, but sends one chunk of length 0x59, but does not send the terminal chunk. The logs show Jetty reporting that the processing is complete but with unconsumed input, and therefore closes the connection.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=joakime" class="user-hover" rel="joakime"&gt;Joakim Erdfelt&lt;/a&gt;, it appears that the terminal chunk is still coming. Jetty is no longer waiting for it like it previously did. If we speed up how fast we send the terminal chunk, we can get the test to pass. If we slow it down too much, say even by turning on all debug logging, even speeding up how fast we send the terminal chunk is not enough. We basically now have 10-12ms to get that terminal chunk out, where previously Jetty would wait up to other connection timeouts (30 seconds) to get that terminal chunk.&lt;/p&gt;</comment>
                            <comment id="15087882" author="markrmiller@gmail.com" created="Thu, 7 Jan 2016 12:01:40 -0700">&lt;p&gt;Yonik mentioned to me that this is probably legal behavior, even if undesirable as it prevents connection reuse for us in these cases. The problem is that HttpClient hits this in a way that we can not really work around to get to the right error and ?ignore? the connection reset?&lt;/p&gt;</comment>
                            <comment id="15088390" author="gregw@webtide.com" created="Thu, 7 Jan 2016 16:38:51 -0700">&lt;p&gt;Mark,&lt;/p&gt;

&lt;p&gt;A simple work around could be to install a filter on the server that does read until EOF - ie the filter will ensure that all the content is consumed.  Something like psuedo code:&lt;br/&gt;
```java&lt;br/&gt;
  doFilter(FilterChain chain, ServletRequest request, ServletResponse response)&lt;br/&gt;
  {&lt;br/&gt;
    try&lt;/p&gt;
    {
      chain.doFilter(request,response);
    }
&lt;p&gt;    finally&lt;/p&gt;
    {
       consumeAll(request.getInputStream());
    }
&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;It may need to be more sophisticated than this is you sometimes use a Reader and/or async IO, but the principal is the same - get the filter to do the behaviour that was in jetty-9.2.    From Jetty's point of view it is the application that can decide to block and wait for this content, so that is OK.&lt;/p&gt;

&lt;p&gt;Should I comment on 8453 also? &lt;/p&gt;

</comment>
                            <comment id="15088510" author="yseeley@gmail.com" created="Thu, 7 Jan 2016 18:00:24 -0700">&lt;p&gt;Yeah, I think we only call sendError in a few places... we could just as easily replace that with another call that consumes any remaining input as well.  We could make it conditional on a query parameter too... this does feel more like a higher level decision (whether to consume all input or not).&lt;/p&gt;
</comment>
                            <comment id="15088674" author="markrmiller@gmail.com" created="Thu, 7 Jan 2016 21:17:32 -0700">&lt;p&gt;I put up a patch in &lt;a href="https://issues.apache.org/jira/browse/SOLR-8453" title="Jetty update from 9.2 to 9.3 causes the server to reset formerly legitimate client connections." class="issue-link" data-issue-key="SOLR-8453"&gt;&lt;del&gt;SOLR-8453&lt;/del&gt;&lt;/a&gt;. I still have to check and see if the tests that consistently failed on at least 1 locales was also due to this or not.&lt;/p&gt;</comment>
                            <comment id="15096870" author="markrmiller@gmail.com" created="Wed, 13 Jan 2016 12:44:13 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8453" title="Jetty update from 9.2 to 9.3 causes the server to reset formerly legitimate client connections." class="issue-link" data-issue-key="SOLR-8453"&gt;&lt;del&gt;SOLR-8453&lt;/del&gt;&lt;/a&gt;  is now committed, I'll check on the Locale issue soon. If that was also somehow related and is no longer a problem, we can go ahead with the update, otherwise we will have to dig in a bit I think.&lt;/p&gt;</comment>
                            <comment id="15149220" author="markrmiller@gmail.com" created="Tue, 16 Feb 2016 13:08:49 -0700">&lt;p&gt;I just tried this out again and had to file &lt;a href="https://issues.apache.org/jira/browse/SOLR-8683" title="Always consume the full request on the server, not just in the case of an error." class="issue-link" data-issue-key="SOLR-8683"&gt;&lt;del&gt;SOLR-8683&lt;/del&gt;&lt;/a&gt;. I think we can upgrade now though.&lt;/p&gt;</comment>
                            <comment id="15149284" author="jira-bot" created="Tue, 16 Feb 2016 14:01:39 -0700">&lt;p&gt;Commit 0bba332549a11d5c381efc93a66087999b6de210 in lucene-solr's branch refs/heads/master from markrmiller&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=0bba332" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=0bba332&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-7339" title="Upgrade Jetty from 9.2 to 9.3" class="issue-link" data-issue-key="SOLR-7339"&gt;&lt;del&gt;SOLR-7339&lt;/del&gt;&lt;/a&gt;: Jetty 9.3 upgrade.&lt;/p&gt;</comment>
                            <comment id="15149316" author="markrmiller@gmail.com" created="Tue, 16 Feb 2016 14:16:53 -0700">&lt;p&gt;Okay, let's see how this works out...&lt;/p&gt;</comment>
                            <comment id="15150465" author="markrmiller@gmail.com" created="Wed, 17 Feb 2016 06:08:43 -0700">&lt;p&gt;Darn, sometimes I'm still seeing connection reset problems. But much rarer.&lt;/p&gt;</comment>
                            <comment id="15150498" author="gregw@webtide.com" created="Wed, 17 Feb 2016 06:32:09 -0700">&lt;p&gt;Yell if there is anything you want us to look at!&lt;/p&gt;</comment>
                            <comment id="15150606" author="markrmiller@gmail.com" created="Wed, 17 Feb 2016 08:00:49 -0700">&lt;p&gt;Well, at least they are repeatable fails.&lt;/p&gt;

&lt;p&gt;Not sure what it is yet, but fails seem to have the following that I don't see in passes:&lt;/p&gt;

&lt;div class="preformatted panel" style="border-width: 1px;"&gt;&lt;div class="preformattedContent panelContent"&gt;
&lt;pre&gt;23813 DEBUG (qtp1185380035-63) [    ] o.e.j.i.ManagedSelector 
java.lang.NoClassDefFoundError: Could not initialize class org.eclipse.jetty.http.HttpParser
	at org.eclipse.jetty.server.HttpConnection.newHttpParser(HttpConnection.java:124)
	at org.eclipse.jetty.server.HttpConnection.&amp;lt;init&amp;gt;(HttpConnection.java:102)
	at org.eclipse.jetty.server.HttpConnectionFactory.newConnection(HttpConnectionFactory.java:58)
	at org.eclipse.jetty.server.ServerConnector$ServerConnectorManager.newConnection(ServerConnector.java:510)
	at org.eclipse.jetty.io.ManagedSelector.createEndPoint(ManagedSelector.java:411)
	at org.eclipse.jetty.io.ManagedSelector.access$1600(ManagedSelector.java:56)
	at org.eclipse.jetty.io.ManagedSelector$CreateEndPoint.run(ManagedSelector.java:587)
	at org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.produceAndRun(ExecuteProduceConsume.java:213)
	at org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.execute(ExecuteProduceConsume.java:101)
	at org.eclipse.jetty.io.ManagedSelector.run(ManagedSelector.java:136)
	at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:654)
	at org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:572)
	at java.lang.Thread.run(Thread.java:745)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15150759" author="joakime" created="Wed, 17 Feb 2016 09:44:15 -0700">&lt;p&gt;From the gut:&lt;/p&gt;

&lt;p&gt;Option 1)&lt;br/&gt;
You have multiple jetty-http.jars, and one of them is really old.&lt;br/&gt;
Unfortunately, your system picked the old one over the new one.&lt;/p&gt;

&lt;p&gt;Option 2)&lt;br/&gt;
You had a fundamental jvm runtime issue preventing that class from being initialized (memory, file descriptors, bad jars, etc..)&lt;br/&gt;
Do you have any other log entries that could indicate this sort of issue?&lt;/p&gt;

&lt;p&gt;Option 3)&lt;br/&gt;
You have a version mismatch between jetty-server.jar and jetty-http.jar&lt;/p&gt;

&lt;p&gt;Option 4)&lt;br/&gt;
You have jetty-http.jar in your WEB-INF/lib and a testcase that flips the WebAppContext loaderPriority improperly&lt;/p&gt;

</comment>
                            <comment id="15153322" author="steve_rowe" created="Thu, 18 Feb 2016 16:18:40 -0700">&lt;p&gt;I'm seeing an uptick in master test failures on my Jenkins, e.g. this run with 21 test failures; skimming they're mostly caused by connection resets: &lt;a href="http://jenkins.sarowe.net/job/Lucene-Solr-tests-trunk/5743/" class="external-link" rel="nofollow"&gt;http://jenkins.sarowe.net/job/Lucene-Solr-tests-trunk/5743/&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15153343" author="markrmiller@gmail.com" created="Thu, 18 Feb 2016 16:37:33 -0700">&lt;p&gt;If it's not isolated test fails and a lot fail it's prob the above issue. &lt;/p&gt;</comment>
                            <comment id="15154269" author="markrmiller@gmail.com" created="Fri, 19 Feb 2016 07:28:09 -0700">&lt;p&gt;I'm going to work on finding what random setting triggers this.&lt;/p&gt;</comment>
                            <comment id="15154285" author="markrmiller@gmail.com" created="Fri, 19 Feb 2016 07:46:53 -0700">&lt;p&gt;Hmm, well this first one I'm looking at does look like it may be a Locale issue after all. If I hardcode ENGLISH locale it passes with my bad test seed.&lt;/p&gt;

&lt;p&gt;And there is an error before the last one I posted that points towards this as well.&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
java.lang.ExceptionInInitializerError
	at org.eclipse.jetty.server.HttpConnection.newHttpParser(HttpConnection.java:124)
	at org.eclipse.jetty.server.HttpConnection.&amp;lt;init&amp;gt;(HttpConnection.java:102)
	at org.eclipse.jetty.server.HttpConnectionFactory.newConnection(HttpConnectionFactory.java:58)
	at org.eclipse.jetty.server.ServerConnector$ServerConnectorManager.newConnection(ServerConnector.java:510)
	at org.eclipse.jetty.io.ManagedSelector.createEndPoint(ManagedSelector.java:411)
	at org.eclipse.jetty.io.ManagedSelector.access$1600(ManagedSelector.java:56)
	at org.eclipse.jetty.io.ManagedSelector$CreateEndPoint.run(ManagedSelector.java:587)
	at org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.produceAndRun(ExecuteProduceConsume.java:213)
	at org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.execute(ExecuteProduceConsume.java:101)
	at org.eclipse.jetty.io.ManagedSelector.run(ManagedSelector.java:136)
	at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:654)
	at org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:572)
	at java.lang.&lt;span class="code-object"&gt;Thread&lt;/span&gt;.run(&lt;span class="code-object"&gt;Thread&lt;/span&gt;.java:745)
Caused by: java.lang.IllegalArgumentException: non ascii character
	at org.eclipse.jetty.util.ArrayTrie.put(ArrayTrie.java:171)
	at org.eclipse.jetty.util.AbstractTrie.put(AbstractTrie.java:45)
	at org.eclipse.jetty.http.HttpParser.&amp;lt;clinit&amp;gt;(HttpParser.java:204)
	... 13 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15155784" author="markrmiller@gmail.com" created="Sat, 20 Feb 2016 15:35:20 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gregw%40webtide.com" class="user-hover" rel="gregw@webtide.com"&gt;Greg Wilkins&lt;/a&gt;, &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=joakime" class="user-hover" rel="joakime"&gt;Joakim Erdfelt&lt;/a&gt;, looks like a default locale bug:&lt;/p&gt;

&lt;p&gt;HttpParser&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
            &lt;span class="code-keyword"&gt;for&lt;/span&gt; (&lt;span class="code-object"&gt;String&lt;/span&gt; charset : &lt;span class="code-keyword"&gt;new&lt;/span&gt; &lt;span class="code-object"&gt;String&lt;/span&gt;[]{&lt;span class="code-quote"&gt;"utf-8"&lt;/span&gt;,&lt;span class="code-quote"&gt;"iso-8859-1"&lt;/span&gt;})
            {
                CACHE.put(&lt;span class="code-keyword"&gt;new&lt;/span&gt; PreEncodedHttpField(HttpHeader.CONTENT_TYPE,type+&lt;span class="code-quote"&gt;";charset="&lt;/span&gt;+charset));
                CACHE.put(&lt;span class="code-keyword"&gt;new&lt;/span&gt; PreEncodedHttpField(HttpHeader.CONTENT_TYPE,type+&lt;span class="code-quote"&gt;"; charset="&lt;/span&gt;+charset));
                CACHE.put(&lt;span class="code-keyword"&gt;new&lt;/span&gt; PreEncodedHttpField(HttpHeader.CONTENT_TYPE,type+&lt;span class="code-quote"&gt;";charset="&lt;/span&gt;+charset.toUpperCase()));
                CACHE.put(&lt;span class="code-keyword"&gt;new&lt;/span&gt; PreEncodedHttpField(HttpHeader.CONTENT_TYPE,type+&lt;span class="code-quote"&gt;"; charset="&lt;/span&gt;+charset.toUpperCase()));
            }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;toUpperCase should use an ENGLISH locale or I guess our project has determined ROOT is better because ENGLISH could change over time. The turkish bug.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;FYI&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;Our project uses this tool to ban default locale method calls: &lt;a href="https://github.com/policeman-tools/forbidden-apis" class="external-link" rel="nofollow"&gt;https://github.com/policeman-tools/forbidden-apis&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href="http://mattryall.net/blog/2009/02/the-infamous-turkish-locale-bug" class="external-link" rel="nofollow"&gt;http://mattryall.net/blog/2009/02/the-infamous-turkish-locale-bug&lt;/a&gt;&lt;br/&gt;
&lt;a href="https://dzone.com/articles/policemans-horror-default" class="external-link" rel="nofollow"&gt;https://dzone.com/articles/policemans-horror-default&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15155805" author="markrmiller@gmail.com" created="Sat, 20 Feb 2016 16:15:50 -0700">&lt;p&gt;Oh, good news. This is already fixed in master and perhaps in a release. I move us up to the latest release.&lt;/p&gt;</comment>
                            <comment id="15155812" author="markrmiller@gmail.com" created="Sat, 20 Feb 2016 16:29:50 -0700">&lt;p&gt;Just looked at the code on GitHub - looks like latest release does not have it. We will need to hop on the next release.&lt;/p&gt;</comment>
                            <comment id="15169942" author="markrmiller@gmail.com" created="Fri, 26 Feb 2016 15:08:17 -0700">&lt;p&gt;Looks like I may have to back this out again for the 6.0 release.&lt;/p&gt;</comment>
                            <comment id="15171695" author="gregw@webtide.com" created="Mon, 29 Feb 2016 03:10:19 -0700">&lt;p&gt;The locale bug has indeed been fixed already and will be in 9.3.8  (and RC0 of this is staged now so the full release should be less than a week away).&lt;/p&gt;</comment>
                            <comment id="15183913" author="steve_rowe" created="Mon, 7 Mar 2016 15:44:19 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gregw%40webtide.com" class="user-hover" rel="gregw@webtide.com"&gt;Greg Wilkins&lt;/a&gt;, any updates about the 9.3.8 release?  It's not final yet AFAICT.&lt;/p&gt;</comment>
                            <comment id="15183951" author="steve_rowe" created="Mon, 7 Mar 2016 16:06:49 -0700">&lt;p&gt;FYI the Jetty commit addressing the Locale problem is here (pushed to master and 9.3.8.RC0 branch): &lt;a href="https://github.com/eclipse/jetty.project/commit/145e4bee7139125408acc7388bf58531e96ae3d7" class="external-link" rel="nofollow"&gt;https://github.com/eclipse/jetty.project/commit/145e4bee7139125408acc7388bf58531e96ae3d7&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15197246" author="shalinmangar" created="Wed, 16 Mar 2016 05:25:01 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com" class="user-hover" rel="markrmiller@gmail.com"&gt;Mark Miller&lt;/a&gt; - are you going to revert this upgrade for 6.0?&lt;/p&gt;</comment>
                            <comment id="15197428" author="markrmiller@gmail.com" created="Wed, 16 Mar 2016 07:48:20 -0700">&lt;p&gt;Was and then wasn't unless someone spoke up and had an issue with it. Have had my head under a rock for a bit.&lt;/p&gt;

&lt;p&gt;Super easy workaround if you are have a turkish locale - just set default locale to english.&lt;/p&gt;
</comment>
                            <comment id="15197500" author="shalinmangar" created="Wed, 16 Mar 2016 08:26:21 -0700">&lt;p&gt;Okay I see. In that case, can you set this as resolved so it is not a blocker anymore?&lt;/p&gt;</comment>
                            <comment id="15197528" author="markrmiller@gmail.com" created="Wed, 16 Mar 2016 08:42:45 -0700">&lt;p&gt;Let's see if anyone has a problem with that.&lt;/p&gt;</comment>
                            <comment id="15198748" author="steve_rowe" created="Wed, 16 Mar 2016 22:03:53 -0700">&lt;p&gt;Jetty 9.3.8.v20160314 was announced yesterday: &lt;a href="http://dev.eclipse.org/mhonarc/lists/jetty-announce/msg00090.html" class="external-link" rel="nofollow"&gt;http://dev.eclipse.org/mhonarc/lists/jetty-announce/msg00090.html&lt;/a&gt;.  Simple patch changing the dep version and switching out the checksums.&lt;/p&gt;

&lt;p&gt;I kicked off Solr tests, but won't check see the results till after I sleep.&lt;/p&gt;

&lt;p&gt;Maybe this can make it for 6.0?&lt;/p&gt;</comment>
                            <comment id="15198787" author="steve_rowe" created="Wed, 16 Mar 2016 22:45:49 -0700">&lt;p&gt;Patch with CHANGES.txt mods.&lt;/p&gt;

&lt;p&gt;All Solr tests and precommit pass.&lt;/p&gt;

&lt;p&gt;I'm going to push to master, branch_6x and branch_6_0.&lt;/p&gt;</comment>
                            <comment id="15198788" author="jira-bot" created="Wed, 16 Mar 2016 22:46:50 -0700">&lt;p&gt;Commit 6ebf61535e90d264755ba72eea9ce51ea89703ff in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe" class="user-hover" rel="steve_rowe"&gt;Steve Rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=6ebf615" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=6ebf615&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-7339" title="Upgrade Jetty from 9.2 to 9.3" class="issue-link" data-issue-key="SOLR-7339"&gt;&lt;del&gt;SOLR-7339&lt;/del&gt;&lt;/a&gt;: Upgrade to Jetty 9.3.8.v20160314&lt;/p&gt;</comment>
                            <comment id="15198790" author="jira-bot" created="Wed, 16 Mar 2016 22:48:21 -0700">&lt;p&gt;Commit b648ce5afae48662e433f204ff501ac01e45cd9a in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe" class="user-hover" rel="steve_rowe"&gt;Steve Rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b648ce5" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b648ce5&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-7339" title="Upgrade Jetty from 9.2 to 9.3" class="issue-link" data-issue-key="SOLR-7339"&gt;&lt;del&gt;SOLR-7339&lt;/del&gt;&lt;/a&gt;: Upgrade to Jetty 9.3.8.v20160314&lt;/p&gt;</comment>
                            <comment id="15198791" author="jira-bot" created="Wed, 16 Mar 2016 22:49:18 -0700">&lt;p&gt;Commit fec14c022c7d4fbca07611560aa54df4aecf991b in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe" class="user-hover" rel="steve_rowe"&gt;Steve Rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=fec14c0" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=fec14c0&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-7339" title="Upgrade Jetty from 9.2 to 9.3" class="issue-link" data-issue-key="SOLR-7339"&gt;&lt;del&gt;SOLR-7339&lt;/del&gt;&lt;/a&gt;: Upgrade to Jetty 9.3.8.v20160314&lt;/p&gt;</comment>
                            <comment id="15201167" author="jira-bot" created="Fri, 18 Mar 2016 01:29:52 -0700">&lt;p&gt;Commit 6ebf61535e90d264755ba72eea9ce51ea89703ff in lucene-solr's branch refs/heads/apiv2 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe" class="user-hover" rel="steve_rowe"&gt;Steve Rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=6ebf615" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=6ebf615&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-7339" title="Upgrade Jetty from 9.2 to 9.3" class="issue-link" data-issue-key="SOLR-7339"&gt;&lt;del&gt;SOLR-7339&lt;/del&gt;&lt;/a&gt;: Upgrade to Jetty 9.3.8.v20160314&lt;/p&gt;</comment>
                            <comment id="15203589" author="jira-bot" created="Sun, 20 Mar 2016 17:43:25 -0700">&lt;p&gt;Commit 6ebf61535e90d264755ba72eea9ce51ea89703ff in lucene-solr's branch refs/heads/jira/&lt;a href="https://issues.apache.org/jira/browse/SOLR-445" title="Update Handlers abort with bad documents" class="issue-link" data-issue-key="SOLR-445"&gt;&lt;del&gt;SOLR-445&lt;/del&gt;&lt;/a&gt; from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe" class="user-hover" rel="steve_rowe"&gt;Steve Rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=6ebf615" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=6ebf615&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-7339" title="Upgrade Jetty from 9.2 to 9.3" class="issue-link" data-issue-key="SOLR-7339"&gt;&lt;del&gt;SOLR-7339&lt;/del&gt;&lt;/a&gt;: Upgrade to Jetty 9.3.8.v20160314&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12822885">SOLR-7442</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12939589">SOLR-8683</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12923550">SOLR-8453</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12648334">SOLR-4839</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12852309">LUCENE-6722</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12857121">SOLR-7943</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12919162">SOLR-8376</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12923434">SOLR-8450</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12923484">SOLR-8451</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12752600">SOLR-6699</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12923285">SOLR-8448</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12921624">SOLR-8413</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12921569">SOLR-8411</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12793923" name="SOLR-7339-jetty-9.3.8.patch" size="12897" author="steve_rowe" created="Wed, 16 Mar 2016 22:45:49 -0700"/>
                            <attachment id="12793918" name="SOLR-7339-jetty-9.3.8.patch" size="12066" author="steve_rowe" created="Wed, 16 Mar 2016 22:03:53 -0700"/>
                            <attachment id="12779577" name="SOLR-7339-revert.patch" size="20681" author="shalinmangar" created="Sun, 27 Dec 2015 02:22:18 -0700"/>
                            <attachment id="12788091" name="SOLR-7339.patch" size="23264" author="markrmiller@gmail.com" created="Tue, 16 Feb 2016 12:44:45 -0700"/>
                            <attachment id="12774886" name="SOLR-7339.patch" size="19287" author="shalinmangar" created="Mon, 30 Nov 2015 13:33:45 -0700"/>
                            <attachment id="12708799" name="SOLR-7339.patch" size="14778" author="greggny3" created="Wed, 1 Apr 2015 14:07:53 -0700"/>
                            <attachment id="12775137" name="SolrExampleStreamingBinaryTest.testUpdateField-jetty92.pcapng" size="12996" author="greggny3" created="Tue, 1 Dec 2015 15:33:17 -0700"/>
                            <attachment id="12775138" name="SolrExampleStreamingBinaryTest.testUpdateField-jetty93.pcapng" size="38376" author="greggny3" created="Tue, 1 Dec 2015 15:33:17 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 1 Apr 2015 20:11:22 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i27nrj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-7010] Remove facet.date client functionality from master</title>
                <link>https://issues.apache.org/jira/browse/SOLR-7010</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;See comments in &lt;a href="https://issues.apache.org/jira/browse/SOLR-6976" title="Remove all methods and classes deprecated in 4.x from trunk and 5.x" class="issue-link" data-issue-key="SOLR-6976"&gt;&lt;del&gt;SOLR-6976&lt;/del&gt;&lt;/a&gt;.  We should log a warning when a client using 5.x includes a facet.date param (both in the solr log, and in the response), and remove the functionality entirely from trunk.&lt;/p&gt;</description>
                <environment/>
        <key id="12768930">SOLR-7010</key>
            <summary>Remove facet.date client functionality from master</summary>
                <type id="3" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/task.png">Task</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="steve_rowe">Steve Rowe</assignee>
                                    <reporter username="romseygeek">Alan Woodward</reporter>
                        <labels>
                    </labels>
                <created>Wed, 21 Jan 2015 02:15:14 -0700</created>
                <updated>Thu, 3 Mar 2016 12:43:41 -0700</updated>
                            <resolved>Thu, 3 Mar 2016 12:43:41 -0700</resolved>
                                                    <fixVersion>6.0</fixVersion>
                    <fixVersion>master</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="15173159" author="steve_rowe" created="Mon, 29 Feb 2016 20:10:18 -0700">&lt;p&gt;First cut at a patch.  Haven't fully compiled/tested yet.&lt;/p&gt;

&lt;p&gt;AFAICT we never provided deprecation warnings on responses in 5.x, but does that mean we should wait until 7.0 before we finally remove facet.date stuff?&lt;/p&gt;</comment>
                            <comment id="15173216" author="shalinmangar" created="Mon, 29 Feb 2016 21:36:57 -0700">&lt;p&gt;facet.date was deprecated in 3.1.0, I think we should just remove them completely.&lt;/p&gt;</comment>
                            <comment id="15173987" author="steve_rowe" created="Tue, 1 Mar 2016 09:34:38 -0700">&lt;p&gt;Patch, fixes a few failing tests and adds a CHANGES.txt entry.&lt;/p&gt;

&lt;p&gt;Tests and precommit pass.&lt;/p&gt;

&lt;p&gt;I think it's ready to go.  If there are no objections I'll commit later today.&lt;/p&gt;</comment>
                            <comment id="15173991" author="steve_rowe" created="Tue, 1 Mar 2016 09:38:32 -0700">&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="15178451" author="jira-bot" created="Thu, 3 Mar 2016 12:35:04 -0700">&lt;p&gt;Commit d0279b8d5f6c2b4a640ac4738d63a1da0cd79005 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe" class="user-hover" rel="steve_rowe"&gt;Steve Rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d0279b8" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d0279b8&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-7010" title="Remove facet.date client functionality from master" class="issue-link" data-issue-key="SOLR-7010"&gt;&lt;del&gt;SOLR-7010&lt;/del&gt;&lt;/a&gt;: Remove facet.date client functionality&lt;/p&gt;</comment>
                            <comment id="15178468" author="jira-bot" created="Thu, 3 Mar 2016 12:40:48 -0700">&lt;p&gt;Commit d0d75c448ed78b928af3c8f20ded210ce102d4d4 in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe" class="user-hover" rel="steve_rowe"&gt;Steve Rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d0d75c4" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d0d75c4&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-7010" title="Remove facet.date client functionality from master" class="issue-link" data-issue-key="SOLR-7010"&gt;&lt;del&gt;SOLR-7010&lt;/del&gt;&lt;/a&gt;: Remove facet.date client functionality&lt;/p&gt;</comment>
                            <comment id="15178475" author="jira-bot" created="Thu, 3 Mar 2016 12:43:20 -0700">&lt;p&gt;Commit 79a7008b7206123821367e78b95ff2b86ae308a3 in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe" class="user-hover" rel="steve_rowe"&gt;Steve Rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=79a7008" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=79a7008&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-7010" title="Remove facet.date client functionality from master" class="issue-link" data-issue-key="SOLR-7010"&gt;&lt;del&gt;SOLR-7010&lt;/del&gt;&lt;/a&gt;: Remove facet.date client functionality&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12790744" name="SOLR-7010.patch" size="51951" author="steve_rowe" created="Tue, 1 Mar 2016 09:34:38 -0700"/>
                            <attachment id="12790651" name="SOLR-7010.patch" size="50986" author="steve_rowe" created="Mon, 29 Feb 2016 20:10:18 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 1 Mar 2016 03:10:18 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i24ltr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-6622] Issue with Multivalued fields when using UIMA</title>
                <link>https://issues.apache.org/jira/browse/SOLR-6622</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;When using any of UIMA addons on a multivalued fields, only the first row of the field gets processed and UIMA update ignores the remaining rows. &lt;br/&gt;
This bug caused by "getTextsToAnalyze" method in "UIMAUpdateRequestProcessor" class. SolrInputDocument&lt;br/&gt;
            .getFieldValue  must be changes to olrInputDocument&lt;br/&gt;
            .getFieldValues and the result must be an array not a single variable.&lt;/p&gt;</description>
                <environment/>
        <key id="12748054">SOLR-6622</key>
            <summary>Issue with Multivalued fields when using UIMA</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="teofili">Tommaso Teofili</assignee>
                                    <reporter username="mkhordad">Maryam Khordad</reporter>
                        <labels>
                    </labels>
                <created>Tue, 14 Oct 2014 08:04:57 -0700</created>
                <updated>Wed, 23 Mar 2016 01:43:56 -0700</updated>
                            <resolved>Mon, 11 Jan 2016 01:18:03 -0700</resolved>
                                    <version>master</version>
                                    <fixVersion>5.5</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>contrib - UIMA</component>
                        <due/>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="14171030" author="mkhordad" created="Tue, 14 Oct 2014 08:07:46 -0700">&lt;p&gt;I fixed this problem and I can contribute a patch.&lt;/p&gt;</comment>
                            <comment id="14171113" author="steffkes" created="Tue, 14 Oct 2014 09:10:09 -0700">&lt;p&gt;Great &lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/smile.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt; There is a little how-to in case you need more information: &lt;a href="http://wiki.apache.org/solr/HowToContribute" class="external-link" rel="nofollow"&gt;http://wiki.apache.org/solr/HowToContribute&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15089815" author="toldev" created="Fri, 8 Jan 2016 12:44:40 -0700">&lt;p&gt;This patch also fixes the issue I reported in &lt;a href="https://issues.apache.org/jira/browse/SOLR-8528" class="external-link" rel="nofollow"&gt;https://issues.apache.org/jira/browse/SOLR-8528&lt;/a&gt; , I just tested it. Would be nice if the patch could be committed to Solr.&lt;/p&gt;</comment>
                            <comment id="15091581" author="jira-bot" created="Mon, 11 Jan 2016 01:12:38 -0700">&lt;p&gt;Commit 1723982 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=teofili" class="user-hover" rel="teofili"&gt;Tommaso Teofili&lt;/a&gt; in branch 'dev/trunk'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1723982" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1723982&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-6622" title="Issue with Multivalued fields when using UIMA" class="issue-link" data-issue-key="SOLR-6622"&gt;&lt;del&gt;SOLR-6622&lt;/del&gt;&lt;/a&gt; - using all field values in UIMAUpdateRequestProcessor&lt;/p&gt;</comment>
                            <comment id="15091585" author="jira-bot" created="Mon, 11 Jan 2016 01:16:46 -0700">&lt;p&gt;Commit 1723983 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=teofili" class="user-hover" rel="teofili"&gt;Tommaso Teofili&lt;/a&gt; in branch 'dev/branches/branch_5x'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1723983" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1723983&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-6622" title="Issue with Multivalued fields when using UIMA" class="issue-link" data-issue-key="SOLR-6622"&gt;&lt;del&gt;SOLR-6622&lt;/del&gt;&lt;/a&gt; - using all field values in UIMAUpdateRequestProcessor&lt;/p&gt;</comment>
                            <comment id="15091589" author="teofili" created="Mon, 11 Jan 2016 01:18:03 -0700">&lt;p&gt;thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=toldev" class="user-hover" rel="toldev"&gt;Tomasz Oliwa&lt;/a&gt;, I've committed your patch to trunk and lucene 5x branch.&lt;/p&gt;</comment>
                            <comment id="15187456" author="toldev" created="Wed, 9 Mar 2016 10:28:15 -0700">&lt;p&gt;In &lt;a href="https://issues.apache.org/jira/browse/SOLR-8528" class="external-link" rel="nofollow"&gt;https://issues.apache.org/jira/browse/SOLR-8528&lt;/a&gt; a user sees this bug re-appear in 5.5.0.&lt;/p&gt;

&lt;p&gt;I just did a diff between the UIMAUpdateRequestProcessor.java of 5.4.1, the 5.4.1 with patch and 5.5.0&lt;/p&gt;

&lt;p&gt;There are some additional changes from 5.4.1 with patch to 5.5.0 that might have regressed this issue again.&lt;/p&gt;</comment>
                            <comment id="15188743" author="srini_iiit" created="Wed, 9 Mar 2016 23:07:06 -0700">&lt;p&gt;Here's the issue I'm having.&lt;/p&gt;

&lt;p&gt;&lt;a href="http://mail-archives.apache.org/mod_mbox/lucene-solr-user/201603.mbox/%3CCADvZL4qaWsBv%3DrX6Bu%3DtFtJMd1p50RU-wHhCrCQqeuKSEJj6YQ%40mail.gmail.com%3E" class="external-link" rel="nofollow"&gt;http://mail-archives.apache.org/mod_mbox/lucene-solr-user/201603.mbox/%3CCADvZL4qaWsBv%3DrX6Bu%3DtFtJMd1p50RU-wHhCrCQqeuKSEJj6YQ%40mail.gmail.com%3E&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15195808" author="toldev" created="Tue, 15 Mar 2016 10:59:44 -0700">&lt;p&gt;If you apply patch &lt;a href="https://issues.apache.org/jira/browse/SOLR-6622" title="Issue with Multivalued fields when using UIMA" class="issue-link" data-issue-key="SOLR-6622"&gt;&lt;del&gt;SOLR-6622&lt;/del&gt;&lt;/a&gt;.patch to Solr 5.4.1 and use this patched Solr 5.4.1, does this problem still appear? This could tell if the problem is a regression or a separate case. Could you test it?&lt;/p&gt;</comment>
                            <comment id="15208081" author="srini_iiit" created="Wed, 23 Mar 2016 01:43:56 -0700">&lt;p&gt;origin/branch_5_5 contains the patch and works without any issues.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310361">
                    <name>Blocked</name>
                                            <outwardlinks description="Blocked">
                                        <issuelink>
            <issuekey id="12928717">SOLR-8528</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12675014" name="SOLR-6622.patch" size="2079" author="mkhordad" created="Wed, 15 Oct 2014 08:14:52 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 14 Oct 2014 16:10:09 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i215p3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-6594] deprecate the one action only APIs for schema editing</title>
                <link>https://issues.apache.org/jira/browse/SOLR-6594</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;with &lt;a href="https://issues.apache.org/jira/browse/SOLR-6476" title="Create a bulk mode for schema API" class="issue-link" data-issue-key="SOLR-6476"&gt;&lt;del&gt;SOLR-6476&lt;/del&gt;&lt;/a&gt; done and committed , we have more than one way of writing to schema . Having two different ways of doing the same thing is counter productive . &lt;/p&gt;

&lt;p&gt;I would like to mark them as deprecated and the calls to those APIs will succeed but will give a deprecation message in the output.  The read APIs would continue to be the same , though .&lt;/p&gt;

&lt;p&gt;Details: the following operations have been deprecated as of Solr 5.5, and support for them will be removed in Solr 6.0: &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Create new field(s): POST to &lt;tt&gt;/&lt;em&gt;collection&lt;/em&gt;/schema/fields&lt;/tt&gt; or PUT to &lt;tt&gt;/&lt;em&gt;collection&lt;/em&gt;/schema/fields/&lt;em&gt;fieldname&lt;/em&gt;&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;Create new dynamic field(s): POST to &lt;tt&gt;/&lt;em&gt;collection&lt;/em&gt;/schema/dynamicfields&lt;/tt&gt; or PUT to &lt;tt&gt;/&lt;em&gt;collection&lt;/em&gt;/schema/dynamicfields/&lt;em&gt;glob&lt;/em&gt;&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;Create new field type(s): POST to &lt;tt&gt;/&lt;em&gt;collection&lt;/em&gt;/schema/fieldtypes&lt;/tt&gt; or PUT to &lt;tt&gt;/&lt;em&gt;collection&lt;/em&gt;/schema/fieldtypes/&lt;em&gt;name&lt;/em&gt;&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;Create new copyField rule(s): POST to &lt;tt&gt;/&lt;em&gt;collection&lt;/em&gt;/schema/copyfields&lt;/tt&gt;.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Note that all of the above operations can instead be performed using the bulk schema API, documented since the 5.0 Solr ref guide here: &lt;a href="https://cwiki.apache.org/confluence/display/solr/Schema+API" class="external-link" rel="nofollow"&gt;https://cwiki.apache.org/confluence/display/solr/Schema+API&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To be clear, read-only GET operations on the above-mentioned endpoints will not be changed, deprecated or removed - they will continue to return information about fields, dynamicFields, fieldTypes, and copyField rules, respectively.&lt;/p&gt;</description>
                <environment/>
        <key id="12746194">SOLR-6594</key>
            <summary>deprecate the one action only APIs for schema editing</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="noble.paul">Noble Paul</reporter>
                        <labels>
                    </labels>
                <created>Mon, 6 Oct 2014 10:14:56 -0700</created>
                <updated>Thu, 25 Feb 2016 05:58:12 -0700</updated>
                            <resolved>Tue, 9 Feb 2016 16:26:06 -0700</resolved>
                                                    <fixVersion>5.5</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                <comments>
                            <comment id="14169268" author="shalinmangar" created="Mon, 13 Oct 2014 06:14:33 -0700">&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;We are close to a 5.0 release so we should start deprecating the other APIs.&lt;/p&gt;</comment>
                            <comment id="14171108" author="steve_rowe" created="Tue, 14 Oct 2014 09:04:21 -0700">&lt;p&gt;I think it would be very weird from the Schema API consumers' POV to &lt;b&gt;remove&lt;/b&gt; existing write access while leaving read access in place for the fine-grained endpoints.&lt;/p&gt;

&lt;p&gt;Also, having separate read- and write-side REST API endpoints seems bad to me.&lt;/p&gt;</comment>
                            <comment id="14171219" author="noble.paul" created="Tue, 14 Oct 2014 10:05:12 -0700">&lt;p&gt;There are already many end points in schema API which are not editable . It is OK in REST to have some end points which are GET only and other 'verbs' are disabled . &lt;/p&gt;

&lt;p&gt;I would even go as far to say that the individual end points were made necessary because of the write path requirements. Users would not find it a lot difficult to extract the required data from the whole schema also.  &lt;/p&gt;

&lt;p&gt;It may be more weird to have multiple ways to perform the exact same operation. It will put a heavy burden on future developers to ensure that the same functionality is implemented in both end points and they are also consistent. &lt;/p&gt;

&lt;p&gt;I can't imagine what value add will a user get in doing the following &lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
curl http:&lt;span class="code-comment"&gt;//localhost:8983/solr/collection1/schema/fields -X POST -H 'Content-type:application/json' --data-binary '
&lt;/span&gt;[
    {
        &lt;span class="code-quote"&gt;"name"&lt;/span&gt;:&lt;span class="code-quote"&gt;"department"&lt;/span&gt;,
        &lt;span class="code-quote"&gt;"type"&lt;/span&gt;:&lt;span class="code-quote"&gt;"string"&lt;/span&gt;,
        &lt;span class="code-quote"&gt;"docValues"&lt;/span&gt;:&lt;span class="code-quote"&gt;"&lt;span class="code-keyword"&gt;true&lt;/span&gt;"&lt;/span&gt;,
        &lt;span class="code-quote"&gt;"&lt;span class="code-keyword"&gt;default&lt;/span&gt;"&lt;/span&gt;:&lt;span class="code-quote"&gt;"no department"&lt;/span&gt;,
        &lt;span class="code-quote"&gt;"copyFields"&lt;/span&gt;: [ &lt;span class="code-quote"&gt;"catchall"&lt;/span&gt; ]
    }
]'
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;instead of&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
curl http:&lt;span class="code-comment"&gt;//localhost:8983/solr/collection1/schema -X POST -H 'Content-type:application/json' --data-binary '
&lt;/span&gt;{
    &lt;span class="code-quote"&gt;"add-field"&lt;/span&gt; : {
        &lt;span class="code-quote"&gt;"name"&lt;/span&gt;:&lt;span class="code-quote"&gt;"department"&lt;/span&gt;,
        &lt;span class="code-quote"&gt;"type"&lt;/span&gt;:&lt;span class="code-quote"&gt;"string"&lt;/span&gt;,
        &lt;span class="code-quote"&gt;"docValues"&lt;/span&gt;:&lt;span class="code-quote"&gt;"&lt;span class="code-keyword"&gt;true&lt;/span&gt;"&lt;/span&gt;,
        &lt;span class="code-quote"&gt;"&lt;span class="code-keyword"&gt;default&lt;/span&gt;"&lt;/span&gt;:&lt;span class="code-quote"&gt;"no department"&lt;/span&gt;,
        &lt;span class="code-quote"&gt;"copyFields"&lt;/span&gt;: [ &lt;span class="code-quote"&gt;"catchall"&lt;/span&gt; ]
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I would say this is more code (25 java files) to maintain for the future developers and more APIs to support. &lt;/p&gt;</comment>
                            <comment id="14172730" author="shalinmangar" created="Wed, 15 Oct 2014 11:28:48 -0700">&lt;p&gt;I believe that a simple bulk API can satisfy all requirements for a schema API and we should no longer attempt to have additional fine-grained end points for writes. I am not against fine-grained read endpoints but even that can be satisfied by a bulk API which allows filtering. In future, I wouldn't want to write/maintain APIs for bulk and individual operations &amp;#8211; I'm assuming a config API will probably add at least ten fine-grained APIs if we go that way.&lt;/p&gt;</comment>
                            <comment id="14210187" author="thelabdude" created="Thu, 13 Nov 2014 12:21:02 -0700">&lt;p&gt;+1 ... I'd like to see the code get cleaned up to just use the bulk API with a "shim" that maps the old endpoints to the bulk API automatically. The shim should be deprecated but left in-place for a while existing apps that use the specific endpoints and responses from the fine-grained endpoints should include a deprecation warning.&lt;/p&gt;

&lt;p&gt;New functionality should only be implemented in the bulk API.&lt;/p&gt;</comment>
                            <comment id="15139980" author="jira-bot" created="Tue, 9 Feb 2016 16:13:01 -0700">&lt;p&gt;Commit 2184a7baf6e47f99b7a637836a736c3439b69125 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=2184a7b" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=2184a7b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-6594" title="deprecate the one action only APIs for schema editing" class="issue-link" data-issue-key="SOLR-6594"&gt;&lt;del&gt;SOLR-6594&lt;/del&gt;&lt;/a&gt; Mark old schema APIs as deprecated&lt;/p&gt;</comment>
                            <comment id="15139986" author="jira-bot" created="Tue, 9 Feb 2016 16:23:30 -0700">&lt;p&gt;Commit 890497b08184688361d0e9c2dd0725d9117dca12 in lucene-solr's branch refs/heads/branch_5x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul" class="user-hover" rel="noble.paul"&gt;Noble Paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=890497b" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=890497b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-6594" title="deprecate the one action only APIs for schema editing" class="issue-link" data-issue-key="SOLR-6594"&gt;&lt;del&gt;SOLR-6594&lt;/del&gt;&lt;/a&gt; Mark old schema APIs as deprecated&lt;/p&gt;</comment>
                            <comment id="15167167" author="noble.paul" created="Thu, 25 Feb 2016 05:58:12 -0700">&lt;blockquote&gt;&lt;p&gt;To be clear, read-only GET operations on the above-mentioned endpoints will not be changed, deprecated or removed - they will continue to return information about fields, dynamicFields, fieldTypes, and copyField rules, respectively.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We need to add these support . I have opened &lt;a href="https://issues.apache.org/jira/browse/SOLR-8736" title="GET operations on fields, dynamicFields, fieldTypes, copyField should work" class="issue-link" data-issue-key="SOLR-8736"&gt;&lt;del&gt;SOLR-8736&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12938035">SOLR-8667</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 13 Oct 2014 13:14:33 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i20ujj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-5730] make Lucene's SortingMergePolicy and EarlyTerminatingSortingCollector configurable in Solr</title>
                <link>https://issues.apache.org/jira/browse/SOLR-5730</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;&lt;b&gt;Example configuration (solrconfig.xml) :&lt;/b&gt;&lt;/p&gt;
&lt;div class="preformatted panel" style="border-width: 1px;"&gt;&lt;div class="preformattedContent panelContent"&gt;
&lt;pre&gt;-&amp;lt;mergePolicy class="TieredMergePolicy"/&amp;gt;
+&amp;lt;mergePolicyFactory class="org.apache.solr.index.SortingMergePolicyFactory"&amp;gt;
+  &amp;lt;str name="wrapped.prefix"&amp;gt;in&amp;lt;/str&amp;gt;
+  &amp;lt;str name="in.class"&amp;gt;org.apache.solr.index.TieredMergePolicyFactory&amp;lt;/str&amp;gt;
+  &amp;lt;str name="sort"&amp;gt;timestamp desc&amp;lt;/str&amp;gt;
+&amp;lt;/mergePolicyFactory&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;b&gt;Example use (EarlyTerminatingSortingCollector):&lt;/b&gt;&lt;/p&gt;
&lt;div class="preformatted panel" style="border-width: 1px;"&gt;&lt;div class="preformattedContent panelContent"&gt;
&lt;pre&gt;&amp;amp;sort=timestamp+desc&amp;amp;segmentTerminateEarly=true
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment/>
        <key id="12695221">SOLR-5730</key>
            <summary>make Lucene's SortingMergePolicy and EarlyTerminatingSortingCollector configurable in Solr</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cpoerschke">Christine Poerschke</assignee>
                                    <reporter username="cpoerschke">Christine Poerschke</reporter>
                        <labels>
                    </labels>
                <created>Fri, 14 Feb 2014 07:44:27 -0700</created>
                <updated>Fri, 8 Apr 2016 10:49:15 -0700</updated>
                            <resolved>Mon, 15 Feb 2016 11:39:26 -0700</resolved>
                                                    <fixVersion>6.0</fixVersion>
                    <fixVersion>master</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>10</watches>
                                                                <comments>
                            <comment id="13901482" author="githubbot" created="Fri, 14 Feb 2014 07:45:01 -0700">&lt;p&gt;GitHub user cpoerschke opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href="https://github.com/apache/lucene-solr/pull/31" class="external-link" rel="nofollow"&gt;https://github.com/apache/lucene-solr/pull/31&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    make SortingMergePolicy and EarlyTerminatingSortingCollector configurable&lt;/p&gt;


&lt;p&gt;    For &lt;a href="https://issues.apache.org/jira/i#browse/SOLR-5730" class="external-link" rel="nofollow"&gt;https://issues.apache.org/jira/i#browse/SOLR-5730&lt;/a&gt; ticket.&lt;/p&gt;

&lt;p&gt;    Also for the first 2 of the 5 ideas on &lt;a href="https://issues.apache.org/jira/i#browse/SOLR-4654" class="external-link" rel="nofollow"&gt;https://issues.apache.org/jira/i#browse/SOLR-4654&lt;/a&gt; ticket.&lt;/p&gt;


&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href="https://github.com/apache/lucene-solr" class="external-link" rel="nofollow"&gt;https://github.com/apache/lucene-solr&lt;/a&gt; branch_4x-etsc-solr&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href="https://github.com/apache/lucene-solr/pull/31.patch" class="external-link" rel="nofollow"&gt;https://github.com/apache/lucene-solr/pull/31.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #31&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit d45f8126ed8985ab085b989eed176eddddd9a694&lt;br/&gt;
Author: Christine Poerschke &amp;lt;cpoerschke@bloomberg.net&amp;gt;&lt;br/&gt;
Date:   2014-02-14T13:58:38Z&lt;/p&gt;

&lt;p&gt;    make Lucene's SortingMergePolicy and EarlyTerminatingSortingCollector configurable in Solr&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="13901520" author="cpoerschke" created="Fri, 14 Feb 2014 08:00:18 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/i#browse/LUCENE-5445" class="external-link" rel="nofollow"&gt;https://issues.apache.org/jira/i#browse/LUCENE-5445&lt;/a&gt; and associated github pull request are related here (ASF GitHub Bot seemingly only updated the first of the tickets mentioned in the pull request comments).&lt;/p&gt;</comment>
                            <comment id="13909443" author="elyograg" created="Sat, 22 Feb 2014 10:14:15 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cpoerschke" class="user-hover" rel="cpoerschke"&gt;Christine Poerschke&lt;/a&gt;, are you in a position to build a test that makes sure everything does what it's expected to do, ideally when the new feature is disabled as well as enabled?  I'm evaluating whether or not I can take this issue on.  My understanding of how to use Lucene is pretty low, and I'm a little wobbly on crafting new tests.&lt;/p&gt;</comment>
                            <comment id="13911571" author="cpoerschke" created="Tue, 25 Feb 2014 06:42:59 -0700">&lt;p&gt;Hi Shawn, yes i'm having a go at building tests for this. So far a new TestMergePolicyConfigWithMergeSorter based on the existing TestMergePolicyConfig, and tests for the IndexSchema and searching changes would be on the todo list too.&lt;/p&gt;</comment>
                            <comment id="13923920" author="rcmuir" created="Fri, 7 Mar 2014 07:38:25 -0700">&lt;p&gt;Hello, some things that might simplify some of the TODOs, is we changed the SortingMergePolicy API in &lt;a href="https://issues.apache.org/jira/browse/LUCENE-5493" title="Rename Sorter, NumericDocValuesSorter, and fix javadocs" class="issue-link" data-issue-key="LUCENE-5493"&gt;&lt;del&gt;LUCENE-5493&lt;/del&gt;&lt;/a&gt; to just take Sort.&lt;/p&gt;

&lt;p&gt;This means you can have multiple fields, they dont have to be numeric docvalues, and so on. So I think this can simplify the configuration of this thing too, e.g. you could just take a standard "sort spec string" and parse it with QueryParsing.getSort or whatever (some refactoring might be needed here). &lt;/p&gt;

&lt;p&gt;It would be good though, to check that Sort.needsScores() == false, as that makes no sense at index-time... I'll open an issue to add this check to SortingMergePolicy itself in lucene.&lt;/p&gt;

&lt;p&gt;The other difference is, EarlyTerminatingSortingCollector now also takes a Sort, except really you should just pass the Sort being used for the Query (it does the proper checking against the segments to see if the segment was sorted in a compatible way, and if so, will optimize with early termination). Today this just checks that they are exactly equal, but in the future it can be smarter (&lt;a href="https://issues.apache.org/jira/browse/LUCENE-5499" title="EarlyTerminatingSortingCollector shouldnt require exact Sort match" class="issue-link" data-issue-key="LUCENE-5499"&gt;LUCENE-5499&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;Hopefully this makes the integration easier.&lt;/p&gt;</comment>
                            <comment id="14608888" author="githubbot" created="Tue, 30 Jun 2015 12:10:54 -0700">&lt;p&gt;GitHub user cpoerschke opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href="https://github.com/apache/lucene-solr/pull/176" class="external-link" rel="nofollow"&gt;https://github.com/apache/lucene-solr/pull/176&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;span class="error"&gt;&amp;#91;incomplete&amp;#93;&lt;/span&gt; &lt;a href="https://issues.apache.org/jira/browse/SOLR-5730" title="make Lucene&amp;#39;s SortingMergePolicy and EarlyTerminatingSortingCollector configurable in Solr" class="issue-link" data-issue-key="SOLR-5730"&gt;&lt;del&gt;SOLR-5730&lt;/del&gt;&lt;/a&gt;: make SortingMergePolicy/EarlyTerminatingSortingCollector configurable&lt;/p&gt;

&lt;p&gt;    incomplete. for &lt;a href="https://issues.apache.org/jira/i#browse/SOLR-5730" class="external-link" rel="nofollow"&gt;https://issues.apache.org/jira/i#browse/SOLR-5730&lt;/a&gt; ticket.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href="https://github.com/bloomberg/lucene-solr" class="external-link" rel="nofollow"&gt;https://github.com/bloomberg/lucene-solr&lt;/a&gt; trunk-sort-outline&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href="https://github.com/apache/lucene-solr/pull/176.patch" class="external-link" rel="nofollow"&gt;https://github.com/apache/lucene-solr/pull/176.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #176&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 5984692c660b32ddec0260e5a096b7b7eea5ea8d&lt;br/&gt;
Author: Christine Poerschke &amp;lt;cpoerschke@bloomberg.net&amp;gt;&lt;br/&gt;
Date:   2015-06-29T15:02:44Z&lt;/p&gt;

&lt;p&gt;    LUCENE-????: support SortingMergePolicy-free use of EarlyTerminatingSortingCollector&lt;/p&gt;

&lt;p&gt;    motivation:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-5730" title="make Lucene&amp;#39;s SortingMergePolicy and EarlyTerminatingSortingCollector configurable in Solr" class="issue-link" data-issue-key="SOLR-5730"&gt;&lt;del&gt;SOLR-5730&lt;/del&gt;&lt;/a&gt; to make Lucene's SortingMergePolicy and EarlyTerminatingSortingCollector configurable in Solr.&lt;/li&gt;
	&lt;li&gt;outline of draft &lt;a href="https://issues.apache.org/jira/browse/SOLR-5730" title="make Lucene&amp;#39;s SortingMergePolicy and EarlyTerminatingSortingCollector configurable in Solr" class="issue-link" data-issue-key="SOLR-5730"&gt;&lt;del&gt;SOLR-5730&lt;/del&gt;&lt;/a&gt; changes:&lt;br/&gt;
       + SolrIndexWriter constructor calls SolrIndexConfig.toIndexWriterConfig (passing the result to its lucene.IndexWriter super class)&lt;br/&gt;
       + SolrIndexConfig.toIndexWriterConfig(SolrCore core) calls SolrIndexConfig.buildMergePolicy&lt;br/&gt;
       + SolrIndexConfig.buildMergePolicy(IndexSchema schema) calls the SortingMergePolicy constructor (using the IndexSchema's mergeSortSpec)&lt;br/&gt;
       + SolrIndexSearcher.buildAndRunCollectorChain calls the EarlyTerminatingSortingCollector constructor (using the IndexSchema's mergeSortSpec)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    summary of changes:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;added static isSorted variant to SortingMergePolicy&lt;/li&gt;
	&lt;li&gt;added SortingMergePolicy-free EarlyTerminatingSortingCollector constructor variant&lt;/li&gt;
	&lt;li&gt;added SortingMergePolicy-free EarlyTerminatingSortingCollector.canEarlyTerminate variant&lt;/li&gt;
	&lt;li&gt;corresponding changes to TestEarlyTerminatingSortingCollector (randomly choose between constructor and canEarlyTerminate variants)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;commit 78de6620a9f50ab632c1fc240a336137acf9199f&lt;br/&gt;
Author: Christine Poerschke &amp;lt;cpoerschke@bloomberg.net&amp;gt;&lt;br/&gt;
Date:   2015-06-29T14:22:29Z&lt;/p&gt;

&lt;p&gt;    &lt;span class="error"&gt;&amp;#91;incomplete&amp;#93;&lt;/span&gt; &lt;a href="https://issues.apache.org/jira/browse/SOLR-5730" title="make Lucene&amp;#39;s SortingMergePolicy and EarlyTerminatingSortingCollector configurable in Solr" class="issue-link" data-issue-key="SOLR-5730"&gt;&lt;del&gt;SOLR-5730&lt;/del&gt;&lt;/a&gt;: make Lucene's SortingMergePolicy and EarlyTerminatingSortingCollector configurable in Solr&lt;/p&gt;

&lt;p&gt;    summary of changes so far:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;schema.xml: added optional mergeSortSpec field to &lt;span class="error"&gt;&amp;#91;Managed&amp;#93;&lt;/span&gt;IndexSchema&lt;/li&gt;
	&lt;li&gt;solrconfig.xml: SolrIndexConfig.buildMergePolicy to constructs a SortingMergePolicy if the useSortingMergePolicy flag is set&lt;/li&gt;
	&lt;li&gt;optional segmentTerminateEarly parameter added to CommonParams and QueryComponent (defaulted to existing behaviour)&lt;/li&gt;
	&lt;li&gt;SolrIndexSearcher: constructs EarlyTerminatingSortingCollector if segmentTerminateEarly flag is set (and requested sort is compatible with the mergeSortSpec)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    still incomplete:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;IndexSchema: convert/parse 'String mergeSortSpecString;' into 'SortSpec mergeSortSpec;'&lt;/li&gt;
	&lt;li&gt;queryResult caching to consider the segmentTerminateEarly flag (a segmentTerminateEarly=false search should not get cached results from a segmentTerminateEarly=true search)&lt;/li&gt;
	&lt;li&gt;documentation/example for the segmentTerminateEarly query parameter (and the new optional schema.xml/solrconfig.xml elements)&lt;/li&gt;
	&lt;li&gt;test cases&lt;/li&gt;
&lt;/ul&gt;


&lt;hr /&gt;</comment>
                            <comment id="14608899" author="cpoerschke" created="Tue, 30 Jun 2015 12:20:45 -0700">&lt;p&gt;Uploaded &lt;a href="https://github.com/apache/lucene-solr/pull/176" class="external-link" rel="nofollow"&gt;incomplete rebased-against-current-trunk changes&lt;/a&gt; and updated example configuration to match. The proposed solr changes require the changes proposed in &lt;a href="https://issues.apache.org/jira/browse/LUCENE-6646" title="make the EarlyTerminatingSortingCollector constructor SortingMergePolicy-free" class="issue-link" data-issue-key="LUCENE-6646"&gt;&lt;del&gt;LUCENE-6646&lt;/del&gt;&lt;/a&gt; because at the point that solr needs to construct an &lt;tt&gt;EarlyTerminatingSortingCollector&lt;/tt&gt; object it doesn't have access to the &lt;tt&gt;SortingMergePolicy&lt;/tt&gt; in use, commit message about has further details.&lt;/p&gt;</comment>
                            <comment id="15002585" author="cpoerschke" created="Thu, 12 Nov 2015 11:27:55 -0700">&lt;p&gt;Making the &lt;tt&gt;SortingMergePolicy&lt;/tt&gt; configurable means that the &lt;tt&gt;SortSpec&lt;/tt&gt; configured needs to be parsed. &lt;a href="https://issues.apache.org/jira/browse/SOLR-8283" title="factor out SortSpecParsing[Test] from QueryParsing[Test]" class="issue-link" data-issue-key="SOLR-8283"&gt;&lt;del&gt;SOLR-8283&lt;/del&gt;&lt;/a&gt; intends to factor out &lt;tt&gt;SortSpecParsing[Test]&lt;/tt&gt; from &lt;tt&gt;QueryParsing[Test]&lt;/tt&gt; to help with this.&lt;/p&gt;</comment>
                            <comment id="15109261" author="cpoerschke" created="Wed, 20 Jan 2016 12:43:26 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-5730" title="make Lucene&amp;#39;s SortingMergePolicy and EarlyTerminatingSortingCollector configurable in Solr" class="issue-link" data-issue-key="SOLR-5730"&gt;&lt;del&gt;SOLR-5730&lt;/del&gt;&lt;/a&gt;: make Lucene's SortingMergePolicy configurable in Solr&lt;/p&gt;

&lt;p&gt;Example configuration:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;solrconfig.xml &lt;tt&gt;&amp;lt;useSortingMergePolicy&amp;gt;true&amp;lt;/useSortingMergePolicy&amp;gt;&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;schema.xml &lt;tt&gt;&amp;lt;mergeSortSpec&amp;gt;timestamp desc&amp;lt;/mergeSortSpec&amp;gt;&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15109265" author="cpoerschke" created="Wed, 20 Jan 2016 12:45:01 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-5730" title="make Lucene&amp;#39;s SortingMergePolicy and EarlyTerminatingSortingCollector configurable in Solr" class="issue-link" data-issue-key="SOLR-5730"&gt;&lt;del&gt;SOLR-5730&lt;/del&gt;&lt;/a&gt;: optional segmentTerminateEarly=(false|true) parameter (to allow use of Lucene's EarlyTerminatingSortingCollector)&lt;/p&gt;

&lt;p&gt;If &lt;tt&gt;segmentTerminateEarly=true&lt;/tt&gt; parameter is passed then Lucene's EarlyTerminatingSortingCollector will be used for ungrouped queries whose &lt;tt&gt;sort&lt;/tt&gt; parameter is compatible with the &amp;lt;mergeSortSpec&amp;gt; configured in the schema.xml.&lt;/p&gt;</comment>
                            <comment id="15109291" author="cpoerschke" created="Wed, 20 Jan 2016 12:58:32 -0700">&lt;p&gt;Please find attached a two-part patch against latest trunk:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Part 1 is to make Lucene's SortingMergePolicy configurable in Solr.&lt;/li&gt;
	&lt;li&gt;Part 2 is to allow use of Lucene's EarlyTerminatingSortingCollector via an optional segmentTerminateEarly=(false|true) search request parameter.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Related linked tickets already completed various preparation work and so the two patches now then are pretty pure and specific to only the change itself here.&lt;/p&gt;

&lt;p&gt;Reviews, comments, etc. welcome. Thank you.&lt;/p&gt;</comment>
                            <comment id="15109442" author="hossman" created="Wed, 20 Jan 2016 14:20:44 -0700">&lt;p&gt;Probably a naive question, but...&lt;/p&gt;

&lt;p&gt;I understand that the reason we need new config syntax is to be able to wrap whatever was specified by &lt;tt&gt;&amp;lt;mergePolicy/&amp;gt;&lt;/tt&gt; &amp;#8211; but i'm not really a fan of the 2 new disjoint top level config options.  Why not keep those two concepts (should we sort the merges? how should we sort the merges?) in a single place? (my gut says solrconfig.xml since that's where other merge related settings live.)&lt;/p&gt;

&lt;p&gt;ie...&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
&amp;lt;sortMerges enabled=&lt;span class="code-quote"&gt;"&lt;span class="code-keyword"&gt;true&lt;/span&gt;"&lt;/span&gt;&amp;gt;popularity desc, timestamp desc&amp;lt;/sortMerges&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;what's the motivation/conceptual reasoning behind part of that being configured in the schema and part of it in solrconfig?&lt;/p&gt;</comment>
                            <comment id="15109905" author="tomasflobbe" created="Wed, 20 Jan 2016 19:07:31 -0700">&lt;p&gt;This feature sounds really good. I have some questions/comments:&lt;/p&gt;

&lt;p&gt;I'm wondering if its better to have the &lt;tt&gt;segmentTerminateEarly&lt;/tt&gt; parameter or if we should just use the &lt;tt&gt;EarlyTerminatingSortingCollector&lt;/tt&gt; whenever the MP is &lt;tt&gt;SortingMergePolicy&lt;/tt&gt; and the sort spec is compatible. Or maybe the default should be "use it if possible", and if the parameter is explicitly set to true, use it if possible, and error if not? If the parameter is set to "false", don't use the collector even if possible.&lt;/p&gt;

&lt;p&gt;Looking at this&lt;/p&gt;
&lt;div class="preformatted panel" style="border-width: 1px;"&gt;&lt;div class="preformattedContent panelContent"&gt;
&lt;pre&gt;+      if (segmentTerminatedEarly != null) {
+        final Object existingSegmentTerminatedEarly = rb.rsp.getResponseHeader().get(SolrQueryResponse.RESPONSE_HEADER_SEGMENT_TERMINATED_EARLY_KEY);
+        if(existingSegmentTerminatedEarly == null) {
+          rb.rsp.getResponseHeader().add(SolrQueryResponse.RESPONSE_HEADER_SEGMENT_TERMINATED_EARLY_KEY, segmentTerminatedEarly);
+        } else if (!segmentTerminatedEarly.equals(existingSegmentTerminatedEarly)) {
+          rb.rsp.getResponseHeader().remove(SolrQueryResponse.RESPONSE_HEADER_SEGMENT_TERMINATED_EARLY_KEY);
+          rb.rsp.getResponseHeader().add(SolrQueryResponse.RESPONSE_HEADER_SEGMENT_TERMINATED_EARLY_KEY, segmentTerminatedEarly);
+        }
+      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;If there is an existing value, the new one should be &lt;tt&gt;existing OR new&lt;/tt&gt;, right? If we want the per shard information we could add that to the shards_info section.&lt;/p&gt;
</comment>
                            <comment id="15110679" author="cpoerschke" created="Thu, 21 Jan 2016 07:41:43 -0700">&lt;blockquote&gt;&lt;p&gt;... i'm not really a fan of the 2 new disjoint top level config options ...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I agree that having a &lt;tt&gt;&amp;lt;useSortingMergePolicy&amp;gt;true&amp;lt;/useSortingMergePolicy&amp;gt;&lt;/tt&gt; element in solrconfig.xml and a &lt;tt&gt;&amp;lt;mergeSortSpec&amp;gt;timestamp desc&amp;lt;/mergeSortSpec&amp;gt;&lt;/tt&gt; element in schema.xml is tricky but personally am not won over by either of the obvious two alternatives either:&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Alternative #1 solrconfig.xml element only:&lt;/b&gt;&lt;br/&gt;
+ advantage: the element is co-located with the existing &amp;lt;mergePolicy&amp;gt; element&lt;br/&gt;
&amp;#45; disadvantages:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;solrconfig.xml references schema.xml field names&lt;/li&gt;
	&lt;li&gt;solr.search.SolrIndexSearcher would need (more) access to the solr.update.SolrIndexConfig object [implementation detail: SolrIndexSearcher.buildAndRunCollectorChain needs to be able to pass the merge policy sort to EarlyTerminatingSortingCollector but only one of the two SolrIndexSearcher constructors currently takes an SolrIndexConfig argument.]&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&lt;b&gt;Alternative #2 schema.xml element only:&lt;/b&gt;&lt;br/&gt;
+ advantage: the element uses solr field names defined in the same file&lt;br/&gt;
&amp;#45; disadvantage: the presence or absence of an element in schema.xml has a side effect on how the solrconfig.xml &amp;lt;mergePolicy&amp;gt; element is instantiated&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Alternative #3 perhaps there is another way?&lt;/b&gt;&lt;/p&gt;</comment>
                            <comment id="15110684" author="cpoerschke" created="Thu, 21 Jan 2016 07:43:40 -0700">&lt;blockquote&gt;&lt;p&gt;If there is an existing value, the new one should be &lt;tt&gt;existing OR new&lt;/tt&gt;, right?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Good catch, will fix.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;If we want the per shard information we could add that to the shards_info section.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Good idea, will make a change to add that (with corresponding test).&lt;/p&gt;</comment>
                            <comment id="15110696" author="cpoerschke" created="Thu, 21 Jan 2016 07:49:33 -0700">&lt;blockquote&gt;&lt;p&gt;I'm wondering if its better to have the &lt;tt&gt;segmentTerminateEarly&lt;/tt&gt; parameter or if we should just use the &lt;tt&gt;EarlyTerminatingSortingCollector&lt;/tt&gt; whenever the MP is &lt;tt&gt;SortingMergePolicy&lt;/tt&gt; and the sort spec is compatible. ...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Good question. &lt;tt&gt;segmentTerminateEarly&lt;/tt&gt; will influence i.e. potentially reduce the &lt;tt&gt;numFound&lt;/tt&gt; value in the response, so because of that I'd say that segment-terminating-early should be an opt-in rather than an opt-out parameter.&lt;/p&gt;</comment>
                            <comment id="15110884" author="tomasflobbe" created="Thu, 21 Jan 2016 09:48:54 -0700">&lt;p&gt;Missed that.&lt;br/&gt;
The parameter makes more sense then.&lt;/p&gt;</comment>
                            <comment id="15110927" author="hossman" created="Thu, 21 Jan 2016 10:09:02 -0700">&lt;blockquote&gt;&lt;p&gt;Alternative #1 solrconfig.xml element only:&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think this is the best approach conceptually from the standpoint of a user's mental model.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;solrconfig.xml references schema.xml field names&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This has always been the case &amp;#8211; no new ground here, and not soemthing we have any reason to start avoiding.  sane solrconfig.xml settings have always depended on an understanding of the schema.xml, it's going the other way (schema.xml settings requiring some knowledge of the solrconfig.xml) that has always been avoided, because it breaks the conceptual model of the distinction between "what, abstractly, is my data? (schema)" and "how, practically, do i want to use my data? (solrconfig).&lt;/p&gt;

&lt;p&gt;segment sorting feels very much like a "practically speaking, how am i using this data" type question, and not a "conceptually speaking, what do these documents represent" type question.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;SolrIndexSearcher.buildAndRunCollectorChain needs to be able to pass the merge policy sort to EarlyTerminatingSortingCollector but only one of the two SolrIndexSearcher constructors currently takes an SolrIndexConfig&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We should put more work into making the user experience better at the expense of implementation details &amp;#8211; in this case though i'm not sure i really see the problem?  SolrIndexSearcher always knows it's SolrCore which has accessors for the SolrConfig, which exposes the SlrIndexConfig ... correct?&lt;/p&gt;</comment>
                            <comment id="15111026" author="cpoerschke" created="Thu, 21 Jan 2016 11:14:07 -0700">&lt;p&gt;Okay, if the &lt;em&gt;"solrconfig.xml references schema.xml field names"&lt;/em&gt; thing is not a show-stopper then I'm happy to run with the &lt;em&gt;"Alternative #1 solrconfig.xml element only"&lt;/em&gt; approach.&lt;/p&gt;</comment>
                            <comment id="15113257" author="cpoerschke" created="Fri, 22 Jan 2016 15:37:17 -0700">&lt;p&gt;&lt;b&gt;Any thoughts on how crucial support for the enable attribute is in the solrconfig.xml element?&lt;/b&gt;&lt;/p&gt;
&lt;div class="preformatted panel" style="border-width: 1px;"&gt;&lt;div class="preformattedContent panelContent"&gt;
&lt;pre&gt;&amp;lt;sortMerges enable="true"&amp;gt;popularity desc, timestamp desc&amp;lt;/sortMerges&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;em&gt;(In my opinion it is crucial for anyone wishing to use something like &lt;tt&gt;enable="${solr.sortMerges.enable:false}"&lt;/tt&gt; to easily transition to use a SortingMergePolicy.)&lt;/em&gt;
&lt;br class="atl-forced-newline" /&gt;
&lt;br class="atl-forced-newline" /&gt;
&lt;b&gt;Any views on this alternative?&lt;/b&gt;&lt;/p&gt;
&lt;div class="preformatted panel" style="border-width: 1px;"&gt;&lt;div class="preformattedContent panelContent"&gt;
&lt;pre&gt;&amp;lt;sortMerges enable="true"&amp;gt;
  &amp;lt;str name="sort"&amp;gt;popularity desc, timestamp desc&amp;lt;/str&amp;gt;
&amp;lt;/sortMerges&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;em&gt;(In my opinion it's almost as user-friendly and if Lucene's SortingMergePolicy's constructor in future ever were to require an extra argument this could be accommodated in a straightforward way with an extra &lt;tt&gt;&amp;lt;int name="answer"&amp;gt;42&amp;lt;/int&amp;gt;&lt;/tt&gt; element.)&lt;/em&gt;
&lt;br class="atl-forced-newline" /&gt;
&lt;br class="atl-forced-newline" /&gt;
&lt;b&gt;Why the above questions?&lt;/b&gt;
&lt;br class="atl-forced-newline" /&gt;
&lt;br class="atl-forced-newline" /&gt;
Implementation-wise it appears that primitive &lt;tt&gt;&amp;lt;some&amp;gt;string&amp;lt;/some&amp;gt;&lt;/tt&gt; elements have no support for attributes. At first glance it appears that we could in SolrIndexConfig.java creatively solve this with something like this:&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
  lockType=solrConfig.get(prefix+&lt;span class="code-quote"&gt;"/lockType"&lt;/span&gt;, def.lockType);
  ...
  mergePolicyInfo = getPluginInfo(prefix + &lt;span class="code-quote"&gt;"/mergePolicy"&lt;/span&gt;, solrConfig, def.mergePolicyInfo);
+ &lt;span class="code-keyword"&gt;if&lt;/span&gt; (!solrConfig.readPluginInfos(prefix + &lt;span class="code-quote"&gt;"/sortMerges"&lt;/span&gt;, &lt;span class="code-keyword"&gt;false&lt;/span&gt; /*requireName*/, &lt;span class="code-keyword"&gt;false&lt;/span&gt; /*requireClass*/).isEmpty()) {
+   sortMerges = solrConfig.get(prefix + &lt;span class="code-quote"&gt;"/sortMerges"&lt;/span&gt;, def.sortMerges);
+ } &lt;span class="code-keyword"&gt;else&lt;/span&gt; {
+   sortMerges = def.sortMerges;
+ }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;However, on further consideration a map returned by &lt;tt&gt;SolrIndexConfig.toMap()&lt;/tt&gt; would then not represent the complete solrconfig.xml element (any enable attribute in the primitive sortMerges element would be missing) i.e. &lt;tt&gt;&amp;lt;sortMerges enable="true"&amp;gt;popularity desc, timestamp desc&amp;lt;/sortMerges&amp;gt;&lt;/tt&gt; would reduce down to &lt;tt&gt;"sortMerges" : "popularity desc, timestamp desc"&lt;/tt&gt; in the map and &lt;tt&gt;&amp;lt;sortMerges enable="false"&amp;gt;popularity desc, timestamp desc&amp;lt;/sortMerges&amp;gt;&lt;/tt&gt; would be absent from the map.&lt;/p&gt;</comment>
                            <comment id="15113266" author="hossman" created="Fri, 22 Jan 2016 15:41:21 -0700">&lt;blockquote&gt;&lt;p&gt;Any views on this alternative?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="15117104" author="cpoerschke" created="Tue, 26 Jan 2016 05:08:45 -0700">&lt;p&gt;Have chosen&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
+      &lt;span class="code-keyword"&gt;if&lt;/span&gt; (segmentTerminatedEarly != &lt;span class="code-keyword"&gt;null&lt;/span&gt;) {
+        &lt;span class="code-keyword"&gt;final&lt;/span&gt; &lt;span class="code-object"&gt;Object&lt;/span&gt; existingSegmentTerminatedEarly = rb.rsp.getResponseHeader().get(SolrQueryResponse.RESPONSE_HEADER_SEGMENT_TERMINATED_EARLY_KEY);
+        &lt;span class="code-keyword"&gt;if&lt;/span&gt;(existingSegmentTerminatedEarly == &lt;span class="code-keyword"&gt;null&lt;/span&gt;) {
+          rb.rsp.getResponseHeader().add(SolrQueryResponse.RESPONSE_HEADER_SEGMENT_TERMINATED_EARLY_KEY, segmentTerminatedEarly);
+        } &lt;span class="code-keyword"&gt;else&lt;/span&gt; &lt;span class="code-keyword"&gt;if&lt;/span&gt; (!&lt;span class="code-object"&gt;Boolean&lt;/span&gt;.TRUE.equals(existingSegmentTerminatedEarly) &amp;amp;&amp;amp; &lt;span class="code-object"&gt;Boolean&lt;/span&gt;.TRUE.equals(segmentTerminatedEarly)) {
+          rb.rsp.getResponseHeader().remove(SolrQueryResponse.RESPONSE_HEADER_SEGMENT_TERMINATED_EARLY_KEY);
+          rb.rsp.getResponseHeader().add(SolrQueryResponse.RESPONSE_HEADER_SEGMENT_TERMINATED_EARLY_KEY, segmentTerminatedEarly);
+        }
+      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;as implementation for the &lt;tt&gt;existing OR new&lt;/tt&gt; to avoid unnecessary remove-and-then-add-back if &lt;tt&gt;existing&lt;/tt&gt; is already TRUE.&lt;/p&gt;</comment>
                            <comment id="15117111" author="cpoerschke" created="Tue, 26 Jan 2016 05:18:12 -0700">&lt;p&gt;The revised attached patch uses this alternative.&lt;/p&gt;

&lt;p&gt;A side-effect of the alternative, beneficial in my opinion, is that the simple default use is&lt;/p&gt;
&lt;div class="preformatted panel" style="border-width: 1px;"&gt;&lt;div class="preformattedContent panelContent"&gt;
&lt;pre&gt;&amp;lt;sortMerges enable="true"&amp;gt;
  &amp;lt;str name="sort"&amp;gt;popularity desc, timestamp desc&amp;lt;/str&amp;gt;
&amp;lt;/sortMerges&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;but something customised such as&lt;/p&gt;
&lt;div class="preformatted panel" style="border-width: 1px;"&gt;&lt;div class="preformattedContent panelContent"&gt;
&lt;pre&gt;&amp;lt;sortMerges enable="true" class="MyInstrumentedSortingMergePolicy"&amp;gt;
  &amp;lt;str name="sort"&amp;gt;popularity desc, timestamp desc&amp;lt;/str&amp;gt;
&amp;lt;/sortMerges&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;is now then also supported. Or in implementation-speak: the class attribute of the sortMerges element is optional (defaulted to &lt;tt&gt;org.apache.lucene.index.SortingMergePolicy&lt;/tt&gt;).&lt;/p&gt;
</comment>
                            <comment id="15117549" author="shaie" created="Tue, 26 Jan 2016 09:51:31 -0700">&lt;p&gt;I was hoping that we'd change solrconfig.xml to support something like a &amp;lt;mergepolicy&amp;gt; element which will allow you to define a nested MP. That way one can define SortingMergePolicy by an element like that:&lt;/p&gt;

&lt;div class="preformatted panel" style="border-width: 1px;"&gt;&lt;div class="preformattedContent panelContent"&gt;
&lt;pre&gt;&amp;lt;mergepolicy class="solr.SortingMergePolicy"&amp;gt;
  &amp;lt;params&amp;gt;
    &amp;lt;sort&amp;gt;f1 desc, f2 asc ... &amp;lt;/sort&amp;gt;
  &amp;lt;/param&amp;gt;
  &amp;lt;mergepolicy class="solr.TieredMergePolicy"&amp;gt;
  &amp;lt;/mergepolicy&amp;gt;
&amp;lt;/mergepolicy&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This would allow us to define any "wrapper" MPs in a more general way. What do you think?&lt;/p&gt;</comment>
                            <comment id="15117693" author="cpoerschke" created="Tue, 26 Jan 2016 11:30:39 -0700">&lt;blockquote&gt;&lt;p&gt;solrconfig.xml to support something like a &amp;lt;mergepolicy&amp;gt; element which will allow you to define a nested MP.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I also had noticed the similarity between the with-class-attribute &lt;tt&gt;sortMerges&lt;/tt&gt; element and the existing &lt;tt&gt;mergePolicy&lt;/tt&gt; element. The elements within a &lt;tt&gt;mergePolicy&lt;/tt&gt; currently can be only primitive elements and mergePolicy-within-mergePolicy elements might be confusing from a user's perspective?
&lt;br class="atl-forced-newline" /&gt;
&lt;br class="atl-forced-newline" /&gt;&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;&lt;br class="atl-forced-newline" /&gt;
If we want wrapper merge policies support then I would instead favour 'chaining' instead of 'nesting' of the solrconfig.xml elements, for example:&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
&amp;lt;indexConfig&amp;gt;
  &amp;lt;mergePolicy class=&lt;span class="code-quote"&gt;"org.apache.lucene.index.TieredMergePolicy"&lt;/span&gt;&amp;gt;
    &amp;lt;&lt;span class="code-object"&gt;int&lt;/span&gt; name=&lt;span class="code-quote"&gt;"segmentsPerTier"&lt;/span&gt;&amp;gt;42&amp;lt;/&lt;span class="code-object"&gt;int&lt;/span&gt;&amp;gt;
  &amp;lt;/mergePolicy&amp;gt;
  &amp;lt;mergePolicy class=&lt;span class="code-quote"&gt;"org.apache.lucene.index.SortingMergePolicy"&lt;/span&gt;&amp;gt;
    &amp;lt;str name=&lt;span class="code-quote"&gt;"sort"&lt;/span&gt;&amp;gt;timestamp desc&amp;lt;/str&amp;gt;
  &amp;lt;/mergePolicy&amp;gt;
&amp;lt;/indexConfig&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;SolrIndexConfig.java code outline:&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
&lt;span class="code-keyword"&gt;private&lt;/span&gt; MergePolicy buildMergePolicyChain(IndexSchema schema) {
  MergePolicy policy = &lt;span class="code-keyword"&gt;null&lt;/span&gt;;
  &lt;span class="code-keyword"&gt;for&lt;/span&gt; (PluginInfo mergePolicyInfo : mergePolicyInfos) {
    &lt;span class="code-object"&gt;String&lt;/span&gt; mpClassName = mergePolicyInfo.className;
    &lt;span class="code-object"&gt;Class&lt;/span&gt;&amp;lt;?&amp;gt; mpClass = schema.getResourceLoader().findClass(mpClassName, MergePolicy.class);

    NamedList initArgs = mergePolicyInfo.initArgs;

    &lt;span class="code-keyword"&gt;if&lt;/span&gt; (LogMergePolicy.class.isAssignableFrom(mpClass)) {
      LogMergePolicy logMergePolicy = schema.getResourceLoader().newInstance(mpClassName, LogMergePolicy.class);
      &lt;span class="code-comment"&gt;// ...
&lt;/span&gt;      policy = logMergePolicy;
    } &lt;span class="code-keyword"&gt;else&lt;/span&gt; &lt;span class="code-keyword"&gt;if&lt;/span&gt; (TieredMergePolicy.class.isAssignableFrom(mpClass)) {
      TieredMergePolicy tieredMergePolicy = schema.getResourceLoader().newInstance(mpClassName, TieredMergePolicy.class);
      &lt;span class="code-comment"&gt;// ...
&lt;/span&gt;      policy = tieredMergePolicy;
    } &lt;span class="code-keyword"&gt;else&lt;/span&gt; &lt;span class="code-keyword"&gt;if&lt;/span&gt; (SortingMergePolicy.class.isAssignableFrom(mpClass)) {
      &lt;span class="code-comment"&gt;// clone initArgs so that we can remove the 'sort' element
&lt;/span&gt;      initArgs = initArgs.clone();
      &lt;span class="code-keyword"&gt;final&lt;/span&gt; &lt;span class="code-object"&gt;Object&lt;/span&gt; sortArg = initArgs.remove(&lt;span class="code-quote"&gt;"sort"&lt;/span&gt;);
      &lt;span class="code-comment"&gt;// now parse the 'sort' element
&lt;/span&gt;      &lt;span class="code-keyword"&gt;final&lt;/span&gt; Sort mergeSort = SortSpecParsing.parseSortSpec((&lt;span class="code-object"&gt;String&lt;/span&gt;)sortArg, schema).getSort();
      &lt;span class="code-comment"&gt;// then construct the sorting merge policy
&lt;/span&gt;      log.info(&lt;span class="code-quote"&gt;"Using {}(policy={},mergeSort={})"&lt;/span&gt;, mpClassName, policy, mergeSort);
      SortingMergePolicy sortingMergePolicy = schema.getResourceLoader().newInstance(mpClassName, SortingMergePolicy.class,
          &lt;span class="code-keyword"&gt;null&lt;/span&gt;,
          &lt;span class="code-keyword"&gt;new&lt;/span&gt; &lt;span class="code-object"&gt;Class&lt;/span&gt;[] { MergePolicy.class, Sort.class },
          &lt;span class="code-keyword"&gt;new&lt;/span&gt; &lt;span class="code-object"&gt;Object&lt;/span&gt;[] { policy, mergeSort });
      policy = sortingMergePolicy;
    } &lt;span class="code-keyword"&gt;else&lt;/span&gt; {
      policy = schema.getResourceLoader().newInstance(mpClassName, MergePolicy.class);
    }

    SolrPluginUtils.invokeSetters(policy, initArgs);
  }
  &lt;span class="code-keyword"&gt;return&lt;/span&gt; policy;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15117738" author="dsmiley" created="Tue, 26 Jan 2016 11:51:04 -0700">&lt;p&gt;+1 to chaining.&lt;/p&gt;

&lt;p&gt;As an aside, It's nice to see the collective input of all of us help make this feature even better than originally proposed.  Thanks for putting effort into this Christine.&lt;/p&gt;</comment>
                            <comment id="15117967" author="shaie" created="Tue, 26 Jan 2016 13:46:55 -0700">&lt;p&gt;I'm OK with chaining, but then can we at least wrap all MPs in a logical element?&lt;/p&gt;

&lt;div class="preformatted panel" style="border-width: 1px;"&gt;&lt;div class="preformattedContent panelContent"&gt;
&lt;pre&gt;&amp;lt;indexConfig&amp;gt;
  &amp;lt;mergePolicies&amp;gt;
    ...
  &amp;lt;/mergePolicies&amp;gt;
&amp;lt;/indexConfig&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;That way, if we see only &lt;tt&gt;&amp;lt;mergePolicy&amp;gt;&lt;/tt&gt;, it's a single one, otherwise (&lt;tt&gt;&amp;lt;mergePolicies&amp;gt;&lt;/tt&gt;) we activate chaining. We're both backward-compatible and also don't risk someone stuffing in between elements that aren't merge policies. Also, I feel that if I'd use it, it would make sense to me that all MPs are actually one thing, and not multiple instances...&lt;/p&gt;</comment>
                            <comment id="15118799" author="shaie" created="Wed, 27 Jan 2016 00:33:45 -0700">&lt;p&gt;Rethinking my proposal, I'm not sure chaining merge policies is the right approach. What does it mean if I chain LogMergePolicy and TieredMergePolicy? How about if we introduce a MergePolicyPlugin/Factory, which would allow one to implement whatever MergePolicy he wants (including wrapping others). And we introduce out-of-the-box a SortingMergePolicyPlugin/Factory which takes flat attributes to initialize itself, e.g.:&lt;/p&gt;

&lt;div class="preformatted panel" style="border-width: 1px;"&gt;&lt;div class="preformattedContent panelContent"&gt;
&lt;pre&gt;  &amp;lt;mergePolicyPlugin class="solr.SortingMergePolicyPlugin"&amp;gt;
    &amp;lt;sort&amp;gt;f1 desc, f2 asc, ... &amp;lt;/sort&amp;gt;
    &amp;lt;delegate.class&amp;gt;solr.TieredMergePolicy"&amp;lt;/delegate.class&amp;gt;
    &amp;lt;delegate.mergeFactor&amp;gt;10&amp;lt;/delegate.mergeFactor&amp;gt;
  &amp;lt;/mergePolicyPlugin&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Alternatively, if this works too, it's better IMO:&lt;/p&gt;

&lt;div class="preformatted panel" style="border-width: 1px;"&gt;&lt;div class="preformattedContent panelContent"&gt;
&lt;pre&gt;  &amp;lt;mergePolicyPlugin class="solr.SortingMergePolicyPlugin"&amp;gt;
    &amp;lt;sort&amp;gt;f1 desc, f2 asc, ... &amp;lt;/sort&amp;gt;
    &amp;lt;delegate class="solr.TieredMergePolicy"
              mergeFactor="10"
              ...
    &amp;lt;/delegate&amp;gt;
  &amp;lt;/mergePolicyPlugin&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15119121" author="cpoerschke" created="Wed, 27 Jan 2016 04:59:47 -0700">&lt;p&gt;I like the idea of a &lt;tt&gt;MergePolicyFactory&lt;/tt&gt; and the idea of &lt;tt&gt;delegate.something&lt;/tt&gt; notation is also interesting.&lt;/p&gt;

&lt;p&gt;There would have to be out-of-the-box factories for all existing non-wrapping merge policies e.g.&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
&amp;lt;!-- &lt;span class="code-keyword"&gt;public&lt;/span&gt; TieredMergePolicy() { --&amp;gt;
&amp;lt;mergePolicyFactory class=&lt;span class="code-quote"&gt;"TieredMergePolicyFactory"&lt;/span&gt;&amp;gt;
  &amp;lt;&lt;span class="code-object"&gt;int&lt;/span&gt; name=&lt;span class="code-quote"&gt;"segmentsPerTier"&lt;/span&gt;&amp;gt;42&amp;lt;/&lt;span class="code-object"&gt;int&lt;/span&gt;&amp;gt;
&amp;lt;/mergePolicyFactory&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;An out-of-the-box factory would also be provided for existing plain wrapping merge policies e.g.&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
&amp;lt;!-- &lt;span class="code-keyword"&gt;public&lt;/span&gt; UpgradeIndexMergePolicy(MergePolicy base) { --&amp;gt;
&amp;lt;mergePolicyFactory class=&lt;span class="code-quote"&gt;"UpgradeIndexMergePolicyFactory"&lt;/span&gt;&amp;gt;
  &amp;lt;str name=&lt;span class="code-quote"&gt;"base"&lt;/span&gt;&amp;gt;TieredMergePolicyFactory&amp;lt;/str&amp;gt;
  &amp;lt;&lt;span class="code-object"&gt;int&lt;/span&gt; name=&lt;span class="code-quote"&gt;"base.segmentsPerTier"&lt;/span&gt;&amp;gt;42&amp;lt;/&lt;span class="code-object"&gt;int&lt;/span&gt;&amp;gt;
&amp;lt;/mergePolicyFactory&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The factory for building sorting merge policies could look something like this:&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
&amp;lt;!-- &lt;span class="code-keyword"&gt;public&lt;/span&gt; SortingMergePolicy(MergePolicy in, Sort sort) { --&amp;gt;
&amp;lt;mergePolicyFactory class=&lt;span class="code-quote"&gt;"SortingMergePolicyFactory"&lt;/span&gt;&amp;gt;
  &amp;lt;str name=&lt;span class="code-quote"&gt;"in"&lt;/span&gt;&amp;gt;TieredMergePolicyFactory&amp;lt;/str&amp;gt;
  &amp;lt;&lt;span class="code-object"&gt;int&lt;/span&gt; name=&lt;span class="code-quote"&gt;"in.segmentsPerTier"&lt;/span&gt;&amp;gt;42&amp;lt;/&lt;span class="code-object"&gt;int&lt;/span&gt;&amp;gt;
  &amp;lt;str name=&lt;span class="code-quote"&gt;"sort"&lt;/span&gt;&amp;gt;timestamp desc&amp;lt;/str&amp;gt;
&amp;lt;/mergePolicyFactory&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;For consistency we should (in my opinion) conceptually support wrapping of wrapping merge policies e.g. someone could go and create their own MyInstrumentedMergePolicyFactory factory and use it like this:&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
&amp;lt;!-- &lt;span class="code-keyword"&gt;public&lt;/span&gt; MyInstrumentedMergePolicy(MergePolicy mergePolicy) { --&amp;gt;
&amp;lt;mergePolicyFactory class=&lt;span class="code-quote"&gt;"MyInstrumentedMergePolicyFactory"&lt;/span&gt;&amp;gt;
  &amp;lt;str name=&lt;span class="code-quote"&gt;"mergePolicy"&lt;/span&gt;&amp;gt;SortingMergePolicyFactory&amp;lt;/str&amp;gt;
  &amp;lt;str name=&lt;span class="code-quote"&gt;"mergePolicy.in"&lt;/span&gt;&amp;gt;TieredMergePolicyFactory&amp;lt;/str&amp;gt;
  &amp;lt;&lt;span class="code-object"&gt;int&lt;/span&gt; name=&lt;span class="code-quote"&gt;"mergePolicy.in.segmentsPerTier"&lt;/span&gt;&amp;gt;42&amp;lt;/&lt;span class="code-object"&gt;int&lt;/span&gt;&amp;gt;
  &amp;lt;str name=&lt;span class="code-quote"&gt;"mergePolicy.sort"&lt;/span&gt;&amp;gt;timestamp desc&amp;lt;/str&amp;gt;
  &amp;lt;&lt;span class="code-object"&gt;int&lt;/span&gt; name=&lt;span class="code-quote"&gt;"instrumentationLevel"&lt;/span&gt;&amp;gt;42&amp;lt;/&lt;span class="code-object"&gt;int&lt;/span&gt;&amp;gt;
&amp;lt;/mergePolicyFactory&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;ins&gt;ticketing details:&lt;/ins&gt; if we choose to go down the &lt;tt&gt;MergePolicyFactory&lt;/tt&gt; route then i would suggest this would be best done via a separate JIRA ticket and when that separate JIRA ticket completes the &lt;a href="https://issues.apache.org/jira/browse/SOLR-5730" title="make Lucene&amp;#39;s SortingMergePolicy and EarlyTerminatingSortingCollector configurable in Solr" class="issue-link" data-issue-key="SOLR-5730"&gt;&lt;del&gt;SOLR-5730&lt;/del&gt;&lt;/a&gt; efforts here would resume/continue.&lt;/p&gt;</comment>
                            <comment id="15119125" author="shaie" created="Wed, 27 Jan 2016 05:04:32 -0700">&lt;p&gt;I don't think that we need to change all MPs to MPFs. If you encounter an MP, you parse it as usual (this is also needed for back-compat). If someone defines an explicit MPF, we use it. For now (this issue that is), we just implement a SortingMergePolicyFactory. For the "flat" MP, we can create a simple FlatMPF or ImplicitMPF (or whatever) that will parse the MP out of solrconfig.xml.&lt;/p&gt;

&lt;p&gt;I think that if we proceed with this issue before we have MPF, then we'll need to support both single MP, chained MP and MPF, which I don't think we want?&lt;/p&gt;</comment>
                            <comment id="15119206" author="cpoerschke" created="Wed, 27 Jan 2016 06:09:35 -0700">&lt;blockquote&gt;&lt;p&gt;I don't think that we need to change all MPs to MPFs.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We currently have &lt;tt&gt;mergeFactor&lt;/tt&gt; and &lt;tt&gt;maxMergeDocs&lt;/tt&gt; elements alongside the &lt;tt&gt;mergePolicy&lt;/tt&gt; element. I would see the &lt;tt&gt;MergePolicyFactory&lt;/tt&gt; route as an opportunity to deprecate the mergeFactor/maxMergeDocs/mergePolicy elements i.e. for a transition period users can use the existing/deprecated elements or the new mergePolicyFactory element but eventually we will remove the deprecated elements.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;existing/deprecated:&lt;/b&gt;&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
&amp;lt;mergeFactor&amp;gt;12&amp;lt;/mergeFactor&amp;gt;
&amp;lt;maxMergeDocs&amp;gt;345&amp;lt;/maxMergeDocs&amp;gt;
&amp;lt;mergePolicy class=&lt;span class="code-quote"&gt;"..."&lt;/span&gt; /&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;b&gt;replacement:&lt;/b&gt;&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
&amp;lt;mergePolicyFactory class=&lt;span class="code-quote"&gt;"...Factory"&lt;/span&gt;&amp;gt;
  &amp;lt;&lt;span class="code-object"&gt;int&lt;/span&gt; name=&lt;span class="code-quote"&gt;"mergeFactor"&lt;/span&gt;&amp;gt;12&amp;lt;/&lt;span class="code-object"&gt;int&lt;/span&gt;&amp;gt;
  &amp;lt;&lt;span class="code-object"&gt;int&lt;/span&gt; name=&lt;span class="code-quote"&gt;"maxMergeDocs"&lt;/span&gt;&amp;gt;345&amp;lt;/&lt;span class="code-object"&gt;int&lt;/span&gt;&amp;gt;
&amp;lt;/mergePolicyFactory&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;b&gt;existing code snippet:&lt;/b&gt;&lt;br/&gt;
Note that maxMergeDocs only applies to LogMergePolicy policies.&lt;br/&gt;
Note that mergeFactor only applies to LogMergePolicy and TieredMergePolicy policies.&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
maxMergeDocs=solrConfig.getInt(prefix+&lt;span class="code-quote"&gt;"/maxMergeDocs"&lt;/span&gt;,def.maxMergeDocs);
mergeFactor=solrConfig.getInt(prefix+&lt;span class="code-quote"&gt;"/mergeFactor"&lt;/span&gt;,def.mergeFactor);
mergePolicyInfo = getPluginInfo(prefix + &lt;span class="code-quote"&gt;"/mergePolicy"&lt;/span&gt;, solrConfig, def.mergePolicyInfo);
...
&lt;span class="code-keyword"&gt;if&lt;/span&gt; (policy &lt;span class="code-keyword"&gt;instanceof&lt;/span&gt; LogMergePolicy) {
  LogMergePolicy logMergePolicy = (LogMergePolicy) policy;
  fixUseCFMergePolicyInitArg(LogMergePolicy.class);
  &lt;span class="code-keyword"&gt;if&lt;/span&gt; (maxMergeDocs != -1)
    logMergePolicy.setMaxMergeDocs(maxMergeDocs);
  &lt;span class="code-keyword"&gt;if&lt;/span&gt; (mergeFactor != -1)
    logMergePolicy.setMergeFactor(mergeFactor);
} &lt;span class="code-keyword"&gt;else&lt;/span&gt; &lt;span class="code-keyword"&gt;if&lt;/span&gt; (policy &lt;span class="code-keyword"&gt;instanceof&lt;/span&gt; TieredMergePolicy) {
  TieredMergePolicy tieredMergePolicy = (TieredMergePolicy) policy;
  fixUseCFMergePolicyInitArg(TieredMergePolicy.class);
  &lt;span class="code-keyword"&gt;if&lt;/span&gt; (mergeFactor != -1) {
    tieredMergePolicy.setMaxMergeAtOnce(mergeFactor);
    tieredMergePolicy.setSegmentsPerTier(mergeFactor);
  }
} &lt;span class="code-keyword"&gt;else&lt;/span&gt; &lt;span class="code-keyword"&gt;if&lt;/span&gt; (mergeFactor != -1) {
  log.warn(&lt;span class="code-quote"&gt;"Use of &amp;lt;mergeFactor&amp;gt; cannot be configured &lt;span class="code-keyword"&gt;if&lt;/span&gt; merge policy is not an instance of LogMergePolicy or TieredMergePolicy. The configured policy's defaults will be used."&lt;/span&gt;);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15119287" author="shaie" created="Wed, 27 Jan 2016 07:20:50 -0700">&lt;p&gt;OK I see, then in this issue you want to add another "alongside" attribute for SortingMP (&lt;tt&gt;&amp;lt;sortMerges&amp;gt;&lt;/tt&gt;) and then deprecate the whole stuff and move to MergePolicyFactory? Or did you first intend to introduce MPF, and only then address SortingMP? I guess that adding &lt;tt&gt;&amp;lt;sortMerges&amp;gt;&lt;/tt&gt; just to immediately deprecate it seems odd, especially if both will be released in 5.5...&lt;/p&gt;

&lt;p&gt;While we're at it, &lt;tt&gt;useCompoundFiles&lt;/tt&gt; in Lucene has two meanings too: for &lt;tt&gt;IndexWriter&lt;/tt&gt; it determines if flushed segments are flushed as .cfs and in &lt;tt&gt;MergePolicy&lt;/tt&gt; it determines about merged segments. The two are not equivalent, so I suggest we note that in the MPF changes too.&lt;/p&gt;</comment>
                            <comment id="15119309" author="cpoerschke" created="Wed, 27 Jan 2016 07:34:38 -0700">&lt;blockquote&gt;&lt;p&gt;... did you first intend to introduce MPF ... adding &lt;tt&gt;&amp;lt;sortMerges&amp;gt;&lt;/tt&gt; just to immediately deprecate it seems odd ...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, my preference would be to first introduce MPF with (say) &lt;tt&gt;UpgradeIndexMergePolicyFactory&lt;/tt&gt; as example and for there to never be that "alongside" &amp;lt;sortMerges&amp;gt; attribute.&lt;/p&gt;

&lt;p&gt;Thanks for mentioning about &lt;tt&gt;useCompoundFiles&lt;/tt&gt; meanings. It would be good i think to not carry over the &lt;tt&gt;fixUseCFMergePolicyInitArg&lt;/tt&gt; logic into the MPF code.&lt;/p&gt;</comment>
                            <comment id="15119350" author="shaie" created="Wed, 27 Jan 2016 07:53:10 -0700">&lt;p&gt;OK so in that case it's better. We'll put this issue on-hold for MPF, then resume with it? Is there something I can help with? &lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/smile.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt;&lt;/p&gt;</comment>
                            <comment id="15123394" author="cpoerschke" created="Fri, 29 Jan 2016 05:00:13 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-5730" title="make Lucene&amp;#39;s SortingMergePolicy and EarlyTerminatingSortingCollector configurable in Solr" class="issue-link" data-issue-key="SOLR-5730"&gt;&lt;del&gt;SOLR-5730&lt;/del&gt;&lt;/a&gt; will be suspended for now, to resume once &lt;a href="https://issues.apache.org/jira/browse/SOLR-8621" title="solrconfig.xml: deprecate/replace &amp;lt;mergePolicy&amp;gt; with &amp;lt;mergePolicyFactory&amp;gt;" class="issue-link" data-issue-key="SOLR-8621"&gt;&lt;del&gt;SOLR-8621&lt;/del&gt;&lt;/a&gt; is done.&lt;/p&gt;</comment>
                            <comment id="15123397" author="cpoerschke" created="Fri, 29 Jan 2016 05:02:11 -0700">&lt;p&gt;Help and collaboration always welcome &lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/smile.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt; Have created &lt;a href="https://issues.apache.org/jira/browse/SOLR-8621" title="solrconfig.xml: deprecate/replace &amp;lt;mergePolicy&amp;gt; with &amp;lt;mergePolicyFactory&amp;gt;" class="issue-link" data-issue-key="SOLR-8621"&gt;&lt;del&gt;SOLR-8621&lt;/del&gt;&lt;/a&gt;'s &lt;a href="https://github.com/apache/lucene-solr/tree/master-solr-8621" class="external-link" rel="nofollow"&gt;master-solr-8621&lt;/a&gt; work-in-progress branch with that in mind. Thanks!&lt;/p&gt;</comment>
                            <comment id="15128303" author="jkrupan" created="Tue, 2 Feb 2016 07:19:22 -0700">&lt;p&gt;Sorry for arriving so late to the party here, but I've gotten lost in all the back and forth... is there going to be a simple and easy to use XML element to let the user simply enable sort merge and specify a field list, as opposed to having to manually construct an elaborate Lucene-level set of wrapped merge policies? I mean, sure, some experts will indeed wish to fully configure every detail of a Lucene merge policy, but for non-expert users who just want to assure that their index is pre-sorted to align with a query sorting, the syntax should be... simple. If the user does construct some elaborate wrapped MP, then some sort of parameter substitution would be needed, but if the user uses the default solrconfig which has no explicit MP, Solr should build that full, wrapped MP with just the sort field names substituted.&lt;/p&gt;

&lt;p&gt;In short, I just wanted to know whether this was intended to be a very easy to use feature (supposed to be the trademark of Solr) or some super-elaborate expert-only feature that we would be forced to recommend that average users stay away from.&lt;/p&gt;

&lt;p&gt;Personally, my preference would be to focus on introducing a first-class Solr feature of a "preferred document order", which is effectively a composite primary key in database nomenclature.&lt;/p&gt;

&lt;p&gt;So, let's not forget that this is Solr we are talking about, not raw Lucene.&lt;/p&gt;

&lt;p&gt;I'd like to know that &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org" class="user-hover" rel="yonik@apache.org"&gt;Yonik Seeley&lt;/a&gt; and &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hossman" class="user-hover" rel="hossman"&gt;Hoss Man&lt;/a&gt; are explicitly on board with what is bring proposed.&lt;/p&gt;</comment>
                            <comment id="15128346" author="cpoerschke" created="Tue, 2 Feb 2016 07:48:57 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jkrupan" class="user-hover" rel="jkrupan"&gt;Jack Krupansky&lt;/a&gt; - it's never too late to join the party here &lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/smile.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt; I've just updated the summary to reflect the latest patch state (though exact &lt;a href="https://issues.apache.org/jira/browse/SOLR-8621" title="solrconfig.xml: deprecate/replace &amp;lt;mergePolicy&amp;gt; with &amp;lt;mergePolicyFactory&amp;gt;" class="issue-link" data-issue-key="SOLR-8621"&gt;&lt;del&gt;SOLR-8621&lt;/del&gt;&lt;/a&gt; details are still a work-in-progress). Hope that clarifies things. Thanks for your input.&lt;/p&gt;</comment>
                            <comment id="15128656" author="hossman" created="Tue, 2 Feb 2016 10:47:04 -0700">&lt;p&gt;I think the direction being taken in &lt;a href="https://issues.apache.org/jira/browse/SOLR-8621" title="solrconfig.xml: deprecate/replace &amp;lt;mergePolicy&amp;gt; with &amp;lt;mergePolicyFactory&amp;gt;" class="issue-link" data-issue-key="SOLR-8621"&gt;&lt;del&gt;SOLR-8621&lt;/del&gt;&lt;/a&gt; looks like a good idea in general for better configuring/modeling the true state of things internally as far as merge policies are concerned.  I think it also makes sense to somewhat put this issue (&lt;a href="https://issues.apache.org/jira/browse/SOLR-5730" title="make Lucene&amp;#39;s SortingMergePolicy and EarlyTerminatingSortingCollector configurable in Solr" class="issue-link" data-issue-key="SOLR-5730"&gt;&lt;del&gt;SOLR-5730&lt;/del&gt;&lt;/a&gt;) on hold until some of those plumbing related questions are resolved.&lt;/p&gt;

&lt;p&gt;ultimately, i suspect using SortingMergePolicy is an advanced enough option that if it requires some non-trivial config then so be it &amp;#8211; we can document what that config looks like and provide common recipes with clear instructions of what key knobs/values users have to consider to use those recipes.&lt;/p&gt;

&lt;p&gt;If, ultimately, we decide that the "full syntax" for specifying a merge policy with SortingMergePolicy warpper is overly verbose for basic users, and we &lt;em&gt;also&lt;/em&gt; want some simplified way for users to say "use whatever default (merge policy) Solr thinks is best, but please sort docs on disk like this..." then that can always be added as syntactic sugar later.&lt;/p&gt;
</comment>
                            <comment id="15128698" author="shaie" created="Tue, 2 Feb 2016 11:10:26 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hossman" class="user-hover" rel="hossman"&gt;Hoss Man&lt;/a&gt;, this issue is now on hold until we finish with &lt;a href="https://issues.apache.org/jira/browse/SOLR-8621" title="solrconfig.xml: deprecate/replace &amp;lt;mergePolicy&amp;gt; with &amp;lt;mergePolicyFactory&amp;gt;" class="issue-link" data-issue-key="SOLR-8621"&gt;&lt;del&gt;SOLR-8621&lt;/del&gt;&lt;/a&gt; (see &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cpoerschke" class="user-hover" rel="cpoerschke"&gt;Christine Poerschke&lt;/a&gt; earlier comment).&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jkrupan" class="user-hover" rel="jkrupan"&gt;Jack Krupansky&lt;/a&gt; the intention of &lt;a href="https://issues.apache.org/jira/browse/SOLR-8621" title="solrconfig.xml: deprecate/replace &amp;lt;mergePolicy&amp;gt; with &amp;lt;mergePolicyFactory&amp;gt;" class="issue-link" data-issue-key="SOLR-8621"&gt;&lt;del&gt;SOLR-8621&lt;/del&gt;&lt;/a&gt; and this issue is to allow users to define compound merge policies in &lt;tt&gt;solrconfig.xml&lt;/tt&gt; with ease. Currently, it's impossible and if you want to use something like &lt;tt&gt;UpgradeIndexMergePolicy&lt;/tt&gt;, you have to create your own MP class which will delegate internally to &lt;tt&gt;UpgradeIndexMP&lt;/tt&gt;. For users who still want to define simple merge policies like &lt;tt&gt;TieredMergePolicy&lt;/tt&gt;, the structure in the XML will not be much different. Instead of:&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
&amp;lt;mergePolicy class=&lt;span class="code-quote"&gt;"org.apache.lucene.index.TieredMergePolicy"&lt;/span&gt;&amp;gt;
  &amp;lt;&lt;span class="code-object"&gt;int&lt;/span&gt; name=&lt;span class="code-quote"&gt;"segmentsPerTier"&lt;/span&gt;&amp;gt;42&amp;lt;/&lt;span class="code-object"&gt;int&lt;/span&gt;&amp;gt;
&amp;lt;/mergePolicy&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;They will need to specify&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
&amp;lt;mergePolicyFactory class=&lt;span class="code-quote"&gt;"org.apache.solr.index.TieredMergePolicyFactory"&lt;/span&gt;&amp;gt;
  &amp;lt;&lt;span class="code-object"&gt;int&lt;/span&gt; name=&lt;span class="code-quote"&gt;"segmentsPerTier"&lt;/span&gt;&amp;gt;42&amp;lt;/&lt;span class="code-object"&gt;int&lt;/span&gt;&amp;gt;
&amp;lt;/mergePolicyFactory&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The factory allows more advanced users to create whatever MP they want, rather easily. Also, with this change, we deprecate some settings that are now defined globally (like &lt;em&gt;mergeFactor&lt;/em&gt;), and move them inside the &lt;tt&gt;&amp;lt;mergePolicyFactory&amp;gt;&lt;/tt&gt; section, where they belong.&lt;/p&gt;

&lt;p&gt;Hope this clarifies it better.&lt;/p&gt;</comment>
                            <comment id="15129131" author="jkrupan" created="Tue, 2 Feb 2016 15:03:33 -0700">&lt;p&gt;Let me try again... again, my apologies for not commenting much earlier before things got a bit complicated. Let me see if I have this straight:&lt;/p&gt;

&lt;p&gt;1. There are three related tickets: &lt;a href="https://issues.apache.org/jira/browse/SOLR-4654" title="Integrate Lucene&amp;#39;s sorting and early query termination capabilities into Solr" class="issue-link" data-issue-key="SOLR-4654"&gt;SOLR-4654&lt;/a&gt;, &lt;a href="https://issues.apache.org/jira/browse/SOLR-5730" title="make Lucene&amp;#39;s SortingMergePolicy and EarlyTerminatingSortingCollector configurable in Solr" class="issue-link" data-issue-key="SOLR-5730"&gt;&lt;del&gt;SOLR-5730&lt;/del&gt;&lt;/a&gt;, &lt;a href="https://issues.apache.org/jira/browse/SOLR-8621" title="solrconfig.xml: deprecate/replace &amp;lt;mergePolicy&amp;gt; with &amp;lt;mergePolicyFactory&amp;gt;" class="issue-link" data-issue-key="SOLR-8621"&gt;&lt;del&gt;SOLR-8621&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
2. There are three key features of interest: UpgradeIndexMergePolicy, SortingMergePolicy , and EarlyTerminatingSortingCollector.&lt;br/&gt;
3. The first ticket is kind of the umbrella.&lt;br/&gt;
4. The second ticket is focused on the second and third features.&lt;br/&gt;
5. The third ticket is the foundation for all three features.&lt;br/&gt;
6. The third ticket has some user impact and delivers some additional minor benefits, but enabling those other three features is its true purpose.&lt;br/&gt;
7. SortingMergePolicy and EarlyTerminatingSortingCollector are really two sides of a single feature, the index side and the query side of (in my words) "pre-sorted indexing".&lt;/p&gt;

&lt;p&gt;Now, I have only one remaining question area: Isn't the forceMerge method the only real benefit of UpgradeIndexMergePolicy? Is that purely for the Solr optimize option, or is there some intent to surface it for users some other way in Solr? Isn't it more of a one-time operation rather than something that should be in place for all merge operations? Or is it so cheap if not used that we should simply pre-configure it all the time?&lt;/p&gt;</comment>
                            <comment id="15130096" author="shaie" created="Wed, 3 Feb 2016 02:26:09 -0700">&lt;p&gt;Hi &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jkrupan" class="user-hover" rel="jkrupan"&gt;Jack Krupansky&lt;/a&gt;, your understanding is correct.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The third ticket has some user impact and delivers some additional minor benefits&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It depends how you view it. I recently found that defining my own MP (when it wraps another one especially) is not so trivial in &lt;tt&gt;solrconfig.xml&lt;/tt&gt;. You could argue that for the majority of the users, this is a very advanced feature to have, and I would agree. But for those who want to write more advanced and &lt;em&gt;tailored&lt;/em&gt; merge policies, &lt;a href="https://issues.apache.org/jira/browse/SOLR-8621" title="solrconfig.xml: deprecate/replace &amp;lt;mergePolicy&amp;gt; with &amp;lt;mergePolicyFactory&amp;gt;" class="issue-link" data-issue-key="SOLR-8621"&gt;&lt;del&gt;SOLR-8621&lt;/del&gt;&lt;/a&gt; will allow them to do so quite easily. And the impact to the users who don't need it is marginal (see my previous comment).&lt;/p&gt;

&lt;p&gt;The reason I quoted that sentence is because of the words &lt;em&gt;minor benefits&lt;/em&gt; &amp;#8211; it's a matter of perspective of course &amp;#8211; if you will be facing the need to write a special MP, then this feature will have huge benefits for you. I know you don't argue about the need, but just wanted to give my own perspective on this.&lt;/p&gt;

&lt;p&gt;As for &lt;tt&gt;UpgradeIndexMergePolicy&lt;/tt&gt; you're right that it's a one-time operation and the main purpose is to allow you to upgrade all segments of your index to a newer format. You will likely only use it when you upgrade to 6.0 and you think (or know) that you still have segments created by 4.x code. Note, that that you upgraded your software to Solr 5.x doesn't mean that the existing indexes' segments were upgraded too!&lt;/p&gt;

&lt;p&gt;But even for this one-time operation, you currently have no way to define &lt;tt&gt;UpgradeIndexMergePolicy&lt;/tt&gt; in a &lt;tt&gt;&amp;lt;mergePolicy&amp;gt;&lt;/tt&gt; element, since it needs to take a wrapped MP which will actually decide which segments to merge together etc. (i.e. create the merge plan). So even for this one time operation, you'd need to have &lt;a href="https://issues.apache.org/jira/browse/SOLR-8621" title="solrconfig.xml: deprecate/replace &amp;lt;mergePolicy&amp;gt; with &amp;lt;mergePolicyFactory&amp;gt;" class="issue-link" data-issue-key="SOLR-8621"&gt;&lt;del&gt;SOLR-8621&lt;/del&gt;&lt;/a&gt; in place.&lt;/p&gt;

&lt;p&gt;I don't view &lt;a href="https://issues.apache.org/jira/browse/SOLR-4654" title="Integrate Lucene&amp;#39;s sorting and early query termination capabilities into Solr" class="issue-link" data-issue-key="SOLR-4654"&gt;SOLR-4654&lt;/a&gt; as an umbrella ticket at all, but more of a duplicate of this one. &lt;a href="https://issues.apache.org/jira/browse/SOLR-8621" title="solrconfig.xml: deprecate/replace &amp;lt;mergePolicy&amp;gt; with &amp;lt;mergePolicyFactory&amp;gt;" class="issue-link" data-issue-key="SOLR-8621"&gt;&lt;del&gt;SOLR-8621&lt;/del&gt;&lt;/a&gt; lays the foundations for allowing users to define compound merge policies, and in this ticket we will add a &lt;tt&gt;SortingMergePolicyFactory&lt;/tt&gt;. As you said, this only handles the indexing side of things, and there's still work to be done in order to make use of it during search (i.e. integrate &lt;tt&gt;EarlyTerminatingSortingCollector&lt;/tt&gt;. Also, I'm pretty sure I saw in &lt;tt&gt;SolrIndexSearcher&lt;/tt&gt; early termination by time (which sort of covers the second part of &lt;a href="https://issues.apache.org/jira/browse/SOLR-4654" title="Integrate Lucene&amp;#39;s sorting and early query termination capabilities into Solr" class="issue-link" data-issue-key="SOLR-4654"&gt;SOLR-4654&lt;/a&gt;), though I haven't seen it actually being used.&lt;/p&gt;</comment>
                            <comment id="15139818" author="cpoerschke" created="Tue, 9 Feb 2016 14:35:06 -0700">&lt;p&gt;Resumed rebasing work for this ticket here, &lt;a href="https://github.com/apache/lucene-solr/tree/jira/solr-5730-master" class="external-link" rel="nofollow"&gt;jira/solr-5730-master&lt;/a&gt; working-branch created (but final commit will still be attached as patch to this ticket for consistency and clarity), reviews, comments, etc. welcome as always.&lt;/p&gt;

&lt;p&gt;(Note that the working-branch commit marked as &lt;a href="https://github.com/apache/lucene-solr/commit/e0b2ebf9c5b9013c8ab2a10717feefd11a101bcb" class="external-link" rel="nofollow"&gt;tentative&lt;/a&gt; would form part not of &lt;a href="https://issues.apache.org/jira/browse/SOLR-5730" title="make Lucene&amp;#39;s SortingMergePolicy and EarlyTerminatingSortingCollector configurable in Solr" class="issue-link" data-issue-key="SOLR-5730"&gt;&lt;del&gt;SOLR-5730&lt;/del&gt;&lt;/a&gt; here but it or something equivalent will be committed as part of &lt;a href="https://issues.apache.org/jira/browse/SOLR-8621" title="solrconfig.xml: deprecate/replace &amp;lt;mergePolicy&amp;gt; with &amp;lt;mergePolicyFactory&amp;gt;" class="issue-link" data-issue-key="SOLR-8621"&gt;&lt;del&gt;SOLR-8621&lt;/del&gt;&lt;/a&gt;.)&lt;/p&gt;</comment>
                            <comment id="15141942" author="cpoerschke" created="Wed, 10 Feb 2016 16:23:03 -0700">&lt;p&gt;&lt;tt&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-5730" title="make Lucene&amp;#39;s SortingMergePolicy and EarlyTerminatingSortingCollector configurable in Solr" class="issue-link" data-issue-key="SOLR-5730"&gt;&lt;del&gt;SOLR-5730&lt;/del&gt;&lt;/a&gt;-part1and2.patch&lt;/tt&gt; attached against latest master/trunk. If there are no further comments or concerns and if all else goes well then that will be the final patch for this ticket, and I will commit it Thursday afternoon/evening or Friday morning London time.&lt;/p&gt;</comment>
                            <comment id="15142109" author="shaie" created="Wed, 10 Feb 2016 18:36:56 -0700">&lt;p&gt;Few comments about the patch:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;In QueryComponent: &lt;tt&gt;if&amp;#40;existingSegmentTerminatedEarly == null&amp;#41;&lt;/tt&gt; &amp;#8211; can you add a space after the 'if'?&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;SortingMergePolicyFactory.getMergePolicy()&lt;/tt&gt; calls &lt;tt&gt;args.invokeSetters(mp);&lt;/tt&gt;, like &lt;tt&gt;UpgradeIndexMergePolicyFactory&lt;/tt&gt;. I wonder if we can have a protected abstract &lt;tt&gt;getMergePolicyInstance(wrappedMP)&lt;/tt&gt;, so that &lt;tt&gt;WrapperMergePolicyFactory.getMergePolicy()&lt;/tt&gt; implements it by calling this method followed by &lt;tt&gt;args.invokeSetters(mp);&lt;/tt&gt;. What do you think?&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;SolrIndexSearcher&lt;/tt&gt;:  &lt;tt&gt;qr.setSegmentTerminatedEarly&amp;#40;earlyTerminatingSortingCollector.terminatedEarly&amp;#40;&amp;#41;&amp;#41;;&lt;/tt&gt; &amp;#8211; should we also set &lt;tt&gt;qr.partialResults&lt;/tt&gt;?&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;DefaultSolrCoreState&lt;/tt&gt;: you can change the to:&lt;/li&gt;
&lt;/ul&gt;


&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
&lt;span class="code-keyword"&gt;public&lt;/span&gt; Sort getMergePolicySort() &lt;span class="code-keyword"&gt;throws&lt;/span&gt; IOException {
  lock(iwLock.readLock());
  &lt;span class="code-keyword"&gt;try&lt;/span&gt; {
    &lt;span class="code-keyword"&gt;if&lt;/span&gt; (indexWriter != &lt;span class="code-keyword"&gt;null&lt;/span&gt;) {
      &lt;span class="code-keyword"&gt;final&lt;/span&gt; MergePolicy mergePolicy = indexWriter.getConfig().getMergePolicy();
      &lt;span class="code-keyword"&gt;if&lt;/span&gt; (mergePolicy &lt;span class="code-keyword"&gt;instanceof&lt;/span&gt; SortingMergePolicy) {
        &lt;span class="code-keyword"&gt;return&lt;/span&gt; ((SortingMergePolicy) mergePolicy).getSort();
      }
    }
  } &lt;span class="code-keyword"&gt;finally&lt;/span&gt; {
    iwLock.readLock().unlock();
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
	&lt;li&gt;What's the purpose of &lt;tt&gt;enable="${solr.sortingMergePolicyFactory.enable:true}"&lt;/tt&gt;?&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;I kind of feel like the test you added to &lt;tt&gt;TestMiniSolrCloudCluster&lt;/tt&gt; doesn't belong in that class. Perhaps it should be in its own test class, inheriting from this class, or just using &lt;tt&gt;MiniSolrCloudCluster&lt;/tt&gt;?&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;RandomForceMergePolicyFactory&lt;/tt&gt; is not really related to this issue. Perhaps you should commit it separately?&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15142711" author="cpoerschke" created="Thu, 11 Feb 2016 06:24:14 -0700">&lt;p&gt;Thanks for the review comments &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shaie" class="user-hover" rel="shaie"&gt;Shai Erera&lt;/a&gt;!&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;... I wonder if we can have a protected abstract getMergePolicyInstance(wrappedMP) ...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, that makes sense and will make &lt;tt&gt;WrapperMergePolicyFactory&lt;/tt&gt; similar to &lt;tt&gt;WrapperMergePolicyFactory&lt;/tt&gt; i.e. both will have a &lt;tt&gt;protected abstract MergePolicy getMergePolicyInstance&lt;/tt&gt; though with different arguments. Will action this under &lt;a href="https://issues.apache.org/jira/browse/SOLR-8621" title="solrconfig.xml: deprecate/replace &amp;lt;mergePolicy&amp;gt; with &amp;lt;mergePolicyFactory&amp;gt;" class="issue-link" data-issue-key="SOLR-8621"&gt;&lt;del&gt;SOLR-8621&lt;/del&gt;&lt;/a&gt; where it really belongs.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;&lt;tt&gt;RandomForceMergePolicyFactory&lt;/tt&gt; is not really related to this issue. Perhaps you should commit it separately?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, I agree, since &lt;tt&gt;RandomForceMergePolicy&lt;/tt&gt; already exists this would belong to &lt;a href="https://issues.apache.org/jira/browse/SOLR-8621" title="solrconfig.xml: deprecate/replace &amp;lt;mergePolicy&amp;gt; with &amp;lt;mergePolicyFactory&amp;gt;" class="issue-link" data-issue-key="SOLR-8621"&gt;&lt;del&gt;SOLR-8621&lt;/del&gt;&lt;/a&gt; also.&lt;/p&gt;</comment>
                            <comment id="15143094" author="jira-bot" created="Thu, 11 Feb 2016 10:24:10 -0700">&lt;p&gt;Commit 360051a414e291a7b3ffb5a0180a404fa18f3a6c in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cpoerschke" class="user-hover" rel="cpoerschke"&gt;Christine Poerschke&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=360051a" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=360051a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8621" title="solrconfig.xml: deprecate/replace &amp;lt;mergePolicy&amp;gt; with &amp;lt;mergePolicyFactory&amp;gt;" class="issue-link" data-issue-key="SOLR-8621"&gt;&lt;del&gt;SOLR-8621&lt;/del&gt;&lt;/a&gt;: factor out protected abstract WrapperMergePolicyFactory.getMergePolicyInstance method&lt;/p&gt;

&lt;p&gt;Here in &lt;a href="https://issues.apache.org/jira/browse/SOLR-8621" title="solrconfig.xml: deprecate/replace &amp;lt;mergePolicy&amp;gt; with &amp;lt;mergePolicyFactory&amp;gt;" class="issue-link" data-issue-key="SOLR-8621"&gt;&lt;del&gt;SOLR-8621&lt;/del&gt;&lt;/a&gt;:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;UpgradeIndexMergePolicyFactory extends WrapperMergePolicyFactory&lt;/li&gt;
	&lt;li&gt;(WrapperMergePolicyFactoryTest's) DefaultingWrapperMergePolicyFactory extends WrapperMergePolicyFactory&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Elsewhere in &lt;a href="https://issues.apache.org/jira/browse/SOLR-5730" title="make Lucene&amp;#39;s SortingMergePolicy and EarlyTerminatingSortingCollector configurable in Solr" class="issue-link" data-issue-key="SOLR-5730"&gt;&lt;del&gt;SOLR-5730&lt;/del&gt;&lt;/a&gt;:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;SortingMergePolicyFactory will extend WrapperMergePolicyFactory&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15143200" author="cpoerschke" created="Thu, 11 Feb 2016 11:22:53 -0700">&lt;blockquote&gt;&lt;p&gt;SolrIndexSearcher: qr.setSegmentTerminatedEarly(earlyTerminatingSortingCollector.terminatedEarly());  should we also set qr.partialResults?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;No, I don't think so: &lt;tt&gt;qr.partialResults&lt;/tt&gt; is used to indicate that &lt;em&gt;partial&lt;/em&gt; results were returned because the timeAllowed limit was exceeded. In comparison &lt;tt&gt;qr.segmentTerminatedEarly&lt;/tt&gt; indicates that &lt;em&gt;full&lt;/em&gt; results were returned and we made use of the EarlyTerminatingSortingCollector which early terminated the collecting of at least one segment. Had we not early-terminated for any of the segments then the results would still have been the same full results. &amp;#8212; So why would anyone care about the qr.segmentTerminatedEarly flag in the response? If the flag is TRUE then the returned &lt;tt&gt;numFound&lt;/tt&gt; will be potentially less than the numFound returned by an identical search that didn't segment-terminate-early. &amp;#8212; As an aside, "partialResults" in the response can also occur if there is no timeAllowed specified but shards.tolerant=true was specified and there was a problem talking to at least one of the shards.&lt;/p&gt;</comment>
                            <comment id="15143223" author="cpoerschke" created="Thu, 11 Feb 2016 11:36:30 -0700">&lt;blockquote&gt;&lt;p&gt;What's the purpose of enable="${solr.sortingMergePolicyFactory.enable:true}"?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Good catch. This used to be the enable attribute in the &amp;lt;sortMerges&amp;gt; element alongside the &amp;lt;mergePolicy&amp;gt; element i.e.&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
&amp;lt;mergePolicy class=&lt;span class="code-quote"&gt;"..."&lt;/span&gt;/&amp;gt;
&amp;lt;sortMerges enable=&lt;span class="code-quote"&gt;"${solr.sortMerges.enable:&lt;span class="code-keyword"&gt;false&lt;/span&gt;}"&lt;/span&gt;&amp;gt;...&amp;lt;/sortMerges&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;but now that we have a combined &lt;tt&gt;&amp;lt;mergePolicyFactory class="SortingMergePolicy"&amp;gt;...&amp;lt;/mergePolicyFactory&amp;gt;&lt;/tt&gt; it doesn't really make sense anymore. I will remove it.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I kind of feel like the test you added to TestMiniSolrCloudCluster doesn't belong in that class. Perhaps it should be in its own test class, inheriting from this class, or just using MiniSolrCloudCluster?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I agree that &lt;tt&gt;TestMiniSolrCloudCluster&lt;/tt&gt; has grown to have all sorts of test methods which could be broken up somehow. &lt;a href="https://issues.apache.org/jira/browse/SOLR-7886" title="factor out a TestMiniSolrCloudClusterBase class" class="issue-link" data-issue-key="SOLR-7886"&gt;SOLR-7886&lt;/a&gt; exists to 'factor out a TestMiniSolrCloudClusterBase class', initial discussion was in &lt;a href="https://issues.apache.org/jira/browse/SOLR-7877" title="TestAuthenticationFramework.testBasics to preserve/restore the original request(Username|Password)" class="issue-link" data-issue-key="SOLR-7877"&gt;&lt;del&gt;SOLR-7877&lt;/del&gt;&lt;/a&gt;, and so for now I'd like to keep the short-ish &lt;tt&gt;testSegmentTerminateEarly&lt;/tt&gt; method in TestMiniSolrCloudCluster but I will try and see if the &lt;tt&gt;TestSegmentTerminateEarlyState&lt;/tt&gt; helper class with the longer logic can be factored out into a class of its own.&lt;/p&gt;</comment>
                            <comment id="15143595" author="cpoerschke" created="Thu, 11 Feb 2016 15:13:19 -0700">&lt;p&gt;Attached revised &lt;a href="https://issues.apache.org/jira/browse/SOLR-5730" title="make Lucene&amp;#39;s SortingMergePolicy and EarlyTerminatingSortingCollector configurable in Solr" class="issue-link" data-issue-key="SOLR-5730"&gt;&lt;del&gt;SOLR-5730&lt;/del&gt;&lt;/a&gt;-part1and2.patch - new or further reviews and comments welcome as usual. If there are no further comments or concerns then will aim to commit the patch tomorrow/Friday towards end of London day.&lt;/p&gt;</comment>
                            <comment id="15143646" author="shaie" created="Thu, 11 Feb 2016 15:48:52 -0700">&lt;p&gt;Patch looks good! One minor comment &amp;#8211; in &lt;tt&gt;SortingMergePolicyFactory.getMergePolicyInstance()&lt;/tt&gt; I'd inline to &lt;tt&gt;return new Sorting ...&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="15144783" author="jira-bot" created="Fri, 12 Feb 2016 09:18:55 -0700">&lt;p&gt;Commit b2e83b6788b5b3c9ee6cf13be1cddec7f21014f4 in lucene-solr's branch refs/heads/branch_5x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cpoerschke" class="user-hover" rel="cpoerschke"&gt;Christine Poerschke&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b2e83b6" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b2e83b6&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8621" title="solrconfig.xml: deprecate/replace &amp;lt;mergePolicy&amp;gt; with &amp;lt;mergePolicyFactory&amp;gt;" class="issue-link" data-issue-key="SOLR-8621"&gt;&lt;del&gt;SOLR-8621&lt;/del&gt;&lt;/a&gt;: factor out protected abstract WrapperMergePolicyFactory.getMergePolicyInstance method&lt;/p&gt;

&lt;p&gt;Here in &lt;a href="https://issues.apache.org/jira/browse/SOLR-8621" title="solrconfig.xml: deprecate/replace &amp;lt;mergePolicy&amp;gt; with &amp;lt;mergePolicyFactory&amp;gt;" class="issue-link" data-issue-key="SOLR-8621"&gt;&lt;del&gt;SOLR-8621&lt;/del&gt;&lt;/a&gt;:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;UpgradeIndexMergePolicyFactory extends WrapperMergePolicyFactory&lt;/li&gt;
	&lt;li&gt;(WrapperMergePolicyFactoryTest's) DefaultingWrapperMergePolicyFactory extends WrapperMergePolicyFactory&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Elsewhere in &lt;a href="https://issues.apache.org/jira/browse/SOLR-5730" title="make Lucene&amp;#39;s SortingMergePolicy and EarlyTerminatingSortingCollector configurable in Solr" class="issue-link" data-issue-key="SOLR-5730"&gt;&lt;del&gt;SOLR-5730&lt;/del&gt;&lt;/a&gt;:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;SortingMergePolicyFactory will extend WrapperMergePolicyFactory&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15144818" author="jira-bot" created="Fri, 12 Feb 2016 09:40:20 -0700">&lt;p&gt;Commit 6a9d89309595ff668f851c17af4f3f97af7640c1 in lucene-solr's branch refs/heads/branch_5_5 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cpoerschke" class="user-hover" rel="cpoerschke"&gt;Christine Poerschke&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=6a9d893" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=6a9d893&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-8621" title="solrconfig.xml: deprecate/replace &amp;lt;mergePolicy&amp;gt; with &amp;lt;mergePolicyFactory&amp;gt;" class="issue-link" data-issue-key="SOLR-8621"&gt;&lt;del&gt;SOLR-8621&lt;/del&gt;&lt;/a&gt;: factor out protected abstract WrapperMergePolicyFactory.getMergePolicyInstance method&lt;/p&gt;

&lt;p&gt;Here in &lt;a href="https://issues.apache.org/jira/browse/SOLR-8621" title="solrconfig.xml: deprecate/replace &amp;lt;mergePolicy&amp;gt; with &amp;lt;mergePolicyFactory&amp;gt;" class="issue-link" data-issue-key="SOLR-8621"&gt;&lt;del&gt;SOLR-8621&lt;/del&gt;&lt;/a&gt;:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;UpgradeIndexMergePolicyFactory extends WrapperMergePolicyFactory&lt;/li&gt;
	&lt;li&gt;(WrapperMergePolicyFactoryTest's) DefaultingWrapperMergePolicyFactory extends WrapperMergePolicyFactory&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Elsewhere in &lt;a href="https://issues.apache.org/jira/browse/SOLR-5730" title="make Lucene&amp;#39;s SortingMergePolicy and EarlyTerminatingSortingCollector configurable in Solr" class="issue-link" data-issue-key="SOLR-5730"&gt;&lt;del&gt;SOLR-5730&lt;/del&gt;&lt;/a&gt;:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;SortingMergePolicyFactory will extend WrapperMergePolicyFactory&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15145218" author="jira-bot" created="Fri, 12 Feb 2016 13:16:35 -0700">&lt;p&gt;Commit 677779086c87db33406f3344736187fa10a30901 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cpoerschke" class="user-hover" rel="cpoerschke"&gt;Christine Poerschke&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=6777790" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=6777790&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-5730" title="make Lucene&amp;#39;s SortingMergePolicy and EarlyTerminatingSortingCollector configurable in Solr" class="issue-link" data-issue-key="SOLR-5730"&gt;&lt;del&gt;SOLR-5730&lt;/del&gt;&lt;/a&gt;: Make Lucene's SortingMergePolicy and EarlyTerminatingSortingCollector configurable in Solr.&lt;/p&gt;</comment>
                            <comment id="15145292" author="jira-bot" created="Fri, 12 Feb 2016 14:03:53 -0700">&lt;p&gt;Commit 805eeb932a872205cd6b43ab1a158c75ca939ea7 in lucene-solr's branch refs/heads/branch_5x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cpoerschke" class="user-hover" rel="cpoerschke"&gt;Christine Poerschke&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=805eeb9" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=805eeb9&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-5730" title="make Lucene&amp;#39;s SortingMergePolicy and EarlyTerminatingSortingCollector configurable in Solr" class="issue-link" data-issue-key="SOLR-5730"&gt;&lt;del&gt;SOLR-5730&lt;/del&gt;&lt;/a&gt;: Make Lucene's SortingMergePolicy and EarlyTerminatingSortingCollector configurable in Solr.&lt;/p&gt;

&lt;p&gt;Cherry-picked commit 6777790 from master and resolved merge conflicts for&lt;br/&gt;
solr/core/src/java/org/apache/solr/search/Query(Command|Result).java and SolrIndexSearcher.java&lt;br/&gt;
(the former had previously been factored out from the latter in master but not branch_5x).&lt;/p&gt;</comment>
                            <comment id="15145302" author="cpoerschke" created="Fri, 12 Feb 2016 14:08:56 -0700">&lt;p&gt;Changes committed to master and cherry-picked to branch_5x (but not branch_5_5). Will resolve ticket on Monday assuming no further comments or test issues etc.&lt;/p&gt;</comment>
                            <comment id="15145565" author="jira-bot" created="Fri, 12 Feb 2016 16:42:05 -0700">&lt;p&gt;Commit f9df240e5ccbd9bd5687eec1d927d3eb517ce8e4 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cpoerschke" class="user-hover" rel="cpoerschke"&gt;Christine Poerschke&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f9df240" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f9df240&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-5730" title="make Lucene&amp;#39;s SortingMergePolicy and EarlyTerminatingSortingCollector configurable in Solr" class="issue-link" data-issue-key="SOLR-5730"&gt;&lt;del&gt;SOLR-5730&lt;/del&gt;&lt;/a&gt;: rename TestSegmentTerminateEarlyState to SegmentTerminateEarlyTestState&lt;/p&gt;</comment>
                            <comment id="15145569" author="jira-bot" created="Fri, 12 Feb 2016 16:43:17 -0700">&lt;p&gt;Commit a48d85fdc7d62011c2514748b963accc3c102f1c in lucene-solr's branch refs/heads/branch_5x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cpoerschke" class="user-hover" rel="cpoerschke"&gt;Christine Poerschke&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=a48d85f" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=a48d85f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-5730" title="make Lucene&amp;#39;s SortingMergePolicy and EarlyTerminatingSortingCollector configurable in Solr" class="issue-link" data-issue-key="SOLR-5730"&gt;&lt;del&gt;SOLR-5730&lt;/del&gt;&lt;/a&gt;: rename TestSegmentTerminateEarlyState to SegmentTerminateEarlyTestState&lt;/p&gt;</comment>
                            <comment id="15145963" author="jira-bot" created="Sat, 13 Feb 2016 05:53:48 -0700">&lt;p&gt;Commit 779120c6a48daf25e46a00f7e6981f8afcd0f3e8 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi" class="user-hover" rel="thetaphi"&gt;Uwe Schindler&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=779120c" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=779120c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-5730" title="make Lucene&amp;#39;s SortingMergePolicy and EarlyTerminatingSortingCollector configurable in Solr" class="issue-link" data-issue-key="SOLR-5730"&gt;&lt;del&gt;SOLR-5730&lt;/del&gt;&lt;/a&gt;: Workaround non-working javadocs link (cannot refer to classes from packages in other modules that already exist in lucene-core.jar)&lt;/p&gt;</comment>
                            <comment id="15145966" author="jira-bot" created="Sat, 13 Feb 2016 05:55:47 -0700">&lt;p&gt;Commit b4811f63bc2f1af174886b379a628391fbcf2012 in lucene-solr's branch refs/heads/branch_5x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi" class="user-hover" rel="thetaphi"&gt;Uwe Schindler&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b4811f6" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b4811f6&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-5730" title="make Lucene&amp;#39;s SortingMergePolicy and EarlyTerminatingSortingCollector configurable in Solr" class="issue-link" data-issue-key="SOLR-5730"&gt;&lt;del&gt;SOLR-5730&lt;/del&gt;&lt;/a&gt;: Workaround non-working javadocs link (cannot refer to classes from packages in other modules that already exist in lucene-core.jar)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12935085">SOLR-8621</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12639847">SOLR-4654</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12957280">SOLR-8959</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310040">
                    <name>Required</name>
                                            <outwardlinks description="requires">
                                        <issuelink>
            <issuekey id="12919727">LUCENE-6925</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12846517">LUCENE-6691</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12842613">SOLR-7750</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12927270">SOLR-8489</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12928410">SOLR-8504</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12841772">LUCENE-6646</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12912556">SOLR-8283</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12914804">SOLR-8321</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12935085">SOLR-8621</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12926955">SOLR-8482</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12787544" name="SOLR-5730-part1and2.patch" size="42749" author="cpoerschke" created="Thu, 11 Feb 2016 15:10:13 -0700"/>
                            <attachment id="12787374" name="SOLR-5730-part1and2.patch" size="45401" author="cpoerschke" created="Wed, 10 Feb 2016 16:17:30 -0700"/>
                            <attachment id="12784398" name="SOLR-5730-part1of2.patch" size="15123" author="cpoerschke" created="Tue, 26 Jan 2016 05:01:45 -0700"/>
                            <attachment id="12783399" name="SOLR-5730-part1of2.patch" size="54492" author="cpoerschke" created="Wed, 20 Jan 2016 12:43:26 -0700"/>
                            <attachment id="12784399" name="SOLR-5730-part2of2.patch" size="36406" author="cpoerschke" created="Tue, 26 Jan 2016 05:01:45 -0700"/>
                            <attachment id="12783401" name="SOLR-5730-part2of2.patch" size="28163" author="cpoerschke" created="Wed, 20 Jan 2016 12:45:01 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 14 Feb 2014 14:45:01 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>373729</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1sekn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>374029</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-5209] last replica removal cascades to remove shard from clusterstate</title>
                <link>https://issues.apache.org/jira/browse/SOLR-5209</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;The problem we saw was that unloading of an only replica of a shard deleted that shard's info from the clusterstate. Once it was gone then there was no easy way to re-create the shard (other than dropping and re-creating the whole collection's state).&lt;/p&gt;

&lt;p&gt;This seems like a bug?&lt;/p&gt;

&lt;p&gt;Overseer.java around line 600 has a comment and commented out code:&lt;br/&gt;
// TODO TODO TODO!!! if there are no replicas left for the slice, and the slice has no hash range, remove it&lt;br/&gt;
// if (newReplicas.size() == 0 &amp;amp;&amp;amp; slice.getRange() == null) {&lt;br/&gt;
// if there are no replicas left for the slice remove it&lt;/p&gt;</description>
                <environment/>
        <key id="12666605">SOLR-5209</key>
            <summary>last replica removal cascades to remove shard from clusterstate</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cpoerschke">Christine Poerschke</assignee>
                                    <reporter username="cpoerschke">Christine Poerschke</reporter>
                        <labels>
                    </labels>
                <created>Mon, 2 Sep 2013 10:16:09 -0700</created>
                <updated>Sat, 13 Feb 2016 12:00:21 -0700</updated>
                            <resolved>Tue, 12 Jan 2016 03:28:57 -0700</resolved>
                                    <version>4.4</version>
                                    <fixVersion>6.0</fixVersion>
                    <fixVersion>master</fixVersion>
                                    <component>SolrCloud</component>
                        <due/>
                            <votes>2</votes>
                                    <watches>13</watches>
                                                                <comments>
                            <comment id="13756189" author="cpoerschke" created="Mon, 2 Sep 2013 10:43:05 -0700">&lt;p&gt;&lt;ins&gt;original clusterstate (extract)&lt;/ins&gt;&lt;/p&gt;
&lt;div class="preformatted panel" style="border-width: 1px;"&gt;&lt;div class="preformattedContent panelContent"&gt;
&lt;pre&gt;shards : {
  "shard1":{ "range":"...", "replicas":{ { "core":"collection1_shard1" } } },
  "shard2":{ "range":"...", "replicas":{ { "core":"collection1_shard2" } } }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;ins&gt;actual clusterstate after UNLOAD of collection1_shard1&lt;/ins&gt;&lt;/p&gt;
&lt;div class="preformatted panel" style="border-width: 1px;"&gt;&lt;div class="preformattedContent panelContent"&gt;
&lt;pre&gt;shards : {
  "shard2":{ "range":"...", "replicas":{ { "core":"collection1_shard2" } } }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;ins&gt;expected clusterstate after UNLOAD of collection1_shard1&lt;/ins&gt;&lt;/p&gt;
&lt;div class="preformatted panel" style="border-width: 1px;"&gt;&lt;div class="preformattedContent panelContent"&gt;
&lt;pre&gt;shards : {
  "shard1":{ "range":"...", "replicas":{} },
  "shard2":{ "range":"...", "replicas":{ { "core":"collection1_shard2" } } }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13756446" author="dancollins" created="Tue, 3 Sep 2013 01:25:19 -0700">&lt;p&gt;When I had a look at that code, I was confused why &lt;tt&gt;removeCore&lt;/tt&gt; was even attempting to remove "all empty pre allocated slices"?  And it also tries to clean up collections, given we have the collections API to do that, why is a simple core unload going any further?  I can see that its "nice" and saves the user having to run the collections API to remove the collection, but isn't it potentially dangerous (like in this case) if we are second guessing what the user will do next?&lt;/p&gt;

&lt;p&gt;Say they are just removing all the replicas, and re-assigning them to different hosts?  They may want to leave the collection/shard ranges "empty" and then move the data to new hosts, and restart the cores to re-register them.  Yes, we could/should start the new ones before removing the old, but that's not enforced?&lt;/p&gt;</comment>
                            <comment id="13756714" author="shalinmangar" created="Tue, 3 Sep 2013 08:51:24 -0700">&lt;p&gt;I think this deserves another look. We have the deleteshard API now which can be used to completely remove a slice from the cluster state. We should remove this trappy behaviour.&lt;/p&gt;</comment>
                            <comment id="13756786" author="markrmiller@gmail.com" created="Tue, 3 Sep 2013 10:00:06 -0700">&lt;blockquote&gt;&lt;p&gt;given we have the collections API to do that&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We don't actually have the collections API to do that - it's simply a thin candy wrapper around SolrCore admin calls. Everything is driven by SolrCores being added or removed. There is work being done to migrate towards something where the collections API is actually large and in charge, but currently it's just a sugar wrapper.&lt;/p&gt;</comment>
                            <comment id="13756827" author="dancollins" created="Tue, 3 Sep 2013 10:46:14 -0700">&lt;p&gt;Ok, my bad, I wasn't clear enough.  At the user-level there is collections API and core API, and yes one is just a wrapper around the other.  But at the Overseer level, we seem to have various different sub-commands (not sure what the correct terminology for them is!): &lt;tt&gt;create_shard&lt;/tt&gt;, &lt;tt&gt;removeshard&lt;/tt&gt;, &lt;tt&gt;createcollection&lt;/tt&gt;, &lt;tt&gt;removecollection&lt;/tt&gt;, &lt;tt&gt;deletecore&lt;/tt&gt;, etc.  I appreciate this is probably historical code, but since we have these other methods, it felt like deletecore was overstepping its bounds  now &lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/smile.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt;&lt;/p&gt;

&lt;p&gt;Could submit an extra patch, but wasn't sure of the historical nature of this code, hence just a comment first to get an opinion/discussion.&lt;/p&gt;</comment>
                            <comment id="13756861" author="markrmiller@gmail.com" created="Tue, 3 Sep 2013 11:16:51 -0700">&lt;p&gt;Right, but the sub commands are just the wrapper calls - except the shard commands - those are new. Th delete core one is mostly about cleanup ini remember right. &lt;/p&gt;

&lt;p&gt;The problem is, the overseer and zk do not own the state. The individual cores do basically. Mostly that's due to historical stuff. We intend to change that, but it's no small feat. Until that is done, I think this is much trickier to get right than it looks. &lt;/p&gt;</comment>
                            <comment id="13867720" author="cpoerschke" created="Fri, 10 Jan 2014 04:09:32 -0700">&lt;p&gt;Hello. Just wanted to follow-up if we could proceed with this patch? To either reduce or completely remove the cascading behaviour UNLOAD currently has, between them DELETESHARD and DELETECOLLECTION should allow for shard and collection removal if that was to be required after UNLOAD-ing. &lt;/p&gt;

&lt;p&gt;&lt;ins&gt;original clusterstate&lt;/ins&gt;&lt;/p&gt;
&lt;div class="preformatted panel" style="border-width: 1px;"&gt;&lt;div class="preformattedContent panelContent"&gt;
&lt;pre&gt;"collection1" : {
  shards : {
    "shard1":{ "range":"...", "state" : "active", "replicas":{ { "core":"collection1_shard1" } } },
    "shard2":{ "range":"...", "state" : "active", "replicas":{ { "core":"collection1_shard2" } } }
  }, ...
},
"collection2" : {
  ...
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;ins&gt;current clusterstate after UNLOAD of collection1 shard1&lt;/ins&gt;&lt;br/&gt;
(The UNLOAD of the last shard1 replica cascade-triggered the removal shard1 itself.)&lt;/p&gt;
&lt;div class="preformatted panel" style="border-width: 1px;"&gt;&lt;div class="preformattedContent panelContent"&gt;
&lt;pre&gt;"collection1" : {
  shards : {
    "shard2":{ "range":"...", "state" : "active", "replicas":{ { "core":"collection1_shard2" } } }
  }, ...
},
"collection2" : {
  ...
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;ins&gt;expected clusterstate after UNLOAD of collection1 shard1&lt;/ins&gt;&lt;br/&gt;
(There are now no replica in shard1. If one wanted to get rid of the shard then DELETESHARD could be modified to allow removal of active shards without replicas (currently DELETESHARD only removes shards that are state=inactive or state=recovery or range=null).)&lt;/p&gt;
&lt;div class="preformatted panel" style="border-width: 1px;"&gt;&lt;div class="preformattedContent panelContent"&gt;
&lt;pre&gt;"collection1" : {
  shards : {
    "shard1":{ "range":"...", "state" : "active", "replicas":{} },
    "shard2":{ "range":"...", "state" : "active", "replicas":{ { "core":"collection1_shard2" } } }
  }, ...
},
"collection2" : {
  ...
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;ins&gt;current clusterstate after UNLOAD of collection1 shard1 and UNLOAD of collection1 shard2&lt;/ins&gt;&lt;br/&gt;
(The UNLOAD of the last shard2 replica cascade-triggered the removal shard2 itself, and then the removal of the last shard cascade-triggered the removal of collection1 itself.)&lt;/p&gt;
&lt;div class="preformatted panel" style="border-width: 1px;"&gt;&lt;div class="preformattedContent panelContent"&gt;
&lt;pre&gt;"collection2" : {
  ...
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;ins&gt;expected clusterstate after UNLOAD of collection1 shard1 and UNLOAD of collection1 shard2&lt;/ins&gt;&lt;br/&gt;
(There are now no replica in shard1 and shard2. If one wanted to get rid of shard1 and shard2 then DELETESHARD could be modified and used as per above. If one wanted to get rid of collection1 itself then DELETECOLLECTION could be used.)&lt;/p&gt;
&lt;div class="preformatted panel" style="border-width: 1px;"&gt;&lt;div class="preformattedContent panelContent"&gt;
&lt;pre&gt;"collection1" : {
  shards : {
    "shard1":{ "range":"...", "state" : "active", "replicas":{} },
    "shard2":{ "range":"...", "state" : "active", "replicas":{} }
  }, ...
},
"collection2" : {
  ...
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13867762" author="noble.paul" created="Fri, 10 Jan 2014 05:30:11 -0700">&lt;p&gt;What is the resolution on this?&lt;/p&gt;

&lt;p&gt;+1 to not remove the slice when the last replica is gone&lt;/p&gt;

&lt;p&gt;I can take this up if this is the proposed resolution&lt;/p&gt;</comment>
                            <comment id="13867790" author="markrmiller@gmail.com" created="Fri, 10 Jan 2014 06:37:44 -0700">&lt;p&gt;This would need to be done in the new "zk is truth" mode, not in the legacy cloud mode.&lt;/p&gt;</comment>
                            <comment id="13867797" author="noble.paul" created="Fri, 10 Jan 2014 06:44:11 -0700">&lt;p&gt;I guess this should not matter because it would not break anything that people are doing. I would consider this a bug. Because creating a lost shard would be extremely hard because the 'range' info would be missing and you will end up with  a 'broken' cluster&lt;/p&gt;</comment>
                            <comment id="13867805" author="markrmiller@gmail.com" created="Fri, 10 Jan 2014 07:02:08 -0700">&lt;p&gt;It's not a bug, the behavior was added explicitly and has been around for a long time. If you want to remove it, its got to be in the new mode.&lt;/p&gt;</comment>
                            <comment id="13867810" author="markrmiller@gmail.com" created="Fri, 10 Jan 2014 07:06:19 -0700">&lt;p&gt;Just a note: The new zk=truth mode is the future. The old mode is never going to be great. It's not possible. It was built in a halfway world, and it will always seems halfway funny. We need to embrace the zk=truth mode to make things nice.&lt;/p&gt;</comment>
                            <comment id="13867840" author="markrmiller@gmail.com" created="Fri, 10 Jan 2014 07:32:25 -0700">&lt;p&gt;Of course, if we really need to, we can remove this, add lots of warnings about the break, notes about the new apis that allow the same thing, etc. Because there is now an alternate way to get this behavior, that is not an out of this world idea.&lt;/p&gt;

&lt;p&gt;Personally though, I'd so much rather see that energy put into the new zk=truth mode, it's required for so many things to work as we want.&lt;/p&gt;</comment>
                            <comment id="13868054" author="andyetitmoves" created="Fri, 10 Jan 2014 11:04:32 -0700">&lt;p&gt;FWIW, newer API actually won't allow you to do exactly what this does. The shard delete API (sensibly) explicitly checks if we have a null range or if we are not an active shard. This potentially lops out an active shard with an assigned range leaving the cluster state broken. I actually don't know if there's a way to get the cluster state back to a sensible state without modifying it by hand or recreating it altogether by nuking ZK state &amp;#8211; when we tried bringing up the replica after this, it got assigned to a shard with an empty range..&lt;/p&gt;

&lt;p&gt;I guess if we plan to get to the ZK truth mode sometime soon, its fine to drop this patch. We mainly meant for this as an interim step to ensure someone doesn't accidentally burn their fingers..&lt;/p&gt;</comment>
                            <comment id="13868062" author="markrmiller@gmail.com" created="Fri, 10 Jan 2014 11:11:34 -0700">&lt;p&gt;This behavior existed long before hash ranges, so I'd say that issue was not complete in this area.&lt;/p&gt;

&lt;p&gt;The zk=truth mode can be started quite simply - its just a new config param we add and we can say some behaviors will change over time as we complete it. I think Shalin has already created an issue for it.&lt;/p&gt;</comment>
                            <comment id="13868632" author="noble.paul" created="Fri, 10 Jan 2014 20:08:54 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-5610" title="Support cluster-wide properties with an API called CLUSTERPROP" class="issue-link" data-issue-key="SOLR-5610"&gt;&lt;del&gt;SOLR-5610&lt;/del&gt;&lt;/a&gt; adds a the necessary property. I'm committing i right away&lt;/p&gt;</comment>
                            <comment id="14237820" author="andyetitmoves" created="Mon, 8 Dec 2014 05:24:57 -0700">&lt;p&gt;This seems to be still relevant (in SliceMutator though rather than Overseer after the refactoring), 5.0 might be a good time to revisit this behaviour since the concerns above were more of back-compat..&lt;/p&gt;</comment>
                            <comment id="14237883" author="markrmiller@gmail.com" created="Mon, 8 Dec 2014 07:11:36 -0700">&lt;p&gt;Yup, now is a good time to change this. &lt;/p&gt;</comment>
                            <comment id="14258367" author="githubbot" created="Wed, 24 Dec 2014 09:44:04 -0700">&lt;p&gt;GitHub user cpoerschke opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href="https://github.com/apache/lucene-solr/pull/118" class="external-link" rel="nofollow"&gt;https://github.com/apache/lucene-solr/pull/118&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href="https://issues.apache.org/jira/browse/SOLR-5209" title="last replica removal cascades to remove shard from clusterstate" class="issue-link" data-issue-key="SOLR-5209"&gt;&lt;del&gt;SOLR-5209&lt;/del&gt;&lt;/a&gt;: last replica removal no longer cascades to remove shard from clusterstate&lt;/p&gt;

&lt;p&gt;    &lt;a href="https://issues.apache.org/jira/i#browse/SOLR-5209" class="external-link" rel="nofollow"&gt;https://issues.apache.org/jira/i#browse/SOLR-5209&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href="https://github.com/bloomberg/lucene-solr" class="external-link" rel="nofollow"&gt;https://github.com/bloomberg/lucene-solr&lt;/a&gt; trunk-solr-5209&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href="https://github.com/apache/lucene-solr/pull/118.patch" class="external-link" rel="nofollow"&gt;https://github.com/apache/lucene-solr/pull/118.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #118&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 90b1a394b50d4f456bfabab756cc64f28733e1a5&lt;br/&gt;
Author: Christine Poerschke &amp;lt;cpoerschke@bloomberg.net&amp;gt;&lt;br/&gt;
Date:   2014-12-24T12:07:56Z&lt;/p&gt;

&lt;p&gt;    &lt;a href="https://issues.apache.org/jira/browse/SOLR-5209" title="last replica removal cascades to remove shard from clusterstate" class="issue-link" data-issue-key="SOLR-5209"&gt;&lt;del&gt;SOLR-5209&lt;/del&gt;&lt;/a&gt;: last replica removal no longer cascades to remove shard from clusterstate&lt;/p&gt;

&lt;p&gt;    old behaviour:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;last replica removal cascades to remove shard from clusterstate&lt;/li&gt;
	&lt;li&gt;last shard removal cascades to remove collection from clusterstate&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    new behaviour:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;last replica removal preserves shard within clusterstate&lt;/li&gt;
	&lt;li&gt;OverseerTest.testRemovalOfLastReplica added for replica removal logic&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    also:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;strings such as "collection1" and "state" in OverseerTest replaced with variable or enum equvivalent&lt;/li&gt;
&lt;/ul&gt;


&lt;hr /&gt;</comment>
                            <comment id="14258368" author="cpoerschke" created="Wed, 24 Dec 2014 09:46:44 -0700">&lt;p&gt;Replaced attached patch with Solr trunk pull request which also includes OverseerTest test case logic.&lt;/p&gt;</comment>
                            <comment id="14261246" author="andyetitmoves" created="Tue, 30 Dec 2014 09:58:24 -0700">&lt;p&gt;I think this might fail &lt;tt&gt;BasicDistributedZkTest.testFailedCoreCreateCleansUp&lt;/tt&gt;.. If we call core create, it happens to be the first core of the collection, and the core creation fails (due to say, a config issue) &amp;#8211; the test currently verifies if the rollback happens by checking for the absence of the collection. We could obviously change the test, but in such a case, should we be removing the collection as well? (or disallow creation of a core for a non-existent collection &amp;#8211; though that might be a bigger, disruptive end user change and not necessarily good)..&lt;/p&gt;</comment>
                            <comment id="14261249" author="markrmiller@gmail.com" created="Tue, 30 Dec 2014 10:03:55 -0700">&lt;p&gt;I think as part of making zk the truth we actually do want to prevent creation of cores that are not part of a zk collection. &lt;/p&gt;</comment>
                            <comment id="14277175" author="cpoerschke" created="Wed, 14 Jan 2015 09:33:47 -0700">&lt;p&gt;&lt;a href="https://github.com/apache/lucene-solr/pull/118" class="external-link" rel="nofollow"&gt;https://github.com/apache/lucene-solr/pull/118&lt;/a&gt; now updated to remove the &lt;tt&gt;BasicDistributedZkTest.testFailedCoreCreateCleansUp&lt;/tt&gt; test and adjust &lt;tt&gt;UnloadDistributedZkTest.testUnloadShardAndCollection&lt;/tt&gt; and &lt;tt&gt;OverseerTest.testOverseerFailure&lt;/tt&gt; tests.&lt;/p&gt;

&lt;p&gt;Would agree that longer-term core creation should not auto-create a collection.&lt;/p&gt;</comment>
                            <comment id="14284062" author="anshumg" created="Tue, 20 Jan 2015 10:25:47 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com" class="user-hover" rel="markrmiller@gmail.com"&gt;Mark Miller&lt;/a&gt; is this a blocker?&lt;/p&gt;</comment>
                            <comment id="14284159" author="markrmiller@gmail.com" created="Tue, 20 Jan 2015 11:22:34 -0700">&lt;p&gt;Not fully. It would just stink to have to wait until 6 to remove this ugly back compat behavior. I thought I'd have time to get to it last week or someone else might pick it up, but no such luck, so perhaps we just push it out. &lt;/p&gt;</comment>
                            <comment id="14743672" author="elyograg" created="Mon, 14 Sep 2015 08:30:40 -0700">&lt;p&gt;On IRC today:&lt;/p&gt;

&lt;div class="preformatted panel" style="border-width: 1px;"&gt;&lt;div class="preformattedContent panelContent"&gt;
&lt;pre&gt;09:14 &amp;lt; yriveiro&amp;gt; Hi, I unloaded by accident the las replica of a shard in a
                  collection
09:14 &amp;lt; yriveiro&amp;gt; How can I recreate the shard?
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15025453" author="cpoerschke" created="Tue, 24 Nov 2015 14:29:31 -0700">&lt;p&gt;Am in the process of updating/rebasing the patch for this (&lt;a href="https://issues.apache.org/jira/browse/SOLR-5209" title="last replica removal cascades to remove shard from clusterstate" class="issue-link" data-issue-key="SOLR-5209"&gt;&lt;del&gt;SOLR-5209&lt;/del&gt;&lt;/a&gt;) ticket here. &lt;a href="https://issues.apache.org/jira/browse/SOLR-8338" title="in OverseerTest replace strings such as &amp;quot;collection1&amp;quot; and &amp;quot;state&amp;quot;" class="issue-link" data-issue-key="SOLR-8338"&gt;&lt;del&gt;SOLR-8338&lt;/del&gt;&lt;/a&gt; is towards that, just replacing magic strings so that the actual test changes required for &lt;a href="https://issues.apache.org/jira/browse/SOLR-5209" title="last replica removal cascades to remove shard from clusterstate" class="issue-link" data-issue-key="SOLR-5209"&gt;&lt;del&gt;SOLR-5209&lt;/del&gt;&lt;/a&gt; will then be simpler and clearer.&lt;/p&gt;</comment>
                            <comment id="15063929" author="cpoerschke" created="Fri, 18 Dec 2015 06:05:19 -0700">&lt;p&gt;Attaching updated patch against trunk.&lt;/p&gt;</comment>
                            <comment id="15069846" author="cpoerschke" created="Wed, 23 Dec 2015 09:40:12 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com" class="user-hover" rel="markrmiller@gmail.com"&gt;Mark Miller&lt;/a&gt; - if you have no objections then I will re-assign this ticket to myself with a view towards committing it in the first half of January or so, to trunk (and not branch_5x) in good time for the 6.0.0 release hopefully, after reviews of course.&lt;/p&gt;

&lt;p&gt;Everyone - the latest &lt;tt&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-5209" title="last replica removal cascades to remove shard from clusterstate" class="issue-link" data-issue-key="SOLR-5209"&gt;&lt;del&gt;SOLR-5209&lt;/del&gt;&lt;/a&gt;.patch&lt;/tt&gt; attachment contains the (small) change itself, a new &lt;tt&gt;OverseerTest.testRemovalOfLastReplica()&lt;/tt&gt; test plus adjustments to existing tests. Reviews, comments, suggestions etc. welcome. Thank you.&lt;/p&gt;</comment>
                            <comment id="15092375" author="jira-bot" created="Mon, 11 Jan 2016 10:52:49 -0700">&lt;p&gt;Commit 1724098 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cpoerschke" class="user-hover" rel="cpoerschke"&gt;Christine Poerschke&lt;/a&gt; in branch 'dev/trunk'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1724098" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1724098&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/SOLR-5209" title="last replica removal cascades to remove shard from clusterstate" class="issue-link" data-issue-key="SOLR-5209"&gt;&lt;del&gt;SOLR-5209&lt;/del&gt;&lt;/a&gt;: Unloading or deleting the last replica of a shard now no longer cascades to remove the shard from the clusterstate.&lt;/p&gt;</comment>
                            <comment id="15093696" author="cpoerschke" created="Tue, 12 Jan 2016 03:28:57 -0700">&lt;p&gt;Committed to trunk only (for 6.x releases) and deliberately not committed to branch_5x since this changes existing behaviour.&lt;/p&gt;</comment>
                            <comment id="15094456" author="githubbot" created="Tue, 12 Jan 2016 11:42:01 -0700">&lt;p&gt;Github user cpoerschke commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href="https://github.com/apache/lucene-solr/pull/118#issuecomment-171007162" class="external-link" rel="nofollow"&gt;https://github.com/apache/lucene-solr/pull/118#issuecomment-171007162&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href="https://issues.apache.org/jira/browse/SOLR-5209" title="last replica removal cascades to remove shard from clusterstate" class="issue-link" data-issue-key="SOLR-5209"&gt;&lt;del&gt;SOLR-5209&lt;/del&gt;&lt;/a&gt; committed to trunk yesterday (&lt;a href="https://svn.apache.org/r1724098" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1724098&lt;/a&gt;).&lt;/p&gt;</comment>
                            <comment id="15094457" author="githubbot" created="Tue, 12 Jan 2016 11:42:02 -0700">&lt;p&gt;Github user cpoerschke closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href="https://github.com/apache/lucene-solr/pull/118" class="external-link" rel="nofollow"&gt;https://github.com/apache/lucene-solr/pull/118&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15145531" author="noble.paul" created="Fri, 12 Feb 2016 16:17:52 -0700">&lt;p&gt;I guess we should get this into 5.5 . This looks like a serious enough problem that backward incompatibility should not be a problem&lt;/p&gt;</comment>
                            <comment id="15146134" author="markrmiller@gmail.com" created="Sat, 13 Feb 2016 12:00:21 -0700">&lt;p&gt;I don't agree for the same reasons we have already discussed.&lt;/p&gt;

&lt;p&gt;We reserved some leeway for 5x to fix things in this vein, but we didn't do any of it. To just make this large change in behavior out of the blue in a 5.5 release doesn't make a lot of sense to me. Best done in the 6 release.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12917056">SOLR-8352</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12915937">SOLR-8338</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12921706">SOLR-8414</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12778489" name="SOLR-5209.patch" size="17027" author="cpoerschke" created="Fri, 18 Dec 2015 06:05:19 -0700"/>
                            <attachment id="12601077" name="SOLR-5209.patch" size="1504" author="cpoerschke" created="Mon, 2 Sep 2013 10:20:14 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 3 Sep 2013 08:25:19 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>346543</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1nrav:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>346844</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-2773] DateField parsing/formatting issues of years prior to 0001</title>
                <link>https://issues.apache.org/jira/browse/SOLR-2773</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;there are currently issues with parsing/formatting dates prior to "Year 1".  these issues also extend to the fact that the xmlschema spec for "canonical" dateTime values seems to actually be contradictory as to how to interpret negative years, and wether there is a "year 0"&lt;/p&gt;

&lt;p&gt;see parent issue (&lt;a href="https://issues.apache.org/jira/browse/SOLR-1899" title="dates prior to 1000AD are not formatted properly in responses" class="issue-link" data-issue-key="SOLR-1899"&gt;&lt;del&gt;SOLR-1899&lt;/del&gt;&lt;/a&gt;) for more details&lt;/p&gt;</description>
                <environment/>
        <key id="12523361">SOLR-2773</key>
            <summary>DateField parsing/formatting issues of years prior to 0001</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12463472">SOLR-1899</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dsmiley">David Smiley</assignee>
                                    <reporter username="hossman">Hoss Man</reporter>
                        <labels>
                    </labels>
                <created>Fri, 16 Sep 2011 10:22:34 -0700</created>
                <updated>Wed, 30 Mar 2016 12:04:39 -0700</updated>
                            <resolved>Wed, 30 Mar 2016 12:04:39 -0700</resolved>
                                                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="15218620" author="dsmiley" created="Wed, 30 Mar 2016 12:04:39 -0700">&lt;p&gt;Closing; fixed by &lt;a href="https://issues.apache.org/jira/browse/SOLR-8904" title="Switch from SimpleDateFormat to Java 8 DateTimeFormatter.ISO_INSTANT" class="issue-link" data-issue-key="SOLR-8904"&gt;&lt;del&gt;SOLR-8904&lt;/del&gt;&lt;/a&gt; (using Java 8 time APIs).  There are tests now for these dates.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12952117">SOLR-8880</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 30 Mar 2016 19:04:39 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3083</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i03inz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>18457</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[SOLR-1899] dates prior to 1000AD are not formatted properly in responses</title>
                <link>https://issues.apache.org/jira/browse/SOLR-1899</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;As noted on the mailing list, if a document is added to solr with a date field such as "0001-01-01T00:00:00Z" then when that document is returned by a search the year will be improperly formated as "1-01-01T00:00:00Z"&lt;/p&gt;</description>
                <environment/>
        <key id="12463472">SOLR-1899</key>
            <summary>dates prior to 1000AD are not formatted properly in responses</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dsmiley">David Smiley</assignee>
                                    <reporter username="hossman">Hoss Man</reporter>
                        <labels>
                    </labels>
                <created>Fri, 30 Apr 2010 18:21:54 -0700</created>
                <updated>Wed, 30 Mar 2016 12:03:52 -0700</updated>
                            <resolved>Wed, 30 Mar 2016 12:03:52 -0700</resolved>
                                    <version>1.1.0</version>
                    <version>1.2</version>
                    <version>1.3</version>
                    <version>1.4</version>
                                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                            <comments>
                            <comment id="12862960" author="hossman" created="Fri, 30 Apr 2010 18:28:19 -0700">&lt;p&gt;I believe the problem is in both XMLWriter.writeDate and JSONWriter.writeDate ... those methods seem to be cut/psate and should also be refactored.&lt;/p&gt;

&lt;p&gt;in general they should probably just be reusing something from DateField.&lt;/p&gt;
</comment>
                            <comment id="12971835" author="hossman" created="Wed, 15 Dec 2010 14:02:41 -0700">&lt;p&gt;A question on the solr-user mailing list from Matthias Agethle also points out a problem with negative years &amp;#8211; this also seems to be because of the GregorianCalendar usage in those two classes when formatting dates (they aren't checking GregorianCalendar.ERA)&lt;/p&gt;

&lt;p&gt;before resolving this issue, whatever fix is put in place should make sure that tests for negative years is included and if that problem is unrelated, a new bug should be filed.&lt;/p&gt;</comment>
                            <comment id="13027989" author="hossman" created="Mon, 2 May 2011 19:00:33 -0700">&lt;p&gt;his came up again on the mailing list today, so i started looking into it.&lt;/p&gt;

&lt;p&gt;the previously mentioned cut/paste code has since been refactored to TestResponseWriter.&lt;/p&gt;

&lt;p&gt;this patch eliminates it completely in place of using the existing thread safe methods in DateField (which this patch makes public/static so they can be used by other classes besides just subclasses)&lt;/p&gt;

&lt;p&gt;this patch includes tests demonstrating that a parse+format roundtrip of years between 0001 and 1000 works fine &amp;#8211; but there is still a problem with negative years (something sublte in SimpleDateFormat that i don't understand yet)&lt;/p&gt;

&lt;p&gt;While working on this, i also noticed a class i was previously unfamiliar with: o.a.s.c.u.DateUtils ... which seems to have yet another cut/paste copy of the broken date formatting code, as well as cut/paste copies of the thread save parsing/formatting code from DateField (except at first glance the DateUtils version is even more broken and doesn't deal with miliseconds properly) ... need to research WTF this is, when it was added (did we release it already?), and if anyone is calling it.&lt;/p&gt;

&lt;p&gt;it should be trivial to make these broken DateUtil parse/format into deprecated proxies to their counterparts in DateField ... or vice versa if people think it makes more sense to have them in a separate util class (although that may complicate &lt;a href="https://issues.apache.org/jira/browse/SOLR-2357" title="Thread Local memory leaks on restart" class="issue-link" data-issue-key="SOLR-2357"&gt;&lt;del&gt;SOLR-2357&lt;/del&gt;&lt;/a&gt; even further)&lt;/p&gt;</comment>
                            <comment id="13030272" author="hossman" created="Fri, 6 May 2011 21:32:49 -0700">&lt;p&gt;Status update.&lt;/p&gt;

&lt;p&gt;After doing some more research: &lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;it seems pretty clear that SimpleDateFormat is fundamentally incapable of formatting negative years (other then using an Era string).&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;the parseDateTime/printDateTime methods in javax.xml.bind.DatatypeConverter &lt;b&gt;should&lt;/b&gt; be the perfect solution &amp;#8211; they specifically exist for dealing with XSD dates.  But in testing they seem to be completely broken as far as the milliseconds and the requirement that "The fractional second string, if present, must not end in '0';"&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;based on all the recommendations I found online, i started investigated JodaTime.  It has an ISODateTimeFormat factory class that looked promising, but it doesn't seem to support any implementations that are designed for dealing with the canonical form, nor did i have much look using the JodaTime DateTimeFormatterBuilder API to construct one.  details are here: &lt;a href="https://sourceforge.net/projects/joda-time/forums/forum/337835/topic/4519752" class="external-link" rel="nofollow"&gt;https://sourceforge.net/projects/joda-time/forums/forum/337835/topic/4519752&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;At this point, barring some really awesome insights from anyone else or the JodaTime forum, I'm thinking that (as much as i hate it) hand rolled date parsing/formatting code may be the way to go once and for all.&lt;/p&gt;

&lt;p&gt;ugh.&lt;/p&gt;
</comment>
                            <comment id="13106613" author="hossman" created="Fri, 16 Sep 2011 10:26:14 -0700">&lt;p&gt;as Nicklas pointed out on the solr-user mailing list, there are really 3 distinct problems here, and there is no reason to get bogged down in a trying to find one hollistic solution for all of them when we can make incremental progress on fixing them individually.&lt;/p&gt;

&lt;p&gt;so i've spun this off into 3 sub issues.&lt;/p&gt;</comment>
                            <comment id="13835701" author="erickerickson" created="Sat, 30 Nov 2013 06:21:06 -0700">&lt;p&gt;2013 Old JIRA cleanup&lt;/p&gt;</comment>
                            <comment id="15218617" author="dsmiley" created="Wed, 30 Mar 2016 12:03:52 -0700">&lt;p&gt;Closing; fixed by &lt;a href="https://issues.apache.org/jira/browse/SOLR-8904" title="Switch from SimpleDateFormat to Java 8 DateTimeFormatter.ISO_INSTANT" class="issue-link" data-issue-key="SOLR-8904"&gt;&lt;del&gt;SOLR-8904&lt;/del&gt;&lt;/a&gt; (using Java 8 time APIs).  There are tests now for these dates.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12498265">SOLR-2357</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310051">
                    <name>Supercedes</name>
                                                                <inwardlinks description="is superceded by">
                                        <issuelink>
            <issuekey id="12953493">SOLR-8904</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12478018" name="SOLR-1899.patch" size="4720" author="hossman" created="Mon, 2 May 2011 19:00:33 -0700"/>
                    </attachments>
                <subtasks>
                            <subtask id="12523359">SOLR-2772</subtask>
                            <subtask id="12523361">SOLR-2773</subtask>
                            <subtask id="12523362">SOLR-2774</subtask>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 30 Nov 2013 13:21:06 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5575</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i03o13:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>19326</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7158] Haversin should use the earth's mean radius, not its max (equitorial)?</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7158</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;Across our spatial modules we seem to disagree about the earth's radius when we model it as a sphere.&lt;/p&gt;

&lt;p&gt;I think in our haversin implementation we use equitorial (maximum) radius, but maybe in spatial3d we use the earth's mean radius.&lt;/p&gt;

&lt;p&gt;I think mean makes more sense: the earth is actually a squashed sphere, so it's polar radius is shorter than its equitorial radius.&lt;/p&gt;

&lt;p&gt;I think it's important, when we model the earth as a sphere, that we pick one radius and try to use that one consistently?&lt;/p&gt;</description>
                <environment/>
        <key id="12955118">LUCENE-7158</key>
            <summary>Haversin should use the earth's mean radius, not its max (equitorial)?</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="mikemccand">Michael McCandless</reporter>
                        <labels>
                    </labels>
                <created>Thu, 31 Mar 2016 15:30:11 -0700</created>
                <updated>Fri, 1 Apr 2016 03:32:02 -0700</updated>
                            <resolved>Fri, 1 Apr 2016 03:32:02 -0700</resolved>
                                                    <fixVersion>master</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="15220782" author="nknize" created="Thu, 31 Mar 2016 15:34:18 -0700">&lt;p&gt;I also propose refactoring &lt;tt&gt;SloppyMath.haversin&lt;/tt&gt; to &lt;tt&gt;o.a.l.geo.GeoUtils&lt;/tt&gt; in core. It's only used for Geo and the reusable WGS constants live in that class. &lt;/p&gt;</comment>
                            <comment id="15220784" author="kwright@metacarta.com" created="Thu, 31 Mar 2016 15:36:03 -0700">&lt;p&gt;+1 to use mean earth radius for haversine computations.  It is the right value to use.&lt;/p&gt;</comment>
                            <comment id="15220795" author="rcmuir" created="Thu, 31 Mar 2016 15:40:42 -0700">&lt;p&gt;+1 but as Nick suggests, it should be forced to be consistent with e.g. bounding box generation. &lt;/p&gt;

&lt;p&gt;We had the problem of multiple haversins before and using different constants is just as bad. I think if a user does a range query vs sorting vs a lucene expressions, they should not see inconsistencies just because we don't organize things properly.&lt;/p&gt;

&lt;p&gt;To me this is far more important than any particular value the constant may have.&lt;/p&gt;</comment>
                            <comment id="15220843" author="mikemccand" created="Thu, 31 Mar 2016 16:16:00 -0700">&lt;blockquote&gt;&lt;p&gt;I also propose refactoring SloppyMath.haversin to o.a.l.geo.GeoUtils in core.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1, but maybe do this separately?&lt;/p&gt;</comment>
                            <comment id="15220853" author="mikemccand" created="Thu, 31 Mar 2016 16:24:55 -0700">&lt;p&gt;Initial patch, however some geo3d tests are angry about the change from 6371009.0 to 6371008.7714 as the mean ... maybe &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daddywri" class="user-hover" rel="daddywri"&gt;Karl Wright&lt;/a&gt; can help fix them?&lt;/p&gt;

&lt;p&gt;A surprising number of places cared greatly about the exact earth's radius &lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/wink.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt;&lt;/p&gt;</comment>
                            <comment id="15220875" author="kwright@metacarta.com" created="Thu, 31 Mar 2016 16:47:50 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mikemccand" class="user-hover" rel="mikemccand"&gt;Michael McCandless&lt;/a&gt; I bet this is just stapling issues.  I will be happy to fix them if my git-fu is good enough.&lt;/p&gt;</comment>
                            <comment id="15220909" author="kwright@metacarta.com" created="Thu, 31 Mar 2016 17:19:42 -0700">&lt;p&gt;Here's an updated patch with the Geo3D tests restapled.&lt;/p&gt;</comment>
                            <comment id="15221118" author="dsmiley" created="Thu, 31 Mar 2016 20:59:37 -0700">&lt;p&gt;+1.  I especially like the URL reference to &lt;a href="http://earth-info.nga.mil/GandG/publications/tr8350.2/wgs84fin.pdf" class="external-link" rel="nofollow"&gt;http://earth-info.nga.mil/GandG/publications/tr8350.2/wgs84fin.pdf&lt;/a&gt; &amp;#8211; it's important to track where our reference data and lifted algorithms come from.&lt;br/&gt;
What do you mean be "restapled"?&lt;/p&gt;</comment>
                            <comment id="15221172" author="kwright@metacarta.com" created="Thu, 31 Mar 2016 22:08:02 -0700">&lt;p&gt;"Stapling" means changing tests that check for explicit numerical values to check for different ones if the underlying constants or calculations change.&lt;/p&gt;</comment>
                            <comment id="15221422" author="mikemccand" created="Fri, 1 Apr 2016 02:20:12 -0700">&lt;p&gt;Thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daddywri" class="user-hover" rel="daddywri"&gt;Karl Wright&lt;/a&gt;, tests pass for me now; I'll push shortly.&lt;/p&gt;</comment>
                            <comment id="15221457" author="jira-bot" created="Fri, 1 Apr 2016 02:39:02 -0700">&lt;p&gt;Commit cf7967cc467d9d697d520fcdf92fcdb52f7ddd4e in lucene-solr's branch refs/heads/master from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=cf7967c" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=cf7967c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7158" title="Haversin should use the earth&amp;#39;s mean radius, not its max (equitorial)?" class="issue-link" data-issue-key="LUCENE-7158"&gt;&lt;del&gt;LUCENE-7158&lt;/del&gt;&lt;/a&gt;: use the same value (from WGS84) for earth's mean radius when we approximate it as a sphere&lt;/p&gt;</comment>
                            <comment id="15221461" author="jira-bot" created="Fri, 1 Apr 2016 02:42:20 -0700">&lt;p&gt;Commit 4ecfa98bdbb3c00d6ab2b9fb9ebb27ec59031352 in lucene-solr's branch refs/heads/branch_6x from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=4ecfa98" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=4ecfa98&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7158" title="Haversin should use the earth&amp;#39;s mean radius, not its max (equitorial)?" class="issue-link" data-issue-key="LUCENE-7158"&gt;&lt;del&gt;LUCENE-7158&lt;/del&gt;&lt;/a&gt;: use the same value (from WGS84) for earth's mean radius when we approximate it as a sphere&lt;/p&gt;</comment>
                            <comment id="15221517" author="jira-bot" created="Fri, 1 Apr 2016 03:31:56 -0700">&lt;p&gt;Commit 48c80f91b8e5cd9b3a9b48e6184bd53e7619e7e3 in lucene-solr's branch refs/heads/branch_6_0 from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=48c80f9" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=48c80f9&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7158" title="Haversin should use the earth&amp;#39;s mean radius, not its max (equitorial)?" class="issue-link" data-issue-key="LUCENE-7158"&gt;&lt;del&gt;LUCENE-7158&lt;/del&gt;&lt;/a&gt;: use the same value (from WGS84) for earth's mean radius when we approximate it as a sphere&lt;/p&gt;

&lt;p&gt;Conflicts:&lt;br/&gt;
	lucene/sandbox/src/test/org/apache/lucene/document/TestLatLonPointDistanceSort.java&lt;br/&gt;
	lucene/spatial/src/java/org/apache/lucene/spatial/util/GeoUtils.java&lt;br/&gt;
	lucene/spatial/src/test/org/apache/lucene/spatial/util/BaseGeoPointTestCase.java&lt;br/&gt;
	lucene/spatial/src/test/org/apache/lucene/spatial/util/TestGeoUtils.java&lt;br/&gt;
	lucene/spatial3d/src/java/org/apache/lucene/spatial3d/Geo3DPoint.java&lt;br/&gt;
	lucene/spatial3d/src/test/org/apache/lucene/spatial3d/TestGeo3DPoint.java&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12796431" name="LUCENE-7158.patch" size="16942" author="kwright@metacarta.com" created="Thu, 31 Mar 2016 17:19:42 -0700"/>
                            <attachment id="12796428" name="LUCENE-7158.patch" size="14405" author="mikemccand" created="Thu, 31 Mar 2016 16:24:55 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 31 Mar 2016 22:34:18 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2vhhj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7149] Test2BPoints.test1D() failure</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7149</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;My Jenkins found a failure on branch_6_0 - reproduces for me at commit 00ffee5:&lt;/p&gt;

&lt;div class="preformatted panel" style="border-width: 1px;"&gt;&lt;div class="preformattedContent panelContent"&gt;
&lt;pre&gt;Checking out Revision d610976261b473031cb70bcb95171379a99a5b3f (refs/remotes/origin/branch_6_0)
[...]
   [junit4] HEARTBEAT J0 PID(11848@localhost): 2016-03-29T09:53:07, stalled for 4863s at: Test2BPoints.test1D
   [junit4] Suite: org.apache.lucene.index.Test2BPoints
   [junit4]   1&amp;gt; TEST: now CheckIndex
   [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=Test2BPoints -Dtests.method=test1D -Dtests.seed=A3E217F94A515C0 -Dtests.nightly=true -Dtests.slow=true -Dtests.locale=sv -Dtests.timezone=Asia/Dili -Dtests.asserts=true -Dtests.file.encoding=US-ASCII
   [junit4] FAILURE 4881s J0 | Test2BPoints.test1D &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: java.lang.AssertionError: expected:&amp;lt;1250&amp;gt; but was:&amp;lt;0&amp;gt;
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([A3E217F94A515C0:139DD275EC5198E4]:0)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.Test2BPoints.test1D(Test2BPoints.java:88)
   [junit4]    &amp;gt; 	at java.lang.Thread.run(Thread.java:745)
   [junit4]   2&amp;gt; NOTE: leaving temporary files on disk at: /slow/jenkins/HDD-workspaces/Lucene-core-weekly-monster-6.0-HDD/lucene/build/core/test/J0/temp/lucene.index.Test2BPoints_A3E217F94A515C0-001
   [junit4]   2&amp;gt; NOTE: test params are: codec=Lucene60, sim=ClassicSimilarity, locale=sv, timezone=Asia/Dili
   [junit4]   2&amp;gt; NOTE: Linux 4.1.0-custom2-amd64 amd64/Oracle Corporation 1.8.0_45 (64-bit)/cpus=16,threads=1,free=627321624,total=2142240768
   [junit4]   2&amp;gt; NOTE: All tests run in this JVM: [TestIntsRef, TestIndexWriterForceMerge, TestSimpleFSLockFactory, TestDirectMonotonic, TestConjunctions, TestBooleanQuery, TestDocInverterPerFieldErrorInfo, TestSentinelIntSet, TestSegmentMerger, TestOmitNorms, TestSpanNearQuery, TestRoaringDocIdSet, TestTopDocsCollector, TestParallelLeafReader, TestDocumentsWriterDeleteQueue, TestTermVectorsReader, FiniteStringsIteratorTest, TestConcurrentMergeScheduler, TestPackedInts, TestReusableStringReader, TestBytesRef, TestToken, TestAllFilesHaveCodecHeader, TestDirectoryReaderReopen, TestAtomicUpdate, TestFastDecompressionMode, TestForUtil, TestSparseFixedBitSet, TestNeverDelete, TestCloseableThreadLocal, TestDoc, TestBytesRefArray, TestSpanFirstQuery, TestDeterminism, TestControlledRealTimeReopenThread, TestWeakIdentityMap, TestReaderWrapperDVTypeCheck, TestPositiveScoresOnlyCollector, TestExitableDirectoryReader, TestPerFieldPostingsFormat2, TestSearcherManager, TestPagedBytes, TestBooleanCoord, TestMultiCollector, TestIndexSearcher, TestFlushByRamOrCountsPolicy, TestExternalCodecs, TestShardSearching, TestIndexWriter, TestSortRescorer, TestSynonymQuery, TestFlex, TestLevenshteinAutomata, TestByteSlices, TestBufferedIndexInput, TestTermsEnum, TestSegmentReader, TestTransactions, TestMultiThreadTermVectors, TestFieldsReader, TestSimpleSearchEquivalence, TestCustomSearcherSort, TestTermsEnum2, TestLegacyNumericUtils, TestIndexWriterOnDiskFull, TestDocCount, TestCachingCollector, TestAutomatonQueryUnicode, TestAttributeSource, TestTotalHitCountCollector, TestRecyclingByteBlockAllocator, TestRamUsageEstimator, TestIsCurrent, TestNamedSPILoader, TestByteBlockPool, TestAssertions, TestCharFilter, TestRollback, TestTwoPhaseCommitTool, TestNot, TestIndexWriterOnJRECrash, Test4GBStoredFields, TestCodecHoldsOpenFiles, MultiCollectorTest, TestNGramPhraseQuery, TestSimpleAttributeImpl, TestIndexCommit, TestTerm, Test2BPostingsBytes, Test2BPagedBytes, TestBytesRefAttImpl, TestPackedTokenAttributeImpl, TestGrowableByteArrayDataOutput, TestBlockPostingsFormat, TestBlockPostingsFormat2, TestLucene50StoredFieldsFormat, TestLucene53NormsFormat, TestLucene54DocValuesFormat, TestLucene60PointsFormat, TestFieldType, Test2BPoints]
   [junit4] Completed [414/414 (1!)] on J0 in 116707.79s, 2 tests, 1 failure &amp;lt;&amp;lt;&amp;lt; FAILURES!
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment/>
        <key id="12954338">LUCENE-7149</key>
            <summary>Test2BPoints.test1D() failure</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="steve_rowe">Steve Rowe</reporter>
                        <labels>
                    </labels>
                <created>Tue, 29 Mar 2016 09:24:01 -0700</created>
                <updated>Tue, 29 Mar 2016 15:52:53 -0700</updated>
                            <resolved>Tue, 29 Mar 2016 15:52:53 -0700</resolved>
                                    <version>6.0</version>
                                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="15216686" author="mikemccand" created="Tue, 29 Mar 2016 12:19:28 -0700">&lt;p&gt;Whoa, thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe" class="user-hover" rel="steve_rowe"&gt;Steve Rowe&lt;/a&gt; ... I think this is a test bug that was already fixed in 6.x but I failed to backport for 6.0.  I'll fix!&lt;/p&gt;</comment>
                            <comment id="15217008" author="jira-bot" created="Tue, 29 Mar 2016 15:52:21 -0700">&lt;p&gt;Commit 0db92bf6c2d9fa48bbce223407ba3b2c5956b463 in lucene-solr's branch refs/heads/branch_6_0 from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=0db92bf" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=0db92bf&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7149" title="Test2BPoints.test1D() failure" class="issue-link" data-issue-key="LUCENE-7149"&gt;&lt;del&gt;LUCENE-7149&lt;/del&gt;&lt;/a&gt;: fix wrong test assert&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 29 Mar 2016 19:19:28 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2vcnz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7144] TestFieldMaskingSpanQuery suite failure: 3 segments exist after a forceMerge(1)</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7144</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;My Jenkins found a reproducible failure on master:&lt;/p&gt;

&lt;div class="preformatted panel" style="border-width: 1px;"&gt;&lt;div class="preformattedContent panelContent"&gt;
&lt;pre&gt;Checking out Revision 7b93fc46b1e284494a500f4df541269bdfa67dcf (refs/remotes/origin/master)
[...]
   [junit4] Suite: org.apache.lucene.search.spans.TestFieldMaskingSpanQuery
   [junit4]   2&amp;gt; NOTE: test params are: codec=Asserting(Lucene60): {gender=FSTOrd50, last=PostingsFormat(name=LuceneVarGapDocFreqInterval), id=BlockTreeOrds(blocksize=128), first=Lucene50(blocksize=128)}, docValues:{}, maxPointsInLeafNode=734, maxMBSortInHeap=5.661209237449429, sim=RandomSimilarity(queryNorm=true,coord=no): {gender=DFR I(n)3(800.0), last=DFR I(n)L1, id=DFR I(n)L1, first=IB SPL-L2}, locale=fr, timezone=Etc/GMT+11
   [junit4]   2&amp;gt; NOTE: Linux 4.1.0-custom2-amd64 amd64/Oracle Corporation 1.8.0_45 (64-bit)/cpus=16,threads=1,free=213068040,total=315621376
   [junit4]   2&amp;gt; NOTE: All tests run in this JVM: [TestInfoStream, TestBooleanOr, TestBooleanCoord, TestNRTThreads, TestMultiset, TestTopDocsCollector, TestIndexWriterMaxDocs, TestNIOFSDirectory, TestIntArrayDocIdSet, TestDocBoost, TestPositiveScoresOnlyCollector, TestIntBlockPool, TestLegacyNumericUtils, TestPersistentSnapshotDeletionPolicy, TestIndexWriterOnJRECrash, TestIndexWriterOutOfFileDescriptors, TestTimSorter, TestIndexWriterUnicode, TestSearcherManager, TestUTF32ToUTF8, TestLucene50CompoundFormat, TestFieldCacheRewriteMethod, TestVirtualMethod, TestSegmentInfos, TestFuzzyQuery, TestScoreCachingWrappingScorer, TestSpansEnum, TestMultiPhraseQuery, TestTragicIndexWriterDeadlock, TestIndexWriterNRTIsCurrent, TestPointQueries, TestMultiTermConstantScore, TestComplexExplanationsOfNonMatches, TestDocValues, TestSpanCollection, TestTopFieldCollector, TestIndexSearcher, Test2BPostings, TestBM25Similarity, TestRollback, TestSimpleAttributeImpl, TestDocumentsWriterStallControl, TestSearch, TestBinaryDocValuesUpdates, TestIsCurrent, TestTermVectorsReader, TestUniqueTermCount, TestRollingBuffer, TestSleepingLockWrapper, TestSortedSetSelector, TestEarlyTermination, TestConjunctions, TestArrayUtil, TestSpanNearQuery, Test2BSortedDocValuesOrds, TestNumericTokenStream, TestSparseFixedBitSet, TestNotDocIdSet, TestDirectory, TestBytesRefAttImpl, TestSortRescorer, TestDeterminism, TestDocumentWriter, TestParallelLeafReader, TestIndexWriterLockRelease, TestTermdocPerf, TestSloppyPhraseQuery, TestSpanFirstQuery, TestApproximationSearchEquivalence, TestConsistentFieldNumbers, TestRateLimiter, TestSloppyMath, TestHighCompressionMode, TestSubScorerFreqs, TestBKD, TestRegExp, TestOmitPositions, TestMergePolicyWrapper, TestPerFieldDocValuesFormat, TestTotalHitCountCollector, TestAddIndexes, TestSegmentMerger, TestForceMergeForever, TestLSBRadixSorter, TestNRTCachingDirectory, TestLucene50StoredFieldsFormatHighCompression, TestIndexWriterReader, TestSimilarity, TestRoaringDocIdSet, TestFieldMaskingSpanQuery]
   [junit4]   2&amp;gt; NOTE: download the large Jenkins line-docs file by running 'ant get-jenkins-line-docs' in the lucene directory.
   [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=TestFieldMaskingSpanQuery -Dtests.seed=EEB9C1523889BD0F -Dtests.slow=true -Dtests.linedocsfile=/home/jenkins/lucene-data/enwiki.random.lines.txt -Dtests.locale=fr -Dtests.timezone=Etc/GMT+11 -Dtests.asserts=true -Dtests.file.encoding=UTF-8
   [junit4] ERROR   0.00s J1 | TestFieldMaskingSpanQuery (suite) &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: java.lang.IllegalArgumentException: StandardDirectoryReader(segments_1:8 _0(7.0.0):c2 _1(7.0.0):c2 _2(7.0.0):c1) has 3 segments instead of exactly one
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([EEB9C1523889BD0F]:0)
   [junit4]    &amp;gt; 	at org.apache.lucene.util.LuceneTestCase.getOnlyLeafReader(LuceneTestCase.java:789)
   [junit4]    &amp;gt; 	at org.apache.lucene.search.spans.TestFieldMaskingSpanQuery.beforeClass(TestFieldMaskingSpanQuery.java:121)
   [junit4]    &amp;gt; 	at java.lang.Thread.run(Thread.java:745)
   [junit4] Completed [171/415 (1!)] on J1 in 0.02s, 0 tests, 1 error &amp;lt;&amp;lt;&amp;lt; FAILURES!
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;From &lt;tt&gt;TestFieldMaskingSpanQuery.beforeClass()&lt;/tt&gt;:&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
118:    reader = writer.getReader();
119:    writer.forceMerge(1);
120:    writer.close();
121:    searcher = &lt;span class="code-keyword"&gt;new&lt;/span&gt; IndexSearcher(getOnlyLeafReader(reader));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment/>
        <key id="12953900">LUCENE-7144</key>
            <summary>TestFieldMaskingSpanQuery suite failure: 3 segments exist after a forceMerge(1)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="steve_rowe">Steve Rowe</reporter>
                        <labels>
                    </labels>
                <created>Sun, 27 Mar 2016 22:15:54 -0700</created>
                <updated>Mon, 28 Mar 2016 06:42:41 -0700</updated>
                            <resolved>Mon, 28 Mar 2016 06:42:41 -0700</resolved>
                                                    <fixVersion>master</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="15214202" author="jira-bot" created="Mon, 28 Mar 2016 06:40:55 -0700">&lt;p&gt;Commit 67ca5499a3314a5418073c079954f4eabd92d20f in lucene-solr's branch refs/heads/master from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=67ca549" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=67ca549&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7144" title="TestFieldMaskingSpanQuery suite failure: 3 segments exist after a forceMerge(1)" class="issue-link" data-issue-key="LUCENE-7144"&gt;&lt;del&gt;LUCENE-7144&lt;/del&gt;&lt;/a&gt;: forceMerge before pulling reader&lt;/p&gt;</comment>
                            <comment id="15214203" author="jira-bot" created="Mon, 28 Mar 2016 06:41:27 -0700">&lt;p&gt;Commit 51feadd185c4624294684f27f816faf65aba3bde in lucene-solr's branch refs/heads/branch_6x from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=51feadd" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=51feadd&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7144" title="TestFieldMaskingSpanQuery suite failure: 3 segments exist after a forceMerge(1)" class="issue-link" data-issue-key="LUCENE-7144"&gt;&lt;del&gt;LUCENE-7144&lt;/del&gt;&lt;/a&gt;: forceMerge before pulling reader&lt;/p&gt;</comment>
                            <comment id="15214206" author="jira-bot" created="Mon, 28 Mar 2016 06:42:09 -0700">&lt;p&gt;Commit 00ffee55299c3e6e2fe6541d08afb2e6572fe29f in lucene-solr's branch refs/heads/branch_6_0 from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=00ffee5" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=00ffee5&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7144" title="TestFieldMaskingSpanQuery suite failure: 3 segments exist after a forceMerge(1)" class="issue-link" data-issue-key="LUCENE-7144"&gt;&lt;del&gt;LUCENE-7144&lt;/del&gt;&lt;/a&gt;: forceMerge before pulling reader&lt;/p&gt;</comment>
                            <comment id="15214207" author="mikemccand" created="Mon, 28 Mar 2016 06:42:41 -0700">&lt;p&gt;I committed a fix ... silly test bug.&lt;/p&gt;

&lt;p&gt;Thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe" class="user-hover" rel="steve_rowe"&gt;Steve Rowe&lt;/a&gt;!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 28 Mar 2016 13:40:55 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2v9z3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7139] Geo3d Vincenty distance method broken</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7139</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;There is a PlanetModel.surfaceDistance() method in Geo3D that computes the Vincenty distance.  This is mostly a convenience but is also reasonable to  include for tests.  The current implementation, however, is broken.&lt;/p&gt;</description>
                <environment/>
        <key id="12953564">LUCENE-7139</key>
            <summary>Geo3d Vincenty distance method broken</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="kwright@metacarta.com">Karl Wright</reporter>
                        <labels>
                    </labels>
                <created>Fri, 25 Mar 2016 03:34:58 -0700</created>
                <updated>Fri, 25 Mar 2016 05:25:17 -0700</updated>
                            <resolved>Fri, 25 Mar 2016 04:59:55 -0700</resolved>
                                                    <fixVersion>master</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="15211702" author="kwright@metacarta.com" created="Fri, 25 Mar 2016 04:12:26 -0700">&lt;p&gt;Here's the fix.&lt;/p&gt;</comment>
                            <comment id="15211738" author="jira-bot" created="Fri, 25 Mar 2016 04:58:25 -0700">&lt;p&gt;Commit b8feb92271c62b3bc1c24e2e3610ecd1cf646eab in lucene-solr's branch refs/heads/master from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b8feb92" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b8feb92&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7139" title="Geo3d Vincenty distance method broken" class="issue-link" data-issue-key="LUCENE-7139"&gt;&lt;del&gt;LUCENE-7139&lt;/del&gt;&lt;/a&gt;: fix bugs in geo3d's vincenty distance implementation&lt;/p&gt;</comment>
                            <comment id="15211739" author="jira-bot" created="Fri, 25 Mar 2016 04:59:05 -0700">&lt;p&gt;Commit 9726903c996ff581868395dbd41bb8e21209f7c6 in lucene-solr's branch refs/heads/branch_6x from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9726903" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9726903&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7139" title="Geo3d Vincenty distance method broken" class="issue-link" data-issue-key="LUCENE-7139"&gt;&lt;del&gt;LUCENE-7139&lt;/del&gt;&lt;/a&gt;: fix bugs in geo3d's vincenty distance implementation&lt;/p&gt;</comment>
                            <comment id="15211740" author="jira-bot" created="Fri, 25 Mar 2016 04:59:42 -0700">&lt;p&gt;Commit fb79a4a01b49e6257fb6db42dd28c33d9472d792 in lucene-solr's branch refs/heads/branch_6_0 from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=fb79a4a" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=fb79a4a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7139" title="Geo3d Vincenty distance method broken" class="issue-link" data-issue-key="LUCENE-7139"&gt;&lt;del&gt;LUCENE-7139&lt;/del&gt;&lt;/a&gt;: fix bugs in geo3d's vincenty distance implementation&lt;/p&gt;</comment>
                            <comment id="15211741" author="mikemccand" created="Fri, 25 Mar 2016 04:59:55 -0700">&lt;p&gt;Thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daddywri" class="user-hover" rel="daddywri"&gt;Karl Wright&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="15211755" author="jira-bot" created="Fri, 25 Mar 2016 05:22:38 -0700">&lt;p&gt;Commit c498fcdc439d94e165e66f6318a16bed6895533b in lucene-solr's branch refs/heads/master from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c498fcd" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c498fcd&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7139" title="Geo3d Vincenty distance method broken" class="issue-link" data-issue-key="LUCENE-7139"&gt;&lt;del&gt;LUCENE-7139&lt;/del&gt;&lt;/a&gt;: move these fixed tests out of the loop&lt;/p&gt;</comment>
                            <comment id="15211756" author="jira-bot" created="Fri, 25 Mar 2016 05:24:27 -0700">&lt;p&gt;Commit 1d64c47aa79c29a8d31f5536b482ea17995a15eb in lucene-solr's branch refs/heads/branch_6x from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=1d64c47" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=1d64c47&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7139" title="Geo3d Vincenty distance method broken" class="issue-link" data-issue-key="LUCENE-7139"&gt;&lt;del&gt;LUCENE-7139&lt;/del&gt;&lt;/a&gt;: move these fixed tests out of the loop&lt;/p&gt;</comment>
                            <comment id="15211759" author="jira-bot" created="Fri, 25 Mar 2016 05:25:17 -0700">&lt;p&gt;Commit 33acb297fa7d8de53563ee589fb1da7d292bef46 in lucene-solr's branch refs/heads/branch_6_0 from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=33acb29" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=33acb29&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7139" title="Geo3d Vincenty distance method broken" class="issue-link" data-issue-key="LUCENE-7139"&gt;&lt;del&gt;LUCENE-7139&lt;/del&gt;&lt;/a&gt;: move these fixed tests out of the loop&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12795398" name="LUCENE-7139.patch" size="7488" author="kwright@metacarta.com" created="Fri, 25 Mar 2016 04:12:26 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 25 Mar 2016 11:58:25 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2v7wf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7133] PointRangeQuery and PointInSetQuery .equals and .hashCode methods are buggy</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7133</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;Caught while cutting over &lt;tt&gt;spatial-extras&lt;/tt&gt; from &lt;tt&gt;LegacyDoubleField&lt;/tt&gt; to &lt;tt&gt;DoublePoint&lt;/tt&gt; field:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;PointRangeQuery.equals()&lt;/tt&gt; and &lt;tt&gt;.hashCode&lt;/tt&gt; fails with a false positive if the Ranges are identical but &lt;tt&gt;field&lt;/tt&gt; is different.&lt;/p&gt;</description>
                <environment/>
        <key id="12952948">LUCENE-7133</key>
            <summary>PointRangeQuery and PointInSetQuery .equals and .hashCode methods are buggy</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mikemccand">Michael McCandless</assignee>
                                    <reporter username="nknize">Nicholas Knize</reporter>
                        <labels>
                    </labels>
                <created>Wed, 23 Mar 2016 12:23:01 -0700</created>
                <updated>Wed, 23 Mar 2016 14:21:15 -0700</updated>
                            <resolved>Wed, 23 Mar 2016 14:21:14 -0700</resolved>
                                    <version>master</version>
                    <version>6.0</version>
                                    <fixVersion>master</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="15209008" author="mikemccand" created="Wed, 23 Mar 2016 12:39:29 -0700">&lt;p&gt;Ugh, nice catch!!!  First equals failed to return true, now it fails to return false!&lt;/p&gt;</comment>
                            <comment id="15209107" author="mikemccand" created="Wed, 23 Mar 2016 13:31:28 -0700">&lt;p&gt;Patch, I think it's ready.&lt;/p&gt;</comment>
                            <comment id="15209133" author="nknize" created="Wed, 23 Mar 2016 13:46:39 -0700">&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="15209180" author="jira-bot" created="Wed, 23 Mar 2016 14:10:50 -0700">&lt;p&gt;Commit 97b62703379e25da7697fe8e7eac266f1a8ae82f in lucene-solr's branch refs/heads/master from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=97b6270" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=97b6270&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7133" title="PointRangeQuery and PointInSetQuery .equals and .hashCode methods are buggy" class="issue-link" data-issue-key="LUCENE-7133"&gt;&lt;del&gt;LUCENE-7133&lt;/del&gt;&lt;/a&gt;: check field name in equals/hashCode for point queries&lt;/p&gt;</comment>
                            <comment id="15209181" author="jira-bot" created="Wed, 23 Mar 2016 14:11:43 -0700">&lt;p&gt;Commit 064f599cc8becb6a7383b45b8effe0ae01711661 in lucene-solr's branch refs/heads/branch_6x from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=064f599" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=064f599&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7133" title="PointRangeQuery and PointInSetQuery .equals and .hashCode methods are buggy" class="issue-link" data-issue-key="LUCENE-7133"&gt;&lt;del&gt;LUCENE-7133&lt;/del&gt;&lt;/a&gt;: check field name in equals/hashCode for point queries&lt;/p&gt;</comment>
                            <comment id="15209195" author="jira-bot" created="Wed, 23 Mar 2016 14:20:41 -0700">&lt;p&gt;Commit d05954f17c4b68e10b73c1d16729c1d2e781b0a9 in lucene-solr's branch refs/heads/branch_6_0 from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d05954f" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d05954f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7133" title="PointRangeQuery and PointInSetQuery .equals and .hashCode methods are buggy" class="issue-link" data-issue-key="LUCENE-7133"&gt;&lt;del&gt;LUCENE-7133&lt;/del&gt;&lt;/a&gt;: check field name in equals/hashCode for point queries&lt;/p&gt;

&lt;p&gt;Conflicts:&lt;br/&gt;
	lucene/spatial/src/test/org/apache/lucene/spatial/util/BaseGeoPointTestCase.java&lt;/p&gt;</comment>
                            <comment id="15209196" author="mikemccand" created="Wed, 23 Mar 2016 14:21:15 -0700">&lt;p&gt;Thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nknize" class="user-hover" rel="nknize"&gt;Nicholas Knize&lt;/a&gt;!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12795058" name="LUCENE-7133.patch" size="14978" author="mikemccand" created="Wed, 23 Mar 2016 13:31:28 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 23 Mar 2016 19:39:29 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2v43j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7128] Fix spatial and sandbox geo APIs to consistently take lat before lon</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7128</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;Right now sometimes it's lat, lon and other times it's lon, lat which&lt;br/&gt;
is just asking for horrors of biblical proportions.&lt;/p&gt;

&lt;p&gt;I went through and carefully fixed them to take lat, lon in all places&lt;br/&gt;
I could find, and renamed y -&amp;gt; lat and x -&amp;gt; lon.  I also removed&lt;br/&gt;
unused code, or code only called from tests: I think Lucene shouldn't&lt;br/&gt;
just export spatial APIs unless we also ourselves need them for&lt;br/&gt;
indexing and searching.  Finally, I tried to shrink wrap the APIs,&lt;br/&gt;
making previously public apis private if nobody external invoked them.&lt;/p&gt;</description>
                <environment/>
        <key id="12952384">LUCENE-7128</key>
            <summary>Fix spatial and sandbox geo APIs to consistently take lat before lon</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mikemccand">Michael McCandless</assignee>
                                    <reporter username="mikemccand">Michael McCandless</reporter>
                        <labels>
                    </labels>
                <created>Tue, 22 Mar 2016 03:19:06 -0700</created>
                <updated>Tue, 22 Mar 2016 15:50:33 -0700</updated>
                            <resolved>Tue, 22 Mar 2016 09:12:42 -0700</resolved>
                                                    <fixVersion>master</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="15206123" author="mikemccand" created="Tue, 22 Mar 2016 03:20:00 -0700">&lt;p&gt;Here's a rote (but large!) patch ... I think I got all places.&lt;/p&gt;

&lt;p&gt;Please ignore all the X renames; I will rename them all back before committing ...&lt;/p&gt;</comment>
                            <comment id="15206243" author="rcmuir" created="Tue, 22 Mar 2016 05:11:09 -0700">&lt;p&gt;I tripped up on this very issue (lon/lat vs lat/lon) several times yesterday just working on tests. &lt;/p&gt;

&lt;p&gt;big +1 for fixing this issue! its a real one. We just gotta bite the bullet and fix it now.&lt;/p&gt;
</comment>
                            <comment id="15206340" author="mikemccand" created="Tue, 22 Mar 2016 06:27:51 -0700">&lt;p&gt;Thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt; ... I'll rename the X's off and push.&lt;/p&gt;</comment>
                            <comment id="15206617" author="jira-bot" created="Tue, 22 Mar 2016 08:51:07 -0700">&lt;p&gt;Commit 275a259b1fa0d94aec95f554c2c7451b8678bd8e in lucene-solr's branch refs/heads/master from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=275a259" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=275a259&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7128" title="Fix spatial and sandbox geo APIs to consistently take lat before lon" class="issue-link" data-issue-key="LUCENE-7128"&gt;&lt;del&gt;LUCENE-7128&lt;/del&gt;&lt;/a&gt;: clean up new geo APIs to consistently take lat before lon, make methods private when possible, use lat/lon instead of y/x naming, remove unused code&lt;/p&gt;</comment>
                            <comment id="15206627" author="jira-bot" created="Tue, 22 Mar 2016 08:53:05 -0700">&lt;p&gt;Commit c5da271b9d9b05e31a592b8bbdb416529a2c1770 in lucene-solr's branch refs/heads/branch_6x from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c5da271" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c5da271&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7128" title="Fix spatial and sandbox geo APIs to consistently take lat before lon" class="issue-link" data-issue-key="LUCENE-7128"&gt;&lt;del&gt;LUCENE-7128&lt;/del&gt;&lt;/a&gt;: clean up new geo APIs to consistently take lat before lon, make methods private when possible, use lat/lon instead of y/x naming, remove unused code&lt;/p&gt;</comment>
                            <comment id="15206672" author="jira-bot" created="Tue, 22 Mar 2016 09:12:23 -0700">&lt;p&gt;Commit 09013e09761c1493342826088bef0c62c9233810 in lucene-solr's branch refs/heads/branch_6_0 from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=09013e0" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=09013e0&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7128" title="Fix spatial and sandbox geo APIs to consistently take lat before lon" class="issue-link" data-issue-key="LUCENE-7128"&gt;&lt;del&gt;LUCENE-7128&lt;/del&gt;&lt;/a&gt;: clean up new geo APIs to consistently take lat before lon, make methods private when possible, use lat/lon instead of y/x naming, remove unused code&lt;/p&gt;</comment>
                            <comment id="15206673" author="mikemccand" created="Tue, 22 Mar 2016 09:12:42 -0700">&lt;p&gt;Thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="15207422" author="jira-bot" created="Tue, 22 Mar 2016 15:20:04 -0700">&lt;p&gt;Commit 99c3bb23710b22bdfb6908ea587b24308bf50ba9 in lucene-solr's branch refs/heads/master from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=99c3bb2" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=99c3bb2&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7128" title="Fix spatial and sandbox geo APIs to consistently take lat before lon" class="issue-link" data-issue-key="LUCENE-7128"&gt;&lt;del&gt;LUCENE-7128&lt;/del&gt;&lt;/a&gt;: fix a few more lon/lat places; remove more dead code&lt;/p&gt;</comment>
                            <comment id="15207424" author="jira-bot" created="Tue, 22 Mar 2016 15:20:59 -0700">&lt;p&gt;Commit f2234dccb35ac11e1028890b20b61cdd2c9b9bf7 in lucene-solr's branch refs/heads/branch_6x from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f2234dc" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f2234dc&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7128" title="Fix spatial and sandbox geo APIs to consistently take lat before lon" class="issue-link" data-issue-key="LUCENE-7128"&gt;&lt;del&gt;LUCENE-7128&lt;/del&gt;&lt;/a&gt;: fix a few more lon/lat places; remove more dead code&lt;/p&gt;</comment>
                            <comment id="15207469" author="jira-bot" created="Tue, 22 Mar 2016 15:50:33 -0700">&lt;p&gt;Commit 137dd158fa5d4a1b1d6ad7cb369c69738f02401d in lucene-solr's branch refs/heads/branch_6_0 from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=137dd15" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=137dd15&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7128" title="Fix spatial and sandbox geo APIs to consistently take lat before lon" class="issue-link" data-issue-key="LUCENE-7128"&gt;&lt;del&gt;LUCENE-7128&lt;/del&gt;&lt;/a&gt;: fix a few more lon/lat places; remove more dead code&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12794730" name="LUCENE-7128.patch" size="249661" author="mikemccand" created="Tue, 22 Mar 2016 03:20:00 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 22 Mar 2016 12:11:09 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2v0m7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7126] GeoPointDistanceRangeQuery not valid for multi-valued docs</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7126</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;This query currently takes minimum and maximum range and rewrites to a boolean query of two distance queries (big NOT little).&lt;/p&gt;

&lt;p&gt;The problem is, this rewrite is not correct if a document has multiple values in the field.&lt;/p&gt;

&lt;p&gt;Do we really need to support this query? What is the use case? Is it a relic of people doing things like pagination or distance faceting in a very slow way? We can do these things more efficiently with other mechanisms (e.g. distance sort for LatLonPoint works well with searchAfter, can be ported to geopoint).&lt;/p&gt;</description>
                <environment/>
        <key id="12952312">LUCENE-7126</key>
            <summary>GeoPointDistanceRangeQuery not valid for multi-valued docs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rcmuir">Robert Muir</reporter>
                        <labels>
                    </labels>
                <created>Mon, 21 Mar 2016 21:29:35 -0700</created>
                <updated>Mon, 28 Mar 2016 05:54:02 -0700</updated>
                            <resolved>Mon, 28 Mar 2016 05:54:02 -0700</resolved>
                                                    <fixVersion>master</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="15206347" author="mikemccand" created="Tue, 22 Mar 2016 06:32:48 -0700">&lt;p&gt;Whoa, that's a good catch.  +1 to remove it.&lt;/p&gt;</comment>
                            <comment id="15209187" author="nknize" created="Wed, 23 Mar 2016 14:13:42 -0700">&lt;p&gt;It was there to support the doughnut search use-case. The other problem with this boolean rewrite is that it visit ranges twice. Super inefficient. I was going to update the GeoAPIs to accept a min/max to solve this, but I agree, this just adds unnecessary complexity. +100 for removing it and accomplishing the doughnut search using a distance sort.  &lt;/p&gt;</comment>
                            <comment id="15213592" author="mikemccand" created="Sun, 27 Mar 2016 12:20:00 -0700">&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="15214138" author="jira-bot" created="Mon, 28 Mar 2016 05:19:02 -0700">&lt;p&gt;Commit 9a08113a53f0f526c66e1915423fb17809871995 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9a08113" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9a08113&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7126" title="GeoPointDistanceRangeQuery not valid for multi-valued docs" class="issue-link" data-issue-key="LUCENE-7126"&gt;&lt;del&gt;LUCENE-7126&lt;/del&gt;&lt;/a&gt;: GeoPointDistanceRangeQuery not valid for multi-valued docs&lt;/p&gt;</comment>
                            <comment id="15214147" author="jira-bot" created="Mon, 28 Mar 2016 05:32:52 -0700">&lt;p&gt;Commit d8dd06f422614961b029384c379e96a732fd7476 in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d8dd06f" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d8dd06f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7126" title="GeoPointDistanceRangeQuery not valid for multi-valued docs" class="issue-link" data-issue-key="LUCENE-7126"&gt;&lt;del&gt;LUCENE-7126&lt;/del&gt;&lt;/a&gt;: GeoPointDistanceRangeQuery not valid for multi-valued docs&lt;/p&gt;</comment>
                            <comment id="15214156" author="jira-bot" created="Mon, 28 Mar 2016 05:53:49 -0700">&lt;p&gt;Commit 8b9ce1cfd02f099826cff5250c90b045219044ff in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=8b9ce1c" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=8b9ce1c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7126" title="GeoPointDistanceRangeQuery not valid for multi-valued docs" class="issue-link" data-issue-key="LUCENE-7126"&gt;&lt;del&gt;LUCENE-7126&lt;/del&gt;&lt;/a&gt;: GeoPointDistanceRangeQuery not valid for multi-valued docs&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12795559" name="LUCENE-7126.patch" size="14111" author="rcmuir" created="Sun, 27 Mar 2016 12:00:59 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 22 Mar 2016 13:32:48 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2v067:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7123] deduplicate/cleanup spatial distance</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7123</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;Currently there is a bit of a mess here: SloppyMath.haversin is slightly different from GeoDistanceUtils.haversin, the latter is actually slightly faster and uses a simple fixed earth diameter (which makes calculations easier too).&lt;/p&gt;

&lt;p&gt;But one of these returns meters, the other kilometers. Furthermore lucene/spatial now uses some sin/tan functions that were added to sloppymath with some accuracy guarantees (which are untested, and not quite correct). Lucene/spatial queries also inconsistently mix the two different functions together for various purposes and this just causes headaches. Its tests did this recently too.&lt;/p&gt;

&lt;p&gt;We need to clean this up, otherwise users will be confused. E.G. they will see different results from expressions than from queries and not understand.&lt;/p&gt;</description>
                <environment/>
        <key id="12951933">LUCENE-7123</key>
            <summary>deduplicate/cleanup spatial distance</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rcmuir">Robert Muir</reporter>
                        <labels>
                    </labels>
                <created>Sun, 20 Mar 2016 21:31:55 -0700</created>
                <updated>Mon, 21 Mar 2016 08:53:02 -0700</updated>
                            <resolved>Mon, 21 Mar 2016 08:53:02 -0700</resolved>
                                                    <fixVersion>master</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="15203696" author="rcmuir" created="Sun, 20 Mar 2016 21:37:48 -0700">&lt;p&gt;Here is a patch:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;adds haversinMeters to SloppyMath and cuts everything over to it.&lt;/li&gt;
	&lt;li&gt;adds a test that this is within 0.01MM of the actual haversin result (if you were to use slower trig functions).&lt;/li&gt;
	&lt;li&gt;moves out sin/tan stuff to the geoutils class that is using it. There is a TODO to remove these further.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I did benchmarking and testing as well. I think its ready.&lt;/p&gt;</comment>
                            <comment id="15203719" author="rcmuir" created="Sun, 20 Mar 2016 22:05:01 -0700">&lt;p&gt;updated patch: caught some typos/comments reviewing.&lt;/p&gt;</comment>
                            <comment id="15203873" author="mikemccand" created="Mon, 21 Mar 2016 01:03:29 -0700">&lt;p&gt;+1, thank you for cleaning this up &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;, it really is confusing now!  And it's awesome to get &lt;tt&gt;Meters&lt;/tt&gt; in the name.&lt;/p&gt;

&lt;p&gt;Should we add &lt;tt&gt;@lucene.experimental&lt;/tt&gt; to these APIs?&lt;/p&gt;</comment>
                            <comment id="15204103" author="rcmuir" created="Mon, 21 Mar 2016 05:32:23 -0700">&lt;p&gt;I'm rejecting lucene.internal/lucene.experimental. I helped add the mechanism but I regret it: I think its a cop-out. Instead the problem is too much shit being made public without any thought to the API. I am going to clean this stuff up, it is just going to take time.&lt;/p&gt;</comment>
                            <comment id="15204207" author="mikemccand" created="Mon, 21 Mar 2016 06:54:00 -0700">&lt;blockquote&gt;&lt;p&gt;I'm rejecting lucene.internal/lucene.experimental.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;OK &lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/smile.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt;&lt;/p&gt;</comment>
                            <comment id="15204354" author="jira-bot" created="Mon, 21 Mar 2016 07:34:15 -0700">&lt;p&gt;Commit ce3114233bdc45e71a315cb6ece64475d2d6b1d4 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ce31142" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ce31142&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7123" title="deduplicate/cleanup spatial distance" class="issue-link" data-issue-key="LUCENE-7123"&gt;&lt;del&gt;LUCENE-7123&lt;/del&gt;&lt;/a&gt;: deduplicate/cleanup spatial distance&lt;/p&gt;</comment>
                            <comment id="15204394" author="jira-bot" created="Mon, 21 Mar 2016 07:57:11 -0700">&lt;p&gt;Commit 0b221826a397eb54b8c9ace3c4d940818d374b28 in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=0b22182" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=0b22182&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7123" title="deduplicate/cleanup spatial distance" class="issue-link" data-issue-key="LUCENE-7123"&gt;&lt;del&gt;LUCENE-7123&lt;/del&gt;&lt;/a&gt;: deduplicate/cleanup spatial distance&lt;/p&gt;</comment>
                            <comment id="15204492" author="jira-bot" created="Mon, 21 Mar 2016 08:52:42 -0700">&lt;p&gt;Commit c49e761c1bac84efa1e92a6a7b0f2169bba2612a in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c49e761" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c49e761&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7123" title="deduplicate/cleanup spatial distance" class="issue-link" data-issue-key="LUCENE-7123"&gt;&lt;del&gt;LUCENE-7123&lt;/del&gt;&lt;/a&gt;: deduplicate/cleanup spatial distance&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12794466" name="LUCENE-7123.patch" size="66436" author="rcmuir" created="Sun, 20 Mar 2016 22:05:01 -0700"/>
                            <attachment id="12794464" name="LUCENE-7123.patch" size="66437" author="rcmuir" created="Sun, 20 Mar 2016 21:37:48 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 21 Mar 2016 08:03:29 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2uxtz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7118] Remove multidimensional arrays from PointRangeQuery</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7118</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;This use of byte[][] has caused two bugs: &lt;a href="https://issues.apache.org/jira/browse/LUCENE-7085" title="PointRangeQuery.equals does not work" class="issue-link" data-issue-key="LUCENE-7085"&gt;&lt;del&gt;LUCENE-7085&lt;/del&gt;&lt;/a&gt; and &lt;a href="https://issues.apache.org/jira/browse/LUCENE-7117" title="PointRangeQuery.hashCode is inconsistent" class="issue-link" data-issue-key="LUCENE-7117"&gt;&lt;del&gt;LUCENE-7117&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;It is not necessary, and causes code duplication in most Point classes because they have to have a &lt;tt&gt;pack()&lt;/tt&gt; that encodes to byte[] for the indexer but a &lt;tt&gt;encode()&lt;/tt&gt; or similar that makes multi-D byte[][] for just this query.&lt;/p&gt;</description>
                <environment/>
        <key id="12951593">LUCENE-7118</key>
            <summary>Remove multidimensional arrays from PointRangeQuery</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rcmuir">Robert Muir</reporter>
                        <labels>
                    </labels>
                <created>Fri, 18 Mar 2016 11:46:13 -0700</created>
                <updated>Sun, 20 Mar 2016 13:50:58 -0700</updated>
                            <resolved>Sun, 20 Mar 2016 13:38:58 -0700</resolved>
                                                    <fixVersion>master</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="15201953" author="rcmuir" created="Fri, 18 Mar 2016 11:47:21 -0700">&lt;p&gt;here is a patch.&lt;/p&gt;</comment>
                            <comment id="15201958" author="mikemccand" created="Fri, 18 Mar 2016 11:49:27 -0700">&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;byte[][] is deadly &lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/smile.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt;&lt;/p&gt;</comment>
                            <comment id="15201966" author="nknize" created="Fri, 18 Mar 2016 11:55:01 -0700">&lt;p&gt;Nice! +1 for 6.0&lt;/p&gt;</comment>
                            <comment id="15202067" author="jpountz" created="Fri, 18 Mar 2016 13:09:58 -0700">&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="15203493" author="jira-bot" created="Sun, 20 Mar 2016 13:06:20 -0700">&lt;p&gt;Commit e1a1dbfabcc9defb22ba091be1633a31a2810ab8 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e1a1dbf" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e1a1dbf&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7117" title="PointRangeQuery.hashCode is inconsistent" class="issue-link" data-issue-key="LUCENE-7117"&gt;&lt;del&gt;LUCENE-7117&lt;/del&gt;&lt;/a&gt;, &lt;a href="https://issues.apache.org/jira/browse/LUCENE-7118" title="Remove multidimensional arrays from PointRangeQuery" class="issue-link" data-issue-key="LUCENE-7118"&gt;&lt;del&gt;LUCENE-7118&lt;/del&gt;&lt;/a&gt;: Remove multidimensional arrays from PointRangeQuery&lt;/p&gt;</comment>
                            <comment id="15203499" author="jira-bot" created="Sun, 20 Mar 2016 13:23:40 -0700">&lt;p&gt;Commit 51b109620be7d565ae816f9e327813798c001611 in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=51b1096" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=51b1096&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7117" title="PointRangeQuery.hashCode is inconsistent" class="issue-link" data-issue-key="LUCENE-7117"&gt;&lt;del&gt;LUCENE-7117&lt;/del&gt;&lt;/a&gt;, &lt;a href="https://issues.apache.org/jira/browse/LUCENE-7118" title="Remove multidimensional arrays from PointRangeQuery" class="issue-link" data-issue-key="LUCENE-7118"&gt;&lt;del&gt;LUCENE-7118&lt;/del&gt;&lt;/a&gt;: Remove multidimensional arrays from PointRangeQuery&lt;/p&gt;</comment>
                            <comment id="15203500" author="rjernst" created="Sun, 20 Mar 2016 13:25:26 -0700">&lt;p&gt;Shouldn't this line in PointRangeQuery:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;+    if (upperPoint.length != upperPoint.length) {&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Be checking &lt;tt&gt;lowerPoint.length != upperPoint.length&lt;/tt&gt;?&lt;/p&gt;</comment>
                            <comment id="15203508" author="jira-bot" created="Sun, 20 Mar 2016 13:37:54 -0700">&lt;p&gt;Commit d8c4e6977b0e93c538813f1db1dd67fcfc199356 in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d8c4e69" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d8c4e69&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7117" title="PointRangeQuery.hashCode is inconsistent" class="issue-link" data-issue-key="LUCENE-7117"&gt;&lt;del&gt;LUCENE-7117&lt;/del&gt;&lt;/a&gt;, &lt;a href="https://issues.apache.org/jira/browse/LUCENE-7118" title="Remove multidimensional arrays from PointRangeQuery" class="issue-link" data-issue-key="LUCENE-7118"&gt;&lt;del&gt;LUCENE-7118&lt;/del&gt;&lt;/a&gt;: Remove multidimensional arrays from PointRangeQuery&lt;/p&gt;</comment>
                            <comment id="15203510" author="jira-bot" created="Sun, 20 Mar 2016 13:40:23 -0700">&lt;p&gt;Commit 54e662b6dab9f495109b3e56aab23383aad3fb4f in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rjernst" class="user-hover" rel="rjernst"&gt;Ryan Ernst&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=54e662b" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=54e662b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7118" title="Remove multidimensional arrays from PointRangeQuery" class="issue-link" data-issue-key="LUCENE-7118"&gt;&lt;del&gt;LUCENE-7118&lt;/del&gt;&lt;/a&gt;: Fix packed points upper/lower bound length check&lt;/p&gt;</comment>
                            <comment id="15203513" author="jira-bot" created="Sun, 20 Mar 2016 13:45:31 -0700">&lt;p&gt;Commit 38673877aef4f89dbb437249eaf201f963477f80 in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rjernst" class="user-hover" rel="rjernst"&gt;Ryan Ernst&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3867387" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3867387&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7118" title="Remove multidimensional arrays from PointRangeQuery" class="issue-link" data-issue-key="LUCENE-7118"&gt;&lt;del&gt;LUCENE-7118&lt;/del&gt;&lt;/a&gt;: Fix packed points upper/lower bound length check&lt;/p&gt;</comment>
                            <comment id="15203514" author="jira-bot" created="Sun, 20 Mar 2016 13:46:08 -0700">&lt;p&gt;Commit d92561e6ed0dad5cbd0488a05f2cea569ff6d5e3 in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rjernst" class="user-hover" rel="rjernst"&gt;Ryan Ernst&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d92561e" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d92561e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7118" title="Remove multidimensional arrays from PointRangeQuery" class="issue-link" data-issue-key="LUCENE-7118"&gt;&lt;del&gt;LUCENE-7118&lt;/del&gt;&lt;/a&gt;: Fix packed points upper/lower bound length check&lt;/p&gt;</comment>
                            <comment id="15203516" author="jira-bot" created="Sun, 20 Mar 2016 13:50:08 -0700">&lt;p&gt;Commit 7f9c4d886dbef50e31fda38d77d73a5bd3b7b8be in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rjernst" class="user-hover" rel="rjernst"&gt;Ryan Ernst&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=7f9c4d8" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=7f9c4d8&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7118" title="Remove multidimensional arrays from PointRangeQuery" class="issue-link" data-issue-key="LUCENE-7118"&gt;&lt;del&gt;LUCENE-7118&lt;/del&gt;&lt;/a&gt;: Move numDims check before modulo numDims&lt;/p&gt;</comment>
                            <comment id="15203517" author="jira-bot" created="Sun, 20 Mar 2016 13:50:38 -0700">&lt;p&gt;Commit ab821d3a087f400206f903800f1167679dccb9ac in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rjernst" class="user-hover" rel="rjernst"&gt;Ryan Ernst&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ab821d3" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ab821d3&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7118" title="Remove multidimensional arrays from PointRangeQuery" class="issue-link" data-issue-key="LUCENE-7118"&gt;&lt;del&gt;LUCENE-7118&lt;/del&gt;&lt;/a&gt;: Move numDims check before modulo numDims&lt;/p&gt;</comment>
                            <comment id="15203518" author="jira-bot" created="Sun, 20 Mar 2016 13:50:58 -0700">&lt;p&gt;Commit a600e6f2dd121104ddf0f28cb0120544703e9455 in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rjernst" class="user-hover" rel="rjernst"&gt;Ryan Ernst&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=a600e6f" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=a600e6f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7118" title="Remove multidimensional arrays from PointRangeQuery" class="issue-link" data-issue-key="LUCENE-7118"&gt;&lt;del&gt;LUCENE-7118&lt;/del&gt;&lt;/a&gt;: Move numDims check before modulo numDims&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12794236" name="LUCENE-7118.patch" size="21426" author="rcmuir" created="Fri, 18 Mar 2016 11:47:21 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 18 Mar 2016 18:49:27 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2uw7b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7117] PointRangeQuery.hashCode is inconsistent</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7117</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;Like &lt;a href="https://issues.apache.org/jira/browse/LUCENE-7085" title="PointRangeQuery.equals does not work" class="issue-link" data-issue-key="LUCENE-7085"&gt;&lt;del&gt;LUCENE-7085&lt;/del&gt;&lt;/a&gt; &lt;tt&gt;PointRangeQuery.hashCode&lt;/tt&gt; can produce different values for the same query.&lt;/p&gt;</description>
                <environment/>
        <key id="12951579">LUCENE-7117</key>
            <summary>PointRangeQuery.hashCode is inconsistent</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="nknize">Nicholas Knize</reporter>
                        <labels>
                    </labels>
                <created>Fri, 18 Mar 2016 11:00:56 -0700</created>
                <updated>Sun, 20 Mar 2016 13:39:30 -0700</updated>
                            <resolved>Sun, 20 Mar 2016 13:39:30 -0700</resolved>
                                                    <fixVersion>master</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="15201883" author="nknize" created="Fri, 18 Mar 2016 11:02:20 -0700">&lt;p&gt;Simple patch with tests.&lt;/p&gt;</comment>
                            <comment id="15203492" author="jira-bot" created="Sun, 20 Mar 2016 13:06:19 -0700">&lt;p&gt;Commit e1a1dbfabcc9defb22ba091be1633a31a2810ab8 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e1a1dbf" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e1a1dbf&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7117" title="PointRangeQuery.hashCode is inconsistent" class="issue-link" data-issue-key="LUCENE-7117"&gt;&lt;del&gt;LUCENE-7117&lt;/del&gt;&lt;/a&gt;, &lt;a href="https://issues.apache.org/jira/browse/LUCENE-7118" title="Remove multidimensional arrays from PointRangeQuery" class="issue-link" data-issue-key="LUCENE-7118"&gt;&lt;del&gt;LUCENE-7118&lt;/del&gt;&lt;/a&gt;: Remove multidimensional arrays from PointRangeQuery&lt;/p&gt;</comment>
                            <comment id="15203498" author="jira-bot" created="Sun, 20 Mar 2016 13:23:39 -0700">&lt;p&gt;Commit 51b109620be7d565ae816f9e327813798c001611 in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=51b1096" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=51b1096&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7117" title="PointRangeQuery.hashCode is inconsistent" class="issue-link" data-issue-key="LUCENE-7117"&gt;&lt;del&gt;LUCENE-7117&lt;/del&gt;&lt;/a&gt;, &lt;a href="https://issues.apache.org/jira/browse/LUCENE-7118" title="Remove multidimensional arrays from PointRangeQuery" class="issue-link" data-issue-key="LUCENE-7118"&gt;&lt;del&gt;LUCENE-7118&lt;/del&gt;&lt;/a&gt;: Remove multidimensional arrays from PointRangeQuery&lt;/p&gt;</comment>
                            <comment id="15203507" author="jira-bot" created="Sun, 20 Mar 2016 13:37:53 -0700">&lt;p&gt;Commit d8c4e6977b0e93c538813f1db1dd67fcfc199356 in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d8c4e69" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d8c4e69&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7117" title="PointRangeQuery.hashCode is inconsistent" class="issue-link" data-issue-key="LUCENE-7117"&gt;&lt;del&gt;LUCENE-7117&lt;/del&gt;&lt;/a&gt;, &lt;a href="https://issues.apache.org/jira/browse/LUCENE-7118" title="Remove multidimensional arrays from PointRangeQuery" class="issue-link" data-issue-key="LUCENE-7118"&gt;&lt;del&gt;LUCENE-7118&lt;/del&gt;&lt;/a&gt;: Remove multidimensional arrays from PointRangeQuery&lt;/p&gt;</comment>
                            <comment id="15203509" author="rcmuir" created="Sun, 20 Mar 2016 13:39:30 -0700">&lt;p&gt;Nick, I merged your tests in with the fix in &lt;a href="https://issues.apache.org/jira/browse/LUCENE-7118" title="Remove multidimensional arrays from PointRangeQuery" class="issue-link" data-issue-key="LUCENE-7118"&gt;&lt;del&gt;LUCENE-7118&lt;/del&gt;&lt;/a&gt;. Thanks for adding them!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12794231" name="LUCENE-7117.patch" size="17140" author="nknize" created="Fri, 18 Mar 2016 11:02:20 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 20 Mar 2016 20:06:19 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2uw47:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7113] OfflineSorter and BKD should verify checksums in their temp files</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7113</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;I am trying to index all 3.2 B points from the latest OpenStreetMaps export.&lt;/p&gt;

&lt;p&gt;My SSDs were not up to this, so I added a spinning magnets disk to beast2.&lt;/p&gt;

&lt;p&gt;But then I was hitting scary bug-like exceptions (&lt;tt&gt;ArrayIndexOutOfBoundsException&lt;/tt&gt;) when indexing the first 2B points, and I finally checked dmesg and saw that my hard drive is dying.&lt;/p&gt;

&lt;p&gt;I think it's important that our temp file usages also validate checksums (like we do for all our index files, either at reader open or at merge or &lt;tt&gt;CheckIndex&lt;/tt&gt;), so we can hopefully easily differentiate a bit-flipping IO system from a possible Lucene bug, in the future.&lt;/p&gt;</description>
                <environment/>
        <key id="12951232">LUCENE-7113</key>
            <summary>OfflineSorter and BKD should verify checksums in their temp files</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mikemccand">Michael McCandless</assignee>
                                    <reporter username="mikemccand">Michael McCandless</reporter>
                        <labels>
                    </labels>
                <created>Thu, 17 Mar 2016 07:47:47 -0700</created>
                <updated>Sat, 19 Mar 2016 02:38:14 -0700</updated>
                            <resolved>Sat, 19 Mar 2016 02:38:14 -0700</resolved>
                                                    <fixVersion>master</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="15201297" author="mikemccand" created="Fri, 18 Mar 2016 03:39:35 -0700">&lt;p&gt;Patch.&lt;/p&gt;

&lt;p&gt;This change forces anyone using &lt;tt&gt;OfflineSorter&lt;/tt&gt; to write the&lt;br/&gt;
checksum at the end of the input, and then pass a&lt;br/&gt;
&lt;tt&gt;ChecksumIndexInput&lt;/tt&gt; when creating the &lt;tt&gt;ByteSequencesReader&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;OfflineSorter&lt;/tt&gt; then fully validates checksums for its input source,&lt;br/&gt;
and all of its temporary sorted partitions, since it always fully&lt;br/&gt;
consumes every file.&lt;/p&gt;

&lt;p&gt;I also validate if we hit an unexpected exception, adding the&lt;br/&gt;
corruption as a suppressed exception, like we do for index files, and&lt;br/&gt;
also validate even if we don't hit an unexpected exception, since the&lt;br/&gt;
corruption could easily be otherwise un-noticed during the sorting.&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;BKDWriter&lt;/tt&gt; also does some validation, but unfortunately it's far&lt;br/&gt;
from perfect because it doesn't always fully consume its temp files in&lt;br/&gt;
one sweep: it often reads only a slice at a time, at each step of its&lt;br/&gt;
recursion.&lt;/p&gt;

&lt;p&gt;The slices over the full recursion will in fact add up to a single&lt;br/&gt;
sweep over a given temporary file, however the code is not currently&lt;br/&gt;
organized correctly to "take advantage" of this: on each recursion it&lt;br/&gt;
opens a new &lt;tt&gt;IndexInput&lt;/tt&gt; to scan just that one slice, then closes&lt;br/&gt;
it.  I think re-organizing this recursive writer to actually "be" a&lt;br/&gt;
single sweep is a little too risky at this point (and I'm not yet sure it's&lt;br/&gt;
even possible!).&lt;/p&gt;

&lt;p&gt;I did go and upgrade some asserts to real checks, and on unexpected&lt;br/&gt;
exception I check the checksum of the current file we are working on,&lt;br/&gt;
but even this is not perfect because corruption in an earlier&lt;br/&gt;
(different) temp file might not be noticed until later on.&lt;/p&gt;

&lt;p&gt;So net/net the &lt;tt&gt;BKDWriter&lt;/tt&gt; corruption checks are only best effort,&lt;br/&gt;
but they still do something (see the crazy added tests!).  We can&lt;br/&gt;
improve this with time, but I think this is an OK compromise for 6.0.&lt;/p&gt;</comment>
                            <comment id="15201509" author="mikemccand" created="Fri, 18 Mar 2016 07:11:26 -0700">&lt;p&gt;New patch ... Rob noticed a couple places where &lt;tt&gt;close&lt;/tt&gt; was not idempotent.&lt;/p&gt;</comment>
                            <comment id="15202673" author="jira-bot" created="Sat, 19 Mar 2016 02:17:09 -0700">&lt;p&gt;Commit ef7a0125133597cea9e15ec011922f6d70a81b97 in lucene-solr's branch refs/heads/master from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ef7a012" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ef7a012&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7113" title="OfflineSorter and BKD should verify checksums in their temp files" class="issue-link" data-issue-key="LUCENE-7113"&gt;&lt;del&gt;LUCENE-7113&lt;/del&gt;&lt;/a&gt;: add best-effort checksum verification to temp files written by OfflineSorter and BKDWriter&lt;/p&gt;</comment>
                            <comment id="15202676" author="jira-bot" created="Sat, 19 Mar 2016 02:20:09 -0700">&lt;p&gt;Commit 70290e8947623199b87600f4f985e72e16f66cf8 in lucene-solr's branch refs/heads/branch_6x from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=70290e8" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=70290e8&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7113" title="OfflineSorter and BKD should verify checksums in their temp files" class="issue-link" data-issue-key="LUCENE-7113"&gt;&lt;del&gt;LUCENE-7113&lt;/del&gt;&lt;/a&gt;: add best-effort checksum verification to temp files written by OfflineSorter and BKDWriter&lt;/p&gt;</comment>
                            <comment id="15202684" author="jira-bot" created="Sat, 19 Mar 2016 02:37:59 -0700">&lt;p&gt;Commit e458385b5e94d146853fabe5a94f2c9b0af31800 in lucene-solr's branch refs/heads/branch_6_0 from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e458385" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e458385&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7113" title="OfflineSorter and BKD should verify checksums in their temp files" class="issue-link" data-issue-key="LUCENE-7113"&gt;&lt;del&gt;LUCENE-7113&lt;/del&gt;&lt;/a&gt;: add best-effort checksum verification to temp files written by OfflineSorter and BKDWriter&lt;/p&gt;

&lt;p&gt;Conflicts:&lt;br/&gt;
	lucene/core/src/java/org/apache/lucene/util/bkd/BKDWriter.java&lt;br/&gt;
	lucene/core/src/java/org/apache/lucene/util/bkd/HeapPointWriter.java&lt;br/&gt;
	lucene/core/src/java/org/apache/lucene/util/bkd/OfflinePointReader.java&lt;br/&gt;
	lucene/core/src/java/org/apache/lucene/util/bkd/OfflinePointWriter.java&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12794189" name="LUCENE-7113.patch" size="54501" author="mikemccand" created="Fri, 18 Mar 2016 07:11:26 -0700"/>
                            <attachment id="12794175" name="LUCENE-7113.patch" size="54389" author="mikemccand" created="Fri, 18 Mar 2016 03:39:35 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 19 Mar 2016 09:17:09 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2utz3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7112] WeightedSpanTermExtractor should not always call extractUnknownQuery</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7112</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;WeightedSpanTermExtractor always calls extractUnknownQuery, even if term extraction already succeeded because the query is eg. a phrase query. It should only call this method if it could not find how to extract terms otherwise (eg. in case of a custom query).&lt;/p&gt;</description>
                <environment/>
        <key id="12951149">LUCENE-7112</key>
            <summary>WeightedSpanTermExtractor should not always call extractUnknownQuery</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jpountz">Adrien Grand</assignee>
                                    <reporter username="jpountz">Adrien Grand</reporter>
                        <labels>
                    </labels>
                <created>Thu, 17 Mar 2016 03:36:24 -0700</created>
                <updated>Mon, 11 Apr 2016 08:54:39 -0700</updated>
                            <resolved>Tue, 29 Mar 2016 00:56:19 -0700</resolved>
                                                    <fixVersion>6.0</fixVersion>
                    <fixVersion>5.5.1</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="15199578" author="jpountz" created="Thu, 17 Mar 2016 07:13:19 -0700">&lt;p&gt;Here is a patch.&lt;/p&gt;</comment>
                            <comment id="15199724" author="dsmiley" created="Thu, 17 Mar 2016 08:34:36 -0700">&lt;p&gt;+1.&lt;br/&gt;
I always wondered why it was the way it was; I figured there was some wisdom to it I just didn't know.  &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=simonw" class="user-hover" rel="simonw"&gt;Simon Willnauer&lt;/a&gt; didn't you add this feature originally?&lt;/p&gt;</comment>
                            <comment id="15211900" author="jira-bot" created="Fri, 25 Mar 2016 07:47:17 -0700">&lt;p&gt;Commit 766b144044558272e155e6c29df2b66c7a33a19c in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jpountz" class="user-hover" rel="jpountz"&gt;Adrien Grand&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=766b144" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=766b144&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7112" title="WeightedSpanTermExtractor should not always call extractUnknownQuery" class="issue-link" data-issue-key="LUCENE-7112"&gt;&lt;del&gt;LUCENE-7112&lt;/del&gt;&lt;/a&gt;: WeightedSpanTermExtractor.extractUnknownQuery is only called on queries that could not be extracted.&lt;/p&gt;</comment>
                            <comment id="15211901" author="jira-bot" created="Fri, 25 Mar 2016 07:47:18 -0700">&lt;p&gt;Commit 259e69b76fe1b6ac4f2dbfbca18cf4c2316ea62f in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jpountz" class="user-hover" rel="jpountz"&gt;Adrien Grand&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=259e69b" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=259e69b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7112" title="WeightedSpanTermExtractor should not always call extractUnknownQuery" class="issue-link" data-issue-key="LUCENE-7112"&gt;&lt;del&gt;LUCENE-7112&lt;/del&gt;&lt;/a&gt;: WeightedSpanTermExtractor.extractUnknownQuery is only called on queries that could not be extracted.&lt;/p&gt;</comment>
                            <comment id="15211902" author="jira-bot" created="Fri, 25 Mar 2016 07:47:19 -0700">&lt;p&gt;Commit 9448bd007b0dbf091c4aa8666b323e0880fb07aa in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jpountz" class="user-hover" rel="jpountz"&gt;Adrien Grand&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9448bd0" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9448bd0&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7112" title="WeightedSpanTermExtractor should not always call extractUnknownQuery" class="issue-link" data-issue-key="LUCENE-7112"&gt;&lt;del&gt;LUCENE-7112&lt;/del&gt;&lt;/a&gt;: WeightedSpanTermExtractor.extractUnknownQuery is only called on queries that could not be extracted.&lt;/p&gt;</comment>
                            <comment id="15212475" author="mikemccand" created="Fri, 25 Mar 2016 14:59:55 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jpountz" class="user-hover" rel="jpountz"&gt;Adrien Grand&lt;/a&gt; can this be closed now?&lt;/p&gt;</comment>
                            <comment id="15215637" author="jpountz" created="Tue, 29 Mar 2016 00:56:19 -0700">&lt;p&gt;Absolutely!&lt;/p&gt;</comment>
                            <comment id="15235338" author="jira-bot" created="Mon, 11 Apr 2016 08:52:52 -0700">&lt;p&gt;Commit f0fffb60232f6bc6f57da51ffc6de7633ca9093f in lucene-solr's branch refs/heads/branch_5_5 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jpountz" class="user-hover" rel="jpountz"&gt;Adrien Grand&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f0fffb6" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f0fffb6&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7112" title="WeightedSpanTermExtractor should not always call extractUnknownQuery" class="issue-link" data-issue-key="LUCENE-7112"&gt;&lt;del&gt;LUCENE-7112&lt;/del&gt;&lt;/a&gt;: WeightedSpanTermExtractor.extractUnknownQuery is only called on queries that could not be extracted.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12793986" name="LUCENE-7112.patch" size="2653" author="jpountz" created="Thu, 17 Mar 2016 07:13:19 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 17 Mar 2016 15:34:36 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2utgn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7111] DocValuesRangeQuery.newLongRange behaves incorrectly for Long.MAX_VALUE and Long.MIN_VALUE</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7111</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;It seems that the following queries return all documents, which is unexpected:&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
DocValuesRangeQuery.newLongRange(&lt;span class="code-quote"&gt;"dv"&lt;/span&gt;, &lt;span class="code-object"&gt;Long&lt;/span&gt;.MAX_VALUE, &lt;span class="code-object"&gt;Long&lt;/span&gt;.MAX_VALUE, &lt;span class="code-keyword"&gt;false&lt;/span&gt;, &lt;span class="code-keyword"&gt;true&lt;/span&gt;);
DocValuesRangeQuery.newLongRange(&lt;span class="code-quote"&gt;"dv"&lt;/span&gt;, &lt;span class="code-object"&gt;Long&lt;/span&gt;.MIN_VALUE, &lt;span class="code-object"&gt;Long&lt;/span&gt;.MIN_VALUE, &lt;span class="code-keyword"&gt;true&lt;/span&gt;, &lt;span class="code-keyword"&gt;false&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In Solr, floats and doubles are converted to longs and -0d gets converted to Long.MIN_VALUE, and queries like {-0d TO 0d] could fail due to this, returning all documents in the index.&lt;/p&gt;</description>
                <environment/>
        <key id="12951075">LUCENE-7111</key>
            <summary>DocValuesRangeQuery.newLongRange behaves incorrectly for Long.MAX_VALUE and Long.MIN_VALUE</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="steve_rowe">Steve Rowe</assignee>
                                    <reporter username="ichattopadhyaya">Ishan Chattopadhyaya</reporter>
                        <labels>
                    </labels>
                <created>Wed, 16 Mar 2016 20:08:43 -0700</created>
                <updated>Mon, 21 Mar 2016 06:02:55 -0700</updated>
                            <resolved>Mon, 21 Mar 2016 06:02:55 -0700</resolved>
                                                    <fixVersion>master</fixVersion>
                    <fixVersion>6.0</fixVersion>
                    <fixVersion>6.1</fixVersion>
                                    <component>core/search</component>
                        <due/>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="15198674" author="ichattopadhyaya" created="Wed, 16 Mar 2016 20:10:00 -0700">&lt;p&gt;Attaching a failing test demonstrating the problem.&lt;/p&gt;</comment>
                            <comment id="15198687" author="ichattopadhyaya" created="Wed, 16 Mar 2016 20:30:48 -0700">&lt;p&gt;Attaching an attempted fix. Not sure if there's a better way to handle this. Could someone please review?&lt;/p&gt;

&lt;p&gt;Edit: &lt;del&gt;Never mind, the fix may not be the correct one. I'm still looking deeper.&lt;/del&gt; I think the fix is behaving correctly, but I am looking for suggestions from someone who knows that part of the code better.&lt;/p&gt;</comment>
                            <comment id="15199529" author="rcmuir" created="Thu, 17 Mar 2016 06:38:17 -0700">&lt;p&gt;Logically i am not sure what the behavior should be... in your example min==max but minInclusive and maxInclusive "disagree".&lt;/p&gt;</comment>
                            <comment id="15199531" author="rcmuir" created="Thu, 17 Mar 2016 06:42:36 -0700">&lt;p&gt;and, if its an overflow in the logic that should not happen (looks like it might be), i think its worth it to change the add/subtracts here to Math.addExact/Math.subtractExact.&lt;/p&gt;</comment>
                            <comment id="15199550" author="ichattopadhyaya" created="Thu, 17 Mar 2016 06:52:34 -0700">&lt;p&gt;Right Robert, I think this overflow/underflow situation should be handled more properly to guard against surprises, even if min==max but minInclusive!=maxExclusive (which I think should throw 0 results). Another way to trigger this overflow is min=Long.MAX_VALUE, max=&amp;lt;any value&amp;gt;, minInclusive=false, maxInclusive=true/false.&lt;/p&gt;</comment>
                            <comment id="15199558" author="yseeley@gmail.com" created="Thu, 17 Mar 2016 06:56:53 -0700">&lt;blockquote&gt;&lt;p&gt;I think this overflow/underflow situation should be handled more properly to guard against surprises&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1, patch looks good.&lt;/p&gt;</comment>
                            <comment id="15199570" author="jpountz" created="Thu, 17 Mar 2016 07:02:29 -0700">&lt;p&gt;+1 to the patch&lt;/p&gt;</comment>
                            <comment id="15202276" author="steve_rowe" created="Fri, 18 Mar 2016 15:24:39 -0700">&lt;p&gt;+1 to the patch.&lt;/p&gt;</comment>
                            <comment id="15204135" author="jira-bot" created="Mon, 21 Mar 2016 06:00:13 -0700">&lt;p&gt;Commit 751a53fe00a4dc02f579d0e4356c2198dbdd7228 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe" class="user-hover" rel="steve_rowe"&gt;Steve Rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=751a53f" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=751a53f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7111" title="DocValuesRangeQuery.newLongRange behaves incorrectly for Long.MAX_VALUE and Long.MIN_VALUE" class="issue-link" data-issue-key="LUCENE-7111"&gt;&lt;del&gt;LUCENE-7111&lt;/del&gt;&lt;/a&gt;: DocValuesRangeQuery.newLongRange behaves incorrectly for Long.MAX_VALUE and Long.MIN_VALUE&lt;/p&gt;</comment>
                            <comment id="15204136" author="jira-bot" created="Mon, 21 Mar 2016 06:01:24 -0700">&lt;p&gt;Commit 4148cdf7446dca03e59cd5662f49b8286b3ba856 in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe" class="user-hover" rel="steve_rowe"&gt;Steve Rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=4148cdf" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=4148cdf&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7111" title="DocValuesRangeQuery.newLongRange behaves incorrectly for Long.MAX_VALUE and Long.MIN_VALUE" class="issue-link" data-issue-key="LUCENE-7111"&gt;&lt;del&gt;LUCENE-7111&lt;/del&gt;&lt;/a&gt;: DocValuesRangeQuery.newLongRange behaves incorrectly for Long.MAX_VALUE and Long.MIN_VALUE&lt;/p&gt;</comment>
                            <comment id="15204139" author="jira-bot" created="Mon, 21 Mar 2016 06:02:03 -0700">&lt;p&gt;Commit 1201524d8ff24727993a8d3949d783d5a947221a in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe" class="user-hover" rel="steve_rowe"&gt;Steve Rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=1201524" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=1201524&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7111" title="DocValuesRangeQuery.newLongRange behaves incorrectly for Long.MAX_VALUE and Long.MIN_VALUE" class="issue-link" data-issue-key="LUCENE-7111"&gt;&lt;del&gt;LUCENE-7111&lt;/del&gt;&lt;/a&gt;: DocValuesRangeQuery.newLongRange behaves incorrectly for Long.MAX_VALUE and Long.MIN_VALUE&lt;/p&gt;</comment>
                            <comment id="15204141" author="steve_rowe" created="Mon, 21 Mar 2016 06:02:55 -0700">&lt;p&gt;Thanks Ishan!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12895270">SOLR-8082</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12793908" name="LUCENE-7111.patch" size="2595" author="ichattopadhyaya" created="Wed, 16 Mar 2016 20:33:04 -0700"/>
                            <attachment id="12793907" name="LUCENE-7111.patch" size="2621" author="ichattopadhyaya" created="Wed, 16 Mar 2016 20:30:48 -0700"/>
                            <attachment id="12793905" name="LUCENE-7111.patch" size="2387" author="ichattopadhyaya" created="Wed, 16 Mar 2016 20:10:00 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 17 Mar 2016 13:38:17 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ut07:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7106] Make it easy to have cumulated point stats across segments</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7106</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;For other parts of the index, it is easy thanks to the Multi{Terms,DocValues,...} classes. However, we don't have such a thing for points but it would still be nice to have a convenient way to compute eg. the max value of a field on a whole index.&lt;/p&gt;</description>
                <environment/>
        <key id="12950450">LUCENE-7106</key>
            <summary>Make it easy to have cumulated point stats across segments</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jpountz">Adrien Grand</assignee>
                                    <reporter username="jpountz">Adrien Grand</reporter>
                        <labels>
                    </labels>
                <created>Tue, 15 Mar 2016 02:12:43 -0700</created>
                <updated>Wed, 16 Mar 2016 08:06:20 -0700</updated>
                            <resolved>Wed, 16 Mar 2016 08:06:20 -0700</resolved>
                                                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="15194979" author="jpountz" created="Tue, 15 Mar 2016 02:18:02 -0700">&lt;p&gt;Here is a patch that adds static methods to PointValues to compute aggregated min, max, size and doc counts on an IndexReader.&lt;/p&gt;</comment>
                            <comment id="15194998" author="mikemccand" created="Tue, 15 Mar 2016 02:30:59 -0700">&lt;p&gt;+1, thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jpountz" class="user-hover" rel="jpountz"&gt;Adrien Grand&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="15197401" author="jira-bot" created="Wed, 16 Mar 2016 07:36:19 -0700">&lt;p&gt;Commit 24830b7f18146b38078a80bc04f041011ab8689e in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jpountz" class="user-hover" rel="jpountz"&gt;Adrien Grand&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=24830b7" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=24830b7&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7106" title="Make it easy to have cumulated point stats across segments" class="issue-link" data-issue-key="LUCENE-7106"&gt;&lt;del&gt;LUCENE-7106&lt;/del&gt;&lt;/a&gt;: Add helpers to compute aggregated stats on points.&lt;/p&gt;</comment>
                            <comment id="15197457" author="jira-bot" created="Wed, 16 Mar 2016 08:04:55 -0700">&lt;p&gt;Commit 4e0d8355f087baa04522d0fe21453cfe5f237128 in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jpountz" class="user-hover" rel="jpountz"&gt;Adrien Grand&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=4e0d835" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=4e0d835&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7106" title="Make it easy to have cumulated point stats across segments" class="issue-link" data-issue-key="LUCENE-7106"&gt;&lt;del&gt;LUCENE-7106&lt;/del&gt;&lt;/a&gt;: Add helpers to compute aggregated stats on points.&lt;/p&gt;</comment>
                            <comment id="15197458" author="jira-bot" created="Wed, 16 Mar 2016 08:04:56 -0700">&lt;p&gt;Commit cb85f2611e164b089c72ffa0c29bb72e6512cd2d in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jpountz" class="user-hover" rel="jpountz"&gt;Adrien Grand&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=cb85f26" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=cb85f26&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7106" title="Make it easy to have cumulated point stats across segments" class="issue-link" data-issue-key="LUCENE-7106"&gt;&lt;del&gt;LUCENE-7106&lt;/del&gt;&lt;/a&gt;: Add helpers to compute aggregated stats on points.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12793510" name="LUCENE-7106.patch" size="7642" author="jpountz" created="Tue, 15 Mar 2016 02:18:02 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 15 Mar 2016 09:30:59 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2up5b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7101] OfflineSorter's merging is O(N^2) cost for large sorts</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7101</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;Our &lt;tt&gt;OfflineSorter&lt;/tt&gt; acts just like Lucene, writing small initial&lt;br/&gt;
segments of sorted values (from what it was able to sort at once in&lt;br/&gt;
heap), periodically merging them when there are too many, and doing a&lt;br/&gt;
&lt;tt&gt;forceMerge(1)&lt;/tt&gt; in the end.&lt;/p&gt;

&lt;p&gt;But the merge logic is too simplistic today, resulting in O(N^2)&lt;br/&gt;
cost.  Smallish sorts usually won't hit it, because the default 128&lt;br/&gt;
merge factor is so high, but e.g. the new 2B points tests do hit the&lt;br/&gt;
N^2 behavior.  I suspect the high merge factor hurts performance (OS&lt;br/&gt;
struggles to use what free RAM it has to read-ahead on 128 files), and&lt;br/&gt;
also risks file descriptor exhaustion.&lt;/p&gt;

&lt;p&gt;I think we should implement a simple log merge policy for it, and drop&lt;br/&gt;
its default merge factor to 10.&lt;/p&gt;</description>
                <environment/>
        <key id="12949888">LUCENE-7101</key>
            <summary>OfflineSorter's merging is O(N^2) cost for large sorts</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mikemccand">Michael McCandless</assignee>
                                    <reporter username="mikemccand">Michael McCandless</reporter>
                        <labels>
                    </labels>
                <created>Mon, 14 Mar 2016 07:03:13 -0700</created>
                <updated>Tue, 15 Mar 2016 04:41:57 -0700</updated>
                            <resolved>Tue, 15 Mar 2016 04:41:57 -0700</resolved>
                                                    <fixVersion>master</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="15193359" author="dweiss" created="Mon, 14 Mar 2016 07:23:25 -0700">&lt;p&gt;Sorry for being dim, what's the scenario of hitting N^2 complexity here?&lt;/p&gt;</comment>
                            <comment id="15193402" author="mikemccand" created="Mon, 14 Mar 2016 07:54:50 -0700">&lt;p&gt;To get log(N) behavior you need to merge N segments that are "close" to the same size on each merge...&lt;/p&gt;

&lt;p&gt;E.g., say you are sorting "plenty" of data, with only 16 MB heap buffer to work with.&lt;/p&gt;

&lt;p&gt;Today, we will write 128 (default merge factor) 16 MB segments, and then merge those down to a single 2 GB (= 128 * 16 MB) segment.  Next we write another 127 16 MB segments, and merge the 2 GB segment, plus 127 16 MB segments, into a 3.98 GB segment.  Then another 127 16 MB segments, and merge that into a 5.97 GB segment, etc.&lt;/p&gt;

&lt;p&gt;So the net number of MB copied by merging will be something like:&lt;/p&gt;

&lt;p&gt;  (128 + 0*127)*16 + (128 + 1*127)*16 + (128 + 2*127)*16 + (128 + 3*127)*16 + ...&lt;/p&gt;

&lt;p&gt;The equation has a linear number of terms vs your input size (input data divided by 1.98 GB, or so?).&lt;/p&gt;

&lt;p&gt;But this equation asymptotes towards O(N^2):&lt;/p&gt;

&lt;p&gt;It rewrites to:&lt;/p&gt;

&lt;p&gt;  16 * 128 + 16 * (0*127 + 1*127 + 2*127 + 3*127 + ...)&lt;/p&gt;

&lt;p&gt;and rewrites to:&lt;/p&gt;

&lt;p&gt;  16 * 128 + 16 * 127 * (0 + 1 + 2 + 3 + ...)&lt;/p&gt;

&lt;p&gt;where the number of terms in that last part is linear vs your input data size.&lt;/p&gt;

&lt;p&gt;So this bug only happens if you sort enough data, vs. your allowed heap usage, to require many merges, so the too-large 128 merge factor "hides" this problem for most use cases.&lt;/p&gt;</comment>
                            <comment id="15193990" author="mikemccand" created="Mon, 14 Mar 2016 12:33:29 -0700">&lt;p&gt;Patch, adding a trivial "log merge policy" to &lt;tt&gt;OfflineSorter&lt;/tt&gt;, and changing its default merge factor from 128 to 10.&lt;/p&gt;

&lt;p&gt;I also fixed the 2B points tests to not "cheat" by giving BKD more heap than the defaults, and improved &lt;tt&gt;BKDWriter&lt;/tt&gt;'s temp file naming&lt;/p&gt;

&lt;p&gt;I'm running &lt;tt&gt;Test2BBKDPoints.test2D&lt;/tt&gt; now ...&lt;/p&gt;</comment>
                            <comment id="15194893" author="dweiss" created="Tue, 15 Mar 2016 01:10:10 -0700">&lt;p&gt;Thanks Mike, this was detailed. &lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/smile.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt; Patch looks good at first glance.&lt;/p&gt;</comment>
                            <comment id="15195051" author="mikemccand" created="Tue, 15 Mar 2016 03:15:53 -0700">&lt;blockquote&gt;&lt;p&gt;I'm running Test2BBKDPoints.test2D now ...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It passed (after 12.2 hours, on spinning disk)!&lt;/p&gt;</comment>
                            <comment id="15195130" author="jira-bot" created="Tue, 15 Mar 2016 04:35:05 -0700">&lt;p&gt;Commit 82c06190a35a8159288c2fb48d8d38d6d81dbbf2 in lucene-solr's branch refs/heads/master from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=82c0619" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=82c0619&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7101" title="OfflineSorter&amp;#39;s merging is O(N^2) cost for large sorts" class="issue-link" data-issue-key="LUCENE-7101"&gt;&lt;del&gt;LUCENE-7101&lt;/del&gt;&lt;/a&gt;: OfflineSorter had O(N^2) merge cost, and used too many temporary file descriptors, for large sorts&lt;/p&gt;</comment>
                            <comment id="15195136" author="jira-bot" created="Tue, 15 Mar 2016 04:38:02 -0700">&lt;p&gt;Commit 287d6c8be6a75f43ff298483ef79e8226f60d138 in lucene-solr's branch refs/heads/branch_6x from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=287d6c8" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=287d6c8&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7101" title="OfflineSorter&amp;#39;s merging is O(N^2) cost for large sorts" class="issue-link" data-issue-key="LUCENE-7101"&gt;&lt;del&gt;LUCENE-7101&lt;/del&gt;&lt;/a&gt;: OfflineSorter had O(N^2) merge cost, and used too many temporary file descriptors, for large sorts&lt;/p&gt;</comment>
                            <comment id="15195139" author="jira-bot" created="Tue, 15 Mar 2016 04:41:34 -0700">&lt;p&gt;Commit 6168fe1afb40286a7515b5909c3eb41db1ab6d00 in lucene-solr's branch refs/heads/branch_6_0 from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=6168fe1" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=6168fe1&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7101" title="OfflineSorter&amp;#39;s merging is O(N^2) cost for large sorts" class="issue-link" data-issue-key="LUCENE-7101"&gt;&lt;del&gt;LUCENE-7101&lt;/del&gt;&lt;/a&gt;: OfflineSorter had O(N^2) merge cost, and used too many temporary file descriptors, for large sorts&lt;/p&gt;

&lt;p&gt;Conflicts:&lt;br/&gt;
	lucene/core/src/java/org/apache/lucene/util/bkd/BKDWriter.java&lt;br/&gt;
	lucene/core/src/test/org/apache/lucene/util/bkd/Test2BBKDPoints.java&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12793380" name="LUCENE-7101.patch" size="10470" author="mikemccand" created="Mon, 14 Mar 2016 12:33:29 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 14 Mar 2016 14:23:25 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ulpb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7095] join module only supports legacy numerics</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7095</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;The join module supports numeric query-time joins but only with the old encoding. We need to deprecate the current support and implement a Points-based alternative. &lt;/p&gt;</description>
                <environment/>
        <key id="12948810">LUCENE-7095</key>
            <summary>join module only supports legacy numerics</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rcmuir">Robert Muir</reporter>
                        <labels>
                    </labels>
                <created>Thu, 10 Mar 2016 07:50:36 -0700</created>
                <updated>Fri, 25 Mar 2016 09:28:25 -0700</updated>
                            <resolved>Fri, 25 Mar 2016 09:28:25 -0700</resolved>
                                                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="15211898" author="martijn.v.groningen" created="Fri, 25 Mar 2016 07:46:51 -0700">&lt;p&gt;Added a numeric join impl that can work with point values that can be used as a replacement for the legacy numeric join impl. &lt;/p&gt;</comment>
                            <comment id="15211941" author="mikemccand" created="Fri, 25 Mar 2016 08:26:35 -0700">&lt;p&gt;Whoa, thank you &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=martijn.v.groningen" class="user-hover" rel="martijn.v.groningen"&gt;Martijn van Groningen&lt;/a&gt; for cutting over joins!&lt;/p&gt;</comment>
                            <comment id="15211955" author="mikemccand" created="Fri, 25 Mar 2016 08:40:55 -0700">&lt;p&gt;+1 to the patch.&lt;/p&gt;

&lt;p&gt;The javadocs state that only int and long are supported, yet float and double (strangely, but matching what the legacy numerics join supports?) are also allowed?&lt;/p&gt;

&lt;p&gt;Thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=martijn.v.groningen" class="user-hover" rel="martijn.v.groningen"&gt;Martijn van Groningen&lt;/a&gt;!  The more legacy numerics code we can cut over to points, the better &lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/wink.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt;&lt;/p&gt;</comment>
                            <comment id="15211984" author="martijn.v.groningen" created="Fri, 25 Mar 2016 09:03:55 -0700">&lt;p&gt;Thanks for reviewing Mike! I've updated the the jdocs.&lt;br/&gt;
I'll push this soon.&lt;/p&gt;</comment>
                            <comment id="15212018" author="jira-bot" created="Fri, 25 Mar 2016 09:27:04 -0700">&lt;p&gt;Commit 5733f05c70d473415246902641d5ff74a8ba2cbb in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=martijn" class="user-hover" rel="martijn"&gt;Martijn van Groningen&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=5733f05" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=5733f05&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7095" title="join module only supports legacy numerics" class="issue-link" data-issue-key="LUCENE-7095"&gt;&lt;del&gt;LUCENE-7095&lt;/del&gt;&lt;/a&gt;: Add point values support to the numeric field query time join&lt;/p&gt;</comment>
                            <comment id="15212019" author="jira-bot" created="Fri, 25 Mar 2016 09:27:06 -0700">&lt;p&gt;Commit e26a44319429caa8aa28f5c27d620dcbad0dc240 in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=martijn" class="user-hover" rel="martijn"&gt;Martijn van Groningen&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e26a443" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e26a443&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7095" title="join module only supports legacy numerics" class="issue-link" data-issue-key="LUCENE-7095"&gt;&lt;del&gt;LUCENE-7095&lt;/del&gt;&lt;/a&gt;: Add point values support to the numeric field query time join&lt;/p&gt;</comment>
                            <comment id="15212020" author="jira-bot" created="Fri, 25 Mar 2016 09:27:07 -0700">&lt;p&gt;Commit 2babaf8c3d1710280ef53da3d7ba286615e7293e in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=martijn" class="user-hover" rel="martijn"&gt;Martijn van Groningen&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=2babaf8" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=2babaf8&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7095" title="join module only supports legacy numerics" class="issue-link" data-issue-key="LUCENE-7095"&gt;&lt;del&gt;LUCENE-7095&lt;/del&gt;&lt;/a&gt;: Add point values support to the numeric field query time join&lt;/p&gt;</comment>
                            <comment id="15212021" author="martijn.v.groningen" created="Fri, 25 Mar 2016 09:28:25 -0700">&lt;p&gt;Pushed to master, branch_6x and branch_6_0.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                                                <inwardlinks description="is part of">
                                        <issuelink>
            <issuekey id="12947769">LUCENE-7075</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12795424" name="LUCENE_7095.patch" size="31323" author="martijn.v.groningen" created="Fri, 25 Mar 2016 09:03:55 -0700"/>
                            <attachment id="12795417" name="LUCENE_7095.patch" size="30664" author="martijn.v.groningen" created="Fri, 25 Mar 2016 07:46:51 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 25 Mar 2016 14:46:51 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ugzb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7094] spatial-extras BBoxStrategy and (confusingly!) PointVectorStrategy use legacy numeric encoding</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7094</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;We need to deprecate these since they work on the old encoding and provide points based alternatives.&lt;/p&gt;</description>
                <environment/>
        <key id="12948804">LUCENE-7094</key>
            <summary>spatial-extras BBoxStrategy and (confusingly!) PointVectorStrategy use legacy numeric encoding</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nknize">Nicholas Knize</assignee>
                                    <reporter username="rcmuir">Robert Muir</reporter>
                        <labels>
                    </labels>
                <created>Thu, 10 Mar 2016 07:41:32 -0700</created>
                <updated>Fri, 1 Apr 2016 07:14:40 -0700</updated>
                            <resolved>Fri, 1 Apr 2016 07:14:40 -0700</resolved>
                                                    <fixVersion>master</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="15209529" author="nknize" created="Wed, 23 Mar 2016 18:05:25 -0700">&lt;ul&gt;
	&lt;li&gt;Cuts &lt;tt&gt;PointVectorStrategy&lt;/tt&gt; and &lt;tt&gt;BBoxStrategy&lt;/tt&gt; over to &lt;tt&gt;DoublePoint&lt;/tt&gt; while supporting backcompat through static methods &lt;tt&gt;newInstance&lt;/tt&gt; and &lt;tt&gt;newLegacyInstance&lt;/tt&gt; this forces users of the API to conciously use &lt;tt&gt;newLegacyInstance&lt;/tt&gt; for supporting old indexes. The public constructor can be added back in 7.0 when Legacy numerics are completely removed.&lt;/li&gt;
	&lt;li&gt;Simplifies tests by removing &lt;tt&gt;UninvertingReader&lt;/tt&gt; and adding &lt;tt&gt;needsDocValues&lt;/tt&gt; helper&lt;/li&gt;
	&lt;li&gt;Tests and javadocs updated&lt;/li&gt;
&lt;/ul&gt;

</comment>
                            <comment id="15209694" author="dsmiley" created="Wed, 23 Mar 2016 20:55:46 -0700">&lt;p&gt;Thanks for working on this Nick!  It's nice to see spatial-extras join the new PointValues world.&lt;/p&gt;

&lt;p&gt;I see you added the constant SpatialStrategy.SUFFIX_DV, and that its used by BBoxStrategy &amp;amp; PointVectorStrategy.  (BTW statics should be ordered above non-statics)  I see its used to put DocValue data in separate field names from the field name given to the strategy.  Why this change?  It would thwart someone using this code against an index created with 5.x.  In case you didnt know, the terms index, docValues, stored values, pointValues etc. are independent and so a field name might have data in all of them.  Theres no need for a field name suffix to differentiate the type.&lt;/p&gt;

&lt;p&gt;I think BBoxStrategy.ComboField (private) shouldnt be deprecated; its not quite tied to legacy numerics as the comment you added claims, although it can support it if someone provides a field type with the index enabled.  It supports DV data, stored data, and terms index data, mostly all via the FieldType passed in.  But I dont think it can hold the PointValue data, so that would still be a reason to have the Field[] array have a variable size.  If you don't get my drift, I'd be happy to take over and give it a shot.  Maybe i'm overlooking something; maybe not.&lt;/p&gt;

&lt;p&gt;The SpatialStrategy.get/setFieldType option you added is only used by BBoxStrategy.  That seems trappy to an unwitting user who doesn't know which does.  And the "needsDocValues" field is set from this, yet only for numeric DV, not binary DV.  I wonder if this field should be called needsNumericDocValues then?  And why define it here instead of pertinent subclasses?&lt;/p&gt;

&lt;p&gt;I see some &lt;tt&gt;false &amp;amp;&amp;amp;&lt;/tt&gt; conditions added to RandomSpatialOpStrategyTestCase I don't think you meant to have in the patch; right?&lt;/p&gt;

&lt;p&gt;PortedSolr3Test.testIntersections: maybe move the enabling of docValues on PointVectorStrategy out to the parameters() static method?  Or perhaps... arguably PVS should enable this by default since without it, one can't even do a circle query.&lt;/p&gt;</comment>
                            <comment id="15209738" author="nknize" created="Wed, 23 Mar 2016 21:38:14 -0700">&lt;blockquote&gt;&lt;p&gt;I see its used to put DocValue data in separate field names from the field name given to the strategy.  Why this change? &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It's necessary to cut over from &lt;tt&gt;UninvertingReader&lt;/tt&gt; - which still works on 5.x segments - to DocValues. If you just set &lt;tt&gt;DocValues.NUMERIC&lt;/tt&gt; on a DoubleField the &lt;tt&gt;Double.longValue&lt;/tt&gt; is what's stored as the DocValue (aka the truncated value). &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I think BBoxStrategy.ComboField (private) shouldnt be deprecated&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It's unnecessary - especially once legacy numerics are removed in 7.0 since Point types lock down the FieldType. There is no need to Circumvent Field limitations, anyway.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The SpatialStrategy.get/setFieldType option you added is only used by BBoxStrategy. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I'm actually in favor of removing this altogether. I just left it for backcompat with applications that need it to circumvent field limitations. I meant to take it back out of PVS. I'll make that change. &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I see some &lt;tt&gt;false &amp;amp;&amp;amp;&lt;/tt&gt; conditions&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Good catch! Missed that. &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;arguably PVS should enable this by default since without it, one can't even do a circle query.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1&lt;/p&gt;

</comment>
                            <comment id="15209769" author="dsmiley" created="Wed, 23 Mar 2016 22:11:02 -0700">&lt;blockquote&gt;&lt;p&gt;It's necessary to cut over from UninvertingReader - which still works on 5.x segments - to DocValues. If you just set DocValues.NUMERIC on a DoubleField the Double.longValue is what's stored as the DocValue (aka the truncated value).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I don't understand that; you description sounds related to ComboField not to UninvertingReader, but I'm not sure.  Tomorrow I'll try with a debugger to see why it doesn't work (presumably a test fails).  &lt;/p&gt;

&lt;p&gt;Note that adding this field suffix will break back-compat with a 5.x index for someone using this strategy since their data won't be in a &lt;tt&gt;_dv&lt;/tt&gt; suffixed field.  If we need to keep the suffix, we should add a note to the CHANGES.txt that this is so.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;(RE ComboField) It's unnecessary - especially once legacy numerics are removed in 7.0 since Point types lock down the FieldType. There is no need to Circumvent Field limitations, anyway.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Even without PointValues, it's definitely not strictly &lt;em&gt;necessary&lt;/em&gt;.  It was a convenient hack enabling the code to return exactly 5 field values instead of sometimes 9.  Now with PointValues we might need 9.  FYI note that DoubleDocValuesField doesn't allow setting the stored value, but ComboField can do stored value + DV in one shot.&lt;/p&gt;</comment>
                            <comment id="15210194" author="dsmiley" created="Thu, 24 Mar 2016 06:18:56 -0700">&lt;p&gt;BTW even if UninvertingReader doesn't work when the field names are the same, I think that's fine.  Whoever may be using UninvertingReader should have enabled docValues.  Perhaps it's a requirement, not just a suggestion, based on your observations; I'd like to see for myself but either way I think you should remove the addition of a field suffix to your patch.  That will limit the changes in the patch a bit too.&lt;/p&gt;

&lt;p&gt;I slept on this a bit and I think we'll need a better way for BBoxStrategy users to articulate what index options they want; it's now insufficient / ambiguous to provide a FieldType:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;terms index (legacy)&lt;/li&gt;
	&lt;li&gt;pointValues index?&lt;/li&gt;
	&lt;li&gt;docValues?&lt;/li&gt;
	&lt;li&gt;stored?&lt;/li&gt;
	&lt;li&gt;type: double or float? (needed for pointValues &amp;amp; docValues)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;By default we can have pointValues, docValues, type double, not stored.  Perhaps a little inner builderclass would work well.  For legacy purposes, we could support the fieldType but it's either-or with the builder.  It may take a bit of time to make double vs float configurable so that could be a follow-on issue. As it was, it was a TODO.&lt;/p&gt;</comment>
                            <comment id="15210891" author="nknize" created="Thu, 24 Mar 2016 13:17:16 -0700">&lt;p&gt;Updated patch includes the following:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Per request, ComboField deprecation has been removed. I'm still not convinced we need to keep this around but if its a blocker for the Point cut over I'm fine leaving it alone.&lt;/li&gt;
	&lt;li&gt;Moved get/setFieldType back to &lt;tt&gt;BBoxStrategy&lt;/tt&gt; only&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;PointVectorStrategy&lt;/tt&gt; requires docvalues without leniency&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;BBoxStrategy&lt;/tt&gt; and &lt;tt&gt;PointVectorStrategy&lt;/tt&gt; still index docvalues in a separate field. This is needed because docvalues on a &lt;tt&gt;DoubleField&lt;/tt&gt; stores a long cast from the double value, resulting in truncation of the original double. This is a bug that was not caught before because the test used whole values instead of decimal values. &lt;tt&gt;DistanceStrategyTest.testRecipScore&lt;/tt&gt; was updated to test on decimal values.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15211667" author="mikemccand" created="Fri, 25 Mar 2016 03:05:31 -0700">&lt;p&gt;Thank you &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nknize" class="user-hover" rel="nknize"&gt;Nicholas Knize&lt;/a&gt; for tackling this!&lt;/p&gt;

&lt;p&gt;It's important to do since 1) it can uncover tricky bugs in dimensional points (&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7133" title="PointRangeQuery and PointInSetQuery .equals and .hashCode methods are buggy" class="issue-link" data-issue-key="LUCENE-7133"&gt;&lt;del&gt;LUCENE-7133&lt;/del&gt;&lt;/a&gt;) and 2) we get better numerics performance.&lt;/p&gt;</comment>
                            <comment id="15211822" author="nknize" created="Fri, 25 Mar 2016 06:57:12 -0700">&lt;p&gt;Thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mikemccand" class="user-hover" rel="mikemccand"&gt;Michael McCandless&lt;/a&gt;  I think the patch is about ready (pending another review) at which point all LegacyNumerics should be deprecated in &lt;tt&gt;spatial-extras&lt;/tt&gt;. I think that should leave just &lt;a href="https://issues.apache.org/jira/browse/LUCENE-7095" title="join module only supports legacy numerics" class="issue-link" data-issue-key="LUCENE-7095"&gt;&lt;del&gt;LUCENE-7095&lt;/del&gt;&lt;/a&gt; and &lt;a href="https://issues.apache.org/jira/browse/LUCENE-7096" title="UninvertingReader needs multi-valued points support" class="issue-link" data-issue-key="LUCENE-7096"&gt;LUCENE-7096&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="15212447" author="dsmiley" created="Fri, 25 Mar 2016 14:32:14 -0700">&lt;p&gt;I'm working on improving it... I'll have a patch for you to see tonight.&lt;/p&gt;</comment>
                            <comment id="15212811" author="dsmiley" created="Fri, 25 Mar 2016 22:19:15 -0700">&lt;p&gt;I uploaded another patch.  I mostly just focused on PointVectorStrategy because it's simpler than BBoxStrategy.  I touched SpatialTestCase (mostly restoring it) too.  I removed the docValue field suffix, and I'm unable to reproduce the issue with UninvertingReader you spoke of.  Might you see if it's really gone and if it isn't upload a patch that fails a test?&lt;/p&gt;

&lt;p&gt;The main thing I did with PointVectorStrategy was to show how the various stored, docValues, pointValues, and legacyNumeric options can be configured by passing in a FieldType.  I want to get your opinion on this approach.  From an API standpoint, it's basically the same approach that BBoxStrategy takes, although I obviously did it without using the ComboField thing which maybe is too hacky and not worth it.&lt;/p&gt;

&lt;p&gt;Let me know if you'd like to use Reviewboard; I'd like to so that we can better see what changes we're making... but I understand if you don't want to.&lt;/p&gt;</comment>
                            <comment id="15214530" author="nknize" created="Mon, 28 Mar 2016 10:41:41 -0700">&lt;blockquote&gt;&lt;p&gt;I'm unable to reproduce the issue with UninvertingReader you spoke of.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That's because you added back &lt;tt&gt;UninvertingReader&lt;/tt&gt;. The intent was to completely cut the tests over to docvalues and remove test complexity with &lt;tt&gt;UninvertingReader&lt;/tt&gt;. I'm fine discussing that in a separate issue and leaving in UIR for now. I don't want this further delaying the release.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Let me know if you'd like to use Reviewboard;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I have no problem using Reviewboard. While I think there's some more clean up to do in these Strategies I think we've achieved the main objective for this issue with re: to the 6.0 release (cut over to Point values and deprecate LegacyNumerics)?&lt;/p&gt;

&lt;p&gt;Do you have any issues with me committing this and performing code/test cleanup in 6.x?&lt;/p&gt;</comment>
                            <comment id="15214592" author="dsmiley" created="Mon, 28 Mar 2016 11:06:20 -0700">&lt;blockquote&gt;&lt;p&gt;That's because you added back UninvertingReader. The intent was to completely cut the tests over to docvalues and remove test complexity with UninvertingReader. I'm fine discussing that in a separate issue and leaving in UIR for now. I don't want this further delaying the release.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;For now i'd rather continue to test that UninvertingReader works; particularly since we can feel better about the upgrade path.  In some separate issue we can remove it if you feel it isn't warranted (there is some complexity in testing it, sure).&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Do you have any issues with me committing this and performing code/test cleanup in 6.x?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Sort of... I'd rather we not commit something that should be cleaned up unless it's like way too complex to do at once.  That's pretty normal.  I get the sense that you feel we're in a hurry, and I have time today to help.  What do you think of my patch, particularly to PointVectorStrategy?  I'm willing to immediately get on doing the same approach to BBoxStrategy; it won't take long.  FWIW I'm on #lucene-dev IRC to expedite any communication.&lt;/p&gt;</comment>
                            <comment id="15214669" author="dsmiley" created="Mon, 28 Mar 2016 11:50:10 -0700">&lt;p&gt;Also, one concern I have with your last patch is that it's no longer possible to disable the index for BBoxStrategy.  For example, a user may just need it for sorting/relevancy and not for any filtering.  Perhaps the ComboField thingy made this less obvious, but I hope you agree my change to PointVectorStrategy (which doesn't use ComboField) clarifies these options.  I should have added a negative test to demonstrate this.&lt;/p&gt;</comment>
                            <comment id="15214868" author="nknize" created="Mon, 28 Mar 2016 13:51:41 -0700">&lt;blockquote&gt;&lt;p&gt;What do you think of my patch, particularly to PointVectorStrategy?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I like this approach. Its much more clear what's going on. +1 for taking the same approach with BBoxStrategy and for tackling the UIR issue separately.&lt;/p&gt;</comment>
                            <comment id="15217313" author="dsmiley" created="Tue, 29 Mar 2016 20:10:50 -0700">&lt;p&gt;Both BBoxStrategy &amp;amp; PointVectorStrategy:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;all state is now final; setters are removed.  The constructor has everything it needs to know.  The constructor is public, and represents an alternative to the static factory methods you added, for when the caller has options to customize.  &lt;b&gt;Perhaps instead this should be another factory method?&lt;/b&gt;&lt;/li&gt;
	&lt;li&gt;Options are set via a passed FieldType; and theres a getter for it.&lt;/li&gt;
	&lt;li&gt;The code for state, construction &amp;amp; createFields are very consistent now.  Its a bit dejavu but its not clear refactoring to reduce duplication would be worthwhile.&lt;/li&gt;
	&lt;li&gt;no special name prefix is needed for DocValues based field.  (same as it has been)&lt;/li&gt;
	&lt;li&gt;some javadocs updates; remove references to legacy numerics&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;BBoxStrategy: &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;the internal ComboField is gone&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;PointVectorStrategy:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;consistency with BBoxStrategy now means this has some options formerly only in BBoxStrategy: can be marked stored (default false), the index (be it PointValues or legacy numeric) is optional (default true), and DocValues is optional (default true).  An error is thrown if you call makeQuery and theres no index.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Tests:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Added test for being able to turn stored on/off, the index on/off on PointVectorStrategy&lt;/li&gt;
	&lt;li&gt;removed automatic use of UninvertedField, and the needsDocValues overrideable method.  Instead I added a utility method a test can invoke to introduce UninvertedField with the specified list of fields and the UninvertedField.Type (thus enabling testing uninverting of Double PointValues)).  &lt;em&gt;I know we said this could be another issue but it didn't take long and it's comforting to see it works&lt;/em&gt;&lt;/li&gt;
	&lt;li&gt;TestBBoxStrategy now tests uninverting behavior and for both legacy &amp;amp; pointValues&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Misc:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;No changes to SpatialStrategy&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15217818" author="rcmuir" created="Wed, 30 Mar 2016 04:33:58 -0700">&lt;p&gt;-1 to keep hanging on to uninverting reader in this way. It already has its own tests.&lt;/p&gt;

&lt;p&gt;We need to be able to e.g. get rid of it at some point and you are just being difficult here.&lt;/p&gt;

&lt;p&gt;If someone is going to reindex, they can reindex with docvalues too.&lt;/p&gt;</comment>
                            <comment id="15218200" author="dsmiley" created="Wed, 30 Mar 2016 08:53:47 -0700">&lt;p&gt;The attached patch modifies the previous by removing use of UninvertingReader in the tests, and thus altogether from spatial-extras.  In DistanceStrategyTest I commented out use of "pointvector_legacy" with a comment explaining it requires docValues that aren't present, and mentioning Solr has such tests.&lt;/p&gt;</comment>
                            <comment id="15218449" author="nknize" created="Wed, 30 Mar 2016 10:55:23 -0700">&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="15218895" author="dsmiley" created="Wed, 30 Mar 2016 14:28:37 -0700">&lt;p&gt;Great; who shall commit?  I will tonight (~4 more hours) if I don't hear otherwise.  Suggested CHANGES.txt:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7094" title="spatial-extras BBoxStrategy and (confusingly!) PointVectorStrategy use legacy numeric encoding" class="issue-link" data-issue-key="LUCENE-7094"&gt;&lt;del&gt;LUCENE-7094&lt;/del&gt;&lt;/a&gt;: BBoxStrategy and PointVectorStrategy now support PointValues (in addition to legacy numeric trie).  Their APIs were changed a little and also made more consistent.  PointValues/Trie is optional, DocValues is optional, stored value is optional.  (Nick Knize, David Smiley)&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15219045" author="jira-bot" created="Wed, 30 Mar 2016 16:15:16 -0700">&lt;p&gt;Commit e1b45568b41bf67b48baae7b8fec5793300a6814 in lucene-solr's branch refs/heads/master from nknize&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e1b4556" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e1b4556&lt;/a&gt; ]&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7094" title="spatial-extras BBoxStrategy and (confusingly!) PointVectorStrategy use legacy numeric encoding" class="issue-link" data-issue-key="LUCENE-7094"&gt;&lt;del&gt;LUCENE-7094&lt;/del&gt;&lt;/a&gt;: BBoxStrategy and PointVectorStrategy now support PointValues (in addition to legacy numeric trie).  Their APIs were changed a little and also made more consistent.  PointValues/Trie is optional, DocValues is optional, stored value is optional.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15219059" author="jira-bot" created="Wed, 30 Mar 2016 16:30:17 -0700">&lt;p&gt;Commit f9da8164483912cad40032387783f07e8c0cfc73 in lucene-solr's branch refs/heads/branch_6_0 from nknize&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f9da816" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f9da816&lt;/a&gt; ]&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7094" title="spatial-extras BBoxStrategy and (confusingly!) PointVectorStrategy use legacy numeric encoding" class="issue-link" data-issue-key="LUCENE-7094"&gt;&lt;del&gt;LUCENE-7094&lt;/del&gt;&lt;/a&gt;: BBoxStrategy and PointVectorStrategy now support PointValues (in addition to legacy numeric trie).  Their APIs were changed a little and also made more consistent.  PointValues/Trie is optional, DocValues is optional, stored value is optional.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15219073" author="jira-bot" created="Wed, 30 Mar 2016 16:42:59 -0700">&lt;p&gt;Commit 08dae30f738b5766b29600cf58dbaa74419ea0fa in lucene-solr's branch refs/heads/branch_6x from nknize&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=08dae30" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=08dae30&lt;/a&gt; ]&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7094" title="spatial-extras BBoxStrategy and (confusingly!) PointVectorStrategy use legacy numeric encoding" class="issue-link" data-issue-key="LUCENE-7094"&gt;&lt;del&gt;LUCENE-7094&lt;/del&gt;&lt;/a&gt;: BBoxStrategy and PointVectorStrategy now support PointValues (in addition to legacy numeric trie).  Their APIs were changed a little and also made more consistent.  PointValues/Trie is optional, DocValues is optional, stored value is optional.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                                                <inwardlinks description="is part of">
                                        <issuelink>
            <issuekey id="12947769">LUCENE-7075</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12795284" name="LUCENE-7094.patch" size="50710" author="nknize" created="Thu, 24 Mar 2016 13:17:16 -0700"/>
                            <attachment id="12795134" name="LUCENE-7094.patch" size="48191" author="nknize" created="Wed, 23 Mar 2016 18:05:25 -0700"/>
                            <attachment id="12796099" name="LUCENE_7094.patch" size="66320" author="dsmiley" created="Wed, 30 Mar 2016 08:53:47 -0700"/>
                            <attachment id="12796005" name="LUCENE_7094.patch" size="58459" author="dsmiley" created="Tue, 29 Mar 2016 20:10:50 -0700"/>
                            <attachment id="12795501" name="LUCENE_7094.patch" size="49438" author="dsmiley" created="Fri, 25 Mar 2016 22:19:15 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 24 Mar 2016 01:05:25 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ugxz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7093] MemoryIndex does not support points</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7093</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;I realized this glancing at &lt;a href="https://issues.apache.org/jira/browse/LUCENE-7091" title="Add doc values support to MemoryIndex" class="issue-link" data-issue-key="LUCENE-7091"&gt;&lt;del&gt;LUCENE-7091&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I think this should have points support or else people cannot move off of the deprecated LegacyXXX encodings?&lt;/p&gt;</description>
                <environment/>
        <key id="12948761">LUCENE-7093</key>
            <summary>MemoryIndex does not support points</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="martijn.v.groningen">Martijn van Groningen</assignee>
                                    <reporter username="rcmuir">Robert Muir</reporter>
                        <labels>
                    </labels>
                <created>Thu, 10 Mar 2016 04:48:31 -0700</created>
                <updated>Tue, 15 Mar 2016 08:35:17 -0700</updated>
                            <resolved>Tue, 15 Mar 2016 05:16:20 -0700</resolved>
                                                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="15193030" author="martijn.v.groningen" created="Mon, 14 Mar 2016 03:11:00 -0700">&lt;p&gt;Attached a patch that adds point values support for the memory index.&lt;br/&gt;
This patch is based on &lt;a href="https://issues.apache.org/jira/browse/LUCENE-7091" title="Add doc values support to MemoryIndex" class="issue-link" data-issue-key="LUCENE-7091"&gt;&lt;del&gt;LUCENE-7091&lt;/del&gt;&lt;/a&gt;, which will need to get merged first before this one. &lt;/p&gt;</comment>
                            <comment id="15193181" author="martijn.v.groningen" created="Mon, 14 Mar 2016 05:31:30 -0700">&lt;p&gt;Synched patch with &lt;a href="https://issues.apache.org/jira/browse/LUCENE-7091" title="Add doc values support to MemoryIndex" class="issue-link" data-issue-key="LUCENE-7091"&gt;&lt;del&gt;LUCENE-7091&lt;/del&gt;&lt;/a&gt; and removed the an added constructor to BytesRefArray (after realising that BytesRefArray can only work with its own privately constructed byte pool) .&lt;/p&gt;</comment>
                            <comment id="15193907" author="mikemccand" created="Mon, 14 Mar 2016 12:00:08 -0700">&lt;p&gt;Thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=martijn" class="user-hover" rel="martijn"&gt;Martijn van Groningen&lt;/a&gt;, this is nice!&lt;/p&gt;

&lt;p&gt;You don't have to box the point dimensionCount/numBytes up from &lt;tt&gt;int&lt;/tt&gt; to &lt;tt&gt;Integer&lt;/tt&gt;: 0 can safely mean "this field has no points".&lt;/p&gt;

&lt;p&gt;In &lt;tt&gt;addField&lt;/tt&gt; you return right away if the field had point values, but this is dangerous because the field could also have e.g. doc values: (&lt;tt&gt;LatLonPoint&lt;/tt&gt; just recently started doing this), maybe we can add a test case for that?&lt;/p&gt;

&lt;p&gt;Instead of making &lt;tt&gt;BytesRefArray.sort&lt;/tt&gt; fully public, can we make a version that always sorts by natural order public?  This class's entire existence scares me so I like to minimize what methods we make public, even for internal usage.&lt;/p&gt;

&lt;p&gt;Or maybe &lt;tt&gt;MemoryIndex&lt;/tt&gt; should just use &lt;tt&gt;BytesRef[]&lt;/tt&gt;, instead of &lt;tt&gt;BytesRefArray&lt;/tt&gt;, and sort that?  The vast majority of the time we are looking at a single point value for the fields here?  Your visit function could be simplified too: just call the &lt;tt&gt;compare&lt;/tt&gt; only once, and if it crosses, visit all points (with doc and value); if the cell is inside the query, visit with just doc; else, do nothing?&lt;/p&gt;</comment>
                            <comment id="15194150" author="martijn.v.groningen" created="Mon, 14 Mar 2016 14:17:47 -0700">&lt;blockquote&gt;&lt;p&gt;In addField you return right away if the field had point values, but this is dangerous because the field could also have e.g. doc values: (LatLonPoint just recently started doing this), maybe we can add a test case for that?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Good point. I'll add a test for this.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Or maybe MemoryIndex should just use BytesRef[], instead of BytesRefArray, and sort that?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1, lets simplify here. MemoryIndex only exists for a short amount of time and then it is tossed away, so we shouldn't spend to0 much effort in space efficient data structures here.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Your visit function could be simplified too: just call the compare only once, and if it crosses, visit all points (with doc and value); &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;If we there many values (lets say a couple of hundred values) for a single field, wouldn't the current visit method be better. (because less comparisons will need to happen). I have seen cases where fields had relatively a large number of terms.&lt;/p&gt;</comment>
                            <comment id="15194210" author="mikemccand" created="Mon, 14 Mar 2016 14:46:09 -0700">&lt;blockquote&gt;&lt;p&gt;If we there many values (lets say a couple of hundred values) for a single field, wouldn't the current visit method be better&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It's hard to say ... it invokes &lt;tt&gt;compare&lt;/tt&gt; more than the normal BKD tree would, and the compare can be more costly than filtering a single value?&lt;/p&gt;

&lt;p&gt;Also, I think the visit method only works in the 1D case ... for e.g. the 2D case, I think it may be buggy because the byte[] values were sorted only by the first dimension?&lt;/p&gt;

&lt;p&gt;I feel like it's best to get a simple, correct, implementation in at first, and then worry about optimizing for the "many points in a single document" case later?&lt;/p&gt;</comment>
                            <comment id="15194230" author="martijn.v.groningen" created="Mon, 14 Mar 2016 14:56:42 -0700">&lt;blockquote&gt;&lt;p&gt;Also, I think the visit method only works in the 1D case ... for e.g. the 2D case, I think it may be buggy because the byte[] values were sorted only by the first dimension?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I didn't realize that this was buggy in 2d case. I assumed that I was sorting the values correctly for any dimension, because LongPoint and friends pack multiple dimensions into a single BytesRef. Just curious, how would the sort then work?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I feel like it's best to get a simple, correct, implementation in at first, and then worry about optimizing for the "many points in a single document" case later?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1. I'll simplify the visitor method.&lt;/p&gt;</comment>
                            <comment id="15195138" author="martijn.v.groningen" created="Tue, 15 Mar 2016 04:41:29 -0700">&lt;p&gt;Added a new patch:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Removed the unnecessary boxing of the dimensionCount and numBytes.&lt;/li&gt;
	&lt;li&gt;Undo the changes made to BytesRefArray and simply use ByteRef[]&lt;/li&gt;
	&lt;li&gt;The MemoryIndexPointValues#intersect(...) was broken for anything with more than 1 dimension. This was caused by how the terms were sorted, anything beyond the first dimension was ignored, because the values were sorted by natural order. So removed the sorting and instead  the memory index now only picks the lowest and highest packed value. The intersect() method now simple visits all points. This makes &amp;gt;2d cases work and is good enough for now.&lt;/li&gt;
	&lt;li&gt;If there are points in a field, don't stop indexing, so that if doc values is enabled, these get stored too.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15195145" author="mikemccand" created="Tue, 15 Mar 2016 04:48:06 -0700">&lt;p&gt;+1, thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=martijn.v.groningen" class="user-hover" rel="martijn.v.groningen"&gt;Martijn van Groningen&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="15195178" author="jira-bot" created="Tue, 15 Mar 2016 05:15:21 -0700">&lt;p&gt;Commit fe58313de027b454395af2d8d13d18393fa7e2e0 in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=martijn" class="user-hover" rel="martijn"&gt;Martijn van Groningen&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=fe58313" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=fe58313&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7093" title="MemoryIndex does not support points" class="issue-link" data-issue-key="LUCENE-7093"&gt;&lt;del&gt;LUCENE-7093&lt;/del&gt;&lt;/a&gt;: Added point values support to the memory index&lt;/p&gt;</comment>
                            <comment id="15195179" author="jira-bot" created="Tue, 15 Mar 2016 05:15:22 -0700">&lt;p&gt;Commit d4fe0c3849d9e1140e5d6cd5d7b4d0e0495d9ea5 in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=martijn" class="user-hover" rel="martijn"&gt;Martijn van Groningen&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d4fe0c3" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d4fe0c3&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7093" title="MemoryIndex does not support points" class="issue-link" data-issue-key="LUCENE-7093"&gt;&lt;del&gt;LUCENE-7093&lt;/del&gt;&lt;/a&gt;: Added point values support to the memory index&lt;/p&gt;</comment>
                            <comment id="15195180" author="jira-bot" created="Tue, 15 Mar 2016 05:15:33 -0700">&lt;p&gt;Commit c1dfeb8ef85be924f17f8aece46d008382d538e9 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=martijn" class="user-hover" rel="martijn"&gt;Martijn van Groningen&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c1dfeb8" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c1dfeb8&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7093" title="MemoryIndex does not support points" class="issue-link" data-issue-key="LUCENE-7093"&gt;&lt;del&gt;LUCENE-7093&lt;/del&gt;&lt;/a&gt;: Added point values support to the memory index&lt;/p&gt;</comment>
                            <comment id="15195181" author="martijn.v.groningen" created="Tue, 15 Mar 2016 05:16:20 -0700">&lt;p&gt;pushed to branch_6_0, branch_6x and master&lt;/p&gt;</comment>
                            <comment id="15195330" author="dsmiley" created="Tue, 15 Mar 2016 06:59:54 -0700">&lt;p&gt;Mike, just curious, what scares you about BytesRefArray?  (I make no objection to any of your feedback above)&lt;/p&gt;</comment>
                            <comment id="15195339" author="mikemccand" created="Tue, 15 Mar 2016 07:09:02 -0700">&lt;blockquote&gt;&lt;p&gt;Assignee: David Smiley  (was: Martijn van Groningen)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Hmm &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley" class="user-hover" rel="dsmiley"&gt;David Smiley&lt;/a&gt;, why do you assign &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=martijn.v.groningen" class="user-hover" rel="martijn.v.groningen"&gt;Martijn van Groningen&lt;/a&gt;'s recent &lt;tt&gt;MemoryIndex&lt;/tt&gt; issues to yourself?  This confuses me, e.g. this one is already pushed.&lt;/p&gt;

&lt;p&gt;I think you did the same for his recent issue adding doc values.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Mike, just curious, what scares you about BytesRefArray? (I make no objection to any of your feedback above)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It's a very very expert internal class, it has scary package-private methods, we should not be making it more public.&lt;/p&gt;

&lt;p&gt;It also duplicates various other "append byte[] to big pool of byte[] blocks" that Lucene has and we should at some point consolidate, yet they all have small but important differences in their behavior.&lt;/p&gt;</comment>
                            <comment id="15195489" author="dsmiley" created="Tue, 15 Mar 2016 08:35:17 -0700">&lt;blockquote&gt;&lt;p&gt;Assignee: David Smiley (was: Martijn van Groningen)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That is so weird; I did &lt;b&gt;&lt;em&gt;not&lt;/em&gt;&lt;/b&gt; intend to do that!  I'm fixing it now.  Perhaps I hit some keys accidentally that changed it; I don't know.  Very disconcerting!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                                                <inwardlinks description="is part of">
                                        <issuelink>
            <issuekey id="12947769">LUCENE-7075</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12793535" name="LUCENE-7093.patch" size="25238" author="martijn.v.groningen" created="Tue, 15 Mar 2016 04:41:29 -0700"/>
                            <attachment id="12793303" name="LUCENE-7093.patch" size="23387" author="martijn.v.groningen" created="Mon, 14 Mar 2016 05:31:30 -0700"/>
                            <attachment id="12793285" name="LUCENE-7093.patch" size="21520" author="martijn.v.groningen" created="Mon, 14 Mar 2016 03:11:00 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 14 Mar 2016 10:11:00 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ugof:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7091] Add doc values support to MemoryIndex</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7091</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;Sometimes queries executed via the MemoryIndex require certain things to be stored as doc values. Today this isn't possible because the memory index doesn't support this and these queries silently return no results.&lt;/p&gt;</description>
                <environment/>
        <key id="12948721">LUCENE-7091</key>
            <summary>Add doc values support to MemoryIndex</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="martijn.v.groningen">Martijn van Groningen</assignee>
                                    <reporter username="martijn.v.groningen">Martijn van Groningen</reporter>
                        <labels>
                    </labels>
                <created>Thu, 10 Mar 2016 02:43:01 -0700</created>
                <updated>Tue, 15 Mar 2016 08:35:44 -0700</updated>
                            <resolved>Tue, 15 Mar 2016 02:03:04 -0700</resolved>
                                                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="15188976" author="martijn.v.groningen" created="Thu, 10 Mar 2016 02:45:51 -0700">&lt;p&gt;Added a test that adds simple doc values support for doc values. Nothing fancy here, but should just work.&lt;/p&gt;</comment>
                            <comment id="15188994" author="romseygeek" created="Thu, 10 Mar 2016 03:03:54 -0700">&lt;p&gt;+1, nice!&lt;/p&gt;

&lt;p&gt;Is there any reason for DocValuesHolder to be package-private?&lt;/p&gt;</comment>
                            <comment id="15189014" author="martijn.v.groningen" created="Thu, 10 Mar 2016 03:18:11 -0700">&lt;blockquote&gt;&lt;p&gt;Is there any reason for DocValuesHolder to be package-private?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;No, nothing outside MemoryIndex uses it. I can change the visibility to private.&lt;/p&gt;</comment>
                            <comment id="15189525" author="martijn.v.groningen" created="Thu, 10 Mar 2016 09:48:55 -0700">&lt;p&gt;Updated the patch:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Made sure the sorted set doc values doesn't have duplicate values.&lt;/li&gt;
	&lt;li&gt;Added extra test to verify that unsupported usage fails.&lt;/li&gt;
	&lt;li&gt;Changed DocValuesHolder class' visibility to private .&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15189769" author="dsmiley" created="Thu, 10 Mar 2016 12:12:46 -0700">&lt;p&gt;Cool.&lt;/p&gt;

&lt;p&gt;Instead of DocValuesHolder, how about actually having one implementation class per DocValues type that holds the value.  So, a MemoryNumericDocValues for example.  In your patch you do an anonymous class for each one but I think it would be clearer to not do that and eliminate the DocValuesHolder which is holding for multiple types of values at once which is a little confusing.  Note SortedDocValues extends BinaryDocValues so that eliminates an implementation.  I wish Lucene's DocValue abstractions were interfaces and not abstract classes since it prevents collapsing some other similar implementations into fewer concrete classes.&lt;/p&gt;

&lt;p&gt;Could you move fields() above MemoryFields so it reads more naturally?&lt;/p&gt;

&lt;p&gt;Why is there a different sorting approach to sorted numeric vs BytesRef DV types?  The former you add to an array and sort eventually, and the latter you use a TreeSet.  They could both be handled consistently &amp;#8211; array first then sort later.&lt;/p&gt;

&lt;p&gt;I noticed the BytesRefs DV data isn't copied; we retain a reference.  Is that allowed? I suspect not; seems very risky.  Notice that the term index data uses BytesRefHash wrapped around the shared ByteBlockPool.  Perhaps we should do similarly using the same ByteBlockPool.&lt;/p&gt;</comment>
                            <comment id="15190743" author="martijn.v.groningen" created="Fri, 11 Mar 2016 03:00:23 -0700">&lt;p&gt;Thanks for looking at this! I'll try to split this DocValuesHolder class into separate classes per DV type.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;In your patch you do an anonymous class for each one but I think it would be clearer to not do that and eliminate the DocValuesHolder which is holding for multiple types of values at once which is a little confusing.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;MemoryIndex is supposed to be thread safe after the freeze() method has been invoked. (this is describe in the jdocs) Returning the same doc values instance for binary, sorted, number and sorted number doc values is fine, but not for sorted set doc values. That implementation keeps state in order to iterate over the values. So for sorted set doc values we always need to return a new instance and in order to be consistent with the other doc values types I did they same thing there too. I think this isn't a big of deal.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Could you move fields() above MemoryFields so it reads more naturally?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Sure, will do&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Why is there a different sorting approach to sorted numeric vs BytesRef DV types? The former you add to an array and sort eventually, and the latter you use a TreeSet. They could both be handled consistently  array first then sort later.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That is what I thought initially too, but the difference between the two is that sorted numeric DV can hold duplicates while sort set DV doesn't hold duplicates. This is why I took the approach of using treeset during the building phase for any binary DV.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I noticed the BytesRefs DV data isn't copied; we retain a reference. Is that allowed?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Good point, let me fix this.&lt;/p&gt;</comment>
                            <comment id="15190828" author="martijn.v.groningen" created="Fri, 11 Mar 2016 04:43:42 -0700">&lt;p&gt;I've updated the patch based on David's comments.&lt;/p&gt;

&lt;p&gt;I did not split `DocValuesHolder` up in a class per DV type, but instead I've split it up in a class for the binary based DV and a class for the numeric based DV. So that the actual storage (long[] and BytesRefHash) is shared amongst the different DV impls. For all DV type but sorted set DV the patch now returns a pre set DV class.&lt;/p&gt;</comment>
                            <comment id="15191098" author="dsmiley" created="Fri, 11 Mar 2016 09:09:44 -0700">&lt;blockquote&gt;&lt;p&gt;Returning the same doc values instance for binary, sorted, number and sorted number doc values is fine, but not for sorted set doc values. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Good point.&lt;/p&gt;

&lt;p&gt;Some comments:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;addField: unfortunately this method is very long and it's difficult to follow.  I understand that it's not easy to split it up because of the number of local variables.  One thing that would help is renaming "longValues" and "bytesValuesSet" to make them clearly associated with doc-values.  I suggest "dvLongValues" and "dvBytesValuesSet" and add a comment to the former &lt;tt&gt;//NOT a set&lt;/tt&gt;.  Another thing that would help is comments to declare the different phases of this method... like definitely before the switch(docValuesType) and at other junctures.  But I already see some code duplication in how numericProducer &amp;amp; binaryProducer are initialized.  Here's an idea:  Maybe Info could be changed to hold this state mutably.  Then, there wouldn't be a long stage of pulling out each var from the info only to put it all back again.  If this idea is successful, there would be much fewer local variables, and then you could easily extract a method to handle the DV stuff and a separate method for the Terms stuff.  What do you think?&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;instead of freeze() knowing to call both getNormDocValues &amp;amp; prepareDocValues (and to sort terms), I suggest that freeze be implemented on each Info where those methods can be called there.  I think that's easier to maintain.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;... to be continued; I didn't finish reviewing ...&lt;/p&gt;</comment>
                            <comment id="15191669" author="martijn.v.groningen" created="Fri, 11 Mar 2016 16:17:55 -0700">&lt;p&gt;Good idea, changing the state to be mutable in the Info class allowed for splitting this big method up into 2 smaller methods. &lt;/p&gt;

&lt;p&gt;I updated the patch. This looks much better now.&lt;/p&gt;</comment>
                            <comment id="15191675" author="martijn.v.groningen" created="Fri, 11 Mar 2016 16:27:48 -0700">&lt;p&gt;Good idea, changing the state to be mutable in the Info class allowed for splitting this big method up into 2 smaller methods. &lt;/p&gt;

&lt;p&gt;I updated the patch. This looks much better now.&lt;/p&gt;</comment>
                            <comment id="15192549" author="martijn.v.groningen" created="Sun, 13 Mar 2016 15:11:47 -0700">&lt;p&gt;Small update:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Moved the doc values prepare state to Info class&lt;/li&gt;
	&lt;li&gt;Use spare BytesRef in BinaryDocValuesProducer to fetch binary / sorted / sorted set DV.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15192781" author="dsmiley" created="Sun, 13 Mar 2016 22:57:12 -0700">&lt;p&gt;I &lt;em&gt;really&lt;/em&gt; like how this refactor has turned out of making Info mutable.  &lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;I think the javadocs sentence you added to &lt;tt&gt;addField&lt;/tt&gt; meant to use "if" not "is".&lt;/li&gt;
	&lt;li&gt;In &lt;tt&gt;getInfoForExpectedDocValuesType()&lt;/tt&gt;, the two checks using &lt;tt&gt;(info.fieldInfo.getDocValuesType()&lt;/tt&gt; read a little weird/confusing to me but I get the gist of the intent.  Couldn't the first condition simply check &lt;tt&gt;expectedType == DocValuesType.NONE&lt;/tt&gt; to return null?  That's logically the same I think and could even be checked at the very front of the method.&lt;/li&gt;
	&lt;li&gt;getSortedSetDocValues's impl ought to reset index to 0 on setDocument().&lt;/li&gt;
	&lt;li&gt;getDocsWithField doesn't need to actually implement a bits, it can use &lt;tt&gt;return new Bits.MatchAllBits(1);&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;I think there's a bug in addField's positionIncrementGap &amp;amp; offsetGap handling.  If fields are added to MemoryIndex that are DV then terms data, the posInc &amp;amp; offset will get incremented when it shouldn't be.  This could be corrected by checking info.numTokens.  Please modify or add a test for this.  The boost should be applied conditionally as well (only when storeTerms is invoked).&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;storeDocValues()&lt;/tt&gt;: for SORTED_NUMERIC I'm concerned about that growing algorithim... it's O(N^2) as it creates a new array each time that is just one larger.  Ouch.  Maybe use a straight-forward array doubling algorithm and keep track of the number of values?&lt;/li&gt;
	&lt;li&gt;It's a shame that SORTED &amp;amp; BINARY use a BytesRefHash (adds overhead) and ultimately get sorted when, really, it's not necessary of course.  The ByteBlockPool could be used directly to store it (see BytesRefArray for examples) with a little bit of code.  This isn't a blocker but it would sure be nice.&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;testDocValues()&lt;/tt&gt; should test non-set behavior of sorted numerics, and set behavior of sorted set DV.  Could be done easily by changing or adding a couple lines of code.  Add term text here too, and under same field names as DV ones at that.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15193153" author="martijn.v.groningen" created="Mon, 14 Mar 2016 05:00:45 -0700">&lt;p&gt;Updated the patch with the good points that you've raised.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;It's a shame that SORTED &amp;amp; BINARY use a BytesRefHash (adds overhead) and ultimately get sorted when, really, it's not necessary of course. The ByteBlockPool could be used directly to store it (see BytesRefArray for examples) with a little bit of code. This isn't a blocker but it would sure be nice.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Agreed, that would be nicer. I think we should do this in a follow up issue.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Add term text here too, and under same field names as DV ones at that.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think this is covered in TestMemoryIndexAgainstRAMDir#testDocValuesMemoryIndexVsNormalIndex() test, in this test regular fields are randomilly added.&lt;/p&gt;</comment>
                            <comment id="15193364" author="dsmiley" created="Mon, 14 Mar 2016 07:26:44 -0700">&lt;p&gt;Almost there...&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;(still applies to the &lt;em&gt;other&lt;/em&gt; addField): I think the javadocs sentence you added to addField meant to use "if" not "is".&lt;/li&gt;
	&lt;li&gt;At first I thought there might have been a bug for double-applying the boost since I see you're still passing "boost" as a constructor argument to Info.  But now I see you only apply when numTokens &amp;gt; 0.  I think it would be much clearer (and simpler) to remove boost from the constructor to Info, and simply apply it in storeTerms (no matter what numTokens is).  It's hard to judge the testDocValuesDoNotAffectBoostPositionsOrOffset for this problem... it'd get encoded in the norm and I have no idea what norm it should be; your test asserts -127.  Hmmmm.  Perhaps simply leave a check of that nature to the test that asserts parity with the real index in RAMDirectory&lt;/li&gt;
	&lt;li&gt;in &lt;tt&gt;storeDocValues()&lt;/tt&gt; SORTED_NUMERIC: you call ArrayUtil.grow with only the array.  This results in the same &lt;tt&gt;O(N^2)&lt;/tt&gt; we're trying to avoid!  Pass in a second argument of the desired length.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15193486" author="martijn.v.groningen" created="Mon, 14 Mar 2016 08:33:16 -0700">&lt;p&gt;&amp;gt; in storeDocValues() SORTED_NUMERIC: you call ArrayUtil.grow with only the array. This results in the same O(N^2) we're trying to avoid! Pass in a second argument of the desired length.&lt;/p&gt;

&lt;p&gt;Maybe I was a bit concerned about the size of these arrays. ArrayUtil.grow(array) grows an array by an 1/8th and at least adds 3 additional slots, I thought that would be enough, since we don't know upfront how many new values are going to be added. I can change it double the array instead.&lt;/p&gt;</comment>
                            <comment id="15193500" author="dsmiley" created="Mon, 14 Mar 2016 08:42:01 -0700">&lt;p&gt;My main concern is that it not be O(N^2).  Personally I'm not too concerned with ArrayUtil.grow's algorithm.  You might also pick an initial size of something like '4' for the SORTED_NUMERIC case (since it implies the intent to add more than 1).  With MemoryIndex I think speed is generally more important than memory size any way.&lt;/p&gt;</comment>
                            <comment id="15193519" author="martijn.v.groningen" created="Mon, 14 Mar 2016 09:00:02 -0700">&lt;p&gt;Right, speed over memory, I'll change it to the doubling logic you initially suggested.&lt;/p&gt;</comment>
                            <comment id="15193533" author="martijn.v.groningen" created="Mon, 14 Mar 2016 09:08:55 -0700">&lt;p&gt;Updated the patch.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;(still applies to the other addField): I think the javadocs sentence you added to addField meant to use "if" not "is".&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Changed. &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;At first I thought there might have been a bug for double-applying the boost since I see you're still passing "boost" as a constructor argument to Info. But now I see you only apply when numTokens &amp;gt; 0. I think it would be much clearer (and simpler) to remove boost from the constructor to Info, and simply apply it in storeTerms (no matter what numTokens is). It's hard to judge the testDocValuesDoNotAffectBoostPositionsOrOffset for this problem... it'd get encoded in the norm and I have no idea what norm it should be; your test asserts -127. Hmmmm. Perhaps simply leave a check of that nature to the test that asserts parity with the real index in RAMDirectory&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Removed the boost constructor parameter and added a dedicated test for this in TestMemoryIndexAgainstRAMDir.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;in storeDocValues() SORTED_NUMERIC: you call ArrayUtil.grow with only the array. This results in the same O(N^2) we're trying to avoid! Pass in a second argument of the desired length.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Changed, the size is array doubled when growing is necessary.&lt;/p&gt;</comment>
                            <comment id="15193749" author="dsmiley" created="Mon, 14 Mar 2016 10:53:06 -0700">&lt;p&gt;Eh, the grow algorithm/code still isn't right.  The code in the patch will double the size even though it's likely plenty big to add the current long trying to get added.  This is what I mean:&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
      &lt;span class="code-keyword"&gt;case&lt;/span&gt; SORTED_NUMERIC:
        &lt;span class="code-keyword"&gt;if&lt;/span&gt; (info.numericProducer.dvLongValues == &lt;span class="code-keyword"&gt;null&lt;/span&gt;) {
          info.numericProducer.dvLongValues = &lt;span class="code-keyword"&gt;new&lt;/span&gt; &lt;span class="code-object"&gt;long&lt;/span&gt;[4];
        }
        info.numericProducer.dvLongValues = ArrayUtil.grow(info.numericProducer.dvLongValues, info.numericProducer.count + 1);
        info.numericProducer.dvLongValues[info.numericProducer.count++] = (&lt;span class="code-object"&gt;long&lt;/span&gt;) docValuesValue;
        &lt;span class="code-keyword"&gt;break&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Everything else is good.  Assuming you agree with this code snippet above, +1 from me to commit.&lt;/p&gt;</comment>
                            <comment id="15194093" author="martijn.v.groningen" created="Mon, 14 Mar 2016 13:45:55 -0700">&lt;p&gt;Ah, that makes more sense. I misunderstood what you meant earlier. I've updated the patch. Thank you for this thorough review! &lt;/p&gt;</comment>
                            <comment id="15194938" author="martijn.v.groningen" created="Tue, 15 Mar 2016 01:44:30 -0700">&lt;p&gt;I'll backport this change to 6.0 and 6.x branches. Otherwise &lt;a href="https://issues.apache.org/jira/browse/LUCENE-7093" title="MemoryIndex does not support points" class="issue-link" data-issue-key="LUCENE-7093"&gt;&lt;del&gt;LUCENE-7093&lt;/del&gt;&lt;/a&gt; can't be backported and that would be bad as simple queries on numeric fields wouldn't work anymore, since numerics have moved to use points instead.&lt;/p&gt;

&lt;p&gt;Because of this I'll backport &lt;a href="https://issues.apache.org/jira/browse/LUCENE-7087" title="Change MemoryIndex#fromDocument(...) helpers to accept Iterable&amp;lt;IndexableField&amp;gt; as document" class="issue-link" data-issue-key="LUCENE-7087"&gt;&lt;del&gt;LUCENE-7087&lt;/del&gt;&lt;/a&gt; to 6.0 too.&lt;/p&gt;</comment>
                            <comment id="15194959" author="jira-bot" created="Tue, 15 Mar 2016 02:02:18 -0700">&lt;p&gt;Commit bd0803fd41c68297c54201529c2c14ad50cda48e in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=martijn.v.groningen" class="user-hover" rel="martijn.v.groningen"&gt;Martijn van Groningen&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=bd0803f" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=bd0803f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7091" title="Add doc values support to MemoryIndex" class="issue-link" data-issue-key="LUCENE-7091"&gt;&lt;del&gt;LUCENE-7091&lt;/del&gt;&lt;/a&gt;: Added doc values support to memory index&lt;/p&gt;</comment>
                            <comment id="15194960" author="jira-bot" created="Tue, 15 Mar 2016 02:02:19 -0700">&lt;p&gt;Commit 559432fcdcd828864a800072cf144e1f5c96647e in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=martijn.v.groningen" class="user-hover" rel="martijn.v.groningen"&gt;Martijn van Groningen&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=559432f" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=559432f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7091" title="Add doc values support to MemoryIndex" class="issue-link" data-issue-key="LUCENE-7091"&gt;&lt;del&gt;LUCENE-7091&lt;/del&gt;&lt;/a&gt;: Added doc values support to memory index&lt;/p&gt;</comment>
                            <comment id="15194961" author="jira-bot" created="Tue, 15 Mar 2016 02:02:20 -0700">&lt;p&gt;Commit cf3eea26406692306505d2606d7ff73ee3634c30 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=martijn.v.groningen" class="user-hover" rel="martijn.v.groningen"&gt;Martijn van Groningen&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=cf3eea2" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=cf3eea2&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7091" title="Add doc values support to MemoryIndex" class="issue-link" data-issue-key="LUCENE-7091"&gt;&lt;del&gt;LUCENE-7091&lt;/del&gt;&lt;/a&gt;: Added doc values support to memory index&lt;/p&gt;</comment>
                            <comment id="15194962" author="martijn.v.groningen" created="Tue, 15 Mar 2016 02:03:05 -0700">&lt;p&gt;Pushed to master, branch_6x and branch_6_0 branches.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12793394" name="LUCENE-7091.patch" size="40899" author="martijn.v.groningen" created="Mon, 14 Mar 2016 13:45:55 -0700"/>
                            <attachment id="12793333" name="LUCENE-7091.patch" size="41032" author="martijn.v.groningen" created="Mon, 14 Mar 2016 09:08:55 -0700"/>
                            <attachment id="12793300" name="LUCENE-7091.patch" size="39768" author="martijn.v.groningen" created="Mon, 14 Mar 2016 05:00:45 -0700"/>
                            <attachment id="12793217" name="LUCENE-7091.patch" size="37780" author="martijn.v.groningen" created="Sun, 13 Mar 2016 15:11:47 -0700"/>
                            <attachment id="12792924" name="LUCENE-7091.patch" size="37790" author="martijn.v.groningen" created="Fri, 11 Mar 2016 16:27:47 -0700"/>
                            <attachment id="12792921" name="LUCENE-7091.patch" size="37790" author="martijn.v.groningen" created="Fri, 11 Mar 2016 16:17:23 -0700"/>
                            <attachment id="12792784" name="LUCENE-7091.patch" size="35759" author="martijn.v.groningen" created="Fri, 11 Mar 2016 04:43:42 -0700"/>
                            <attachment id="12792538" name="LUCENE-7091.patch" size="33084" author="martijn.v.groningen" created="Thu, 10 Mar 2016 09:48:55 -0700"/>
                            <attachment id="12792478" name="LUCENE-7091.patch" size="28538" author="martijn.v.groningen" created="Thu, 10 Mar 2016 02:45:51 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 10 Mar 2016 10:03:54 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ugfj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7090] Add single-valued points support to fieldcache</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7090</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;This is a big user of the deprecated encoding (&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7075" title="Clean up LegacyNumericUtils usage." class="issue-link" data-issue-key="LUCENE-7075"&gt;LUCENE-7075&lt;/a&gt;). Also it is a step to help migrate stuff like spatial-extras away from it too.&lt;/p&gt;</description>
                <environment/>
        <key id="12948680">LUCENE-7090</key>
            <summary>Add single-valued points support to fieldcache</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rcmuir">Robert Muir</reporter>
                        <labels>
                    </labels>
                <created>Wed, 9 Mar 2016 23:35:08 -0700</created>
                <updated>Thu, 10 Mar 2016 07:19:32 -0700</updated>
                            <resolved>Thu, 10 Mar 2016 07:19:32 -0700</resolved>
                                                    <fixVersion>master</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="15188777" author="rcmuir" created="Wed, 9 Mar 2016 23:40:38 -0700">&lt;p&gt;Patch. I ported a good deal of the tests. If they were testing anything particular about numeric types, i kept the legacy version too. Separately there is still some cleanup to be done on the tests: I didn't port 100% of them yet (esp. dodging SlowMultiWrapper at every turn).&lt;/p&gt;

&lt;p&gt;We can followup with multi-valued in another issue, this is already big enough at once.&lt;/p&gt;</comment>
                            <comment id="15188806" author="rcmuir" created="Wed, 9 Mar 2016 23:56:12 -0700">&lt;p&gt;updated patch with more progress. unrelated to this issue, we should really fix the thread-safety test, i think its a no-op? It doesn't seem to be doing any actual uninverting.&lt;/p&gt;</comment>
                            <comment id="15189096" author="mikemccand" created="Thu, 10 Mar 2016 03:57:42 -0700">&lt;p&gt;+1, looks wonderful.  Thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="15189284" author="jira-bot" created="Thu, 10 Mar 2016 06:30:06 -0700">&lt;p&gt;Commit d35d5694d8ce04f062891e01566514d5496e646a in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d35d569" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d35d569&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7090" title="Add single-valued points support to fieldcache" class="issue-link" data-issue-key="LUCENE-7090"&gt;&lt;del&gt;LUCENE-7090&lt;/del&gt;&lt;/a&gt;, &lt;a href="https://issues.apache.org/jira/browse/LUCENE-7075" title="Clean up LegacyNumericUtils usage." class="issue-link" data-issue-key="LUCENE-7075"&gt;LUCENE-7075&lt;/a&gt;: deprecate single-valued LegacyNumerics fieldcaching, provide Points-based replacement.&lt;/p&gt;</comment>
                            <comment id="15189310" author="jira-bot" created="Thu, 10 Mar 2016 06:53:43 -0700">&lt;p&gt;Commit a3f72fcdec2188900bb511a710d4714d5053ea40 in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=a3f72fc" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=a3f72fc&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7090" title="Add single-valued points support to fieldcache" class="issue-link" data-issue-key="LUCENE-7090"&gt;&lt;del&gt;LUCENE-7090&lt;/del&gt;&lt;/a&gt;, &lt;a href="https://issues.apache.org/jira/browse/LUCENE-7075" title="Clean up LegacyNumericUtils usage." class="issue-link" data-issue-key="LUCENE-7075"&gt;LUCENE-7075&lt;/a&gt;: deprecate single-valued LegacyNumerics fieldcaching, provide Points-based replacement.&lt;/p&gt;</comment>
                            <comment id="15189338" author="jira-bot" created="Thu, 10 Mar 2016 07:18:15 -0700">&lt;p&gt;Commit ad257486caf44754c909495306fd0bd31d419c37 in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ad25748" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ad25748&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7090" title="Add single-valued points support to fieldcache" class="issue-link" data-issue-key="LUCENE-7090"&gt;&lt;del&gt;LUCENE-7090&lt;/del&gt;&lt;/a&gt;, &lt;a href="https://issues.apache.org/jira/browse/LUCENE-7075" title="Clean up LegacyNumericUtils usage." class="issue-link" data-issue-key="LUCENE-7075"&gt;LUCENE-7075&lt;/a&gt;: deprecate single-valued LegacyNumerics fieldcaching, provide Points-based replacement.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                                                <inwardlinks description="is part of">
                                        <issuelink>
            <issuekey id="12947769">LUCENE-7075</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12792461" name="LUCENE-7090.patch" size="127483" author="rcmuir" created="Wed, 9 Mar 2016 23:56:12 -0700"/>
                            <attachment id="12792454" name="LUCENE-7090.patch" size="126249" author="rcmuir" created="Wed, 9 Mar 2016 23:40:38 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 10 Mar 2016 10:57:42 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ug6f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7089] Add points support to flexible queryparser to replace legacy numerics support.</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7089</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;This adds 1D point ranges/terms, the exact same way legacy numerics works (and marks all their classes deprecated). &lt;/p&gt;</description>
                <environment/>
        <key id="12948555">LUCENE-7089</key>
            <summary>Add points support to flexible queryparser to replace legacy numerics support.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rcmuir">Robert Muir</reporter>
                        <labels>
                    </labels>
                <created>Wed, 9 Mar 2016 14:35:14 -0700</created>
                <updated>Wed, 9 Mar 2016 20:13:09 -0700</updated>
                            <resolved>Wed, 9 Mar 2016 20:13:09 -0700</resolved>
                                                    <fixVersion>master</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="15188105" author="mikemccand" created="Wed, 9 Mar 2016 14:44:57 -0700">&lt;p&gt;Phew, lots of classes for flexible QP.&lt;/p&gt;

&lt;p&gt;+1, thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="15188503" author="jira-bot" created="Wed, 9 Mar 2016 19:05:00 -0700">&lt;p&gt;Commit 89cc676f2bf560091bd24db544faa16946654164 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=89cc676" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=89cc676&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7089" title="Add points support to flexible queryparser to replace legacy numerics support." class="issue-link" data-issue-key="LUCENE-7089"&gt;&lt;del&gt;LUCENE-7089&lt;/del&gt;&lt;/a&gt;, &lt;a href="https://issues.apache.org/jira/browse/LUCENE-7075" title="Clean up LegacyNumericUtils usage." class="issue-link" data-issue-key="LUCENE-7075"&gt;LUCENE-7075&lt;/a&gt;: add points to flexible queryparser to replace legacy numerics support&lt;/p&gt;</comment>
                            <comment id="15188553" author="jira-bot" created="Wed, 9 Mar 2016 19:45:15 -0700">&lt;p&gt;Commit c8543efacf43dafa76214a96d47876f12c3cf666 in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c8543ef" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c8543ef&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7089" title="Add points support to flexible queryparser to replace legacy numerics support." class="issue-link" data-issue-key="LUCENE-7089"&gt;&lt;del&gt;LUCENE-7089&lt;/del&gt;&lt;/a&gt;, &lt;a href="https://issues.apache.org/jira/browse/LUCENE-7075" title="Clean up LegacyNumericUtils usage." class="issue-link" data-issue-key="LUCENE-7075"&gt;LUCENE-7075&lt;/a&gt;: add points to flexible queryparser to replace legacy numerics support&lt;/p&gt;</comment>
                            <comment id="15188586" author="jira-bot" created="Wed, 9 Mar 2016 20:12:43 -0700">&lt;p&gt;Commit 306d3fe852407d167964cdd7ea1010f42cf7944b in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=306d3fe" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=306d3fe&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7089" title="Add points support to flexible queryparser to replace legacy numerics support." class="issue-link" data-issue-key="LUCENE-7089"&gt;&lt;del&gt;LUCENE-7089&lt;/del&gt;&lt;/a&gt;, &lt;a href="https://issues.apache.org/jira/browse/LUCENE-7075" title="Clean up LegacyNumericUtils usage." class="issue-link" data-issue-key="LUCENE-7075"&gt;LUCENE-7075&lt;/a&gt;: add points to flexible queryparser to replace legacy numerics support&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                                                <inwardlinks description="is part of">
                                        <issuelink>
            <issuekey id="12947769">LUCENE-7075</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12792350" name="LUCENE-7089.patch" size="173501" author="rcmuir" created="Wed, 9 Mar 2016 14:35:42 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 9 Mar 2016 21:44:57 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ufen:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7088] Add PointRangeQueryBuilder to xml-queryparser to replace LegacyNumericRangeQueryBuilder</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7088</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description/>
                <environment/>
        <key id="12948400">LUCENE-7088</key>
            <summary>Add PointRangeQueryBuilder to xml-queryparser to replace LegacyNumericRangeQueryBuilder</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rcmuir">Robert Muir</reporter>
                        <labels>
                    </labels>
                <created>Wed, 9 Mar 2016 06:51:12 -0700</created>
                <updated>Wed, 9 Mar 2016 08:42:28 -0700</updated>
                            <resolved>Wed, 9 Mar 2016 08:42:28 -0700</resolved>
                                                    <fixVersion>master</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="15187113" author="rcmuir" created="Wed, 9 Mar 2016 06:52:03 -0700">&lt;p&gt;Simple patch, its a replacement for the 1D case.&lt;/p&gt;</comment>
                            <comment id="15187135" author="mikemccand" created="Wed, 9 Mar 2016 07:16:40 -0700">&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="15187213" author="jira-bot" created="Wed, 9 Mar 2016 08:07:49 -0700">&lt;p&gt;Commit 116ece2fe4386496dd2131bd6b4f11ed01cce7fc in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=116ece2" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=116ece2&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7088" title="Add PointRangeQueryBuilder to xml-queryparser to replace LegacyNumericRangeQueryBuilder" class="issue-link" data-issue-key="LUCENE-7088"&gt;&lt;del&gt;LUCENE-7088&lt;/del&gt;&lt;/a&gt;, &lt;a href="https://issues.apache.org/jira/browse/LUCENE-7075" title="Clean up LegacyNumericUtils usage." class="issue-link" data-issue-key="LUCENE-7075"&gt;LUCENE-7075&lt;/a&gt;: Add PointRangeQueryBuilder to xml-queryparser to replace LegacyNumericRangeQueryBuilder&lt;/p&gt;</comment>
                            <comment id="15187240" author="jira-bot" created="Wed, 9 Mar 2016 08:24:22 -0700">&lt;p&gt;Commit ba0f63c0c25ca520b8816ac1ae803d7c7451dcca in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ba0f63c" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ba0f63c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7088" title="Add PointRangeQueryBuilder to xml-queryparser to replace LegacyNumericRangeQueryBuilder" class="issue-link" data-issue-key="LUCENE-7088"&gt;&lt;del&gt;LUCENE-7088&lt;/del&gt;&lt;/a&gt;, &lt;a href="https://issues.apache.org/jira/browse/LUCENE-7075" title="Clean up LegacyNumericUtils usage." class="issue-link" data-issue-key="LUCENE-7075"&gt;LUCENE-7075&lt;/a&gt;: Add PointRangeQueryBuilder to xml-queryparser to replace LegacyNumericRangeQueryBuilder&lt;/p&gt;</comment>
                            <comment id="15187266" author="jira-bot" created="Wed, 9 Mar 2016 08:42:12 -0700">&lt;p&gt;Commit 256bef80da9a758047c520bf4d065df03ebe14b8 in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=256bef8" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=256bef8&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7088" title="Add PointRangeQueryBuilder to xml-queryparser to replace LegacyNumericRangeQueryBuilder" class="issue-link" data-issue-key="LUCENE-7088"&gt;&lt;del&gt;LUCENE-7088&lt;/del&gt;&lt;/a&gt;, &lt;a href="https://issues.apache.org/jira/browse/LUCENE-7075" title="Clean up LegacyNumericUtils usage." class="issue-link" data-issue-key="LUCENE-7075"&gt;LUCENE-7075&lt;/a&gt;: Add PointRangeQueryBuilder to xml-queryparser to replace LegacyNumericRangeQueryBuilder&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                                                <inwardlinks description="is part of">
                                        <issuelink>
            <issuekey id="12947769">LUCENE-7075</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12792256" name="LUCENE-7088.patch" size="9098" author="rcmuir" created="Wed, 9 Mar 2016 06:52:03 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 9 Mar 2016 14:16:40 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ueg7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7087] Change MemoryIndex#fromDocument(...) helpers to accept Iterable&lt;IndexableField&gt; as document</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7087</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description/>
                <environment/>
        <key id="12948399">LUCENE-7087</key>
            <summary>Change MemoryIndex#fromDocument(...) helpers to accept Iterable&lt;IndexableField&gt; as document</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="martijn.v.groningen">Martijn van Groningen</reporter>
                        <labels>
                    </labels>
                <created>Wed, 9 Mar 2016 06:43:44 -0700</created>
                <updated>Tue, 15 Mar 2016 01:55:23 -0700</updated>
                            <resolved>Thu, 10 Mar 2016 06:26:16 -0700</resolved>
                                                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="15187125" author="romseygeek" created="Wed, 9 Mar 2016 07:02:34 -0700">&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="15188826" author="jpountz" created="Thu, 10 Mar 2016 00:16:06 -0700">&lt;p&gt;Can you make it &lt;tt&gt;Iterable&amp;lt;? extends IndexableField&amp;gt;&lt;/tt&gt; instead (like IndexWriter) so that it is fine to pass eg. a &lt;tt&gt;List&amp;lt;Field&amp;gt;&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="15188892" author="martijn.v.groningen" created="Thu, 10 Mar 2016 01:11:56 -0700">&lt;p&gt;Thanks, Alan and Adrien. I've updated the patch.&lt;/p&gt;</comment>
                            <comment id="15188909" author="jpountz" created="Thu, 10 Mar 2016 01:29:36 -0700">&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="15189276" author="jira-bot" created="Thu, 10 Mar 2016 06:24:53 -0700">&lt;p&gt;Commit 73db4cab6a7f4948e803f649759781c84fbb3e3f in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=martijn.v.groningen" class="user-hover" rel="martijn.v.groningen"&gt;Martijn van Groningen&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=73db4ca" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=73db4ca&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7087" title="Change MemoryIndex#fromDocument(...) helpers to accept Iterable&amp;lt;IndexableField&amp;gt; as document" class="issue-link" data-issue-key="LUCENE-7087"&gt;&lt;del&gt;LUCENE-7087&lt;/del&gt;&lt;/a&gt;: Let MemoryIndex#fromDocument(...) accept 'Iterable&amp;lt;? extends IndexableField&amp;gt;' as document instead of 'Document'&lt;/p&gt;</comment>
                            <comment id="15189277" author="jira-bot" created="Thu, 10 Mar 2016 06:24:54 -0700">&lt;p&gt;Commit 0b8b16f9f281f10d730019f6e291b31f42b936c7 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=martijn.v.groningen" class="user-hover" rel="martijn.v.groningen"&gt;Martijn van Groningen&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=0b8b16f" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=0b8b16f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7087" title="Change MemoryIndex#fromDocument(...) helpers to accept Iterable&amp;lt;IndexableField&amp;gt; as document" class="issue-link" data-issue-key="LUCENE-7087"&gt;&lt;del&gt;LUCENE-7087&lt;/del&gt;&lt;/a&gt;: Let MemoryIndex#fromDocument(...) accept 'Iterable&amp;lt;? extends IndexableField&amp;gt;' as document instead of 'Document'&lt;/p&gt;</comment>
                            <comment id="15189280" author="martijn.v.groningen" created="Thu, 10 Mar 2016 06:26:16 -0700">&lt;p&gt;pushed to 6x and master branches&lt;/p&gt;</comment>
                            <comment id="15194948" author="jira-bot" created="Tue, 15 Mar 2016 01:55:09 -0700">&lt;p&gt;Commit 118b8965ce4a56e57b57f8ba7f0bf3fa8bac5250 in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=martijn.v.groningen" class="user-hover" rel="martijn.v.groningen"&gt;Martijn van Groningen&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=118b896" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=118b896&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7087" title="Change MemoryIndex#fromDocument(...) helpers to accept Iterable&amp;lt;IndexableField&amp;gt; as document" class="issue-link" data-issue-key="LUCENE-7087"&gt;&lt;del&gt;LUCENE-7087&lt;/del&gt;&lt;/a&gt;: Let MemoryIndex#fromDocument(...) accept 'Iterable&amp;lt;? extends IndexableField&amp;gt;' as document instead of 'Document'&lt;/p&gt;</comment>
                            <comment id="15194949" author="jira-bot" created="Tue, 15 Mar 2016 01:55:10 -0700">&lt;p&gt;Commit 13ce0815a72abca783b1bed89f04b14071306d9e in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=martijn.v.groningen" class="user-hover" rel="martijn.v.groningen"&gt;Martijn van Groningen&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=13ce081" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=13ce081&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Change entry to reflect that &lt;a href="https://issues.apache.org/jira/browse/LUCENE-7087" title="Change MemoryIndex#fromDocument(...) helpers to accept Iterable&amp;lt;IndexableField&amp;gt; as document" class="issue-link" data-issue-key="LUCENE-7087"&gt;&lt;del&gt;LUCENE-7087&lt;/del&gt;&lt;/a&gt; has been backported to 6.0&lt;/p&gt;</comment>
                            <comment id="15194950" author="jira-bot" created="Tue, 15 Mar 2016 01:55:11 -0700">&lt;p&gt;Commit 8185c8a11dbfd170b046e4239b0222b5b0bf2007 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=martijn.v.groningen" class="user-hover" rel="martijn.v.groningen"&gt;Martijn van Groningen&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=8185c8a" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=8185c8a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Change entry to reflect that &lt;a href="https://issues.apache.org/jira/browse/LUCENE-7087" title="Change MemoryIndex#fromDocument(...) helpers to accept Iterable&amp;lt;IndexableField&amp;gt; as document" class="issue-link" data-issue-key="LUCENE-7087"&gt;&lt;del&gt;LUCENE-7087&lt;/del&gt;&lt;/a&gt; has been backported to 6.0&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12792472" name="LUCENE_7087.patch" size="2605" author="martijn.v.groningen" created="Thu, 10 Mar 2016 01:11:56 -0700"/>
                            <attachment id="12792255" name="LUCENE_7087.patch" size="1911" author="martijn.v.groningen" created="Wed, 9 Mar 2016 06:45:19 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 9 Mar 2016 14:02:34 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2uefz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7086] SlowCompositeReaderWrapper does not support point values</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7086</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;SlowCompositeReaderWrapper.getPointValues always returns null. I think this is trappy and we should either implement it or throw an UnsupportedOperationException instead.&lt;/p&gt;</description>
                <environment/>
        <key id="12948357">LUCENE-7086</key>
            <summary>SlowCompositeReaderWrapper does not support point values</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mikemccand">Michael McCandless</assignee>
                                    <reporter username="jpountz">Adrien Grand</reporter>
                        <labels>
                    </labels>
                <created>Wed, 9 Mar 2016 02:59:51 -0700</created>
                <updated>Tue, 26 Apr 2016 02:33:55 -0700</updated>
                            <resolved>Thu, 10 Mar 2016 15:20:47 -0700</resolved>
                                                    <fixVersion>master</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                <comments>
                            <comment id="15187314" author="dsmiley" created="Wed, 9 Mar 2016 09:09:20 -0700">&lt;p&gt;Sounds serious.&lt;/p&gt;</comment>
                            <comment id="15187659" author="mikemccand" created="Wed, 9 Mar 2016 11:54:05 -0700">&lt;p&gt;Thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jpountz" class="user-hover" rel="jpountz"&gt;Adrien Grand&lt;/a&gt;, I'll fix it to throw UOE.&lt;/p&gt;</comment>
                            <comment id="15189460" author="mikemccand" created="Thu, 10 Mar 2016 08:49:55 -0700">&lt;p&gt;Here's a patch ... Lucene tests pass, but I haven't run precommit yet, and I expect to resolve conflicts on merging master.  I move the slow wrapper to misc, and fixed it to throw &lt;tt&gt;IllegalArgumentException&lt;/tt&gt; if you try to wrap a reader that does have point values.&lt;/p&gt;</comment>
                            <comment id="15189462" author="rcmuir" created="Thu, 10 Mar 2016 08:54:49 -0700">&lt;p&gt;If the UOE is thrown at wrap time then the behavior is sane and can return null. So the nocommit/ugly changes in MergeState can be reverted.&lt;/p&gt;</comment>
                            <comment id="15189479" author="thetaphi" created="Thu, 10 Mar 2016 09:09:40 -0700">&lt;blockquote&gt;&lt;p&gt;If the UOE is thrown at wrap time then the behavior is sane and can return null. So the nocommit/ugly changes in MergeState can be reverted.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yeah, this is better! I think we just need to check if there are any point values in the sub readers and throw UOE (but with a message, please!).&lt;/p&gt;</comment>
                            <comment id="15189514" author="dsmiley" created="Thu, 10 Mar 2016 09:40:34 -0700">&lt;p&gt;Why not support PointValues from SCRW &amp;#8211; a Multi implementation?  I wonder if it might be trappy for SCRW to handle everything else yet not this.&lt;/p&gt;</comment>
                            <comment id="15189712" author="mikemccand" created="Thu, 10 Mar 2016 11:44:14 -0700">&lt;p&gt;Thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt; and &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi" class="user-hover" rel="thetaphi"&gt;Uwe Schindler&lt;/a&gt;, that's a good idea.  Here's a new patch doing that, and fixing remaining nocommits so tests and precommit pass!  I just have to merge master &lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/smile.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt;&lt;/p&gt;</comment>
                            <comment id="15189779" author="mikemccand" created="Thu, 10 Mar 2016 12:18:06 -0700">&lt;blockquote&gt;&lt;p&gt;Why not support PointValues from SCRW  a Multi implementation? I wonder if it might be trappy for SCRW to handle everything else yet not this.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Well, merging point values on the fly is somewhat tricky ... e.g. see&lt;br/&gt;
how SegmentMerge does it (NOT on the fly).  And since this is a&lt;br/&gt;
completely new feature, new code will have to be written to use it,&lt;br/&gt;
and that new code can work per segment ... there are many examples&lt;br/&gt;
(the point queries, the tests) showing how.  Finally, this solution&lt;br/&gt;
isn't trappy (after this fix): you get a clear exception saying it's&lt;br/&gt;
not supported, and you can always wrap your reader to hide its point&lt;br/&gt;
values if you want to slow wrap everything else.&lt;/p&gt;</comment>
                            <comment id="15189848" author="rcmuir" created="Thu, 10 Mar 2016 12:51:36 -0700">&lt;p&gt;+1, nice cleanup. now we can write tests for points without fear &lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/smile.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt;&lt;/p&gt;</comment>
                            <comment id="15189941" author="jira-bot" created="Thu, 10 Mar 2016 14:09:08 -0700">&lt;p&gt;Commit 7523ca116276fbcf03bfa630c859c4a58f77add4 in lucene-solr's branch refs/heads/master from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=7523ca1" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=7523ca1&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7086" title="SlowCompositeReaderWrapper does not support point values" class="issue-link" data-issue-key="LUCENE-7086"&gt;&lt;del&gt;LUCENE-7086&lt;/del&gt;&lt;/a&gt;: move SlowCompositeReaderWrapper to misc module, and throw clear exc if you try to use in with points&lt;/p&gt;

&lt;p&gt;Squashed commits:&lt;/p&gt;

&lt;p&gt;commit e26b065c71388407bc6725256ca43d7bb30dee29&lt;br/&gt;
Author: Mike McCandless &amp;lt;mikemccand@apache.org&amp;gt;&lt;br/&gt;
Date:   Thu Mar 10 14:16:45 2016 -0500&lt;/p&gt;

&lt;p&gt;    simplify the checking for incoming points&lt;/p&gt;

&lt;p&gt;commit b7254376dcb398c7739aab4544118bb4526961d5&lt;br/&gt;
Merge: 8ec82a0 d35d569&lt;br/&gt;
Author: Mike McCandless &amp;lt;mikemccand@apache.org&amp;gt;&lt;br/&gt;
Date:   Thu Mar 10 14:05:24 2016 -0500&lt;/p&gt;

&lt;p&gt;    Merge branch 'master' into slow_wrapper&lt;/p&gt;

&lt;p&gt;    Conflicts:&lt;br/&gt;
    	lucene/misc/src/test/org/apache/lucene/uninverting/TestFieldCache.java&lt;br/&gt;
    	lucene/misc/src/test/org/apache/lucene/uninverting/TestFieldCacheReopen.java&lt;/p&gt;

&lt;p&gt;commit 8ec82a0d9a0dd946d96da20962bb2ea95758edbe&lt;br/&gt;
Author: Mike McCandless &amp;lt;mikemccand@apache.org&amp;gt;&lt;br/&gt;
Date:   Thu Mar 10 13:56:25 2016 -0500&lt;/p&gt;

&lt;p&gt;    &lt;a href="https://issues.apache.org/jira/browse/LUCENE-7086" title="SlowCompositeReaderWrapper does not support point values" class="issue-link" data-issue-key="LUCENE-7086"&gt;&lt;del&gt;LUCENE-7086&lt;/del&gt;&lt;/a&gt;: move SlowCompositeReaderWrapper to misc module&lt;/p&gt;</comment>
                            <comment id="15189942" author="jira-bot" created="Thu, 10 Mar 2016 14:09:09 -0700">&lt;p&gt;Commit 7523ca116276fbcf03bfa630c859c4a58f77add4 in lucene-solr's branch refs/heads/master from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=7523ca1" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=7523ca1&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7086" title="SlowCompositeReaderWrapper does not support point values" class="issue-link" data-issue-key="LUCENE-7086"&gt;&lt;del&gt;LUCENE-7086&lt;/del&gt;&lt;/a&gt;: move SlowCompositeReaderWrapper to misc module, and throw clear exc if you try to use in with points&lt;/p&gt;

&lt;p&gt;Squashed commits:&lt;/p&gt;

&lt;p&gt;commit e26b065c71388407bc6725256ca43d7bb30dee29&lt;br/&gt;
Author: Mike McCandless &amp;lt;mikemccand@apache.org&amp;gt;&lt;br/&gt;
Date:   Thu Mar 10 14:16:45 2016 -0500&lt;/p&gt;

&lt;p&gt;    simplify the checking for incoming points&lt;/p&gt;

&lt;p&gt;commit b7254376dcb398c7739aab4544118bb4526961d5&lt;br/&gt;
Merge: 8ec82a0 d35d569&lt;br/&gt;
Author: Mike McCandless &amp;lt;mikemccand@apache.org&amp;gt;&lt;br/&gt;
Date:   Thu Mar 10 14:05:24 2016 -0500&lt;/p&gt;

&lt;p&gt;    Merge branch 'master' into slow_wrapper&lt;/p&gt;

&lt;p&gt;    Conflicts:&lt;br/&gt;
    	lucene/misc/src/test/org/apache/lucene/uninverting/TestFieldCache.java&lt;br/&gt;
    	lucene/misc/src/test/org/apache/lucene/uninverting/TestFieldCacheReopen.java&lt;/p&gt;

&lt;p&gt;commit 8ec82a0d9a0dd946d96da20962bb2ea95758edbe&lt;br/&gt;
Author: Mike McCandless &amp;lt;mikemccand@apache.org&amp;gt;&lt;br/&gt;
Date:   Thu Mar 10 13:56:25 2016 -0500&lt;/p&gt;

&lt;p&gt;    &lt;a href="https://issues.apache.org/jira/browse/LUCENE-7086" title="SlowCompositeReaderWrapper does not support point values" class="issue-link" data-issue-key="LUCENE-7086"&gt;&lt;del&gt;LUCENE-7086&lt;/del&gt;&lt;/a&gt;: move SlowCompositeReaderWrapper to misc module&lt;/p&gt;</comment>
                            <comment id="15190020" author="jira-bot" created="Thu, 10 Mar 2016 14:54:20 -0700">&lt;p&gt;Commit 7927a3101e1f446939bfa311968346ddd57c29f3 in lucene-solr's branch refs/heads/branch_6x from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=7927a31" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=7927a31&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7086" title="SlowCompositeReaderWrapper does not support point values" class="issue-link" data-issue-key="LUCENE-7086"&gt;&lt;del&gt;LUCENE-7086&lt;/del&gt;&lt;/a&gt;: move SlowCompositeReaderWrapper to misc module, and throw clear exc if you try to use in with points&lt;/p&gt;

&lt;p&gt;Squashed commits:&lt;/p&gt;

&lt;p&gt;commit e26b065c71388407bc6725256ca43d7bb30dee29&lt;br/&gt;
Author: Mike McCandless &amp;lt;mikemccand@apache.org&amp;gt;&lt;br/&gt;
Date:   Thu Mar 10 14:16:45 2016 -0500&lt;/p&gt;

&lt;p&gt;    simplify the checking for incoming points&lt;/p&gt;

&lt;p&gt;commit b7254376dcb398c7739aab4544118bb4526961d5&lt;br/&gt;
Merge: 8ec82a0 d35d569&lt;br/&gt;
Author: Mike McCandless &amp;lt;mikemccand@apache.org&amp;gt;&lt;br/&gt;
Date:   Thu Mar 10 14:05:24 2016 -0500&lt;/p&gt;

&lt;p&gt;    Merge branch 'master' into slow_wrapper&lt;/p&gt;

&lt;p&gt;    Conflicts:&lt;br/&gt;
    	lucene/misc/src/test/org/apache/lucene/uninverting/TestFieldCache.java&lt;br/&gt;
    	lucene/misc/src/test/org/apache/lucene/uninverting/TestFieldCacheReopen.java&lt;/p&gt;

&lt;p&gt;commit 8ec82a0d9a0dd946d96da20962bb2ea95758edbe&lt;br/&gt;
Author: Mike McCandless &amp;lt;mikemccand@apache.org&amp;gt;&lt;br/&gt;
Date:   Thu Mar 10 13:56:25 2016 -0500&lt;/p&gt;

&lt;p&gt;    &lt;a href="https://issues.apache.org/jira/browse/LUCENE-7086" title="SlowCompositeReaderWrapper does not support point values" class="issue-link" data-issue-key="LUCENE-7086"&gt;&lt;del&gt;LUCENE-7086&lt;/del&gt;&lt;/a&gt;: move SlowCompositeReaderWrapper to misc module&lt;/p&gt;</comment>
                            <comment id="15190021" author="jira-bot" created="Thu, 10 Mar 2016 14:54:22 -0700">&lt;p&gt;Commit 7927a3101e1f446939bfa311968346ddd57c29f3 in lucene-solr's branch refs/heads/branch_6x from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=7927a31" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=7927a31&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7086" title="SlowCompositeReaderWrapper does not support point values" class="issue-link" data-issue-key="LUCENE-7086"&gt;&lt;del&gt;LUCENE-7086&lt;/del&gt;&lt;/a&gt;: move SlowCompositeReaderWrapper to misc module, and throw clear exc if you try to use in with points&lt;/p&gt;

&lt;p&gt;Squashed commits:&lt;/p&gt;

&lt;p&gt;commit e26b065c71388407bc6725256ca43d7bb30dee29&lt;br/&gt;
Author: Mike McCandless &amp;lt;mikemccand@apache.org&amp;gt;&lt;br/&gt;
Date:   Thu Mar 10 14:16:45 2016 -0500&lt;/p&gt;

&lt;p&gt;    simplify the checking for incoming points&lt;/p&gt;

&lt;p&gt;commit b7254376dcb398c7739aab4544118bb4526961d5&lt;br/&gt;
Merge: 8ec82a0 d35d569&lt;br/&gt;
Author: Mike McCandless &amp;lt;mikemccand@apache.org&amp;gt;&lt;br/&gt;
Date:   Thu Mar 10 14:05:24 2016 -0500&lt;/p&gt;

&lt;p&gt;    Merge branch 'master' into slow_wrapper&lt;/p&gt;

&lt;p&gt;    Conflicts:&lt;br/&gt;
    	lucene/misc/src/test/org/apache/lucene/uninverting/TestFieldCache.java&lt;br/&gt;
    	lucene/misc/src/test/org/apache/lucene/uninverting/TestFieldCacheReopen.java&lt;/p&gt;

&lt;p&gt;commit 8ec82a0d9a0dd946d96da20962bb2ea95758edbe&lt;br/&gt;
Author: Mike McCandless &amp;lt;mikemccand@apache.org&amp;gt;&lt;br/&gt;
Date:   Thu Mar 10 13:56:25 2016 -0500&lt;/p&gt;

&lt;p&gt;    &lt;a href="https://issues.apache.org/jira/browse/LUCENE-7086" title="SlowCompositeReaderWrapper does not support point values" class="issue-link" data-issue-key="LUCENE-7086"&gt;&lt;del&gt;LUCENE-7086&lt;/del&gt;&lt;/a&gt;: move SlowCompositeReaderWrapper to misc module&lt;/p&gt;</comment>
                            <comment id="15190045" author="thetaphi" created="Thu, 10 Mar 2016 15:07:08 -0700">&lt;p&gt;Thanks Mike! I think that is fine now. I hope this also reduces SlowWrapper usage in Solr once PointValues are used there.&lt;/p&gt;</comment>
                            <comment id="15190074" author="jira-bot" created="Thu, 10 Mar 2016 15:20:04 -0700">&lt;p&gt;Commit c34272da21023f1960d354539a0ec8232b7bfb6f in lucene-solr's branch refs/heads/branch_6_0 from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c34272d" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c34272d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7086" title="SlowCompositeReaderWrapper does not support point values" class="issue-link" data-issue-key="LUCENE-7086"&gt;&lt;del&gt;LUCENE-7086&lt;/del&gt;&lt;/a&gt;: move SlowCompositeReaderWrapper to misc module, and throw clear exc if you try to use in with points&lt;/p&gt;

&lt;p&gt;Squashed commits:&lt;/p&gt;

&lt;p&gt;commit e26b065c71388407bc6725256ca43d7bb30dee29&lt;br/&gt;
Author: Mike McCandless &amp;lt;mikemccand@apache.org&amp;gt;&lt;br/&gt;
Date:   Thu Mar 10 14:16:45 2016 -0500&lt;/p&gt;

&lt;p&gt;    simplify the checking for incoming points&lt;/p&gt;

&lt;p&gt;commit b7254376dcb398c7739aab4544118bb4526961d5&lt;br/&gt;
Merge: 8ec82a0 d35d569&lt;br/&gt;
Author: Mike McCandless &amp;lt;mikemccand@apache.org&amp;gt;&lt;br/&gt;
Date:   Thu Mar 10 14:05:24 2016 -0500&lt;/p&gt;

&lt;p&gt;    Merge branch 'master' into slow_wrapper&lt;/p&gt;

&lt;p&gt;    Conflicts:&lt;br/&gt;
    	lucene/misc/src/test/org/apache/lucene/uninverting/TestFieldCache.java&lt;br/&gt;
    	lucene/misc/src/test/org/apache/lucene/uninverting/TestFieldCacheReopen.java&lt;/p&gt;

&lt;p&gt;commit 8ec82a0d9a0dd946d96da20962bb2ea95758edbe&lt;br/&gt;
Author: Mike McCandless &amp;lt;mikemccand@apache.org&amp;gt;&lt;br/&gt;
Date:   Thu Mar 10 13:56:25 2016 -0500&lt;/p&gt;

&lt;p&gt;    &lt;a href="https://issues.apache.org/jira/browse/LUCENE-7086" title="SlowCompositeReaderWrapper does not support point values" class="issue-link" data-issue-key="LUCENE-7086"&gt;&lt;del&gt;LUCENE-7086&lt;/del&gt;&lt;/a&gt;: move SlowCompositeReaderWrapper to misc module&lt;/p&gt;</comment>
                            <comment id="15190075" author="jira-bot" created="Thu, 10 Mar 2016 15:20:06 -0700">&lt;p&gt;Commit c34272da21023f1960d354539a0ec8232b7bfb6f in lucene-solr's branch refs/heads/branch_6_0 from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c34272d" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c34272d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7086" title="SlowCompositeReaderWrapper does not support point values" class="issue-link" data-issue-key="LUCENE-7086"&gt;&lt;del&gt;LUCENE-7086&lt;/del&gt;&lt;/a&gt;: move SlowCompositeReaderWrapper to misc module, and throw clear exc if you try to use in with points&lt;/p&gt;

&lt;p&gt;Squashed commits:&lt;/p&gt;

&lt;p&gt;commit e26b065c71388407bc6725256ca43d7bb30dee29&lt;br/&gt;
Author: Mike McCandless &amp;lt;mikemccand@apache.org&amp;gt;&lt;br/&gt;
Date:   Thu Mar 10 14:16:45 2016 -0500&lt;/p&gt;

&lt;p&gt;    simplify the checking for incoming points&lt;/p&gt;

&lt;p&gt;commit b7254376dcb398c7739aab4544118bb4526961d5&lt;br/&gt;
Merge: 8ec82a0 d35d569&lt;br/&gt;
Author: Mike McCandless &amp;lt;mikemccand@apache.org&amp;gt;&lt;br/&gt;
Date:   Thu Mar 10 14:05:24 2016 -0500&lt;/p&gt;

&lt;p&gt;    Merge branch 'master' into slow_wrapper&lt;/p&gt;

&lt;p&gt;    Conflicts:&lt;br/&gt;
    	lucene/misc/src/test/org/apache/lucene/uninverting/TestFieldCache.java&lt;br/&gt;
    	lucene/misc/src/test/org/apache/lucene/uninverting/TestFieldCacheReopen.java&lt;/p&gt;

&lt;p&gt;commit 8ec82a0d9a0dd946d96da20962bb2ea95758edbe&lt;br/&gt;
Author: Mike McCandless &amp;lt;mikemccand@apache.org&amp;gt;&lt;br/&gt;
Date:   Thu Mar 10 13:56:25 2016 -0500&lt;/p&gt;

&lt;p&gt;    &lt;a href="https://issues.apache.org/jira/browse/LUCENE-7086" title="SlowCompositeReaderWrapper does not support point values" class="issue-link" data-issue-key="LUCENE-7086"&gt;&lt;del&gt;LUCENE-7086&lt;/del&gt;&lt;/a&gt;: move SlowCompositeReaderWrapper to misc module&lt;/p&gt;</comment>
                            <comment id="15212318" author="yseeley@gmail.com" created="Fri, 25 Mar 2016 12:56:18 -0700">&lt;p&gt;This patch is really unfriendly since it throws an exception if you have Point fields in your index, even if you don't use them through this wrapper!&lt;br/&gt;
Since pretty much every index will have Point fields from now on, this means that SlowCompositeReaderWrapper will pretty much never work alone.&lt;/p&gt;

&lt;p&gt;Seems like it would be nicer to throw an exception when asking for a merged Point field instead?&lt;/p&gt;</comment>
                            <comment id="15212616" author="mikemccand" created="Fri, 25 Mar 2016 16:51:00 -0700">&lt;blockquote&gt;&lt;p&gt;Seems like it would be nicer to throw an exception when asking for a merged Point field instead?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think doing it lazily is dangerous: you present an inconsistent reader to Lucene which claims to have point values (via its &lt;tt&gt;getFieldInfos&lt;/tt&gt;), but then throws an exception when you ask for them.  This was causing problems in my original patch ... it was discusses above.&lt;/p&gt;

&lt;p&gt;I think it's better to filter the incoming readers to hide any fields that have point values from the &lt;tt&gt;FieldInfos&lt;/tt&gt;?&lt;/p&gt;</comment>
                            <comment id="15212637" author="yseeley@gmail.com" created="Fri, 25 Mar 2016 17:02:25 -0700">&lt;p&gt;Even if the strategy is filtering out points, shouldn't that be done &lt;b&gt;in&lt;/b&gt; this class?&lt;br/&gt;
Otherwise this class becomes useless on it's own since indexes w/o point fields will be few and far between.  The Javadoc doesn't even warn that this class won't work if your index contains point fields. It's a trap waiting for later until one does add the first point field.&lt;/p&gt;</comment>
                            <comment id="15212897" author="mikemccand" created="Sat, 26 Mar 2016 02:04:09 -0700">&lt;blockquote&gt;&lt;p&gt;Even if the strategy is filtering out points, shouldn't that be done in this class?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I don't think so.&lt;/p&gt;

&lt;p&gt;I think filtering away points should be a very explicit choice on the part of the user, not something that's silently done by default: that kind of leniency only leads to problems, and was in fact the original reason for opening this issue.&lt;/p&gt;

&lt;p&gt;And exactly how the filtering should happen is not obvious / schema dependent: should any field that has points be completely removed?  Or should the field be kept when it has other things (doc values, postings), only suppressing that it has points?  When those points fields are removed, should other fields also be removed?&lt;/p&gt;

&lt;p&gt;A user who has indexed points yet also wants to use this slow class needs to work out how they want to hide their indexed points.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The Javadoc doesn't even warn that this class won't work if your index contains point fields.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1 to update the javadocs making this clearer.&lt;/p&gt;</comment>
                            <comment id="15245923" author="adelapena" created="Mon, 18 Apr 2016 09:15:52 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mikemccand" class="user-hover" rel="mikemccand"&gt;Michael McCandless&lt;/a&gt;, it seems that this makes &lt;tt&gt;SortingMergePolicy&lt;/tt&gt; (which uses &lt;tt&gt;SlowCompositeReaderWrapper&lt;/tt&gt;) incompatible with point fields, even if the &lt;tt&gt;Sort&lt;/tt&gt; used by the merge policy doesn't contain points. Should the users choose between point fields and index sorting? Is there any way to make both compatible? &lt;/p&gt;</comment>
                            <comment id="15255256" author="mikemccand" created="Sat, 23 Apr 2016 06:55:23 -0700">&lt;blockquote&gt;&lt;p&gt;it seems that this makes SortingMergePolicy (which uses SlowCompositeReaderWrapper) incompatible with point fields&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, unfortunately ... so currently you cannot do index-time sorting if you index points.  I agree that sucks and we need to fix it ... though I don't understand why index-time sorting needs to use the inefficient &lt;tt&gt;SlowCompositeReaderWrapper&lt;/tt&gt; ... it is the last place in Lucene that relies on it.&lt;/p&gt;</comment>
                            <comment id="15255284" author="adelapena" created="Sat, 23 Apr 2016 08:26:00 -0700">&lt;p&gt;Yes, it is a pity. In &lt;a href="https://github.com/Stratio/cassandra-lucene-index" class="external-link" rel="nofollow"&gt;our particular use case&lt;/a&gt;, we can't renounce to the huge performance improvements due to the usage of &lt;tt&gt;EarlyTerminatingSortingCollector&lt;/tt&gt;. Now that the numeric fields have disappeared, I guess that we don't have other option than using numeric doc values if we want to upgrade to Lucene 6.0.0. Should we open a new ticket for fixing this incompatibility within &lt;tt&gt;SortingMergePolicy&lt;/tt&gt; and point fields, or is it covered by any other ticket? We can't wait to use the amazing point fields!&lt;/p&gt;

&lt;p&gt;It would also be good to take a look to &lt;a href="http://permalink.gmane.org/gmane.comp.jakarta.lucene.user/60076" class="external-link" rel="nofollow"&gt;the problems paging over search results&lt;/a&gt; with &lt;tt&gt;EarlyTerminatingSortingCollector&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="15255368" author="mikemccand" created="Sat, 23 Apr 2016 13:00:28 -0700">&lt;p&gt;I think &lt;a href="https://issues.apache.org/jira/browse/LUCENE-6766" title="Make index sorting a first-class citizen" class="issue-link" data-issue-key="LUCENE-6766"&gt;LUCENE-6766&lt;/a&gt; is maybe the path forward here.&lt;/p&gt;</comment>
                            <comment id="15257820" author="adelapena" created="Tue, 26 Apr 2016 02:33:55 -0700">&lt;p&gt;Yes, it seems to be. I have also created &lt;a href="https://issues.apache.org/jira/browse/LUCENE-7255" class="external-link" rel="nofollow"&gt;LUCENE-7255&lt;/a&gt; for the problem with paging with &lt;tt&gt;EarlyTerminatingSortingCollector&lt;/tt&gt;. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12792560" name="LUCENE-7086.patch" size="218593" author="mikemccand" created="Thu, 10 Mar 2016 11:44:14 -0700"/>
                            <attachment id="12792529" name="LUCENE-7086.patch" size="137403" author="mikemccand" created="Thu, 10 Mar 2016 08:49:55 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 9 Mar 2016 16:09:20 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 week, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ue6n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7085] PointRangeQuery.equals does not work</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7085</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;Here is a simple unit test that fails:&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
  &lt;span class="code-keyword"&gt;public&lt;/span&gt; void testPointRangeEquals() {
    Query q1 = LongPoint.newRangeQuery(&lt;span class="code-quote"&gt;"a"&lt;/span&gt;, 0, 1000);
    Query q2 = LongPoint.newRangeQuery(&lt;span class="code-quote"&gt;"a"&lt;/span&gt;, 0, 1000);
    assertEquals(q1, q2);
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment/>
        <key id="12948356">LUCENE-7085</key>
            <summary>PointRangeQuery.equals does not work</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mikemccand">Michael McCandless</assignee>
                                    <reporter username="jpountz">Adrien Grand</reporter>
                        <labels>
                    </labels>
                <created>Wed, 9 Mar 2016 02:56:14 -0700</created>
                <updated>Wed, 9 Mar 2016 08:13:17 -0700</updated>
                            <resolved>Wed, 9 Mar 2016 08:13:15 -0700</resolved>
                                                    <fixVersion>master</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="15186898" author="mikemccand" created="Wed, 9 Mar 2016 03:08:10 -0700">&lt;p&gt;Yikes, I'll take it.&lt;/p&gt;</comment>
                            <comment id="15186950" author="mikemccand" created="Wed, 9 Mar 2016 04:03:21 -0700">&lt;p&gt;Patch.&lt;/p&gt;

&lt;p&gt;I also hit and fixed a separate bug in &lt;tt&gt;InetAddressPoint.newSetQuery&lt;/tt&gt; where it hit an exception if you tried to pass more than one &lt;tt&gt;InetAddress&lt;/tt&gt; in the set &lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/smile.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt;  Sheesh.&lt;/p&gt;</comment>
                            <comment id="15186953" author="jpountz" created="Wed, 9 Mar 2016 04:08:50 -0700">&lt;p&gt;s/comparsion/comparison/ but otherwise +1 to the patch&lt;/p&gt;</comment>
                            <comment id="15186967" author="rcmuir" created="Wed, 9 Mar 2016 04:27:04 -0700">&lt;p&gt;nice find!&lt;/p&gt;</comment>
                            <comment id="15187212" author="jira-bot" created="Wed, 9 Mar 2016 08:06:42 -0700">&lt;p&gt;Commit 770e508fd3d908e9bf7997361299af96aa437b75 in lucene-solr's branch refs/heads/master from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=770e508" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=770e508&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7085" title="PointRangeQuery.equals does not work" class="issue-link" data-issue-key="LUCENE-7085"&gt;&lt;del&gt;LUCENE-7085&lt;/del&gt;&lt;/a&gt;: PointRangeQuery.equals sometimes returns false even if queries were in fact equal&lt;/p&gt;</comment>
                            <comment id="15187218" author="jira-bot" created="Wed, 9 Mar 2016 08:10:24 -0700">&lt;p&gt;Commit 9f8fe1239afb7089b9f85432d076bdd778d3cd50 in lucene-solr's branch refs/heads/branch_6x from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9f8fe12" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9f8fe12&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7085" title="PointRangeQuery.equals does not work" class="issue-link" data-issue-key="LUCENE-7085"&gt;&lt;del&gt;LUCENE-7085&lt;/del&gt;&lt;/a&gt;: PointRangeQuery.equals sometimes returns false even if queries were in fact equal&lt;/p&gt;</comment>
                            <comment id="15187220" author="jira-bot" created="Wed, 9 Mar 2016 08:12:46 -0700">&lt;p&gt;Commit f0ed113bb6ebed008bc9aa5954e12de98d62c951 in lucene-solr's branch refs/heads/branch_6_0 from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f0ed113" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f0ed113&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7085" title="PointRangeQuery.equals does not work" class="issue-link" data-issue-key="LUCENE-7085"&gt;&lt;del&gt;LUCENE-7085&lt;/del&gt;&lt;/a&gt;: PointRangeQuery.equals sometimes returns false even if queries were in fact equal&lt;/p&gt;</comment>
                            <comment id="15187221" author="mikemccand" created="Wed, 9 Mar 2016 08:13:17 -0700">&lt;p&gt;What a nice catch, thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jpountz" class="user-hover" rel="jpountz"&gt;Adrien Grand&lt;/a&gt;!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12792230" name="LUCENE-7085.patch" size="15097" author="mikemccand" created="Wed, 9 Mar 2016 04:03:21 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 9 Mar 2016 10:08:10 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ue6f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7083] BKDReader exceptions at merge from innocuous? test</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7083</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;As part of &lt;a href="https://issues.apache.org/jira/browse/LUCENE-7075" title="Clean up LegacyNumericUtils usage." class="issue-link" data-issue-key="LUCENE-7075"&gt;LUCENE-7075&lt;/a&gt;, I tried to move join/ modules numeric join support away from deprecated encodings.&lt;/p&gt;

&lt;p&gt;Basically from what i see, its encoding Numeric/SortedNumeric in a byte[] as an impl detail, it might as well use the new 8-bit encoding rather than the 7-bit one.&lt;/p&gt;

&lt;p&gt;There are certain bugs in what i did, but i don't like the exceptions I see:&lt;/p&gt;
&lt;div class="preformatted panel" style="border-width: 1px;"&gt;&lt;div class="preformattedContent panelContent"&gt;
&lt;pre&gt;   [junit4] Suite: org.apache.lucene.search.join.TestJoinUtil
   [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=TestJoinUtil -Dtests.method=testRandomOrdinalsJoin -Dtests.seed=49BE0A860DCFFEDB -Dtests.slow=true -Dtests.locale=tr -Dtests.timezone=Asia/Urumqi -Dtests.asserts=true -Dtests.file.encoding=UTF-8
   [junit4] ERROR   1.16s J1 | TestJoinUtil.testRandomOrdinalsJoin &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: org.apache.lucene.store.AlreadyClosedException: refusing to delete any files: this IndexWriter hit an unrecoverable exception
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([49BE0A860DCFFEDB:F6630B1FDD33EBD7]:0)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.IndexFileDeleter.ensureOpen(IndexFileDeleter.java:345)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.IndexFileDeleter.deleteFiles(IndexFileDeleter.java:696)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.IndexFileDeleter.decRef(IndexFileDeleter.java:594)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.IndexFileDeleter.checkpoint(IndexFileDeleter.java:533)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.IndexWriter.checkpoint(IndexWriter.java:2337)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.IndexWriter.publishFlushedSegment(IndexWriter.java:2395)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.DocumentsWriterFlushQueue$FlushTicket.publishFlushedSegment(DocumentsWriterFlushQueue.java:198)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.DocumentsWriterFlushQueue$FlushTicket.finishFlush(DocumentsWriterFlushQueue.java:213)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.DocumentsWriterFlushQueue$SegmentFlushTicket.publish(DocumentsWriterFlushQueue.java:249)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.DocumentsWriterFlushQueue.innerPurge(DocumentsWriterFlushQueue.java:116)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.DocumentsWriterFlushQueue.forcePurge(DocumentsWriterFlushQueue.java:138)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.DocumentsWriter.flushAllThreads(DocumentsWriter.java:624)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.IndexWriter.prepareCommitInternal(IndexWriter.java:2815)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.IndexWriter.commitInternal(IndexWriter.java:2989)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.IndexWriter.commit(IndexWriter.java:2956)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.RandomIndexWriter.commit(RandomIndexWriter.java:288)
   [junit4]    &amp;gt; 	at org.apache.lucene.search.join.TestJoinUtil.createContext(TestJoinUtil.java:1121)
   [junit4]    &amp;gt; 	at org.apache.lucene.search.join.TestJoinUtil.testRandomOrdinalsJoin(TestJoinUtil.java:403)
   [junit4]    &amp;gt; 	at java.lang.Thread.run(Thread.java:745)
   [junit4]    &amp;gt; Caused by: java.lang.IllegalArgumentException: field="fromInteger" is unrecognized
   [junit4]    &amp;gt; 	at org.apache.lucene.codecs.lucene60.Lucene60PointsReader.getBKDReader(Lucene60PointsReader.java:120)
   [junit4]    &amp;gt; 	at org.apache.lucene.codecs.lucene60.Lucene60PointsReader.getNumDimensions(Lucene60PointsReader.java:199)
   [junit4]    &amp;gt; 	at org.apache.lucene.codecs.asserting.AssertingPointsFormat$AssertingPointsReader.intersect(AssertingPointsFormat.java:169)
   [junit4]    &amp;gt; 	at org.apache.lucene.codecs.PointsWriter$1.intersect(PointsWriter.java:59)
   [junit4]    &amp;gt; 	at org.apache.lucene.codecs.lucene60.Lucene60PointsWriter.writeField(Lucene60PointsWriter.java:93)
   [junit4]    &amp;gt; 	at org.apache.lucene.codecs.PointsWriter.mergeOneField(PointsWriter.java:44)
   [junit4]    &amp;gt; 	at org.apache.lucene.codecs.PointsWriter.merge(PointsWriter.java:143)
   [junit4]    &amp;gt; 	at org.apache.lucene.codecs.lucene60.Lucene60PointsWriter.merge(Lucene60PointsWriter.java:121)
   [junit4]    &amp;gt; 	at org.apache.lucene.codecs.asserting.AssertingPointsFormat$AssertingPointsWriter.merge(AssertingPointsFormat.java:262)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.SegmentMerger.mergePoints(SegmentMerger.java:168)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.SegmentMerger.merge(SegmentMerger.java:117)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.IndexWriter.mergeMiddle(IndexWriter.java:4099)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.IndexWriter.merge(IndexWriter.java:3679)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.ConcurrentMergeScheduler.doMerge(ConcurrentMergeScheduler.java:588)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.ConcurrentMergeScheduler$MergeThread.run(ConcurrentMergeScheduler.java:626)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;What is happening here? Is the exception correct or are we missing a check?&lt;/p&gt;</description>
                <environment/>
        <key id="12948073">LUCENE-7083</key>
            <summary>BKDReader exceptions at merge from innocuous? test</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rcmuir">Robert Muir</reporter>
                        <labels>
                    </labels>
                <created>Tue, 8 Mar 2016 09:56:16 -0700</created>
                <updated>Tue, 8 Mar 2016 12:33:23 -0700</updated>
                            <resolved>Tue, 8 Mar 2016 12:31:49 -0700</resolved>
                                                    <fixVersion>master</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="15185231" author="rcmuir" created="Tue, 8 Mar 2016 09:57:12 -0700">&lt;p&gt;attached is my broken patch. if you apply it and run:&lt;/p&gt;

&lt;p&gt;   ant test -Dtests.slow=true&lt;/p&gt;

&lt;p&gt;from the join/ module you should see it.&lt;/p&gt;</comment>
                            <comment id="15185430" author="mikemccand" created="Tue, 8 Mar 2016 11:26:56 -0700">&lt;p&gt;OK I found the cause here, and I have a small test that shows itl.&lt;/p&gt;

&lt;p&gt;The bug is in the default merge logic in &lt;tt&gt;PointsWriter&lt;/tt&gt; not properly detecting when a points field was never indexed on a given segment.  I'll push the test and fix shortly ... I'll also add a dedicated "test sparse points fields" test soon.&lt;/p&gt;</comment>
                            <comment id="15185432" author="jira-bot" created="Tue, 8 Mar 2016 11:27:47 -0700">&lt;p&gt;Commit 2cac33a5ce7b64713eba6e22d5f7c9122ab8eafe in lucene-solr's branch refs/heads/master from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=2cac33a" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=2cac33a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7083" title="BKDReader exceptions at merge from innocuous? test" class="issue-link" data-issue-key="LUCENE-7083"&gt;&lt;del&gt;LUCENE-7083&lt;/del&gt;&lt;/a&gt;: default points merge logic should not ask a reader to merge points on a field that doesn't exist in that segment&lt;/p&gt;</comment>
                            <comment id="15185440" author="jira-bot" created="Tue, 8 Mar 2016 11:30:23 -0700">&lt;p&gt;Commit 0ab23fd1f5e38cdd4fe742f70f66d97e666b9e80 in lucene-solr's branch refs/heads/branch_6x from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=0ab23fd" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=0ab23fd&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7083" title="BKDReader exceptions at merge from innocuous? test" class="issue-link" data-issue-key="LUCENE-7083"&gt;&lt;del&gt;LUCENE-7083&lt;/del&gt;&lt;/a&gt;: default points merge logic should not ask a reader to merge points on a field that doesn't exist in that segment&lt;/p&gt;</comment>
                            <comment id="15185447" author="jira-bot" created="Tue, 8 Mar 2016 11:32:50 -0700">&lt;p&gt;Commit 204f8e992d7ad754c2f28c6407fdad57623baf57 in lucene-solr's branch refs/heads/branch_6_0 from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=204f8e9" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=204f8e9&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7083" title="BKDReader exceptions at merge from innocuous? test" class="issue-link" data-issue-key="LUCENE-7083"&gt;&lt;del&gt;LUCENE-7083&lt;/del&gt;&lt;/a&gt;: default points merge logic should not ask a reader to merge points on a field that doesn't exist in that segment&lt;/p&gt;</comment>
                            <comment id="15185593" author="rcmuir" created="Tue, 8 Mar 2016 12:33:23 -0700">&lt;p&gt;Thanks for digging Mike!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12792033" name="broken.patch.txt" size="9190" author="rcmuir" created="Tue, 8 Mar 2016 09:57:12 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 8 Mar 2016 18:26:56 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ucfj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7081] Docvalues terms dict should sometimes prefix-compress fixed-length data.</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7081</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;For Sorted/SortedSet types, we encode ordinals and a term dictionary (similar to old lucene 3 term dictionary).&lt;/p&gt;

&lt;p&gt;Originally we had no prefix compression, so we "save space" in the fixed-width case by avoiding addressing, we can just use multiplication: &lt;a href="https://github.com/apache/lucene-solr/blob/master/lucene/core/src/java/org/apache/lucene/codecs/lucene54/Lucene54DocValuesConsumer.java#L423-L425" class="external-link" rel="nofollow"&gt;https://github.com/apache/lucene-solr/blob/master/lucene/core/src/java/org/apache/lucene/codecs/lucene54/Lucene54DocValuesConsumer.java#L423-L425&lt;/a&gt; &lt;/p&gt;

&lt;p&gt;But it means no compression whatsoever of the actual bytes, even if values are enormous, I don't think its necessarily a good tradeoff. The lack of prefix compression can become much more magnified now that we have fixed width 128-bit point types in the sandbox...&lt;/p&gt;</description>
                <environment/>
        <key id="12948051">LUCENE-7081</key>
            <summary>Docvalues terms dict should sometimes prefix-compress fixed-length data.</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rcmuir">Robert Muir</reporter>
                        <labels>
                    </labels>
                <created>Tue, 8 Mar 2016 08:43:34 -0700</created>
                <updated>Thu, 10 Mar 2016 07:36:32 -0700</updated>
                            <resolved>Thu, 10 Mar 2016 06:02:25 -0700</resolved>
                                                    <fixVersion>master</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="15187056" author="rcmuir" created="Wed, 9 Mar 2016 05:59:55 -0700">&lt;p&gt;initial patch after lots of experiments.&lt;/p&gt;

&lt;p&gt;we can easily just compute how well we compress, by computing shared prefix for the first term (count % 16 == 0) and last term (count % 16 == 15) in each block. Thats because our terms dict here uses a single shared prefix for all terms in a block: e.g. terms are delta encoded against the first term in the block always.&lt;/p&gt;

&lt;p&gt;we use prefix compression when we share at least 3 bytes per term on average: thats because prefix encoding has some overhead vs the alternative for fixed-width data (worst case 2 bytes per term for suffix lengths).&lt;/p&gt;</comment>
                            <comment id="15187199" author="mikemccand" created="Wed, 9 Mar 2016 07:58:02 -0700">&lt;p&gt;+1, nice!&lt;/p&gt;</comment>
                            <comment id="15188802" author="jpountz" created="Wed, 9 Mar 2016 23:55:34 -0700">&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="15189214" author="jira-bot" created="Thu, 10 Mar 2016 05:26:41 -0700">&lt;p&gt;Commit 162636bf05b5b6b35a79bacd2e7440830b05960f in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=162636b" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=162636b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7081" title="Docvalues terms dict should sometimes prefix-compress fixed-length data." class="issue-link" data-issue-key="LUCENE-7081"&gt;&lt;del&gt;LUCENE-7081&lt;/del&gt;&lt;/a&gt;: prefix-compress compressible fixed-width data (like InetAddress/BigInteger)&lt;/p&gt;</comment>
                            <comment id="15189230" author="jira-bot" created="Thu, 10 Mar 2016 05:44:55 -0700">&lt;p&gt;Commit 7b03e6e02a92878c540ec754fa504dd75fc631a9 in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=7b03e6e" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=7b03e6e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7081" title="Docvalues terms dict should sometimes prefix-compress fixed-length data." class="issue-link" data-issue-key="LUCENE-7081"&gt;&lt;del&gt;LUCENE-7081&lt;/del&gt;&lt;/a&gt;: prefix-compress compressible fixed-width data (like InetAddress/BigInteger)&lt;/p&gt;</comment>
                            <comment id="15189249" author="jira-bot" created="Thu, 10 Mar 2016 06:02:10 -0700">&lt;p&gt;Commit 10871cfb31464947e95042a91ab9400faa1f9a81 in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=10871cf" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=10871cf&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7081" title="Docvalues terms dict should sometimes prefix-compress fixed-length data." class="issue-link" data-issue-key="LUCENE-7081"&gt;&lt;del&gt;LUCENE-7081&lt;/del&gt;&lt;/a&gt;: prefix-compress compressible fixed-width data (like InetAddress/BigInteger)&lt;/p&gt;</comment>
                            <comment id="15189356" author="dsmiley" created="Thu, 10 Mar 2016 07:30:08 -0700">&lt;p&gt;Nice!  You forgot a CHANGES.txt, Rob.&lt;/p&gt;</comment>
                            <comment id="15189369" author="rcmuir" created="Thu, 10 Mar 2016 07:36:32 -0700">&lt;p&gt;Yes, I plan to fold it into some kind of cohesive "Summary" of Point Values. See &lt;a href="https://issues.apache.org/jira/browse/LUCENE-7076" title="MIGRATE/CHANGES.txt need improved Points verbage" class="issue-link" data-issue-key="LUCENE-7076"&gt;LUCENE-7076&lt;/a&gt; for some notes.&lt;/p&gt;

&lt;p&gt;In this case for example:&lt;br/&gt;
  Adds InetAddress type supporting both IPv4 and IPv6. Both Point and DocValues storage apply prefix-compression so it does not provide 4x overhead (blah blah blah). &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12792245" name="LUCENE-7081.patch" size="2414" author="rcmuir" created="Wed, 9 Mar 2016 05:59:55 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 9 Mar 2016 14:58:02 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ucan:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7080] MockDirectoryWrapper relies on HashSet iteration order</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7080</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;MDW relies on HashSet iteration order in &lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
  &lt;span class="code-keyword"&gt;public&lt;/span&gt; &lt;span class="code-keyword"&gt;synchronized&lt;/span&gt; void corruptFiles(Collection&amp;lt;&lt;span class="code-object"&gt;String&lt;/span&gt;&amp;gt; files) &lt;span class="code-keyword"&gt;throws&lt;/span&gt; IOException {
    &lt;span class="code-comment"&gt;// Must make a copy because we change the incoming unsyncedFiles
&lt;/span&gt;    &lt;span class="code-comment"&gt;// when we create temp files, delete, etc., below:
&lt;/span&gt;    &lt;span class="code-keyword"&gt;for&lt;/span&gt;(&lt;span class="code-object"&gt;String&lt;/span&gt; name : &lt;span class="code-keyword"&gt;new&lt;/span&gt; ArrayList&amp;lt;&amp;gt;(files)) { &lt;span class="code-comment"&gt;// &amp;lt;&amp;lt;&amp;lt;&amp;lt;&amp;lt; &lt;span class="code-keyword"&gt;this&lt;/span&gt; should be sorted
&lt;/span&gt;      &lt;span class="code-object"&gt;int&lt;/span&gt; damage = randomState.nextInt(6);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;this causes reproducibility issues when files get corrupted.&lt;/p&gt;</description>
                <environment/>
        <key id="12948027">LUCENE-7080</key>
            <summary>MockDirectoryWrapper relies on HashSet iteration order</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="simonw">Simon Willnauer</assignee>
                                    <reporter username="simonw">Simon Willnauer</reporter>
                        <labels>
                    </labels>
                <created>Tue, 8 Mar 2016 07:45:07 -0700</created>
                <updated>Wed, 9 Mar 2016 09:00:21 -0700</updated>
                            <resolved>Wed, 9 Mar 2016 03:08:00 -0700</resolved>
                                    <version>5.5</version>
                    <version>6.0</version>
                                    <fixVersion>master</fixVersion>
                    <fixVersion>6.0</fixVersion>
                    <fixVersion>6.1</fixVersion>
                    <fixVersion>6.x</fixVersion>
                                    <component>general/test</component>
                        <due/>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="15185773" author="mariusneo" created="Tue, 8 Mar 2016 13:56:05 -0700">&lt;p&gt;Even if the files collection is iterated in a sorted manner, this will not ensure that calling &lt;tt&gt;corruptFiles(Collection&amp;lt;String&amp;gt;)&lt;/tt&gt; method twice, will issue the same results, because of &lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
&lt;span class="code-object"&gt;int&lt;/span&gt; damage = randomState.nextInt(6);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15186829" author="simonw" created="Wed, 9 Mar 2016 02:25:57 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mariusneo" class="user-hover" rel="mariusneo"&gt;Marius Grama&lt;/a&gt;, the lucene test framework uses randomized runner which takes care of the reproducibility of our PRNG. The framework / test uses a random seed to initialize the PRNG and that allows use to draw random number like this in a reproducible fashion. The problem here is that different JDKs can have different hashing schemes for the hash set and that causes different iteration order which in-turn breaks the reproducibility.&lt;/p&gt;</comment>
                            <comment id="15186830" author="simonw" created="Wed, 9 Mar 2016 02:26:48 -0700">&lt;p&gt;here is a patch&lt;/p&gt;</comment>
                            <comment id="15186868" author="mikemccand" created="Wed, 9 Mar 2016 02:50:58 -0700">&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;This was causing hilarious ES test failures, like:&lt;/p&gt;

&lt;div class="preformatted panel" style="border-width: 1px;"&gt;&lt;div class="preformattedContent panelContent"&gt;
&lt;pre&gt;java.lang.IllegalArgumentException: An SPI class of type org.apache.lucene.codecs.Codec with name 'Asseruing' does not exist.  You need to add the corresponding JAR file supporting this SPI to your classpath.  The current classpath supports the following names: [Lucene60, Lucene50, Lucene53, Lucene54, Asserting, CheapBastard, FastCompressingStoredFields, FastDecompressionCompressingStoredFields, HighCompressionCompressingStoredFields, DummyCompressingStoredFields, SimpleText]
	at __randomizedtesting.SeedInfo.seed([F5C8F2C1D5BDBA14:48F62EB91B77A0CA]:0)
	at org.apache.lucene.util.NamedSPILoader.lookup(NamedSPILoader.java:116)
	at org.apache.lucene.codecs.Codec.forName(Codec.java:116)
	at org.apache.lucene.index.SegmentInfos.readCodec(SegmentInfos.java:417)
	at org.apache.lucene.index.SegmentInfos.readCommit(SegmentInfos.java:349)
	at org.apache.lucene.index.SegmentInfos.readCommit(SegmentInfos.java:284)
	at org.apache.lucene.index.CheckIndex.checkIndex(CheckIndex.java:507)
	at org.apache.lucene.util.TestUtil.checkIndex(TestUtil.java:300)
	at org.apache.lucene.store.MockDirectoryWrapper.close(MockDirectoryWrapper.java:848)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Another time it failed with &lt;tt&gt;AsserTing&lt;/tt&gt;, then &lt;tt&gt;Assertkng&lt;/tt&gt; &lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/wink.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt;&lt;/p&gt;</comment>
                            <comment id="15186885" author="jira-bot" created="Wed, 9 Mar 2016 03:01:20 -0700">&lt;p&gt;Commit 588aeeaab731f34af9063ec0dedb714f8740e0b2 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=simonw" class="user-hover" rel="simonw"&gt;Simon Willnauer&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=588aeea" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=588aeea&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7080" title="MockDirectoryWrapper relies on HashSet iteration order" class="issue-link" data-issue-key="LUCENE-7080"&gt;&lt;del&gt;LUCENE-7080&lt;/del&gt;&lt;/a&gt;: Sort files to corrupt to prevent HashSet iteration order issues across JVMs&lt;/p&gt;</comment>
                            <comment id="15186896" author="jira-bot" created="Wed, 9 Mar 2016 03:06:53 -0700">&lt;p&gt;Commit 6aa9aa66e334b8c415fa6d9976bbef581ea352c9 in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=simonw" class="user-hover" rel="simonw"&gt;Simon Willnauer&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=6aa9aa6" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=6aa9aa6&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7080" title="MockDirectoryWrapper relies on HashSet iteration order" class="issue-link" data-issue-key="LUCENE-7080"&gt;&lt;del&gt;LUCENE-7080&lt;/del&gt;&lt;/a&gt;: Sort files to corrupt to prevent HashSet iteration order issues across JVMs&lt;/p&gt;</comment>
                            <comment id="15186897" author="jira-bot" created="Wed, 9 Mar 2016 03:06:53 -0700">&lt;p&gt;Commit b4eb4fb32cb819199a2fb564750393be439be66e in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=simonw" class="user-hover" rel="simonw"&gt;Simon Willnauer&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b4eb4fb" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b4eb4fb&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7080" title="MockDirectoryWrapper relies on HashSet iteration order" class="issue-link" data-issue-key="LUCENE-7080"&gt;&lt;del&gt;LUCENE-7080&lt;/del&gt;&lt;/a&gt;: Sort files to corrupt to prevent HashSet iteration order issues across JVMs&lt;/p&gt;</comment>
                            <comment id="15187300" author="jira-bot" created="Wed, 9 Mar 2016 09:00:21 -0700">&lt;p&gt;Commit 588aeeaab731f34af9063ec0dedb714f8740e0b2 in lucene-solr's branch refs/heads/apiv2 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=simonw" class="user-hover" rel="simonw"&gt;Simon Willnauer&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=588aeea" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=588aeea&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7080" title="MockDirectoryWrapper relies on HashSet iteration order" class="issue-link" data-issue-key="LUCENE-7080"&gt;&lt;del&gt;LUCENE-7080&lt;/del&gt;&lt;/a&gt;: Sort files to corrupt to prevent HashSet iteration order issues across JVMs&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12792215" name="LUCENE-7080.patch" size="1469" author="simonw" created="Wed, 9 Mar 2016 02:26:48 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 8 Mar 2016 20:56:05 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2uc5b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7079] add newSetQuery(String, Collection) to primitive point types</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7079</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;Currently IntPoint has newSetQuery(String, int...).&lt;/p&gt;

&lt;p&gt;This is uncomfortable when you have a boxed collection (e.g. List&amp;lt;Integer&amp;gt;). I think we should add sugar to int/float/double/long for this? &lt;/p&gt;</description>
                <environment/>
        <key id="12948005">LUCENE-7079</key>
            <summary>add newSetQuery(String, Collection) to primitive point types</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rcmuir">Robert Muir</reporter>
                        <labels>
                    </labels>
                <created>Tue, 8 Mar 2016 06:43:57 -0700</created>
                <updated>Wed, 9 Mar 2016 10:15:49 -0700</updated>
                            <resolved>Wed, 9 Mar 2016 10:15:49 -0700</resolved>
                                                    <fixVersion>master</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="15184923" author="rcmuir" created="Tue, 8 Mar 2016 06:45:18 -0700">&lt;p&gt;I noticed this when converting TestBlockJoin, see the TODO in the diff:&lt;/p&gt;

&lt;p&gt;&lt;a href="https://git1-us-west.apache.org/repos/asf?p=lucene-solr.git;a=commitdiff;h=4cc9ad44" class="external-link" rel="nofollow"&gt;https://git1-us-west.apache.org/repos/asf?p=lucene-solr.git;a=commitdiff;h=4cc9ad44&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15185598" author="mikemccand" created="Tue, 8 Mar 2016 12:35:26 -0700">&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="15186060" author="rcmuir" created="Tue, 8 Mar 2016 16:28:45 -0700">&lt;p&gt;Simple patch... no magic, we just add the sugar+test for the primitive types.&lt;/p&gt;</comment>
                            <comment id="15186064" author="mikemccand" created="Tue, 8 Mar 2016 16:30:53 -0700">&lt;p&gt;+1, thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="15187347" author="jira-bot" created="Wed, 9 Mar 2016 09:26:08 -0700">&lt;p&gt;Commit 58623e00ccd5ff4a6b97ad9c518fd597d9abdfda in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=58623e0" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=58623e0&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7079" title="add newSetQuery(String, Collection) to primitive point types" class="issue-link" data-issue-key="LUCENE-7079"&gt;&lt;del&gt;LUCENE-7079&lt;/del&gt;&lt;/a&gt;: add newSetQuery(String, Collection) to primitive Point types&lt;/p&gt;</comment>
                            <comment id="15187379" author="jira-bot" created="Wed, 9 Mar 2016 09:49:44 -0700">&lt;p&gt;Commit 42361a68bc27266d8f50e90b85ffd980ac953f36 in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=42361a6" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=42361a6&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7079" title="add newSetQuery(String, Collection) to primitive point types" class="issue-link" data-issue-key="LUCENE-7079"&gt;&lt;del&gt;LUCENE-7079&lt;/del&gt;&lt;/a&gt;: add newSetQuery(String, Collection) to primitive Point types&lt;/p&gt;</comment>
                            <comment id="15187418" author="jira-bot" created="Wed, 9 Mar 2016 10:07:46 -0700">&lt;p&gt;Commit b2eb1bd7992ab01c87dcb69600b9a36e73a6e009 in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b2eb1bd" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b2eb1bd&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7079" title="add newSetQuery(String, Collection) to primitive point types" class="issue-link" data-issue-key="LUCENE-7079"&gt;&lt;del&gt;LUCENE-7079&lt;/del&gt;&lt;/a&gt;: add newSetQuery(String, Collection) to primitive Point types&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12792122" name="LUCENE-7079.patch" size="5805" author="rcmuir" created="Tue, 8 Mar 2016 16:28:45 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 8 Mar 2016 19:35:26 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2uc0f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7073] FieldType problems with Points</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7073</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;The "copy constructor" is buggy and ignores the incoming points properties, because of a bug:&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
  &lt;span class="code-keyword"&gt;public&lt;/span&gt; FieldType(FieldType ref) {
    ...
    &lt;span class="code-comment"&gt;// these two assignments have no effect. 
&lt;/span&gt;    &lt;span class="code-keyword"&gt;this&lt;/span&gt;.dimensionCount = dimensionCount;
    &lt;span class="code-keyword"&gt;this&lt;/span&gt;.dimensionNumBytes = dimensionNumBytes;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Another issue is that tokenized() returns true for all these point fields, which is bogus, and it confuses things like transitioning to points in some benchmark code (trying to clean up places still using LegacyNumeric* !!!). This code checks if (tokenized()) &lt;/p&gt;
{ try to use tokenstream }
</description>
                <environment/>
        <key id="12947722">LUCENE-7073</key>
            <summary>FieldType problems with Points</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rcmuir">Robert Muir</reporter>
                        <labels>
                    </labels>
                <created>Mon, 7 Mar 2016 09:49:36 -0700</created>
                <updated>Mon, 7 Mar 2016 18:37:06 -0700</updated>
                            <resolved>Mon, 7 Mar 2016 18:37:06 -0700</resolved>
                                                    <fixVersion>master</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="15183260" author="rcmuir" created="Mon, 7 Mar 2016 09:55:31 -0700">&lt;p&gt;There is a test for this copy constructor stuff, but it relies on hashcode/equals working, which is also broken.&lt;/p&gt;

&lt;p&gt;It also has bugs in its reflection.&lt;/p&gt;</comment>
                            <comment id="15183287" author="rcmuir" created="Mon, 7 Mar 2016 10:14:31 -0700">&lt;p&gt;I will defer the tokenized issue, it impacts all fieldtypes. And its easy enough for code to do indexed &amp;amp;&amp;amp; tokenized to work around it.&lt;/p&gt;

&lt;p&gt;But the ctor, hashcode, equals, and the test need to be fixed, I will make a patch.&lt;/p&gt;</comment>
                            <comment id="15183292" author="rcmuir" created="Mon, 7 Mar 2016 10:18:28 -0700">&lt;p&gt;Here is a patch fixing the test, ctor, hashcode, and equals.&lt;/p&gt;</comment>
                            <comment id="15183307" author="rcmuir" created="Mon, 7 Mar 2016 10:27:12 -0700">&lt;p&gt;Here is an improvement that makes the test a little less lenient, it adds missing bounds checks (and fixes error messages) for FieldType.setDimensions().&lt;/p&gt;</comment>
                            <comment id="15183348" author="thetaphi" created="Mon, 7 Mar 2016 10:50:04 -0700">&lt;p&gt;To prevent things like the typo in method names, i would look up the method before the loop from the class. And inside the loop check for method equality. By that you make sure that the method really exists.&lt;/p&gt;

&lt;p&gt;In addition, assert that the method was called at least once!&lt;/p&gt;</comment>
                            <comment id="15183371" author="mikemccand" created="Mon, 7 Mar 2016 11:09:50 -0700">&lt;p&gt;+1, horrible, thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;!  We need this fixed for 6.0 ...&lt;/p&gt;</comment>
                            <comment id="15183520" author="rcmuir" created="Mon, 7 Mar 2016 12:27:46 -0700">&lt;p&gt;Thanks Uwe, that makes the test much better.&lt;/p&gt;

&lt;p&gt;I also did a doc fixes / removed more refs to LegacyNumeric*&lt;/p&gt;</comment>
                            <comment id="15183544" author="mikemccand" created="Mon, 7 Mar 2016 12:40:48 -0700">&lt;p&gt;+1 thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15183723" author="jira-bot" created="Mon, 7 Mar 2016 14:13:15 -0700">&lt;p&gt;Commit 4df4cb07ac6bfe1a652bb784cb1a7f58e415701e in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=4df4cb0" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=4df4cb0&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7073" title="FieldType problems with Points" class="issue-link" data-issue-key="LUCENE-7073"&gt;&lt;del&gt;LUCENE-7073&lt;/del&gt;&lt;/a&gt;: fix FieldType issues with Points&lt;/p&gt;</comment>
                            <comment id="15184116" author="jira-bot" created="Mon, 7 Mar 2016 17:59:27 -0700">&lt;p&gt;Commit d7ee7c661529b2a8c81c3cc52d581b4a5f19b5b8 in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d7ee7c6" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d7ee7c6&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7073" title="FieldType problems with Points" class="issue-link" data-issue-key="LUCENE-7073"&gt;&lt;del&gt;LUCENE-7073&lt;/del&gt;&lt;/a&gt;: fix FieldType issues with Points&lt;/p&gt;</comment>
                            <comment id="15184184" author="jira-bot" created="Mon, 7 Mar 2016 18:36:45 -0700">&lt;p&gt;Commit 3bb2b25d5fa37768f191043dfe2cd82248c46a4a in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3bb2b25" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3bb2b25&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7073" title="FieldType problems with Points" class="issue-link" data-issue-key="LUCENE-7073"&gt;&lt;del&gt;LUCENE-7073&lt;/del&gt;&lt;/a&gt;: fix FieldType issues with Points&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12791806" name="LUCENE-7073.patch" size="15864" author="rcmuir" created="Mon, 7 Mar 2016 12:27:46 -0700"/>
                            <attachment id="12791785" name="LUCENE-7073.patch" size="11436" author="rcmuir" created="Mon, 7 Mar 2016 10:27:12 -0700"/>
                            <attachment id="12791782" name="LUCENE-7073.patch" size="8801" author="rcmuir" created="Mon, 7 Mar 2016 10:18:28 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 7 Mar 2016 17:50:04 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ua9j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7072] Geo3dPointField should always use WGS84 planet model</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7072</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;Right now it takes any &lt;tt&gt;PlanetModel&lt;/tt&gt;, but I think that's dangerous.&lt;/p&gt;

&lt;p&gt;First, WGS84 is the most accurate one we have, and second, the planet model is secretly baked into the index via the "planetMax" normalization. I think for Lucene we should only expose WGS84 ...&lt;/p&gt;</description>
                <environment/>
        <key id="12947579">LUCENE-7072</key>
            <summary>Geo3dPointField should always use WGS84 planet model</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mikemccand">Michael McCandless</assignee>
                                    <reporter username="mikemccand">Michael McCandless</reporter>
                        <labels>
                    </labels>
                <created>Sun, 6 Mar 2016 15:51:47 -0700</created>
                <updated>Mon, 7 Mar 2016 03:24:13 -0700</updated>
                            <resolved>Mon, 7 Mar 2016 03:24:13 -0700</resolved>
                                                    <fixVersion>master</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="15182382" author="mikemccand" created="Sun, 6 Mar 2016 15:52:12 -0700">&lt;p&gt;Patch.&lt;/p&gt;</comment>
                            <comment id="15182388" author="rcmuir" created="Sun, 6 Mar 2016 16:08:03 -0700">&lt;p&gt;+1, this is a great simplification to the api!&lt;/p&gt;</comment>
                            <comment id="15182847" author="jira-bot" created="Mon, 7 Mar 2016 03:22:26 -0700">&lt;p&gt;Commit b79067a45687e7e41e7db9980643c00c889c2adc in lucene-solr's branch refs/heads/master from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b79067a" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b79067a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7072" title="Geo3dPointField should always use WGS84 planet model" class="issue-link" data-issue-key="LUCENE-7072"&gt;&lt;del&gt;LUCENE-7072&lt;/del&gt;&lt;/a&gt;: always use WGS84 planet model in Geo3DPoint&lt;/p&gt;</comment>
                            <comment id="15182849" author="jira-bot" created="Mon, 7 Mar 2016 03:23:13 -0700">&lt;p&gt;Commit 267e326dbf137de5357e0aca7418f648752cb22a in lucene-solr's branch refs/heads/branch_6x from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=267e326" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=267e326&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7072" title="Geo3dPointField should always use WGS84 planet model" class="issue-link" data-issue-key="LUCENE-7072"&gt;&lt;del&gt;LUCENE-7072&lt;/del&gt;&lt;/a&gt;: always use WGS84 planet model in Geo3DPoint&lt;/p&gt;</comment>
                            <comment id="15182851" author="jira-bot" created="Mon, 7 Mar 2016 03:23:55 -0700">&lt;p&gt;Commit ac8523d6886cd5c3cdc280b898542e53e4d2f0a9 in lucene-solr's branch refs/heads/branch_6_0 from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ac8523d" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ac8523d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7072" title="Geo3dPointField should always use WGS84 planet model" class="issue-link" data-issue-key="LUCENE-7072"&gt;&lt;del&gt;LUCENE-7072&lt;/del&gt;&lt;/a&gt;: always use WGS84 planet model in Geo3DPoint&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12791687" name="LUCENE-7072.patch" size="13763" author="mikemccand" created="Sun, 6 Mar 2016 15:52:12 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 6 Mar 2016 23:08:03 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2u9dz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7070] Rename PointFormat -&gt; PointsFormat, and PointReader/Writer too</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7070</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;We are missing an 's' in these classes: all other formats are plural.  I'd like to fix for 6.0 ... it touches many files but it's a trivial change.&lt;/p&gt;</description>
                <environment/>
        <key id="12947513">LUCENE-7070</key>
            <summary>Rename PointFormat -&gt; PointsFormat, and PointReader/Writer too</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mikemccand">Michael McCandless</assignee>
                                    <reporter username="mikemccand">Michael McCandless</reporter>
                        <labels>
                    </labels>
                <created>Sun, 6 Mar 2016 05:23:53 -0700</created>
                <updated>Sun, 6 Mar 2016 06:55:18 -0700</updated>
                            <resolved>Sun, 6 Mar 2016 06:55:18 -0700</resolved>
                                                    <fixVersion>master</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="15182151" author="mikemccand" created="Sun, 6 Mar 2016 06:13:55 -0700">&lt;p&gt;Simple, if large, patch.  This is also an index format change for 6.0.&lt;/p&gt;</comment>
                            <comment id="15182157" author="jira-bot" created="Sun, 6 Mar 2016 06:26:54 -0700">&lt;p&gt;Commit 74e7e1509a3d1ab4827f8b1388ae282b0e340089 in lucene-solr's branch refs/heads/master from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=74e7e15" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=74e7e15&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7070" title="Rename PointFormat -&amp;gt; PointsFormat, and PointReader/Writer too" class="issue-link" data-issue-key="LUCENE-7070"&gt;&lt;del&gt;LUCENE-7070&lt;/del&gt;&lt;/a&gt;: insert missing 's' in PointFormat/Reader/Writer&lt;/p&gt;</comment>
                            <comment id="15182163" author="jira-bot" created="Sun, 6 Mar 2016 06:42:08 -0700">&lt;p&gt;Commit e2ebbdf638984f76bfb6432bc554368609461955 in lucene-solr's branch refs/heads/branch_6x from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e2ebbdf" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e2ebbdf&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7070" title="Rename PointFormat -&amp;gt; PointsFormat, and PointReader/Writer too" class="issue-link" data-issue-key="LUCENE-7070"&gt;&lt;del&gt;LUCENE-7070&lt;/del&gt;&lt;/a&gt;: insert missing 's' in PointFormat/Reader/Writer&lt;/p&gt;</comment>
                            <comment id="15182166" author="jira-bot" created="Sun, 6 Mar 2016 06:55:07 -0700">&lt;p&gt;Commit 1f34d7af352d402a443abf62e8dc2ca8d6c6f7c1 in lucene-solr's branch refs/heads/branch_6_0 from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=1f34d7a" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=1f34d7a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7070" title="Rename PointFormat -&amp;gt; PointsFormat, and PointReader/Writer too" class="issue-link" data-issue-key="LUCENE-7070"&gt;&lt;del&gt;LUCENE-7070&lt;/del&gt;&lt;/a&gt;: insert missing 's' in PointFormat/Reader/Writer&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12791668" name="LUCENE-7070.patch" size="287210" author="mikemccand" created="Sun, 6 Mar 2016 06:13:55 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 6 Mar 2016 13:26:54 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2u8zb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7067] points missing checkIntegrity</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7067</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;for points, checksum is not verified by CheckIndex or merge.&lt;/p&gt;</description>
                <environment/>
        <key id="12947089">LUCENE-7067</key>
            <summary>points missing checkIntegrity</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rcmuir">Robert Muir</reporter>
                        <labels>
                    </labels>
                <created>Fri, 4 Mar 2016 14:08:56 -0700</created>
                <updated>Fri, 4 Mar 2016 16:10:20 -0700</updated>
                            <resolved>Fri, 4 Mar 2016 16:10:20 -0700</resolved>
                                                    <fixVersion>master</fixVersion>
                    <fixVersion>6.0</fixVersion>
                    <fixVersion>6.x</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="15180540" author="rcmuir" created="Fri, 4 Mar 2016 14:09:51 -0700">&lt;p&gt;here is a quick stab at a patch.&lt;/p&gt;</comment>
                            <comment id="15180558" author="mikemccand" created="Fri, 4 Mar 2016 14:25:38 -0700">&lt;p&gt;Gak, +1, thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="15180653" author="jira-bot" created="Fri, 4 Mar 2016 15:25:37 -0700">&lt;p&gt;Commit 144273a8149b3cb0cd256ee54523994dc53a3d98 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=144273a" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=144273a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7067" title="points missing checkIntegrity" class="issue-link" data-issue-key="LUCENE-7067"&gt;&lt;del&gt;LUCENE-7067&lt;/del&gt;&lt;/a&gt;: add missing checkIntegrity calls for Points&lt;/p&gt;</comment>
                            <comment id="15180695" author="jira-bot" created="Fri, 4 Mar 2016 15:52:13 -0700">&lt;p&gt;Commit 31a37b0fd6f560d25172617ef10341d29785a583 in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=31a37b0" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=31a37b0&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7067" title="points missing checkIntegrity" class="issue-link" data-issue-key="LUCENE-7067"&gt;&lt;del&gt;LUCENE-7067&lt;/del&gt;&lt;/a&gt;: add missing checkIntegrity calls for Points&lt;/p&gt;</comment>
                            <comment id="15180719" author="jira-bot" created="Fri, 4 Mar 2016 16:09:35 -0700">&lt;p&gt;Commit 1bc4a15a0483385e88fecce4e6c1898aa2188871 in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=1bc4a15" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=1bc4a15&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7067" title="points missing checkIntegrity" class="issue-link" data-issue-key="LUCENE-7067"&gt;&lt;del&gt;LUCENE-7067&lt;/del&gt;&lt;/a&gt;: add missing checkIntegrity calls for Points&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12791533" name="LUCENE-7067.patch" size="2326" author="rcmuir" created="Fri, 4 Mar 2016 14:09:51 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 4 Mar 2016 21:25:38 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2u6d3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7066] Optimize the "everything matches" case for point range queries</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7066</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;Now that points have a getDocCount statistic, we could optimize execution of range queries in the case that the range's lower bound is less that the field's min value and the range's upper bound is greater than the field's max value.&lt;/p&gt;

&lt;p&gt;I would expect such an optimization to kick in frequently for users who store time series in their indices as it is quite frequent for ranges to cover entire segments or even entire indices.&lt;/p&gt;</description>
                <environment/>
        <key id="12947004">LUCENE-7066</key>
            <summary>Optimize the "everything matches" case for point range queries</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jpountz">Adrien Grand</assignee>
                                    <reporter username="jpountz">Adrien Grand</reporter>
                        <labels>
                    </labels>
                <created>Fri, 4 Mar 2016 08:59:29 -0700</created>
                <updated>Mon, 7 Mar 2016 02:17:55 -0700</updated>
                            <resolved>Mon, 7 Mar 2016 02:17:55 -0700</resolved>
                                                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="15180061" author="jpountz" created="Fri, 4 Mar 2016 09:04:17 -0700">&lt;p&gt;Here is a patch.&lt;/p&gt;</comment>
                            <comment id="15180331" author="rcmuir" created="Fri, 4 Mar 2016 11:34:22 -0700">&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="15180449" author="mikemccand" created="Fri, 4 Mar 2016 12:57:44 -0700">&lt;p&gt;+1, nice opto, and thank you for factoring out the massive visitor &lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/smile.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt;&lt;/p&gt;</comment>
                            <comment id="15181786" author="jpountz" created="Sat, 5 Mar 2016 10:43:42 -0700">&lt;p&gt;Any opinions about whether this should go to 6.0? cc &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nknize" class="user-hover" rel="nknize"&gt;Nicholas Knize&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15181822" author="nknize" created="Sat, 5 Mar 2016 12:07:14 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jpountz" class="user-hover" rel="jpountz"&gt;Adrien Grand&lt;/a&gt; I think this is an important optimization for any numeric index with low variance - which is more common than not. The patch LGTM, and since PointValues are a big feature for this release I'd rather see the improvement make it now than wait.&lt;/p&gt;</comment>
                            <comment id="15182768" author="jira-bot" created="Mon, 7 Mar 2016 01:56:38 -0700">&lt;p&gt;Commit e695b0ae07b6f9c1cf7f0d2dc97e41e2ab25e58f in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jpountz" class="user-hover" rel="jpountz"&gt;Adrien Grand&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e695b0a" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e695b0a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7066" title="Optimize the &amp;quot;everything matches&amp;quot; case for point range queries" class="issue-link" data-issue-key="LUCENE-7066"&gt;&lt;del&gt;LUCENE-7066&lt;/del&gt;&lt;/a&gt;: Optimize PointRangeQuery for the case that all documents have a value and all points from the segment match.&lt;/p&gt;</comment>
                            <comment id="15182777" author="jira-bot" created="Mon, 7 Mar 2016 02:08:04 -0700">&lt;p&gt;Commit 8c36347928efd20977acc120690ab5f8d5ccd4b7 in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jpountz" class="user-hover" rel="jpountz"&gt;Adrien Grand&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=8c36347" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=8c36347&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7066" title="Optimize the &amp;quot;everything matches&amp;quot; case for point range queries" class="issue-link" data-issue-key="LUCENE-7066"&gt;&lt;del&gt;LUCENE-7066&lt;/del&gt;&lt;/a&gt;: Optimize PointRangeQuery for the case that all documents have a value and all points from the segment match.&lt;/p&gt;</comment>
                            <comment id="15182778" author="jira-bot" created="Mon, 7 Mar 2016 02:08:05 -0700">&lt;p&gt;Commit 9413b42d7be4dafd7ccafaacc5563871c6ebb0dd in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jpountz" class="user-hover" rel="jpountz"&gt;Adrien Grand&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9413b42" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9413b42&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7066" title="Optimize the &amp;quot;everything matches&amp;quot; case for point range queries" class="issue-link" data-issue-key="LUCENE-7066"&gt;&lt;del&gt;LUCENE-7066&lt;/del&gt;&lt;/a&gt;: Optimize PointRangeQuery for the case that all documents have a value and all points from the segment match.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12791486" name="LUCENE-7066.patch" size="10180" author="jpountz" created="Fri, 4 Mar 2016 09:04:17 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 4 Mar 2016 18:34:22 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2u5u7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7065] Fix explain for global ordinal query time join</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7065</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;The explain methods for the global ordinal join is broken, because even in the case that a document doesn't match with the query it tries to create an explain that tells it does. &lt;/p&gt;

&lt;p&gt;In the case when score mode 'avg' is used this causes a NPE and in the other cases the return explanation indicates that a document matches while it doesn't.&lt;/p&gt;</description>
                <environment/>
        <key id="12946706">LUCENE-7065</key>
            <summary>Fix explain for global ordinal query time join</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="martijn.v.groningen">Martijn van Groningen</reporter>
                        <labels>
                    </labels>
                <created>Thu, 3 Mar 2016 15:42:56 -0700</created>
                <updated>Fri, 4 Mar 2016 10:28:37 -0700</updated>
                            <resolved>Fri, 4 Mar 2016 10:28:37 -0700</resolved>
                                                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="15178749" author="martijn.v.groningen" created="Thu, 3 Mar 2016 15:44:17 -0700">&lt;p&gt;Patch with the fix and a test.&lt;/p&gt;</comment>
                            <comment id="15179567" author="jpountz" created="Fri, 4 Mar 2016 01:42:57 -0700">&lt;p&gt;Maybe the explanation descriptions should be more explicit: I think it could be interesting to know that a document has no join value vs. it has one but it does not match.&lt;/p&gt;</comment>
                            <comment id="15179599" author="martijn.v.groningen" created="Fri, 4 Mar 2016 02:17:18 -0700">&lt;p&gt;+1 I'll improve the descriptions.&lt;/p&gt;</comment>
                            <comment id="15179651" author="martijn.v.groningen" created="Fri, 4 Mar 2016 02:56:31 -0700">&lt;p&gt;I've attached a new patch with improved explain descriptions.&lt;/p&gt;</comment>
                            <comment id="15179899" author="jpountz" created="Fri, 4 Mar 2016 06:54:50 -0700">&lt;p&gt;+1 I think we should just use Term.toString instead of BytesRef.utf8ToString since the values might not be utf8-encoded.&lt;/p&gt;</comment>
                            <comment id="15180187" author="jira-bot" created="Fri, 4 Mar 2016 10:23:41 -0700">&lt;p&gt;Commit b9cc15309ce42f3e33033bdaad91fbe4737f6fcd in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=martijn" class="user-hover" rel="martijn"&gt;Martijn van Groningen&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b9cc153" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b9cc153&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7065" title="Fix explain for global ordinal query time join" class="issue-link" data-issue-key="LUCENE-7065"&gt;&lt;del&gt;LUCENE-7065&lt;/del&gt;&lt;/a&gt;: Fix the explain for the global ordinals join query. Before the&lt;br/&gt;
  explain would also indicate that non matching documents would match.&lt;br/&gt;
  On top of that with score mode average, the explain would fail with a NPE.&lt;/p&gt;</comment>
                            <comment id="15180191" author="jira-bot" created="Fri, 4 Mar 2016 10:25:30 -0700">&lt;p&gt;Commit d700b149a5597b4b8cdd10a5850d6050b6a82107 in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=martijn" class="user-hover" rel="martijn"&gt;Martijn van Groningen&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d700b14" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d700b14&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7065" title="Fix explain for global ordinal query time join" class="issue-link" data-issue-key="LUCENE-7065"&gt;&lt;del&gt;LUCENE-7065&lt;/del&gt;&lt;/a&gt;: Fix the explain for the global ordinals join query. Before the&lt;br/&gt;
  explain would also indicate that non matching documents would match.&lt;br/&gt;
  On top of that with score mode average, the explain would fail with a NPE.&lt;/p&gt;</comment>
                            <comment id="15180194" author="jira-bot" created="Fri, 4 Mar 2016 10:27:01 -0700">&lt;p&gt;Commit ac7f15e372963288e922d800d51a30470ebb90aa in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=martijn" class="user-hover" rel="martijn"&gt;Martijn van Groningen&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ac7f15e" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ac7f15e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7065" title="Fix explain for global ordinal query time join" class="issue-link" data-issue-key="LUCENE-7065"&gt;&lt;del&gt;LUCENE-7065&lt;/del&gt;&lt;/a&gt;: Fix the explain for the global ordinals join query. Before the&lt;br/&gt;
  explain would also indicate that non matching documents would match.&lt;br/&gt;
  On top of that with score mode average, the explain would fail with a NPE.&lt;/p&gt;</comment>
                            <comment id="15180198" author="martijn.v.groningen" created="Fri, 4 Mar 2016 10:28:37 -0700">&lt;p&gt;Thanks Adrien! I pushed this to 6_0, 6x and master branches.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12791435" name="LUCENE_7065.patch" size="9135" author="martijn.v.groningen" created="Fri, 4 Mar 2016 02:56:31 -0700"/>
                            <attachment id="12791270" name="LUCENE_7065.patch" size="8762" author="martijn.v.groningen" created="Thu, 3 Mar 2016 15:44:17 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 4 Mar 2016 08:42:57 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2u4jj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7064] Make MultiPhraseQuery immutable</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7064</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;See &lt;a href="https://issues.apache.org/jira/browse/LUCENE-6531" title="Make PhraseQuery immutable" class="issue-link" data-issue-key="LUCENE-6531"&gt;&lt;del&gt;LUCENE-6531&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
Mutable queries are an issue for automatic filter caching since modifying a query after it has been put into the cache will corrupt the cache. We should make all queries immutable (up to the boost) to avoid this issue.&lt;/p&gt;</description>
                <environment/>
        <key id="12946540">LUCENE-7064</key>
            <summary>Make MultiPhraseQuery immutable</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="lvl">Luc Vanlerberghe</reporter>
                        <labels>
                    </labels>
                <created>Thu, 3 Mar 2016 06:10:47 -0700</created>
                <updated>Tue, 8 Mar 2016 02:13:54 -0700</updated>
                            <resolved>Fri, 4 Mar 2016 06:24:54 -0700</resolved>
                                                    <fixVersion>master</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>core/search</component>
                        <due/>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="15177806" author="githubbot" created="Thu, 3 Mar 2016 06:27:46 -0700">&lt;p&gt;GitHub user LucVL opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href="https://github.com/apache/lucene-solr/pull/19" class="external-link" rel="nofollow"&gt;https://github.com/apache/lucene-solr/pull/19&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href="https://issues.apache.org/jira/browse/LUCENE-7064" title="Make MultiPhraseQuery immutable" class="issue-link" data-issue-key="LUCENE-7064"&gt;&lt;del&gt;LUCENE-7064&lt;/del&gt;&lt;/a&gt;: Make MultiPhraseQuery immutable&lt;/p&gt;

&lt;p&gt;    This PR is based at the highest commit point common to master, branch_6x and branch_6_0 so it should be easy to merge with any or all of them.&lt;/p&gt;

&lt;p&gt;    My original mail to the dev list doesn't seem to get through, so I repeat it here:&lt;/p&gt;

&lt;p&gt;    &amp;gt; While checking how to migrate my custom components from lucene/solr 5.1 to 6.x I stumbled upon the fact that oal.search.MultiPhraseQuery is not immutable like most other implementations (see e.g.: &lt;a href="https://issues.apache.org/jira/browse/LUCENE-6531" class="external-link" rel="nofollow"&gt;https://issues.apache.org/jira/browse/LUCENE-6531&lt;/a&gt;)&lt;br/&gt;
    &amp;gt; &lt;br/&gt;
    &amp;gt; Since it is part of the public API I would suggest splitting it in an immutable class and a builder like was done for most other Queries &lt;b&gt;before&lt;/b&gt; releasing an official 6.x version.&lt;br/&gt;
    &amp;gt; &lt;br/&gt;
    &amp;gt; I did a quick scan through all derived classes of Query and I compiled the following list (ignoring sources in test or contrib folders)&lt;br/&gt;
    &amp;gt; Some of them are already marked as experimental (but should perhaps receive the "official" @lucene.experimental tag ?)&lt;br/&gt;
    &amp;gt; For some it's possibly not an issue since they should never end up in a filter cache (like MoreLikeThisQuery ?), but then a comment specifying the exception to the rule should perhaps be added.&lt;br/&gt;
    &amp;gt; &lt;br/&gt;
    &amp;gt; I'll probably already have a go at the MultiPhraseQuery case shortly and create a JIRA issue with a PR for it.&lt;br/&gt;
    &amp;gt; &lt;br/&gt;
    &amp;gt; Luc Vanlerberghe&lt;br/&gt;
    &amp;gt; &lt;br/&gt;
    &amp;gt; lucene/search:&lt;br/&gt;
    &amp;gt; - org.apache.lucene.search.MultiPhraseQuery&lt;br/&gt;
    &amp;gt; &lt;br/&gt;
    &amp;gt; lucene/queries:&lt;br/&gt;
    &amp;gt; - org.apache.lucene.queries.CommonTermsQuery&lt;br/&gt;
    &amp;gt; - org.apache.lucene.queries.CustomScoreQuery (marked as @lucene.experimental)&lt;br/&gt;
    &amp;gt; - org.apache.lucene.queries.mlt.MoreLikeThisQuery&lt;br/&gt;
    &amp;gt; &lt;br/&gt;
    &amp;gt; lucene/suggest:&lt;br/&gt;
    &amp;gt; - org.apache.lucene.search.suggest.document.ContextQuery (marked as @lucene.experimental)&lt;br/&gt;
    &amp;gt; &lt;br/&gt;
    &amp;gt; lucene/facet:&lt;br/&gt;
    &amp;gt; - org.apache.lucene.facet.DrillDownQuery (marked as @lucene.experimental)&lt;br/&gt;
    &amp;gt; &lt;br/&gt;
    &amp;gt; solr/core:&lt;br/&gt;
    &amp;gt; - org.apache.solr.search.ExtendedQueryBase&lt;br/&gt;
    &amp;gt;   Several derived classes, among which:&lt;br/&gt;
    &amp;gt;   - org.apache.solr.query.FilterQuery&lt;br/&gt;
    &amp;gt;   - org.apache.solr.query.SolrRangeQuery (marked as @lucene.experimental)&lt;br/&gt;
    &amp;gt;   - org.apache.solr.search.RankQuery (marked in comment as experimental, but not its derived classes)&lt;br/&gt;
    &amp;gt;   - org.apache.solr.search.WrappedQuery&lt;br/&gt;
    &amp;gt; - org.apache.solr.search.join.GraphQuery (marked as @lucene.experimental)&lt;br/&gt;
    &amp;gt; - org.apache.solr.search.SolrConstantScoreQuery (marked in comment as experimental, but not the derived FunctionRangeQuery)&lt;br/&gt;
    &amp;gt; &lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href="https://github.com/LucVL/lucene-solr" class="external-link" rel="nofollow"&gt;https://github.com/LucVL/lucene-solr&lt;/a&gt; lucene-7064&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href="https://github.com/apache/lucene-solr/pull/19.patch" class="external-link" rel="nofollow"&gt;https://github.com/apache/lucene-solr/pull/19.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #19&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 223eaa2bcf74ea3b363abfb161b3771b09f48281&lt;br/&gt;
Author: Luc Vanlerberghe &amp;lt;luc.vanlerberghe@bvdinfo.com&amp;gt;&lt;br/&gt;
Date:   2016-03-03T10:52:14Z&lt;/p&gt;

&lt;p&gt;    &lt;a href="https://issues.apache.org/jira/browse/LUCENE-7064" title="Make MultiPhraseQuery immutable" class="issue-link" data-issue-key="LUCENE-7064"&gt;&lt;del&gt;LUCENE-7064&lt;/del&gt;&lt;/a&gt;: Split MultiPhraseQuery into an immutable class and a Builder&lt;/p&gt;

&lt;p&gt;commit 1b4c0ed77fe8b22c7a04b2879b34514b0ac05d0d&lt;br/&gt;
Author: Luc Vanlerberghe &amp;lt;luc.vanlerberghe@bvdinfo.com&amp;gt;&lt;br/&gt;
Date:   2016-03-03T13:02:51Z&lt;/p&gt;

&lt;p&gt;    &lt;a href="https://issues.apache.org/jira/browse/LUCENE-7064" title="Make MultiPhraseQuery immutable" class="issue-link" data-issue-key="LUCENE-7064"&gt;&lt;del&gt;LUCENE-7064&lt;/del&gt;&lt;/a&gt;: Updated tests&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15177856" author="lvl" created="Thu, 3 Mar 2016 07:18:33 -0700">&lt;p&gt;I just realized I pass the arrays from the builder to the query as is without copying them, so any modification to the builder modifies the query as well.&lt;br/&gt;
I will update the PR in a moment...&lt;/p&gt;</comment>
                            <comment id="15177947" author="lvl" created="Thu, 3 Mar 2016 08:24:19 -0700">&lt;p&gt;I updated the PR so modifying a Builder no longer affects already created queries&lt;br/&gt;
I aligned the signatures of getTermArrays and getPositions with the ones in PhraseQuery.&lt;/p&gt;

&lt;p&gt;From Adrien Grand:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Actually I think returning a list is better: with arrays you need to perform a deep copy if you want to make sure that the user cannot change the internal state of the query. We could keep arrays internally and call Collections.unmodifiableList(Arrays.asList(termArrays)) when returning the terms to the user?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;For the getTermArrays case that would involve creating wrappers of wrappers since it returns a two-dimensional array.&lt;/p&gt;

&lt;p&gt;For now I just added a "Do not modify!" in the doc comment...&lt;/p&gt;</comment>
                            <comment id="15179568" author="jpountz" created="Fri, 4 Mar 2016 01:47:25 -0700">&lt;p&gt;OK, I agree consistency with PhraseQuery is good.&lt;/p&gt;</comment>
                            <comment id="15179693" author="jira-bot" created="Fri, 4 Mar 2016 03:30:20 -0700">&lt;p&gt;Commit 40aab73a4c997410fc2c1b8b919e5a30e49b1ee5 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lvl" class="user-hover" rel="lvl"&gt;Luc Vanlerberghe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=40aab73" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=40aab73&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7064" title="Make MultiPhraseQuery immutable" class="issue-link" data-issue-key="LUCENE-7064"&gt;&lt;del&gt;LUCENE-7064&lt;/del&gt;&lt;/a&gt;: Split MultiPhraseQuery into an immutable class and a Builder&lt;/p&gt;

&lt;p&gt;This closes #19&lt;/p&gt;</comment>
                            <comment id="15179695" author="githubbot" created="Fri, 4 Mar 2016 03:31:13 -0700">&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href="https://github.com/apache/lucene-solr/pull/19" class="external-link" rel="nofollow"&gt;https://github.com/apache/lucene-solr/pull/19&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15179720" author="jira-bot" created="Fri, 4 Mar 2016 03:44:57 -0700">&lt;p&gt;Commit a78ef1584234a0a831f294f8ac2ebf9e8a7026fb in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jpountz" class="user-hover" rel="jpountz"&gt;Adrien Grand&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=a78ef15" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=a78ef15&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7064" title="Make MultiPhraseQuery immutable" class="issue-link" data-issue-key="LUCENE-7064"&gt;&lt;del&gt;LUCENE-7064&lt;/del&gt;&lt;/a&gt;: Add attribution.&lt;/p&gt;</comment>
                            <comment id="15179864" author="jira-bot" created="Fri, 4 Mar 2016 06:22:58 -0700">&lt;p&gt;Commit 1407077092f3b6d50fbecf07eda3f739f135455d in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lvl" class="user-hover" rel="lvl"&gt;Luc Vanlerberghe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=1407077" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=1407077&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7064" title="Make MultiPhraseQuery immutable" class="issue-link" data-issue-key="LUCENE-7064"&gt;&lt;del&gt;LUCENE-7064&lt;/del&gt;&lt;/a&gt;: Split MultiPhraseQuery into an immutable class and a Builder&lt;/p&gt;

&lt;p&gt;This closes #19&lt;/p&gt;</comment>
                            <comment id="15179865" author="jira-bot" created="Fri, 4 Mar 2016 06:22:59 -0700">&lt;p&gt;Commit 948a388778d56cfa1c9fbd3c9ed44f93136bf943 in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lvl" class="user-hover" rel="lvl"&gt;Luc Vanlerberghe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=948a388" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=948a388&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7064" title="Make MultiPhraseQuery immutable" class="issue-link" data-issue-key="LUCENE-7064"&gt;&lt;del&gt;LUCENE-7064&lt;/del&gt;&lt;/a&gt;: Split MultiPhraseQuery into an immutable class and a Builder&lt;/p&gt;

&lt;p&gt;This closes #19&lt;/p&gt;</comment>
                            <comment id="15179867" author="jpountz" created="Fri, 4 Mar 2016 06:24:54 -0700">&lt;p&gt;Pushed. Thanks Luc!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12947947">LUCENE-7078</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 3 Mar 2016 13:27:46 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2u3in:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7063] NumericUtils vs LegacyNumericUtils chaos with 6.0</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7063</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;Old prefix-coded terms helper functions are still available in LegacyNumericUtils, but its confusing when upgrading because NumericUtils and LegacyNumericUtils have overlaps in the APIs.&lt;/p&gt;

&lt;p&gt;One issue is they share some exact methods that are completely unrelated to this encoding (e.g. floatToSortableInt). The method is just duplication and worst, most lucene code is still calling it from LegacyNumericUtils, even stuff like faceting code using it with docvalues.&lt;/p&gt;

&lt;p&gt;Another issue is the new NumericUtils methods (which use full byte range) have vague names, no javadocs, expose helper methods as public unnecessarily, and cause general confusion.&lt;/p&gt;

&lt;p&gt;I don't think NumericUtils and LegacyNumericUtils should overlap. LegacyNumericUtils should only contain legacy stuff!&lt;/p&gt;</description>
                <environment/>
        <key id="12946392">LUCENE-7063</key>
            <summary>NumericUtils vs LegacyNumericUtils chaos with 6.0</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rcmuir">Robert Muir</reporter>
                        <labels>
                    </labels>
                <created>Wed, 2 Mar 2016 20:46:04 -0700</created>
                <updated>Fri, 4 Mar 2016 03:38:33 -0700</updated>
                            <resolved>Thu, 3 Mar 2016 21:03:38 -0700</resolved>
                                                    <fixVersion>master</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="15177106" author="rcmuir" created="Wed, 2 Mar 2016 20:47:47 -0700">&lt;p&gt;Here's a patch. I tried to cleanup numericutils and add javadocs and fix naming of the newer methods (e.g. toSortableBytes and so on). &lt;/p&gt;</comment>
                            <comment id="15177109" author="rcmuir" created="Wed, 2 Mar 2016 20:50:30 -0700">&lt;p&gt;Also i found the RUE constants i nuked (instead using java 8 constants like Integer.BYTES) are annoying when its easy to add simple deprecated constants to make it easier on anyone else.&lt;/p&gt;</comment>
                            <comment id="15177116" author="rcmuir" created="Wed, 2 Mar 2016 20:58:32 -0700">&lt;p&gt;As far as NumericUtils.intToBytes -&amp;gt; NumericUtils.intToSortableBytes, i think its super trappy to have a method with no javadocs called NumericUtils.intToBytes that is doing the sign-bit flipping. &lt;/p&gt;

&lt;p&gt;AFAIK LegacyNumericUtils always named this 'toPrefixCoded' so we never had this confusion before.&lt;/p&gt;</comment>
                            <comment id="15177477" author="jpountz" created="Thu, 3 Mar 2016 01:27:05 -0700">&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="15177706" author="mikemccand" created="Thu, 3 Mar 2016 04:36:10 -0700">&lt;p&gt;+1, phew what a mess, thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="15177807" author="thetaphi" created="Thu, 3 Mar 2016 06:27:58 -0700">&lt;p&gt;+1 to clean this up!&lt;/p&gt;</comment>
                            <comment id="15178199" author="rcmuir" created="Thu, 3 Mar 2016 10:34:36 -0700">&lt;p&gt;I'm gonna update this patch after investigating the tests. TestLegacyNumericUtils has a lot of nice unit tests, we should make sure none of these "get lost" in the sense, they are probably still possible to port forward to the new full byte[] range encoding and so on. I think this makes sense to just solve all here, so we know floats and doubles are really totally working correct and other things that are super important for core numeric fields.&lt;/p&gt;</comment>
                            <comment id="15178212" author="mikemccand" created="Thu, 3 Mar 2016 10:39:54 -0700">&lt;p&gt;Thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="15178236" author="thetaphi" created="Thu, 3 Mar 2016 10:53:36 -0700">&lt;p&gt;Thanks! I was about to mention this here, too. TestNumericUtils was written like 7 years ago (without randomization), but the tests are good. They check that compareto of double/float and the sortable long/int behave identical, especially with INFINITY and NAN. We should really test this. We can also randomize the tests now: Create a huge number of floats/doubles and sort them. After that convert every value from sorted random array to a sortableInteger and check that they are also increasing. The NaN and similar special value tests should of course stay as is.&lt;/p&gt;</comment>
                            <comment id="15179064" author="rcmuir" created="Thu, 3 Mar 2016 17:59:07 -0700">&lt;p&gt;Updated patch: adds TestNumericUtils.&lt;/p&gt;

&lt;p&gt;I was surprised this class was missing entirely!&lt;/p&gt;

&lt;p&gt;I "ported" many methods from TestLegacyNumericUtils to the new encodings: these test round-trip, compare, explicitly test "special" values for each type. I added BigInteger versions of each too.&lt;/p&gt;

&lt;p&gt;I also added random tests for each type (including bigint) that just do simple round-tripping and comparisons.&lt;/p&gt;

&lt;p&gt;There were tests for NumericUtils binary add() and subtract() methods, but these were in TestBKD! I moved those to this test, too.&lt;/p&gt;</comment>
                            <comment id="15179198" author="jira-bot" created="Thu, 3 Mar 2016 19:52:24 -0700">&lt;p&gt;Commit 3ffeccab7e9949d7cc1e43027d9347a8968131b2 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3ffecca" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3ffecca&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7063" title="NumericUtils vs LegacyNumericUtils chaos with 6.0" class="issue-link" data-issue-key="LUCENE-7063"&gt;&lt;del&gt;LUCENE-7063&lt;/del&gt;&lt;/a&gt;: add tests/docs for numericutils, rename confusing methods, remove overlap with LegacyNumericUtils&lt;/p&gt;</comment>
                            <comment id="15179234" author="jira-bot" created="Thu, 3 Mar 2016 20:19:17 -0700">&lt;p&gt;Commit bea235f711d03165cd92f7a59c7de54ff2785d98 in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=bea235f" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=bea235f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7063" title="NumericUtils vs LegacyNumericUtils chaos with 6.0" class="issue-link" data-issue-key="LUCENE-7063"&gt;&lt;del&gt;LUCENE-7063&lt;/del&gt;&lt;/a&gt;: add tests/docs for numericutils, rename confusing methods, remove overlap with LegacyNumericUtils&lt;/p&gt;</comment>
                            <comment id="15179278" author="jira-bot" created="Thu, 3 Mar 2016 21:02:56 -0700">&lt;p&gt;Commit 2aa412132d0a32ab8c9fab538ba55bf09d24cd90 in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=2aa4121" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=2aa4121&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7063" title="NumericUtils vs LegacyNumericUtils chaos with 6.0" class="issue-link" data-issue-key="LUCENE-7063"&gt;&lt;del&gt;LUCENE-7063&lt;/del&gt;&lt;/a&gt;: add tests/docs for numericutils, rename confusing methods, remove overlap with LegacyNumericUtils&lt;/p&gt;</comment>
                            <comment id="15179706" author="mikemccand" created="Fri, 4 Mar 2016 03:38:33 -0700">&lt;p&gt;Thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12791369" name="LUCENE-7063.patch" size="109191" author="rcmuir" created="Thu, 3 Mar 2016 17:59:07 -0700"/>
                            <attachment id="12791094" name="LUCENE-7063.patch" size="82942" author="rcmuir" created="Wed, 2 Mar 2016 20:47:47 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 3 Mar 2016 08:27:05 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2u2lr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7062] PointValues should expose additional stats</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7062</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;There are two useful stats exposed by postings that are easy to also expose in points: &lt;tt&gt;size&lt;/tt&gt;, which is the total number of points indexed, and &lt;tt&gt;getDocCount&lt;/tt&gt;, which is the total number of documents that have at least one point.&lt;/p&gt;

&lt;p&gt;Like the other point values API fixes, I think we should do this for 6.0, since otherwise if we add it later we'll have to annoyingly handle the "-1" back compat case.&lt;/p&gt;</description>
                <environment/>
        <key id="12946335">LUCENE-7062</key>
            <summary>PointValues should expose additional stats</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mikemccand">Michael McCandless</assignee>
                                    <reporter username="mikemccand">Michael McCandless</reporter>
                        <labels>
                    </labels>
                <created>Wed, 2 Mar 2016 16:59:33 -0700</created>
                <updated>Fri, 4 Mar 2016 07:53:59 -0700</updated>
                            <resolved>Fri, 4 Mar 2016 07:53:59 -0700</resolved>
                                                    <fixVersion>master</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="15176758" author="mikemccand" created="Wed, 2 Mar 2016 17:02:01 -0700">&lt;p&gt;Straightforward patch.&lt;/p&gt;

&lt;p&gt;I fixed Lucene60 and SimpleText to save the two new stats per field, and fixed CheckIndex to check them.  I also fixed CheckIndex to check the global per-field min/max stats.&lt;/p&gt;</comment>
                            <comment id="15176866" author="rcmuir" created="Wed, 2 Mar 2016 17:55:44 -0700">&lt;p&gt;I love how much better checkindex gets here. Can we also assert in checkindex (and maybe assertingXXX) that getDocCount &amp;lt;= maxDoc?&lt;/p&gt;</comment>
                            <comment id="15176867" author="rcmuir" created="Wed, 2 Mar 2016 17:56:13 -0700">&lt;p&gt;and asserting can also check the values are positive (i know one is written with vInt)&lt;/p&gt;</comment>
                            <comment id="15177660" author="mikemccand" created="Thu, 3 Mar 2016 03:48:42 -0700">&lt;p&gt;Thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt; I'll make those fixes and push.&lt;/p&gt;</comment>
                            <comment id="15177890" author="mikemccand" created="Thu, 3 Mar 2016 07:41:10 -0700">&lt;p&gt;I forgot to reference the issue number (again!!); here's the merge commit to master: &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;a=commit;h=4c4313889f4ee9c12ff0ce012f24de4a447c319b" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;a=commit;h=4c4313889f4ee9c12ff0ce012f24de4a447c319b&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I backported to 6.x, but I'm waiting for the 6.0 branch to get fixed before back porting.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12791061" name="LUCENE-7062.patch" size="45406" author="mikemccand" created="Wed, 2 Mar 2016 17:02:01 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 3 Mar 2016 00:55:44 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2u293:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7061] fix remaining api issues with XYZPoint classes</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7061</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;There are still some major problems today:&lt;/p&gt;

&lt;p&gt;XYZPoint.newRangeQuery has "brain damage" from variable length terms. nulls for open ranges make no sense: these are fixed-width types and instead you can use things like Integer.maxValue. Removing the nulls is safe, as we can just switch to primitive types instead of boxed types.&lt;/p&gt;

&lt;p&gt;XYZPoint.newRangeQuery requires boolean arrays for inclusive/exclusive, but thats just more brain damage. If you want to exclude an integer, you just subtract 1 from it and other simple stuff.&lt;/p&gt;

&lt;p&gt;For the apis, this means Instead of:&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
&lt;span class="code-keyword"&gt;public&lt;/span&gt; &lt;span class="code-keyword"&gt;static&lt;/span&gt; Query newRangeQuery(&lt;span class="code-object"&gt;String&lt;/span&gt; field, &lt;span class="code-object"&gt;Long&lt;/span&gt; lowerValue, &lt;span class="code-object"&gt;boolean&lt;/span&gt; lowerInclusive, &lt;span class="code-object"&gt;Long&lt;/span&gt; upperValue, &lt;span class="code-object"&gt;boolean&lt;/span&gt; upperInclusive);
  
&lt;span class="code-keyword"&gt;public&lt;/span&gt; &lt;span class="code-keyword"&gt;static&lt;/span&gt; Query newMultiRangeQuery(&lt;span class="code-object"&gt;String&lt;/span&gt; field, &lt;span class="code-object"&gt;Long&lt;/span&gt;[] lowerValue, &lt;span class="code-object"&gt;boolean&lt;/span&gt; lowerInclusive[], &lt;span class="code-object"&gt;Long&lt;/span&gt;[] upperValue, &lt;span class="code-object"&gt;boolean&lt;/span&gt; upperInclusive[]);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;we have:&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
&lt;span class="code-keyword"&gt;public&lt;/span&gt; &lt;span class="code-keyword"&gt;static&lt;/span&gt; Query newRangeQuery(&lt;span class="code-object"&gt;String&lt;/span&gt; field, &lt;span class="code-object"&gt;long&lt;/span&gt; lowerValue, &lt;span class="code-object"&gt;long&lt;/span&gt; upperValue);
&lt;span class="code-keyword"&gt;public&lt;/span&gt; &lt;span class="code-keyword"&gt;static&lt;/span&gt; Query newRangeQuery(&lt;span class="code-object"&gt;String&lt;/span&gt; field, &lt;span class="code-object"&gt;long&lt;/span&gt;[] lowerValue, &lt;span class="code-object"&gt;long&lt;/span&gt;[] upperValue);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;PointRangeQuery is horribly complex due to these nulls and boolean arrays, and need not be. Now it only works "inclusive" and is much simpler.&lt;/p&gt;

&lt;p&gt;XYZPoint.newSetQuery throws IOException, just creating the query. This is very confusing and unnecessary (no i/o happens).&lt;/p&gt;

&lt;p&gt;LatLonPoint's bounding box query is not inclusive like the other geo. And the test does not fail!&lt;/p&gt;

&lt;p&gt;I also found a few missing checks here and there while cleaning up.&lt;/p&gt;</description>
                <environment/>
        <key id="12946277">LUCENE-7061</key>
            <summary>fix remaining api issues with XYZPoint classes</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rcmuir">Robert Muir</reporter>
                        <labels>
                    </labels>
                <created>Wed, 2 Mar 2016 13:01:23 -0700</created>
                <updated>Thu, 17 Mar 2016 05:47:24 -0700</updated>
                            <resolved>Wed, 2 Mar 2016 15:30:24 -0700</resolved>
                                                    <fixVersion>master</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="15176365" author="rcmuir" created="Wed, 2 Mar 2016 13:02:13 -0700">&lt;p&gt;Here's a patch. I also added tests for "extreme values" of double and float, documented their ordering, and a few other cleanups.&lt;/p&gt;</comment>
                            <comment id="15176383" author="mikemccand" created="Wed, 2 Mar 2016 13:13:55 -0700">&lt;p&gt;Thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;, this is a really nice cleanup.  +1&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;PointRangeQuery&lt;/tt&gt; is so much simpler!&lt;/p&gt;

&lt;p&gt;Given that this is a big improvement to a new 6.0 feature I think we should backport this for 6.0?  @nknize is that ok?&lt;/p&gt;</comment>
                            <comment id="15176538" author="nknize" created="Wed, 2 Mar 2016 14:44:30 -0700">&lt;p&gt;This is an awesome cleanup! Since PointValues are a big feature for 6.0 we definitely need to get the API and testing right. &lt;/p&gt;

&lt;p&gt;+1 for getting this in 6x&lt;/p&gt;</comment>
                            <comment id="15176567" author="jira-bot" created="Wed, 2 Mar 2016 15:04:04 -0700">&lt;p&gt;Commit e80ab3926c12349f0d7a94bd5021a272b0bc6311 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e80ab39" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e80ab39&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7061" title="fix remaining api issues with XYZPoint classes" class="issue-link" data-issue-key="LUCENE-7061"&gt;&lt;del&gt;LUCENE-7061&lt;/del&gt;&lt;/a&gt;: fix remaining api issues with XYZPoint classes&lt;/p&gt;

&lt;p&gt;Squashed commit of the following:&lt;/p&gt;

&lt;p&gt;commit 0261e28dd29b1c2a1dcbd5e796966b2cdf2f4b82&lt;br/&gt;
Author: Robert Muir &amp;lt;rmuir@apache.org&amp;gt;&lt;br/&gt;
Date:   Wed Mar 2 14:51:49 2016 -0500&lt;/p&gt;

&lt;p&gt;    Add note about comparison order and test extreme values&lt;/p&gt;

&lt;p&gt;commit e1f7bc244cd980e931d584c00ba73f8ac521c3fd&lt;br/&gt;
Author: Mike McCandless &amp;lt;mikemccand@apache.org&amp;gt;&lt;br/&gt;
Date:   Wed Mar 2 14:25:50 2016 -0500&lt;/p&gt;

&lt;p&gt;    add explicit test to verify rect query is inclusive; make test fail fast by default&lt;/p&gt;

&lt;p&gt;commit c9be9139ec2f9553ce05fb56b2667be77b8176b6&lt;br/&gt;
Author: Robert Muir &amp;lt;rmuir@apache.org&amp;gt;&lt;br/&gt;
Date:   Wed Mar 2 14:03:47 2016 -0500&lt;/p&gt;

&lt;p&gt;    oops&lt;/p&gt;

&lt;p&gt;commit 351d0838bbc87dc7c6d83476bd9cb7ce6c38fc3c&lt;br/&gt;
Author: Robert Muir &amp;lt;rmuir@apache.org&amp;gt;&lt;br/&gt;
Date:   Wed Mar 2 13:53:42 2016 -0500&lt;/p&gt;

&lt;p&gt;    clean up pointrangequery: remove nulls and inclusives&lt;/p&gt;

&lt;p&gt;commit 0796057a8041ddf43341611b477502fa2307f0b1&lt;br/&gt;
Merge: 742ee02 e3198ca&lt;br/&gt;
Author: Robert Muir &amp;lt;rmuir@apache.org&amp;gt;&lt;br/&gt;
Date:   Wed Mar 2 13:26:48 2016 -0500&lt;/p&gt;

&lt;p&gt;    Merge branch 'master' into unfuck_points&lt;/p&gt;

&lt;p&gt;commit 742ee02aaf55439463daddbd3ea16c5e8df31f01&lt;br/&gt;
Author: Robert Muir &amp;lt;rmuir@apache.org&amp;gt;&lt;br/&gt;
Date:   Wed Mar 2 13:16:08 2016 -0500&lt;/p&gt;

&lt;p&gt;    Remove nulls and inclusives from points apis&lt;/p&gt;</comment>
                            <comment id="15176610" author="jira-bot" created="Wed, 2 Mar 2016 15:30:04 -0700">&lt;p&gt;Commit 8eada27fe30e074f96871c4e15a0093cbdc4ecda in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=8eada27" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=8eada27&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7061" title="fix remaining api issues with XYZPoint classes" class="issue-link" data-issue-key="LUCENE-7061"&gt;&lt;del&gt;LUCENE-7061&lt;/del&gt;&lt;/a&gt;: fix remaining api issues with XYZPoint classes&lt;/p&gt;

&lt;p&gt;Squashed commit of the following:&lt;/p&gt;

&lt;p&gt;commit 0261e28dd29b1c2a1dcbd5e796966b2cdf2f4b82&lt;br/&gt;
Author: Robert Muir &amp;lt;rmuir@apache.org&amp;gt;&lt;br/&gt;
Date:   Wed Mar 2 14:51:49 2016 -0500&lt;/p&gt;

&lt;p&gt;    Add note about comparison order and test extreme values&lt;/p&gt;

&lt;p&gt;commit e1f7bc244cd980e931d584c00ba73f8ac521c3fd&lt;br/&gt;
Author: Mike McCandless &amp;lt;mikemccand@apache.org&amp;gt;&lt;br/&gt;
Date:   Wed Mar 2 14:25:50 2016 -0500&lt;/p&gt;

&lt;p&gt;    add explicit test to verify rect query is inclusive; make test fail fast by default&lt;/p&gt;

&lt;p&gt;commit c9be9139ec2f9553ce05fb56b2667be77b8176b6&lt;br/&gt;
Author: Robert Muir &amp;lt;rmuir@apache.org&amp;gt;&lt;br/&gt;
Date:   Wed Mar 2 14:03:47 2016 -0500&lt;/p&gt;

&lt;p&gt;    oops&lt;/p&gt;

&lt;p&gt;commit 351d0838bbc87dc7c6d83476bd9cb7ce6c38fc3c&lt;br/&gt;
Author: Robert Muir &amp;lt;rmuir@apache.org&amp;gt;&lt;br/&gt;
Date:   Wed Mar 2 13:53:42 2016 -0500&lt;/p&gt;

&lt;p&gt;    clean up pointrangequery: remove nulls and inclusives&lt;/p&gt;

&lt;p&gt;commit 0796057a8041ddf43341611b477502fa2307f0b1&lt;br/&gt;
Merge: 742ee02 e3198ca&lt;br/&gt;
Author: Robert Muir &amp;lt;rmuir@apache.org&amp;gt;&lt;br/&gt;
Date:   Wed Mar 2 13:26:48 2016 -0500&lt;/p&gt;

&lt;p&gt;    Merge branch 'master' into unfuck_points&lt;/p&gt;

&lt;p&gt;commit 742ee02aaf55439463daddbd3ea16c5e8df31f01&lt;br/&gt;
Author: Robert Muir &amp;lt;rmuir@apache.org&amp;gt;&lt;br/&gt;
Date:   Wed Mar 2 13:16:08 2016 -0500&lt;/p&gt;

&lt;p&gt;    Remove nulls and inclusives from points apis&lt;/p&gt;</comment>
                            <comment id="15177944" author="jira-bot" created="Thu, 3 Mar 2016 08:23:18 -0700">&lt;p&gt;Commit dc35cea65673ca1c340770f3d0999f50834ddea5 in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=dc35cea" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=dc35cea&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7061" title="fix remaining api issues with XYZPoint classes" class="issue-link" data-issue-key="LUCENE-7061"&gt;&lt;del&gt;LUCENE-7061&lt;/del&gt;&lt;/a&gt;: fix remaining api issues with XYZPoint classes&lt;/p&gt;

&lt;p&gt;Squashed commit of the following:&lt;/p&gt;

&lt;p&gt;commit 0261e28dd29b1c2a1dcbd5e796966b2cdf2f4b82&lt;br/&gt;
Author: Robert Muir &amp;lt;rmuir@apache.org&amp;gt;&lt;br/&gt;
Date:   Wed Mar 2 14:51:49 2016 -0500&lt;/p&gt;

&lt;p&gt;    Add note about comparison order and test extreme values&lt;/p&gt;

&lt;p&gt;commit e1f7bc244cd980e931d584c00ba73f8ac521c3fd&lt;br/&gt;
Author: Mike McCandless &amp;lt;mikemccand@apache.org&amp;gt;&lt;br/&gt;
Date:   Wed Mar 2 14:25:50 2016 -0500&lt;/p&gt;

&lt;p&gt;    add explicit test to verify rect query is inclusive; make test fail fast by default&lt;/p&gt;

&lt;p&gt;commit c9be9139ec2f9553ce05fb56b2667be77b8176b6&lt;br/&gt;
Author: Robert Muir &amp;lt;rmuir@apache.org&amp;gt;&lt;br/&gt;
Date:   Wed Mar 2 14:03:47 2016 -0500&lt;/p&gt;

&lt;p&gt;    oops&lt;/p&gt;

&lt;p&gt;commit 351d0838bbc87dc7c6d83476bd9cb7ce6c38fc3c&lt;br/&gt;
Author: Robert Muir &amp;lt;rmuir@apache.org&amp;gt;&lt;br/&gt;
Date:   Wed Mar 2 13:53:42 2016 -0500&lt;/p&gt;

&lt;p&gt;    clean up pointrangequery: remove nulls and inclusives&lt;/p&gt;

&lt;p&gt;commit 0796057a8041ddf43341611b477502fa2307f0b1&lt;br/&gt;
Merge: 742ee02 e3198ca&lt;br/&gt;
Author: Robert Muir &amp;lt;rmuir@apache.org&amp;gt;&lt;br/&gt;
Date:   Wed Mar 2 13:26:48 2016 -0500&lt;/p&gt;

&lt;p&gt;    Merge branch 'master' into unfuck_points&lt;/p&gt;

&lt;p&gt;commit 742ee02aaf55439463daddbd3ea16c5e8df31f01&lt;br/&gt;
Author: Robert Muir &amp;lt;rmuir@apache.org&amp;gt;&lt;br/&gt;
Date:   Wed Mar 2 13:16:08 2016 -0500&lt;/p&gt;

&lt;p&gt;    Remove nulls and inclusives from points apis&lt;br/&gt;
(cherry picked from commit 8eada27)&lt;/p&gt;</comment>
                            <comment id="15199426" author="mdavis95" created="Thu, 17 Mar 2016 05:38:52 -0700">&lt;p&gt;+1 and -1 for start and end exclusive for Int and Long makes sense but what would be the pattern for Float and Double?&lt;/p&gt;</comment>
                            <comment id="15199439" author="rcmuir" created="Thu, 17 Mar 2016 05:47:24 -0700">&lt;p&gt;Math.nextUp/Math.nextDown&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12791012" name="LUCENE-7061.patch" size="148107" author="rcmuir" created="Wed, 2 Mar 2016 13:02:13 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 2 Mar 2016 20:13:55 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2u1w7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7060] Update Spatial4j 0.5 to 0.6 (includes change in package)</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7060</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;Spatial4j 0.6 was released the 26th of February and I want to upgrade to it.  The most impactful change is that the package moves from com.spatial4j.core to org.locationtech.spatial4j.  For that reason, it would be ideal to do this for Lucene 6.0&lt;/p&gt;

&lt;p&gt;&lt;a href="https://github.com/locationtech/spatial4j/blob/master/CHANGES.md" class="external-link" rel="nofollow"&gt;https://github.com/locationtech/spatial4j/blob/master/CHANGES.md&lt;/a&gt;&lt;/p&gt;</description>
                <environment/>
        <key id="12946193">LUCENE-7060</key>
            <summary>Update Spatial4j 0.5 to 0.6 (includes change in package)</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dsmiley">David Smiley</assignee>
                                    <reporter username="dsmiley">David Smiley</reporter>
                        <labels>
                    </labels>
                <created>Wed, 2 Mar 2016 09:19:04 -0700</created>
                <updated>Thu, 3 Mar 2016 08:23:19 -0700</updated>
                            <resolved>Wed, 2 Mar 2016 19:09:57 -0700</resolved>
                                                    <fixVersion>6.0</fixVersion>
                                    <component>modules/spatial</component>
                        <due/>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="15176290" author="dsmiley" created="Wed, 2 Mar 2016 12:22:18 -0700">&lt;p&gt;Here's the patch.  It passes pre-commit and tests pass.  Of note it includes an updated Spatial4j NOTICE.txt file.  And it also removes the &lt;tt&gt;@AwaitsFix&lt;/tt&gt; annotations added in &lt;a href="https://issues.apache.org/jira/browse/LUCENE-6867" title="Unmark ignored geo tests (due to RR incompatibility)" class="issue-link" data-issue-key="LUCENE-6867"&gt;&lt;del&gt;LUCENE-6867&lt;/del&gt;&lt;/a&gt; since it's a non-issue now.&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nknize" class="user-hover" rel="nknize"&gt;Nicholas Knize&lt;/a&gt; as this is not a feature and it changes some package statements, I think it should ideally go into the 6.0 release.  Cool?&lt;/p&gt;</comment>
                            <comment id="15176530" author="nknize" created="Wed, 2 Mar 2016 14:40:58 -0700">&lt;p&gt;+1 &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley" class="user-hover" rel="dsmiley"&gt;David Smiley&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15176977" author="jira-bot" created="Wed, 2 Mar 2016 19:06:00 -0700">&lt;p&gt;Commit 569b6ca9ca439ee82734622f35f6b6342c0e9228 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley" class="user-hover" rel="dsmiley"&gt;David Smiley&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=569b6ca" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=569b6ca&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7060" title="Update Spatial4j 0.5 to 0.6 (includes change in package)" class="issue-link" data-issue-key="LUCENE-7060"&gt;&lt;del&gt;LUCENE-7060&lt;/del&gt;&lt;/a&gt;: Spatial4j 0.6 upgrade. Package com.spatial4j.core -&amp;gt; org.locationtech.spatial4j&lt;/p&gt;</comment>
                            <comment id="15176986" author="jira-bot" created="Wed, 2 Mar 2016 19:08:59 -0700">&lt;p&gt;Commit b90dbd4b5db446900edb0a421b04a5cc2a108e3b in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley" class="user-hover" rel="dsmiley"&gt;David Smiley&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b90dbd4" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b90dbd4&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7060" title="Update Spatial4j 0.5 to 0.6 (includes change in package)" class="issue-link" data-issue-key="LUCENE-7060"&gt;&lt;del&gt;LUCENE-7060&lt;/del&gt;&lt;/a&gt;: Spatial4j 0.6 upgrade. Package com.spatial4j.core -&amp;gt; org.locationtech.spatial4j&lt;br/&gt;
(cherry picked from commit 569b6ca)&lt;/p&gt;</comment>
                            <comment id="15177945" author="jira-bot" created="Thu, 3 Mar 2016 08:23:19 -0700">&lt;p&gt;Commit 891e659012c045f9202e2df65c15c1f43b692772 in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley" class="user-hover" rel="dsmiley"&gt;David Smiley&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=891e659" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=891e659&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7060" title="Update Spatial4j 0.5 to 0.6 (includes change in package)" class="issue-link" data-issue-key="LUCENE-7060"&gt;&lt;del&gt;LUCENE-7060&lt;/del&gt;&lt;/a&gt;: Spatial4j 0.6 upgrade. Package com.spatial4j.core -&amp;gt; org.locationtech.spatial4j&lt;br/&gt;
(cherry picked from commit 569b6ca)&lt;br/&gt;
(cherry picked from commit b90dbd4)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12908842">LUCENE-6867</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12791001" name="LUCENE_7060_spatial4j_0_6_upgrade.patch" size="138590" author="dsmiley" created="Wed, 2 Mar 2016 12:22:18 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 2 Mar 2016 21:40:58 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2u1dj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7059] Verify that 1D point values are visited in order</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7059</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;The new PointInSetQuery (&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7048" title="Add XXXPoint.newSetQuery to match a set of points" class="issue-link" data-issue-key="LUCENE-7048"&gt;&lt;del&gt;LUCENE-7048&lt;/del&gt;&lt;/a&gt;) hit a tricky test failure&lt;br/&gt;
(&lt;a href="https://builds.apache.org/job/Lucene-Solr-Tests-trunk-Java8/871/" class="external-link" rel="nofollow"&gt;https://builds.apache.org/job/Lucene-Solr-Tests-trunk-Java8/871/&lt;/a&gt;)&lt;br/&gt;
where point values were sometimes not visited in order like it&lt;br/&gt;
expected.&lt;/p&gt;

&lt;p&gt;I pushed a hack to fix the query, but I think we should do a better&lt;br/&gt;
fix, here, making the "values in order in the 1D case" part of the&lt;br/&gt;
API, fixing CheckIndex, AssertingPointFormat to verify this, and&lt;br/&gt;
removing the buggy MultiPointValues.&lt;/p&gt;

&lt;p&gt;I also found a possibly serious bug in BKDWriter, where it was doing&lt;br/&gt;
&lt;tt&gt;writeInt/writeLong&lt;/tt&gt; to its offline files, but then reading with&lt;br/&gt;
&lt;tt&gt;readVInt/readVLong&lt;/tt&gt;!  It's hard to provoke, though: it only strikes&lt;br/&gt;
in the tie-break case (same values across docs), and even then only if&lt;br/&gt;
the &lt;tt&gt;IntroSorter&lt;/tt&gt; does a non-stable sort.  I made a failing test&lt;br/&gt;
case and fixed that bug, and also removed the unnecessary ord tie&lt;br/&gt;
breaking from BKDWriter's comparator.&lt;/p&gt;

&lt;p&gt;Finally, I saw &lt;tt&gt;BKDWriter&lt;/tt&gt; was failing to pass on its&lt;br/&gt;
&lt;tt&gt;maxMBSortInHeap&lt;/tt&gt; down to &lt;tt&gt;OfflineSorter&lt;/tt&gt;, and fixed that.&lt;/p&gt;</description>
                <environment/>
        <key id="12945986">LUCENE-7059</key>
            <summary>Verify that 1D point values are visited in order</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mikemccand">Michael McCandless</assignee>
                                    <reporter username="mikemccand">Michael McCandless</reporter>
                        <labels>
                    </labels>
                <created>Tue, 1 Mar 2016 16:55:24 -0700</created>
                <updated>Thu, 3 Mar 2016 08:23:17 -0700</updated>
                            <resolved>Wed, 2 Mar 2016 09:46:56 -0700</resolved>
                                                    <fixVersion>master</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="15174678" author="mikemccand" created="Tue, 1 Mar 2016 17:18:48 -0700">&lt;p&gt;Patch, I think it's ready.&lt;/p&gt;</comment>
                            <comment id="15174771" author="rcmuir" created="Tue, 1 Mar 2016 18:17:11 -0700">&lt;p&gt;+1, thanks for the cleanups!&lt;/p&gt;</comment>
                            <comment id="15175877" author="jira-bot" created="Wed, 2 Mar 2016 09:25:23 -0700">&lt;p&gt;Commit 3cbc48ed3085ed2bac5096d6828a7f129003619d in lucene-solr's branch refs/heads/branch_6x from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3cbc48e" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3cbc48e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7059" title="Verify that 1D point values are visited in order" class="issue-link" data-issue-key="LUCENE-7059"&gt;&lt;del&gt;LUCENE-7059&lt;/del&gt;&lt;/a&gt;: always visit 1D points in sorted order; fix tie-break but in BKDWriter; fix BKDWriter to pass on maxMBSortInHeap to the OfflineSorter too&lt;/p&gt;</comment>
                            <comment id="15175930" author="jira-bot" created="Wed, 2 Mar 2016 09:46:45 -0700">&lt;p&gt;Commit e3198cac549b7297d4842cb99f5d9eef9b7dc6fe in lucene-solr's branch refs/heads/master from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e3198ca" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e3198ca&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7059" title="Verify that 1D point values are visited in order" class="issue-link" data-issue-key="LUCENE-7059"&gt;&lt;del&gt;LUCENE-7059&lt;/del&gt;&lt;/a&gt;: always visit 1D points in sorted order; fix tie-break but in BKDWriter; fix BKDWriter to pass on maxMBSortInHeap to the OfflineSorter too&lt;/p&gt;</comment>
                            <comment id="15176595" author="jira-bot" created="Wed, 2 Mar 2016 15:19:02 -0700">&lt;p&gt;Commit 25cc48bbb8cc11c2f7a2c9da30d675c9ae5926ca in lucene-solr's branch refs/heads/branch_6x from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=25cc48b" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=25cc48b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7059" title="Verify that 1D point values are visited in order" class="issue-link" data-issue-key="LUCENE-7059"&gt;&lt;del&gt;LUCENE-7059&lt;/del&gt;&lt;/a&gt;: remove MultiPointValues&lt;/p&gt;</comment>
                            <comment id="15176600" author="jira-bot" created="Wed, 2 Mar 2016 15:20:07 -0700">&lt;p&gt;Commit 9f5bbc2d911cf0df34944c3fcb3aef5937e21907 in lucene-solr's branch refs/heads/master from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9f5bbc2" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9f5bbc2&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7059" title="Verify that 1D point values are visited in order" class="issue-link" data-issue-key="LUCENE-7059"&gt;&lt;del&gt;LUCENE-7059&lt;/del&gt;&lt;/a&gt;: remove MultiPointValues&lt;/p&gt;</comment>
                            <comment id="15177940" author="jira-bot" created="Thu, 3 Mar 2016 08:23:14 -0700">&lt;p&gt;Commit 3a96ed9e3b20ed449818a22c78d2a229afb9be40 in lucene-solr's branch refs/heads/branch_6_0 from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3a96ed9" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3a96ed9&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7059" title="Verify that 1D point values are visited in order" class="issue-link" data-issue-key="LUCENE-7059"&gt;&lt;del&gt;LUCENE-7059&lt;/del&gt;&lt;/a&gt;: always visit 1D points in sorted order; fix tie-break but in BKDWriter; fix BKDWriter to pass on maxMBSortInHeap to the OfflineSorter too&lt;br/&gt;
(cherry picked from commit 3cbc48e)&lt;/p&gt;</comment>
                            <comment id="15177943" author="jira-bot" created="Thu, 3 Mar 2016 08:23:17 -0700">&lt;p&gt;Commit b38c2d698a70e56b2be7006f30f628452c85cfdc in lucene-solr's branch refs/heads/branch_6_0 from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b38c2d6" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b38c2d6&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7059" title="Verify that 1D point values are visited in order" class="issue-link" data-issue-key="LUCENE-7059"&gt;&lt;del&gt;LUCENE-7059&lt;/del&gt;&lt;/a&gt;: remove MultiPointValues&lt;br/&gt;
(cherry picked from commit 25cc48b)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12790814" name="LUCENE-7059.patch" size="56777" author="mikemccand" created="Tue, 1 Mar 2016 17:18:48 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 2 Mar 2016 01:17:11 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2u03j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7058] Add getters for the properties of several Query implementations</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7058</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;Hi!&lt;/p&gt;

&lt;p&gt;At Hibernate Search, we are currently working on an Elasticsearch backend (aside from the existing Lucene backend).&lt;/p&gt;

&lt;p&gt;As part of this effort, to provide a smooth migration path, we need to be able to rewrite the Lucene queries as Elasticsearch queries. We know it will be neither perfect or comprehensive but we want it to be the best possible experience.&lt;/p&gt;

&lt;p&gt;It works well in many cases but several implementations of Query don't have the necessary getters to be able to extract the information from the Query.&lt;/p&gt;

&lt;p&gt;The attached patch add getters to several implementations of Query. It would be nice if it could be applied.&lt;/p&gt;

&lt;p&gt;Any chance it could be applied to the next point release too? (probably not but I'd better ask).&lt;/p&gt;</description>
                <environment/>
        <key id="12945843">LUCENE-7058</key>
            <summary>Add getters for the properties of several Query implementations</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="romseygeek">Alan Woodward</assignee>
                                    <reporter username="gsmet">Guillaume Smet</reporter>
                        <labels>
                            <label>patch</label>
                    </labels>
                <created>Tue, 1 Mar 2016 07:52:15 -0700</created>
                <updated>Thu, 3 Mar 2016 08:11:10 -0700</updated>
                            <resolved>Thu, 3 Mar 2016 06:46:51 -0700</resolved>
                                                    <fixVersion>6.0</fixVersion>
                                    <component>core/query/scoring</component>
                        <due/>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="15175610" author="romseygeek" created="Wed, 2 Mar 2016 06:48:49 -0700">&lt;p&gt;I think this is a good idea - my luwak query analyzers could use a lot of these as well, rather than relying on reflection.&lt;/p&gt;

&lt;p&gt;The branch for the 6.0.0 release has been cut, but I think we could probably sneak this in as it's a pretty safe change.  &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nknize" class="user-hover" rel="nknize"&gt;Nicholas Knize&lt;/a&gt; you're the release manager, what do you think?&lt;/p&gt;</comment>
                            <comment id="15175717" author="gsmet" created="Wed, 2 Mar 2016 07:48:36 -0700">&lt;p&gt;Hi Alan,&lt;/p&gt;

&lt;p&gt;Yeah, it's not the most clever patch you'll ever see but I think it's useful and without risk!&lt;/p&gt;</comment>
                            <comment id="15176528" author="nknize" created="Wed, 2 Mar 2016 14:39:55 -0700">&lt;p&gt;Thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gsmet" class="user-hover" rel="gsmet"&gt;Guillaume Smet&lt;/a&gt;. Patch LGTM. It's low risk so I'm ok with this going into 6x. &lt;/p&gt;</comment>
                            <comment id="15177705" author="jira-bot" created="Thu, 3 Mar 2016 04:31:09 -0700">&lt;p&gt;Commit 682b179605bace3f2ebec8b55517463906cc249d in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=romseygeek" class="user-hover" rel="romseygeek"&gt;Alan Woodward&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=682b179" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=682b179&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7058" title="Add getters for the properties of several Query implementations" class="issue-link" data-issue-key="LUCENE-7058"&gt;&lt;del&gt;LUCENE-7058&lt;/del&gt;&lt;/a&gt;: Add getters for various Query implementations&lt;/p&gt;</comment>
                            <comment id="15177791" author="jira-bot" created="Thu, 3 Mar 2016 06:14:32 -0700">&lt;p&gt;Commit 8e18b1ea57daf040daee709d45cd4f10f28389b8 in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=romseygeek" class="user-hover" rel="romseygeek"&gt;Alan Woodward&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=8e18b1e" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=8e18b1e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7058" title="Add getters for the properties of several Query implementations" class="issue-link" data-issue-key="LUCENE-7058"&gt;&lt;del&gt;LUCENE-7058&lt;/del&gt;&lt;/a&gt;: Add getters for various Query implementations&lt;/p&gt;</comment>
                            <comment id="15177798" author="thetaphi" created="Thu, 3 Mar 2016 06:20:40 -0700">&lt;p&gt;Thanks! I was about to open an issue for FieldValueQuery. After porting some code to Lucene 5.5, this was only solveable with a MethodHandle pointing to the private field &lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/sad.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt; FieldValueFilter had getField() but not the new one.&lt;/p&gt;</comment>
                            <comment id="15177804" author="gsmet" created="Thu, 3 Mar 2016 06:26:56 -0700">&lt;p&gt;Yes, would be a good rule of thumb to always expose the properties through getters for the new Query implementations. Don't know if you have documentation somewhere for this.&lt;/p&gt;</comment>
                            <comment id="15177825" author="jira-bot" created="Thu, 3 Mar 2016 06:46:06 -0700">&lt;p&gt;Commit 437dd7a18afaac0b9caaf11fd9058e3b199d3ba1 in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=romseygeek" class="user-hover" rel="romseygeek"&gt;Alan Woodward&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=437dd7a" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=437dd7a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7058" title="Add getters for the properties of several Query implementations" class="issue-link" data-issue-key="LUCENE-7058"&gt;&lt;del&gt;LUCENE-7058&lt;/del&gt;&lt;/a&gt;: Add getters for various Query implementations&lt;/p&gt;</comment>
                            <comment id="15177827" author="romseygeek" created="Thu, 3 Mar 2016 06:46:51 -0700">&lt;p&gt;Thanks Guillaume!&lt;/p&gt;</comment>
                            <comment id="15177928" author="sanne" created="Thu, 3 Mar 2016 08:11:10 -0700">&lt;p&gt;Great, that's very handy! Thanks all for the speedy reviews and merge.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12790727" name="query-getters-v01.00.diff" size="16818" author="gsmet" created="Tue, 1 Mar 2016 07:52:56 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 2 Mar 2016 13:48:49 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    <customfieldvalue key="10120"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2tz7r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7057] cleanup some sandiness around LatLonPoint</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7057</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;A few improvements to make this less sandy: geo stuff tends to get complicated so we can try to make the simple stuff right&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;encode/decode tests became useless because all tested points were quantized&lt;/li&gt;
	&lt;li&gt;explicitly test extreme values (field creation and quantization error)&lt;/li&gt;
	&lt;li&gt;encoding could overflow integer for the maximum possible value&lt;/li&gt;
	&lt;li&gt;turn encoder checks into real checks&lt;/li&gt;
	&lt;li&gt;add assert on decode that decoded values are within bounds&lt;/li&gt;
	&lt;li&gt;test various illegal parameters&lt;/li&gt;
	&lt;li&gt;add setLocation(double, double) to change value for the field&lt;/li&gt;
	&lt;li&gt;improve javadocs&lt;/li&gt;
	&lt;li&gt;fix toString bug in distance query&lt;/li&gt;
	&lt;li&gt;make distance and polygon queries package private&lt;/li&gt;
	&lt;li&gt;add missing numDims/bytesPerDim checks to distance and polygon query&lt;/li&gt;
&lt;/ul&gt;

</description>
                <environment/>
        <key id="12945730">LUCENE-7057</key>
            <summary>cleanup some sandiness around LatLonPoint</summary>
                <type id="6" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/requirement.png">Test</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rcmuir">Robert Muir</reporter>
                        <labels>
                    </labels>
                <created>Mon, 29 Feb 2016 22:37:01 -0700</created>
                <updated>Tue, 1 Mar 2016 10:06:50 -0700</updated>
                            <resolved>Tue, 1 Mar 2016 05:05:16 -0700</resolved>
                                                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="15173258" author="rcmuir" created="Mon, 29 Feb 2016 22:37:58 -0700">&lt;p&gt;Here's a stab. precommit and tests pass.&lt;/p&gt;</comment>
                            <comment id="15173581" author="mikemccand" created="Tue, 1 Mar 2016 03:48:10 -0700">&lt;p&gt;+1, this is great, thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="15173663" author="jira-bot" created="Tue, 1 Mar 2016 05:04:56 -0700">&lt;p&gt;Commit 2264600ffe4649abb0edbe7a6882ffc82f6e918b in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=2264600" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=2264600&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7057" title="cleanup some sandiness around LatLonPoint" class="issue-link" data-issue-key="LUCENE-7057"&gt;&lt;del&gt;LUCENE-7057&lt;/del&gt;&lt;/a&gt;: cleanup some sandiness around LatLonPoint&lt;/p&gt;</comment>
                            <comment id="15174036" author="jira-bot" created="Tue, 1 Mar 2016 10:06:50 -0700">&lt;p&gt;Commit 2264600ffe4649abb0edbe7a6882ffc82f6e918b in lucene-solr's branch refs/heads/jira/&lt;a href="https://issues.apache.org/jira/browse/SOLR-445" title="Update Handlers abort with bad documents" class="issue-link" data-issue-key="SOLR-445"&gt;&lt;del&gt;SOLR-445&lt;/del&gt;&lt;/a&gt; from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=2264600" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=2264600&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7057" title="cleanup some sandiness around LatLonPoint" class="issue-link" data-issue-key="LUCENE-7057"&gt;&lt;del&gt;LUCENE-7057&lt;/del&gt;&lt;/a&gt;: cleanup some sandiness around LatLonPoint&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12790666" name="LUCENE-7057.patch" size="77499" author="rcmuir" created="Mon, 29 Feb 2016 22:37:58 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 1 Mar 2016 10:48:10 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2tyin:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7056] Separate Geo3DPoint into another package from the rest of Geo3D</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7056</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>
&lt;p&gt;The original description follows; it's greater in scope than the new title:&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;This is a proposal for the "spatial3d" module to be purely about the shape/geometry implementations it has.  In Lucene 5 that's actually all it has.  In Lucene 6 at the moment its ~76 files have 2 classes that I think should go elsewhere: Geo3DPoint and PointInGeo3DShapeQuery.  Specifically lucene-spatial-extras (which doesn't quite exist yet so lucene-spatial) would be a suitable place due to the dependency.   &lt;em&gt;Eventually&lt;/em&gt; I see this module migrating elsewhere be it on its own or a part of something else more spatial-ish.  Even if that never comes to pass, non-Lucene users who want to use this module for it's geometry annoyingly have to exclude the Lucene dependencies that are there because this module also contains these two classes.&lt;/p&gt;

&lt;p&gt;In a comment I'll suggest some specifics.&lt;/p&gt;</description>
                <environment/>
        <key id="12945539">LUCENE-7056</key>
            <summary>Separate Geo3DPoint into another package from the rest of Geo3D</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dsmiley">David Smiley</assignee>
                                    <reporter username="dsmiley">David Smiley</reporter>
                        <labels>
                    </labels>
                <created>Mon, 29 Feb 2016 10:56:34 -0700</created>
                <updated>Mon, 7 Mar 2016 21:43:32 -0700</updated>
                            <resolved>Mon, 7 Mar 2016 21:43:32 -0700</resolved>
                                                    <fixVersion>6.0</fixVersion>
                                    <component>modules/spatial3d</component>
                        <due/>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="15172249" author="dsmiley" created="Mon, 29 Feb 2016 10:58:25 -0700">&lt;p&gt;Specifics:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Rename module "spatial3d" to "spatial-geom3d" or perhaps "spatial-3d-geom" in order to emphasizes the geometry aspect&lt;/li&gt;
	&lt;li&gt;Move package org.apache.lucene.geo3d to org.apache.lucene.spatial.3d.geom.&lt;/li&gt;
	&lt;li&gt;Move Geo3DPoint and PointInGeo3DShapeQuery to the lucene-spatial-extras module to the package org.apache.lucene.spatial.3d
	&lt;ul&gt;
		&lt;li&gt;Remove dependency from lucene-spatial-geom3d to Lucene.  Ensure that the new modules Maven POM has no runtime dependencies at all.&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;Move Geo3dShape in org.apache.lucene.spatial.spatial4j to org.apache.lucene.spatial.3d to keep the 3d related stuff here together with the 2 other classes moving over.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Note Geo3D will then cease to be a package/brand in here.  Its basically our spatial 3d geometry module.&lt;/p&gt;</comment>
                            <comment id="15173576" author="mikemccand" created="Tue, 1 Mar 2016 03:46:37 -0700">&lt;p&gt;Hmm I don't think this is a good idea?&lt;/p&gt;

&lt;p&gt;Lucene shouldn't try to be in the business of "exporting spatial math libraries for others to use".  We are a search engine, and our priorities here are to make spatial indexing and searching work well.&lt;/p&gt;

&lt;p&gt;If someone wants the geo3d math implemenation, alone, they can poach/fork from us?&lt;/p&gt;

&lt;p&gt;It's the same reason why we don't e.g. invest in making FSTs easier for outsiders to use: these are internal data structures that we use to provide awesome indexing/searching.&lt;/p&gt;

&lt;p&gt;I would rather see us do the opposite: make all the geo3d math only APIs package private, and publicly expose only the &lt;tt&gt;Geo3DPoint&lt;/tt&gt; class, for indexing and searching?  This gives us the most freedom to iterate on geo3d APIs, privately.&lt;/p&gt;

&lt;p&gt;Also, it's still early for these new geo APIs, and it's not clear where they will live longish term.  E.g., we are struggling with precision/fuzzines issues in the 2D geo math (this is why only now we finally have a BKD/points distance query: see &lt;a href="https://issues.apache.org/jira/browse/LUCENE-6698" title="Add BKDDistanceQuery" class="issue-link" data-issue-key="LUCENE-6698"&gt;&lt;del&gt;LUCENE-6698&lt;/del&gt;&lt;/a&gt;, &lt;a href="https://issues.apache.org/jira/browse/LUCENE-6540" title="Add BKDPointDistanceQuery" class="issue-link" data-issue-key="LUCENE-6540"&gt;&lt;del&gt;LUCENE-6540&lt;/del&gt;&lt;/a&gt;, &lt;a href="https://issues.apache.org/jira/browse/LUCENE-7054" title="add newDistanceQuery to sandbox LatLonPoint" class="issue-link" data-issue-key="LUCENE-7054"&gt;&lt;del&gt;LUCENE-7054&lt;/del&gt;&lt;/a&gt;, etc.), so we may very well want to make the geo3d the primary spatial implementation instead, or a hybrid 2D/3D solution, which well mean more shuffling.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;In Lucene 5 that's actually all it has&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Actually 5.x also has the classes for Lucene users to index and search with geo3d, under the &lt;tt&gt;org.apache.lucene.bkdtree3d&lt;/tt&gt; package in the &lt;tt&gt;spatial3d&lt;/tt&gt; module.&lt;/p&gt;

&lt;p&gt;It's just that in 6.0 most of that is folded into core, with core support for N-dimensional points, so the minimal (2) classes were moved under the &lt;tt&gt;geo3d&lt;/tt&gt; package.&lt;/p&gt;</comment>
                            <comment id="15173679" author="rcmuir" created="Tue, 1 Mar 2016 05:25:00 -0700">&lt;blockquote&gt;
&lt;p&gt;I would rather see us do the opposite: make all the geo3d math only APIs package private, and publicly expose only the Geo3DPoint class, for indexing and searching? This gives us the most freedom to iterate on geo3d APIs, privately.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1 from someone who is just started looking at this stuff. I think we need to keep this stuff as simple as possible. Exposing a bunch of unnecessary API makes things much more difficult. We've applied a similar approach to the other point classes already.&lt;/p&gt;</comment>
                            <comment id="15173685" author="kwright@metacarta.com" created="Tue, 1 Mar 2016 05:30:56 -0700">&lt;p&gt;If you folks make everything that we need package private, we're screwed.&lt;/p&gt;

&lt;p&gt;We need to be able to construct shapes and Geo&lt;br/&gt;
We need access to the factories, distance computation implementations, PlanetModel abstraction, GeoCircle construction, and interfaces like GeoDistance, Membership, GeoArea, etc.&lt;/p&gt;

&lt;p&gt;I had envisioned that the integration would be open to the extent that FST integration is.&lt;/p&gt;
</comment>
                            <comment id="15173990" author="dsmiley" created="Tue, 1 Mar 2016 09:36:22 -0700">&lt;blockquote&gt;&lt;p&gt;+1 from someone who is just started looking at this stuff. I think we need to keep this stuff as simple as possible. Exposing a bunch of unnecessary API makes things much more difficult. We've applied a similar approach to the other point classes already.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Can you please explain how leaving it exposed (public) makes things "much more difficult"?  Or maybe you don't mean more difficult but just less "simple" by virtue of people seeing it and being confused by cognitive overload of stuff they won't need?  If it's the latter and not difficulty in something else then I think keeping purely the geometries separated and even better, out of Lucene, helps.  Keeping it package private would help too at the determent of others who want to use this, and it would foster the continuation of this very large Java package growing without organization.  One of the biggest annoyances I have with it is that each time I look in there I have to figure out which of these classes are the Lucene ones.  It's taken me an embarrassingly long time on occasion to the point that I've resorted to my IDE's dependency analyzer to tell me which are the Lucene ones.  &lt;em&gt;Even if we don't agree to the entire aims of this issue, I'd like to to consider separating these 2 classes out by package.  What do you think about that specifically?&lt;/em&gt;&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;If someone wants the geo3d math implemenation, alone, they can poach/fork from us?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Because that's a large barrier to sharing / re-use.  it's easy for you to suggest this, living in the code base that has it, but please consider an outsider.  &lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/sad.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt; Hearing this suggestion makes me sad; and the idea of making it all package private even sadder.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Lucene shouldn't try to be in the business of "exporting spatial math libraries for others to use". We are a search engine, and our priorities here are to make spatial indexing and searching work well.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Then why is Geo3d/Spatial3d even here at all?  I'd rather it not be but I'm not pushing for that today; just a compromise.  Keep it here while it suits us.  You've made the point that it's easier/faster to iterate on Geo3d here and I recognize that, so leave it here.  Some day we will look back and see it has stabilized, and I hold out some fleeting hope you might be convinced in the merits of a dependency instead of maintaining it here.  Not a dependency from lucene-core or lucene-spatial, but lucene-spatial-extras.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;It's the same reason why we don't e.g. invest in making FSTs easier for outsiders to use: these are internal data structures that we use to provide awesome indexing/searching.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I don't think these are mutually exclusive.  Of course there can be technical decisions that trade off ease of use for performance and we'd rather choose performance in many cases, but that doesn't mean it's a bad idea to expose a library that others might use.  If we were to do so, we wouldn't have to be bound by annoyances like backwards compatibility if we chose not to.  Part of the thrill I get in contributing to open-source is knowing my code is used so widely, and hearing kind remarks of its usefulness.  Don't you?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Actually 5.x also has the classes for Lucene users to index and search with geo3d, under the org.apache.lucene.bkdtree3d package in the spatial3d module.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Oh yeah; I overlooked that for some reason; weird.&lt;/p&gt;</comment>
                            <comment id="15174018" author="rcmuir" created="Tue, 1 Mar 2016 09:59:42 -0700">&lt;blockquote&gt;
&lt;p&gt;Can you please explain how leaving it exposed (public) makes things "much more difficult"? Or maybe you don't mean more difficult but just less "simple" by virtue of people seeing it and being confused by cognitive overload of stuff they won't need? &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That is part of it, but its more complex than that. To me its about making the api intuitive for both users and ourselves (e.g. tests). For example the guts of PointRangeQuery etc were all public, taking byte[][] arrays as inputs and requiring you to use correct Point classes that match and so on. Same goes for polygon etc queries in sandbox. Very error prone to use the wrong encoding when we can just make it type-safe etc instead and only expose some methods like IntPoint.newRangeQuery. And having a smaller public footprint means we can try to make it really nice and really document the contracts of the methods. I think this spatial stuff has enough trickiness that it really helps to make everything we expose well-defined, safe, fast, etc.&lt;/p&gt;

&lt;p&gt;I think it extends to this geo3d as well. I hate that the point class we provide forces users to pass around PlanetModel to every ctor and method, it makes it harder and more error-prone: instead we just make one thats wired at WGS84, and consider a separate point class that is "expert" or "custom" that works with other models. &lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;If it's the latter and not difficulty in something else then I think keeping purely the geometries separated and even better, out of Lucene, helps. Keeping it package private would help too at the determent of others who want to use this, and it would foster the continuation of this very large Java package growing without organization. One of the biggest annoyances I have with it is that each time I look in there I have to figure out which of these classes are the Lucene ones. It's taken me an embarrassingly long time on occasion to the point that I've resorted to my IDE's dependency analyzer to tell me which are the Lucene ones. Even if we don't agree to the entire aims of this issue, I'd like to to consider separating these 2 classes out by package. What do you think about that specifically?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I agree that some separation can help. I think we should move the lucene classes into a separate package at the moment to make this easier. This should not really be controversial, lets take this small step. I had the same problem as you here finding stuff.&lt;/p&gt;

&lt;p&gt;Making a separate module in my opinion is not really helpful at the problem, it just adds more indirection/confusion and more potential mistakes. I agree with Mike that we shouldn't make these kind of compromises for non-search since we are a search engine library.&lt;/p&gt;</comment>
                            <comment id="15175425" author="mikemccand" created="Wed, 2 Mar 2016 03:53:44 -0700">&lt;blockquote&gt;&lt;p&gt;I'd like to to consider separating these 2 classes out by package.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1, this seems like a good compromise, and it would match what we have&lt;br/&gt;
in 5.x (separate package holds the Lucene classes from the "pure geo3d&lt;br/&gt;
math" classes).&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;instead we just make one thats wired at WGS84, and consider a separate point class that is "expert" or "custom" that works with other models.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1 to make WGS84 the "obvious" default, and all other planet models&lt;br/&gt;
expert: it's the best earth model spatial3d has.&lt;/p&gt;

&lt;p&gt;I also wonder if we can somehow improve the naming ... 3D makes it&lt;br/&gt;
seem like you get to index altitude as well, but that's not the case&lt;br/&gt;
(you are still indexing and searching points described with 2D&lt;br/&gt;
coordinates, e.g. lat/lon).  Rather, it's using math in unprojected&lt;br/&gt;
(3D) space to more accurately compute things on the surface of the&lt;br/&gt;
idealized (ellipsoid) planet.  Anyway, these are separate issues ...&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;If you folks make everything that we need package private, we're screwed.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;OK, let's leave them public then ... but they may move around a lot in&lt;br/&gt;
the future!  They are all already &lt;tt&gt;@lucene.experimental&lt;/tt&gt;, I&lt;br/&gt;
believe.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Part of the thrill I get in contributing to open-source is knowing my code is used so widely, and hearing kind remarks of its usefulness. Don't you?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes!  But we need to stay focused in Lucene: we can't try to be&lt;br/&gt;
everything to everyone otherwise we can't achieve the one job we do&lt;br/&gt;
have (awesome indexing and searching) which is already hard enough by&lt;br/&gt;
itself &lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/wink.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt;&lt;/p&gt;</comment>
                            <comment id="15175658" author="dsmiley" created="Wed, 2 Mar 2016 07:26:41 -0700">&lt;p&gt;So gents where does this leave us in terms of specific package naming to separate them?  I made a recommendation; do you like it?&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;org.apache.lucene.spatial.3d    gets the 2 Lucene classes.&lt;/li&gt;
	&lt;li&gt;org.apache.lucene.spatial.3d.geom    (most of the current code goes here; it implements the geometries)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The aspects of this I like the most are that it has "spatial" as an intermediate package (it's spatial after all; no denying that), and that it uses "geom" short for geometry for the computational geometry code.  I don't particularly like "3d" but I have no better ideas right now.  Perhaps "geo3d" to be consistent with the original (&amp;amp; current) branding?&lt;/p&gt;

&lt;p&gt;So just to be clear, Mike &amp;amp; Rob feel that keeping the 2 Lucene dependent classes here is better than separating them into different modules?  I don't agree but so be it.&lt;/p&gt;</comment>
                            <comment id="15175685" author="dsmiley" created="Wed, 2 Mar 2016 07:40:21 -0700">&lt;p&gt;I meant to add that I understand many of the points you guys made... yet I don't see how separating the 2 classes from the module is detrimental to anything.  Except perhaps &lt;b&gt;maybe&lt;/b&gt; someone might first look in a geom only module and not find the 2 Lucene classes they were looking for if that's what they are actually looking for.  Putting "geom" in the module name would help with that.&lt;/p&gt;</comment>
                            <comment id="15177153" author="rcmuir" created="Wed, 2 Mar 2016 21:44:36 -0700">&lt;blockquote&gt;
&lt;p&gt;So gents where does this leave us in terms of specific package naming to separate them? I made a recommendation; do you like it?&lt;/p&gt;

&lt;p&gt;    org.apache.lucene.spatial.3d gets the 2 Lucene classes.&lt;br/&gt;
    org.apache.lucene.spatial.3d.geom (most of the current code goes here; it implements the geometries)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Well i don't like this since &lt;tt&gt;3d&lt;/tt&gt; is not a valid identifier in a java package.&lt;/p&gt;

&lt;p&gt;Personally i would think it should be named &lt;tt&gt;org.apache.lucene.spatial3d&lt;/tt&gt; and &lt;tt&gt;org.apache.lucene.spatial3d.geom&lt;/tt&gt;. Only because &lt;tt&gt;spatial3d&lt;/tt&gt; is the module's name, and this formula seems to be the only/easiest way to scope/organize packages in our modules to prevent problems? Nearly all of our modules are this way more or less, with the exception of &lt;tt&gt;misc&lt;/tt&gt; and &lt;tt&gt;sandbox&lt;/tt&gt; which reuse packages like &lt;tt&gt;org.apache.lucene.index&lt;/tt&gt; that really belong to &lt;tt&gt;core&lt;/tt&gt;. I think we should clean this stuff up for java 9 &lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/smile.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt;&lt;/p&gt;

&lt;p&gt;As far as the additional module, i still don't personally agree with that, but don't you think if we want to do that we still have to fix the java packages? So basically I'm saying either way, we want to not have all of spatial3d/geo3d piled in one package, so lets just start with that?&lt;/p&gt;</comment>
                            <comment id="15177188" author="nknize" created="Wed, 2 Mar 2016 22:12:36 -0700">&lt;blockquote&gt;&lt;p&gt;we want to not have all of spatial3d/geo3d piled in one package, so lets just start with that?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1 This would be a wonderful improvement. &lt;/p&gt;

&lt;p&gt;I'm also not a fan of the name *3d. It causes confusion that this package handles altitude. Since its dependency free I still think it makes most sense to refactor it to the spatial module under a geometry package and just have the spatial and spatial-extras modules. Having a third just for a geometry model doesn't make sense to me. &lt;/p&gt;

&lt;p&gt;Of course, longer term, we should simplify the geom portion of the Geo API so the users don't care what the underlying geometry model is. That should be dictated by chosen datum/projection once we have support in place. &lt;/p&gt;</comment>
                            <comment id="15177224" author="rcmuir" created="Wed, 2 Mar 2016 22:36:39 -0700">&lt;blockquote&gt;
&lt;p&gt;I'm also not a fan of the name *3d. It causes confusion that this package handles altitude.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="15179430" author="dsmiley" created="Thu, 3 Mar 2016 23:34:02 -0700">&lt;blockquote&gt;&lt;p&gt;I'm also not a fan of the name *3d. It causes confusion that this package handles altitude.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I agree as well but I'm at a loss to come up with a better name.  Any suggestions?  sphere-geom?  Although it does ellipsoid too.  At least "Geo3d" was the contribution name and current package name; and I've presented it under that name at a conference &amp;amp; meetup.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Since its dependency free I still think it makes most sense to refactor it to the spatial module under a geometry package and just have the spatial and spatial-extras modules. Having a third just for a geometry model doesn't make sense to me.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I realize my view may be unpopular but in my view, this module is &lt;em&gt;itself&lt;/em&gt; a dependency, albeit a special one we have control over to modify as we please for our convenience.&lt;/p&gt;</comment>
                            <comment id="15179705" author="mikemccand" created="Fri, 4 Mar 2016 03:37:50 -0700">&lt;blockquote&gt;&lt;p&gt;Since its dependency free I still think it makes most sense to refactor it to the spatial module under a geometry package and just have the spatial and spatial-extras modules. Having a third just for a geometry model doesn't make sense to me.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I'm also not a fan of the name *3d. It causes confusion that this package handles altitude.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;I feel the "3d-ness" is an implementation detail about how this package does very accurate spatial math, vs the 2d math in projected space which seems to be hard to get right (troubles we've had with the 2D points-based distance query).&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Personally i would think it should be named org.apache.lucene.spatial3d and org.apache.lucene.spatial3d.geom.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;So the user would use &lt;tt&gt;o.a.l.spatial3d.Geo3DPoint&lt;/tt&gt; to do indexing and create queries, and then the &lt;tt&gt;geom&lt;/tt&gt; sub-package has all the under-the-hood math.&lt;/p&gt;</comment>
                            <comment id="15179976" author="dsmiley" created="Fri, 4 Mar 2016 07:55:49 -0700">&lt;p&gt;Ok I will create a patch with the packages  org.apache.lucene.spatial3d and org.apache.lucene.spatial3d.geom&lt;/p&gt;</comment>
                            <comment id="15180117" author="dsmiley" created="Fri, 4 Mar 2016 09:38:53 -0700">&lt;p&gt;Here's the patch.  Aside from letting my IDE do all the work, I also updated the package-info.java for geom, added a new package-info.java, and updated the overview.html a little.  ant precommit passes, and I have the tests running now which I assume will be fine.&lt;/p&gt;</comment>
                            <comment id="15180127" author="rcmuir" created="Fri, 4 Mar 2016 09:47:10 -0700">&lt;p&gt;patch looks good to me at a glance&lt;/p&gt;</comment>
                            <comment id="15183299" author="dsmiley" created="Mon, 7 Mar 2016 10:23:06 -0700">&lt;p&gt;I've updated the patch since there were conflicts due to &lt;a href="https://issues.apache.org/jira/browse/LUCENE-7072" title="Geo3dPointField should always use WGS84 planet model" class="issue-link" data-issue-key="LUCENE-7072"&gt;&lt;del&gt;LUCENE-7072&lt;/del&gt;&lt;/a&gt;.  I also noticed GeoPointTest in lucene-spatial-extras that should be moved to the other tests in spatial3d simply by removing a trivial reference to Spatial4j's DistanceUtils so I did that.&lt;/p&gt;

&lt;p&gt;FYI contrary to my claim in a comment or two ago, the Geo3d brand/name whatever lives on as there's Geo3dPoint, Geo3dShape and some misc utilities starting with that prefix.&lt;/p&gt;

&lt;p&gt;I'll commit this tonight as I think we have agreement here, but if I get a +1 I may do it sooner.&lt;/p&gt;</comment>
                            <comment id="15183335" author="nknize" created="Mon, 7 Mar 2016 10:42:38 -0700">&lt;p&gt;+1 for new patch&lt;/p&gt;</comment>
                            <comment id="15183386" author="mikemccand" created="Mon, 7 Mar 2016 11:17:19 -0700">&lt;blockquote&gt;&lt;p&gt;the Geo3d brand/name whatever lives on&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Do you have an alternative?  I would love to rename the public Lucene index/search APIs here to something that doesn't imply altitude is supported ...&lt;/p&gt;</comment>
                            <comment id="15183399" author="kwright@metacarta.com" created="Mon, 7 Mar 2016 11:24:00 -0700">&lt;p&gt;FWIW, I wrestled with naming for quite a long time but could find nothing better to distinguish the 2d world from the 3d one. And there may well be an attempt to add altitude to geo3d someday as well, which would confuse everyone to no end.&lt;/p&gt;

&lt;p&gt;The best I could come up with used map projection, e.g. 2D = "cartesian" and 3D = "spherical".  But "spherical" is also misleading since ellipsoids are described too. Argh. &lt;/p&gt;</comment>
                            <comment id="15183414" author="dsmiley" created="Mon, 7 Mar 2016 11:31:13 -0700">&lt;p&gt;I think if we can't think of a better name than Geo3D, we should embrace it despite its imperfect name.  I have no better alternatives... other than including "geom" in some way (e.g. a package) to emphasize the geometry portion to distinguish the geometries/math from Lucene Query/Field integration.&lt;/p&gt;</comment>
                            <comment id="15183477" author="mikemccand" created="Mon, 7 Mar 2016 12:07:47 -0700">&lt;p&gt;Naming is the hardest part &lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/wink.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt;  But I think that should be moot in this case, because I think geo3d shouldn't ever be seen by users: it's a low level geo math implementation detail.&lt;/p&gt;

&lt;p&gt;Lucene's dimensional point values (new in 6.0.0) are agnostic to whatever "user space math" is used at search time to guide the intersection, and so we should pick, in the spatial module, whatever math 1) gives the right results (no fuzziness in the tests!) and 2) has good performance with no adversaries, and give that to our users as the "spatial" indexing and searching implementation.&lt;/p&gt;

&lt;p&gt;The math in projected 2D space seems fraught with accuracy issues that after much iterating won't go away, e.g. see the struggles in &lt;a href="https://issues.apache.org/jira/browse/LUCENE-6698" title="Add BKDDistanceQuery" class="issue-link" data-issue-key="LUCENE-6698"&gt;&lt;del&gt;LUCENE-6698&lt;/del&gt;&lt;/a&gt;, &lt;a href="https://issues.apache.org/jira/browse/LUCENE-6540" title="Add BKDPointDistanceQuery" class="issue-link" data-issue-key="LUCENE-6540"&gt;&lt;del&gt;LUCENE-6540&lt;/del&gt;&lt;/a&gt;, &lt;a href="https://issues.apache.org/jira/browse/LUCENE-7054" title="add newDistanceQuery to sandbox LatLonPoint" class="issue-link" data-issue-key="LUCENE-7054"&gt;&lt;del&gt;LUCENE-7054&lt;/del&gt;&lt;/a&gt;.  Only that last issue (&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7054" title="add newDistanceQuery to sandbox LatLonPoint" class="issue-link" data-issue-key="LUCENE-7054"&gt;&lt;del&gt;LUCENE-7054&lt;/del&gt;&lt;/a&gt;) finally succeeded in adding a points based distance query that can pass its test that don't allow for any "fuzz", except for quantization error, and only then by doing the most limited of geo 2D math (so limited this query could easily be promoted to core), but likely leaving a lot of search performance on the table.  Even so, it seems (based on the London, UK bench) to have similar performance to the legacy (postings based) &lt;tt&gt;GeoPointDistanceQuery&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;I tested the corresponding geo3d distance query (as best I could so far) and it has nearly 2X the performance as our geo2d solution from &lt;a href="https://issues.apache.org/jira/browse/LUCENE-7054" title="add newDistanceQuery to sandbox LatLonPoint" class="issue-link" data-issue-key="LUCENE-7054"&gt;&lt;del&gt;LUCENE-7054&lt;/del&gt;&lt;/a&gt;, so unless we can fix the geo2d math to be an "admissible" optimization for Lucene's points, I think we should plan to make geo3d our default spatial implementation going forwards, so that users index a &lt;tt&gt;LatLonPointField&lt;/tt&gt; and under the hood it's using the accurate, and fast, geo3d math.&lt;/p&gt;</comment>
                            <comment id="15183560" author="kwright@metacarta.com" created="Mon, 7 Mar 2016 12:47:35 -0700">&lt;p&gt;Would there be a difference in index space requirements?&lt;/p&gt;</comment>
                            <comment id="15183565" author="rcmuir" created="Mon, 7 Mar 2016 12:50:01 -0700">&lt;p&gt;+1, this is all implementation detail. That's why i like the package-private idea as well (i know it was not a popular idea here).&lt;/p&gt;

&lt;p&gt;calling this stuff spatial3D or geo3D causes infinite amount of confusion.&lt;/p&gt;

&lt;p&gt;The user does not need to know more than &lt;tt&gt;new LatLonPoint(lat, lon)&lt;/tt&gt;, &lt;tt&gt;LatLonPointField.newDistanceQuery&lt;/tt&gt;, &lt;tt&gt;LatLonPointField.newPolygonQuery&lt;/tt&gt;, &lt;tt&gt;LatLonPointField.nearestNeighbor&lt;/tt&gt;, etc. &lt;/p&gt;

&lt;p&gt;I just had another conversation with someone today who had the same confusion as me with geo3d. I had to say "wait, stop everything, geo3d does not do altitude" and then explain what its doing.&lt;/p&gt;</comment>
                            <comment id="15183574" author="rcmuir" created="Mon, 7 Mar 2016 12:53:47 -0700">&lt;p&gt;Karl: that is also a good point. If the 2D field in sandbox is really not better in any way, e.g. if the 3D one is twice as fast, even if its e.g. 50% bigger, i think we should just ditch the 2D stuff. Why offer a slower implementation?&lt;/p&gt;

&lt;p&gt;Of course we should try to consolidate testing and all that stuff. And maybe its ok for the 2D to live in the sandbox for a little bit, maybe someone can optimize the 2D speed to be more competitive, I don't know.&lt;/p&gt;</comment>
                            <comment id="15183576" author="mikemccand" created="Mon, 7 Mar 2016 12:54:54 -0700">&lt;p&gt;Yeah ... but I think they are all in the ballpark: geo2d index is ~630M, the geo3d index is ~800M, and the legacy GeoPoint (postings based) index is ~772 MB (on the London, UK bechmark).&lt;/p&gt;

&lt;p&gt;I think query-time tradeoffs (~2X faster, more accurate for distance query) really should drive the decision of what we present as Lucene's spatial implementation.&lt;/p&gt;</comment>
                            <comment id="15183588" author="kwright@metacarta.com" created="Mon, 7 Mar 2016 12:58:32 -0700">&lt;blockquote&gt;&lt;p&gt;The user does not need to know more than new LatLonPoint(lat, lon), LatLonPointField.newDistanceQuery, LatLonPointField.newPolygonQuery, LatLonPointField.nearestNeighbor, etc.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;There is more than one strategy you can use with geo3D for filtering results.  You can certainly use the BKD query but there are other ways; you may also want to &lt;b&gt;score&lt;/b&gt; results using distance functions in geo3d itself.  Making things package-private would prevent that unless such functionality made its way into some higher-level API.&lt;/p&gt;</comment>
                            <comment id="15183594" author="mikemccand" created="Mon, 7 Mar 2016 13:01:47 -0700">&lt;blockquote&gt;&lt;p&gt;+1, this is all implementation detail. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;We don't tell our users about "geo2d", give talks about it, feel compelled to stick to it, fight over how to rename it &lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/wink.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt;  Because that 2D math is also an implementation detail.&lt;/p&gt;</comment>
                            <comment id="15183598" author="dsmiley" created="Mon, 7 Mar 2016 13:02:15 -0700">&lt;p&gt;I think the notion of a default spatial implementation is flawed.  Perhaps "preferred" if it handles many use-cases.  Geo3d is cool 'n all, but for anyone with polygonal data/queries, it is most likely that the data was authored in a specific projected (2D) space (e.g. web-mercator), and as-such it would be invalid to use a a spherical/ellipsoidal model.  Another factor Karl just mentioned is for sorting.  If you want to sort your data, you might not want the BKD index.&lt;/p&gt;</comment>
                            <comment id="15183685" author="nknize" created="Mon, 7 Mar 2016 13:56:09 -0700">&lt;p&gt;I'm also not sure I'm comfortable making definitive performance statements based on the London test set? While its testing with a reasonable amount of data and many queries, its not exercising anything beyond a relatively small bounding area. For example, I noticed considerable performance degradation when exercising BKD w/ Geo3D/Spatial3D on global data sets (simply through beasting). This is when adversarial rectangles were created like: &lt;a href="http://imagebin.ca/v/2ZSrT1nVbIHn" class="external-link" rel="nofollow"&gt;http://imagebin.ca/v/2ZSrT1nVbIHn&lt;/a&gt; and the postings based approach actually performed better. In performance testing TermEnum updates I also noticed orders of magnitude improvements when beasting the testcases and only marginal improvements when testing with the London set. &lt;/p&gt;

&lt;p&gt;I've spent a bit of time working on adding Geo benchmarks to luceneutil. I think we can make more informed decisions about what to add/remove and which approach to use once we have decent nightly benchmarks to characterize performance. Remember, the Postings approach is not an "incorrect" or even a wholly "suboptimal" approach. Its a raster approach which lends itself well to certain use-cases. &lt;/p&gt;</comment>
                            <comment id="15183779" author="kwright@metacarta.com" created="Mon, 7 Mar 2016 14:45:22 -0700">&lt;p&gt;Any approach one picks will degrade if given a sufficient number of pathological cases; it's usually not a good idea to optimize for that.  A worldwide selection of points are typically quite localized on the globe &amp;#8211; if they are confined to land areas &amp;#8211; and search shapes are typically not bizarre polygons or rectangles but usually pretty regular ones.&lt;/p&gt;

&lt;p&gt;But it probably makes sense to evaluate using a better global test set, and not an artificial one.&lt;/p&gt;</comment>
                            <comment id="15183783" author="kwright@metacarta.com" created="Mon, 7 Mar 2016 14:47:22 -0700">&lt;p&gt;Right, I have no doubt that there exists a need for drawing straight boundary lines on a mercator projection, even if this corresponds to curves on the real world, because that's what some people need to be compatible with.&lt;/p&gt;</comment>
                            <comment id="15183827" author="mikemccand" created="Mon, 7 Mar 2016 15:10:00 -0700">&lt;blockquote&gt;&lt;p&gt;But it probably makes sense to evaluate using a better global test set, and not an artificial one.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1 for real data, not synthetic data.  I think when one tests on synthetic data, one draws synthetic conclusions.&lt;/p&gt;

&lt;p&gt;The London UK test I've been running (all sources in luceneutil) is 2.5% of ALL the world's OpenStreetMap (PlanetOSM) points, plus 100% of the points contained within the bbox around London, UK, so it really is a global test, just with a sampling of the world's points.  It's ~61M total points.&lt;/p&gt;

&lt;p&gt;But I agree that 2.5% sampling is not realistic ... I'll download the latest OSM export (48 GB .bz2!) and try to index all points, and test on larger shapes across the globe.&lt;/p&gt;

&lt;p&gt;Does anyone have any pointers for other large realistic geospatial corpora?  Geonames is smallish (~8.6 M docs in my snapshot, though that's ~2 years ago now).&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I've spent a bit of time working on adding Geo benchmarks to luceneutil. I think we can make more informed decisions about what to add/remove and which approach to use once we have decent nightly benchmarks to characterize performance.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1 to get these benchmarks folded into our nightly benchmark (so we can catch/measure regressions/improvements over time), and to make it easier for anyone to run them.&lt;/p&gt;</comment>
                            <comment id="15183835" author="dsmiley" created="Mon, 7 Mar 2016 15:14:19 -0700">&lt;p&gt;Where do we stand with my patch?  I think it's surely an improvement but are there changes yet we shall make?  I can hold off but I'm hoping there's no commits to spatial3d/Geo3d in the interim as it's a pain to redo.&lt;/p&gt;</comment>
                            <comment id="15183840" author="mikemccand" created="Mon, 7 Mar 2016 15:18:20 -0700">&lt;p&gt;+1 to your patch &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley" class="user-hover" rel="dsmiley"&gt;David Smiley&lt;/a&gt;, it's an improvement.&lt;/p&gt;

&lt;p&gt;Sorry for causing conflicts, and sorry for having this big sudden discussion about whether Lucene should adopt geo2d or geo3d as its preferred spatial math under-the-hood, here &lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/wink.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt;&lt;/p&gt;

&lt;p&gt;These ideas can be explored in later issues; I don't think we'll sort it out in time for 6.0.0, which is fine (these are all experimental APIs).&lt;/p&gt;</comment>
                            <comment id="15183950" author="nknize" created="Mon, 7 Mar 2016 16:06:43 -0700">&lt;blockquote&gt;&lt;p&gt;search shapes are typically not bizarre polygons or rectangles&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I guess I should have clarified. The adversarial rectangles are created from internal BKD nodes during split, they are not bizarre rectangles one would create from a query. They are also not an abnormal corner case. Adversarial rectangles can/will be created unless you know your data in advance.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;A worldwide selection of points are typically quite localized on the globe&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1. localized clusters. Unless separate indexes are created for different regions - a viable recommendation if we find global data sets to drastically degrade search performance.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;But it probably makes sense to evaluate using a better global test set.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Any good spatial indexing benchmark (as seen in most publications) should test with real data, but also not ignore the sparse random data sets just for characterizing performance for randomly distributed spatial data applications (regardless of the popularity of this type of use case).&lt;/p&gt;</comment>
                            <comment id="15183965" author="kwright@metacarta.com" created="Mon, 7 Mar 2016 16:14:41 -0700">&lt;blockquote&gt;&lt;p&gt;The adversarial rectangles are created from internal BKD nodes during split, they are not bizarre rectangles one would create from a query.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;With geo3d, though, the splits are rectangular solids in (x,y,z), not rectangles on the sphere surface.  That's kind of why I was confused by your graphic, which looked nothing like a geo3d BKD split that I know of. One area looked like a circle, and the other was the pointy tip of a very long polygon &lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/help_16.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt;. So either the shape was a circle and the split made no sense, or the split was a circle and the shape was a bizarre one?&lt;/p&gt;</comment>
                            <comment id="15184048" author="nknize" created="Mon, 7 Mar 2016 16:52:36 -0700">&lt;p&gt;To keep from further hijacking &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley" class="user-hover" rel="dsmiley"&gt;David Smiley&lt;/a&gt; thread I'll open a separate issue to further investigate this issue. I actually think this can be solved during segment merge where we have a broader view of the data in bulk as opposed to inserting point by point. It gives a chance to build a more efficient KD tree. &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;not rectangles on the surface sphere&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That rectangle was from a higher level (I think it was level 2 or 3) internal BKD node while testing LatLonPoint during a distance query. Since the split happens along one of the lat lon dimensions those values were taken from the lat lon rages of the internal node. Any query (bbox, distance, poly) that intersects that long rectangle recurses into the rectangle. This node was visited quite often&lt;/p&gt;
</comment>
                            <comment id="15184146" author="jira-bot" created="Mon, 7 Mar 2016 18:15:03 -0700">&lt;p&gt;Commit f7f81c3284cb855136c4e468b6e1f73cf58ced4c in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley" class="user-hover" rel="dsmiley"&gt;David Smiley&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f7f81c3" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f7f81c3&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7056" title="Separate Geo3DPoint into another package from the rest of Geo3D" class="issue-link" data-issue-key="LUCENE-7056"&gt;&lt;del&gt;LUCENE-7056&lt;/del&gt;&lt;/a&gt;: Geo3D package re-org&lt;/p&gt;</comment>
                            <comment id="15184156" author="jira-bot" created="Mon, 7 Mar 2016 18:19:44 -0700">&lt;p&gt;Commit 0a1951bef2ca7e18993ca167ff0c20f2e13e3c84 in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley" class="user-hover" rel="dsmiley"&gt;David Smiley&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=0a1951b" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=0a1951b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7056" title="Separate Geo3DPoint into another package from the rest of Geo3D" class="issue-link" data-issue-key="LUCENE-7056"&gt;&lt;del&gt;LUCENE-7056&lt;/del&gt;&lt;/a&gt;: Geo3D package re-org&lt;br/&gt;
(cherry picked from commit 3a31a8c)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12840606">LUCENE-6607</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12791784" name="LUCENE_7056__split_spatial3d_package.patch" size="70951" author="dsmiley" created="Mon, 7 Mar 2016 10:23:06 -0700"/>
                            <attachment id="12791493" name="LUCENE_7056__split_spatial3d_package.patch" size="67884" author="dsmiley" created="Fri, 4 Mar 2016 09:38:53 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 1 Mar 2016 10:46:37 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2txcv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7054] add newDistanceQuery to sandbox LatLonPoint</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7054</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;This field is currently missing a distance radius query: this is a common use case.&lt;/p&gt;</description>
                <environment/>
        <key id="12945337">LUCENE-7054</key>
            <summary>add newDistanceQuery to sandbox LatLonPoint</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rcmuir">Robert Muir</reporter>
                        <labels>
                    </labels>
                <created>Sun, 28 Feb 2016 21:58:30 -0700</created>
                <updated>Mon, 29 Feb 2016 05:39:21 -0700</updated>
                            <resolved>Mon, 29 Feb 2016 05:39:21 -0700</resolved>
                                                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="15171414" author="rcmuir" created="Sun, 28 Feb 2016 22:05:36 -0700">&lt;p&gt;initial patch.&lt;/p&gt;

&lt;p&gt;I hooked in the new query into the existing test infra (TestLatLonPointQueries/BaseGeoPointTestCase) but also added a conceptually simpler random test to TestLatLonPoint that doesn't have any leniency/tolerance/deltas. &lt;/p&gt;

&lt;p&gt;I tried to keep it simple and free of things like floating point error, to keep testing exact.&lt;/p&gt;

&lt;p&gt;We don't do any fancy geometric stuff like computing whether circles intersect with rectangles (there are utility methods here, but i did not have such luck with this approach). &lt;/p&gt;

&lt;p&gt;tests seem to pass under beasting... no benchmarking whatsoever though.&lt;/p&gt;</comment>
                            <comment id="15171679" author="mikemccand" created="Mon, 29 Feb 2016 03:03:07 -0700">&lt;p&gt;+1, I love how simple this is &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;!&lt;/p&gt;

&lt;p&gt;I agree we should start with something that's correct, and then attempt to optimize (smarter geo math to test the BKD cells) later only if those optimizations don't break the query.&lt;/p&gt;</comment>
                            <comment id="15171789" author="rcmuir" created="Mon, 29 Feb 2016 04:58:13 -0700">&lt;p&gt;OK, I'll push it (its sandbox anyway), but disable the TestLatLonPointQueries/BaseGeoPointTestCase based testing.&lt;/p&gt;

&lt;p&gt;I beasted this heavily and it will fail, but i dont' want to debug fuzz/tolerance based testing, thats too hard...&lt;/p&gt;</comment>
                            <comment id="15171816" author="jira-bot" created="Mon, 29 Feb 2016 05:38:53 -0700">&lt;p&gt;Commit 7385d3a4a1a9039f70acfae64ed763f76a818085 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=7385d3a" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=7385d3a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7054" title="add newDistanceQuery to sandbox LatLonPoint" class="issue-link" data-issue-key="LUCENE-7054"&gt;&lt;del&gt;LUCENE-7054&lt;/del&gt;&lt;/a&gt;: add newDistanceQuery to sandbox LatLonPoint&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12790404" name="LUCENE-7054.patch" size="16745" author="rcmuir" created="Sun, 28 Feb 2016 22:05:36 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 29 Feb 2016 10:03:07 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2tw3z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7053] Remove deprecated BytesRef#getUTF8SortedAsUTF16Comparator(); remove natural comparator in favour of Java 8 one</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7053</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;Followup from &lt;a href="https://issues.apache.org/jira/browse/LUCENE-7052" title="BytesRefHash.sort should always sort in unicode code point order" class="issue-link" data-issue-key="LUCENE-7052"&gt;&lt;del&gt;LUCENE-7052&lt;/del&gt;&lt;/a&gt;: This removes the legacy, deprecated getUTF8SortedAsUTF16Comparator() in the BytesRef class. I know originally we added the different comparators to be able to allow the index term dict to be sorted in different order. This never proved to be useful, as many Lucene queries rely on the default order. The only codec that used another byte order internally was the Lucene 3 one (but it used the unicode spaghetti algorithm to reorder its term enums at runtime).&lt;/p&gt;

&lt;p&gt;This patch also removes the BytesRef-Comparator completely and just implements compareTo. So all code can rely on natural ordering.&lt;/p&gt;

&lt;p&gt;This patch also cleans up other usages of natural order comparators, e.g. in ArrayUtil, because Java 8 natively provides a comparator.&lt;/p&gt;</description>
                <environment/>
        <key id="12945265">LUCENE-7053</key>
            <summary>Remove deprecated BytesRef#getUTF8SortedAsUTF16Comparator(); remove natural comparator in favour of Java 8 one</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thetaphi">Uwe Schindler</assignee>
                                    <reporter username="thetaphi">Uwe Schindler</reporter>
                        <labels>
                    </labels>
                <created>Sun, 28 Feb 2016 03:59:37 -0700</created>
                <updated>Tue, 1 Mar 2016 10:37:15 -0700</updated>
                            <resolved>Mon, 29 Feb 2016 01:26:31 -0700</resolved>
                                                    <fixVersion>master</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>core/other</component>
                        <due/>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="15171005" author="thetaphi" created="Sun, 28 Feb 2016 04:00:37 -0700">&lt;p&gt;Patch (copy from &lt;a href="https://issues.apache.org/jira/browse/LUCENE-7052" title="BytesRefHash.sort should always sort in unicode code point order" class="issue-link" data-issue-key="LUCENE-7052"&gt;&lt;del&gt;LUCENE-7052&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;</comment>
                            <comment id="15171008" author="thetaphi" created="Sun, 28 Feb 2016 04:06:52 -0700">&lt;p&gt;There is a bit code duplication in both tests (sorting Strings in code point order), should we maybe move the new comparator to TestUtil?&lt;/p&gt;</comment>
                            <comment id="15171010" author="mikemccand" created="Sun, 28 Feb 2016 04:09:14 -0700">&lt;p&gt;+1 to the patch.&lt;/p&gt;

&lt;p&gt;You can also fix &lt;tt&gt;TestUnicodeUtil&lt;/tt&gt;'s custom String -&amp;gt; int[] code points logic maybe?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;There is a bit code duplication in both tests (sorting Strings in code point order), should we maybe move the new comparator to TestUtil?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;We can take this further, e.g. I grep'd for places calling &lt;tt&gt;BytesRef.getUTF8SortedAsUnicodeComparator&lt;/tt&gt; and it turns up silliness in &lt;tt&gt;BlockTermsReader&lt;/tt&gt; that should just be invoking &lt;tt&gt;BytesRef.compareTo&lt;/tt&gt; directly instead, I think?&lt;/p&gt;</comment>
                            <comment id="15171012" author="thetaphi" created="Sun, 28 Feb 2016 04:18:40 -0700">&lt;blockquote&gt;&lt;p&gt;We can take this further, e.g. I grep'd for places calling BytesRef.getUTF8SortedAsUnicodeComparator and it turns up silliness in BlockTermsReader that should just be invoking BytesRef.compareTo directly instead, I think?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yeah. As said, we may not remove the comparator completely, but we should only use it at places where we can't use &lt;tt&gt;Comparable&amp;lt;BytesRef&amp;gt;&lt;/tt&gt; interface that BytesRef implements.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;You can also fix TestUnicodeUtil's custom String -&amp;gt; int[] code points logic maybe?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Will check this, too. I am currently investigating it Java 8 already has some Comparator interface somewhere ready-to use. But does not look like that.&lt;/p&gt;</comment>
                            <comment id="15171016" author="thetaphi" created="Sun, 28 Feb 2016 05:02:09 -0700">&lt;p&gt;New patch with Mike's suggestions. I added a comparator static final constant to TestUtil with a warning that it is not as effective as it could be (&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dawid.weiss" class="user-hover" rel="dawid.weiss"&gt;Dawid Weiss&lt;/a&gt; comment on &lt;a href="https://issues.apache.org/jira/browse/LUCENE-7052" title="BytesRefHash.sort should always sort in unicode code point order" class="issue-link" data-issue-key="LUCENE-7052"&gt;&lt;del&gt;LUCENE-7052&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;I did not yet look into further cleaning up and removing comparator usage.&lt;/p&gt;</comment>
                            <comment id="15171021" author="thetaphi" created="Sun, 28 Feb 2016 05:19:03 -0700">&lt;p&gt;New patch:&lt;/p&gt;
&lt;ul class="alternate" type="square"&gt;
	&lt;li&gt;I removed some usage of comparator and replaced by &lt;tt&gt;compareTo&lt;/tt&gt; at many places.&lt;/li&gt;
	&lt;li&gt;Moved the code of the comparator to &lt;tt&gt;compareTo&lt;/tt&gt;.&lt;/li&gt;
	&lt;li&gt;The comparator isstelf is now a static final constant &lt;tt&gt;BytesRef.COMPARATOR&lt;/tt&gt; (the name was horrible). It is documented to just order by bytes. In fact its just a method reference to the &lt;tt&gt;compareTo&lt;/tt&gt; method!&lt;/li&gt;
	&lt;li&gt;I also removed the chicken-egg statement in FuzzyQuery.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15171027" author="thetaphi" created="Sun, 28 Feb 2016 05:35:56 -0700">&lt;p&gt;As we implemented &lt;tt&gt;compareTo&lt;/tt&gt; we could remove the comparator completely. One could use &lt;tt&gt;Comparator.naturalOrder()&lt;/tt&gt; (see &lt;a href="https://docs.oracle.com/javase/8/docs/api/java/util/Comparator.html#naturalOrder--" class="external-link" rel="nofollow"&gt;https://docs.oracle.com/javase/8/docs/api/java/util/Comparator.html#naturalOrder--&lt;/a&gt;) instead (naturalOrder is defined to use &lt;tt&gt;compareTo&lt;/tt&gt;. At places like Collections.sort() we could remove the comparator argument completely.&lt;/p&gt;

&lt;p&gt;Any comments on this?&lt;/p&gt;</comment>
                            <comment id="15171058" author="rcmuir" created="Sun, 28 Feb 2016 07:39:23 -0700">&lt;p&gt;Yes, please, and remove BytesRef.COMPARATOR which just duplicates that: naturalOrder() already returns a singleton.&lt;/p&gt;

&lt;p&gt;Also in cases like TreeSet creation in the join tests, we should just make &lt;tt&gt;new TreeSet&amp;lt;&amp;gt;()&lt;/tt&gt; and not pass any comparator in at all.&lt;/p&gt;</comment>
                            <comment id="15171075" author="thetaphi" created="Sun, 28 Feb 2016 09:01:33 -0700">&lt;p&gt;Here is the comparator cleanup. I removed usage of the BytesRef comparator completely (where possible). Otherwise I used &lt;tt&gt;Comparator.naturalOrder()&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;I also removed the &lt;tt&gt;ArrayUtil.naturalComparator()&lt;/tt&gt; method, because it is obsolete with Java 8.&lt;/p&gt;</comment>
                            <comment id="15171087" author="thetaphi" created="Sun, 28 Feb 2016 09:18:04 -0700">&lt;p&gt;All tests pass.&lt;/p&gt;</comment>
                            <comment id="15171111" author="rcmuir" created="Sun, 28 Feb 2016 10:17:08 -0700">&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="15171576" author="jira-bot" created="Mon, 29 Feb 2016 01:26:14 -0700">&lt;p&gt;Commit f48d23cd1448f20fb1b97ec986ded76a04a7075c in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi" class="user-hover" rel="thetaphi"&gt;Uwe Schindler&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f48d23c" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f48d23c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7053" title="Remove deprecated BytesRef#getUTF8SortedAsUTF16Comparator(); remove natural comparator in favour of Java 8 one" class="issue-link" data-issue-key="LUCENE-7053"&gt;&lt;del&gt;LUCENE-7053&lt;/del&gt;&lt;/a&gt;: Remove custom comparators from BytesRef class and solely use natural byte[] comparator throughout codebase. It also replaces the natural comparator in ArrayUtil by Java 8's Comparator#naturalOrder().&lt;/p&gt;</comment>
                            <comment id="15171596" author="jira-bot" created="Mon, 29 Feb 2016 01:54:34 -0700">&lt;p&gt;Commit 8ffa436f00d24cb45af49160739f71b3654349ce in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi" class="user-hover" rel="thetaphi"&gt;Uwe Schindler&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=8ffa436" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=8ffa436&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7053" title="Remove deprecated BytesRef#getUTF8SortedAsUTF16Comparator(); remove natural comparator in favour of Java 8 one" class="issue-link" data-issue-key="LUCENE-7053"&gt;&lt;del&gt;LUCENE-7053&lt;/del&gt;&lt;/a&gt;: Move comparator to better place in code; generalize to use CharSequence instead of String&lt;/p&gt;</comment>
                            <comment id="15171680" author="mikemccand" created="Mon, 29 Feb 2016 03:03:49 -0700">&lt;p&gt;Thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi" class="user-hover" rel="thetaphi"&gt;Uwe Schindler&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="15174080" author="jira-bot" created="Tue, 1 Mar 2016 10:37:15 -0700">&lt;p&gt;Commit 3c27980c4ae7777716ba74b3a0e2c70b3dd1c1d4 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi" class="user-hover" rel="thetaphi"&gt;Uwe Schindler&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3c27980" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3c27980&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7053" title="Remove deprecated BytesRef#getUTF8SortedAsUTF16Comparator(); remove natural comparator in favour of Java 8 one" class="issue-link" data-issue-key="LUCENE-7053"&gt;&lt;del&gt;LUCENE-7053&lt;/del&gt;&lt;/a&gt;: Simplify code to work around Java 8u25 compiler bug&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12945184">LUCENE-7052</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12790364" name="LUCENE-7053.patch" size="44054" author="thetaphi" created="Sun, 28 Feb 2016 09:01:33 -0700"/>
                            <attachment id="12790355" name="LUCENE-7053.patch" size="29693" author="thetaphi" created="Sun, 28 Feb 2016 05:26:20 -0700"/>
                            <attachment id="12790353" name="LUCENE-7053.patch" size="17215" author="thetaphi" created="Sun, 28 Feb 2016 05:02:09 -0700"/>
                            <attachment id="12790352" name="LUCENE-7053.patch" size="14085" author="thetaphi" created="Sun, 28 Feb 2016 04:00:37 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 28 Feb 2016 11:09:14 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2tvnz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7052] BytesRefHash.sort should always sort in unicode code point order</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7052</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;Today &lt;tt&gt;BytesRefHash.sort&lt;/tt&gt; takes a custom &lt;tt&gt;Comparator&lt;/tt&gt; but we always pass it &lt;tt&gt;BytesRef.getUTF8SortedAsUnicodeComparator()&lt;/tt&gt;.&lt;/p&gt;</description>
                <environment/>
        <key id="12945184">LUCENE-7052</key>
            <summary>BytesRefHash.sort should always sort in unicode code point order</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mikemccand">Michael McCandless</assignee>
                                    <reporter username="mikemccand">Michael McCandless</reporter>
                        <labels>
                    </labels>
                <created>Sat, 27 Feb 2016 03:33:00 -0700</created>
                <updated>Mon, 29 Feb 2016 11:56:56 -0700</updated>
                            <resolved>Sat, 27 Feb 2016 08:26:15 -0700</resolved>
                                                    <fixVersion>master</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="15170541" author="mikemccand" created="Sat, 27 Feb 2016 03:34:05 -0700">&lt;p&gt;Simple patch.&lt;/p&gt;</comment>
                            <comment id="15170558" author="rcmuir" created="Sat, 27 Feb 2016 04:31:00 -0700">&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="15170566" author="dweiss" created="Sat, 27 Feb 2016 05:11:56 -0700">&lt;p&gt;Are you for simplifying the code? Because I doubt it'll be any speed improvement.&lt;/p&gt;</comment>
                            <comment id="15170604" author="jpountz" created="Sat, 27 Feb 2016 07:39:30 -0700">&lt;p&gt;+1 for the simplification&lt;/p&gt;</comment>
                            <comment id="15170605" author="mikemccand" created="Sat, 27 Feb 2016 07:49:24 -0700">&lt;p&gt;Yeah, just shrinking the API.&lt;/p&gt;</comment>
                            <comment id="15170801" author="steve_rowe" created="Sat, 27 Feb 2016 19:17:22 -0700">&lt;p&gt;Mike, why did you add an implementation of codePoints() instead of using the CharSequence version (returning IntStream) + toArray()?  The test passes for me with this patch:&lt;/p&gt;

&lt;div class="preformatted panel" style="border-width: 1px;"&gt;&lt;div class="preformattedContent panelContent"&gt;
&lt;pre&gt;diff --git a/lucene/core/src/test/org/apache/lucene/util/TestBytesRefHash.java b/lucene/core/src/test/org/apache/lucene/util/TestBytesRefHash.java
index 50d921b..c3a58ff 100644
--- a/lucene/core/src/test/org/apache/lucene/util/TestBytesRefHash.java
+++ b/lucene/core/src/test/org/apache/lucene/util/TestBytesRefHash.java
@@ -168,15 +168,6 @@ public class TestBytesRefHash extends LuceneTestCase {
     }
   }
 
-  private static int[] codePoints(String input) {
-    int length = Character.codePointCount(input, 0, input.length());
-    int word[] = new int[length];
-    for (int i = 0, j = 0, cp = 0; i &amp;lt; input.length(); i += Character.charCount(cp)) {
-      word[j++] = cp = input.codePointAt(i);
-    }
-    return word;
-  }
-
   /**
    * Test method for
    * {@link org.apache.lucene.util.BytesRefHash#sort()}.
@@ -191,8 +182,8 @@ public class TestBytesRefHash extends LuceneTestCase {
       SortedSet&amp;lt;String&amp;gt; strings = new TreeSet&amp;lt;&amp;gt;(new Comparator&amp;lt;String&amp;gt;() {
           @Override
           public int compare(String a, String b) {
-            int[] aCodePoints = codePoints(a);
-            int[] bCodePoints = codePoints(b);
+            int[] aCodePoints = a.codePoints().toArray();
+            int[] bCodePoints = b.codePoints().toArray();
             for(int i=0;i&amp;lt;Math.min(aCodePoints.length, bCodePoints.length);i++) {
               if (aCodePoints[i] &amp;lt; bCodePoints[i]) {
                 return -1;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15170951" author="dweiss" created="Sun, 28 Feb 2016 00:46:34 -0700">&lt;p&gt;Neither is actually pretty as the treeset invokes a comparator multiple times for the same string, causing multiple identical string-int[] conversions along the way. This is test-method only though, so it doesn't matter much.&lt;/p&gt;</comment>
                            <comment id="15170991" author="thetaphi" created="Sun, 28 Feb 2016 03:33:02 -0700">&lt;p&gt;Hi Mike,&lt;br/&gt;
I know originally we added the different comparators to be able to allow the index term dict to be sorted in different order. This never prooved to be useful, as many Lucene queries rely on the default order. The only codec that used another byte order internally was the Lucene 3 one (but it used the unicode spaghetti algorithm to reorder its term enums at runtime). As this is now all gone, I'd suggest to also remove the utf8AsUtf16 comparator. Mabye remove the comparators at all and just implement BytesRef.compareTo() and use that one for sorting?&lt;/p&gt;

&lt;p&gt;I checked the code: utf8SortedAsUTF16SortOrder is only used in TSTLookup nowhere else anymore (except some test that check alternative sorts - those can be removed).&lt;/p&gt;

&lt;p&gt;As a first step I changed the BytesRef code to no longer use inner classes and instead use a lambda to define the comparators. But I'd suggest to remove at least the UTF-16 one completely and move it as private impl detail to TSTLookup (as only used there).&lt;/p&gt;

&lt;p&gt;&lt;em&gt;FYI: The lambda has no speed impact because it is called only once and internally compiles to a class file that implements Comparator. It just looks nicer than the horrible comparator classes&lt;/em&gt;&lt;/p&gt;</comment>
                            <comment id="15170992" author="thetaphi" created="Sun, 28 Feb 2016 03:37:17 -0700">&lt;p&gt;Oh this was already committed. Maybe open another issue to remove the obsolete comparator and convert to lambda.&lt;/p&gt;</comment>
                            <comment id="15170994" author="mikemccand" created="Sun, 28 Feb 2016 03:40:07 -0700">&lt;blockquote&gt;&lt;p&gt;Mike, why did you add an implementation of codePoints() instead of using the CharSequence version (returning IntStream) + toArray()? &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Oh, because I didn't even know about &lt;tt&gt;CharSequence.codePoints&lt;/tt&gt;!&lt;/p&gt;

&lt;p&gt;+1 to your patch, thanks.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Neither is actually pretty as the treeset invokes a comparator multiple times for the same string, causing multiple identical string-int[] conversions along the way. This is test-method only though, so it doesn't matter much.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It's definitely inefficient (converting to a sortable key on every comparison), but it keeps the code simple, which I think is usually the right tradeoff for a test case?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;As this is now all gone, I'd suggest to also remove the utf8AsUtf16 comparator. Mabye remove the comparators at all and just implement BytesRef.compareTo() and use that one for sorting?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1, that sounds awesome!&lt;/p&gt;</comment>
                            <comment id="15170995" author="thetaphi" created="Sun, 28 Feb 2016 03:40:43 -0700">&lt;p&gt;+1 to &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe" class="user-hover" rel="steve_rowe"&gt;Steve Rowe&lt;/a&gt; change. We are on Java 8, so use Java 8 methods.&lt;/p&gt;</comment>
                            <comment id="15170997" author="thetaphi" created="Sun, 28 Feb 2016 03:42:03 -0700">&lt;p&gt;Mike, should I open a new issue for the comparator cleanups. I have the patch almost ready?&lt;/p&gt;</comment>
                            <comment id="15170999" author="mikemccand" created="Sun, 28 Feb 2016 03:44:34 -0700">&lt;p&gt;&lt;tt&gt;TestUnicodeUtil.testUTF8toUTF32&lt;/tt&gt; (and I'm sure other places) can also cutover to &lt;tt&gt;CharSequence.codePoints&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="15171000" author="mikemccand" created="Sun, 28 Feb 2016 03:44:41 -0700">&lt;blockquote&gt;&lt;p&gt;Mike, should I open a new issue for the comparator cleanups. I have the patch almost ready?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes please!!&lt;/p&gt;</comment>
                            <comment id="15171002" author="thetaphi" created="Sun, 28 Feb 2016 03:55:52 -0700">&lt;p&gt;Hi Mike, here is a patch, moving the UTF-16 comparator away and clean up code.&lt;/p&gt;

&lt;p&gt;I also changed the TreeSet comparator to a lambda using &lt;tt&gt;CharSequence#codePoints()&lt;/tt&gt; because I hit the same in another test &lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/smile.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt;&lt;/p&gt;</comment>
                            <comment id="15171003" author="thetaphi" created="Sun, 28 Feb 2016 03:56:47 -0700">&lt;p&gt;I wil open now other issue with the attached patch. As the &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe" class="user-hover" rel="steve_rowe"&gt;Steve Rowe&lt;/a&gt; suggestion is implemented there, we can leave THIS issue closed.&lt;/p&gt;</comment>
                            <comment id="15171004" author="thetaphi" created="Sun, 28 Feb 2016 03:59:57 -0700">&lt;p&gt;New issue: &lt;a href="https://issues.apache.org/jira/browse/LUCENE-7053" title="Remove deprecated BytesRef#getUTF8SortedAsUTF16Comparator(); remove natural comparator in favour of Java 8 one" class="issue-link" data-issue-key="LUCENE-7053"&gt;&lt;del&gt;LUCENE-7053&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15172230" author="hossman" created="Mon, 29 Feb 2016 10:53:49 -0700">&lt;p&gt;I'm confused ... this issue is marked resolved, and Uwe said "Oh this was already committed." but no commits are linked to it, not does it have any subtasks.&lt;/p&gt;

&lt;p&gt;can someone clarify when/how this was resolved?&lt;/p&gt;
</comment>
                            <comment id="15172280" author="steve_rowe" created="Mon, 29 Feb 2016 11:13:59 -0700">&lt;p&gt;AFAICT Mike forgot to include the JIRA in his log message for this commit (from the email sent to commits@l.a.o):&lt;/p&gt;

&lt;div class="preformatted panel" style="border-width: 1px;"&gt;&lt;div class="preformattedContent panelContent"&gt;
&lt;pre&gt;Repository: lucene-solr
Updated Branches:
 refs/heads/master 70440bbbd -&amp;gt; 126ac9a5f

BytesRefHash.sort always sorts in unicode order

Project: http://git-wip-us.apache.org/repos/asf/lucene-solr/repo
Commit: http://git-wip-us.apache.org/repos/asf/lucene-solr/commit/126ac9a5
Tree: http://git-wip-us.apache.org/repos/asf/lucene-solr/tree/126ac9a5
Diff: http://git-wip-us.apache.org/repos/asf/lucene-solr/diff/126ac9a5

Branch: refs/heads/master
Commit: 126ac9a5fe00fbbc6870ef25ae3fc6af6cd7c557
Parents: 70440bb
Author: Mike McCandless &amp;lt;mikemccand@apache.org&amp;gt;
Authored: Sat Feb 27 10:26:20 2016 -0500
Committer: Mike McCandless &amp;lt;mikemccand@apache.org&amp;gt;
Committed: Sat Feb 27 10:26:20 2016 -0500
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15172384" author="mikemccand" created="Mon, 29 Feb 2016 11:56:56 -0700">&lt;p&gt;Sorry, yeah I forgot the issue number!  Thanks for linking it &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe" class="user-hover" rel="steve_rowe"&gt;Steve Rowe&lt;/a&gt;!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12945265">LUCENE-7053</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12790351" name="LUCENE-7052-cleanup1.patch" size="14085" author="thetaphi" created="Sun, 28 Feb 2016 03:55:50 -0700"/>
                            <attachment id="12790349" name="LUCENE-7052-cleanup1.patch" size="5979" author="thetaphi" created="Sun, 28 Feb 2016 03:33:02 -0700"/>
                            <attachment id="12790307" name="LUCENE-7052.patch" size="10456" author="mikemccand" created="Sat, 27 Feb 2016 03:34:05 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 27 Feb 2016 11:31:00 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2tv5r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7051] Remove the "estimate match count" optimization from point queries</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7051</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;Point queries try to estimate the number of matches in the visitor so that the doc id set that they build does not have to do it by itself. However, this is incorrect in the multi-valued case and does not seem to buy much (if any) in terms of performance?&lt;/p&gt;</description>
                <environment/>
        <key id="12944978">LUCENE-7051</key>
            <summary>Remove the "estimate match count" optimization from point queries</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jpountz">Adrien Grand</assignee>
                                    <reporter username="jpountz">Adrien Grand</reporter>
                        <labels>
                    </labels>
                <created>Fri, 26 Feb 2016 11:05:44 -0700</created>
                <updated>Thu, 28 Apr 2016 06:17:30 -0700</updated>
                            <resolved>Mon, 29 Feb 2016 03:06:41 -0700</resolved>
                                                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="15169455" author="jpountz" created="Fri, 26 Feb 2016 11:11:16 -0700">&lt;p&gt;Patch. luceneutil results for IntNRQ look unchanged:&lt;/p&gt;

&lt;div class="preformatted panel" style="border-width: 1px;"&gt;&lt;div class="preformattedContent panelContent"&gt;
&lt;pre&gt;                    TaskQPS baseline      StdDev   QPS patch      StdDev                Pct diff
                  Fuzzy1       91.75     (13.9%)       86.05     (15.7%)   -6.2% ( -31% -   27%)
                 LowTerm     3636.70      (6.9%)     3591.63      (8.0%)   -1.2% ( -15% -   14%)
         LowSloppyPhrase       63.24      (4.6%)       62.55      (5.0%)   -1.1% ( -10% -    8%)
               MedPhrase      750.88      (8.6%)      743.27      (7.0%)   -1.0% ( -15% -   15%)
               OrHighLow      285.91      (5.9%)      283.27      (5.1%)   -0.9% ( -11% -   10%)
            HighSpanNear      141.98      (3.8%)      140.82      (4.1%)   -0.8% (  -8% -    7%)
             MedSpanNear      324.58      (2.7%)      322.60      (3.3%)   -0.6% (  -6% -    5%)
         MedSloppyPhrase      304.96      (4.1%)      303.55      (4.2%)   -0.5% (  -8% -    8%)
              HighPhrase       59.46      (4.5%)       59.31      (4.8%)   -0.2% (  -9% -    9%)
                 Prefix3      268.26      (4.5%)      267.70      (5.2%)   -0.2% (  -9% -    9%)
              AndHighMed      850.41      (3.9%)      850.37      (5.3%)   -0.0% (  -8% -    9%)
                  Fuzzy2       50.95     (12.3%)       50.95     (17.9%)    0.0% ( -26% -   34%)
                HighTerm      410.99      (5.8%)      411.95      (5.5%)    0.2% ( -10% -   12%)
                Wildcard      403.48      (8.4%)      404.81      (6.8%)    0.3% ( -13% -   16%)
                 Respell      175.79      (8.8%)      176.57      (7.3%)    0.4% ( -14% -   18%)
               OrHighMed      243.10      (9.0%)      244.40      (6.2%)    0.5% ( -13% -   17%)
        HighSloppyPhrase      131.84      (4.5%)      132.58      (4.1%)    0.6% (  -7% -    9%)
              AndHighLow     1776.00      (5.8%)     1791.85      (7.1%)    0.9% ( -11% -   14%)
                 MedTerm     1389.09      (5.8%)     1401.91      (7.4%)    0.9% ( -11% -   14%)
              OrHighHigh      199.46      (7.1%)      202.13      (7.5%)    1.3% ( -12% -   17%)
               LowPhrase      511.73      (4.1%)      519.77      (4.1%)    1.6% (  -6% -   10%)
                  IntNRQ       88.04     (10.1%)       89.50     (10.1%)    1.7% ( -16% -   24%)
             AndHighHigh      508.76      (5.6%)      519.35      (3.5%)    2.1% (  -6% -   11%)
             LowSpanNear      938.03      (9.6%)      958.64      (6.2%)    2.2% ( -12% -   19%)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15169502" author="mikemccand" created="Fri, 26 Feb 2016 11:41:17 -0700">&lt;p&gt;OK +1 to remove!&lt;/p&gt;</comment>
                            <comment id="15171614" author="jira-bot" created="Mon, 29 Feb 2016 02:10:57 -0700">&lt;p&gt;Commit 46d05afdaefac34755c13d40018611759bdcf972 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jpountz" class="user-hover" rel="jpountz"&gt;Adrien Grand&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=46d05af" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=46d05af&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7051" title="Remove the &amp;quot;estimate match count&amp;quot; optimization from point queries" class="issue-link" data-issue-key="LUCENE-7051"&gt;&lt;del&gt;LUCENE-7051&lt;/del&gt;&lt;/a&gt;: Remove the "estimate match count" optimization from point queries.&lt;/p&gt;</comment>
                            <comment id="15171692" author="jpountz" created="Mon, 29 Feb 2016 03:07:54 -0700">&lt;p&gt;I'll watch &lt;a href="http://home.apache.org/~mikemccand/lucenebench/IntNRQ.html" class="external-link" rel="nofollow"&gt;http://home.apache.org/~mikemccand/lucenebench/IntNRQ.html&lt;/a&gt; in the coming days to make sure the nightly benchmarks agree this optimization was not necessary.&lt;/p&gt;</comment>
                            <comment id="15171862" author="jira-bot" created="Mon, 29 Feb 2016 06:28:50 -0700">&lt;p&gt;Commit 858a52b7c57bd4930ad758ee6bc8aab262cd2fd7 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=858a52b" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=858a52b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7051" title="Remove the &amp;quot;estimate match count&amp;quot; optimization from point queries" class="issue-link" data-issue-key="LUCENE-7051"&gt;&lt;del&gt;LUCENE-7051&lt;/del&gt;&lt;/a&gt;: remove another estimate match count optimization&lt;/p&gt;</comment>
                            <comment id="15177832" author="jpountz" created="Thu, 3 Mar 2016 06:57:26 -0700">&lt;blockquote&gt;&lt;p&gt;I'll watch &lt;a href="http://home.apache.org/~mikemccand/lucenebench/IntNRQ.html" class="external-link" rel="nofollow"&gt;http://home.apache.org/~mikemccand/lucenebench/IntNRQ.html&lt;/a&gt; in the coming days to make sure the nightly benchmarks agree this optimization was not necessary.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The last point onthe chart from march 1st looks good so I think we're fine.&lt;/p&gt;</comment>
                            <comment id="15177880" author="mikemccand" created="Thu, 3 Mar 2016 07:36:17 -0700">&lt;p&gt;Thanks for following up &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jpountz" class="user-hover" rel="jpountz"&gt;Adrien Grand&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15262116" author="jpountz" created="Thu, 28 Apr 2016 06:17:30 -0700">&lt;p&gt;After Robert's feedback on &lt;a href="https://issues.apache.org/jira/browse/LUCENE-7254" title="DocIDSetBuilder is no good for points" class="issue-link" data-issue-key="LUCENE-7254"&gt;LUCENE-7254&lt;/a&gt; I tried to understand better why the cost esimation did not seem to help here. The reason is that IntNRQ is not a good benchmark for DocIdSetBuilder. All IntNRQ queries match MORE than 25% of documents, so the run time is completely dominated by calls to &lt;tt&gt;FixedBitSet.set&lt;/tt&gt;. I will shortly open a new issue to undo this change.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12790181" name="LUCENE-7051.patch" size="11145" author="jpountz" created="Fri, 26 Feb 2016 11:11:16 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 26 Feb 2016 18:41:17 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 week, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ttvz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7050] Improve the query cache heuristic to detect costly queries</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7050</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;Term queries, phrase queries and their combinations through boolean queries should not be cached too agressively since they can efficiently make use of skip lists. However we also have a number of queries that in practice need to visit all matches anyway like PrefixQuery, TermsQuery, PointInSetQuery, PointRangeQuery, so caching them more agressively can help avoid computing all documents that match in the whole index again and again.&lt;/p&gt;</description>
                <environment/>
        <key id="12944954">LUCENE-7050</key>
            <summary>Improve the query cache heuristic to detect costly queries</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jpountz">Adrien Grand</assignee>
                                    <reporter username="jpountz">Adrien Grand</reporter>
                        <labels>
                    </labels>
                <created>Fri, 26 Feb 2016 10:07:14 -0700</created>
                <updated>Mon, 29 Feb 2016 03:06:14 -0700</updated>
                            <resolved>Mon, 29 Feb 2016 03:06:14 -0700</resolved>
                                                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="15169337" author="jpountz" created="Fri, 26 Feb 2016 10:10:48 -0700">&lt;p&gt;One problem is that some of these queries, like TermsQuery and PointInPolygonQuery are in different modules (queries and sandbox respectively) so we can't refer to them from the caching policy. We could add a new API but it does't feel right to me to add one only for the caching use-case. So maybe we could rely on the class name for popular costly queries that are in other modules? Here is a patch that demonstrates the idea. It is a bit hacky but maybe that's not too bad since the hack is very contained?&lt;/p&gt;</comment>
                            <comment id="15169355" author="rcmuir" created="Fri, 26 Feb 2016 10:20:50 -0700">&lt;p&gt;On the idea of a method or interface, are we sure caching is the only use case? What about eg reordering clauses for more efficiency and other potential uses?&lt;/p&gt;

&lt;p&gt;Im not opposed to the hacky solution since its just a default impl... But if we can come up with a very nice name... Then i think it would be cleaner for queries to confess that processing just a few docs is just as costly as processing all docs.&lt;/p&gt;</comment>
                            <comment id="15169437" author="jpountz" created="Fri, 26 Feb 2016 11:03:09 -0700">&lt;p&gt;Thanks for the feedback. Then I suggest to push this change and separately explore whether such a flag on queries (or maybe weights) could be used to better execute queries.&lt;/p&gt;</comment>
                            <comment id="15171651" author="jpountz" created="Mon, 29 Feb 2016 02:41:50 -0700">&lt;blockquote&gt;&lt;p&gt;What about eg reordering clauses for more efficiency and other potential uses? &lt;span class="error"&gt;&amp;#91;...&amp;#93;&lt;/span&gt;  it would be cleaner for queries to confess that processing just a few docs is just as costly as processing all docs.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I opened &lt;a href="https://issues.apache.org/jira/browse/LUCENE-7055" title="Better execution path for costly queries" class="issue-link" data-issue-key="LUCENE-7055"&gt;LUCENE-7055&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15171684" author="jira-bot" created="Mon, 29 Feb 2016 03:05:50 -0700">&lt;p&gt;Commit 44324d3dfe34fb436595f8c15bfc97eb39564b1f in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jpountz" class="user-hover" rel="jpountz"&gt;Adrien Grand&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=44324d3" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=44324d3&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7050" title="Improve the query cache heuristic to detect costly queries" class="issue-link" data-issue-key="LUCENE-7050"&gt;&lt;del&gt;LUCENE-7050&lt;/del&gt;&lt;/a&gt;: Cache TermsQuery and point queries more aggressively.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12790166" name="LUCENE-7050.patch" size="3989" author="jpountz" created="Fri, 26 Feb 2016 10:10:48 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 26 Feb 2016 17:20:50 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ttqn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7048] Add XXXPoint.newSetQuery to match a set of points</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7048</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;This is the analog of &lt;tt&gt;TermsQuery&lt;/tt&gt; for dimensional points, to (relatively) efficiently match any docs whose point value is in the specified set.&lt;/p&gt;</description>
                <environment/>
        <key id="12944003">LUCENE-7048</key>
            <summary>Add XXXPoint.newSetQuery to match a set of points</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mikemccand">Michael McCandless</assignee>
                                    <reporter username="mikemccand">Michael McCandless</reporter>
                        <labels>
                    </labels>
                <created>Wed, 24 Feb 2016 15:49:35 -0700</created>
                <updated>Thu, 25 Feb 2016 11:49:44 -0700</updated>
                            <resolved>Thu, 25 Feb 2016 11:49:43 -0700</resolved>
                                                    <fixVersion>master</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="15165676" author="mikemccand" created="Wed, 24 Feb 2016 15:51:51 -0700">&lt;p&gt;I added newSetQuery to Int,Long,Float,Double,Binary,InetAddress,BigIntegerPoint.&lt;/p&gt;

&lt;p&gt;I also found a bug in how we were encoding float/double, such that the range and set queries were not working!&lt;/p&gt;

&lt;p&gt;I haven't yet tackled the &amp;gt; 1D case yet ...&lt;/p&gt;</comment>
                            <comment id="15166427" author="rcmuir" created="Wed, 24 Feb 2016 17:36:39 -0700">&lt;p&gt;+1.&lt;/p&gt;</comment>
                            <comment id="15167070" author="mikemccand" created="Thu, 25 Feb 2016 03:52:56 -0700">&lt;p&gt;New patch, fixing nocommits.&lt;/p&gt;

&lt;p&gt;I didn't add the multi-dim'd versions to all &lt;tt&gt;XXXPoint&lt;/tt&gt; fields, but I did add test cases showing that it works and showing how we could add it "for real" later.&lt;/p&gt;

&lt;p&gt;I think it's ready.&lt;/p&gt;</comment>
                            <comment id="15167494" author="rcmuir" created="Thu, 25 Feb 2016 10:31:20 -0700">&lt;p&gt;still looks good. thanks Mike.&lt;/p&gt;</comment>
                            <comment id="15167622" author="jira-bot" created="Thu, 25 Feb 2016 11:41:58 -0700">&lt;p&gt;Commit 446ce8604e4baff4f4e486e39f7e885f0d8d0c57 in lucene-solr's branch refs/heads/master from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=446ce86" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=446ce86&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7048" title="Add XXXPoint.newSetQuery to match a set of points" class="issue-link" data-issue-key="LUCENE-7048"&gt;&lt;del&gt;LUCENE-7048&lt;/del&gt;&lt;/a&gt;: add XXXPoint.newSetQuery to match documents with any values from the specified set (this is the analog of TermsQuery, for points)&lt;/p&gt;

&lt;p&gt;Merge branch 'point_set_query'&lt;/p&gt;</comment>
                            <comment id="15167623" author="jira-bot" created="Thu, 25 Feb 2016 11:41:59 -0700">&lt;p&gt;Commit b9d46e4fd6de73524be7bb4be0b35c066fed4fae in lucene-solr's branch refs/heads/master from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b9d46e4" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b9d46e4&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7048" title="Add XXXPoint.newSetQuery to match a set of points" class="issue-link" data-issue-key="LUCENE-7048"&gt;&lt;del&gt;LUCENE-7048&lt;/del&gt;&lt;/a&gt;: add changes entry&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12789915" name="LUCENE-7048.patch" size="75735" author="mikemccand" created="Thu, 25 Feb 2016 03:52:56 -0700"/>
                            <attachment id="12789764" name="LUCENE-7048.patch" size="68825" author="mikemccand" created="Wed, 24 Feb 2016 15:51:51 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 25 Feb 2016 00:36:39 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2tnvb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7047] Add Geo3DPoint.newShapeQuery</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7047</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;This just fixes geo3d to match the other points APIs.&lt;/p&gt;</description>
                <environment/>
        <key id="12942962">LUCENE-7047</key>
            <summary>Add Geo3DPoint.newShapeQuery</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mikemccand">Michael McCandless</assignee>
                                    <reporter username="mikemccand">Michael McCandless</reporter>
                        <labels>
                    </labels>
                <created>Wed, 24 Feb 2016 06:43:35 -0700</created>
                <updated>Wed, 24 Feb 2016 09:13:08 -0700</updated>
                            <resolved>Wed, 24 Feb 2016 09:13:08 -0700</resolved>
                                                    <fixVersion>master</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="15163002" author="mikemccand" created="Wed, 24 Feb 2016 06:44:37 -0700">&lt;p&gt;Simple patch.&lt;/p&gt;</comment>
                            <comment id="15163011" author="rcmuir" created="Wed, 24 Feb 2016 06:49:34 -0700">&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;we may want to followup with other issues/similar improvements like we have done to other point classes:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;ensure this thing has simple unit tests testing the Geo3DPoint class itself.&lt;/li&gt;
	&lt;li&gt;ensure Geo3DPoint has a good toString() and test it&lt;/li&gt;
	&lt;li&gt;add javadocs link for your new static method in the class summary as a "list of supported operations" (even though its just one at the moment). See any of the other Points as an example. There is likely a lot of exposed surface (additional methods/members) from Field itself and it risks being hidden/disorganized otherwise.&lt;/li&gt;
	&lt;li&gt;test toString() of the returned shape query if not already tested.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15163198" author="mikemccand" created="Wed, 24 Feb 2016 08:34:02 -0700">&lt;p&gt;Thanks for the pointers &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I fixed &lt;tt&gt;toString&lt;/tt&gt; for &lt;tt&gt;Geo3DPointField&lt;/tt&gt; and its shape query, and added tests, but found a bug a &lt;tt&gt;FieldType.toString&lt;/tt&gt; where we failed to "disclose" that we are indexing points.  I fixed that and this provoked new test failures, and then I tried to improve the existing toStrings, and fixed further test failures.  I also switched to native types for &lt;tt&gt;encode/decodeDimension&lt;/tt&gt; on the core point fields.&lt;/p&gt;

&lt;p&gt;I think this is ready but I still need to run all tests ...&lt;/p&gt;</comment>
                            <comment id="15163216" author="rcmuir" created="Wed, 24 Feb 2016 08:47:05 -0700">&lt;p&gt;Thanks Mike. This looks good.&lt;/p&gt;</comment>
                            <comment id="15163256" author="jira-bot" created="Wed, 24 Feb 2016 09:13:00 -0700">&lt;p&gt;Commit dc95d5248afd4ee5e2364b5060102aa4668f30e0 in lucene-solr's branch refs/heads/master from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=dc95d52" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=dc95d52&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7047" title="Add Geo3DPoint.newShapeQuery" class="issue-link" data-issue-key="LUCENE-7047"&gt;&lt;del&gt;LUCENE-7047&lt;/del&gt;&lt;/a&gt;: improve Geo3DPoint, core XXXPoint.toString&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12789578" name="LUCENE-7047.patch" size="27171" author="mikemccand" created="Wed, 24 Feb 2016 08:34:02 -0700"/>
                            <attachment id="12789563" name="LUCENE-7047.patch" size="3694" author="mikemccand" created="Wed, 24 Feb 2016 06:44:37 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 24 Feb 2016 13:49:34 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2thfz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7046] Remove PointInRectQuery</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7046</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;This query is the same as a 2D PointRangeQuery, only slower, since it needs to do a bunch of decoding.&lt;/p&gt;

&lt;p&gt;Instead we should just form PointRangeQuery's for bounding boxes for LatLonPoints: that just works on byte ranges.&lt;/p&gt;
</description>
                <environment/>
        <key id="12941623">LUCENE-7046</key>
            <summary>Remove PointInRectQuery</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rcmuir">Robert Muir</reporter>
                        <labels>
                    </labels>
                <created>Tue, 23 Feb 2016 20:27:38 -0700</created>
                <updated>Wed, 24 Feb 2016 06:34:04 -0700</updated>
                            <resolved>Wed, 24 Feb 2016 06:33:53 -0700</resolved>
                                                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="15160128" author="rcmuir" created="Tue, 23 Feb 2016 20:28:43 -0700">&lt;p&gt;Here's a patch. I tried to do some cleanups (more iteration here is needed!!!) to LatLonPoint in general as well.&lt;/p&gt;</comment>
                            <comment id="15160146" author="rcmuir" created="Tue, 23 Feb 2016 20:58:15 -0700">&lt;p&gt;A couple more cleanups:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Add TestLatLonPoint with some basic stuff&lt;/li&gt;
	&lt;li&gt;Add LatLonPoint.toString() so it doesn't print gibberish bytes.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15162921" author="mikemccand" created="Wed, 24 Feb 2016 05:43:32 -0700">&lt;p&gt;+1, looks awesome!&lt;/p&gt;</comment>
                            <comment id="15162984" author="jira-bot" created="Wed, 24 Feb 2016 06:32:29 -0700">&lt;p&gt;Commit 77e62276f99d3d525aa2ee8681de4ff0f78e6c2a in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=77e6227" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=77e6227&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7046" title="Remove PointInRectQuery" class="issue-link" data-issue-key="LUCENE-7046"&gt;&lt;del&gt;LUCENE-7046&lt;/del&gt;&lt;/a&gt;: Remove PointInRectQuery, instead using 2-D PointRangeQuery for LatLonPoint&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12789371" name="LUCENE-7046.patch" size="40972" author="rcmuir" created="Tue, 23 Feb 2016 20:58:15 -0700"/>
                            <attachment id="12789369" name="LUCENE-7046.patch" size="37876" author="rcmuir" created="Tue, 23 Feb 2016 20:28:43 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 24 Feb 2016 12:43:32 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2t96f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7045] remove all encode/decode hooks from PointRangeQuery</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7045</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;In &lt;a href="https://issues.apache.org/jira/browse/LUCENE-7043" title="add BigIntegerPoint and InetAddressPoint to sandbox" class="issue-link" data-issue-key="LUCENE-7043"&gt;&lt;del&gt;LUCENE-7043&lt;/del&gt;&lt;/a&gt; we added several new point types and just gave them static methods to generate exact/range/prefix/whatever queries.&lt;/p&gt;

&lt;p&gt;I think we should do the same in general, e.g. for IntPoint:&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
This field defines &lt;span class="code-keyword"&gt;static&lt;/span&gt; factory methods &lt;span class="code-keyword"&gt;for&lt;/span&gt; creating common queries:
&amp;lt;ul&amp;gt;
  &amp;lt;li&amp;gt;{@link #newExactQuery newExactQuery()} &lt;span class="code-keyword"&gt;for&lt;/span&gt; matching an exact 1D point.
  &amp;lt;li&amp;gt;{@link #newRangeQuery newRangeQuery()} &lt;span class="code-keyword"&gt;for&lt;/span&gt; matching a 1D range.
  &amp;lt;li&amp;gt;{@link #newMultiRangeQuery newMultiRangeQuery()} &lt;span class="code-keyword"&gt;for&lt;/span&gt; matching points/ranges in n-dimensional space.
&amp;lt;/ul&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Then each Point can have types that make sense for it: e.g. multi-dimensional range queries don't make sense at all for IP addresses, but prefix query does, and polygon/distance queries make sense for LatLonPoint and so on (that one is not refactored yet here, followup!)&lt;/p&gt;</description>
                <environment/>
        <key id="12941493">LUCENE-7045</key>
            <summary>remove all encode/decode hooks from PointRangeQuery</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rcmuir">Robert Muir</reporter>
                        <labels>
                    </labels>
                <created>Tue, 23 Feb 2016 11:27:02 -0700</created>
                <updated>Tue, 23 Feb 2016 15:07:24 -0700</updated>
                            <resolved>Tue, 23 Feb 2016 15:07:24 -0700</resolved>
                                                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="15159374" author="rcmuir" created="Tue, 23 Feb 2016 11:28:35 -0700">&lt;p&gt;Here's a patch. &lt;/p&gt;

&lt;p&gt;Points get a little api cleanup, we don't need to expose so much guts anymore, just generally an &lt;tt&gt;encodeDimension&lt;/tt&gt; and &lt;tt&gt;decodeDimension&lt;/tt&gt; so that anyone doing anything custom is able to do it.&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;PointRangeQuery&lt;/tt&gt; is marked abstract and has references to the core points to remove any confusion.&lt;/p&gt;</comment>
                            <comment id="15159452" author="mikemccand" created="Tue, 23 Feb 2016 12:11:10 -0700">&lt;p&gt;+1, this is really nice.  I like having all encode/decode for a given data type in once place, succinctly exposed, and having that same place create the queries.&lt;/p&gt;</comment>
                            <comment id="15159733" author="jira-bot" created="Tue, 23 Feb 2016 15:04:07 -0700">&lt;p&gt;Commit 099e0311398cb61f53a1b58ed567053bec4904aa in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=099e031" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=099e031&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7045" title="remove all encode/decode hooks from PointRangeQuery" class="issue-link" data-issue-key="LUCENE-7045"&gt;&lt;del&gt;LUCENE-7045&lt;/del&gt;&lt;/a&gt;: remove all encode/decode hooks from PointRangeQuery&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12789264" name="LUCENE-7045.patch" size="108679" author="rcmuir" created="Tue, 23 Feb 2016 11:28:35 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 23 Feb 2016 19:11:10 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2t8dj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7043] add BigIntegerPoint and InetAddressPoint to sandbox</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7043</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;We can now index 128-bit quantities, but still, making Fields for these is a bit of work: you have to do some numericutils sign-extension/sign-flipping magic for BigInteger quantities, deal with ipv4-mapped ipv6 addresses, etc.&lt;/p&gt;

&lt;p&gt;We can just provide some simple field types that also have static factory methods for exact match/ranges.&lt;/p&gt;

&lt;p&gt;The BigIntegerPoint is N-dimensional, so acts just like any other primitive, except its bigger (e.g. long long).&lt;/p&gt;

&lt;p&gt;InetAddressPoint is 1-dimensional by nature: of course you can have multiple values per field, thats different. Since we prefix-compress values, we can just map IPv4 addresses to IPv6 space and it works for both types. This is consistent with what InetAddress does itself anyway.&lt;/p&gt;</description>
                <environment/>
        <key id="12941275">LUCENE-7043</key>
            <summary>add BigIntegerPoint and InetAddressPoint to sandbox</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rcmuir">Robert Muir</reporter>
                        <labels>
                    </labels>
                <created>Mon, 22 Feb 2016 21:51:40 -0700</created>
                <updated>Tue, 23 Feb 2016 05:25:14 -0700</updated>
                            <resolved>Tue, 23 Feb 2016 05:25:14 -0700</resolved>
                                                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="15158285" author="rcmuir" created="Mon, 22 Feb 2016 21:55:47 -0700">&lt;p&gt;patch adding both of these to sandbox.&lt;/p&gt;

&lt;p&gt;there are some core changes but they are really unrelated:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;toString's for Int/Long/Float/DoublePoint were useless.&lt;/li&gt;
	&lt;li&gt;Int/Long/Float/DoublePoint were not tested by TestField.&lt;/li&gt;
	&lt;li&gt;NumericUtils big integer methods needed some cleanups.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15158338" author="rcmuir" created="Mon, 22 Feb 2016 22:49:43 -0700">&lt;p&gt;some minor cleanups, and adding prefix/CIDR range query for the InetAddressPoint (this is just sugar for an ordinary range).&lt;/p&gt;</comment>
                            <comment id="15158679" author="mikemccand" created="Tue, 23 Feb 2016 03:31:05 -0700">&lt;p&gt;+1, this looks wonderful!&lt;/p&gt;</comment>
                            <comment id="15158681" author="mikemccand" created="Tue, 23 Feb 2016 03:32:51 -0700">&lt;p&gt;I think we can resolve &lt;a href="https://issues.apache.org/jira/browse/LUCENE-5596" title="Support for index/search large numeric field" class="issue-link" data-issue-key="LUCENE-5596"&gt;&lt;del&gt;LUCENE-5596&lt;/del&gt;&lt;/a&gt; with this?&lt;/p&gt;</comment>
                            <comment id="15158697" author="thetaphi" created="Tue, 23 Feb 2016 03:42:03 -0700">&lt;p&gt;+1, I like it!&lt;/p&gt;</comment>
                            <comment id="15158785" author="jira-bot" created="Tue, 23 Feb 2016 05:24:49 -0700">&lt;p&gt;Commit 54216c6f650d34973a8eefa86343aad7b940a1c6 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=54216c6" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=54216c6&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7043" title="add BigIntegerPoint and InetAddressPoint to sandbox" class="issue-link" data-issue-key="LUCENE-7043"&gt;&lt;del&gt;LUCENE-7043&lt;/del&gt;&lt;/a&gt;: Add BigIntegerPoint and InetAddressPoint to sandbox.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12789136" name="LUCENE-7043.patch" size="46946" author="rcmuir" created="Mon, 22 Feb 2016 22:49:43 -0700"/>
                            <attachment id="12789131" name="LUCENE-7043.patch" size="44574" author="rcmuir" created="Mon, 22 Feb 2016 21:55:47 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 23 Feb 2016 10:31:05 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2t713:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7042] more cleanup for Point encodings</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7042</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;Followup of &lt;a href="https://issues.apache.org/jira/browse/LUCENE-7039" title="Improve PointRangeQuery &amp;amp; co" class="issue-link" data-issue-key="LUCENE-7039"&gt;&lt;del&gt;LUCENE-7039&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I started consolidating encode/decode functions into XYZField, but its still pretty messy. Specifically, duplicated code because indexer wants packed byte[] and queries want byte[][] and so on.&lt;/p&gt;

&lt;p&gt;We can do a bit more cleanup: by defining everything in terms of encodeDimension() and decodeDimension(). This way, the logic is only in one place. &lt;/p&gt;

&lt;p&gt;Also the new NumericUtils methods here are confusing I think. Its scary how they take a "dimensional index" when parsing from a byte[]. I think they should just take 'offset' and not try to be fancy, its easier to understand.&lt;/p&gt;</description>
                <environment/>
        <key id="12941203">LUCENE-7042</key>
            <summary>more cleanup for Point encodings</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rcmuir">Robert Muir</reporter>
                        <labels>
                    </labels>
                <created>Mon, 22 Feb 2016 15:31:42 -0700</created>
                <updated>Mon, 22 Feb 2016 17:33:19 -0700</updated>
                            <resolved>Mon, 22 Feb 2016 17:33:19 -0700</resolved>
                                                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="15157871" author="mikemccand" created="Mon, 22 Feb 2016 15:50:38 -0700">&lt;p&gt;+1, thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="15158018" author="jira-bot" created="Mon, 22 Feb 2016 17:33:03 -0700">&lt;p&gt;Commit 9ca1a19b81448594bbaf046da5d5e33228e6974f in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9ca1a19" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9ca1a19&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7042" title="more cleanup for Point encodings" class="issue-link" data-issue-key="LUCENE-7042"&gt;&lt;del&gt;LUCENE-7042&lt;/del&gt;&lt;/a&gt;: more cleanup for Point encodings&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12789078" name="LUCENE-7042.patch" size="116935" author="rcmuir" created="Mon, 22 Feb 2016 15:32:16 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 22 Feb 2016 22:50:38 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2t6l3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7039] Improve PointRangeQuery &amp; co</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7039</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;The point types are now preferred for indexing numeric fields, but PointRangeQuery has some usability issues.&lt;/p&gt;

&lt;p&gt;I think we should make the following changes:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;newIntRange()&lt;/tt&gt;, &lt;tt&gt;newLongRange()&lt;/tt&gt;, &lt;tt&gt;newFloatRange()&lt;/tt&gt;,&lt;tt&gt;newDoubleRange()&lt;/tt&gt;, &lt;tt&gt;newBinaryRange()&lt;/tt&gt;: simple 1D ranges consistent with NumericRangeQuery naming.&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;newMultiIntRange()&lt;/tt&gt;, &lt;tt&gt;newMultiLongRange()&lt;/tt&gt;, &lt;tt&gt;newMultiFloatRange()&lt;/tt&gt;, &lt;tt&gt;newMultiDoubleRange()&lt;/tt&gt;, &lt;tt&gt;newMultiBinaryRange()&lt;/tt&gt;: multi-dimensional versions of the above (take arrays, a bit harder to use, but the arrays have correct type!)&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;toString()&lt;/tt&gt; should be meaningful, it should not spew binary nonsense unless you used a binary range!&lt;/li&gt;
	&lt;li&gt;improve javadocs&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;If we like this, we could do similar improvements for the ExactPointQuery&lt;/p&gt;</description>
                <environment/>
        <key id="12940790">LUCENE-7039</key>
            <summary>Improve PointRangeQuery &amp; co</summary>
                <type id="3" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/task.png">Task</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rcmuir">Robert Muir</reporter>
                        <labels>
                    </labels>
                <created>Sat, 20 Feb 2016 07:36:57 -0700</created>
                <updated>Mon, 22 Feb 2016 17:33:11 -0700</updated>
                            <resolved>Mon, 22 Feb 2016 17:33:11 -0700</resolved>
                                                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="15155646" author="rcmuir" created="Sat, 20 Feb 2016 07:37:34 -0700">&lt;p&gt;Here is a prototype patch.&lt;/p&gt;</comment>
                            <comment id="15155649" author="mikemccand" created="Sat, 20 Feb 2016 07:42:44 -0700">&lt;p&gt;+1, I like this improvement, thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15157219" author="rcmuir" created="Mon, 22 Feb 2016 09:17:49 -0700">&lt;p&gt;Updated patch. I moved encode/decode methods to the respective XYZField, because we don't want these scattered about everywhere.&lt;/p&gt;

&lt;p&gt;Also I removed the ExactPointQuery, instead adding these simple sugar methods like this:&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
&lt;span class="code-keyword"&gt;public&lt;/span&gt; &lt;span class="code-keyword"&gt;static&lt;/span&gt; PointRangeQuery newIntExact(&lt;span class="code-object"&gt;String&lt;/span&gt; field, &lt;span class="code-object"&gt;int&lt;/span&gt; value) {
  &lt;span class="code-keyword"&gt;return&lt;/span&gt; newIntRange(field, value, &lt;span class="code-keyword"&gt;true&lt;/span&gt;, value, &lt;span class="code-keyword"&gt;true&lt;/span&gt;);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 

&lt;p&gt;Otherwise its a terrible amount of plumbing just to get a range query at the end of the day anyway. And I think since it does not "do anything different" behind the scenes this is better, e.g. users will not make some wierd effort to use the exact version to "optimize" or anything like that.&lt;/p&gt;

&lt;p&gt;I think this is ok for a first step. We may want to do more refactoring/improve docs in a followup.&lt;/p&gt;</comment>
                            <comment id="15157504" author="mikemccand" created="Mon, 22 Feb 2016 12:10:02 -0700">&lt;p&gt;+1, lots of great changes here: removing &lt;tt&gt;ExactPointQuery&lt;/tt&gt; to match how you make the range queries, awesome javadocs, factoring out argument checking, consolidating encode/decode in the same class, fixing &lt;tt&gt;toString&lt;/tt&gt; to not be useless &lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/smile.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt;&lt;/p&gt;

&lt;p&gt;Maybe we should rename &lt;tt&gt;PointRangeQuery&lt;/tt&gt; to &lt;tt&gt;PointQuery&lt;/tt&gt;?&lt;/p&gt;

&lt;p&gt;I agree all the TODOs should be done separately.&lt;/p&gt;

&lt;p&gt;Thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="15157610" author="jira-bot" created="Mon, 22 Feb 2016 13:10:24 -0700">&lt;p&gt;Commit 54a544b3075fe4a5a775d8774d0b462c5324b287 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=54a544b" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=54a544b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7039" title="Improve PointRangeQuery &amp;amp; co" class="issue-link" data-issue-key="LUCENE-7039"&gt;&lt;del&gt;LUCENE-7039&lt;/del&gt;&lt;/a&gt;: Improve PointRangeQuery &amp;amp; co&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12789024" name="LUCENE-7039.patch" size="68495" author="rcmuir" created="Mon, 22 Feb 2016 09:17:49 -0700"/>
                            <attachment id="12788850" name="LUCENE-7039.patch" size="53457" author="rcmuir" created="Sat, 20 Feb 2016 07:37:34 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 20 Feb 2016 14:42:44 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2t41j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7037] Switch all exception tests to expectThrows()</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7037</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;Tests expecting exceptions today are done in various ways.&lt;/p&gt;

&lt;p&gt;The best ones look like this.&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
&lt;span class="code-keyword"&gt;try&lt;/span&gt; {
  something();
  fail(&lt;span class="code-quote"&gt;"message"&lt;/span&gt;);
} &lt;span class="code-keyword"&gt;catch&lt;/span&gt; (Exception expected) {
  assertSomethingAbout(expected);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But there are many forms (involving booleans and such). All of these are a little sketchy because it is all-too easy to just forget the &lt;tt&gt;fail()&lt;/tt&gt; and then the whole test is useless.&lt;/p&gt;

&lt;p&gt;`expectThrows` was added in &lt;a href="https://issues.apache.org/jira/browse/LUCENE-7009" title="Add expectThrows utility to LuceneTestCase" class="issue-link" data-issue-key="LUCENE-7009"&gt;&lt;del&gt;LUCENE-7009&lt;/del&gt;&lt;/a&gt; which solves a lot of these problems. Its not perfect, but overall a big improvement. We should cut over all of our tests.&lt;/p&gt;</description>
                <environment/>
        <key id="12940528">LUCENE-7037</key>
            <summary>Switch all exception tests to expectThrows()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rcmuir">Robert Muir</reporter>
                        <labels>
                    </labels>
                <created>Fri, 19 Feb 2016 08:03:54 -0700</created>
                <updated>Fri, 19 Feb 2016 10:16:46 -0700</updated>
                            <resolved>Fri, 19 Feb 2016 10:16:46 -0700</resolved>
                                                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>1</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="15154315" author="rcmuir" created="Fri, 19 Feb 2016 08:06:01 -0700">&lt;p&gt;Here is a patch. It fixes numerous instances of missing &lt;tt&gt;fail()&lt;/tt&gt; calls and other problems. &lt;/p&gt;

&lt;p&gt;If a test was "crazy" (e.g. multi-catch) then I did not switch it over.&lt;br/&gt;
For example &lt;tt&gt;catch (NoSuchFileException | FileNotFoundException)&lt;/tt&gt;. I think we should try to improve those APIs if possible instead?&lt;/p&gt;

&lt;p&gt;In some cases the limitations of effectively-final meant I had to split up big tests into smaller ones or change local variables or similar. I see this as a good thing...&lt;/p&gt;</comment>
                            <comment id="15154342" author="thetaphi" created="Fri, 19 Feb 2016 08:24:08 -0700">&lt;p&gt;Thanks for the cleanup! +1 to commit this as first step. I did only skim through the patch, but looks fine! I love this!&lt;/p&gt;

&lt;p&gt;I have some unrelated comments:&lt;/p&gt;
&lt;ul class="alternate" type="square"&gt;
	&lt;li&gt;Maybe we should improve the expectThrows() assertion to also take a message like assertEquals(message,...). I just noticed that some messages were converted to comments in this patch (thanks), so I thought about that.&lt;/li&gt;
	&lt;li&gt;About the multi-catch: I feel the same: FileNotFoundException should not be allowed anymore in Lucene 6. Only NoSuchFileException! BASTA &lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/smile.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt; So clean up APIs. The old style RAFDirectory must then just convert them correctly and we assert that!&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15154348" author="rcmuir" created="Fri, 19 Feb 2016 08:29:31 -0700">&lt;p&gt;If we want to add one that takes message, I am fine. I did not do it here, because you get a clear exception (and if you expected a different one, it chains that incorrect one), and the test class and method name in the stacktrace should clarify what is wrong. I converted to comments if i felt those "messages" added additional context to document what the test is doing, but that is just that. &lt;/p&gt;

&lt;p&gt;These are not error messages to end-users but test failures for developers, who will go look at the source code. So I think we should focus on testing exceptions correctly (e.g. inspection of its message that its really the exception we expect), and documenting and organizing our tests to be clear in general, instead of adding infra to pass this around at runtime.&lt;/p&gt;

&lt;p&gt;Along the multi-catch: I feel the same way. The other big one is different exception type (always wrapped in RejectedExecution or something) when IndexSearcher uses an Executor. That is not good.&lt;/p&gt;</comment>
                            <comment id="15154487" author="mikemccand" created="Fri, 19 Feb 2016 09:50:49 -0700">&lt;p&gt;This is wonderful, thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;!  I skimmed patch also, +1 to commit before it goes too stale.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12788690" name="LUCENE-7037.patch" size="567171" author="rcmuir" created="Fri, 19 Feb 2016 08:06:01 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 19 Feb 2016 15:24:08 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2t2fb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7035] upgrade icu4j to latest (unicode 8)</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7035</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;See &lt;a href="https://issues.apache.org/jira/browse/LUCENE-6993" title="Update UAX29URLEmailTokenizer TLDs to latest list, and upgrade all JFlex-based tokenizers to support Unicode 8.0" class="issue-link" data-issue-key="LUCENE-6993"&gt;LUCENE-6993&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;We want to bring all these tokenizers up to date. The icu part can be done independently.&lt;/p&gt;</description>
                <environment/>
        <key id="12940004">LUCENE-7035</key>
            <summary>upgrade icu4j to latest (unicode 8)</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rcmuir">Robert Muir</reporter>
                        <labels>
                    </labels>
                <created>Wed, 17 Feb 2016 17:40:33 -0700</created>
                <updated>Thu, 18 Feb 2016 06:18:19 -0700</updated>
                            <resolved>Wed, 17 Feb 2016 18:11:07 -0700</resolved>
                                                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="15151502" author="rcmuir" created="Wed, 17 Feb 2016 17:43:04 -0700">&lt;p&gt;Here's a patch (does not include regenerated binary changes).&lt;/p&gt;

&lt;p&gt;It bumps the version, removes khmer syllable segmentation in favor of ICU's khmer support (and adds test), and regenerates all data files.&lt;/p&gt;</comment>
                            <comment id="15151509" author="mikemccand" created="Wed, 17 Feb 2016 17:47:50 -0700">&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="15151524" author="jira-bot" created="Wed, 17 Feb 2016 18:10:15 -0700">&lt;p&gt;Commit b0a43aa1b2819133ec2ee69545a62358baf440b3 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b0a43aa" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b0a43aa&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7035" title="upgrade icu4j to latest (unicode 8)" class="issue-link" data-issue-key="LUCENE-7035"&gt;&lt;del&gt;LUCENE-7035&lt;/del&gt;&lt;/a&gt;: Upgrade icu4j to 56.1/unicode 8.&lt;/p&gt;</comment>
                            <comment id="15151857" author="jira-bot" created="Thu, 18 Feb 2016 00:23:57 -0700">&lt;p&gt;Commit fc879d1a5d97fae8e805fb3d194557851539873d in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi" class="user-hover" rel="thetaphi"&gt;Uwe Schindler&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=fc879d1" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=fc879d1&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7035" title="upgrade icu4j to latest (unicode 8)" class="issue-link" data-issue-key="LUCENE-7035"&gt;&lt;del&gt;LUCENE-7035&lt;/del&gt;&lt;/a&gt;: Also regenerate analysis/common's UnicodeWhitespaceTokenizer (it actually changes nothing, but updates version numbers)&lt;/p&gt;</comment>
                            <comment id="15151859" author="thetaphi" created="Thu, 18 Feb 2016 00:26:45 -0700">&lt;p&gt;Hi Robert, I also regenerated inside analysis/common, because this one creates the UnicodeWhitespaceTokenizer's data file from icu4j.jar. This actually did not change anything, but the file versions were updated.&lt;/p&gt;

&lt;p&gt;Maybe we should add a message in analysis/icu's build.xml that reminds you to also update the analysis/common files if you update ICU.&lt;/p&gt;</comment>
                            <comment id="15152289" author="rcmuir" created="Thu, 18 Feb 2016 06:18:19 -0700">&lt;p&gt;To me that "cache" is independent of icu. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12788343" name="LUCENE-7035.patch" size="10857" author="rcmuir" created="Wed, 17 Feb 2016 17:43:04 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 18 Feb 2016 00:47:50 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2sz6v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7028] Remove useless clone of method in Lucene 6' LegacyNumericUtils</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7028</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;While working on &lt;a href="https://issues.apache.org/jira/browse/LUCENE-7027" title="NumericTermAttribute throws IAE after NumericTokenStream is exhausted" class="issue-link" data-issue-key="LUCENE-7027"&gt;&lt;del&gt;LUCENE-7027&lt;/del&gt;&lt;/a&gt; I noticed, that NumericUtils contains the same method 2 times (same signature), one just delegating to the other. I will remove the duplicate for 6.0.&lt;/p&gt;</description>
                <environment/>
        <key id="12939035">LUCENE-7028</key>
            <summary>Remove useless clone of method in Lucene 6' LegacyNumericUtils</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thetaphi">Uwe Schindler</assignee>
                                    <reporter username="thetaphi">Uwe Schindler</reporter>
                        <labels>
                    </labels>
                <created>Sat, 13 Feb 2016 10:24:36 -0700</created>
                <updated>Sat, 13 Feb 2016 17:13:10 -0700</updated>
                            <resolved>Sat, 13 Feb 2016 17:10:33 -0700</resolved>
                                                    <fixVersion>master</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>core/other</component>
                        <due/>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="15146078" author="thetaphi" created="Sat, 13 Feb 2016 10:32:21 -0700">&lt;p&gt;Patch.&lt;/p&gt;

&lt;p&gt;I decided to remove the older method (which should have been deprecated already). In both cases some other parts in Lucene and Solr had to be modified.&lt;/p&gt;

&lt;p&gt;Should I deprecate in 5.x / 5.5?&lt;/p&gt;</comment>
                            <comment id="15146109" author="thetaphi" created="Sat, 13 Feb 2016 11:22:08 -0700">&lt;p&gt;I prefer this variant more, because it keeps the shorter method name. Its a bit more changes, but overall this is more consistent naming (also with reverse prefixCodedToLong naming).&lt;/p&gt;</comment>
                            <comment id="15146207" author="mikemccand" created="Sat, 13 Feb 2016 14:32:17 -0700">&lt;p&gt;+1 to patch&lt;/p&gt;

&lt;p&gt;I don't think we need to deprecate in 5.5?  These are @lucene.internal?&lt;/p&gt;</comment>
                            <comment id="15146229" author="thetaphi" created="Sat, 13 Feb 2016 15:42:34 -0700">&lt;p&gt;The whole class was renamed anyways, so I am not sure oif its really needed to deprecate. Anybody using Numeric* has to rewrite code anyways.&lt;/p&gt;

&lt;p&gt;Nevertheless, I would just deprecate the method in 5.x and not change any code elsewhere (like this patch does).&lt;/p&gt;</comment>
                            <comment id="15146259" author="jira-bot" created="Sat, 13 Feb 2016 16:50:22 -0700">&lt;p&gt;Commit 74421d729b5a04f9342a90ef950e7ece4c113de6 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi" class="user-hover" rel="thetaphi"&gt;Uwe Schindler&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=74421d7" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=74421d7&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7028" title="Remove useless clone of method in Lucene 6&amp;#39; LegacyNumericUtils" class="issue-link" data-issue-key="LUCENE-7028"&gt;&lt;del&gt;LUCENE-7028&lt;/del&gt;&lt;/a&gt;: Remove duplicate method in LegacyNumericUtils&lt;/p&gt;</comment>
                            <comment id="15146265" author="jira-bot" created="Sat, 13 Feb 2016 16:57:41 -0700">&lt;p&gt;Commit dd6057e79f34b5d30ca2a5fdafabac64cdec9c2a in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi" class="user-hover" rel="thetaphi"&gt;Uwe Schindler&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=dd6057e" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=dd6057e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7028" title="Remove useless clone of method in Lucene 6&amp;#39; LegacyNumericUtils" class="issue-link" data-issue-key="LUCENE-7028"&gt;&lt;del&gt;LUCENE-7028&lt;/del&gt;&lt;/a&gt;: Add changes for 5.5&lt;/p&gt;</comment>
                            <comment id="15146267" author="jira-bot" created="Sat, 13 Feb 2016 17:01:51 -0700">&lt;p&gt;Commit 3e5e548472ca7c285b76a610684f0c87d13e9572 in lucene-solr's branch refs/heads/branch_5x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi" class="user-hover" rel="thetaphi"&gt;Uwe Schindler&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3e5e548" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3e5e548&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7028" title="Remove useless clone of method in Lucene 6&amp;#39; LegacyNumericUtils" class="issue-link" data-issue-key="LUCENE-7028"&gt;&lt;del&gt;LUCENE-7028&lt;/del&gt;&lt;/a&gt;: Deprecate a duplicate method in NumericUtils&lt;/p&gt;</comment>
                            <comment id="15146272" author="jira-bot" created="Sat, 13 Feb 2016 17:06:06 -0700">&lt;p&gt;Commit a011c1692bba52c1f7b430b9bb4d03001fc1034a in lucene-solr's branch refs/heads/branch_5x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi" class="user-hover" rel="thetaphi"&gt;Uwe Schindler&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=a011c16" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=a011c16&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7028" title="Remove useless clone of method in Lucene 6&amp;#39; LegacyNumericUtils" class="issue-link" data-issue-key="LUCENE-7028"&gt;&lt;del&gt;LUCENE-7028&lt;/del&gt;&lt;/a&gt;: Fix typo&lt;/p&gt;</comment>
                            <comment id="15146273" author="jira-bot" created="Sat, 13 Feb 2016 17:09:15 -0700">&lt;p&gt;Commit 528fb8702b91aaeb7a0491a638ed10ae8ae57f2c in lucene-solr's branch refs/heads/branch_5_5 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi" class="user-hover" rel="thetaphi"&gt;Uwe Schindler&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=528fb87" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=528fb87&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7028" title="Remove useless clone of method in Lucene 6&amp;#39; LegacyNumericUtils" class="issue-link" data-issue-key="LUCENE-7028"&gt;&lt;del&gt;LUCENE-7028&lt;/del&gt;&lt;/a&gt;: Deprecate a duplicate method in NumericUtils&lt;/p&gt;</comment>
                            <comment id="15146275" author="thetaphi" created="Sat, 13 Feb 2016 17:10:34 -0700">&lt;p&gt;In addition to the removal in master, I deprecated in 5.5&lt;/p&gt;</comment>
                            <comment id="15146278" author="mikemccand" created="Sat, 13 Feb 2016 17:13:10 -0700">&lt;p&gt;OK, thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi" class="user-hover" rel="thetaphi"&gt;Uwe Schindler&lt;/a&gt;, I'll respin 5.5 now.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12938945">LUCENE-7027</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12787821" name="LUCENE-7028.patch" size="17467" author="thetaphi" created="Sat, 13 Feb 2016 11:22:08 -0700"/>
                            <attachment id="12787818" name="LUCENE-7028.patch" size="7755" author="thetaphi" created="Sat, 13 Feb 2016 10:32:21 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 13 Feb 2016 21:32:17 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2st93:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7027] NumericTermAttribute throws IAE after NumericTokenStream is exhausted</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7027</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;This small test:&lt;/p&gt;

&lt;div class="preformatted panel" style="border-width: 1px;"&gt;&lt;div class="preformattedContent panelContent"&gt;
&lt;pre&gt;  public void testCloneFullPrecisionToken() throws Exception {
    FieldType fieldType = new FieldType(IntField.TYPE_NOT_STORED);
    fieldType.setNumericPrecisionStep(Integer.MAX_VALUE);
    Field field = new IntField("field", 17, fieldType);
    TokenStream tokenStream = new CachingTokenFilter(field.tokenStream(null, null));
    assertTrue(tokenStream.incrementToken());
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;hits this unexpected exception:&lt;/p&gt;

&lt;div class="preformatted panel" style="border-width: 1px;"&gt;&lt;div class="preformattedContent panelContent"&gt;
&lt;pre&gt;There was 1 failure:
1) testCloneFullPrecisionToken(org.apache.lucene.analysis.TestNumericTokenStream)
java.lang.IllegalArgumentException: Illegal shift value, must be 0..31; got shift=2147483647
	at __randomizedtesting.SeedInfo.seed([2E1E93EF810CB5F7:EF1304A849574BC7]:0)
	at org.apache.lucene.util.NumericUtils.intToPrefixCodedBytes(NumericUtils.java:175)
	at org.apache.lucene.util.NumericUtils.intToPrefixCoded(NumericUtils.java:133)
	at org.apache.lucene.analysis.NumericTokenStream$NumericTermAttributeImpl.getBytesRef(NumericTokenStream.java:165)
	at org.apache.lucene.analysis.NumericTokenStream$NumericTermAttributeImpl.clone(NumericTokenStream.java:217)
	at org.apache.lucene.analysis.NumericTokenStream$NumericTermAttributeImpl.clone(NumericTokenStream.java:148)
	at org.apache.lucene.util.AttributeSource$State.clone(AttributeSource.java:55)
	at org.apache.lucene.util.AttributeSource.captureState(AttributeSource.java:288)
	at org.apache.lucene.analysis.CachingTokenFilter.fillCache(CachingTokenFilter.java:96)
	at org.apache.lucene.analysis.CachingTokenFilter.incrementToken(CachingTokenFilter.java:70)
	at org.apache.lucene.analysis.TestNumericTokenStream.testCloneFullPrecisionToken(TestNumericTokenStream.java:138)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;because &lt;tt&gt;CachingTokenFilter&lt;/tt&gt; expects that it can &lt;tt&gt;captureState&lt;/tt&gt; after calling &lt;tt&gt;end&lt;/tt&gt; but &lt;tt&gt;NumericTokenStream&lt;/tt&gt; gets angry about this.&lt;/p&gt;</description>
                <environment/>
        <key id="12938945">LUCENE-7027</key>
            <summary>NumericTermAttribute throws IAE after NumericTokenStream is exhausted</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thetaphi">Uwe Schindler</assignee>
                                    <reporter username="mikemccand">Michael McCandless</reporter>
                        <labels>
                    </labels>
                <created>Fri, 12 Feb 2016 15:19:27 -0700</created>
                <updated>Tue, 23 Feb 2016 03:40:02 -0700</updated>
                            <resolved>Sat, 13 Feb 2016 10:16:53 -0700</resolved>
                                    <version>5.5</version>
                    <version>master</version>
                    <version>6.0</version>
                                    <fixVersion>5.5</fixVersion>
                    <fixVersion>master</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="15145420" author="mikemccand" created="Fri, 12 Feb 2016 15:21:57 -0700">&lt;p&gt;This is the Elasticsearch issue where we are hitting this: &lt;a href="https://github.com/elastic/elasticsearch/pull/16643" class="external-link" rel="nofollow"&gt;https://github.com/elastic/elasticsearch/pull/16643&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Thanks to &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dakrone" class="user-hover" rel="dakrone"&gt;Lee Hinman&lt;/a&gt; for uncovering this!&lt;/p&gt;</comment>
                            <comment id="15145434" author="thetaphi" created="Fri, 12 Feb 2016 15:27:46 -0700">&lt;p&gt;CachingTokenFilter is a cool test. I can try to fix this. NumericTokenStream was originally thought as an implementation detail only called from DocumentsWriter, never wrapped by any filters &lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/smile.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt;&lt;/p&gt;

&lt;p&gt;I am sure, I can fix this.&lt;/p&gt;</comment>
                            <comment id="15145448" author="thetaphi" created="Fri, 12 Feb 2016 15:36:37 -0700">&lt;p&gt;The issue here is: After the tokenstream is exhausted (which is the case when you call end()), the attribute cannot be cloned anymore, because the call to getBytesRef() fails with IllegalArgument (which is a bug). We should work around that and just return empty bytesRef or like that.&lt;/p&gt;</comment>
                            <comment id="15145470" author="thetaphi" created="Fri, 12 Feb 2016 15:46:30 -0700">&lt;p&gt;Alternative test that fails:&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
  &lt;span class="code-keyword"&gt;public&lt;/span&gt; void testCaptureStateAfterExhausted() &lt;span class="code-keyword"&gt;throws&lt;/span&gt; Exception {
    &lt;span class="code-keyword"&gt;try&lt;/span&gt; (LegacyNumericTokenStream stream=&lt;span class="code-keyword"&gt;new&lt;/span&gt; LegacyNumericTokenStream().setIntValue(ivalue)) {
      stream.reset();
      &lt;span class="code-keyword"&gt;while&lt;/span&gt; (stream.incrementToken());
      stream.captureState();
      stream.end();
      stream.captureState();
    }
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;(this one does not use CachingTokenFilter, which is &lt;b&gt;not&lt;/b&gt; part of Lucene core).&lt;/p&gt;</comment>
                            <comment id="15145482" author="thetaphi" created="Fri, 12 Feb 2016 15:51:03 -0700">&lt;p&gt;Patch for master. I am not sure if this affects performance because we have the extra check on getBytes().&lt;/p&gt;</comment>
                            <comment id="15145540" author="thetaphi" created="Fri, 12 Feb 2016 16:24:24 -0700">&lt;p&gt;The cause is known and the issue reported here is just some broken usage of NumericTokenStream in user code that looks totally broken anyways, I tend to not fix it and I'd simply close this bug as won't fix. &lt;/p&gt;

&lt;p&gt;NumericTokenStream shouldn't have been public from the beginning... I have no idea why Elasticsearch uses the class at all! NRQ's field is just implemented as a TokenStream to allow DocumentsWriter to consume it, but it should have been hidden from beginning behind NumericField. Solr does not use it anymore - we removed it a while ago.&lt;/p&gt;

&lt;p&gt;In addition, NumericTokenStream was never written to be wrapped by TokenFilters &lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/smile.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt;&lt;/p&gt;</comment>
                            <comment id="15145917" author="mikemccand" created="Sat, 13 Feb 2016 03:22:05 -0700">&lt;blockquote&gt;&lt;p&gt;The cause is known and the issue reported here is just some broken usage of NumericTokenStream in user code that looks totally broken anyways,&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Hmm, I don't think this usage is broken?  The public &lt;tt&gt;TokenStream&lt;/tt&gt; API has a contract and the public &lt;tt&gt;NumericTokenStream&lt;/tt&gt; fails to implement it properly &lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/wink.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt;&lt;/p&gt;

&lt;p&gt;Or maybe you are saying one can never call &lt;tt&gt;captureState&lt;/tt&gt; after calling &lt;tt&gt;end&lt;/tt&gt;?  But then how does one hang onto the "final" offset and posInc?  And if so, I guess we should fix  &lt;tt&gt;MockTokenizer&lt;/tt&gt; to enforce this?  Yet, &lt;tt&gt;CachingTokenFilter&lt;/tt&gt; is doing exactly this, so maybe the bug is there?&lt;/p&gt;

&lt;p&gt;Our analysis APIs are way too complex!  They are like a 747 cockpit. We can't even agree on which buttons you are allowed to press, when.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I have no idea why Elasticsearch uses the class at all!&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Well, Elasticsearch's simple query parser is just trying to create the right "equals" query from the incoming text, for a numeric field.  Here's the query:&lt;/p&gt;

&lt;div class="preformatted panel" style="border-width: 1px;"&gt;&lt;div class="preformattedContent panelContent"&gt;
&lt;pre&gt;{"simple_query_string":{"query":"123","fields":["foo","bar"]}}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It does this today by using the appropriate tokenizer given the field type, and for numerics that's supposed to be &lt;tt&gt;NumericTokenStream&lt;/tt&gt;.  But then we hit this bug, seen in ES originally at &lt;a href="https://github.com/elastic/elasticsearch/issues/16577" class="external-link" rel="nofollow"&gt;https://github.com/elastic/elasticsearch/issues/16577&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Yes, ES can work around this bug if we leave Lucene buggy, which is exactly what that PR is doing, by "special casing" numerics by explicitly creating a &lt;tt&gt;TermQuery&lt;/tt&gt; using the full precision numeric term, instead of trusting its type-specific tokenizer to work correctly.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Because of the corner case and possible performance corner cases, I'd tend to close this as won't fix. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Hmm I think correctness trumps performance?&lt;/p&gt;</comment>
                            <comment id="15145918" author="thetaphi" created="Sat, 13 Feb 2016 03:29:58 -0700">&lt;p&gt;I have no problem committing the given patch. It allows to get an empty token attribute after the tokenstream is exhausted. It is the only correct way to fix it.&lt;/p&gt;

&lt;p&gt;I just mentioned this here to think about it (if we really need this). Bt I agree with you: &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Hmm I think correctness trumps performance?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/smile.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt;&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Or maybe you are saying one can never call captureState after calling end? But then how does one hang onto the "final" offset and posInc? And if so, I guess we should fix MockTokenizer to enforce this? Yet, CachingTokenFilter is doing exactly this, so maybe the bug is there?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That must be allowed, otherwise the whole thing like caching won't work. In addition, it is not only captueState that's broken, every thing done with TermAttribute leads to the IllegalArgEx, So it is not the tokenstream thats buggy its just the attribute implementation (and this is what the bug is fixing).&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Well, Elasticsearch's simple query parser is just trying to create the right "equals" query from the incoming text, for a numeric field.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;OK, I was not aware of that. The problem is that the query parser uses the CachingTokenFilter, I assume. right?&lt;/p&gt;</comment>
                            <comment id="15145921" author="thetaphi" created="Sat, 13 Feb 2016 03:48:52 -0700">&lt;p&gt;OK, I will commit this to "master". Should I backport to 5.5? I can backport to branch_5x, but thats useless if we don't put it into 5.5. I will just add another test to verify that also restoreState works &lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/smile.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt;&lt;/p&gt;</comment>
                            <comment id="15145933" author="thetaphi" created="Sat, 13 Feb 2016 04:27:22 -0700">&lt;p&gt;New patch with more tests (especially cloning)&lt;/p&gt;</comment>
                            <comment id="15145936" author="thetaphi" created="Sat, 13 Feb 2016 04:40:00 -0700">&lt;p&gt;Improved test to use random value throughout whole suite (unrelated to this issue, but still good thing to do).&lt;/p&gt;</comment>
                            <comment id="15146002" author="mikemccand" created="Sat, 13 Feb 2016 07:45:38 -0700">&lt;p&gt;Thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi" class="user-hover" rel="thetaphi"&gt;Uwe Schindler&lt;/a&gt;!  Patch looks good to me!&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The problem is that the query parser uses the CachingTokenFilter, I assume. right?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yeah ... it's &lt;tt&gt;SimpleQueryParser.java&lt;/tt&gt; in ES, and it seems to be poached maybe from &lt;tt&gt;AnalyzerQueryNodeProcessor.java&lt;/tt&gt; in Lucene's flexible query parser, where it needs to make two passes over the tokens the tokenizer created from the text, I think?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Should I backport to 5.5? &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1, I'll mark this blocker for 5.5, and cancel the current RC1 and respin.&lt;/p&gt;

&lt;p&gt;Thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi" class="user-hover" rel="thetaphi"&gt;Uwe Schindler&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="15146059" author="jira-bot" created="Sat, 13 Feb 2016 10:03:12 -0700">&lt;p&gt;Commit 42ae21cb9ae36dde4d5ffda16e06976b369b95e4 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi" class="user-hover" rel="thetaphi"&gt;Uwe Schindler&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=42ae21c" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=42ae21c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7027" title="NumericTermAttribute throws IAE after NumericTokenStream is exhausted" class="issue-link" data-issue-key="LUCENE-7027"&gt;&lt;del&gt;LUCENE-7027&lt;/del&gt;&lt;/a&gt;: Fixed NumericTermAttribute to not throw IllegalArgumentException after NumericTokenStream was exhausted&lt;/p&gt;</comment>
                            <comment id="15146064" author="jira-bot" created="Sat, 13 Feb 2016 10:13:50 -0700">&lt;p&gt;Commit 7abc0c6de6ae51f0b3b805c8d9d83185e78bff69 in lucene-solr's branch refs/heads/branch_5x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi" class="user-hover" rel="thetaphi"&gt;Uwe Schindler&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=7abc0c6" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=7abc0c6&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7027" title="NumericTermAttribute throws IAE after NumericTokenStream is exhausted" class="issue-link" data-issue-key="LUCENE-7027"&gt;&lt;del&gt;LUCENE-7027&lt;/del&gt;&lt;/a&gt;: Fixed NumericTermAttribute to not throw IllegalArgumentException after NumericTokenStream was exhausted&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Conflicts:&lt;/li&gt;
	&lt;li&gt;lucene/core/src/java/org/apache/lucene/analysis/NumericTokenStream.java&lt;/li&gt;
	&lt;li&gt;lucene/core/src/test/org/apache/lucene/analysis/TestNumericTokenStream.java&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="15146065" author="jira-bot" created="Sat, 13 Feb 2016 10:15:16 -0700">&lt;p&gt;Commit d83f57901f38334c103678b985cf875a9ef51013 in lucene-solr's branch refs/heads/branch_5_5 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi" class="user-hover" rel="thetaphi"&gt;Uwe Schindler&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d83f579" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d83f579&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7027" title="NumericTermAttribute throws IAE after NumericTokenStream is exhausted" class="issue-link" data-issue-key="LUCENE-7027"&gt;&lt;del&gt;LUCENE-7027&lt;/del&gt;&lt;/a&gt;: Fixed NumericTermAttribute to not throw IllegalArgumentException after NumericTokenStream was exhausted&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Conflicts:&lt;/li&gt;
	&lt;li&gt;lucene/core/src/java/org/apache/lucene/analysis/NumericTokenStream.java&lt;/li&gt;
	&lt;li&gt;lucene/core/src/test/org/apache/lucene/analysis/TestNumericTokenStream.java&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="15146068" author="thetaphi" created="Sat, 13 Feb 2016 10:16:53 -0700">&lt;p&gt;Thanks Mike &amp;amp; Lee!&lt;/p&gt;</comment>
                            <comment id="15146081" author="jira-bot" created="Sat, 13 Feb 2016 10:39:04 -0700">&lt;p&gt;Commit 40f15765ba7605d1b5f3897fc3f97f2848635d77 in lucene-solr's branch refs/heads/branch_5_5 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi" class="user-hover" rel="thetaphi"&gt;Uwe Schindler&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=40f1576" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=40f1576&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7027" title="NumericTermAttribute throws IAE after NumericTokenStream is exhausted" class="issue-link" data-issue-key="LUCENE-7027"&gt;&lt;del&gt;LUCENE-7027&lt;/del&gt;&lt;/a&gt;: Fix accidental deprecation of test&lt;/p&gt;</comment>
                            <comment id="15146083" author="jira-bot" created="Sat, 13 Feb 2016 10:39:32 -0700">&lt;p&gt;Commit aaa05e20e789afca2ebc8443b248d512318cd201 in lucene-solr's branch refs/heads/branch_5x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi" class="user-hover" rel="thetaphi"&gt;Uwe Schindler&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=aaa05e2" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=aaa05e2&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7027" title="NumericTermAttribute throws IAE after NumericTokenStream is exhausted" class="issue-link" data-issue-key="LUCENE-7027"&gt;&lt;del&gt;LUCENE-7027&lt;/del&gt;&lt;/a&gt;: Fix accidental deprecation of test&lt;/p&gt;</comment>
                            <comment id="15146190" author="mikemccand" created="Sat, 13 Feb 2016 14:10:02 -0700">&lt;p&gt;Thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi" class="user-hover" rel="thetaphi"&gt;Uwe Schindler&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="15146214" author="dakrone" created="Sat, 13 Feb 2016 14:49:56 -0700">&lt;p&gt;Thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi" class="user-hover" rel="thetaphi"&gt;Uwe Schindler&lt;/a&gt;!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12939035">LUCENE-7028</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12787799" name="LUCENE-7027-master.patch" size="4656" author="thetaphi" created="Sat, 13 Feb 2016 04:40:00 -0700"/>
                            <attachment id="12787798" name="LUCENE-7027-master.patch" size="4358" author="thetaphi" created="Sat, 13 Feb 2016 04:27:22 -0700"/>
                            <attachment id="12787748" name="LUCENE-7027-master.patch" size="1982" author="thetaphi" created="Fri, 12 Feb 2016 15:51:03 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 12 Feb 2016 22:27:46 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ssp3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7017] TestGeoPointQuery failure</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7017</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;I hit this while beasting for another issue:&lt;/p&gt;

&lt;div class="preformatted panel" style="border-width: 1px;"&gt;&lt;div class="preformattedContent panelContent"&gt;
&lt;pre&gt;-test:
    [mkdir] Created dir: /l/trunk/lucene/build/sandbox/test
[junit4:pickseed] Seed property 'tests.seed' already defined: 1EAB921E0532F649
    [mkdir] Created dir: /l/trunk/lucene/build/sandbox/test/temp
    [mkdir] Created dir: /l/trunk/.caches/test-stats/sandbox
   [junit4] &amp;lt;JUnit4&amp;gt; says ! Master seed: 1EAB921E0532F649
   [junit4] Executing 1 suite with 1 JVM.
   [junit4] 
   [junit4] Started J0 PID(19596@localhost).
   [junit4] Suite: org.apache.lucene.search.TestGeoPointQuery
   [junit4] OK      0.02s | TestGeoPointQuery.testInvalidGeoDistanceQuery
   [junit4] OK      0.07s | TestGeoPointQuery.testTooBigRadius
   [junit4] OK      0.03s | TestGeoPointQuery.testGeoDistanceQuery
   [junit4] OK      0.01s | TestGeoPointQuery.testPolyQuery
   [junit4] OK      0.02s | TestGeoPointQuery.testMultiValuedQuery
   [junit4] OK      0.27s | TestGeoPointQuery.testWholeMap
   [junit4] IGNOR/A 0.01s | TestGeoPointQuery.testRandomBig
   [junit4]    &amp;gt; Assumption #1: 'nightly' test group is disabled (@Nightly())
   [junit4] OK      0.01s | TestGeoPointQuery.testNonEmptyTermsEnum
   [junit4] OK      0.24s | TestGeoPointQuery.testEncodeDecode
   [junit4] OK      5.82s | TestGeoPointQuery.testMultiValued
   [junit4]   2&amp;gt; veebr 05, 2016 6:10:36 PM com.carrotsearch.randomizedtesting.RandomizedRunner$QueueUncaughtExceptionsHandler uncaughtException
   [junit4]   2&amp;gt; WARNING: Uncaught exception in thread: Thread[T0,5,TGRP-TestGeoPointQuery]
   [junit4]   2&amp;gt; java.lang.AssertionError
   [junit4]   2&amp;gt; 	at __randomizedtesting.SeedInfo.seed([1EAB921E0532F649]:0)
   [junit4]   2&amp;gt; 	at org.apache.lucene.search.GeoPointTermsEnum.&amp;lt;init&amp;gt;(GeoPointTermsEnum.java:65)
   [junit4]   2&amp;gt; 	at org.apache.lucene.search.GeoPointDistanceQueryImpl$GeoPointRadiusTermsEnum.&amp;lt;init&amp;gt;(GeoPointDistanceQueryImpl.java:58)
   [junit4]   2&amp;gt; 	at org.apache.lucene.search.GeoPointDistanceQueryImpl.getTermsEnum(GeoPointDistanceQueryImpl.java:47)
   [junit4]   2&amp;gt; 	at org.apache.lucene.search.MultiTermQuery.getTermsEnum(MultiTermQuery.java:304)
   [junit4]   2&amp;gt; 	at org.apache.lucene.search.GeoPointTermQueryConstantScoreWrapper$1.getDocIDs(GeoPointTermQueryConstantScoreWrapper.java:71)
   [junit4]   2&amp;gt; 	at org.apache.lucene.search.GeoPointTermQueryConstantScoreWrapper$1.scorer(GeoPointTermQueryConstantScoreWrapper.java:125)
   [junit4]   2&amp;gt; 	at org.apache.lucene.search.LRUQueryCache$CachingWrapperWeight.scorer(LRUQueryCache.java:617)
   [junit4]   2&amp;gt; 	at org.apache.lucene.search.AssertingWeight.scorer(AssertingWeight.java:61)
   [junit4]   2&amp;gt; 	at org.apache.lucene.search.BooleanWeight.scorer(BooleanWeight.java:389)
   [junit4]   2&amp;gt; 	at org.apache.lucene.search.LRUQueryCache$CachingWrapperWeight.scorer(LRUQueryCache.java:617)
   [junit4]   2&amp;gt; 	at org.apache.lucene.search.AssertingWeight.scorer(AssertingWeight.java:61)
   [junit4]   2&amp;gt; 	at org.apache.lucene.search.BooleanWeight.booleanScorer(BooleanWeight.java:343)
   [junit4]   2&amp;gt; 	at org.apache.lucene.search.BooleanWeight.bulkScorer(BooleanWeight.java:364)
   [junit4]   2&amp;gt; 	at org.apache.lucene.search.LRUQueryCache$CachingWrapperWeight.bulkScorer(LRUQueryCache.java:644)
   [junit4]   2&amp;gt; 	at org.apache.lucene.search.AssertingWeight.bulkScorer(AssertingWeight.java:68)
   [junit4]   2&amp;gt; 	at org.apache.lucene.search.AssertingWeight.bulkScorer(AssertingWeight.java:68)
   [junit4]   2&amp;gt; 	at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:666)
   [junit4]   2&amp;gt; 	at org.apache.lucene.search.AssertingIndexSearcher.search(AssertingIndexSearcher.java:91)
   [junit4]   2&amp;gt; 	at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:473)
   [junit4]   2&amp;gt; 	at org.apache.lucene.util.BaseGeoPointTestCase$VerifyHits.test(BaseGeoPointTestCase.java:485)
   [junit4]   2&amp;gt; 	at org.apache.lucene.util.BaseGeoPointTestCase$2._run(BaseGeoPointTestCase.java:741)
   [junit4]   2&amp;gt; 	at org.apache.lucene.util.BaseGeoPointTestCase$2.run(BaseGeoPointTestCase.java:608)
   [junit4]   2&amp;gt; 
   [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=TestGeoPointQuery -Dtests.method=testRandomMedium -Dtests.seed=1EAB921E0532F649 -Dtests.locale=et-EE -Dtests.timezone=Europe/Budapest -Dtests.asserts=true -Dtests.file.encoding=ISO-8859-1
   [junit4] ERROR   5.66s | TestGeoPointQuery.testRandomMedium &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: com.carrotsearch.randomizedtesting.UncaughtExceptionError: Captured an uncaught exception in thread: Thread[id=16, name=T0, state=RUNNABLE, group=TGRP-TestGeoPointQuery]
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([1EAB921E0532F649:A375A5B64457952F]:0)
   [junit4]    &amp;gt; Caused by: java.lang.AssertionError
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([1EAB921E0532F649]:0)
   [junit4]    &amp;gt; 	at org.apache.lucene.search.GeoPointTermsEnum.&amp;lt;init&amp;gt;(GeoPointTermsEnum.java:65)
   [junit4]    &amp;gt; 	at org.apache.lucene.search.GeoPointDistanceQueryImpl$GeoPointRadiusTermsEnum.&amp;lt;init&amp;gt;(GeoPointDistanceQueryImpl.java:58)
   [junit4]    &amp;gt; 	at org.apache.lucene.search.GeoPointDistanceQueryImpl.getTermsEnum(GeoPointDistanceQueryImpl.java:47)
   [junit4]    &amp;gt; 	at org.apache.lucene.search.MultiTermQuery.getTermsEnum(MultiTermQuery.java:304)
   [junit4]    &amp;gt; 	at org.apache.lucene.search.GeoPointTermQueryConstantScoreWrapper$1.getDocIDs(GeoPointTermQueryConstantScoreWrapper.java:71)
   [junit4]    &amp;gt; 	at org.apache.lucene.search.GeoPointTermQueryConstantScoreWrapper$1.scorer(GeoPointTermQueryConstantScoreWrapper.java:125)
   [junit4]    &amp;gt; 	at org.apache.lucene.search.LRUQueryCache$CachingWrapperWeight.scorer(LRUQueryCache.java:617)
   [junit4]    &amp;gt; 	at org.apache.lucene.search.AssertingWeight.scorer(AssertingWeight.java:61)
   [junit4]    &amp;gt; 	at org.apache.lucene.search.BooleanWeight.scorer(BooleanWeight.java:389)
   [junit4]    &amp;gt; 	at org.apache.lucene.search.LRUQueryCache$CachingWrapperWeight.scorer(LRUQueryCache.java:617)
   [junit4]    &amp;gt; 	at org.apache.lucene.search.AssertingWeight.scorer(AssertingWeight.java:61)
   [junit4]    &amp;gt; 	at org.apache.lucene.search.BooleanWeight.booleanScorer(BooleanWeight.java:343)
   [junit4]    &amp;gt; 	at org.apache.lucene.search.BooleanWeight.bulkScorer(BooleanWeight.java:364)
   [junit4]    &amp;gt; 	at org.apache.lucene.search.LRUQueryCache$CachingWrapperWeight.bulkScorer(LRUQueryCache.java:644)
   [junit4]    &amp;gt; 	at org.apache.lucene.search.AssertingWeight.bulkScorer(AssertingWeight.java:68)
   [junit4]    &amp;gt; 	at org.apache.lucene.search.AssertingWeight.bulkScorer(AssertingWeight.java:68)
   [junit4]    &amp;gt; 	at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:666)
   [junit4]    &amp;gt; 	at org.apache.lucene.search.AssertingIndexSearcher.search(AssertingIndexSearcher.java:91)
   [junit4]    &amp;gt; 	at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:473)
   [junit4]    &amp;gt; 	at org.apache.lucene.util.BaseGeoPointTestCase$VerifyHits.test(BaseGeoPointTestCase.java:485)
   [junit4]    &amp;gt; 	at org.apache.lucene.util.BaseGeoPointTestCase$2._run(BaseGeoPointTestCase.java:741)
   [junit4]    &amp;gt; 	at org.apache.lucene.util.BaseGeoPointTestCase$2.run(BaseGeoPointTestCase.java:608)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is on commit #4569fd732aa1406763ed94f5df830b324a584a6b on master.&lt;/p&gt;</description>
                <environment/>
        <key id="12937083">LUCENE-7017</key>
            <summary>TestGeoPointQuery failure</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="mikemccand">Michael McCandless</reporter>
                        <labels>
                    </labels>
                <created>Fri, 5 Feb 2016 10:12:55 -0700</created>
                <updated>Fri, 5 Feb 2016 10:12:55 -0700</updated>
                                                            <fixVersion>6.0</fixVersion>
                    <fixVersion>trunk</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                        <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2shfz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>

<item>
            <title>[LUCENE-7015] Refactor spatial module to spatial-extras</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7015</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;Follow on to &lt;a href="https://issues.apache.org/jira/browse/LUCENE-6997" title="Graduate GeoUtils and postings based GeoPointField from sandbox..." class="issue-link" data-issue-key="LUCENE-6997"&gt;&lt;del&gt;LUCENE-6997&lt;/del&gt;&lt;/a&gt;: non GeoPoint* classes need to be refactored from existing spatial module to a new spatial-extras module. All dev-tools, build and project files will be updated to correctly reference and build the new module.&lt;/p&gt;</description>
                <environment/>
        <key id="12936861">LUCENE-7015</key>
            <summary>Refactor spatial module to spatial-extras</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="11">Done</resolution>
                                        <assignee username="nknize">Nicholas Knize</assignee>
                                    <reporter username="nknize">Nicholas Knize</reporter>
                        <labels>
                            <label>blocker</label>
                    </labels>
                <created>Thu, 4 Feb 2016 14:24:04 -0700</created>
                <updated>Wed, 2 Mar 2016 07:16:03 -0700</updated>
                            <resolved>Mon, 29 Feb 2016 16:52:25 -0700</resolved>
                                                    <fixVersion>6.0</fixVersion>
                                    <component>modules/spatial</component>
                        <due/>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="15140274" author="nknize" created="Tue, 9 Feb 2016 21:13:20 -0700">&lt;p&gt;Patch includes:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Refactor original lucene spatial classes from spatial module to new spatial-extras module&lt;/li&gt;
	&lt;li&gt;Updates build scripts and project files to build new module&lt;/li&gt;
	&lt;li&gt;Includes feedback from &lt;a href="https://issues.apache.org/jira/browse/LUCENE-6997" title="Graduate GeoUtils and postings based GeoPointField from sandbox..." class="issue-link" data-issue-key="LUCENE-6997"&gt;&lt;del&gt;LUCENE-6997&lt;/del&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Passes &lt;tt&gt;ant idea&lt;/tt&gt; &lt;tt&gt;generate-maven-artfacts&lt;/tt&gt; and &lt;tt&gt;precommit&lt;/tt&gt; Would love another round of review from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe" class="user-hover" rel="steve_rowe"&gt;Steve Rowe&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15140983" author="steve_rowe" created="Wed, 10 Feb 2016 08:24:37 -0700">&lt;p&gt;I'll take a look later today.&lt;/p&gt;</comment>
                            <comment id="15144706" author="mikemccand" created="Fri, 12 Feb 2016 08:29:59 -0700">&lt;p&gt;I think this is a blocker for 6.0.0 release?&lt;/p&gt;</comment>
                            <comment id="15156211" author="nknize" created="Sun, 21 Feb 2016 13:18:02 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mikemccand" class="user-hover" rel="mikemccand"&gt;Michael McCandless&lt;/a&gt; Yes, this is a blocker for 6.0. Anyone have a chance to review this refactor?&lt;/p&gt;</comment>
                            <comment id="15156213" author="steve_rowe" created="Sun, 21 Feb 2016 13:24:37 -0700">&lt;p&gt;Applying the patch now, but several classes have moved packages since the patch on this issue (manually adjusting), e.g. GeoPointDistanceRangeQuery.java&lt;/p&gt;</comment>
                            <comment id="15156217" author="nknize" created="Sun, 21 Feb 2016 13:41:08 -0700">&lt;p&gt;++ Thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe" class="user-hover" rel="steve_rowe"&gt;Steve Rowe&lt;/a&gt; I'll update the patch&lt;/p&gt;</comment>
                            <comment id="15156298" author="nknize" created="Sun, 21 Feb 2016 16:48:54 -0700">&lt;p&gt;Updated patch to include spatial refactor from 5.5 release&lt;/p&gt;</comment>
                            <comment id="15158154" author="steve_rowe" created="Mon, 22 Feb 2016 19:10:38 -0700">&lt;p&gt;Thanks Nick, LGTM.&lt;/p&gt;

&lt;p&gt;A couple nits:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Your patch includes import/whitespace-trimming-only changes 4 Solr .java files - those changes should be made elsewhere, not on this issue.&lt;/li&gt;
	&lt;li&gt;In &lt;tt&gt;spatial-extras/build.xml&lt;/tt&gt;, the "spatialextrasjar" path id is a misnomer, should be spatial4j-jar or something like that (in spatial module it's currently named "spatialjar")&lt;/li&gt;
	&lt;li&gt;In &lt;tt&gt;spatial-extras/build.xml&lt;/tt&gt;: spatial4j-tests.jar should go to test-lib/ instead of lib/ (note that this same issue was present in the spatial module, I'm fine with leaving this as-is for this JIRA).&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15172731" author="jira-bot" created="Mon, 29 Feb 2016 15:19:50 -0700">&lt;p&gt;Commit 89db4950b9e2aee605d4313592466ad699ea7523 in lucene-solr's branch refs/heads/master from nknize&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=89db495" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=89db495&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7015" title="Refactor spatial module to spatial-extras" class="issue-link" data-issue-key="LUCENE-7015"&gt;&lt;del&gt;LUCENE-7015&lt;/del&gt;&lt;/a&gt;: Refactor spatial module to spatial-extras&lt;/p&gt;

&lt;p&gt;Refactors non GeoPoint* classes from existing spatial module to a new spatial-extras module. dev-tools, build, and project files are updated to include new spatial-extras module.&lt;/p&gt;</comment>
                            <comment id="15172835" author="mikemccand" created="Mon, 29 Feb 2016 16:15:09 -0700">&lt;p&gt;Thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nknize" class="user-hover" rel="nknize"&gt;Nicholas Knize&lt;/a&gt;, can this be resolved now?  It's the only 6.0 blocker &lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/wink.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt;&lt;/p&gt;</comment>
                            <comment id="15173000" author="jira-bot" created="Mon, 29 Feb 2016 17:50:45 -0700">&lt;p&gt;Commit dc39fc3e5a99e70aebf70fa565f7868e2544e9ca in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=dc39fc3" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=dc39fc3&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7015" title="Refactor spatial module to spatial-extras" class="issue-link" data-issue-key="LUCENE-7015"&gt;&lt;del&gt;LUCENE-7015&lt;/del&gt;&lt;/a&gt;: "fix" package-info/javadocs issues across duplicated packages.&lt;/p&gt;</comment>
                            <comment id="15174664" author="gus_heck" created="Tue, 1 Mar 2016 17:09:15 -0700">&lt;p&gt;When I updated today, saw red, ran "ant idea" and still a bunch of things turned red. (in IDEA) and I started getting this: &lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
BUILD FAILED
/Users/gus/projects/solr/git/lucene-solr/build.xml:117: The following error occurred &lt;span class="code-keyword"&gt;while&lt;/span&gt; executing &lt;span class="code-keyword"&gt;this&lt;/span&gt; line:
/Users/gus/projects/solr/git/lucene-solr/lucene/build.xml:115: The following error occurred &lt;span class="code-keyword"&gt;while&lt;/span&gt; executing &lt;span class="code-keyword"&gt;this&lt;/span&gt; line:
/Users/gus/projects/solr/git/lucene-solr/lucene/common-build.xml:2187: The following error occurred &lt;span class="code-keyword"&gt;while&lt;/span&gt; executing &lt;span class="code-keyword"&gt;this&lt;/span&gt; line:
/Users/gus/projects/solr/git/lucene-solr/lucene/common-build.xml:2389: Check &lt;span class="code-keyword"&gt;for&lt;/span&gt; forbidden API calls failed: java.lang.ClassNotFoundException: com.spatial4j.core.context.SpatialContext
        at de.thetaphi.forbiddenapis.Checker.getClassFromClassLoader(Checker.java:264)
        at de.thetaphi.forbiddenapis.Checker.lookupRelatedClass(Checker.java:277)
        at de.thetaphi.forbiddenapis.ClassScanner.checkType(ClassScanner.java:178)
        at de.thetaphi.forbiddenapis.ClassScanner.checkType(ClassScanner.java:191)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Also I notice your commit contains workspace.xml... this is against JetBrain's reccomendations for working with version control systems: &lt;a href="https://intellij-support.jetbrains.com/hc/en-us/articles/206544839" class="external-link" rel="nofollow"&gt;https://intellij-support.jetbrains.com/hc/en-us/articles/206544839&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15174694" author="steve_rowe" created="Tue, 1 Mar 2016 17:29:28 -0700">&lt;blockquote&gt;&lt;p&gt;Also I notice your commit contains workspace.xml... this is against JetBrain's reccomendations for working with version control systems: &lt;a href="https://intellij-support.jetbrains.com/hc/en-us/articles/206544839" class="external-link" rel="nofollow"&gt;https://intellij-support.jetbrains.com/hc/en-us/articles/206544839&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The checked-in workspace.xml (along with the other IntelliJ config files) is at a different location (under dev-tools/idea/) than the one used in your working directory - &lt;tt&gt;ant idea&lt;/tt&gt; copies them into place.  The checked-in version contains a run configuration to run all JUnit tests for each module in the project, which I think has some value.&lt;/p&gt;

&lt;p&gt;But you (and JetBrains) are right in pointing out that sharing config like this is problematic when it contains per-user settings.  Right now, we recommend running &lt;tt&gt;ant clean-idea idea&lt;/tt&gt; to blow away your local config before copying the checked-in one into place, and this of course means you lose any local settings.  &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley" class="user-hover" rel="dsmiley"&gt;David Smiley&lt;/a&gt; has worked out a way to symlink rather than copy these config files into place, which theoretically allows for maintaining local modifications - see the writeup, starting at "An alternative approach to use symbolic links", at &lt;a href="https://wiki.apache.org/lucene-java/HowtoConfigureIntelliJ" class="external-link" rel="nofollow"&gt;https://wiki.apache.org/lucene-java/HowtoConfigureIntelliJ&lt;/a&gt;.  I'm not sure if/how this interacts with the new git setup though.&lt;/p&gt;</comment>
                            <comment id="15175639" author="gus_heck" created="Wed, 2 Mar 2016 07:08:18 -0700">&lt;p&gt;Yeah, for example it blows away all MY run configurations for the tests I was working on. As for symlinks, Ant has a &amp;lt;symlink&amp;gt; task which has options for making symlinks and even persisting them so they can be checked in as a properties file and re-constituted.&lt;/p&gt;</comment>
                            <comment id="15175644" author="steve_rowe" created="Wed, 2 Mar 2016 07:16:03 -0700">&lt;blockquote&gt;&lt;p&gt;Yeah, for example it blows away all MY run configurations for the tests I was working on. As for symlinks, Ant has a &amp;lt;symlink&amp;gt; task which has options for making symlinks and even persisting them so they can be checked in as a properties file and re-constituted.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Right.  I think the ideal thing, assuming it's useful to maintain an OOTB set of run configurations, is for &lt;tt&gt;ant idea&lt;/tt&gt; to merge the OOTB set into the user's workspace.xml rather than just copying over it.  You could manually do that, too, but it's probably easier just to re-create them.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12788936" name="LUCENE-7015.patch" size="107064" author="nknize" created="Sun, 21 Feb 2016 16:48:54 -0700"/>
                            <attachment id="12787211" name="LUCENE-7015.patch" size="123579" author="nknize" created="Tue, 9 Feb 2016 21:13:20 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 10 Feb 2016 15:24:37 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2sg2n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-7011] TestSimpleTextPointFormat.testWithExceptions() failure</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-7011</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;My Jenkins found a reproducible seed:&lt;/p&gt;

&lt;div class="preformatted panel" style="border-width: 1px;"&gt;&lt;div class="preformattedContent panelContent"&gt;
&lt;pre&gt;   [junit4] Suite: org.apache.lucene.codecs.simpletext.TestSimpleTextPointFormat
   [junit4] IGNOR/A 0.01s J5 | TestSimpleTextPointFormat.testMergeStability
   [junit4]    &amp;gt; Assumption #1: merge is not stable
   [junit4]   2&amp;gt; NOTE: download the large Jenkins line-docs file by running 'ant get-jenkins-line-docs' in the lucene directory.
   [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=TestSimpleTextPointFormat -Dtests.method=testWithExceptions -Dtests.seed=73B4A097F1853FC0 -Dtests.multiplier=2 -Dtests.nightly=true -Dtests.slow=true -Dtests.linedocsfile=/home/jenkins/lucene-data/enwiki.random.lines.txt -Dtests.locale=ar-YE -Dtests.timezone=America/Curacao -Dtests.asserts=true -Dtests.file.encoding=UTF-8
   [junit4] ERROR   0.24s J5 | TestSimpleTextPointFormat.testWithExceptions &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: java.lang.RuntimeException: MockDirectoryWrapper: cannot close: there are still open files: {_0_bkd_0.tmp=1}
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([73B4A097F1853FC0:D1E73CEB7E0B703A]:0)
   [junit4]    &amp;gt; 	at org.apache.lucene.store.MockDirectoryWrapper.close(MockDirectoryWrapper.java:771)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.BasePointFormatTestCase.testWithExceptions(BasePointFormatTestCase.java:253)
   [junit4]    &amp;gt; 	at java.lang.Thread.run(Thread.java:745)
   [junit4]    &amp;gt; Caused by: java.lang.RuntimeException: unclosed IndexOutput: _0_bkd_0.tmp
   [junit4]    &amp;gt; 	at org.apache.lucene.store.MockDirectoryWrapper.addFileHandle(MockDirectoryWrapper.java:659)
   [junit4]    &amp;gt; 	at org.apache.lucene.store.MockDirectoryWrapper.createTempOutput(MockDirectoryWrapper.java:631)
   [junit4]    &amp;gt; 	at org.apache.lucene.store.FilterDirectory.createTempOutput(FilterDirectory.java:78)
   [junit4]    &amp;gt; 	at org.apache.lucene.store.TrackingDirectoryWrapper.createTempOutput(TrackingDirectoryWrapper.java:51)
   [junit4]    &amp;gt; 	at org.apache.lucene.store.TrackingDirectoryWrapper.createTempOutput(TrackingDirectoryWrapper.java:51)
   [junit4]    &amp;gt; 	at org.apache.lucene.util.bkd.OfflinePointWriter.&amp;lt;init&amp;gt;(OfflinePointWriter.java:39)
   [junit4]    &amp;gt; 	at org.apache.lucene.util.bkd.BKDWriter.switchToOffline(BKDWriter.java:198)
   [junit4]    &amp;gt; 	at org.apache.lucene.util.bkd.BKDWriter.add(BKDWriter.java:217)
   [junit4]    &amp;gt; 	at org.apache.lucene.codecs.simpletext.SimpleTextPointWriter$2.visit(SimpleTextPointWriter.java:164)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.PointValuesWriter$1.intersect(PointValuesWriter.java:75)
   [junit4]    &amp;gt; 	at org.apache.lucene.codecs.simpletext.SimpleTextPointWriter.writeField(SimpleTextPointWriter.java:157)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.PointValuesWriter.flush(PointValuesWriter.java:66)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.DefaultIndexingChain.writePoints(DefaultIndexingChain.java:172)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.DefaultIndexingChain.flush(DefaultIndexingChain.java:107)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.DocumentsWriterPerThread.flush(DocumentsWriterPerThread.java:425)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.DocumentsWriter.doFlush(DocumentsWriter.java:502)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.DocumentsWriter.flushAllThreads(DocumentsWriter.java:614)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.IndexWriter.doFlush(IndexWriter.java:3099)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.IndexWriter.flush(IndexWriter.java:3074)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.IndexWriter.forceMerge(IndexWriter.java:1727)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.IndexWriter.forceMerge(IndexWriter.java:1707)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.RandomIndexWriter.forceMerge(RandomIndexWriter.java:422)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.BasePointFormatTestCase.verify(BasePointFormatTestCase.java:663)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.BasePointFormatTestCase.testWithExceptions(BasePointFormatTestCase.java:222)
   [junit4]    &amp;gt; 	... 36 more
   [junit4] IGNOR/A 0.00s J5 | TestSimpleTextPointFormat.testRandomBinaryBig
   [junit4]    &amp;gt; Assumption #1: too slow with SimpleText
   [junit4]   2&amp;gt; NOTE: leaving temporary files on disk at: /var/lib/jenkins/jobs/Lucene-Solr-Nightly-5.x-Java8/workspace/lucene/build/codecs/test/J5/temp/lucene.codecs.simpletext.TestSimpleTextPointFormat_73B4A097F1853FC0-001
   [junit4]   2&amp;gt; NOTE: test params are: codec=Asserting(Lucene60): {}, docValues:{}, sim=RandomSimilarity(queryNorm=true,coord=crazy): {}, locale=ar-YE, timezone=America/Curacao
   [junit4]   2&amp;gt; NOTE: Linux 4.1.0-custom2-amd64 amd64/Oracle Corporation 1.8.0_45 (64-bit)/cpus=16,threads=1,free=415913304,total=536346624
   [junit4]   2&amp;gt; NOTE: All tests run in this JVM: [TestSimpleTextPostingsFormat, TestFixedGapPostingsFormat, TestSimpleTextPointFormat]
   [junit4] Completed [17/22 (1!)] on J5 in 47.49s, 16 tests, 1 error, 2 skipped &amp;lt;&amp;lt;&amp;lt; FAILURES!
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment/>
        <key id="12936331">LUCENE-7011</key>
            <summary>TestSimpleTextPointFormat.testWithExceptions() failure</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mikemccand">Michael McCandless</assignee>
                                    <reporter username="steve_rowe">Steve Rowe</reporter>
                        <labels>
                    </labels>
                <created>Wed, 3 Feb 2016 06:22:03 -0700</created>
                <updated>Thu, 4 Feb 2016 10:17:35 -0700</updated>
                            <resolved>Wed, 3 Feb 2016 08:19:44 -0700</resolved>
                                                    <fixVersion>master</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="15130522" author="mikemccand" created="Wed, 3 Feb 2016 08:01:14 -0700">&lt;p&gt;I'll take this ... must be missing heroics somewhere in SimpleTextPointFormat.&lt;/p&gt;</comment>
                            <comment id="15130541" author="jira-bot" created="Wed, 3 Feb 2016 08:19:07 -0700">&lt;p&gt;Commit 3a889301c7436f679eacfe8baedab30e7cce0522 in lucene-solr's branch refs/heads/master from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3a88930" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3a88930&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7011" title="TestSimpleTextPointFormat.testWithExceptions() failure" class="issue-link" data-issue-key="LUCENE-7011"&gt;&lt;del&gt;LUCENE-7011&lt;/del&gt;&lt;/a&gt;: use try-w-resources&lt;/p&gt;</comment>
                            <comment id="15130542" author="mikemccand" created="Wed, 3 Feb 2016 08:19:44 -0700">&lt;p&gt;Thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe" class="user-hover" rel="steve_rowe"&gt;Steve Rowe&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="15132622" author="jira-bot" created="Thu, 4 Feb 2016 10:17:35 -0700">&lt;p&gt;Commit 3a889301c7436f679eacfe8baedab30e7cce0522 in lucene-solr's branch refs/heads/lucene-6835 from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3a88930" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3a88930&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7011" title="TestSimpleTextPointFormat.testWithExceptions() failure" class="issue-link" data-issue-key="LUCENE-7011"&gt;&lt;del&gt;LUCENE-7011&lt;/del&gt;&lt;/a&gt;: use try-w-resources&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 3 Feb 2016 15:01:14 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2scsv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-6999] Lucene60PointsWriter has a buggy close method</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-6999</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;This will leak a file handle on e.g. disk full or other exceptions&lt;/p&gt;
&lt;div class="preformatted panel" style="border-width: 1px;"&gt;&lt;div class="preformattedContent panelContent"&gt;
&lt;pre&gt;  @Override
  public void close() throws IOException {
    if (closed == false) {
      CodecUtil.writeFooter(dataOut); // something bad happens
      dataOut.close();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I'm not a fan of these complex close methods, should we add a finish() to the codec api or similar?&lt;/p&gt;</description>
                <environment/>
        <key id="12934704">LUCENE-6999</key>
            <summary>Lucene60PointsWriter has a buggy close method</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mikemccand">Michael McCandless</assignee>
                                    <reporter username="rcmuir">Robert Muir</reporter>
                        <labels>
                    </labels>
                <created>Wed, 27 Jan 2016 23:32:32 -0700</created>
                <updated>Thu, 28 Jan 2016 09:04:03 -0700</updated>
                            <resolved>Thu, 28 Jan 2016 09:03:53 -0700</resolved>
                                                    <fixVersion>master</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="15120882" author="rcmuir" created="Wed, 27 Jan 2016 23:34:11 -0700">&lt;p&gt;Here's a test. It just adds Points to a few of the indexing tests like disk full / exception handling / etc.&lt;/p&gt;

&lt;p&gt;I see the leak with this seed:&lt;/p&gt;

&lt;div class="preformatted panel" style="border-width: 1px;"&gt;&lt;div class="preformattedContent panelContent"&gt;
&lt;pre&gt;ant test  -Dtestcase=TestIndexWriterOnVMError -Dtests.method=testUnknownError -Dtests.seed=19BD5BF64D5924E1 -Dtests.locale=vi-VN -Dtests.timezone=Asia/Baku -Dtests.asserts=true -Dtests.file.encoding=UTF-8
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15121131" author="mikemccand" created="Thu, 28 Jan 2016 02:53:11 -0700">&lt;p&gt;Thanks Rob, I'll add heroic exception handling here ... I like the finish() idea.&lt;/p&gt;</comment>
                            <comment id="15121190" author="mikemccand" created="Thu, 28 Jan 2016 03:35:08 -0700">&lt;p&gt;Here's a patch, folding in &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;'s test changes, and adding a &lt;tt&gt;finish&lt;/tt&gt; method to &lt;tt&gt;PointWriter&lt;/tt&gt;, and fixing segment flushing and merging to call it, heroically.&lt;/p&gt;</comment>
                            <comment id="15121194" author="thetaphi" created="Thu, 28 Jan 2016 03:37:59 -0700">&lt;p&gt;Looks better, like it!&lt;/p&gt;</comment>
                            <comment id="15121262" author="rcmuir" created="Thu, 28 Jan 2016 04:44:13 -0700">&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="15121778" author="jira-bot" created="Thu, 28 Jan 2016 09:02:21 -0700">&lt;p&gt;Commit 791ddc627be6281f878cc2320247299582906757 in lucene-solr's branch refs/heads/master from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=791ddc6" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=791ddc6&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-6999" title="Lucene60PointsWriter has a buggy close method" class="issue-link" data-issue-key="LUCENE-6999"&gt;&lt;del&gt;LUCENE-6999&lt;/del&gt;&lt;/a&gt;: break out PointWriter.finish from .close to avoid leaking file handles on exception&lt;/p&gt;</comment>
                            <comment id="15121783" author="mikemccand" created="Thu, 28 Jan 2016 09:04:03 -0700">&lt;p&gt;This only affect trunk.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12784892" name="LUCENE-6999.patch" size="15551" author="mikemccand" created="Thu, 28 Jan 2016 03:35:08 -0700"/>
                            <attachment id="12784842" name="LUCENE-6999_test.patch" size="8870" author="rcmuir" created="Wed, 27 Jan 2016 23:34:11 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 28 Jan 2016 09:53:11 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2s2sn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-6998] We should detect truncation for all index files</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-6998</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt; noticed that &lt;tt&gt;Lucene60PointReader&lt;/tt&gt; does not detect truncation of its data file on reader init ... so I added a test to catch this, confirmed it caught the bug, and fixed the bug, and fixed a couple other things uncovered by the test.&lt;/p&gt;

&lt;p&gt;I also improved the other &lt;tt&gt;TestAllFiles*&lt;/tt&gt; tests to use &lt;tt&gt;LineFileDocs&lt;/tt&gt; so they index points, and it caught another bug in &lt;tt&gt;Lucene60PointFormat&lt;/tt&gt; (using the same codec name in two files).&lt;/p&gt;

&lt;p&gt;There is more to do here, e.g. we also need a test that catches places where we fail to check the index header on init, which was also missing for &lt;tt&gt;Lucene60PointReader&lt;/tt&gt;.&lt;/p&gt;</description>
                <environment/>
        <key id="12934606">LUCENE-6998</key>
            <summary>We should detect truncation for all index files</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mikemccand">Michael McCandless</assignee>
                                    <reporter username="mikemccand">Michael McCandless</reporter>
                        <labels>
                    </labels>
                <created>Wed, 27 Jan 2016 15:41:44 -0700</created>
                <updated>Tue, 23 Feb 2016 03:40:19 -0700</updated>
                            <resolved>Wed, 10 Feb 2016 09:28:29 -0700</resolved>
                                                    <fixVersion>5.5</fixVersion>
                    <fixVersion>master</fixVersion>
                    <fixVersion>6.0</fixVersion>
                    <fixVersion>5.4.2</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="15120328" author="mikemccand" created="Wed, 27 Jan 2016 15:45:02 -0700">&lt;p&gt;Patch, I think it's close.&lt;/p&gt;</comment>
                            <comment id="15120346" author="mikemccand" created="Wed, 27 Jan 2016 15:55:30 -0700">&lt;p&gt;Woops, first patch missed the new test ...&lt;/p&gt;</comment>
                            <comment id="15120352" author="rcmuir" created="Wed, 27 Jan 2016 15:59:33 -0700">&lt;p&gt;+1, especially for this test. These crazy ctors were "manually stared at" before, this is way better.&lt;/p&gt;

&lt;p&gt;after this issue we can look at converting some of the other tests (e.g. TestIndexWriterExceptions2) to also use Points.&lt;/p&gt;

&lt;p&gt;when pushing can you change the comment for the new test (TestAllFilesDetectTruncation) ?&lt;/p&gt;</comment>
                            <comment id="15121091" author="mikemccand" created="Thu, 28 Jan 2016 02:27:41 -0700">&lt;p&gt;Another iteration, I think it's ready.&lt;/p&gt;

&lt;p&gt;I added two more test cases, one of which catches the missing &lt;tt&gt;checkIndexHeader&lt;/tt&gt; from &lt;tt&gt;Lucene60PointReader&lt;/tt&gt;, the other one verifies that swapping in the same file name from another index into your index is always detected as corruption.&lt;/p&gt;</comment>
                            <comment id="15121140" author="jira-bot" created="Thu, 28 Jan 2016 03:01:17 -0700">&lt;p&gt;Commit af3a19574e6242e1b29f2fb8861bbcc977f23435 in lucene-solr's branch refs/heads/master from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=af3a195" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=af3a195&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-6998" title="We should detect truncation for all index files" class="issue-link" data-issue-key="LUCENE-6998"&gt;&lt;del&gt;LUCENE-6998&lt;/del&gt;&lt;/a&gt;: fix a couple places to better detect truncated index files; improve corruption testing&lt;/p&gt;</comment>
                            <comment id="15121179" author="jira-bot" created="Thu, 28 Jan 2016 03:31:33 -0700">&lt;p&gt;Commit 5e5a9cad9aa86555648099c262febe7a516ba48a in lucene-solr's branch refs/heads/branch_5x from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=5e5a9ca" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=5e5a9ca&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-6998" title="We should detect truncation for all index files" class="issue-link" data-issue-key="LUCENE-6998"&gt;&lt;del&gt;LUCENE-6998&lt;/del&gt;&lt;/a&gt;: fix a couple places to better detect truncated index files; improve corruption testing&lt;/p&gt;

&lt;p&gt;Conflicts:&lt;br/&gt;
	lucene/core/src/java/org/apache/lucene/codecs/lucene60/Lucene60PointFormat.java&lt;br/&gt;
	lucene/core/src/java/org/apache/lucene/codecs/lucene60/Lucene60PointReader.java&lt;br/&gt;
	lucene/core/src/java/org/apache/lucene/codecs/lucene60/Lucene60PointWriter.java&lt;/p&gt;</comment>
                            <comment id="15121890" author="steve_rowe" created="Thu, 28 Jan 2016 10:01:34 -0700">&lt;blockquote&gt;
&lt;p&gt;Conflicts:&lt;br/&gt;
lucene/core/src/java/org/apache/lucene/codecs/lucene60/Lucene60PointFormat.java&lt;br/&gt;
lucene/core/src/java/org/apache/lucene/codecs/lucene60/Lucene60PointReader.java&lt;br/&gt;
lucene/core/src/java/org/apache/lucene/codecs/lucene60/Lucene60PointWriter.java&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Should we worry about these?  (I haven't looked at the details.)&lt;/p&gt;</comment>
                            <comment id="15121901" author="mikemccand" created="Thu, 28 Jan 2016 10:05:41 -0700">&lt;blockquote&gt;&lt;p&gt;Should we worry about these?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This is git being wonderfully honest (the same reason why I love the "merge bubbles").&lt;/p&gt;

&lt;p&gt;On backport, git told me there were conflicts, since these files were changed in master but don't exist in 5.x ("points" is a 6.0 only feature).  So I removed them, and left this default commit message generated by git to preserve its honesty ....&lt;/p&gt;

&lt;p&gt;So I don't think we need to worry &lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/wink.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt;&lt;/p&gt;</comment>
                            <comment id="15121918" author="steve_rowe" created="Thu, 28 Jan 2016 10:16:41 -0700">&lt;p&gt;+1, thanks Mike&lt;/p&gt;</comment>
                            <comment id="15141033" author="mikemccand" created="Wed, 10 Feb 2016 08:51:01 -0700">&lt;p&gt;Reopen for backport to 5.4.2.&lt;/p&gt;</comment>
                            <comment id="15141095" author="jira-bot" created="Wed, 10 Feb 2016 09:27:39 -0700">&lt;p&gt;Commit df30bc6c5b4855fcd95c3660fdd2991d0e9c58bf in lucene-solr's branch refs/heads/branch_5_4 from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=df30bc6" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=df30bc6&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-6998" title="We should detect truncation for all index files" class="issue-link" data-issue-key="LUCENE-6998"&gt;&lt;del&gt;LUCENE-6998&lt;/del&gt;&lt;/a&gt;: fix a couple places to better detect truncated index files; improve corruption testing&lt;/p&gt;

&lt;p&gt;Conflicts:&lt;br/&gt;
	lucene/core/src/java/org/apache/lucene/codecs/lucene60/Lucene60PointFormat.java&lt;br/&gt;
	lucene/core/src/java/org/apache/lucene/codecs/lucene60/Lucene60PointReader.java&lt;br/&gt;
	lucene/core/src/java/org/apache/lucene/codecs/lucene60/Lucene60PointWriter.java&lt;/p&gt;

&lt;p&gt;Conflicts:&lt;br/&gt;
	lucene/CHANGES.txt&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12784871" name="LUCENE-6998.patch" size="30785" author="mikemccand" created="Thu, 28 Jan 2016 02:27:41 -0700"/>
                            <attachment id="12784767" name="LUCENE-6998.patch" size="19491" author="mikemccand" created="Wed, 27 Jan 2016 15:55:30 -0700"/>
                            <attachment id="12784762" name="LUCENE-6998.patch" size="19276" author="mikemccand" created="Wed, 27 Jan 2016 15:45:02 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 27 Jan 2016 22:59:33 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2s26v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-6975] Add dimensional "equals" query to match docs containing precisely a given value</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-6975</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;Today, you can make a dimensional range query using e.g. &lt;tt&gt;DimensionalRangeQuery.new1DIntRange&lt;/tt&gt;, etc., plus a direct ctor for "expert" (2D, 3D, etc.) usages, but matching a single value is awkward and users ask about it from time to time.&lt;/p&gt;

&lt;p&gt;We could maybe rename &lt;tt&gt;DimensionalRangeQuery&lt;/tt&gt; to &lt;tt&gt;DimensionalQuery&lt;/tt&gt; and add new "factories" like &lt;tt&gt;newIntEqualsQuery&lt;/tt&gt; or something.&lt;/p&gt;

&lt;p&gt;Or, we could make new classes, &lt;tt&gt;DimensionalIntEqualsQuery&lt;/tt&gt; etc., and you get to use ordinary constructors?&lt;/p&gt;

&lt;p&gt;Or something else?&lt;/p&gt;</description>
                <environment/>
        <key id="12929866">LUCENE-6975</key>
            <summary>Add dimensional "equals" query to match docs containing precisely a given value</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mikemccand">Michael McCandless</assignee>
                                    <reporter username="mikemccand">Michael McCandless</reporter>
                        <labels>
                    </labels>
                <created>Wed, 13 Jan 2016 09:34:38 -0700</created>
                <updated>Thu, 21 Jan 2016 08:58:39 -0700</updated>
                            <resolved>Thu, 21 Jan 2016 08:58:39 -0700</resolved>
                                                    <fixVersion>master</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="15096493" author="mikemccand" created="Wed, 13 Jan 2016 09:35:00 -0700">&lt;p&gt;I have no patch here for now ... need to hash out the design first ...&lt;/p&gt;</comment>
                            <comment id="15096508" author="dsmiley" created="Wed, 13 Jan 2016 09:46:15 -0700">&lt;p&gt;I like your idea of renaming DimensionalRangeQuery to DimensionalQuery and adding factory methods.&lt;/p&gt;</comment>
                            <comment id="15105083" author="rcmuir" created="Mon, 18 Jan 2016 03:38:12 -0700">&lt;p&gt;To me its the word "Dimensional" in these names that is the scary one.&lt;/p&gt;

&lt;p&gt;But we need to break here, we can't name things e.g. FloatField or there is a big risk of users mixing the two things. We've also got FloatDocValuesField that we don't want to cause confusion with. And somehow it needs to be clear that e.g. you need DimensionalQuery to use it, TermQuery won't work. To me thats a difference vs a regular Field.&lt;/p&gt;

&lt;p&gt;One idea is the part "Field" could be something different. For example instead of FloatDocValuesField we could have "FloatColumn", you add that to your document, and then we have ColumnRangeQuery that goes with it, instead of DocValuesRangeQuery. In that case, i feel like the different term really helps you think about what is going on vs Field.&lt;/p&gt;

&lt;p&gt;But what to use for Dim values? FloatValue wouldn't be totally horrible, but I feel like "value" is overloaded too much, is there a better term we can use?&lt;/p&gt;</comment>
                            <comment id="15105093" author="romseygeek" created="Mon, 18 Jan 2016 03:46:44 -0700">&lt;blockquote&gt;&lt;p&gt;But what to use for Dim values? FloatValue wouldn't be totally horrible, but I feel like "value" is overloaded too much, is there a better term we can use?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;How about PointValue?  And then we have PointRangeQuery.&lt;/p&gt;</comment>
                            <comment id="15105112" author="rcmuir" created="Mon, 18 Jan 2016 03:59:18 -0700">&lt;p&gt;Well I do think we should avoid "Value" unless it adds some additional meaning. Thats one problem with doc values, its basically a name that says nothing!&lt;/p&gt;

&lt;p&gt;Do you mean something like IntPointValue etc? Why not just IntPoint? Point isn't bad at all, since it does represent what is happening. &lt;/p&gt;

&lt;p&gt;On the other hand, if i just have 'int age' in my document and i want to do range queries on it, its hard to know if that would be the intuitive thing to look into, you'd have to think "oh, i need to treat it like a 1-dimensional point".&lt;/p&gt;</comment>
                            <comment id="15105121" author="rcmuir" created="Mon, 18 Jan 2016 04:07:53 -0700">&lt;p&gt;i do like your idea, those are just some devil's advocate ideas. At least point seems way more intuitive than what we have in trunk and i dont have anything better. It definitely seems better than dimensional and doesn't make me think about mad scientists or time travel.&lt;/p&gt;

&lt;p&gt;Just the general idea is something to think about, simple names like fields, columns, and points could help people use the right datastructure for the job.&lt;/p&gt;</comment>
                            <comment id="15106497" author="mikemccand" created="Tue, 19 Jan 2016 02:38:18 -0700">&lt;p&gt;I like `IntPoint` and `PointRangeQuery` (and maybe `ExactPointQuery`?) ... I'll try this out.&lt;/p&gt;</comment>
                            <comment id="15110285" author="mikemccand" created="Thu, 21 Jan 2016 01:45:37 -0700">&lt;p&gt;Here's a patch, renaming dimensional -&amp;gt; point across the board, and adding a new &lt;tt&gt;ExactPointQuery&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="15110300" author="rcmuir" created="Thu, 21 Jan 2016 02:05:01 -0700">&lt;p&gt;+1!&lt;/p&gt;</comment>
                            <comment id="15110318" author="romseygeek" created="Thu, 21 Jan 2016 02:18:03 -0700">&lt;p&gt;+1, nice!&lt;/p&gt;

&lt;p&gt;Regarding Robert's point about having to think of simple numeric queries as being points, maybe it's worth adding some sugar classes?  So SingleIntField extends IntPoint and takes a single value, similarly ExactNumericQuery is an extension of ExactPointQuery.&lt;/p&gt;</comment>
                            <comment id="15110322" author="rcmuir" created="Thu, 21 Jan 2016 02:21:40 -0700">&lt;p&gt;Well I agree we need to make the 1D case simpler. I'm not sure if separate classes really does that, or if we just have to improve the apis of what we have. I think we have a couple of choices.&lt;/p&gt;

&lt;p&gt;For sure though, Point is better than Dimensional. I do think we should make the additional tweak here, of "escape from Field", meaning PointLatLonField -&amp;gt; LatLonPoint and so on. It can be a followup though.&lt;/p&gt;</comment>
                            <comment id="15110372" author="mikemccand" created="Thu, 21 Jan 2016 03:06:26 -0700">&lt;p&gt;Good idea &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;, here's a new patch with &lt;tt&gt;LatLonPoint&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="15110823" author="jira-bot" created="Thu, 21 Jan 2016 08:58:12 -0700">&lt;p&gt;Commit 1725998 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mikemccand" class="user-hover" rel="mikemccand"&gt;Michael McCandless&lt;/a&gt; in branch 'dev/trunk'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1725998" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1725998&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-6975" title="Add dimensional &amp;quot;equals&amp;quot; query to match docs containing precisely a given value" class="issue-link" data-issue-key="LUCENE-6975"&gt;&lt;del&gt;LUCENE-6975&lt;/del&gt;&lt;/a&gt;: rename dimensional values to points; add ExactPointQuery to match documents containing exactly an indexed point&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12783554" name="LUCENE-6975.patch" size="656989" author="mikemccand" created="Thu, 21 Jan 2016 03:06:26 -0700"/>
                            <attachment id="12783540" name="LUCENE-6975.patch" size="592826" author="mikemccand" created="Thu, 21 Jan 2016 01:45:37 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 13 Jan 2016 16:46:15 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2r8zj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-6971] Remove StorableField, StoredDocument</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-6971</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;I think this has proven to be an awkward/forced separation, e.g. that doc values are handled as {{StorableField}}s.&lt;/p&gt;

&lt;p&gt;For the 5.x release we had just "kicked the can down the road" by pushing this change off of the branch, making backporting sometimes hard, but I think for 6.x we should just remove it and put the document API back to what we have in 5.x.&lt;/p&gt;</description>
                <environment/>
        <key id="12929195">LUCENE-6971</key>
            <summary>Remove StorableField, StoredDocument</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mikemccand">Michael McCandless</assignee>
                                    <reporter username="mikemccand">Michael McCandless</reporter>
                        <labels>
                    </labels>
                <created>Mon, 11 Jan 2016 07:58:25 -0700</created>
                <updated>Mon, 18 Jan 2016 07:23:09 -0700</updated>
                            <resolved>Sun, 17 Jan 2016 12:55:39 -0700</resolved>
                                                    <fixVersion>master</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="15092030" author="jpountz" created="Mon, 11 Jan 2016 07:59:20 -0700">&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="15096438" author="mikemccand" created="Wed, 13 Jan 2016 09:10:15 -0700">&lt;p&gt;Simple rote, but somewhat large, patch.&lt;/p&gt;</comment>
                            <comment id="15103898" author="jira-bot" created="Sun, 17 Jan 2016 12:54:53 -0700">&lt;p&gt;Commit 1725117 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mikemccand" class="user-hover" rel="mikemccand"&gt;Michael McCandless&lt;/a&gt; in branch 'dev/trunk'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1725117" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1725117&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-6971" title="Remove StorableField, StoredDocument" class="issue-link" data-issue-key="LUCENE-6971"&gt;&lt;del&gt;LUCENE-6971&lt;/del&gt;&lt;/a&gt;: remove StorableField, StoredDocument&lt;/p&gt;</comment>
                            <comment id="15103900" author="thetaphi" created="Sun, 17 Jan 2016 13:02:41 -0700">&lt;p&gt;Thanks Mike!&lt;/p&gt;</comment>
                            <comment id="15105223" author="jira-bot" created="Mon, 18 Jan 2016 05:35:19 -0700">&lt;p&gt;Commit 1725251 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi" class="user-hover" rel="thetaphi"&gt;Uwe Schindler&lt;/a&gt; in branch 'dev/trunk'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1725251" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1725251&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-6971" title="Remove StorableField, StoredDocument" class="issue-link" data-issue-key="LUCENE-6971"&gt;&lt;del&gt;LUCENE-6971&lt;/del&gt;&lt;/a&gt;: remove MIGRATE.txt mention of StorableField, StoredDocument&lt;/p&gt;</comment>
                            <comment id="15105224" author="thetaphi" created="Mon, 18 Jan 2016 05:37:28 -0700">&lt;p&gt;Hi Mike,&lt;br/&gt;
I found one more mentioning of this in the migration guide. I just committed removal.&lt;/p&gt;</comment>
                            <comment id="15105340" author="mikemccand" created="Mon, 18 Jan 2016 07:23:09 -0700">&lt;p&gt;Woops, thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi" class="user-hover" rel="thetaphi"&gt;Uwe Schindler&lt;/a&gt;!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12782081" name="LUCENE-6971.patch" size="355624" author="mikemccand" created="Wed, 13 Jan 2016 09:10:15 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 11 Jan 2016 14:59:20 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2r4un:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-6952] All Filter* delegating classes should be abstract</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-6952</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;I think it's confusing that FilterLeafReader (and it's Filter&amp;#42; inner classes) are not abstract.  By making them abstract, we clarify to users how to use them by virtue of them being abstract.  It seems only a couple tests directly instantiate them.  This applies to other Filter* classes as well.&lt;/p&gt;</description>
                <environment/>
        <key id="12924618">LUCENE-6952</key>
            <summary>All Filter* delegating classes should be abstract</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dsmiley">David Smiley</assignee>
                                    <reporter username="dsmiley">David Smiley</reporter>
                        <labels>
                    </labels>
                <created>Mon, 28 Dec 2015 23:12:53 -0700</created>
                <updated>Tue, 8 Mar 2016 10:39:58 -0700</updated>
                            <resolved>Tue, 8 Mar 2016 10:39:58 -0700</resolved>
                                                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="15180259" author="dsmiley" created="Fri, 4 Mar 2016 10:55:55 -0700">&lt;p&gt;I expanded the scope to include any class starting with Filter that is a delegate that wasn't already abstract:&lt;/p&gt;

&lt;p&gt;Lucene-core:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;FilterCodecReader&lt;/li&gt;
	&lt;li&gt;FilterLeafReader&lt;/li&gt;
	&lt;li&gt;FilterCollector&lt;/li&gt;
	&lt;li&gt;FilterDirectory&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Lucene-test-framework&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;FilterFileChannel&lt;/li&gt;
	&lt;li&gt;FilterFileStore&lt;/li&gt;
	&lt;li&gt;&lt;em&gt;not&lt;/em&gt; FilterFileSystem&lt;/li&gt;
	&lt;li&gt;FilterFileSystemProvider&lt;/li&gt;
	&lt;li&gt;FilterOutputStream2&lt;/li&gt;
	&lt;li&gt;&lt;em&gt;not&lt;/em&gt; FilterPath&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;When I had tentatively made FilterFileSystem and FilterPath abstract, I noticed a bunch of direct usages that seemed to use it as a pair of a delegate with a FileSystem impl so it wasn't a pure delegate.  But that's debatable; it's fine either way I guess.&lt;/p&gt;</comment>
                            <comment id="15183429" author="dsmiley" created="Mon, 7 Mar 2016 11:41:38 -0700">&lt;p&gt;Updated to fix bug introduced in my patch related to the presence of trivial anonymous inner subclasses that didn't need to be there any more.  They were there because the very first attempt made some classes Abstract and I had since changed my mind.  A test discovered this.&lt;/p&gt;</comment>
                            <comment id="15185074" author="yseeley@gmail.com" created="Tue, 8 Mar 2016 08:29:41 -0700">&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="15185324" author="jira-bot" created="Tue, 8 Mar 2016 10:38:53 -0700">&lt;p&gt;Commit 57a7820d1ff67969e75a4f022239bdcede09d95b in lucene-solr's branch refs/heads/branch_6_0 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley" class="user-hover" rel="dsmiley"&gt;David Smiley&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=57a7820" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=57a7820&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-6952" title="All Filter* delegating classes should be abstract" class="issue-link" data-issue-key="LUCENE-6952"&gt;&lt;del&gt;LUCENE-6952&lt;/del&gt;&lt;/a&gt;: Make most Filter* classes abstract.&lt;br/&gt;
(cherry picked from commit ae59bc0)&lt;/p&gt;</comment>
                            <comment id="15185325" author="jira-bot" created="Tue, 8 Mar 2016 10:38:55 -0700">&lt;p&gt;Commit ae59bc0785b57ff5ce8cc4f88cd7728de3735e18 in lucene-solr's branch refs/heads/branch_6x from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley" class="user-hover" rel="dsmiley"&gt;David Smiley&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ae59bc0" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ae59bc0&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-6952" title="All Filter* delegating classes should be abstract" class="issue-link" data-issue-key="LUCENE-6952"&gt;&lt;del&gt;LUCENE-6952&lt;/del&gt;&lt;/a&gt;: Make most Filter* classes abstract.&lt;br/&gt;
(cherry picked from commit 9393a31)&lt;/p&gt;</comment>
                            <comment id="15185326" author="jira-bot" created="Tue, 8 Mar 2016 10:38:55 -0700">&lt;p&gt;Commit 9393a3190ce6af48ae0aac40d5d4b17c3b5d5423 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley" class="user-hover" rel="dsmiley"&gt;David Smiley&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9393a31" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9393a31&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-6952" title="All Filter* delegating classes should be abstract" class="issue-link" data-issue-key="LUCENE-6952"&gt;&lt;del&gt;LUCENE-6952&lt;/del&gt;&lt;/a&gt;: Make most Filter* classes abstract.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12791799" name="LUCENE_6952.patch" size="11840" author="dsmiley" created="Mon, 7 Mar 2016 11:41:38 -0700"/>
                            <attachment id="12791500" name="LUCENE_6952.patch" size="13436" author="dsmiley" created="Fri, 4 Mar 2016 10:55:55 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 8 Mar 2016 15:29:41 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2qd0v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-6867] Unmark ignored geo tests (due to RR incompatibility)</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-6867</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description/>
                <environment/>
        <key id="12908842">LUCENE-6867</key>
            <summary>Unmark ignored geo tests (due to RR incompatibility)</summary>
                <type id="3" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/task.png">Task</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dsmiley">David Smiley</assignee>
                                    <reporter username="dweiss">Dawid Weiss</reporter>
                        <labels>
                    </labels>
                <created>Thu, 29 Oct 2015 02:26:50 -0700</created>
                <updated>Wed, 2 Mar 2016 19:11:28 -0700</updated>
                            <resolved>Wed, 2 Mar 2016 19:11:28 -0700</resolved>
                                                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="14980110" author="jira-bot" created="Thu, 29 Oct 2015 02:30:35 -0700">&lt;p&gt;Commit 1711201 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dawidweiss" class="user-hover" rel="dawidweiss"&gt;Dawid Weiss&lt;/a&gt; in branch 'dev/trunk'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1711201" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1711201&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-6867" title="Unmark ignored geo tests (due to RR incompatibility)" class="issue-link" data-issue-key="LUCENE-6867"&gt;&lt;del&gt;LUCENE-6867&lt;/del&gt;&lt;/a&gt;: marking certain tests as ignored because of incompatibility in RandomizedTesting versions.&lt;/p&gt;</comment>
                            <comment id="14980143" author="jira-bot" created="Thu, 29 Oct 2015 02:46:07 -0700">&lt;p&gt;Commit 1711204 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dawidweiss" class="user-hover" rel="dawidweiss"&gt;Dawid Weiss&lt;/a&gt; in branch 'dev/branches/branch_5x'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1711204" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1711204&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-6867" title="Unmark ignored geo tests (due to RR incompatibility)" class="issue-link" data-issue-key="LUCENE-6867"&gt;&lt;del&gt;LUCENE-6867&lt;/del&gt;&lt;/a&gt;: marking certain tests as ignored because of incompatibility in RandomizedTesting versions.&lt;/p&gt;</comment>
                            <comment id="15176991" author="dsmiley" created="Wed, 2 Mar 2016 19:11:28 -0700">&lt;p&gt;Fixed by the commit for &lt;a href="https://issues.apache.org/jira/browse/LUCENE-7060" title="Update Spatial4j 0.5 to 0.6 (includes change in package)" class="issue-link" data-issue-key="LUCENE-7060"&gt;&lt;del&gt;LUCENE-7060&lt;/del&gt;&lt;/a&gt; (Update to Spatial4j 0.6) which just removed the &lt;tt&gt;@AwaitsFix&lt;/tt&gt; annotations&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12908642">LUCENE-6862</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12946193">LUCENE-7060</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 29 Oct 2015 09:30:35 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2nohz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-6835] Directory.deleteFile should "own" retrying deletions on Windows</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-6835</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;Rob's idea:&lt;/p&gt;

&lt;p&gt;Today, we have hairy logic in IndexFileDeleter to deal with Windows file systems that cannot delete still open files.&lt;/p&gt;

&lt;p&gt;And with &lt;a href="https://issues.apache.org/jira/browse/LUCENE-6829" title="OfflineSorter should use Directory API" class="issue-link" data-issue-key="LUCENE-6829"&gt;&lt;del&gt;LUCENE-6829&lt;/del&gt;&lt;/a&gt;, where OfflineSorter now must deal with the situation too ... I worked around it by fixing all tests to disable the virus checker.&lt;/p&gt;

&lt;p&gt;I think it makes more sense to push this "platform specific problem" lower in the stack, into Directory?  I.e., its deleteFile method would catch the access denied, and then retry the deletion later.  Then we could re-enable virus checker on all these tests, simplify IndexFileDeleter, etc.&lt;/p&gt;

&lt;p&gt;Maybe in the future we could further push this down, into WindowsDirectory,  and fix FSDirectory.open to return WindowsDirectory on windows ...&lt;/p&gt;</description>
                <environment/>
        <key id="12904137">LUCENE-6835</key>
            <summary>Directory.deleteFile should "own" retrying deletions on Windows</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="mikemccand">Michael McCandless</reporter>
                        <labels>
                    </labels>
                <created>Mon, 12 Oct 2015 03:32:49 -0700</created>
                <updated>Mon, 8 Feb 2016 11:53:28 -0700</updated>
                            <resolved>Sat, 6 Feb 2016 06:27:47 -0700</resolved>
                                                    <fixVersion>master</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="14953663" author="mikemccand" created="Mon, 12 Oct 2015 13:13:39 -0700">&lt;p&gt;Tentative initial patch, but there are problems.&lt;/p&gt;

&lt;p&gt;I removed IFD's hairy code about retrying deletes (yay!), and moved it&lt;br/&gt;
down into FSDirectory, so it now becomes a Directory impl's job to&lt;br/&gt;
"deal with" finicky filesystems that prevent deletion of open files.&lt;/p&gt;

&lt;p&gt;I also changed Directory.deleteFile to Directory.deleteFiles, so&lt;br/&gt;
"revisit pending deletions" is less O(N^2).&lt;/p&gt;

&lt;p&gt;The big problem with the patch now is I completely disabled MDW's&lt;br/&gt;
virus/open-file checker, because we are no longer allowed to "fake" a&lt;br/&gt;
virus checker in a Directory wrapper (since it's now Directory's job&lt;br/&gt;
to do retries on deletes) ... I think to move forward w/ this approach&lt;br/&gt;
we must also re-implement the virus checker "down low" inside Mock FS&lt;/p&gt;

&lt;p&gt;Some tests are still angry because they rely on MDW's not deleting&lt;br/&gt;
still open files ...&lt;/p&gt;</comment>
                            <comment id="14953676" author="jira-bot" created="Mon, 12 Oct 2015 13:22:52 -0700">&lt;p&gt;Commit 1708229 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mikemccand" class="user-hover" rel="mikemccand"&gt;Michael McCandless&lt;/a&gt; in branch 'dev/branches/lucene6835'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1708229" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1708229&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-6835" title="Directory.deleteFile should &amp;quot;own&amp;quot; retrying deletions on Windows" class="issue-link" data-issue-key="LUCENE-6835"&gt;&lt;del&gt;LUCENE-6835&lt;/del&gt;&lt;/a&gt;: make branch&lt;/p&gt;</comment>
                            <comment id="14953677" author="jira-bot" created="Mon, 12 Oct 2015 13:24:09 -0700">&lt;p&gt;Commit 1708230 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mikemccand" class="user-hover" rel="mikemccand"&gt;Michael McCandless&lt;/a&gt; in branch 'dev/branches/lucene6835'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1708230" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1708230&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-6835" title="Directory.deleteFile should &amp;quot;own&amp;quot; retrying deletions on Windows" class="issue-link" data-issue-key="LUCENE-6835"&gt;&lt;del&gt;LUCENE-6835&lt;/del&gt;&lt;/a&gt;: starting patch&lt;/p&gt;</comment>
                            <comment id="14953679" author="mikemccand" created="Mon, 12 Oct 2015 13:25:25 -0700">&lt;p&gt;I committed the starting patch here: &lt;a href="https://svn.apache.org/repos/asf/lucene/dev/branches/lucene6835" class="external-link" rel="nofollow"&gt;https://svn.apache.org/repos/asf/lucene/dev/branches/lucene6835&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I'm not sure how to do the virus checking in mock FS ...&lt;/p&gt;</comment>
                            <comment id="14961694" author="rcmuir" created="Fri, 16 Oct 2015 19:58:13 -0700">&lt;p&gt;IndexWriter today is not truly write-once, when rebooting it on a directory in some exceptional cases.&lt;/p&gt;

&lt;p&gt;I think it needs a way to check that the pendingDeletes() for the directory is empty, and simply refuse to start if its not. I know we do our best with inflateGens() and all that, but this will prevent something bad.&lt;/p&gt;</comment>
                            <comment id="14961826" author="mikemccand" created="Sat, 17 Oct 2015 02:23:33 -0700">&lt;blockquote&gt;&lt;p&gt;I think it needs a way to check that the pendingDeletes() for the directory is empty, and simply refuse to start if its not.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1, that's a great idea ... I'll try it out on the branch. &lt;/p&gt;</comment>
                            <comment id="14963294" author="jira-bot" created="Mon, 19 Oct 2015 06:28:02 -0700">&lt;p&gt;Commit 1709413 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mikemccand" class="user-hover" rel="mikemccand"&gt;Michael McCandless&lt;/a&gt; in branch 'dev/branches/lucene6835'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1709413" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1709413&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-6835" title="Directory.deleteFile should &amp;quot;own&amp;quot; retrying deletions on Windows" class="issue-link" data-issue-key="LUCENE-6835"&gt;&lt;del&gt;LUCENE-6835&lt;/del&gt;&lt;/a&gt;: IW refuses to init if the incoming dir still has undeletable files&lt;/p&gt;</comment>
                            <comment id="14963316" author="jira-bot" created="Mon, 19 Oct 2015 06:38:44 -0700">&lt;p&gt;Commit 1709414 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mikemccand" class="user-hover" rel="mikemccand"&gt;Michael McCandless&lt;/a&gt; in branch 'dev/branches/lucene6835'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1709414" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1709414&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-6835" title="Directory.deleteFile should &amp;quot;own&amp;quot; retrying deletions on Windows" class="issue-link" data-issue-key="LUCENE-6835"&gt;&lt;del&gt;LUCENE-6835&lt;/del&gt;&lt;/a&gt;: merge trunk&lt;/p&gt;</comment>
                            <comment id="14965170" author="jira-bot" created="Tue, 20 Oct 2015 07:29:07 -0700">&lt;p&gt;Commit 1709609 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mikemccand" class="user-hover" rel="mikemccand"&gt;Michael McCandless&lt;/a&gt; in branch 'dev/trunk'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1709609" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1709609&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-6847" title="Test3DPointField and TestBKDTree failures: .bkd file can&amp;#39;t be deleted" class="issue-link" data-issue-key="LUCENE-6847"&gt;&lt;del&gt;LUCENE-6847&lt;/del&gt;&lt;/a&gt;: sidestep virus checkers until we can do &lt;a href="https://issues.apache.org/jira/browse/LUCENE-6835" title="Directory.deleteFile should &amp;quot;own&amp;quot; retrying deletions on Windows" class="issue-link" data-issue-key="LUCENE-6835"&gt;&lt;del&gt;LUCENE-6835&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15066338" author="jira-bot" created="Mon, 21 Dec 2015 04:15:57 -0700">&lt;p&gt;Commit 1721127 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mikemccand" class="user-hover" rel="mikemccand"&gt;Michael McCandless&lt;/a&gt; in branch 'dev/branches/lucene6835'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1721127" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1721127&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-6835" title="Directory.deleteFile should &amp;quot;own&amp;quot; retrying deletions on Windows" class="issue-link" data-issue-key="LUCENE-6835"&gt;&lt;del&gt;LUCENE-6835&lt;/del&gt;&lt;/a&gt;: add naive VirusCheckingFS and rotate it in, randomly&lt;/p&gt;</comment>
                            <comment id="15066357" author="jira-bot" created="Mon, 21 Dec 2015 04:40:06 -0700">&lt;p&gt;Commit 1721134 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mikemccand" class="user-hover" rel="mikemccand"&gt;Michael McCandless&lt;/a&gt; in branch 'dev/branches/lucene6835'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1721134" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1721134&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-6835" title="Directory.deleteFile should &amp;quot;own&amp;quot; retrying deletions on Windows" class="issue-link" data-issue-key="LUCENE-6835"&gt;&lt;del&gt;LUCENE-6835&lt;/del&gt;&lt;/a&gt;: merge trunk&lt;/p&gt;</comment>
                            <comment id="15067980" author="jira-bot" created="Tue, 22 Dec 2015 04:31:19 -0700">&lt;p&gt;Commit 1721365 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mikemccand" class="user-hover" rel="mikemccand"&gt;Michael McCandless&lt;/a&gt; in branch 'dev/branches/lucene6835'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1721365" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1721365&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-6835" title="Directory.deleteFile should &amp;quot;own&amp;quot; retrying deletions on Windows" class="issue-link" data-issue-key="LUCENE-6835"&gt;&lt;del&gt;LUCENE-6835&lt;/del&gt;&lt;/a&gt;: exempt tests from virus checker if they do direct file deletes, or stop doing unnecessary direct file deletes; address some nocommits; fix compilation errors&lt;/p&gt;</comment>
                            <comment id="15130097" author="mikemccand" created="Wed, 3 Feb 2016 02:27:04 -0700">&lt;p&gt;I migrated this branch to git: &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;a=shortlog;h=refs/heads/lucene-6835" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;a=shortlog;h=refs/heads/lucene-6835&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I just carried over the previous patch, plus a few more test fixes.&lt;/p&gt;</comment>
                            <comment id="15130165" author="dweiss" created="Wed, 3 Feb 2016 03:04:46 -0700">&lt;p&gt;All the SVN branches are in git, you know that, Mike (right?). They're not branches, but they're tagged (so could be made branches again). This is the one you moved:&lt;/p&gt;

&lt;p&gt;history/branches/lucene-solr/lucene6835&lt;/p&gt;

&lt;p&gt;I'd still create a new branch for the issue (since it's easier on the eyes as it doesn't reach SVN's convoluted merge history), but just a note for the future. For example you could have cherry picked all the commits from lucene6835 since it was forked from then-trunk.&lt;/p&gt;</comment>
                            <comment id="15130169" author="mikemccand" created="Wed, 3 Feb 2016 03:07:29 -0700">&lt;blockquote&gt;&lt;p&gt;All the SVN branches are in git, you know that, Mike (right?).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Woops, I did not know (remember? &lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/wink.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt;) that.  Thank you for the reminder!&lt;/p&gt;

&lt;p&gt;And thanks for the suggestions on naming branches ... I'll try to put jira-inspired branches under "jira" in the future ... but I'm a little nervous to try renaming the current one.&lt;/p&gt;</comment>
                            <comment id="15130189" author="dweiss" created="Wed, 3 Feb 2016 03:21:31 -0700">&lt;p&gt;It isn't strictly "renaming". You're simply attaching a new label to a commit and deleting a different label. Don't be scared, play with fire ( &lt;a href="https://goo.gl/1IrJrT" class="external-link" rel="nofollow"&gt;https://goo.gl/1IrJrT&lt;/a&gt; )&lt;/p&gt;</comment>
                            <comment id="15130197" author="dweiss" created="Wed, 3 Feb 2016 03:27:22 -0700">&lt;p&gt;Anyway, in the future if you're looking for a tag or SVN commit these may be helpful:&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
# list all tags
git tag

# search all commit logs &lt;span class="code-keyword"&gt;for&lt;/span&gt; a particular SVN commit number:
git log --grep=&lt;span class="code-quote"&gt;"@1411748"&lt;/span&gt; --all
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15131240" author="mikemccand" created="Wed, 3 Feb 2016 15:09:35 -0700">&lt;p&gt;I think the branch is in pretty good shape ... tests pass, even when forcing &lt;tt&gt;VirusCheckingFS&lt;/tt&gt; usage.&lt;/p&gt;

&lt;p&gt;I'm attaching an applyable a "createPatch.py" patch.&lt;/p&gt;

&lt;p&gt;I have one nocommit left: what to do about IndexFileDeleter's previous heroics around not removing any files referenced by a stale segments_N when that segments_N itself cannot be deleted.  I think we should just remove this (OS-specific) behavior?&lt;/p&gt;

&lt;p&gt;I'm a little nervous about the changes to FSDirectory, holding onto pending deletions, retrying them periodically on new write operations ... but I do think it's important we get this OS-specific behavior in Lucene down lower in the stack ...&lt;/p&gt;

&lt;p&gt;I also fixed the new &lt;tt&gt;VirusCheckingFS&lt;/tt&gt; to not use &lt;tt&gt;Random&lt;/tt&gt; instance anymore, but do its own pseudo-random behavior based on the hash of the incoming &lt;tt&gt;Path&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="15131636" author="rcmuir" created="Wed, 3 Feb 2016 20:07:31 -0700">&lt;p&gt;Thanks for attacking this! &lt;/p&gt;

&lt;p&gt;Should we add a TODO to IndexFileDeleter to try to remove the &lt;a href="https://issues.apache.org/jira/browse/LUCENE-6684" title="TestSimpleFSLockFactory.testStressLock assert trip only on Windows?" class="issue-link" data-issue-key="LUCENE-6684"&gt;&lt;del&gt;LUCENE-6684&lt;/del&gt;&lt;/a&gt; hack later too?&lt;br/&gt;
I really like the sort (since we return array anyway). Can we followup by making this a change to the Directory API? e.g. fix RAMDir etc to behave too. We can add tests to BaseDirectoryTestCase that it works.&lt;br/&gt;
Lets remove those OS-specific heroics and move forward.&lt;/p&gt;
</comment>
                            <comment id="15132385" author="mikemccand" created="Thu, 4 Feb 2016 07:27:25 -0700">&lt;blockquote&gt;&lt;p&gt;Should we add a TODO to IndexFileDeleter to try to remove the &lt;a href="https://issues.apache.org/jira/browse/LUCENE-6684" title="TestSimpleFSLockFactory.testStressLock assert trip only on Windows?" class="issue-link" data-issue-key="LUCENE-6684"&gt;&lt;del&gt;LUCENE-6684&lt;/del&gt;&lt;/a&gt; hack later too?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Good catch, I'll put a TODO.  I wanted to just remove it now &lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/smile.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt;  But then that test would fail again, because FSDirectory makes no effort to sugarcoat a false NSFE...&lt;/p&gt;

&lt;p&gt;I'll add sort to &lt;tt&gt;listAll&lt;/tt&gt; across the board and add a test case here ...&lt;/p&gt;</comment>
                            <comment id="15132627" author="mikemccand" created="Thu, 4 Feb 2016 10:18:36 -0700">&lt;p&gt;I pushed some more changes ... I think it's ready.  I'll beast tests some more; I suspect more will be angry when they get &lt;tt&gt;VirusCheckingFS&lt;/tt&gt; with the right seed ... I think we should do this for 6.0.0.&lt;/p&gt;</comment>
                            <comment id="15134510" author="mikemccand" created="Fri, 5 Feb 2016 10:22:25 -0700">&lt;p&gt;I pushed some more changes:&lt;/p&gt;

&lt;p&gt;Too many tests were angry when VirusCheckingFS is randomly used,&lt;br/&gt;
because they'll do things like create an FSDir, open a writer, index&lt;br/&gt;
docs, close the writer and then open a new writer (on the same dir&lt;br/&gt;
instance), which will fail if the virus checker had prevented file&lt;br/&gt;
deletion and they remain not deletable (IndexWriter detects this on&lt;br/&gt;
startup).&lt;/p&gt;

&lt;p&gt;Or they try to directly remove files from their temp dir...&lt;/p&gt;

&lt;p&gt;So I took VirusCheckingFS out of the random rotation: I think it's too&lt;br/&gt;
much (and not helpful) to expect our tests to work with badly behaved&lt;br/&gt;
virus checkers.&lt;/p&gt;

&lt;p&gt;Instead I turned on the virus checker randomly in a few tests, using a&lt;br/&gt;
new &lt;tt&gt;LTC.newMaybeVirusCheckingDirectory&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;I think the changes here to &lt;tt&gt;FSDirectory&lt;/tt&gt; are not pretty ... I think&lt;br/&gt;
we may want to pull out the "retry deletions" from &lt;tt&gt;FSDirectory&lt;/tt&gt;&lt;br/&gt;
into a new &lt;tt&gt;WindowsFSDirectory&lt;/tt&gt; or a wrapper or something ... but I&lt;br/&gt;
think we should do this separately.  I think this issue is a good step&lt;br/&gt;
forward to migrating OS specifics down lower in the stack, and it's&lt;br/&gt;
not easy: progress not perfection!&lt;/p&gt;

&lt;p&gt;Also, the &lt;tt&gt;VirusCheckingFS&lt;/tt&gt; only interferes with &lt;tt&gt;Files.delete&lt;/tt&gt;&lt;br/&gt;
today, but I imagine a real evil virus checker would do other things&lt;br/&gt;
like prevent renaming a file.  But then, Lucene already does not&lt;br/&gt;
protect against that anymore (only retry on delete).&lt;/p&gt;

&lt;p&gt;I think the latest branch is ready ... distributed beasting only&lt;br/&gt;
uncovered an unrelated issue (&lt;a href="https://issues.apache.org/jira/browse/LUCENE-7017" title="TestGeoPointQuery failure" class="issue-link" data-issue-key="LUCENE-7017"&gt;LUCENE-7017&lt;/a&gt;).  I'll merge soon.&lt;/p&gt;</comment>
                            <comment id="15135794" author="jira-bot" created="Sat, 6 Feb 2016 07:41:20 -0700">&lt;p&gt;Commit 3c15c3f03df2d769174964e59a760264dce918d8 in lucene-solr's branch refs/heads/master from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3c15c3f" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3c15c3f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-6835" title="Directory.deleteFile should &amp;quot;own&amp;quot; retrying deletions on Windows" class="issue-link" data-issue-key="LUCENE-6835"&gt;&lt;del&gt;LUCENE-6835&lt;/del&gt;&lt;/a&gt;: add test case confirming listAll is sorted; fix dir impls that weren't&lt;/p&gt;</comment>
                            <comment id="15136358" author="jira-bot" created="Sun, 7 Feb 2016 11:22:10 -0700">&lt;p&gt;Commit f8bd22e58c953a5ef27fd4859c91845755ebd490 in lucene-solr's branch refs/heads/master from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f8bd22e" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f8bd22e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-6835" title="Directory.deleteFile should &amp;quot;own&amp;quot; retrying deletions on Windows" class="issue-link" data-issue-key="LUCENE-6835"&gt;&lt;del&gt;LUCENE-6835&lt;/del&gt;&lt;/a&gt;, &lt;a href="https://issues.apache.org/jira/browse/LUCENE-6684" title="TestSimpleFSLockFactory.testStressLock assert trip only on Windows?" class="issue-link" data-issue-key="LUCENE-6684"&gt;&lt;del&gt;LUCENE-6684&lt;/del&gt;&lt;/a&gt;: move the 'suppress NSFE on windows' hack down lower, out of IFD into FSDir; also fix IFD to remove segments files before others&lt;/p&gt;</comment>
                            <comment id="15136397" author="jira-bot" created="Sun, 7 Feb 2016 12:45:42 -0700">&lt;p&gt;Commit f8bd22e58c953a5ef27fd4859c91845755ebd490 in lucene-solr's branch refs/heads/jira/lucene-5438-nrt-replication from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f8bd22e" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f8bd22e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-6835" title="Directory.deleteFile should &amp;quot;own&amp;quot; retrying deletions on Windows" class="issue-link" data-issue-key="LUCENE-6835"&gt;&lt;del&gt;LUCENE-6835&lt;/del&gt;&lt;/a&gt;, &lt;a href="https://issues.apache.org/jira/browse/LUCENE-6684" title="TestSimpleFSLockFactory.testStressLock assert trip only on Windows?" class="issue-link" data-issue-key="LUCENE-6684"&gt;&lt;del&gt;LUCENE-6684&lt;/del&gt;&lt;/a&gt;: move the 'suppress NSFE on windows' hack down lower, out of IFD into FSDir; also fix IFD to remove segments files before others&lt;/p&gt;</comment>
                            <comment id="15137465" author="jira-bot" created="Mon, 8 Feb 2016 11:53:28 -0700">&lt;p&gt;Commit 2cee9f16934b6458ee18a60d194e586c33ed36d9 in lucene-solr's branch refs/heads/master from Mike McCandless&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=2cee9f1" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=2cee9f1&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-6835" title="Directory.deleteFile should &amp;quot;own&amp;quot; retrying deletions on Windows" class="issue-link" data-issue-key="LUCENE-6835"&gt;&lt;del&gt;LUCENE-6835&lt;/del&gt;&lt;/a&gt;, &lt;a href="https://issues.apache.org/jira/browse/LUCENE-6684" title="TestSimpleFSLockFactory.testStressLock assert trip only on Windows?" class="issue-link" data-issue-key="LUCENE-6684"&gt;&lt;del&gt;LUCENE-6684&lt;/del&gt;&lt;/a&gt;: keep the 'suppress NSFE on windows' hack inside IFD as well&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12906270">LUCENE-6848</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12786123" name="LUCENE-6835.patch" size="234938" author="mikemccand" created="Wed, 3 Feb 2016 15:09:35 -0700"/>
                            <attachment id="12766160" name="LUCENE-6835.patch" size="47140" author="mikemccand" created="Mon, 12 Oct 2015 13:13:39 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 12 Oct 2015 20:22:52 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2mvpb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-6793] NumericRangeQuery.hashCode() produces frequent collisions</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-6793</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;We have a user who is developing a Solr plugin and needs to store NumericRangeQuery objects in a hash table.  They found that NumericRangeQuery.hashCode() produces extremely frequent collisions.  I understand that the contract for hashCode doesn't (and can't) guarantee unique hash codes for every value, but the distribution of this method seems particularly bad with an affinity for the hash value 897548010. Out of a set of 31 ranges, hashCode returned 897548010 14 times. This is going to result in very inefficient distribution of the objects in the hash table. The standard "times 31" hash function recommended by Effective Java fares quite a bit better, although it still produces quite a few collisions.  Here's a test case that compares the results of the current hashCode function with the times 31 method.  An even better method, like Murmur3 might be found here: &lt;a href="http://floodyberry.com/noncryptohashzoo/" class="external-link" rel="nofollow"&gt;http://floodyberry.com/noncryptohashzoo/&lt;/a&gt;&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;
&lt;span class="code-keyword"&gt;package&lt;/span&gt; com.company;

&lt;span class="code-keyword"&gt;import&lt;/span&gt; org.apache.lucene.search.NumericRangeQuery;

&lt;span class="code-keyword"&gt;public&lt;/span&gt; class Main {

    &lt;span class="code-keyword"&gt;public&lt;/span&gt; &lt;span class="code-keyword"&gt;static&lt;/span&gt; &lt;span class="code-object"&gt;int&lt;/span&gt; betterHash(NumericRangeQuery query) {
        &lt;span class="code-comment"&gt;// I can't subclass NumericRangeQuery since it's constructor is &lt;span class="code-keyword"&gt;private&lt;/span&gt;, so I can't call &lt;span class="code-keyword"&gt;super&lt;/span&gt; and
&lt;/span&gt;        &lt;span class="code-comment"&gt;// had to copy and paste from the hashCode method &lt;span class="code-keyword"&gt;for&lt;/span&gt; both MultiTermQuery and NumericRangeQuery
&lt;/span&gt;
        &lt;span class="code-comment"&gt;// MultiTermQuery.hashCode (copied verbatim)
&lt;/span&gt;        &lt;span class="code-keyword"&gt;final&lt;/span&gt; &lt;span class="code-object"&gt;int&lt;/span&gt; prime = 31;
        &lt;span class="code-object"&gt;int&lt;/span&gt; result = 1;
        result = prime * result + &lt;span class="code-object"&gt;Float&lt;/span&gt;.floatToIntBits(query.getBoost());
        result = prime * result + query.getRewriteMethod().hashCode();
        &lt;span class="code-keyword"&gt;if&lt;/span&gt; (query.getField() != &lt;span class="code-keyword"&gt;null&lt;/span&gt;) result = prime * result + query.getField().hashCode();

        &lt;span class="code-comment"&gt;// NumericRangeQuery.hashCode (changed XOR with random constant to times 31)
&lt;/span&gt;        result = result * prime + query.getPrecisionStep();
        &lt;span class="code-keyword"&gt;if&lt;/span&gt; (query.getMin() != &lt;span class="code-keyword"&gt;null&lt;/span&gt;) result = result * prime + query.getMin().hashCode();
        &lt;span class="code-keyword"&gt;if&lt;/span&gt; (query.getMax() != &lt;span class="code-keyword"&gt;null&lt;/span&gt;) result = result * prime + query.getMax().hashCode();
        result = result * prime + &lt;span class="code-object"&gt;Boolean&lt;/span&gt;.valueOf(query.includesMin()).hashCode();
        result = result * prime + &lt;span class="code-object"&gt;Boolean&lt;/span&gt;.valueOf(query.includesMax()).hashCode();
        &lt;span class="code-keyword"&gt;return&lt;/span&gt; result;
    }

    &lt;span class="code-keyword"&gt;public&lt;/span&gt; &lt;span class="code-keyword"&gt;static&lt;/span&gt; void main(&lt;span class="code-object"&gt;String&lt;/span&gt;[] args) {
        &lt;span class="code-object"&gt;long&lt;/span&gt; previous = &lt;span class="code-object"&gt;Long&lt;/span&gt;.MIN_VALUE;
        &lt;span class="code-object"&gt;long&lt;/span&gt;[] list = {
                -9223372036854775798L,
                -8608480567731124078L,
                -7993589098607472357L,
                -7378697629483820637L,
                -6763806160360168916L,
                -6148914691236517196L,
                -5534023222112865475L,
                -4919131752989213755L,
                -4304240283865562034L,
                -3689348814741910314L,
                -3074457345618258593L,
                -2459565876494606873L,
                -1844674407370955152L,
                -1229782938247303432L,
                -614891469123651711L,
                10L,
                614891469123651730L,
                1229782938247303451L,
                1844674407370955171L,
                2459565876494606892L,
                3074457345618258612L,
                3689348814741910333L,
                4304240283865562053L,
                4919131752989213774L,
                5534023222112865494L,
                6148914691236517215L,
                6763806160360168935L,
                7378697629483820656L,
                7993589098607472376L,
                8608480567731124097L,
                &lt;span class="code-object"&gt;Long&lt;/span&gt;.MAX_VALUE
        };

        &lt;span class="code-keyword"&gt;for&lt;/span&gt; (&lt;span class="code-object"&gt;long&lt;/span&gt; current : list) {
            NumericRangeQuery&amp;lt;&lt;span class="code-object"&gt;Long&lt;/span&gt;&amp;gt; query =  NumericRangeQuery.newLongRange(&lt;span class="code-quote"&gt;"_token_long"&lt;/span&gt;, 8, previous, current, &lt;span class="code-keyword"&gt;true&lt;/span&gt;, &lt;span class="code-keyword"&gt;true&lt;/span&gt;);
            &lt;span class="code-object"&gt;System&lt;/span&gt;.out.println(&lt;span class="code-quote"&gt;"["&lt;/span&gt; + previous + &lt;span class="code-quote"&gt;" TO "&lt;/span&gt; + current + &lt;span class="code-quote"&gt;"]: "&lt;/span&gt; + query.hashCode() + &lt;span class="code-quote"&gt;" / "&lt;/span&gt; + betterHash(query));
            previous = current + 1;
        }
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment/>
        <key id="12862866">LUCENE-6793</key>
            <summary>NumericRangeQuery.hashCode() produces frequent collisions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="jblangston@datastax.com">J.B. Langston</reporter>
                        <labels>
                    </labels>
                <created>Wed, 9 Sep 2015 14:29:06 -0700</created>
                <updated>Fri, 26 Feb 2016 09:15:43 -0700</updated>
                            <resolved>Fri, 26 Feb 2016 09:15:43 -0700</resolved>
                                    <version>4.6</version>
                    <version>5.3</version>
                                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="14737955" author="yseeley@gmail.com" created="Wed, 9 Sep 2015 18:26:27 -0700">&lt;p&gt;Hmmm, yeah... the XORs of random constants don't actually accomplish much in the current hashCode since there is no bit shifting (and the xor operations will be done the same for all NumericRangeQueries).&lt;br/&gt;
Your betterHash looks much better, more in line with our other hashCode implementations.&lt;/p&gt;</comment>
                            <comment id="14738736" author="jpountz" created="Thu, 10 Sep 2015 06:26:42 -0700">&lt;p&gt;+1 to switching to the "times 31" method&lt;/p&gt;</comment>
                            <comment id="15169094" author="jpountz" created="Fri, 26 Feb 2016 07:34:39 -0700">&lt;p&gt;Here is a patch. This also fixes the new point queries that were using the same pattern for their hashcode.&lt;/p&gt;</comment>
                            <comment id="15169177" author="mikemccand" created="Fri, 26 Feb 2016 08:20:00 -0700">&lt;p&gt;Thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jpountz" class="user-hover" rel="jpountz"&gt;Adrien Grand&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="15169218" author="jira-bot" created="Fri, 26 Feb 2016 08:48:14 -0700">&lt;p&gt;Commit 509c6a0acbeaee6291bb80a5f9537aaff55599c4 in lucene-solr's branch refs/heads/master from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jpountz" class="user-hover" rel="jpountz"&gt;Adrien Grand&lt;/a&gt;&lt;br/&gt;
[ &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=509c6a0" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=509c6a0&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-6793" title="NumericRangeQuery.hashCode() produces frequent collisions" class="issue-link" data-issue-key="LUCENE-6793"&gt;&lt;del&gt;LUCENE-6793&lt;/del&gt;&lt;/a&gt;: Make LegacyNumericRangeQuery and point queries less subject to hash collisions.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12790141" name="LUCENE-6793.patch" size="3028" author="jpountz" created="Fri, 26 Feb 2016 07:34:39 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 10 Sep 2015 01:26:27 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2jyrz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-6740] Reduce warnings emitted by javac in Java 7/Java 8</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-6740</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;This is a overview issue about improvements to reduce warnings during the build. Since we moved trunk to Java 8 and branch_5x to Java 7, there were introduced some additional warnings, mostly in generated code.&lt;/p&gt;

&lt;p&gt;ANTLR4 does automatically add the needed @SuppressWarnings, but jflex does not. There are also some rawtypes warnings, which changed in Java 7 (before Java 7 there were only "unsafe" warnings, now you need both.&lt;/p&gt;

&lt;p&gt;I enabled the Warnings tracker in Policeman Jenkins, we can therefore very easily check the warnings: e.g. on trunk: &lt;a href="http://jenkins.thetaphi.de/job/Lucene-Solr-trunk-Linux/" class="external-link" rel="nofollow"&gt;http://jenkins.thetaphi.de/job/Lucene-Solr-trunk-Linux/&lt;/a&gt; (see diagram on the right), you can click on it, e.g. &lt;a href="http://jenkins.thetaphi.de/job/Lucene-Solr-trunk-Linux/warnings4" class="external-link" rel="nofollow"&gt;http://jenkins.thetaphi.de/job/Lucene-Solr-trunk-Linux/warnings4&lt;/a&gt;&lt;/p&gt;</description>
                <environment/>
        <key id="12856352">LUCENE-6740</key>
            <summary>Reduce warnings emitted by javac in Java 7/Java 8</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="thetaphi">Uwe Schindler</assignee>
                                    <reporter username="thetaphi">Uwe Schindler</reporter>
                        <labels>
                            <label>Java7</label>
                            <label>Java8</label>
                    </labels>
                <created>Sat, 15 Aug 2015 03:30:53 -0700</created>
                <updated>Tue, 23 Feb 2016 03:36:03 -0700</updated>
                                                            <fixVersion>master</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="14698211" author="thetaphi" created="Sat, 15 Aug 2015 03:32:15 -0700">&lt;p&gt;I will directly commit the changes, no patches (as there is no functionality change).&lt;/p&gt;</comment>
                            <comment id="14698212" author="jira-bot" created="Sat, 15 Aug 2015 03:32:59 -0700">&lt;p&gt;Commit 1696035 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi" class="user-hover" rel="thetaphi"&gt;Uwe Schindler&lt;/a&gt; in branch 'dev/trunk'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1696035" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1696035&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-6740" title="Reduce warnings emitted by javac in Java 7/Java 8" class="issue-link" data-issue-key="LUCENE-6740"&gt;LUCENE-6740&lt;/a&gt;: Reduce warnings emitted by javac&lt;/p&gt;</comment>
                            <comment id="14698230" author="jira-bot" created="Sat, 15 Aug 2015 03:51:37 -0700">&lt;p&gt;Commit 1696036 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi" class="user-hover" rel="thetaphi"&gt;Uwe Schindler&lt;/a&gt; in branch 'dev/branches/branch_5x'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1696036" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1696036&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Merged revision(s) 1696035 from lucene/dev/trunk:&lt;br/&gt;
&lt;a href="https://issues.apache.org/jira/browse/LUCENE-6740" title="Reduce warnings emitted by javac in Java 7/Java 8" class="issue-link" data-issue-key="LUCENE-6740"&gt;LUCENE-6740&lt;/a&gt;: Reduce warnings emitted by javac&lt;br/&gt;
(I also had to fix the old, deprecated jflex grammars, because they got out of sync with java code)&lt;/p&gt;</comment>
                            <comment id="14698245" author="jira-bot" created="Sat, 15 Aug 2015 05:03:30 -0700">&lt;p&gt;Commit 1696039 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi" class="user-hover" rel="thetaphi"&gt;Uwe Schindler&lt;/a&gt; in branch 'dev/branches/lucene_solr_5_3'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1696039" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1696039&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Merged revision(s) 1696036 from lucene/dev/branches/branch_5x (because of inability to regenerate jflex autogenerated files):&lt;br/&gt;
Merged revision(s) 1696035 from lucene/dev/trunk:&lt;br/&gt;
&lt;a href="https://issues.apache.org/jira/browse/LUCENE-6740" title="Reduce warnings emitted by javac in Java 7/Java 8" class="issue-link" data-issue-key="LUCENE-6740"&gt;LUCENE-6740&lt;/a&gt;: Reduce warnings emitted by javac&lt;br/&gt;
(I also had to fix the old, deprecated jflex grammars, because they got out of sync with java code)&lt;/p&gt;</comment>
                            <comment id="14698246" author="thetaphi" created="Sat, 15 Aug 2015 05:06:38 -0700">&lt;p&gt;I backported the last fix also to 5.3 branch, because the inability to regenerate java classes from jflex grammars is a blocker (the generated code did not even compile because of missing classes!!!)&lt;/p&gt;</comment>
                            <comment id="14698249" author="jira-bot" created="Sat, 15 Aug 2015 05:22:46 -0700">&lt;p&gt;Commit 1696044 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi" class="user-hover" rel="thetaphi"&gt;Uwe Schindler&lt;/a&gt; in branch 'dev/trunk'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1696044" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1696044&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-6740" title="Reduce warnings emitted by javac in Java 7/Java 8" class="issue-link" data-issue-key="LUCENE-6740"&gt;LUCENE-6740&lt;/a&gt;: Reduce warnings emitted by javac #2&lt;/p&gt;</comment>
                            <comment id="14698250" author="jira-bot" created="Sat, 15 Aug 2015 05:24:20 -0700">&lt;p&gt;Commit 1696046 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi" class="user-hover" rel="thetaphi"&gt;Uwe Schindler&lt;/a&gt; in branch 'dev/branches/branch_5x'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1696046" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1696046&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Merged revision(s) 1696044 from lucene/dev/trunk:&lt;br/&gt;
&lt;a href="https://issues.apache.org/jira/browse/LUCENE-6740" title="Reduce warnings emitted by javac in Java 7/Java 8" class="issue-link" data-issue-key="LUCENE-6740"&gt;LUCENE-6740&lt;/a&gt;: Reduce warnings emitted by javac #2&lt;/p&gt;</comment>
                            <comment id="14698252" author="jira-bot" created="Sat, 15 Aug 2015 05:38:12 -0700">&lt;p&gt;Commit 1696047 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi" class="user-hover" rel="thetaphi"&gt;Uwe Schindler&lt;/a&gt; in branch 'dev/trunk'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1696047" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1696047&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-6740" title="Reduce warnings emitted by javac in Java 7/Java 8" class="issue-link" data-issue-key="LUCENE-6740"&gt;LUCENE-6740&lt;/a&gt;: Reduce warnings emitted by javac #3&lt;/p&gt;</comment>
                            <comment id="14698253" author="jira-bot" created="Sat, 15 Aug 2015 05:39:13 -0700">&lt;p&gt;Commit 1696048 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi" class="user-hover" rel="thetaphi"&gt;Uwe Schindler&lt;/a&gt; in branch 'dev/branches/branch_5x'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1696048" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1696048&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Merged revision(s) 1696047 from lucene/dev/trunk:&lt;br/&gt;
&lt;a href="https://issues.apache.org/jira/browse/LUCENE-6740" title="Reduce warnings emitted by javac in Java 7/Java 8" class="issue-link" data-issue-key="LUCENE-6740"&gt;LUCENE-6740&lt;/a&gt;: Reduce warnings emitted by javac #3&lt;/p&gt;</comment>
                            <comment id="14698342" author="jira-bot" created="Sat, 15 Aug 2015 09:42:36 -0700">&lt;p&gt;Commit 1696064 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi" class="user-hover" rel="thetaphi"&gt;Uwe Schindler&lt;/a&gt; in branch 'dev/trunk'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1696064" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1696064&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-6741" title="Ant regenerate fails to be no-op on 5.x" class="issue-link" data-issue-key="LUCENE-6741"&gt;&lt;del&gt;LUCENE-6741&lt;/del&gt;&lt;/a&gt;: This was already fixed by &lt;a href="https://issues.apache.org/jira/browse/LUCENE-6740" title="Reduce warnings emitted by javac in Java 7/Java 8" class="issue-link" data-issue-key="LUCENE-6740"&gt;LUCENE-6740&lt;/a&gt;, just add this issue to track changes.&lt;/p&gt;</comment>
                            <comment id="14698344" author="jira-bot" created="Sat, 15 Aug 2015 09:43:54 -0700">&lt;p&gt;Commit 1696065 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi" class="user-hover" rel="thetaphi"&gt;Uwe Schindler&lt;/a&gt; in branch 'dev/branches/branch_5x'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1696065" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1696065&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Merged revision(s) 1696064 from lucene/dev/trunk:&lt;br/&gt;
&lt;a href="https://issues.apache.org/jira/browse/LUCENE-6741" title="Ant regenerate fails to be no-op on 5.x" class="issue-link" data-issue-key="LUCENE-6741"&gt;&lt;del&gt;LUCENE-6741&lt;/del&gt;&lt;/a&gt;: This was already fixed by &lt;a href="https://issues.apache.org/jira/browse/LUCENE-6740" title="Reduce warnings emitted by javac in Java 7/Java 8" class="issue-link" data-issue-key="LUCENE-6740"&gt;LUCENE-6740&lt;/a&gt;, just add this issue to track changes.&lt;/p&gt;</comment>
                            <comment id="14698346" author="jira-bot" created="Sat, 15 Aug 2015 09:44:49 -0700">&lt;p&gt;Commit 1696066 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi" class="user-hover" rel="thetaphi"&gt;Uwe Schindler&lt;/a&gt; in branch 'dev/branches/lucene_solr_5_3'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1696066" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1696066&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Merged revision(s) 1696065 from lucene/dev/branches/branch_5x:&lt;br/&gt;
Merged revision(s) 1696064 from lucene/dev/trunk:&lt;br/&gt;
&lt;a href="https://issues.apache.org/jira/browse/LUCENE-6741" title="Ant regenerate fails to be no-op on 5.x" class="issue-link" data-issue-key="LUCENE-6741"&gt;&lt;del&gt;LUCENE-6741&lt;/del&gt;&lt;/a&gt;: This was already fixed by &lt;a href="https://issues.apache.org/jira/browse/LUCENE-6740" title="Reduce warnings emitted by javac in Java 7/Java 8" class="issue-link" data-issue-key="LUCENE-6740"&gt;LUCENE-6740&lt;/a&gt;, just add this issue to track changes.&lt;/p&gt;</comment>
                            <comment id="14698366" author="jira-bot" created="Sat, 15 Aug 2015 10:35:05 -0700">&lt;p&gt;Commit 1696072 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi" class="user-hover" rel="thetaphi"&gt;Uwe Schindler&lt;/a&gt; in branch 'dev/trunk'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1696072" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1696072&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-6740" title="Reduce warnings emitted by javac in Java 7/Java 8" class="issue-link" data-issue-key="LUCENE-6740"&gt;LUCENE-6740&lt;/a&gt;: Reduce warnings emitted by javac #4 (tools)&lt;/p&gt;</comment>
                            <comment id="14698368" author="jira-bot" created="Sat, 15 Aug 2015 10:36:34 -0700">&lt;p&gt;Commit 1696073 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi" class="user-hover" rel="thetaphi"&gt;Uwe Schindler&lt;/a&gt; in branch 'dev/branches/branch_5x'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1696073" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1696073&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Merged revision(s) 1696072 from lucene/dev/trunk:&lt;br/&gt;
&lt;a href="https://issues.apache.org/jira/browse/LUCENE-6740" title="Reduce warnings emitted by javac in Java 7/Java 8" class="issue-link" data-issue-key="LUCENE-6740"&gt;LUCENE-6740&lt;/a&gt;: Reduce warnings emitted by javac #4 (tools)&lt;/p&gt;</comment>
                            <comment id="14698372" author="jira-bot" created="Sat, 15 Aug 2015 10:48:39 -0700">&lt;p&gt;Commit 1696076 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi" class="user-hover" rel="thetaphi"&gt;Uwe Schindler&lt;/a&gt; in branch 'dev/trunk'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1696076" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1696076&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-6740" title="Reduce warnings emitted by javac in Java 7/Java 8" class="issue-link" data-issue-key="LUCENE-6740"&gt;LUCENE-6740&lt;/a&gt;: Reduce warnings emitted by javac #5&lt;/p&gt;</comment>
                            <comment id="14698373" author="jira-bot" created="Sat, 15 Aug 2015 10:49:41 -0700">&lt;p&gt;Commit 1696077 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi" class="user-hover" rel="thetaphi"&gt;Uwe Schindler&lt;/a&gt; in branch 'dev/branches/branch_5x'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1696077" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1696077&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Merged revision(s) 1696076 from lucene/dev/trunk:&lt;br/&gt;
&lt;a href="https://issues.apache.org/jira/browse/LUCENE-6740" title="Reduce warnings emitted by javac in Java 7/Java 8" class="issue-link" data-issue-key="LUCENE-6740"&gt;LUCENE-6740&lt;/a&gt;: Reduce warnings emitted by javac #5&lt;/p&gt;</comment>
                            <comment id="14698387" author="jira-bot" created="Sat, 15 Aug 2015 11:04:26 -0700">&lt;p&gt;Commit 1696080 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi" class="user-hover" rel="thetaphi"&gt;Uwe Schindler&lt;/a&gt; in branch 'dev/trunk'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1696080" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1696080&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-6740" title="Reduce warnings emitted by javac in Java 7/Java 8" class="issue-link" data-issue-key="LUCENE-6740"&gt;LUCENE-6740&lt;/a&gt;: Reduce warnings emitted by javac #6&lt;/p&gt;</comment>
                            <comment id="14698388" author="jira-bot" created="Sat, 15 Aug 2015 11:06:05 -0700">&lt;p&gt;Commit 1696081 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi" class="user-hover" rel="thetaphi"&gt;Uwe Schindler&lt;/a&gt; in branch 'dev/branches/branch_5x'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1696081" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1696081&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Merged revision(s) 1696080 from lucene/dev/trunk:&lt;br/&gt;
&lt;a href="https://issues.apache.org/jira/browse/LUCENE-6740" title="Reduce warnings emitted by javac in Java 7/Java 8" class="issue-link" data-issue-key="LUCENE-6740"&gt;LUCENE-6740&lt;/a&gt;: Reduce warnings emitted by javac #6&lt;/p&gt;</comment>
                            <comment id="14698451" author="jira-bot" created="Sat, 15 Aug 2015 14:05:58 -0700">&lt;p&gt;Commit 1696098 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi" class="user-hover" rel="thetaphi"&gt;Uwe Schindler&lt;/a&gt; in branch 'dev/trunk'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1696098" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1696098&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-6740" title="Reduce warnings emitted by javac in Java 7/Java 8" class="issue-link" data-issue-key="LUCENE-6740"&gt;LUCENE-6740&lt;/a&gt;: Reduce warnings emitted by javac #7&lt;/p&gt;</comment>
                            <comment id="14698452" author="jira-bot" created="Sat, 15 Aug 2015 14:07:19 -0700">&lt;p&gt;Commit 1696099 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi" class="user-hover" rel="thetaphi"&gt;Uwe Schindler&lt;/a&gt; in branch 'dev/branches/branch_5x'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1696099" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1696099&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Merged revision(s) 1696098 from lucene/dev/trunk:&lt;br/&gt;
&lt;a href="https://issues.apache.org/jira/browse/LUCENE-6740" title="Reduce warnings emitted by javac in Java 7/Java 8" class="issue-link" data-issue-key="LUCENE-6740"&gt;LUCENE-6740&lt;/a&gt;: Reduce warnings emitted by javac #7&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310060">
                    <name>Container</name>
                                            <outwardlinks description="contains">
                                        <issuelink>
            <issuekey id="12856371">LUCENE-6741</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 15 Aug 2015 10:32:59 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            38 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2iylj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>

<item>
            <title>[LUCENE-6562] GeoPointInBBoxQuery should compute ranges once, not per-segment</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-6562</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;We tried to do this in the original issue, using the same shard attributes that FuzzyQuery did, but it's not quite working...&lt;/p&gt;</description>
                <environment/>
        <key id="12837498">LUCENE-6562</key>
            <summary>GeoPointInBBoxQuery should compute ranges once, not per-segment</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won't Fix</resolution>
                                        <assignee username="mikemccand">Michael McCandless</assignee>
                                    <reporter username="mikemccand">Michael McCandless</reporter>
                        <labels>
                    </labels>
                <created>Fri, 12 Jun 2015 12:36:11 -0700</created>
                <updated>Fri, 26 Feb 2016 08:56:48 -0700</updated>
                            <resolved>Fri, 26 Feb 2016 08:56:48 -0700</resolved>
                                                    <fixVersion>master</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="14583947" author="mikemccand" created="Fri, 12 Jun 2015 12:37:25 -0700">&lt;p&gt;Here's a &lt;span class="error"&gt;&amp;#91;failing&amp;#93;&lt;/span&gt; test case ... need to mull how best to fix it.&lt;/p&gt;</comment>
                            <comment id="14584220" author="mikemccand" created="Fri, 12 Jun 2015 15:54:25 -0700">&lt;p&gt;Here's one possible approach ... I save/share the single copy of the ranges via the rewrite method.  It's a little hokey and I had to change MTQCSW to pull the terms enum from the rewrite method but it seems to work.  I'm very open to other ideas ...&lt;/p&gt;

&lt;p&gt;Also, I changed GeoPointTermsEnum from LinkedList to ArrayList, and fixed it to not remove the ranges as it goes &lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/smile.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt;&lt;/p&gt;</comment>
                            <comment id="14606237" author="mikemccand" created="Mon, 29 Jun 2015 12:41:14 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi" class="user-hover" rel="thetaphi"&gt;Uwe Schindler&lt;/a&gt; I think you suggested (in person, over beers!) that there there a cleaner way to do this?  I forgot what you said, maybe too many beers.&lt;/p&gt;

&lt;p&gt;In this patch I made a custom rewrite method for these geo queries, which holds onto the ranges and shares across segments ...&lt;/p&gt;

&lt;p&gt;The ranges can become huge when the bbox is accidentally adversarial, so it'd be best to not regenerate per segment.&lt;/p&gt;

&lt;p&gt;I think we may want to set a limit on the queries too, much like how regexp queries limit the max determined states by default.&lt;/p&gt;</comment>
                            <comment id="14606254" author="thetaphi" created="Mon, 29 Jun 2015 12:45:11 -0700">&lt;p&gt;Let me look into it tomorrow &lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/wink.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt;&lt;/p&gt;</comment>
                            <comment id="14606423" author="thetaphi" created="Mon, 29 Jun 2015 14:19:29 -0700">&lt;p&gt;sorry wrong issue &lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/sad.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt; I will still look into this tomorrow, just edited wrong issue.&lt;/p&gt;</comment>
                            <comment id="14609169" author="nknize" created="Tue, 30 Jun 2015 15:13:18 -0700">&lt;p&gt;Let me know what you think about my initial fix for this in &lt;a href="https://issues.apache.org/jira/browse/LUCENE-6547" title="Add dateline crossing support to GeoPointInBBox and GeoPointDistance Queries" class="issue-link" data-issue-key="LUCENE-6547"&gt;&lt;del&gt;LUCENE-6547&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14610280" author="mikemccand" created="Wed, 1 Jul 2015 06:59:18 -0700">&lt;p&gt;Net/net I think we shouldn't pursue this optimization now: it's going to get too hairy.  And there may be larger changes to how the GeoPoint queries work that make this opto unnecessary ...&lt;/p&gt;</comment>
                            <comment id="14613674" author="thetaphi" created="Sat, 4 Jul 2015 03:34:12 -0700">&lt;p&gt;Sorry for taking so long, I will look into this hopefully not too late. I have this issue on my watch list. First I have to understand what Mike wants to do here, so I can use a custom rewriteMethod (per query instance) that does the rewrite. With Adriens recent changes to RewriteMethod we can make the RewriteMethod use any class (does not need to be a query) where it adds terms to, so you can first collect all terms, store them somehow and return them on every segment.&lt;/p&gt;

&lt;p&gt;Uwe&lt;/p&gt;</comment>
                            <comment id="14613680" author="mikemccand" created="Sat, 4 Jul 2015 03:41:11 -0700">&lt;p&gt;Thanks &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi" class="user-hover" rel="thetaphi"&gt;Uwe Schindler&lt;/a&gt;, I did create a custom rewrite method in this patch, and had to change MTQCSW to ask the rewrite method for the terms enum.  But this felt quite invasive ...&lt;/p&gt;</comment>
                            <comment id="14613681" author="mikemccand" created="Sat, 4 Jul 2015 03:42:03 -0700">&lt;p&gt;Also, another problem with the patch is the big list of terms is still held even after query is done executing ... we need to add a test case catching this, and somehow fix it.&lt;/p&gt;</comment>
                            <comment id="14713360" author="shalinmangar" created="Wed, 26 Aug 2015 06:13:16 -0700">&lt;p&gt;Bulk move to 5.4 after 5.3 release.&lt;/p&gt;</comment>
                            <comment id="15158685" author="mikemccand" created="Tue, 23 Feb 2016 03:34:41 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nknize" class="user-hover" rel="nknize"&gt;Nicholas Knize&lt;/a&gt; can we resolve this as won't fix?  I.e. &lt;a href="https://issues.apache.org/jira/browse/LUCENE-6930" title="Decouple GeoPointField from NumericType" class="issue-link" data-issue-key="LUCENE-6930"&gt;&lt;del&gt;LUCENE-6930&lt;/del&gt;&lt;/a&gt; makes the term enumeration much more efficient so that redoing it per-segment is OK?&lt;/p&gt;</comment>
                            <comment id="15169227" author="nknize" created="Fri, 26 Feb 2016 08:56:48 -0700">&lt;p&gt;Obsolete per &lt;a href="https://issues.apache.org/jira/browse/LUCENE-6930" title="Decouple GeoPointField from NumericType" class="issue-link" data-issue-key="LUCENE-6930"&gt;&lt;del&gt;LUCENE-6930&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12739359" name="LUCENE-6562.patch" size="15598" author="mikemccand" created="Fri, 12 Jun 2015 15:54:25 -0700"/>
                            <attachment id="12739311" name="LUCENE-6562.patch" size="2209" author="mikemccand" created="Fri, 12 Jun 2015 12:37:25 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 29 Jun 2015 19:45:11 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2fznr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-6541] Geo3d WGS84 parameters not quite right</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-6541</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;The PlanetModel parameters for WGS84 are correct only to within 7 significant digits.  In particular, the polar radius is not quite the WGS84 value.&lt;/p&gt;</description>
                <environment/>
        <key id="12836677">LUCENE-6541</key>
            <summary>Geo3d WGS84 parameters not quite right</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="kwright@metacarta.com">Karl Wright</reporter>
                        <labels>
                    </labels>
                <created>Tue, 9 Jun 2015 15:14:46 -0700</created>
                <updated>Thu, 25 Feb 2016 11:58:04 -0700</updated>
                            <resolved>Thu, 25 Feb 2016 11:58:04 -0700</resolved>
                                                    <fixVersion>5.4</fixVersion>
                    <fixVersion>master</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>modules/spatial</component>
                        <due/>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="14579729" author="kwright@metacarta.com" created="Tue, 9 Jun 2015 16:16:49 -0700">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nknize" class="user-hover" rel="nknize"&gt;Nicholas Knize&lt;/a&gt;, did you have a chance to evaluate geo3d with WGS84 support?&lt;/p&gt;</comment>
                            <comment id="15167644" author="mikemccand" created="Thu, 25 Feb 2016 11:58:04 -0700">&lt;p&gt;Looks like this patch was already applied at some point.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12738684" name="LUCENE-6541.patch" size="737" author="kwright@metacarta.com" created="Tue, 9 Jun 2015 15:17:58 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 25 Feb 2016 18:58:04 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2fuqv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-5596] Support for index/search large numeric field</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-5596</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;Currently if an number is larger than Long.MAX_VALUE, we can't index/search that in lucene as a number. For example, IPv6 address is an 128 bit number, so we can't index that as a numeric field and do numeric range query etc.&lt;/p&gt;

&lt;p&gt;It would be good to support BigInteger / BigDecimal&lt;/p&gt;

&lt;p&gt;I've tried use BigInteger for IPv6 in Elasticsearch and that works fine, but there are still lots of things to do&lt;br/&gt;
&lt;a href="https://github.com/elasticsearch/elasticsearch/pull/5758" class="external-link" rel="nofollow"&gt;https://github.com/elasticsearch/elasticsearch/pull/5758&lt;/a&gt;&lt;/p&gt;
</description>
                <environment/>
        <key id="12707846">LUCENE-5596</key>
            <summary>Support for index/search large numeric field</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="thetaphi">Uwe Schindler</assignee>
                                    <reporter username="kzwang">Kevin Wang</reporter>
                        <labels>
                    </labels>
                <created>Thu, 10 Apr 2014 18:03:00 -0700</created>
                <updated>Tue, 8 Mar 2016 20:55:14 -0700</updated>
                            <resolved>Tue, 8 Mar 2016 20:55:13 -0700</resolved>
                                                    <fixVersion>6.0</fixVersion>
                                        <due/>
                            <votes>3</votes>
                                    <watches>13</watches>
                                                                <comments>
                            <comment id="13968085" author="kzwang" created="Sun, 13 Apr 2014 22:06:55 -0700">&lt;p&gt;initial patch to support BigInteger, I've copied and modified some tests for long field (e.g. TestNumericUtils, TestNumericTokenStream, TestNumericRangeQuery, TestSortDocValues) to support BigInteger and all passed.&lt;/p&gt;
</comment>
                            <comment id="13969255" author="kzwang" created="Mon, 14 Apr 2014 23:05:23 -0700">&lt;p&gt;updated patch to store BigInteger as byte array instead of string for stored field and add BigInteger support for query parser&lt;/p&gt;</comment>
                            <comment id="13969258" author="rcmuir" created="Mon, 14 Apr 2014 23:20:22 -0700">&lt;p&gt;Hey, looks like a pretty thorough job here. Do you think BigNumericTokenStream should be combined with NumericTokenStream or kept separate? Maybe instead of NumericTokenStream working with longs in its setter (only for the attributeimpl to convert to bytes), it should just do that up front so it can work with BigInteger too?&lt;/p&gt;

&lt;p&gt;Do you think the fieldcache impl should instead just act like a filtered BinaryDocValues (BytesRef api) instead of a BigInteger[]? This would allow it to just use a large paged byte[] instead of holding millions of biginteger objects. This would work fine for sorting too right (just compare bytes) ?&lt;/p&gt;

&lt;p&gt;Maybe &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi" class="user-hover" rel="thetaphi"&gt;Uwe Schindler&lt;/a&gt; can take a look when he gets some time.&lt;/p&gt;</comment>
                            <comment id="13969263" author="kzwang" created="Mon, 14 Apr 2014 23:31:14 -0700">&lt;p&gt;Hi &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir" class="user-hover" rel="rcmuir"&gt;Robert Muir&lt;/a&gt;, for the NumericTokenStream, the getRawValue() and init() both only handles long value, so I don't want to change the existing behaviour.&lt;br/&gt;
I'll change the field cache to bytes to see if it works.&lt;/p&gt;</comment>
                            <comment id="13969276" author="thetaphi" created="Mon, 14 Apr 2014 23:52:37 -0700">&lt;p&gt;Hi,&lt;br/&gt;
I agree with Robert. To mee it looks like the code duplication comes from the original patch for ElasticSearch.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Hi Robert Muir, for the NumericTokenStream, the getRawValue() and init() both only handles long value, so I don't want to change the existing behaviour. I'll change the field cache to bytes to see if it works.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;In any case: The already existing attributes in NumericTokenStream should be reused, they are duplicated in both classes, although the attributes are public! The one attribute which handles the value itsself can be duplicated or we move to BigInteger alltogether (but this has some overhead).&lt;/p&gt;

&lt;p&gt;BigNumericUtils can be merged with NumericUtils. Please also sort the methods next to each other, so they are grouped by purpose and then following one for each type&lt;/p&gt;

&lt;p&gt;FYI: There is already another issue in ES about BigDecimals and BigIntegers: &lt;a href="https://github.com/elasticsearch/elasticsearch/pull/5683" class="external-link" rel="nofollow"&gt;https://github.com/elasticsearch/elasticsearch/pull/5683&lt;/a&gt; and &lt;a href="https://github.com/elasticsearch/elasticsearch/pull/5491" class="external-link" rel="nofollow"&gt;https://github.com/elasticsearch/elasticsearch/pull/5491&lt;/a&gt; - It would be worth to comine the approaches. This issue is not only about the JSON encoding, they also talk about facetting and other stuff on these fields.&lt;/p&gt;

&lt;p&gt;Finally, we should also add BigDecimal support. This just requires something like double2SortableLong() for BigDecimal -&amp;gt; BigInteger.&lt;/p&gt;</comment>
                            <comment id="13969279" author="thetaphi" created="Mon, 14 Apr 2014 23:54:04 -0700">&lt;p&gt;We can maybe have a common abstract base class for NumericTokenStream, defining common attributes and the algorithm, and subclasses per type that initializes the attributes. ...just throwing in ideas...&lt;/p&gt;</comment>
                            <comment id="13969284" author="jpountz" created="Tue, 15 Apr 2014 00:09:23 -0700">&lt;blockquote&gt;&lt;p&gt;There is already another issue in ES about BigDecimals and BigIntegers &lt;span class="error"&gt;&amp;#91;...&amp;#93;&lt;/span&gt; It would be worth to comine the approaches.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Maybe we should support variable-length bytes in general, so that this could also be applied to String fields? In a similar way to the fact that the edge-ngram and the shingle filters allow to pre-index prefix and phrase queries, I think it would also be nice to pre-index range queries.&lt;/p&gt;</comment>
                            <comment id="13969292" author="thetaphi" created="Tue, 15 Apr 2014 00:17:59 -0700">&lt;p&gt;There is one problem with the patch: Lucene currently encodes the shift value in the indexed tokens (xxxToPrefixCoded) with some offset as "type marker" (SHIFT_START_*; see e.g., &lt;a href="http://grepcode.com/file/repo1.maven.org/maven2/org.apache.lucene/lucene-core/4.6.0/org/apache/lucene/util/NumericUtils.java#149" class="external-link" rel="nofollow"&gt;http://grepcode.com/file/repo1.maven.org/maven2/org.apache.lucene/lucene-core/4.6.0/org/apache/lucene/util/NumericUtils.java#149&lt;/a&gt;). By that, it is ensured, that you hit no documents, if you index a field as integer but query as long, the differently encoded shift ensures that you don't find the term in the dictionary, so no documents are returned. With your patch, one can index a BigInteger and it might return random hits if queried as long or int range. Unfortunately the current "shift encoding" only supports fictional "short" and "byte", which is never used.&lt;br/&gt;
A second problem is: You are limited to a maximum shift of 127 (or 255 if you correctly mask the shift byte) currently, otherwise the encoding overflows.&lt;/p&gt;

&lt;p&gt;I am not sure how to handle this. The main problem is Lucene's schemaless design (the index does not know the type of the field, except for stored fields), the "shift encoding" with the type marker bits is just a hack around that, to no produce incorrect results.&lt;/p&gt;

&lt;p&gt;Because of that we should really do some investigation before starting to push those changes in. Maybe only make it work on Lucene trunk only and change the index encoding completely.&lt;/p&gt;</comment>
                            <comment id="13969294" author="thetaphi" created="Tue, 15 Apr 2014 00:23:02 -0700">&lt;blockquote&gt;&lt;p&gt;Maybe we should support variable-length bytes in general, so that this could also be applied to String fields? In a similar way to the fact that the edge-ngram and the shingle filters allow to pre-index prefix and phrase queries, I think it would also be nice to pre-index range queries.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This is a good idea. We should keep the primitive types, which support precisionSteps on the bit level, but those types like BigDecimal or BigInteger should maybe use precisionSteps of multiples than 8 only. In fact this would only require to write a TokenStream that explodes every term to prefix terms, with shift markers. By that we would not need any numeric stuff to handle those anymore:&lt;/p&gt;
&lt;ul class="alternate" type="square"&gt;
	&lt;li&gt;PrefixTermsTokenFilter as last TokenFilter&lt;/li&gt;
	&lt;li&gt;some generic MultiTermQuery that does a similar stuff like NumericUtils.splitTerms(), just on the byte[] level&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13969297" author="rcmuir" created="Tue, 15 Apr 2014 00:25:48 -0700">&lt;p&gt;It would be great if we did that, and somehow fit numerictokenstream to be more "ordinary" in the analysis chain, such that e.g. the queryparser getRangeQuery could just do the right thing out of box...&lt;/p&gt;</comment>
                            <comment id="13969298" author="jpountz" created="Tue, 15 Apr 2014 00:28:28 -0700">&lt;blockquote&gt;&lt;p&gt;but those types like BigDecimal or BigInteger should maybe use precisionSteps of multiples than 8 only&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1 Anything below would certainly be wasteful.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;PrefixTermsTokenFilter / MultiTermQuery like NumericUtils.splitTerms()&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This sounds good!&lt;/p&gt;</comment>
                            <comment id="13969300" author="thetaphi" created="Tue, 15 Apr 2014 00:31:46 -0700">&lt;p&gt;I would in that case don't do the BigInteger stuff in Lucene at all. ElasticSearch would just provide some byte[] to index and we take care of the encoding with a custom TokenFilter and provide &lt;tt&gt;ByteRangeQuery&lt;/tt&gt;. For DocValues and stored fields no changes are needed at all (just use byte[] type already there for docvalues and stored fields).&lt;/p&gt;

&lt;p&gt;We can implement this in the queries module, I don't think this needs to be in core.&lt;/p&gt;</comment>
                            <comment id="13969306" author="jpountz" created="Tue, 15 Apr 2014 00:39:57 -0700">&lt;blockquote&gt;&lt;p&gt;I would in that case don't do the BigInteger stuff in Lucene at all.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Would it make sense to just have utility methods to convert BigDecimals and BigIntegers to sortable bytes?&lt;/p&gt;</comment>
                            <comment id="13969310" author="thetaphi" created="Tue, 15 Apr 2014 00:45:46 -0700">&lt;blockquote&gt;&lt;p&gt;Would it make sense to just have utility methods to convert BigDecimals and BigIntegers to sortable bytes?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think so.&lt;/p&gt;</comment>
                            <comment id="13969318" author="kzwang" created="Tue, 15 Apr 2014 01:05:35 -0700">&lt;p&gt;+1 for ByteRangeQuery, I'll work on a patch for that first&lt;/p&gt;</comment>
                            <comment id="13969324" author="thetaphi" created="Tue, 15 Apr 2014 01:17:18 -0700">&lt;p&gt;Hi,&lt;br/&gt;
I would start with a TokenStream only, like we do for NumericTokenStream. The solution with a TokenFilter is currently not doable, because of the coupling of TermToBytesRef attribute and CharTermAttribute with only using an AttributeFactory as workaround to decouple. I am thinking about a better solution for Lucene 5.0, this is one of the big issues preventing people from indexing pure-byte[] terms.&lt;/p&gt;

&lt;p&gt;About the ES issue: If we have some byte[] support, there is no need to use BigInteger for IPv6 adresses! Just use &lt;a href="http://docs.oracle.com/javase/7/docs/api/java/net/Inet6Address.html#getAddress()" class="external-link" rel="nofollow"&gt;http://docs.oracle.com/javase/7/docs/api/java/net/Inet6Address.html#getAddress()&lt;/a&gt; to get the bytes of the address in network byte order (big endian), no need to convert to BigInteger first and deal with the stupid signedness issues. This would also work with IPv4 addresses, which return a &lt;tt&gt;byte[4]&lt;/tt&gt; on the same method (see base class &lt;a href="http://docs.oracle.com/javase/7/docs/api/java/net/InetAddress.html#getAddress()" class="external-link" rel="nofollow"&gt;http://docs.oracle.com/javase/7/docs/api/java/net/InetAddress.html#getAddress()&lt;/a&gt;).&lt;/p&gt;</comment>
                            <comment id="13969339" author="thetaphi" created="Tue, 15 Apr 2014 01:37:58 -0700">&lt;blockquote&gt;&lt;p&gt;+1 for ByteRangeQuery, I'll work on a patch for that first&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Maybe we should discuss the API first, I don't like people doing lots of code refactoring without knowing how it should look like. I have more ideas, maybe we should name it "BinaryField", which then would support all: indexing, storing, docvalues. Currently binary only works for stored fields and so on. So we should craefully think about that.&lt;/p&gt;

&lt;p&gt;The precisionStep (in that case not with "bit" as unit, but full "bytes") would just be an option for those binary terms. We can then add a BinaryRangeQuery, that can optionally use a precision step.&lt;/p&gt;

&lt;p&gt;Under the hood, we could also add precisionStep support for TermRangeQuery (just an idea)...&lt;/p&gt;</comment>
                            <comment id="13969350" author="jpountz" created="Tue, 15 Apr 2014 01:53:46 -0700">&lt;blockquote&gt;&lt;p&gt;Maybe we should discuss the API first&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I'm also interested in how we plan to encode terms. NumericUtils currently encodes shifts on a single byte but if we aim at supporting variable-length data, I guess we either need to enforce a maximum length of 255 on terms or use a different encoding.&lt;/p&gt;</comment>
                            <comment id="13969364" author="thetaphi" created="Tue, 15 Apr 2014 02:22:41 -0700">&lt;blockquote&gt;&lt;p&gt;I'm also interested in how we plan to encode terms. NumericUtils currently encodes shifts on a single byte but if we aim at supporting variable-length data, I guess we either need to enforce a maximum length of 255 on terms or use a different encoding.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I agree! There are 2 problems:&lt;/p&gt;
&lt;ul class="alternate" type="square"&gt;
	&lt;li&gt;The idea behind the "prefixed" shift value byte is: Terms with one shift value should be grouped together in the index. So BytesRef.compareTo(otherBytesRef) should behave like: terms with smaller shift value should be binary smaller. The full-length terms must come first (shift value = 0). Based on this, term enumerations can easily seek and stuff like FieldCache can stop iterating terms after visiting all zero-shift terms. Also we can make the MultiTermQuery only seek forward in the TermsEnum (very important) - zthis is the reason for the whole setup we currently have!&lt;/li&gt;
	&lt;li&gt;If we need longer terms than 255, we would need 2 bytes to encode maximum shift. On the other hand this is wasteful not only because of an additional byte per term, it is also wasteful because of number of terms, where it is unlikely to have many terms that differ only on the last few bytes. Prefix encoding only makes sense for common prefixes which appear millions of times in your index, Maybe we should instead of storing the shift value in the first byte, store the (inverse) number of preserved bits (255-preservedBits)! Important is: byte 0 =&amp;gt; full precision. Longer terms are only prefixed up to a maximum length, the remaining stuff is only stored full precision. In fact we only apply prefix terms to the first n bytes of the term, everything loger gets stored in full precision only. I think, it makes no sense to have longer prefixes than maybe 8 bytes in the index.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13969387" author="thetaphi" created="Tue, 15 Apr 2014 02:41:09 -0700">&lt;p&gt;About the API: We should not add new types at all. We need 2 things:&lt;/p&gt;
&lt;ul class="alternate" type="square"&gt;
	&lt;li&gt;a BinaryField that is just indexing the given &lt;tt&gt;byte[]&lt;/tt&gt; as is (&lt;a href="http://lucene.apache.org/core/4_7_2/core/org/apache/lucene/document/Field.html" class="external-link" rel="nofollow"&gt;http://lucene.apache.org/core/4_7_2/core/org/apache/lucene/document/Field.html&lt;/a&gt;, see ctor taking &lt;tt&gt;byte[]&lt;/tt&gt;, offset, count). Optionally, enable "prefix encoding" (which is the only new feature), otherwise changes are minimal.&lt;/li&gt;
	&lt;li&gt;TermRangeQuery already works with non-prefix encoded bytes: &lt;a href="http://lucene.apache.org/core/4_7_2/core/org/apache/lucene/search/TermRangeQuery.html#TermRangeQuery(java.lang.String, org.apache.lucene.util.BytesRef, org.apache.lucene.util.BytesRef, boolean, boolean)" class="external-link" rel="nofollow"&gt;http://lucene.apache.org/core/4_7_2/core/org/apache/lucene/search/TermRangeQuery.html#TermRangeQuery(java.lang.String, org.apache.lucene.util.BytesRef, org.apache.lucene.util.BytesRef, boolean, boolean)&lt;/a&gt;, we just need to add support for prefix encoded terms (parameter like precisionStep or FieldType - i think FieldType is better to drive the range query, so it automatically knows how to enumerate terms). By default, if no FieldType is given, it just assumes non-prefix encoded terms.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13969391" author="jpountz" created="Tue, 15 Apr 2014 02:49:14 -0700">&lt;blockquote&gt;&lt;p&gt;Longer terms are only prefixed up to a maximum length, the remaining stuff is only stored full precision. In fact we only apply prefix terms to the first n bytes of the term, everything loger gets stored in full precision only. I think, it makes no sense to have longer prefixes than maybe 8 bytes in the index.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1 I think this makes sense to have a maximum prefix length (that would be configurable hopefully) and enforce that this maximum prefix length is less than 255.&lt;/p&gt;

&lt;p&gt;This makes me wonder it would be nice to have something that adapts itself to the data, and would only index prefixes that match more than X terms (maybe similarly to the way that the block tree terms dict tries to share prefixes). But this looks significantly harder to implement!&lt;br/&gt;
Maybe &lt;a href="https://issues.apache.org/jira/browse/LUCENE-5422" title="Postings lists deduplication" class="issue-link" data-issue-key="LUCENE-5422"&gt;LUCENE-5422&lt;/a&gt; could be of interest as well: for example if the set of terms that have "XY" and "XYZ" as prefixes are the same, they could point to the same postings list. (Just wild ideas, feel free to ignore them &lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/smile.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt;)&lt;/p&gt;</comment>
                            <comment id="13969406" author="thetaphi" created="Tue, 15 Apr 2014 03:15:32 -0700">&lt;blockquote&gt;&lt;p&gt;(parameter like precisionStep or FieldType - i think FieldType is better to drive the range query, so it automatically knows how to enumerate terms). By default, if no FieldType is given, it just assumes non-prefix encoded terms.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I opened &lt;a href="https://issues.apache.org/jira/browse/LUCENE-5605" title="Don&amp;#39;t pass precisionStep directly to NRQ/NRF. Instead pass the FieldType" class="issue-link" data-issue-key="LUCENE-5605"&gt;LUCENE-5605&lt;/a&gt; about passing FieldType to NumericRangeQuery, too.&lt;/p&gt;</comment>
                            <comment id="14157895" author="dsmiley" created="Fri, 3 Oct 2014 04:38:49 -0700">&lt;p&gt;This is going to be largely obsolete by &lt;a href="https://issues.apache.org/jira/browse/LUCENE-5879" title="Add auto-prefix terms to block tree terms dict" class="issue-link" data-issue-key="LUCENE-5879"&gt;&lt;del&gt;LUCENE-5879&lt;/del&gt;&lt;/a&gt;.  All that will remain to do is to encode the IPv6 into a single term, probably with the 16 byte representation, and that's it.  Alternatively you might use half of each byte and thus use 32 bytes which could result in even faster range queries... but I probably wouldn't bother.&lt;/p&gt;</comment>
                            <comment id="14157908" author="jpountz" created="Fri, 3 Oct 2014 04:41:53 -0700">&lt;p&gt;Agreed, I think we can close this issue.&lt;/p&gt;</comment>
                            <comment id="14161144" author="mikemccand" created="Mon, 6 Oct 2014 15:38:19 -0700">&lt;p&gt;I think even if we somehow get &lt;a href="https://issues.apache.org/jira/browse/LUCENE-5879" title="Add auto-prefix terms to block tree terms dict" class="issue-link" data-issue-key="LUCENE-5879"&gt;&lt;del&gt;LUCENE-5879&lt;/del&gt;&lt;/a&gt; in, there is still work to do under this issue, e.g. to add sugar to translate the IP address to the right byte[], to accept range queries in query parser, ...&lt;/p&gt;</comment>
                            <comment id="15186451" author="dsmiley" created="Tue, 8 Mar 2016 20:55:14 -0700">&lt;p&gt;Closing; it's already been done via BinaryPoint in Lucene 6.0.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12755247">SOLR-6741</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310051">
                    <name>Supercedes</name>
                                                                <inwardlinks description="is superceded by">
                                        <issuelink>
            <issuekey id="12732796">LUCENE-5879</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12640210" name="LUCENE-5596.patch" size="139541" author="kzwang" created="Mon, 14 Apr 2014 23:05:23 -0700"/>
                            <attachment id="12640023" name="LUCENE-5596.patch" size="98410" author="kzwang" created="Sun, 13 Apr 2014 22:06:55 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 15 Apr 2014 06:20:22 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>386169</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1uixb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>386434</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>

<item>
            <title>[LUCENE-5438] add near-real-time replication</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-5438</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;Lucene's replication module makes it easy to incrementally sync index&lt;br/&gt;
changes from a master index to any number of replicas, and it&lt;br/&gt;
handles/abstracts all the underlying complexity of holding a&lt;br/&gt;
time-expiring snapshot, finding which files need copying, syncing more&lt;br/&gt;
than one index (e.g., taxo + index), etc.&lt;/p&gt;

&lt;p&gt;But today you must first commit on the master, and then again the&lt;br/&gt;
replica's copied files are fsync'd, because the code operates on&lt;br/&gt;
commit points.  But this isn't "technically" necessary, and it mixes&lt;br/&gt;
up durability and fast turnaround time.&lt;/p&gt;

&lt;p&gt;Long ago we added near-real-time readers to Lucene, for the same&lt;br/&gt;
reason: you shouldn't have to commit just to see the new index&lt;br/&gt;
changes.&lt;/p&gt;

&lt;p&gt;I think we should do the same for replication: allow the new segments&lt;br/&gt;
to be copied out to replica(s), and new NRT readers to be opened, to&lt;br/&gt;
fully decouple committing from visibility.  This way apps can then&lt;br/&gt;
separately choose when to replicate (for freshness), and when to&lt;br/&gt;
commit (for durability).&lt;/p&gt;

&lt;p&gt;I think for some apps this could be a compelling alternative to the&lt;br/&gt;
"re-index all documents on each shard" approach that Solr Cloud /&lt;br/&gt;
ElasticSearch implement today, and it may also mean that the&lt;br/&gt;
transaction log can remain external to / above the cluster.&lt;/p&gt;</description>
                <environment/>
        <key id="12693875">LUCENE-5438</key>
            <summary>add near-real-time replication</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mikemccand">Michael McCandless</assignee>
                                    <reporter username="mikemccand">Michael McCandless</reporter>
                        <labels>
                    </labels>
                <created>Fri, 7 Feb 2014 05:42:40 -0700</created>
                <updated>Thu, 11 Feb 2016 10:26:26 -0700</updated>
                            <resolved>Thu, 11 Feb 2016 09:43:56 -0700</resolved>
                                                    <fixVersion>6.0</fixVersion>
                                    <component>modules/replicator</component>
                        <due/>
                            <votes>2</votes>
                                    <watches>10</watches>
                                                                <comments>
                            <comment id="13894467" author="mikemccand" created="Fri, 7 Feb 2014 05:49:39 -0700">&lt;p&gt;Initial, very exploratory patch; it just contains a test case&lt;br/&gt;
(TestNRTReplication), showing how NRT replication could work.  It's&lt;br/&gt;
not yet at all integrated with the replication module's existing&lt;br/&gt;
APIs... and I'm not sure how to do that.&lt;/p&gt;

&lt;p&gt;But the test doesn't cheat, i.e. all index changes are pushed via&lt;br/&gt;
byte[] / file copy from master to replica, and it does pass... though&lt;br/&gt;
the CheckIndex that MDW.close calls is very slow, I think because of&lt;br/&gt;
the term vector / postings cross checking.&lt;/p&gt;

&lt;p&gt;Flushed segments are "immediately" pushed to the replica; merged&lt;br/&gt;
segments are first "warmed" by pre-copying to the replica with lower&lt;br/&gt;
priority.  I also created a simple ReferenceManager&amp;lt;IS&amp;gt; that does the&lt;br/&gt;
reopen from a provided SegmentInfos, which the app on the replica side&lt;br/&gt;
would use to obtain fresh searchers.  From that point it can use&lt;br/&gt;
SearcherLifetimeManager "as usual" to track/expire past searchers.&lt;/p&gt;</comment>
                            <comment id="13894645" author="markrmiller@gmail.com" created="Fri, 7 Feb 2014 08:49:18 -0700">&lt;p&gt;Very interesting - can't wait to see how the performance works out.&lt;/p&gt;

&lt;p&gt;Trying to move Solr over to the replication module is something I've briefly thought about here and there - and then stopped like touching an electric fence &lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/smile.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt; It took so much work and effort to get the current replication code very stable with SolrCloud that I don't look forward to such a challenge in the near future.&lt;/p&gt;

&lt;p&gt;We would def like to have the ability to only index once. Of course, if you are sending documents to replicas async while indexing on the leader (we don't yet), I wonder how much benefit you get?&lt;/p&gt;

&lt;p&gt;Hopefully work like this gets some others interested in giving a replication overhaul a shot. &lt;/p&gt;</comment>
                            <comment id="13896779" author="mikemccand" created="Mon, 10 Feb 2014 10:32:29 -0700">&lt;p&gt;New patch, improving the test case.  I added some abstraction (Replica class), and the test now randomly commits/stops/starts replicas.&lt;/p&gt;</comment>
                            <comment id="13903366" author="shaie" created="Mon, 17 Feb 2014 09:57:59 -0700">&lt;p&gt;I reviewed the patch and looks like it can roughly be divided to two:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Infrastructure: IndexWriter.flushAndIncRef(), SIS.write/read(DataOutput/Input), SDR being public...&lt;/li&gt;
	&lt;li&gt;Replication: all in the test, in the form of Replica and the various threads&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;What we need is to figure out how to tie the replication stuff with the Replicator API. I thought about it, discussed a bit with Mike, and here's a proposal:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Implement NRTRevision which will list the NRT files (flushed segments) and the SIS-as-byte[] that we get from IW.flushAndIncRef().&lt;/li&gt;
	&lt;li&gt;Implement NRTIndexUpdateHandler (replica side) to act on the special revision, and use the SIS.read() API and SDR().
	&lt;ul&gt;
		&lt;li&gt;We might also need the ReferenceManager that exists in the patch, which acts upon a SIS, rather than looking up commit points.&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;That will get NRT segments appear on the replicas easily, with some caveats:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;The replicas will need to copy over merged segments, which can take a lot of time, and hurts the latency.&lt;/li&gt;
	&lt;li&gt;The replicas communicate w/ the primary node at their own leisure (well, configured interval), and for NRT we might want to notify the replicas of new files, to reduce latency.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;As for merged segments, the patch includes the foundation for it already in the form of MergedSegmentWarmer, which holds on to the merged segments until all replicas successfully copied it. That way replicas copy the big segments and only after all of them are done, the merged segment is exposed to the SIS on the primary side, and a new NRTRevision will list it. There are still issues to take care of, such as replicas failing etc., but it's impl details I think.&lt;/p&gt;

&lt;p&gt;To handle the push/pull issue we can offer another Replicator implementation - PushReplicator - which is given a list of replicas and every .publish() is communicated to all replicas so that they can start copying files immediately. Every replica will have an associated thread on the primary side to handle the replication logic and report on any failures that occurred with the replica. This will help w/ the bookkeeping that needs to be done on the primary side.&lt;/p&gt;

&lt;p&gt;These are all just preliminary thoughts, I'm sure there are fun gotchas &lt;img class="emoticon" src="https://issues.apache.org/jira/images/icons/emoticons/smile.gif" height="16" width="16" align="absmiddle" alt="" border="0"/&gt;.&lt;/p&gt;</comment>
                            <comment id="13904436" author="jira-bot" created="Tue, 18 Feb 2014 12:20:33 -0700">&lt;p&gt;Commit 1569488 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mikemccand" class="user-hover" rel="mikemccand"&gt;Michael McCandless&lt;/a&gt; in branch 'dev/branches/lucene5438'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1569488" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1569488&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-5438" title="add near-real-time replication" class="issue-link" data-issue-key="LUCENE-5438"&gt;&lt;del&gt;LUCENE-5438&lt;/del&gt;&lt;/a&gt;: make branch&lt;/p&gt;</comment>
                            <comment id="13904442" author="jira-bot" created="Tue, 18 Feb 2014 12:23:24 -0700">&lt;p&gt;Commit 1569489 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mikemccand" class="user-hover" rel="mikemccand"&gt;Michael McCandless&lt;/a&gt; in branch 'dev/branches/lucene5438'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1569489" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1569489&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-5438" title="add near-real-time replication" class="issue-link" data-issue-key="LUCENE-5438"&gt;&lt;del&gt;LUCENE-5438&lt;/del&gt;&lt;/a&gt;: commit current state&lt;/p&gt;</comment>
                            <comment id="13904449" author="jira-bot" created="Tue, 18 Feb 2014 12:28:59 -0700">&lt;p&gt;Commit 1569499 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mikemccand" class="user-hover" rel="mikemccand"&gt;Michael McCandless&lt;/a&gt; in branch 'dev/branches/lucene5438'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1569499" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1569499&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-5438" title="add near-real-time replication" class="issue-link" data-issue-key="LUCENE-5438"&gt;&lt;del&gt;LUCENE-5438&lt;/del&gt;&lt;/a&gt;: fix javadoc&lt;/p&gt;</comment>
                            <comment id="13905331" author="shaie" created="Wed, 19 Feb 2014 05:02:32 -0700">&lt;p&gt;I committed NRTIndexRevision and matching test:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;NRTIndexRevision lists the files in the SIS obtained from IW.flushAndIncrement() and holds a byte[] in memory of that SIS (by &lt;tt&gt;SIS.write(DataOutput)&lt;/tt&gt;).&lt;/li&gt;
	&lt;li&gt;The segments_N is listed as segments_nrt_N, where N is SIS.getVersion() and in fact this file isn't materialized on any Directory, it's just listed so replica can request it.&lt;/li&gt;
	&lt;li&gt;There's a nocommit about how to handle commits, i.e. if you: addDoc(), commit(), addDoc(), publish(new NRTRev()), SIS.listFiles() contains segments_N as well
	&lt;ul&gt;
		&lt;li&gt;On one hand I think it's good to list that file as well, so that replica can replicate it and if it crashes, it can recover to the last known commit&lt;/li&gt;
		&lt;li&gt;It also simplifies how the app should integrate its NRT and commit() w/ replicator&lt;/li&gt;
		&lt;li&gt;But if we choose to pass that file as well, we should take care of it on the replica side, by e.g. sync'ing it (which we don't do for the in-memory SIS).&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I think it will be good if the framework allows the app to publish IndexRevision (commits) and NRTIndexRevision (NRT) seamlessly, so app can choose what to replicate. That way NRTIndexRevision doesn't need to know about SnapshotDeletionPolicy and its code path remains simple (IW.flushAndIncRef + IW.decRefDeleter). Once I add support on the replica side, I'll write a test which demonstrates how to mix commits/nrt w/ one replicator.&lt;/p&gt;</comment>
                            <comment id="13914721" author="jira-bot" created="Thu, 27 Feb 2014 09:49:12 -0700">&lt;p&gt;Commit 1572653 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mikemccand" class="user-hover" rel="mikemccand"&gt;Michael McCandless&lt;/a&gt; in branch 'dev/branches/lucene5438'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1572653" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1572653&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-5438" title="add near-real-time replication" class="issue-link" data-issue-key="LUCENE-5438"&gt;&lt;del&gt;LUCENE-5438&lt;/del&gt;&lt;/a&gt;: commit current &lt;span class="error"&gt;&amp;#91;broken&amp;#93;&lt;/span&gt; state&lt;/p&gt;</comment>
                            <comment id="13914724" author="mikemccand" created="Thu, 27 Feb 2014 09:52:12 -0700">&lt;p&gt;I've committed my current &lt;span class="error"&gt;&amp;#91;broken&amp;#93;&lt;/span&gt; state here, but I'm gonna moth ball this for now.&lt;/p&gt;

&lt;p&gt;I had made the test case more evil, by adding randomly shutting down a master and moving it to another node (promoting a replica to master).  It turns out this is very hard to do properly, because in this case, file names can be re-used (Lucene is no longer write-once) and detecting that is tricky, unless we can rely on some external global reliable storage (e.g. something stored in Zookeeper maybe) to record the last segments gen / segment name that was written on any node ...&lt;/p&gt;</comment>
                            <comment id="13944463" author="jira-bot" created="Sun, 23 Mar 2014 09:22:26 -0700">&lt;p&gt;Commit 1580522 from &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mikemccand" class="user-hover" rel="mikemccand"&gt;Michael McCandless&lt;/a&gt; in branch 'dev/branches/lucene5438'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1580522" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1580522&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-5438" title="add near-real-time replication" class="issue-link" data-issue-key="LUCENE-5438"&gt;&lt;del&gt;LUCENE-5438&lt;/del&gt;&lt;/a&gt;: test seems to pass now, even when master is migrated to an 'old' replica&lt;/p&gt;</comment>
                            <comment id="13962764" author="jira-bot" created="Tue, 8 Apr 2014 03:43:03 -0700">&lt;p&gt;Commit 1585682 from mikemccand@apache.org in branch 'dev/branches/lucene5438'&lt;br/&gt;
[ &lt;a href="https://svn.apache.org/r1585682" class="external-link" rel="nofollow"&gt;https://svn.apache.org/r1585682&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href="https://issues.apache.org/jira/browse/LUCENE-5438" title="add near-real-time replication" class="issue-link" data-issue-key="LUCENE-5438"&gt;&lt;del&gt;LUCENE-5438&lt;/del&gt;&lt;/a&gt;: checkpoint current &lt;span class="error"&gt;&amp;#91;broken&amp;#93;&lt;/span&gt; state&lt;/p&gt;</comment>
                            <comment id="14342981" author="mikemccand" created="Mon, 2 Mar 2015 02:42:56 -0700">&lt;p&gt;Here's a new patch based on trunk: recent progress with IDs and&lt;br/&gt;
checksums made things much easier here because now I can reliably&lt;br/&gt;
identify files across nodes.&lt;/p&gt;

&lt;p&gt;This is still just a proof-of-concept test case and still has many&lt;br/&gt;
nocommits, but I believe the core idea is finally working.&lt;/p&gt;

&lt;p&gt;The test randomly starts N nodes, each with its own filesystem&lt;br/&gt;
directory.  One node is primary, and the rest replicas. An indexing&lt;br/&gt;
thread adds docs to the primary, and periodically a new NRT point is&lt;br/&gt;
flushed and replicated out.&lt;/p&gt;

&lt;p&gt;The test is quite evil: most of MDW's checks are left enabled.&lt;br/&gt;
E.g. virus checker sometimes prevents deletion of files, unref'd files&lt;br/&gt;
at close are caught, double-write to same filename is caught (except&lt;br/&gt;
after crash).  It uses RIW.  The replicas have random rate limiters so&lt;br/&gt;
some nodes are fast to copy and others are slow.  Replicas are&lt;br/&gt;
randomly crashed or gracefully closed, and restarted.  Primary is&lt;br/&gt;
randomly crashed/closed and a replica is promoted as new primary.&lt;/p&gt;

&lt;p&gt;A file is considered the "same" across primary and replica if its file&lt;br/&gt;
name is the same, its full byte[] index header and footer are&lt;br/&gt;
identical, and it's in a "known to be fsync'd" state (e.g. not an&lt;br/&gt;
unref'd file on init of replica/primary).&lt;/p&gt;

&lt;p&gt;A searching thread asserts that each searcher version always has the&lt;br/&gt;
same hit count across all nodes, and that there is no data loss.&lt;/p&gt;

&lt;p&gt;I also added a simplistic/restricted transaction log (sits logically&lt;br/&gt;
outside of/above the cluster, not per-node) to show how NRT points can&lt;br/&gt;
be correlated back to locations in the xlog and used to replay&lt;br/&gt;
indexing events on primary crash so no indexed documents are lost.&lt;/p&gt;

&lt;p&gt;Versions are consistent across replicas, so at any time if you have a&lt;br/&gt;
follow-on search needing a specific searcher version, you can use any&lt;br/&gt;
replica that has that version and it's guaranteed to be searching the&lt;br/&gt;
same point-in-time.&lt;/p&gt;

&lt;p&gt;I would love to get this into Jenkins soon, but one big problem here&lt;br/&gt;
is I had to open up all sorts of ridiculous APIs in IW/SegmentInfos&lt;br/&gt;
... I have to think about how to minimize this.&lt;/p&gt;</comment>
                            <comment id="15138704" author="mikemccand" created="Tue, 9 Feb 2016 03:06:57 -0700">&lt;p&gt;I got back to this issue and have been pushing changes here:&lt;/p&gt;

&lt;p&gt;  &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;a=shortlog;h=refs/heads/jira/lucene-5438-nrt-replication" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;a=shortlog;h=refs/heads/jira/lucene-5438-nrt-replication&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Net/net I think it's in pretty good shape ... I'd like to add this for&lt;br/&gt;
6.0 as an experimental feature, as an alternative to document based&lt;br/&gt;
replication.&lt;/p&gt;

&lt;p&gt;I think there are complex tradeoffs between the two approaches to&lt;br/&gt;
distributing Lucene, but I think it's important users at least have&lt;br/&gt;
a choice.&lt;/p&gt;

&lt;p&gt;With this change, multiple nodes (primary and replicas) have&lt;br/&gt;
essentially the same transactional semantics that a single Lucene&lt;br/&gt;
IndexWriter + NRT readers offers.  You have known point-in-time views&lt;br/&gt;
that are the consistent (long version) across nodes, you can commit&lt;br/&gt;
any node (primary or replica), rollback etc.  When things crash, on&lt;br/&gt;
restart they are back to the last commit, etc.&lt;/p&gt;

&lt;p&gt;The test cases are quite evil: they spawn sub-process JVMs, and&lt;br/&gt;
communicate over a naive (thread-per-connection) TCP protocol to copy&lt;br/&gt;
files, index documents, search, etc.  And they randomly crash (thank&lt;br/&gt;
you &lt;tt&gt;TestIndexWriterOnJRECrash&lt;/tt&gt;!), commit, close, flip bits during&lt;br/&gt;
file copy, simulate slow networks, etc.&lt;/p&gt;

&lt;p&gt;I'll make an applyable patch from the current branch and post here.&lt;/p&gt;</comment>
                            <comment id="15139115" author="mikemccand" created="Tue, 9 Feb 2016 09:06:51 -0700">&lt;p&gt;Here's the latest applyable patch from the branch.  Tests patch but&lt;br/&gt;
not yet precommit... I'll work on it.&lt;/p&gt;

&lt;p&gt;I tried to keep the core changes to a minimum (simplified vs previous&lt;br/&gt;
iterations), but there were some additions that NRT replication needs,&lt;br/&gt;
like asking IW to write deletes to disk on opening the NRT reader.&lt;br/&gt;
The changes to SegmentInfos.java are not as scary as they look (just&lt;br/&gt;
factoring out methods to read/write from &lt;tt&gt;IndexInput/Output&lt;/tt&gt; too).&lt;/p&gt;

&lt;p&gt;I've marked the new APIs experimental or internal, and put all&lt;br/&gt;
the new classes under o.a.l.replication.nrt.&lt;/p&gt;

&lt;p&gt;The important classes are &lt;tt&gt;PrimaryNode&lt;/tt&gt; (you create this on the JVM&lt;br/&gt;
that will index documents) and &lt;tt&gt;ReplicaNode&lt;/tt&gt; (you create that on&lt;br/&gt;
other JVMs to receive newly flushed files).  They are both abstract:&lt;br/&gt;
you must subclass and implement methods that actually do the work of&lt;br/&gt;
moving files, etc.  The tests do this using a simple TCP socket&lt;br/&gt;
server.&lt;/p&gt;

&lt;p&gt;Both &lt;tt&gt;PrimaryNode&lt;/tt&gt; and &lt;tt&gt;ReplicaNode&lt;/tt&gt; expose a &lt;tt&gt;SearcherManager&lt;/tt&gt;,&lt;br/&gt;
which you use for searching.  They both have &lt;tt&gt;commit&lt;/tt&gt; methods.&lt;/p&gt;

&lt;p&gt;The primary node uses a merged segment warmer that pre-copies merged&lt;br/&gt;
files before letting the local IW cutover.  This way NRT latency isn't&lt;br/&gt;
blocked by copying merged files out (normally).  An alternative to&lt;br/&gt;
this would be to have the replicas do their own merging, but I think&lt;br/&gt;
that gets quite complex.&lt;/p&gt;</comment>
                            <comment id="15143103" author="mikemccand" created="Thu, 11 Feb 2016 10:26:26 -0700">&lt;p&gt;Hmm, I failed to insert &lt;a href="https://issues.apache.org/jira/browse/LUCENE-5438" title="add near-real-time replication" class="issue-link" data-issue-key="LUCENE-5438"&gt;&lt;del&gt;LUCENE-5438&lt;/del&gt;&lt;/a&gt; into the merge commit.&lt;/p&gt;

&lt;p&gt;Here's the commit: &lt;a href="https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;a=commit;h=12b8721a44dbd1fbc7878fa37186c16cf6045401" class="external-link" rel="nofollow"&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;a=commit;h=12b8721a44dbd1fbc7878fa37186c16cf6045401&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12787086" name="LUCENE-5438.patch" size="352467" author="mikemccand" created="Tue, 9 Feb 2016 09:06:51 -0700"/>
                            <attachment id="12701838" name="LUCENE-5438.patch" size="177607" author="mikemccand" created="Mon, 2 Mar 2015 02:42:56 -0700"/>
                            <attachment id="12628008" name="LUCENE-5438.patch" size="46704" author="mikemccand" created="Mon, 10 Feb 2014 10:32:29 -0700"/>
                            <attachment id="12627611" name="LUCENE-5438.patch" size="30113" author="mikemccand" created="Fri, 7 Feb 2014 05:49:39 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 7 Feb 2014 15:49:18 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>372384</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1s6c7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>372688</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>