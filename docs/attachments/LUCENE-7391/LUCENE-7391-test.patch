From c83cf3418adf4db07cc228a5b1a5d7575171567f Mon Sep 17 00:00:00 2001
From: Steve Mason <stevem@brandwatch.com>
Date: Fri, 22 Jul 2016 15:58:24 +0100
Subject: [PATCH 1/2] LUCENE-7391 Added unit test for MemoryIndex to ensure it
 only returns indexed fields

---
 .../org/apache/lucene/index/memory/TestMemoryIndex.java     | 13 +++++++++++++
 1 file changed, 13 insertions(+)

diff --git a/lucene/memory/src/test/org/apache/lucene/index/memory/TestMemoryIndex.java b/lucene/memory/src/test/org/apache/lucene/index/memory/TestMemoryIndex.java
index 1010c13..ee7b789 100644
--- a/lucene/memory/src/test/org/apache/lucene/index/memory/TestMemoryIndex.java
+++ b/lucene/memory/src/test/org/apache/lucene/index/memory/TestMemoryIndex.java
@@ -48,6 +48,7 @@ import org.apache.lucene.document.TextField;
 import org.apache.lucene.index.BinaryDocValues;
 import org.apache.lucene.index.DocValuesType;
 import org.apache.lucene.index.FieldInvertState;
+import org.apache.lucene.index.IndexReader;
 import org.apache.lucene.index.IndexableField;
 import org.apache.lucene.index.LeafReader;
 import org.apache.lucene.index.NumericDocValues;
@@ -135,6 +136,18 @@ public class TestMemoryIndex extends LuceneTestCase {
     assertEquals("be", terms.term().utf8ToString());
     TestUtil.checkReader(reader);
   }
+
+  public void testFieldsOnlyReturnsIndexedFields() throws IOException {
+    Document doc = new Document();
+
+    doc.add(new NumericDocValuesField("numeric", 29L));
+
+    MemoryIndex mi = MemoryIndex.fromDocument(doc, analyzer);
+    IndexSearcher searcher = mi.createSearcher();
+    IndexReader reader = searcher.getIndexReader();
+
+    assertEquals(reader.getTermVectors(0).size(), 0);
+  }
   
   public void testReaderConsistency() throws IOException {
     Analyzer analyzer = new MockPayloadAnalyzer();
-- 
2.9.0

