From 4b31867933e210dc99990d85116ff6b0cb5db866 Mon Sep 17 00:00:00 2001
From: Mike Drob <mdrob@cloudera.com>
Date: Fri, 24 Feb 2017 10:29:17 -0600
Subject: [PATCH] LUCENE-7710

---
 lucene/CHANGES.txt                                                    | 4 ++++
 .../src/java/org/apache/lucene/util/packed/BlockPackedReader.java     | 3 ++-
 2 files changed, 6 insertions(+), 1 deletion(-)

diff --git a/lucene/CHANGES.txt b/lucene/CHANGES.txt
index 741418a..91e9c68 100644
--- a/lucene/CHANGES.txt
+++ b/lucene/CHANGES.txt
@@ -237,6 +237,10 @@ Bug Fixes
 * LUCENE-7676: Fixed FilterCodecReader to override more super-class methods.
   Also added TestFilterCodecReader class. (Christine Poerschke)
 
+* LUCENE-7710: BlockPackedReader throws CorruptIndexException and includes
+  IndexInput description instead of plain IOException (Mike Drob via
+  Mike McCandless)
+
 ======================= Lucene 6.4.1 =======================
 
 Build
diff --git a/lucene/core/src/java/org/apache/lucene/util/packed/BlockPackedReader.java b/lucene/core/src/java/org/apache/lucene/util/packed/BlockPackedReader.java
index 82bf93f..986cba7 100644
--- a/lucene/core/src/java/org/apache/lucene/util/packed/BlockPackedReader.java
+++ b/lucene/core/src/java/org/apache/lucene/util/packed/BlockPackedReader.java
@@ -28,6 +28,7 @@ import static org.apache.lucene.util.packed.PackedInts.numBlocks;
 
 import java.io.IOException;
 
+import org.apache.lucene.index.CorruptIndexException;
 import org.apache.lucene.store.IndexInput;
 import org.apache.lucene.util.Accountable;
 import org.apache.lucene.util.LongValues;
@@ -58,7 +59,7 @@ public final class BlockPackedReader extends LongValues implements Accountable {
       final int bitsPerValue = token >>> BPV_SHIFT;
       sumBPV += bitsPerValue;
       if (bitsPerValue > 64) {
-        throw new IOException("Corrupted");
+        throw new CorruptIndexException("Corrupted Block#" + i, in);
       }
       if ((token & MIN_VALUE_EQUALS_0) == 0) {
         if (minValues == null) {
-- 
1.9.1

