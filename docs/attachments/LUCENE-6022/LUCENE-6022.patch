Index: lucene/CHANGES.txt
===================================================================
--- lucene/CHANGES.txt	(revision 1633839)
+++ lucene/CHANGES.txt	(working copy)
@@ -243,6 +243,9 @@
 * LUCENE-5983: CachingWrapperFilter now uses a new DocIdSet implementation
   called RoaringDocIdSet instead of WAH8DocIdSet. (Adrien Grand)
 
+* LUCENE-6022: DocValuesDocIdSet checks live docs before doc values.
+  (Adrien Grand)
+
 Build
 
 * LUCENE-5909: Smoke tester now has better command line parsing and
Index: lucene/core/src/java/org/apache/lucene/search/DocValuesDocIdSet.java
===================================================================
--- lucene/core/src/java/org/apache/lucene/search/DocValuesDocIdSet.java	(revision 1633839)
+++ lucene/core/src/java/org/apache/lucene/search/DocValuesDocIdSet.java	(working copy)
@@ -27,8 +27,7 @@
  * of its iterator is very stupid and slow if the implementation of the
  * {@link #matchDoc} method is not optimized, as iterators simply increment
  * the document id until {@code matchDoc(int)} returns true. Because of this
- * {@code matchDoc(int)} must be as fast as possible and in no case do any
- * I/O.
+ * {@code matchDoc(int)} must be as fast as possible.
  * @lucene.internal
  */
 public abstract class DocValuesDocIdSet extends DocIdSet {
@@ -66,7 +65,7 @@
     } : new Bits() {
       @Override
       public boolean get(int docid) {
-        return matchDoc(docid) && acceptDocs.get(docid);
+        return acceptDocs.get(docid) && matchDoc(docid);
       }
 
       @Override
@@ -135,19 +134,13 @@
       
         @Override
         public int nextDoc() {
-          do {
-            doc++;
-            if (doc >= maxDoc) {
-              return doc = NO_MORE_DOCS;
-            }
-          } while (!(matchDoc(doc) && acceptDocs.get(doc)));
-          return doc;
+          return advance(doc + 1);
         }
       
         @Override
         public int advance(int target) {
           for(doc=target; doc<maxDoc; doc++) {
-            if (matchDoc(doc) && acceptDocs.get(doc)) {
+            if (acceptDocs.get(doc) && matchDoc(doc)) {
               return doc;
             }
           }
