commit 43bb4e1409d3877d0f94c2caed490f5ee9cdefc2
Author: Julie Tibshirani <julie.tibshirani@elastic.co>
Date:   Wed May 2 12:12:59 2018 -0700

    LUCENE-8287 Disallow empty regex completion queries.

diff --git a/lucene/suggest/src/java/org/apache/lucene/search/suggest/document/RegexCompletionQuery.java b/lucene/suggest/src/java/org/apache/lucene/search/suggest/document/RegexCompletionQuery.java
index b53ac34bef..0999b89301 100644
--- a/lucene/suggest/src/java/org/apache/lucene/search/suggest/document/RegexCompletionQuery.java
+++ b/lucene/suggest/src/java/org/apache/lucene/search/suggest/document/RegexCompletionQuery.java
@@ -84,6 +84,11 @@ public class RegexCompletionQuery extends CompletionQuery {
    */
   public RegexCompletionQuery(Term term, int flags, int maxDeterminizedStates, BitsProducer filter) {
     super(term, filter);
+
+    if (term.text().isEmpty()) {
+      throw new IllegalArgumentException("The term text cannot be empty.");
+    }
+
     this.flags = flags;
     this.maxDeterminizedStates = maxDeterminizedStates;
   }
diff --git a/lucene/suggest/src/test/org/apache/lucene/search/suggest/document/TestRegexCompletionQuery.java b/lucene/suggest/src/test/org/apache/lucene/search/suggest/document/TestRegexCompletionQuery.java
index 2dd718407f..8f43d346c4 100644
--- a/lucene/suggest/src/test/org/apache/lucene/search/suggest/document/TestRegexCompletionQuery.java
+++ b/lucene/suggest/src/test/org/apache/lucene/search/suggest/document/TestRegexCompletionQuery.java
@@ -24,6 +24,7 @@ import org.apache.lucene.index.RandomIndexWriter;
 import org.apache.lucene.index.Term;
 import org.apache.lucene.store.Directory;
 import org.apache.lucene.util.LuceneTestCase;
+import org.apache.lucene.util.automaton.RegExp;
 import org.junit.After;
 import org.junit.Before;
 import org.junit.Test;
@@ -147,4 +148,16 @@ public class TestRegexCompletionQuery extends LuceneTestCase {
     reader.close();
     iw.close();
   }
+
+  @Test
+  public void testEmptyRegexQuery() {
+    Term term = new Term("field", "");
+
+    expectThrows(IllegalArgumentException.class,
+        () -> new RegexCompletionQuery(term));
+    expectThrows(IllegalArgumentException.class,
+        () -> new RegexCompletionQuery(term, null));
+    expectThrows(IllegalArgumentException.class,
+        () -> new RegexCompletionQuery(term, RegExp.NONE, 1000, null));
+  }
 }
