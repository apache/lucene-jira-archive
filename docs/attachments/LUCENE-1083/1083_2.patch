Index: common-build.xml
===================================================================
--- common-build.xml	(revision 604058)
+++ common-build.xml	(working copy)
@@ -78,6 +78,24 @@
 
   <property name="manifest.file" location="${common.dir}/build/MANIFEST.MF"/>
 	
+  <property name="jdiff.prev.major.version" value="2"/>
+  <property name="jdiff.prev.minor.version" value="2"/>
+  <property name="jdiff.prev.patch.version" value="0"/>
+  <property name="jdiff.prev.version" value="${jdiff.prev.major.version}.${jdiff.prev.minor.version}.${jdiff.prev.patch.version}"/>
+  <property name="jdiff.prev.version.underscores" value="${jdiff.prev.major.version}_${jdiff.prev.minor.version}_${jdiff.prev.patch.version}"/>
+
+  <!-- The location of the source of the previous version -->
+  <property name="jdiff.prev.dir" value="${build.dir}/jdiff/prev_${jdiff.prev.version}"/>
+  <!-- The URL of the source of the previous version -->
+  <property name="jdiff.prev.url.base" value="http://svn.apache.org/repos/asf/lucene/java/tags/lucene_"/>
+  <!-- The URL for checking out the source of the previous version -->
+  <property name="jdiff.prev.url" value="${jdiff.prev.url.base}${jdiff.prev.version.underscores}"/>
+  <property name="jdiff.prev.api.url.base" value="http://lucene.apache.org/java/"/>
+  <!-- The URL of the Javadocs of the previous version -->
+  <property name="jdiff.prev.api.url" value="${jdiff.prev.api.url.base}${jdiff.prev.version.underscores}/api/"/>
+  <!-- Used internally by the JDiff tool -->
+  <property name="JDIFF_HOME" value="${jdiff.home}" />
+
   <condition property="build-1-5-contrib">
      <equals arg1="1.5" arg2="${ant.java.version}" />
   </condition>
@@ -119,6 +137,12 @@
     classname="org.apache.maven.artifact.ant.Pom"
   />
 	
+   <available
+    property="jdiff.present"
+    classname="jdiff.JDiff"
+    classpath="${jdiff.home}/jdiff.jar"
+    />
+
   <target name="clean"
     description="Removes contents of build and dist directories">
     <delete dir="${build.dir}"/>
@@ -210,6 +234,22 @@
     </fail>
   </target>
 
+  <target name="jdiff-check" unless="jdiff.present">
+    <echo>
+      ##################################################################
+      JDiff not found.
+      JDiff Home: ${jdiff.home}
+
+      Please download and install JDiff from:
+
+      &lt;http://jdiff.org&gt;
+      
+      and then run Ant with: -Djdiff.home=/path/to/jdiff-x.y.z
+
+      ##################################################################
+    </echo>
+  </target>
+
   <target name="compile-core" depends="init, clover"
           description="Compiles core classes">
     <compile
Index: build.xml
===================================================================
--- build.xml	(revision 604058)
+++ build.xml	(working copy)
@@ -287,7 +287,95 @@
   	</sequential>
   </target>
 
+    <target name="jdiff-svn" description="Check out the source of the previous version if it doesn't already exist" if="jdiff.present">
+      <condition property="jdiff.already.checkedout">
+        <available file="${jdiff.prev.dir}" type="dir"/>
+      </condition>
+      <antcall target="jdiff-svn-co"/>
+    </target>
 
+    <target name="jdiff-svn-update" description="Update a directory that may, or may not, be an svn working copy" 
+            if="jdiff.already.checkedout">
+      <exec executable="svn" failonerror="false">
+        <arg line="update ${jdiff.prev.dir}"/>
+      </exec>
+    </target>
+
+    <target name="jdiff-svn-co" description="Check out a directory from svn" 
+            unless="jdiff.already.checkedout">
+      <exec executable="svn" failonerror="true">
+        <arg line="co ${jdiff.prev.url} ${jdiff.prev.dir}"/>
+      </exec>
+    </target>
+
+   <target name="jdiff-core" depends="jdiff-check, jdiff-svn" if="jdiff.present"
+           description="Generate jdiff report for core classes" >
+      <sequential>
+
+      <property name="target.name" value="jdiff-core" />
+      <property name="jdiff.area.name" value="core" />
+      <property name="jdiff.reportdir" value="${javadoc.dir}/${target.name}" />
+      <property name="jdiff.xmldir" value="${build.dir}/jdiff/${target.name}" />
+      <mkdir dir="${jdiff.reportdir}"/>
+      <mkdir dir="${jdiff.xmldir}"/>
+
+      <echo message="Generate the XML representation of the ${jdiff.prev.version} ${jdiff.area.name} API" />
+      <javadoc access="${javadoc.access}"
+               encoding="${build.encoding}">
+          <doclet name="jdiff.JDiff"
+                  path="${jdiff.home}/jdiff.jar:${jdiff.home}/xerces.jar">
+            <param name="-apidir" value="${jdiff.xmldir}" />
+            <param name="-excludeclass" value="${javadoc.access}" />
+            <param name="-excludemember" value="${javadoc.access}" />
+            <param name="-apiname" value="${Name} ${jdiff.prev.version} ${jdiff.area.name} API" />
+          </doclet>
+        <packageset dir="${jdiff.prev.dir}/src/java"/>
+        <classpath refid="javadoc.classpath"/>
+      </javadoc>
+
+      <echo message="Generate the XML representation of the ${version} ${jdiff.area.name} API" />
+      <javadoc access="${javadoc.access}"
+               encoding="${build.encoding}">
+          <doclet name="jdiff.JDiff"
+                  path="${jdiff.home}/jdiff.jar:${jdiff.home}/xerces.jar">
+            <param name="-apidir" value="${jdiff.xmldir}" />
+            <param name="-excludeclass" value="${javadoc.access}" />
+            <param name="-excludemember" value="${javadoc.access}" />
+            <param name="-apiname" value="${Name} ${version} ${jdiff.area.name} API" />
+          </doclet>
+        <packageset dir="src/java"/>
+        <classpath refid="javadoc.classpath"/>
+      </javadoc>
+
+      <echo message="Generate the JDiff report comparing the ${jdiff.prev.version} and ${version} APIs" />
+      <javadoc
+          private="yes"
+          sourcepath="src/java"
+          destdir="${jdiff.reportdir}"
+          sourcefiles="${jdiff.home}/Null.java">
+          <doclet name="jdiff.JDiff"
+                  path="${jdiff.home}/jdiff.jar:${jdiff.home}/xerces.jar">
+            <param name="-oldapi" value="${Name} ${jdiff.prev.version} ${jdiff.area.name} API" />
+            <param name="-newapi" value="${Name} ${version} ${jdiff.area.name} API" />
+            <param name="-oldapidir" value="${jdiff.xmldir}" />
+            <param name="-newapidir" value="${jdiff.xmldir}" />
+            <param name="-javadocnew" value="../../${jdiff.area.name}/" />
+            <param name="-javadocold" value="${jdiff.prev.api.url}" /> 
+            <param name="-docchanges"/>
+            <param name="-stats"/>
+          </doclet>
+        <classpath refid="javadoc.classpath"/>
+      </javadoc>
+
+    <!-- Copy image files. black.gif is only needed if -stats was used -->
+    <copy file="${jdiff.home}/background.gif" todir="${jdiff.reportdir}" />
+    <copy file="${jdiff.home}/black.gif" todir="${jdiff.reportdir}" />
+
+    <delete dir="${jdiff.xmldir}" failonerror="false"/>
+
+    </sequential>
+  </target>
+
   <!-- ================================================================== -->
   <!-- D I S T R I B U T I O N                                            -->
   <!-- ================================================================== -->
