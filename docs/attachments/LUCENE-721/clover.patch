Index: common-build.xml
===================================================================
--- common-build.xml	(revision 478711)
+++ common-build.xml	(working copy)
@@ -45,7 +45,16 @@
   <property name="junit.includes" value="**/Test*.java,**/*Test.java"/>
   <property name="junit.excludes" value=""/>
 
+  <property name="clover.db.dir" location="${build.dir}/test/clover/db"/>
+  <property name="clover.report.dir" location="${build.dir}/test/clover/reports"/>
+  	
   <available
+    property="clover.present"
+    classname="com.cenqua.clover.tasks.CloverReportTask"
+    />
+
+	
+  <available
     property="javacc.present"
     classname="org.javacc.parser.Main"
     classpath="${javacc.home}/bin/lib/javacc.jar"
@@ -112,7 +121,7 @@
   </target>
 
 
-  <target name="compile-core" depends="init"
+  <target name="compile-core" depends="init, clover"
           description="Compiles core classes">
     <compile
       srcdir="src/java"
@@ -190,6 +199,41 @@
     <fail if="tests.failed">Tests failed!</fail>
   </target>
 
+  <target name="clover" depends="clover.setup, clover.info"/>
+
+  <target name="clover.setup" if="clover.present">	
+    <taskdef resource="clovertasks"/>
+    <mkdir dir="${clover.db.dir}"/>
+    <clover-setup initString="${clover.db.dir}/lucene_coverage.db">
+      <fileset dir="src/java"/>
+    </clover-setup>
+  </target>
+	
+  <target name="clover.info" unless="clover.present">
+  	<echo>
+      Clover not found. Code coverage reports disabled.
+  	</echo>
+  </target>  	
+
+  <target name="clover.check">
+	<fail unless="clover.present">
+	  ##################################################################
+      Clover not found.
+      Please make sure clover.jar is in ANT_HOME/lib, or made available 
+      to Ant using other mechanisms like -lib or CLASSPATH.
+      ##################################################################
+  	</fail>
+  </target>  	
+	
+  <target name="generate-clover-reports" depends="clover.check, clover">
+    <mkdir dir="${clover.report.dir}"/>
+    <clover-report>
+       <current outfile="${clover.report.dir}" title="${final.name}">
+          <format type="html"/>
+       </current>
+    </clover-report>
+  </target>
+
   <target name="generate-test-reports" description="Generates test reports">
     <mkdir dir="${junit.reports}"/>
     <junitreport todir="${junit.output.dir}">
