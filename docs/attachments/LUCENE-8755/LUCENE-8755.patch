Index: solr/core/src/test/org/apache/solr/search/TestSolr4Spatial2.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- solr/core/src/test/org/apache/solr/search/TestSolr4Spatial2.java	(revision 9707bb6fa91ea3062a404690aa7d041771f22746)
+++ solr/core/src/test/org/apache/solr/search/TestSolr4Spatial2.java	(date 1555493182000)
@@ -60,6 +60,11 @@
     RetrievalCombo.idCounter = 0;
   }
 
+  @Test
+  public void testBug() {
+    assertU(adoc("id", "0", "oslocation", "244502.06 639062.07"));
+  }
+
   @Test
   public void testBBox() throws Exception {
     String fieldName = random().nextBoolean() ? "bbox" : "bboxD_dynamic";
Index: lucene/spatial-extras/src/java/org/apache/lucene/spatial/prefix/tree/QuadPrefixTree.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- lucene/spatial-extras/src/java/org/apache/lucene/spatial/prefix/tree/QuadPrefixTree.java	(revision 9707bb6fa91ea3062a404690aa7d041771f22746)
+++ lucene/spatial-extras/src/java/org/apache/lucene/spatial/prefix/tree/QuadPrefixTree.java	(date 1555496380000)
@@ -165,10 +165,12 @@
 
     // Z-Order
     // http://en.wikipedia.org/wiki/Z-order_%28curve%29
-    checkBattenberg('A', x - w, y + h, level, matches, str, shape, maxLevel);
-    checkBattenberg('B', x + w, y + h, level, matches, str, shape, maxLevel);
-    checkBattenberg('C', x - w, y - h, level, matches, str, shape, maxLevel);
-    checkBattenberg('D', x + w, y - h, level, matches, str, shape, maxLevel);
+    boolean found = false;
+    found |= checkBattenberg('A', x - w, y + h, level, matches, str, shape, maxLevel);
+    found |= checkBattenberg('B', x + w, y + h, level, matches, str, shape, maxLevel);
+    found |= checkBattenberg('C', x - w, y - h, level, matches, str, shape, maxLevel);
+    found |= checkBattenberg('D', x + w, y - h, level, matches, str, shape, maxLevel);
+    assert found;
 
     // possibly consider hilbert curve
     // http://en.wikipedia.org/wiki/Hilbert_curve
@@ -176,7 +178,7 @@
     // if we actually use the range property in the query, this could be useful
   }
 
-  protected void checkBattenberg(
+  protected boolean checkBattenberg(
       char c,
       double cx,
       double cy,
@@ -185,6 +187,7 @@
       BytesRef str,
       Shape shape,
       int maxLevel) {
+    int initialMatchesSize = matches.size();
     assert str.length == level;
     assert str.offset == 0;
     double w = levelW[level] / 2;
@@ -211,6 +214,7 @@
       }
     }
     str.length = strlen;
+    return initialMatchesSize < matches.size();
   }
 
   protected class QuadCell extends LegacyCell {
Index: solr/core/src/test-files/solr/collection1/conf/schema-spatial.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- solr/core/src/test-files/solr/collection1/conf/schema-spatial.xml	(revision 9707bb6fa91ea3062a404690aa7d041771f22746)
+++ solr/core/src/test-files/solr/collection1/conf/schema-spatial.xml	(date 1555493012000)
@@ -70,8 +70,12 @@
 
   <fieldType name="llp" class="solr.LatLonPointSpatialField" distanceUnits="degrees" multiValued="true" />
 
+  <fieldType name="oslocation" class="solr.SpatialRecursivePrefixTreeFieldType" geo="false" maxDistErr="0.000009"
+             worldBounds="ENVELOPE(0,700000,1300000,0)" distErrPct="0.15"/>
+
   <field name="id" type="string" required="true"/>
 
+  <field name="oslocation" type="oslocation" />
   <field name="srpt_geohash" type="srpt_geohash" multiValued="true"/>
   <field name="srpt_quad" type="srpt_quad" multiValued="true"/>
   <field name="srpt_packedquad" type="srpt_packedquad" multiValued="true"/>
