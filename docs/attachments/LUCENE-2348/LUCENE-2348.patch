Index: lucene/contrib/queries/src/test/org/apache/lucene/search/DuplicateFilterTest.java
===================================================================
--- lucene/contrib/queries/src/test/org/apache/lucene/search/DuplicateFilterTest.java	(revision 1036589)
+++ lucene/contrib/queries/src/test/org/apache/lucene/search/DuplicateFilterTest.java	(working copy)
@@ -24,6 +24,7 @@
 import org.apache.lucene.document.Field;
 import org.apache.lucene.index.IndexReader;
 import org.apache.lucene.index.RandomIndexWriter;
+import org.apache.lucene.index.SlowMultiReaderWrapper;
 import org.apache.lucene.index.Term;
 import org.apache.lucene.index.DocsEnum;
 import org.apache.lucene.index.MultiFields;
@@ -54,13 +55,9 @@
 		addDoc(writer, "http://lucene.apache.org", "Lucene 2.0 out", "20050101");
 		addDoc(writer, "http://lucene.apache.org", "Oops. Lucene 2.1 out", "20050102");
 
-                // Until we fix LUCENE-2348, the index must
-                // have only 1 segment:
-                writer.optimize();
-
 		reader = writer.getReader();
 		writer.close();			
-		searcher =new IndexSearcher(reader);
+		searcher =new IndexSearcher(SlowMultiReaderWrapper.wrap(reader));
 		
 	}
 	
Index: lucene/contrib/queries/src/java/org/apache/lucene/search/DuplicateFilter.java
===================================================================
--- lucene/contrib/queries/src/java/org/apache/lucene/search/DuplicateFilter.java	(revision 1036589)
+++ lucene/contrib/queries/src/java/org/apache/lucene/search/DuplicateFilter.java	(working copy)
@@ -18,6 +18,7 @@
 import java.io.IOException;
 
 import org.apache.lucene.index.IndexReader;
+import org.apache.lucene.index.SlowMultiReaderWrapper; // javadoc
 import org.apache.lucene.util.BytesRef;
 import org.apache.lucene.index.Terms;
 import org.apache.lucene.index.DocsEnum;
@@ -26,6 +27,10 @@
 import org.apache.lucene.util.OpenBitSet;
 import org.apache.lucene.util.Bits;
 
+/**
+ * WARNING: For correct results, you must wrap your reader with 
+ * {@link SlowMultiReaderWrapper#wrap(IndexReader)}.
+ */
 public class DuplicateFilter extends Filter
 {
 	
