Index: solr/core/src/test/org/apache/solr/analysis/TestSynonymMap.java
===================================================================
--- solr/core/src/test/org/apache/solr/analysis/TestSynonymMap.java	(revision 1334951)
+++ solr/core/src/test/org/apache/solr/analysis/TestSynonymMap.java	(working copy)
@@ -25,6 +25,8 @@
 import java.util.Map;
 
 import org.apache.lucene.analysis.Token;
+import org.apache.lucene.analysis.util.InitializationException;
+import org.apache.lucene.analysis.util.TokenizerFactory;
 import org.apache.lucene.util.LuceneTestCase;
 import org.apache.lucene.analysis.util.ResourceLoader;
 
@@ -41,7 +43,7 @@
     rules.add( "a=>b=>c" );
     try{
         SlowSynonymFilterFactory.parseRules( rules, synMap, "=>", ",", true, null);
-        fail( "RuntimeException must be thrown." );
+        fail( "InitializationException must be thrown." );
     }
     catch(InitializationException expected) {}
   }
@@ -245,7 +247,7 @@
 	SlowSynonymMap synMap;
 	
 	// prepare bi-gram tokenizer factory
-	BaseTokenizerFactory tf = new NGramTokenizerFactory();
+	TokenizerFactory tf = new NGramTokenizerFactory();
 	Map<String, String> args = new HashMap<String, String>();
 	args.put("minGramSize","2");
 	args.put("maxGramSize","2");
Index: solr/core/src/test/org/apache/solr/analysis/TestTypeTokenFilterFactory.java
===================================================================
--- solr/core/src/test/org/apache/solr/analysis/TestTypeTokenFilterFactory.java	(revision 1334951)
+++ solr/core/src/test/org/apache/solr/analysis/TestTypeTokenFilterFactory.java	(working copy)
@@ -18,6 +18,7 @@
 
 
 import org.apache.lucene.analysis.NumericTokenStream;
+import org.apache.lucene.analysis.util.InitializationException;
 import org.apache.lucene.analysis.util.ResourceLoader;
 import org.apache.solr.core.SolrResourceLoader;
 import org.junit.Test;
Index: solr/core/src/test/org/apache/solr/analysis/TestMappingCharFilterFactory.java
===================================================================
--- solr/core/src/test/org/apache/solr/analysis/TestMappingCharFilterFactory.java	(revision 1334951)
+++ solr/core/src/test/org/apache/solr/analysis/TestMappingCharFilterFactory.java	(working copy)
@@ -17,6 +17,7 @@
 
 package org.apache.solr.analysis;
 
+import org.apache.lucene.analysis.util.InitializationException;
 import org.apache.lucene.util.LuceneTestCase;
 
 public class TestMappingCharFilterFactory extends LuceneTestCase {
Index: solr/core/src/test/org/apache/solr/analysis/TestLuceneMatchVersion.java
===================================================================
--- solr/core/src/test/org/apache/solr/analysis/TestLuceneMatchVersion.java	(revision 1334951)
+++ solr/core/src/test/org/apache/solr/analysis/TestLuceneMatchVersion.java	(working copy)
@@ -18,6 +18,7 @@
 
 import java.lang.reflect.Field;
 
+import org.apache.lucene.analysis.util.TokenizerFactory;
 import org.apache.solr.SolrTestCaseJ4;
 import org.apache.solr.core.Config;
 import org.apache.solr.schema.IndexSchema;
@@ -48,13 +49,13 @@
     
     FieldType type = schema.getFieldType("textDefault");
     TokenizerChain ana = (TokenizerChain) type.getAnalyzer();
-    assertEquals(DEFAULT_VERSION, ((BaseTokenizerFactory) ana.getTokenizerFactory()).luceneMatchVersion);
-    assertEquals(DEFAULT_VERSION, ((BaseTokenFilterFactory) ana.getTokenFilterFactories()[2]).luceneMatchVersion);
+    assertEquals(DEFAULT_VERSION, (ana.getTokenizerFactory()).getLuceneMatchVersion());
+    assertEquals(DEFAULT_VERSION, (ana.getTokenFilterFactories()[2]).getLuceneMatchVersion());
 
     type = schema.getFieldType("text30");
     ana = (TokenizerChain) type.getAnalyzer();
-    assertEquals(Version.LUCENE_30, ((BaseTokenizerFactory) ana.getTokenizerFactory()).luceneMatchVersion);
-    assertEquals(Version.LUCENE_31, ((BaseTokenFilterFactory) ana.getTokenFilterFactories()[2]).luceneMatchVersion);
+    assertEquals(Version.LUCENE_30, (ana.getTokenizerFactory()).getLuceneMatchVersion());
+    assertEquals(Version.LUCENE_31, (ana.getTokenFilterFactories()[2]).getLuceneMatchVersion());
 
     // this is a hack to get the private matchVersion field in StandardAnalyzer's superclass, may break in later lucene versions - we have no getter :(
     final Field matchVersionField = StandardAnalyzer.class.getSuperclass().getDeclaredField("matchVersion");
Index: solr/core/src/test/org/apache/solr/schema/MultiTermTest.java
===================================================================
--- solr/core/src/test/org/apache/solr/schema/MultiTermTest.java	(revision 1334951)
+++ solr/core/src/test/org/apache/solr/schema/MultiTermTest.java	(working copy)
@@ -18,6 +18,7 @@
  */
 
 import org.apache.lucene.analysis.Analyzer;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 import org.apache.solr.SolrTestCaseJ4;
 import org.apache.solr.analysis.*;
 import org.junit.BeforeClass;
Index: solr/core/src/java/org/apache/solr/analysis/PatternTokenizerFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/PatternTokenizerFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/PatternTokenizerFactory.java	(working copy)
@@ -24,6 +24,8 @@
 
 import org.apache.lucene.analysis.Tokenizer;
 import org.apache.lucene.analysis.pattern.PatternTokenizer;
+import org.apache.lucene.analysis.util.InitializationException;
+import org.apache.lucene.analysis.util.TokenizerFactory;
 
 
 /**
@@ -63,7 +65,7 @@
  * @since solr1.2
  *
  */
-public class PatternTokenizerFactory extends BaseTokenizerFactory 
+public class PatternTokenizerFactory extends TokenizerFactory
 {
   public static final String PATTERN = "pattern";
   public static final String GROUP = "group";
Index: solr/core/src/java/org/apache/solr/analysis/PortugueseMinimalStemFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/PortugueseMinimalStemFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/PortugueseMinimalStemFilterFactory.java	(working copy)
@@ -19,6 +19,7 @@
 
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.pt.PortugueseMinimalStemFilter;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 /** 
  * Factory for {@link PortugueseMinimalStemFilter}.
@@ -32,7 +33,7 @@
  * &lt;/fieldType&gt;</pre>
  *
  */
-public class PortugueseMinimalStemFilterFactory extends BaseTokenFilterFactory {
+public class PortugueseMinimalStemFilterFactory extends TokenFilterFactory {
   public TokenStream create(TokenStream input) {
     return new PortugueseMinimalStemFilter(input);
   }
Index: solr/core/src/java/org/apache/solr/analysis/ChineseTokenizerFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/ChineseTokenizerFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/ChineseTokenizerFactory.java	(working copy)
@@ -23,6 +23,7 @@
 import java.util.Map;
 
 import org.apache.lucene.analysis.cn.ChineseTokenizer;
+import org.apache.lucene.analysis.util.TokenizerFactory;
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
 
@@ -31,7 +32,7 @@
  * @deprecated Use {@link StandardTokenizerFactory} instead.
  */
 @Deprecated
-public class ChineseTokenizerFactory extends BaseTokenizerFactory {
+public class ChineseTokenizerFactory extends TokenizerFactory {
 
   private static final Logger log = LoggerFactory.getLogger(ChineseTokenizerFactory.class);
 
Index: solr/core/src/java/org/apache/solr/analysis/JapaneseBaseFormFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/JapaneseBaseFormFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/JapaneseBaseFormFilterFactory.java	(working copy)
@@ -19,6 +19,7 @@
 
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.ja.JapaneseBaseFormFilter;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 /**
  * Factory for {@link org.apache.lucene.analysis.ja.JapaneseBaseFormFilter}.
@@ -31,7 +32,7 @@
  * &lt;/fieldType&gt;
  * </pre>
  */
-public class JapaneseBaseFormFilterFactory extends BaseTokenFilterFactory {
+public class JapaneseBaseFormFilterFactory extends TokenFilterFactory {
 
   @Override
   public TokenStream create(TokenStream input) {
Index: solr/core/src/java/org/apache/solr/analysis/ClassicTokenizerFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/ClassicTokenizerFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/ClassicTokenizerFactory.java	(working copy)
@@ -20,6 +20,8 @@
 import org.apache.lucene.analysis.Tokenizer;
 import org.apache.lucene.analysis.standard.ClassicTokenizer;
 import org.apache.lucene.analysis.standard.StandardAnalyzer;
+import org.apache.lucene.analysis.util.TokenizerFactory;
+
 import java.io.Reader;
 import java.util.Map;
 
@@ -35,7 +37,7 @@
  *
  */
 
-public class ClassicTokenizerFactory extends BaseTokenizerFactory {
+public class ClassicTokenizerFactory extends TokenizerFactory {
 
   private int maxTokenLength;
 
Index: solr/core/src/java/org/apache/solr/analysis/GalicianMinimalStemFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/GalicianMinimalStemFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/GalicianMinimalStemFilterFactory.java	(working copy)
@@ -19,6 +19,7 @@
 
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.gl.GalicianMinimalStemFilter;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 /**
  * Factory for {@link GalicianMinimalStemFilter}. 
@@ -32,7 +33,7 @@
  * &lt;/fieldType&gt;</pre> 
  *
  */
-public class GalicianMinimalStemFilterFactory extends BaseTokenFilterFactory {
+public class GalicianMinimalStemFilterFactory extends TokenFilterFactory {
   public TokenStream create(TokenStream input) {
     return new GalicianMinimalStemFilter(input);
   }
Index: solr/core/src/java/org/apache/solr/analysis/CJKWidthFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/CJKWidthFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/CJKWidthFilterFactory.java	(working copy)
@@ -19,6 +19,7 @@
 
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.cjk.CJKWidthFilter;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 /** 
  * Factory for {@link CJKWidthFilter}.
@@ -33,7 +34,7 @@
  * &lt;/fieldType&gt;</pre>
  */
 
-public class CJKWidthFilterFactory extends BaseTokenFilterFactory implements MultiTermAwareComponent {
+public class CJKWidthFilterFactory extends TokenFilterFactory implements MultiTermAwareComponent {
   
   @Override
   public TokenStream create(TokenStream input) {
Index: solr/core/src/java/org/apache/solr/analysis/PersianNormalizationFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/PersianNormalizationFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/PersianNormalizationFilterFactory.java	(working copy)
@@ -21,6 +21,7 @@
 
 import org.apache.lucene.analysis.fa.PersianNormalizationFilter;
 import org.apache.lucene.analysis.TokenStream;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 /** 
  * Factory for {@link PersianNormalizationFilter}.
@@ -34,7 +35,7 @@
  * &lt;/fieldType&gt;</pre>
  *
  */
-public class PersianNormalizationFilterFactory extends BaseTokenFilterFactory implements MultiTermAwareComponent {
+public class PersianNormalizationFilterFactory extends TokenFilterFactory implements MultiTermAwareComponent {
   public PersianNormalizationFilter create(TokenStream input) {
     return new PersianNormalizationFilter(input);
   }
Index: solr/core/src/java/org/apache/solr/analysis/PatternReplaceFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/PatternReplaceFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/PatternReplaceFilterFactory.java	(working copy)
@@ -18,6 +18,8 @@
 package org.apache.solr.analysis;
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.pattern.PatternReplaceFilter;
+import org.apache.lucene.analysis.util.InitializationException;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 import java.util.Map;
 import java.util.regex.Pattern;
@@ -36,7 +38,7 @@
  *
  * @see PatternReplaceFilter
  */
-public class PatternReplaceFilterFactory extends BaseTokenFilterFactory {
+public class PatternReplaceFilterFactory extends TokenFilterFactory {
   Pattern p;
   String replacement;
   boolean all = true;
Index: solr/core/src/java/org/apache/solr/analysis/BaseTokenFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/BaseTokenFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/BaseTokenFilterFactory.java	(working copy)
@@ -1,27 +0,0 @@
-/**
- * Licensed to the Apache Software Foundation (ASF) under one or more
- * contributor license agreements.  See the NOTICE file distributed with
- * this work for additional information regarding copyright ownership.
- * The ASF licenses this file to You under the Apache License, Version 2.0
- * (the "License"); you may not use this file except in compliance with
- * the License.  You may obtain a copy of the License at
- *
- *     http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package org.apache.solr.analysis;
-
-/**
- * Simple abstract implementation that handles init arg processing.
- * 
- *
- */
-public abstract class BaseTokenFilterFactory extends BaseTokenStreamFactory implements TokenFilterFactory {
-
-}
Index: solr/core/src/java/org/apache/solr/analysis/DoubleMetaphoneFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/DoubleMetaphoneFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/DoubleMetaphoneFilterFactory.java	(working copy)
@@ -20,6 +20,7 @@
 
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.phonetic.DoubleMetaphoneFilter;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 /**
  * Factory for {@link DoubleMetaphoneFilter}.
@@ -32,7 +33,7 @@
  * &lt;/fieldType&gt;</pre>
  *
  */
-public class DoubleMetaphoneFilterFactory extends BaseTokenFilterFactory 
+public class DoubleMetaphoneFilterFactory extends TokenFilterFactory
 {
   public static final String INJECT = "inject"; 
   public static final String MAX_CODE_LENGTH = "maxCodeLength"; 
Index: solr/core/src/java/org/apache/solr/analysis/TrimFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/TrimFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/TrimFilterFactory.java	(working copy)
@@ -21,6 +21,8 @@
 
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.miscellaneous.TrimFilter;
+import org.apache.lucene.analysis.util.InitializationException;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 /**
  * Factory for {@link TrimFilter}.
@@ -34,7 +36,7 @@
  *
  * @see TrimFilter
  */
-public class TrimFilterFactory extends BaseTokenFilterFactory {
+public class TrimFilterFactory extends TokenFilterFactory {
   
   protected boolean updateOffsets = false;
   
Index: solr/core/src/java/org/apache/solr/analysis/EnglishPossessiveFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/EnglishPossessiveFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/EnglishPossessiveFilterFactory.java	(working copy)
@@ -21,6 +21,7 @@
 
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.en.EnglishPossessiveFilter;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 /**
  * Factory for {@link EnglishPossessiveFilter}. 
@@ -34,7 +35,7 @@
  * &lt;/fieldType&gt;</pre> 
  *
  */
-public class EnglishPossessiveFilterFactory extends BaseTokenFilterFactory {
+public class EnglishPossessiveFilterFactory extends TokenFilterFactory {
   
   @Override
   public void init(Map<String,String> args) {
Index: solr/core/src/java/org/apache/solr/analysis/CharFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/CharFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/CharFilterFactory.java	(working copy)
@@ -1,39 +0,0 @@
-/**
- * Licensed to the Apache Software Foundation (ASF) under one or more
- * contributor license agreements.  See the NOTICE file distributed with
- * this work for additional information regarding copyright ownership.
- * The ASF licenses this file to You under the Apache License, Version 2.0
- * (the "License"); you may not use this file except in compliance with
- * the License.  You may obtain a copy of the License at
- *
- *     http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package org.apache.solr.analysis;
-
-import java.util.Map;
-
-import org.apache.lucene.analysis.CharStream;
-import org.apache.lucene.util.Version;
-
-/**
-*
-* @since Solr 1.4
-*
-*/
-public interface CharFilterFactory {
-
-  public void init(Map<String,String> args);
-
-  public Map<String,String> getArgs();
-
-  public void setLuceneMatchVersion(Version luceneMatchVersion);
-
-  public CharStream create(CharStream input);
-}
Index: solr/core/src/java/org/apache/solr/analysis/IndonesianStemFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/IndonesianStemFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/IndonesianStemFilterFactory.java	(working copy)
@@ -21,6 +21,7 @@
 
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.id.IndonesianStemFilter;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 /** 
  * Factory for {@link IndonesianStemFilter}. 
@@ -34,7 +35,7 @@
  * &lt;/fieldType&gt;</pre>
  *
  */
-public class IndonesianStemFilterFactory extends BaseTokenFilterFactory {
+public class IndonesianStemFilterFactory extends TokenFilterFactory {
   private boolean stemDerivational = true;
 
   @Override
Index: solr/core/src/java/org/apache/solr/analysis/TokenFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/TokenFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/TokenFilterFactory.java	(working copy)
@@ -1,74 +0,0 @@
-/**
- * Licensed to the Apache Software Foundation (ASF) under one or more
- * contributor license agreements.  See the NOTICE file distributed with
- * this work for additional information regarding copyright ownership.
- * The ASF licenses this file to You under the Apache License, Version 2.0
- * (the "License"); you may not use this file except in compliance with
- * the License.  You may obtain a copy of the License at
- *
- *     http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package org.apache.solr.analysis;
-
-import org.apache.lucene.analysis.TokenStream;
-import org.apache.lucene.util.Version;
-
-import java.util.Map;
-
-/**
- * A <code>TokenFilterFactory</code> creates a 
- * <code>TokenFilter</code> to transform one <code>TokenStream</code> 
- * into another.
- *
- * <p>
- * TokenFilterFactories are registered for <code>FieldType</code>s with the
- * <code>IndexSchema</code> through the <code>schema.xml</code> file.
- * </p>
- * <p>
- * Example <code>schema.xml</code> entry to register a TokenFilterFactory 
- * implementation to transform tokens in a field of type "cool"
- * </p>
- * <pre>
- *  &lt;fieldtype name="cool" class="solr.TextField"&gt;
- *      &lt;analyzer&gt;
- *      ...
- *      &lt;filter class="foo.MyTokenFilterFactory"/&gt;
- *      ...
- * </pre>
- * <p>
- * A single instance of any registered TokenFilterFactory is created
- * via the default constructor and is reused for each FieldType.
- * </p>
- *
- */
-
-public interface TokenFilterFactory {
-  /** <code>init</code> will be called just once, immediately after creation.
-   * <p>The args are user-level initialization parameters that
-   * may be specified when declaring the factory in the
-   * schema.xml
-   */
-  public void init(Map<String,String> args);
-
-  public void setLuceneMatchVersion(Version luceneMatchVersion);
-  
-  /**
-   * Accessor method for reporting the args used to initialize this factory.
-   * <p>
-   * Implementations are <strong>strongly</strong> encouraged to return 
-   * the contents of the Map passed to to the init method
-   * </p>
-   */
-  public Map<String,String> getArgs();
-  
-  /** Transform the specified input TokenStream */
-  public TokenStream create(TokenStream input);
-}
-
Index: solr/core/src/java/org/apache/solr/analysis/CommonGramsFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/CommonGramsFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/CommonGramsFilterFactory.java	(working copy)
@@ -21,9 +21,7 @@
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.commongrams.CommonGramsFilter;
 import org.apache.lucene.analysis.core.StopAnalyzer;
-import org.apache.lucene.analysis.util.CharArraySet;
-import org.apache.lucene.analysis.util.ResourceLoader;
-import org.apache.lucene.analysis.util.ResourceLoaderAware;
+import org.apache.lucene.analysis.util.*;
 
 /**
  * Constructs a {@link CommonGramsFilter}.
@@ -40,7 +38,7 @@
 /*
  * This is pretty close to a straight copy from StopFilterFactory
  */
-public class CommonGramsFilterFactory extends BaseTokenFilterFactory implements
+public class CommonGramsFilterFactory extends TokenFilterFactory implements
     ResourceLoaderAware {
 
   public void inform(ResourceLoader loader) {
Index: solr/core/src/java/org/apache/solr/analysis/FrenchLightStemFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/FrenchLightStemFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/FrenchLightStemFilterFactory.java	(working copy)
@@ -19,6 +19,7 @@
 
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.fr.FrenchLightStemFilter;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 /**
  * Factory for {@link FrenchLightStemFilter}.
@@ -33,7 +34,7 @@
  * &lt;/fieldType&gt;</pre> 
  *
  */
-public class FrenchLightStemFilterFactory extends BaseTokenFilterFactory {
+public class FrenchLightStemFilterFactory extends TokenFilterFactory {
   public TokenStream create(TokenStream input) {
     return new FrenchLightStemFilter(input);
   }
Index: solr/core/src/java/org/apache/solr/analysis/FSTSynonymFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/FSTSynonymFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/FSTSynonymFilterFactory.java	(working copy)
@@ -26,7 +26,6 @@
 import java.nio.charset.CodingErrorAction;
 import java.text.ParseException;
 import java.util.List;
-import java.util.Map;
 
 import org.apache.lucene.analysis.Analyzer;
 import org.apache.lucene.analysis.TokenStream;
@@ -37,10 +36,9 @@
 import org.apache.lucene.analysis.synonym.SynonymMap;
 import org.apache.lucene.analysis.synonym.SolrSynonymParser;
 import org.apache.lucene.analysis.synonym.WordnetSynonymParser;
+import org.apache.lucene.analysis.util.*;
 import org.apache.lucene.util.Version;
-import org.apache.lucene.analysis.util.ResourceLoader;
 import org.apache.solr.common.util.StrUtils;
-import org.apache.lucene.analysis.util.ResourceLoaderAware;
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
 
@@ -50,7 +48,7 @@
  */
 // NOTE: rename this to "SynonymFilterFactory" and nuke that delegator in Lucene 5.0!
 @Deprecated
-final class FSTSynonymFilterFactory extends BaseTokenFilterFactory implements ResourceLoaderAware {
+final class FSTSynonymFilterFactory extends TokenFilterFactory implements ResourceLoaderAware {
 
   public static final Logger log = LoggerFactory.getLogger(FSTSynonymFilterFactory.class);
 
Index: solr/core/src/java/org/apache/solr/analysis/ReversedWildcardFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/ReversedWildcardFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/ReversedWildcardFilterFactory.java	(working copy)
@@ -20,6 +20,7 @@
 
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.reverse.ReverseStringFilter;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 /**
  * Factory for {@link ReversedWildcardFilter}-s. When this factory is
@@ -61,7 +62,7 @@
  * &lt;/fieldType&gt;</pre>
  *
  */
-public class ReversedWildcardFilterFactory extends BaseTokenFilterFactory {
+public class ReversedWildcardFilterFactory extends TokenFilterFactory {
   
   private char markerChar = ReverseStringFilter.START_OF_HEADING_MARKER;
   private boolean withOriginal;
Index: solr/core/src/java/org/apache/solr/analysis/GermanLightStemFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/GermanLightStemFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/GermanLightStemFilterFactory.java	(working copy)
@@ -19,6 +19,7 @@
 
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.de.GermanLightStemFilter;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 /**
  * Factory for {@link GermanLightStemFilter}.
@@ -32,7 +33,7 @@
  * &lt;/fieldType&gt;</pre> 
  *
  */
-public class GermanLightStemFilterFactory extends BaseTokenFilterFactory {
+public class GermanLightStemFilterFactory extends TokenFilterFactory {
   public TokenStream create(TokenStream input) {
     return new GermanLightStemFilter(input);
   }
Index: solr/core/src/java/org/apache/solr/analysis/CJKTokenizerFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/CJKTokenizerFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/CJKTokenizerFactory.java	(working copy)
@@ -20,6 +20,8 @@
 package org.apache.solr.analysis;
 
 import org.apache.lucene.analysis.cjk.CJKTokenizer;
+import org.apache.lucene.analysis.util.TokenizerFactory;
+
 import java.io.Reader;
 
 /** 
@@ -33,7 +35,7 @@
  * @deprecated
  */
 @Deprecated
-public class CJKTokenizerFactory extends BaseTokenizerFactory {
+public class CJKTokenizerFactory extends TokenizerFactory {
   public CJKTokenizer create(Reader in) {
     return new CJKTokenizer(in);
   }
Index: solr/core/src/java/org/apache/solr/analysis/BulgarianStemFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/BulgarianStemFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/BulgarianStemFilterFactory.java	(working copy)
@@ -19,6 +19,7 @@
 
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.bg.BulgarianStemFilter;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 /** 
  * Factory for {@link BulgarianStemFilter}.
@@ -32,7 +33,7 @@
  * &lt;/fieldType&gt;</pre>
  *
  */
-public class BulgarianStemFilterFactory extends BaseTokenFilterFactory {
+public class BulgarianStemFilterFactory extends TokenFilterFactory {
   public TokenStream create(TokenStream input) {
     return new BulgarianStemFilter(input);
   }
Index: solr/core/src/java/org/apache/solr/analysis/CollationKeyFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/CollationKeyFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/CollationKeyFilterFactory.java	(working copy)
@@ -26,6 +26,8 @@
 
 import org.apache.commons.io.IOUtils;
 import org.apache.lucene.analysis.TokenStream;
+import org.apache.lucene.analysis.util.InitializationException;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 import org.apache.lucene.collation.CollationKeyFilter;
 import org.apache.lucene.analysis.util.ResourceLoader;
 import org.apache.lucene.analysis.util.ResourceLoaderAware;
@@ -70,7 +72,7 @@
  * @deprecated use {@link org.apache.solr.schema.CollationField} instead.
  */
 @Deprecated
-public class CollationKeyFilterFactory extends BaseTokenFilterFactory implements MultiTermAwareComponent,ResourceLoaderAware {
+public class CollationKeyFilterFactory extends TokenFilterFactory implements MultiTermAwareComponent, ResourceLoaderAware {
   private Collator collator;
 
   public void inform(ResourceLoader loader) {
Index: solr/core/src/java/org/apache/solr/analysis/ItalianLightStemFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/ItalianLightStemFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/ItalianLightStemFilterFactory.java	(working copy)
@@ -19,6 +19,7 @@
 
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.it.ItalianLightStemFilter;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 /** 
  * Factory for {@link ItalianLightStemFilter}. 
@@ -32,7 +33,7 @@
  * &lt;/fieldType&gt;</pre> 
  *
  */
-public class ItalianLightStemFilterFactory extends BaseTokenFilterFactory {
+public class ItalianLightStemFilterFactory extends TokenFilterFactory {
   public TokenStream create(TokenStream input) {
     return new ItalianLightStemFilter(input);
   }
Index: solr/core/src/java/org/apache/solr/analysis/HindiNormalizationFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/HindiNormalizationFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/HindiNormalizationFilterFactory.java	(working copy)
@@ -19,6 +19,7 @@
 
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.hi.HindiNormalizationFilter;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 /** 
  * Factory for {@link HindiNormalizationFilter}. 
@@ -31,7 +32,7 @@
  * &lt;/fieldType&gt;</pre>
  *
  */
-public class HindiNormalizationFilterFactory extends BaseTokenFilterFactory implements MultiTermAwareComponent {
+public class HindiNormalizationFilterFactory extends TokenFilterFactory implements MultiTermAwareComponent {
   public TokenStream create(TokenStream input) {
     return new HindiNormalizationFilter(input);
   }
Index: solr/core/src/java/org/apache/solr/analysis/GreekLowerCaseFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/GreekLowerCaseFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/GreekLowerCaseFilterFactory.java	(working copy)
@@ -22,6 +22,8 @@
 
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.el.GreekLowerCaseFilter;
+import org.apache.lucene.analysis.util.InitializationException;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 /** 
  * Factory for {@link GreekLowerCaseFilter}. 
@@ -34,8 +36,7 @@
  * &lt;/fieldType&gt;</pre> 
  *
  */
-public class GreekLowerCaseFilterFactory extends BaseTokenFilterFactory implements MultiTermAwareComponent
-{
+public class GreekLowerCaseFilterFactory extends TokenFilterFactory implements MultiTermAwareComponent {
  
   @Override
   public void init(Map<String, String> args) {
Index: solr/core/src/java/org/apache/solr/analysis/BrazilianStemFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/BrazilianStemFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/BrazilianStemFilterFactory.java	(working copy)
@@ -18,8 +18,10 @@
 
 
 package org.apache.solr.analysis;
+
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.br.BrazilianStemFilter;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 /** 
  * Factory for {@link BrazilianStemFilter}.
@@ -33,7 +35,7 @@
  * &lt;/fieldType&gt;</pre>
  *
  */
-public class BrazilianStemFilterFactory extends BaseTokenFilterFactory {
+public class BrazilianStemFilterFactory extends TokenFilterFactory {
   public BrazilianStemFilter create(TokenStream in) {
     return new BrazilianStemFilter(in);
   }
Index: solr/core/src/java/org/apache/solr/analysis/NGramFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/NGramFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/NGramFilterFactory.java	(working copy)
@@ -20,6 +20,7 @@
 import java.util.Map;
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.ngram.NGramTokenFilter;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 /**
  * Factory for {@link NGramTokenFilter}.
@@ -32,7 +33,7 @@
  * &lt;/fieldType&gt;</pre> 
  *
  */
-public class NGramFilterFactory extends BaseTokenFilterFactory {
+public class NGramFilterFactory extends TokenFilterFactory {
   private int maxGramSize = 0;
 
   private int minGramSize = 0;
Index: solr/core/src/java/org/apache/solr/analysis/PositionFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/PositionFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/PositionFilterFactory.java	(working copy)
@@ -19,6 +19,7 @@
 
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.position.PositionFilter;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 import java.util.Map;
 
@@ -38,7 +39,7 @@
  * @see org.apache.lucene.analysis.position.PositionFilter
  * @since solr 1.4
  */
-public class PositionFilterFactory extends BaseTokenFilterFactory {
+public class PositionFilterFactory extends TokenFilterFactory {
   private int positionIncrement;
 
   @Override
Index: solr/core/src/java/org/apache/solr/analysis/FrenchMinimalStemFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/FrenchMinimalStemFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/FrenchMinimalStemFilterFactory.java	(working copy)
@@ -19,6 +19,7 @@
 
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.fr.FrenchMinimalStemFilter;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 /** 
  * Factory for {@link FrenchMinimalStemFilter}.
@@ -33,7 +34,7 @@
  * &lt;/fieldType&gt;</pre> 
  *
  */
-public class FrenchMinimalStemFilterFactory extends BaseTokenFilterFactory {
+public class FrenchMinimalStemFilterFactory extends TokenFilterFactory {
   public TokenStream create(TokenStream input) {
     return new FrenchMinimalStemFilter(input);
   }
Index: solr/core/src/java/org/apache/solr/analysis/InitializationException.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/InitializationException.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/InitializationException.java	(working copy)
@@ -1,32 +0,0 @@
-package org.apache.solr.analysis;
-
-/*
- * Licensed to the Apache Software Foundation (ASF) under one or more
- * contributor license agreements.  See the NOTICE file distributed with
- * this work for additional information regarding copyright ownership.
- * The ASF licenses this file to You under the Apache License, Version 2.0
- * (the "License"); you may not use this file except in compliance with
- * the License.  You may obtain a copy of the License at
- *
- *     http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-/**
- * Exception representing an error occurring during the initialization of a Factory.
- */
-public class InitializationException extends RuntimeException {
-
-  public InitializationException(String message) {
-    super(message);
-  }
-
-  public InitializationException(String message, Throwable cause) {
-    super(message, cause);
-  }
-}
Index: solr/core/src/java/org/apache/solr/analysis/HyphenatedWordsFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/HyphenatedWordsFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/HyphenatedWordsFilterFactory.java	(working copy)
@@ -19,7 +19,7 @@
 
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.miscellaneous.HyphenatedWordsFilter;
-import org.apache.solr.analysis.BaseTokenFilterFactory;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 /**
  * Factory for {@link HyphenatedWordsFilter}.
@@ -32,7 +32,7 @@
  * &lt;/fieldType&gt;</pre> 
  *
  */
-public class HyphenatedWordsFilterFactory extends BaseTokenFilterFactory {
+public class HyphenatedWordsFilterFactory extends TokenFilterFactory {
 	public HyphenatedWordsFilter create(TokenStream input) {
 		return new HyphenatedWordsFilter(input);
 	}
Index: solr/core/src/java/org/apache/solr/analysis/BaseCharFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/BaseCharFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/BaseCharFilterFactory.java	(working copy)
@@ -1,64 +0,0 @@
-/**
- * Licensed to the Apache Software Foundation (ASF) under one or more
- * contributor license agreements.  See the NOTICE file distributed with
- * this work for additional information regarding copyright ownership.
- * The ASF licenses this file to You under the Apache License, Version 2.0
- * (the "License"); you may not use this file except in compliance with
- * the License.  You may obtain a copy of the License at
- *
- *     http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package org.apache.solr.analysis;
-
-import org.apache.lucene.util.Version;
-
-import java.util.Map;
-
-/**
-*
-* @since Solr 1.4
-*
-*/
-public abstract class BaseCharFilterFactory implements CharFilterFactory {
-
-  protected Version luceneMatchVersion;
-
-  /** The init args */
-  protected Map<String,String> args;
-
-  public Map<String, String> getArgs() {
-    return args;
-  }
-
-  public void init(Map<String, String> args) {
-    this.args = args;
-  }
-
-  public void setLuceneMatchVersion(Version luceneMatchVersion) {
-    this.luceneMatchVersion = luceneMatchVersion;
-  }
-
-  protected int getInt(String name) {
-    return getInt(name,-1,false);
-  }
-
-  protected int getInt(String name, int defaultVal) {
-    return getInt(name,defaultVal,true);
-  }
-
-  protected int getInt(String name, int defaultVal, boolean useDefault) {
-    String s = args.get(name);
-    if (s==null) {
-      if (useDefault) return defaultVal;
-      throw new InitializationException("Configuration Error: missing parameter '" + name + "'");
-    }
-    return Integer.parseInt(s);
-  }
-}
Index: solr/core/src/java/org/apache/solr/analysis/GermanMinimalStemFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/GermanMinimalStemFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/GermanMinimalStemFilterFactory.java	(working copy)
@@ -19,6 +19,7 @@
 
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.de.GermanMinimalStemFilter;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 /**
  * Factory for {@link GermanMinimalStemFilter}.
@@ -32,7 +33,7 @@
  * &lt;/fieldType&gt;</pre> 
  *
  */
-public class GermanMinimalStemFilterFactory extends BaseTokenFilterFactory {
+public class GermanMinimalStemFilterFactory extends TokenFilterFactory {
   public TokenStream create(TokenStream input) {
     return new GermanMinimalStemFilter(input);
   }
Index: solr/core/src/java/org/apache/solr/analysis/LowerCaseTokenizerFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/LowerCaseTokenizerFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/LowerCaseTokenizerFactory.java	(working copy)
@@ -19,6 +19,7 @@
 
 import org.apache.lucene.analysis.core.LowerCaseFilter;
 import org.apache.lucene.analysis.core.LowerCaseTokenizer;
+import org.apache.lucene.analysis.util.TokenizerFactory;
 
 import java.io.Reader;
 import java.util.Map;
@@ -33,7 +34,7 @@
  * &lt;/fieldType&gt;</pre> 
  *
  */
-public class LowerCaseTokenizerFactory extends BaseTokenizerFactory implements MultiTermAwareComponent {
+public class LowerCaseTokenizerFactory extends TokenizerFactory implements MultiTermAwareComponent {
   @Override
   public void init(Map<String,String> args) {
     super.init(args);
Index: solr/core/src/java/org/apache/solr/analysis/JapaneseTokenizerFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/JapaneseTokenizerFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/JapaneseTokenizerFactory.java	(working copy)
@@ -30,6 +30,8 @@
 import org.apache.lucene.analysis.ja.JapaneseTokenizer;
 import org.apache.lucene.analysis.ja.JapaneseTokenizer.Mode;
 import org.apache.lucene.analysis.ja.dict.UserDictionary;
+import org.apache.lucene.analysis.util.InitializationException;
+import org.apache.lucene.analysis.util.TokenizerFactory;
 import org.apache.lucene.util.IOUtils;
 import org.apache.lucene.analysis.util.ResourceLoader;
 import org.apache.lucene.analysis.util.ResourceLoaderAware;
@@ -49,7 +51,7 @@
  * &lt;/fieldType&gt;
  * </pre>
  */
-public class JapaneseTokenizerFactory extends BaseTokenizerFactory implements ResourceLoaderAware {
+public class JapaneseTokenizerFactory extends TokenizerFactory implements ResourceLoaderAware {
   private static final String MODE = "mode";
   
   private static final String USER_DICT_PATH = "userDictionary";
Index: solr/core/src/java/org/apache/solr/analysis/SynonymFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/SynonymFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/SynonymFilterFactory.java	(working copy)
@@ -21,9 +21,11 @@
 
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.synonym.SynonymFilter;
+import org.apache.lucene.analysis.util.InitializationException;
 import org.apache.lucene.util.Version;
 import org.apache.lucene.analysis.util.ResourceLoader;
 import org.apache.lucene.analysis.util.ResourceLoaderAware;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 /**
  * Factory for {@link SynonymFilter}.
@@ -37,8 +39,8 @@
  *   &lt;/analyzer&gt;
  * &lt;/fieldType&gt;</pre>
  */
-public class SynonymFilterFactory extends BaseTokenFilterFactory implements ResourceLoaderAware {
-  private BaseTokenFilterFactory delegator;
+public class SynonymFilterFactory extends TokenFilterFactory implements ResourceLoaderAware {
+  private TokenFilterFactory delegator;
 
   @Override
   public void init(Map<String,String> args) {
Index: solr/core/src/java/org/apache/solr/analysis/TokenizerChain.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/TokenizerChain.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/TokenizerChain.java	(working copy)
@@ -18,6 +18,9 @@
 package org.apache.solr.analysis;
 
 import org.apache.lucene.analysis.*;
+import org.apache.lucene.analysis.util.CharFilterFactory;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
+import org.apache.lucene.analysis.util.TokenizerFactory;
 
 import java.io.IOException;
 import java.io.Reader;
Index: solr/core/src/java/org/apache/solr/analysis/PathHierarchyTokenizerFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/PathHierarchyTokenizerFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/PathHierarchyTokenizerFactory.java	(working copy)
@@ -22,6 +22,8 @@
 import org.apache.lucene.analysis.Tokenizer;
 import org.apache.lucene.analysis.path.PathHierarchyTokenizer;
 import org.apache.lucene.analysis.path.ReversePathHierarchyTokenizer;
+import org.apache.lucene.analysis.util.InitializationException;
+import org.apache.lucene.analysis.util.TokenizerFactory;
 
 
 /**
@@ -34,7 +36,7 @@
  * &lt;/fieldType&gt;</pre> 
  *
  */
-public class PathHierarchyTokenizerFactory extends BaseTokenizerFactory {
+public class PathHierarchyTokenizerFactory extends TokenizerFactory {
   
   private char delimiter;
   private char replacement;
Index: solr/core/src/java/org/apache/solr/analysis/BaseTokenStreamFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/BaseTokenStreamFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/BaseTokenStreamFactory.java	(working copy)
@@ -1,153 +0,0 @@
-/**
- * Licensed to the Apache Software Foundation (ASF) under one or more
- * contributor license agreements.  See the NOTICE file distributed with
- * this work for additional information regarding copyright ownership.
- * The ASF licenses this file to You under the Apache License, Version 2.0
- * (the "License"); you may not use this file except in compliance with
- * the License.  You may obtain a copy of the License at
- *
- *     http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package org.apache.solr.analysis;
-
-import org.apache.lucene.analysis.core.StopFilter;
-import org.apache.lucene.analysis.util.CharArraySet;
-import org.apache.lucene.analysis.util.WordlistLoader;
-import org.apache.lucene.util.IOUtils;
-import org.apache.lucene.util.Version;
-import org.apache.lucene.analysis.util.ResourceLoader;
-import org.apache.solr.common.util.StrUtils;
-
-import java.io.IOException;
-import java.io.InputStream;
-import java.io.InputStreamReader;
-import java.io.Reader;
-import java.nio.charset.CharsetDecoder;
-import java.nio.charset.CodingErrorAction;
-import java.util.List;
-import java.util.Map;
-
-/**
- * Simple abstract implementation that handles init arg processing, is not really
- * a factory as it implements no interface, but removes code duplication
- * in its subclasses.
- * 
- *
- */
-abstract class BaseTokenStreamFactory {
-  /** The init args */
-  protected Map<String,String> args;
-  
-  /** the luceneVersion arg */
-  protected Version luceneMatchVersion = null;
-
-  public void init(Map<String,String> args) {
-    this.args=args;
-  }
-
-  public Map<String,String> getArgs() {
-    return args;
-  }
-  
-  /** this method can be called in the {@link TokenizerFactory#create(java.io.Reader)} 
-   * or {@link TokenFilterFactory#create(org.apache.lucene.analysis.TokenStream)} methods,
-   * to inform user, that for this factory a {@link #luceneMatchVersion} is required */
-  protected final void assureMatchVersion() {
-    if (luceneMatchVersion == null) {
-      throw new InitializationException("Configuration Error: Factory '" + this.getClass().getName() +
-        "' needs a 'luceneMatchVersion' parameter");
-    }
-  }
-
-  public void setLuceneMatchVersion(Version luceneMatchVersion) {
-    this.luceneMatchVersion = luceneMatchVersion;
-  }
-  
-  // TODO: move these somewhere that tokenizers and others
-  // can also use them...
-  protected int getInt(String name) {
-    return getInt(name,-1,false);
-  }
-
-  protected int getInt(String name, int defaultVal) {
-    return getInt(name,defaultVal,true);
-  }
-
-  protected int getInt(String name, int defaultVal, boolean useDefault) {
-    String s = args.get(name);
-    if (s==null) {
-      if (useDefault) return defaultVal;
-      throw new InitializationException("Configuration Error: missing parameter '" + name + "'");
-    }
-    return Integer.parseInt(s);
-  }
-
-  protected boolean getBoolean(String name, boolean defaultVal) {
-    return getBoolean(name,defaultVal,true);
-  }
-
-  protected boolean getBoolean(String name, boolean defaultVal, boolean useDefault) {
-    String s = args.get(name);
-    if (s==null) {
-      if (useDefault) return defaultVal;
-      throw new InitializationException("Configuration Error: missing parameter '" + name + "'");
-    }
-    return Boolean.parseBoolean(s);
-  }
-
-  protected CharArraySet getWordSet(ResourceLoader loader,
-      String wordFiles, boolean ignoreCase) throws IOException {
-    assureMatchVersion();
-    List<String> files = StrUtils.splitFileNames(wordFiles);
-    CharArraySet words = null;
-    if (files.size() > 0) {
-      // default stopwords list has 35 or so words, but maybe don't make it that
-      // big to start
-      words = new CharArraySet(luceneMatchVersion, 
-          files.size() * 10, ignoreCase);
-      for (String file : files) {
-        List<String> wlist = loader.getLines(file.trim());
-        words.addAll(StopFilter.makeStopSet(luceneMatchVersion, wlist,
-            ignoreCase));
-      }
-    }
-    return words;
-  }
-  
-  /** same as {@link #getWordSet(ResourceLoader, String, boolean)},
-   * except the input is in snowball format. */
-  protected CharArraySet getSnowballWordSet(ResourceLoader loader,
-      String wordFiles, boolean ignoreCase) throws IOException {
-    assureMatchVersion();
-    List<String> files = StrUtils.splitFileNames(wordFiles);
-    CharArraySet words = null;
-    if (files.size() > 0) {
-      // default stopwords list has 35 or so words, but maybe don't make it that
-      // big to start
-      words = new CharArraySet(luceneMatchVersion, 
-          files.size() * 10, ignoreCase);
-      for (String file : files) {
-        InputStream stream = null;
-        Reader reader = null;
-        try {
-          stream = loader.openResource(file.trim());
-          CharsetDecoder decoder = IOUtils.CHARSET_UTF_8.newDecoder()
-              .onMalformedInput(CodingErrorAction.REPORT)
-              .onUnmappableCharacter(CodingErrorAction.REPORT);
-          reader = new InputStreamReader(stream, decoder);
-          WordlistLoader.getSnowballWordSet(reader, words);
-        } finally {
-          IOUtils.closeWhileHandlingException(reader, stream);
-        }
-      }
-    }
-    return words;
-  }
-}
Index: solr/core/src/java/org/apache/solr/analysis/LengthFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/LengthFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/LengthFilterFactory.java	(working copy)
@@ -19,6 +19,7 @@
 
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.miscellaneous.LengthFilter;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 import java.util.Map;
 
@@ -33,7 +34,7 @@
  * &lt;/fieldType&gt;</pre> 
  *
  */
-public class LengthFilterFactory extends BaseTokenFilterFactory {
+public class LengthFilterFactory extends TokenFilterFactory {
   int min,max;
   boolean enablePositionIncrements;
   public static final String MIN_KEY = "min";
Index: solr/core/src/java/org/apache/solr/analysis/ThaiWordFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/ThaiWordFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/ThaiWordFilterFactory.java	(working copy)
@@ -21,6 +21,7 @@
 import org.apache.lucene.analysis.th.ThaiWordFilter;
 
 import org.apache.lucene.analysis.TokenStream;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 /** 
  * Factory for {@link ThaiWordFilter}.
@@ -33,7 +34,7 @@
  * &lt;/fieldType&gt;</pre>
  *
  */
-public class ThaiWordFilterFactory extends BaseTokenFilterFactory {
+public class ThaiWordFilterFactory extends TokenFilterFactory {
   public ThaiWordFilter create(TokenStream input) {
     assureMatchVersion();
     return new ThaiWordFilter(luceneMatchVersion, input);
Index: solr/core/src/java/org/apache/solr/analysis/TypeTokenFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/TypeTokenFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/TypeTokenFilterFactory.java	(working copy)
@@ -19,9 +19,11 @@
 
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.core.TypeTokenFilter;
+import org.apache.lucene.analysis.util.InitializationException;
 import org.apache.lucene.analysis.util.ResourceLoader;
 import org.apache.solr.common.util.StrUtils;
 import org.apache.lucene.analysis.util.ResourceLoaderAware;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 import java.io.IOException;
 import java.util.HashSet;
@@ -39,7 +41,7 @@
  *   &lt;/analyzer&gt;
  * &lt;/fieldType&gt;</pre>
  */
-public class TypeTokenFilterFactory extends BaseTokenFilterFactory implements ResourceLoaderAware {
+public class TypeTokenFilterFactory extends TokenFilterFactory implements ResourceLoaderAware {
 
   @Override
   public void inform(ResourceLoader loader) {
Index: solr/core/src/java/org/apache/solr/analysis/HunspellStemFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/HunspellStemFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/HunspellStemFilterFactory.java	(working copy)
@@ -24,8 +24,10 @@
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.hunspell.HunspellDictionary;
 import org.apache.lucene.analysis.hunspell.HunspellStemFilter;
+import org.apache.lucene.analysis.util.InitializationException;
 import org.apache.lucene.analysis.util.ResourceLoader;
 import org.apache.lucene.analysis.util.ResourceLoaderAware;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 /**
  * TokenFilterFactory that creates instances of {@link org.apache.lucene.analysis.hunspell.HunspellStemFilter}.
@@ -43,7 +45,7 @@
  * 
  * See <a href="http://wiki.apache.org/solr/Hunspell">http://wiki.apache.org/solr/Hunspell</a>
  */
-public class HunspellStemFilterFactory extends BaseTokenFilterFactory implements ResourceLoaderAware {
+public class HunspellStemFilterFactory extends TokenFilterFactory implements ResourceLoaderAware {
   
   private static final String PARAM_DICTIONARY = "dictionary";
   private static final String PARAM_AFFIX = "affix";
Index: solr/core/src/java/org/apache/solr/analysis/PortugueseLightStemFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/PortugueseLightStemFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/PortugueseLightStemFilterFactory.java	(working copy)
@@ -19,6 +19,7 @@
 
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.pt.PortugueseLightStemFilter;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 /** 
  * Factory for {@link PortugueseLightStemFilter}.
@@ -32,7 +33,7 @@
  * &lt;/fieldType&gt;</pre>
  *
  */
-public class PortugueseLightStemFilterFactory extends BaseTokenFilterFactory {
+public class PortugueseLightStemFilterFactory extends TokenFilterFactory {
   public TokenStream create(TokenStream input) {
     return new PortugueseLightStemFilter(input);
   }
Index: solr/core/src/java/org/apache/solr/analysis/HindiStemFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/HindiStemFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/HindiStemFilterFactory.java	(working copy)
@@ -19,6 +19,7 @@
 
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.hi.HindiStemFilter;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 /** 
  * Factory for {@link HindiStemFilter}. 
@@ -31,7 +32,7 @@
  * &lt;/fieldType&gt;</pre>
  *
  */
-public class HindiStemFilterFactory extends BaseTokenFilterFactory {
+public class HindiStemFilterFactory extends TokenFilterFactory {
   public TokenStream create(TokenStream input) {
     return new HindiStemFilter(input);
   }
Index: solr/core/src/java/org/apache/solr/analysis/SpanishLightStemFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/SpanishLightStemFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/SpanishLightStemFilterFactory.java	(working copy)
@@ -19,6 +19,7 @@
 
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.es.SpanishLightStemFilter;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 /** 
  * Factory for {@link SpanishLightStemFilter}.
@@ -32,7 +33,7 @@
  * &lt;/fieldType&gt;</pre>
  *
  */
-public class SpanishLightStemFilterFactory extends BaseTokenFilterFactory {
+public class SpanishLightStemFilterFactory extends TokenFilterFactory {
   public TokenStream create(TokenStream input) {
     return new SpanishLightStemFilter(input);
   }
Index: solr/core/src/java/org/apache/solr/analysis/LatvianStemFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/LatvianStemFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/LatvianStemFilterFactory.java	(working copy)
@@ -19,6 +19,7 @@
 
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.lv.LatvianStemFilter;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 /** 
  * Factory for {@link LatvianStemFilter}. 
@@ -31,7 +32,7 @@
  *   &lt;/analyzer&gt;
  * &lt;/fieldType&gt;</pre>
  */
-public class LatvianStemFilterFactory extends BaseTokenFilterFactory {
+public class LatvianStemFilterFactory extends TokenFilterFactory {
   public TokenStream create(TokenStream input) {
     return new LatvianStemFilter(input);
   }
Index: solr/core/src/java/org/apache/solr/analysis/SwedishLightStemFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/SwedishLightStemFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/SwedishLightStemFilterFactory.java	(working copy)
@@ -19,6 +19,7 @@
 
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.sv.SwedishLightStemFilter;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 /** 
  * Factory for {@link SwedishLightStemFilter}.
@@ -32,7 +33,7 @@
  * &lt;/fieldType&gt;</pre>
  *
  */
-public class SwedishLightStemFilterFactory extends BaseTokenFilterFactory {
+public class SwedishLightStemFilterFactory extends TokenFilterFactory {
   public TokenStream create(TokenStream input) {
     return new SwedishLightStemFilter(input);
   }
Index: solr/core/src/java/org/apache/solr/analysis/UAX29URLEmailTokenizerFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/UAX29URLEmailTokenizerFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/UAX29URLEmailTokenizerFactory.java	(working copy)
@@ -22,6 +22,7 @@
 
 import org.apache.lucene.analysis.standard.StandardAnalyzer;
 import org.apache.lucene.analysis.standard.UAX29URLEmailTokenizer;
+import org.apache.lucene.analysis.util.TokenizerFactory;
 
 import java.io.Reader;
 import java.util.Map;
@@ -38,7 +39,7 @@
  * 
  */
 
-public class UAX29URLEmailTokenizerFactory extends BaseTokenizerFactory {
+public class UAX29URLEmailTokenizerFactory extends TokenizerFactory {
 
   private int maxTokenLength;
 
Index: solr/core/src/java/org/apache/solr/analysis/EdgeNGramFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/EdgeNGramFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/EdgeNGramFilterFactory.java	(working copy)
@@ -20,6 +20,7 @@
 import java.util.Map;
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.ngram.EdgeNGramTokenFilter;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 /**
  * Creates new instances of {@link EdgeNGramTokenFilter}.
@@ -32,7 +33,7 @@
  * &lt;/fieldType&gt;</pre>
  *
  */
-public class EdgeNGramFilterFactory extends BaseTokenFilterFactory {
+public class EdgeNGramFilterFactory extends TokenFilterFactory {
   private int maxGramSize = 0;
 
   private int minGramSize = 0;
Index: solr/core/src/java/org/apache/solr/analysis/EnglishMinimalStemFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/EnglishMinimalStemFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/EnglishMinimalStemFilterFactory.java	(working copy)
@@ -19,6 +19,7 @@
 
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.en.EnglishMinimalStemFilter;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 /** 
  * Factory for {@link EnglishMinimalStemFilter}.
@@ -32,7 +33,7 @@
  * &lt;/fieldType&gt;</pre>
  *
  */
-public class EnglishMinimalStemFilterFactory extends BaseTokenFilterFactory {
+public class EnglishMinimalStemFilterFactory extends TokenFilterFactory {
   public TokenStream create(TokenStream input) {
     return new EnglishMinimalStemFilter(input);
   }
Index: solr/core/src/java/org/apache/solr/analysis/MappingCharFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/MappingCharFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/MappingCharFilterFactory.java	(working copy)
@@ -27,6 +27,8 @@
 import org.apache.lucene.analysis.CharStream;
 import org.apache.lucene.analysis.charfilter.MappingCharFilter;
 import org.apache.lucene.analysis.charfilter.NormalizeCharMap;
+import org.apache.lucene.analysis.util.CharFilterFactory;
+import org.apache.lucene.analysis.util.InitializationException;
 import org.apache.lucene.analysis.util.ResourceLoader;
 import org.apache.solr.common.util.StrUtils;
 import org.apache.lucene.analysis.util.ResourceLoaderAware;
@@ -45,7 +47,7 @@
  * @since Solr 1.4
  *
  */
-public class MappingCharFilterFactory extends BaseCharFilterFactory implements
+public class MappingCharFilterFactory extends CharFilterFactory implements
     ResourceLoaderAware, MultiTermAwareComponent {
 
   protected NormalizeCharMap normMap;
Index: solr/core/src/java/org/apache/solr/analysis/RussianLetterTokenizerFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/RussianLetterTokenizerFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/RussianLetterTokenizerFactory.java	(working copy)
@@ -21,6 +21,8 @@
 import java.util.Map;
 
 import org.apache.lucene.analysis.ru.RussianLetterTokenizer;
+import org.apache.lucene.analysis.util.InitializationException;
+import org.apache.lucene.analysis.util.TokenizerFactory;
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
 
@@ -28,7 +30,7 @@
  *  This tokenizer has no Russian-specific functionality.
  */
 @Deprecated
-public class RussianLetterTokenizerFactory extends BaseTokenizerFactory {
+public class RussianLetterTokenizerFactory extends TokenizerFactory {
 
   private static final Logger log = LoggerFactory.getLogger(RussianLetterTokenizerFactory.class);
 
Index: solr/core/src/java/org/apache/solr/analysis/ASCIIFoldingFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/ASCIIFoldingFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/ASCIIFoldingFilterFactory.java	(working copy)
@@ -18,6 +18,8 @@
 
 
 package org.apache.solr.analysis;
+
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 import org.apache.lucene.analysis.miscellaneous.ASCIIFoldingFilter;
 import org.apache.lucene.analysis.TokenStream;
 
@@ -32,7 +34,7 @@
  * &lt;/fieldType&gt;</pre>
  *
  */
-public class ASCIIFoldingFilterFactory extends BaseTokenFilterFactory implements MultiTermAwareComponent {
+public class ASCIIFoldingFilterFactory extends TokenFilterFactory implements MultiTermAwareComponent {
   public ASCIIFoldingFilter create(TokenStream input) {
     return new ASCIIFoldingFilter(input);
   }
Index: solr/core/src/java/org/apache/solr/analysis/PortugueseStemFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/PortugueseStemFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/PortugueseStemFilterFactory.java	(working copy)
@@ -19,6 +19,7 @@
 
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.pt.PortugueseStemFilter;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 /** 
  * Factory for {@link PortugueseStemFilter}. 
@@ -32,7 +33,7 @@
  * &lt;/fieldType&gt;</pre>
  *
  */
-public class PortugueseStemFilterFactory extends BaseTokenFilterFactory {
+public class PortugueseStemFilterFactory extends TokenFilterFactory {
   public TokenStream create(TokenStream input) {
     return new PortugueseStemFilter(input);
   }
Index: solr/core/src/java/org/apache/solr/analysis/IndicNormalizationFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/IndicNormalizationFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/IndicNormalizationFilterFactory.java	(working copy)
@@ -19,6 +19,7 @@
 
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.in.IndicNormalizationFilter;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 /** 
  * Factory for {@link IndicNormalizationFilter}. 
@@ -31,7 +32,7 @@
  * &lt;/fieldType&gt;</pre>
  *
  */
-public class IndicNormalizationFilterFactory extends BaseTokenFilterFactory implements MultiTermAwareComponent {
+public class IndicNormalizationFilterFactory extends TokenFilterFactory implements MultiTermAwareComponent {
   public TokenStream create(TokenStream input) {
     return new IndicNormalizationFilter(input);
   }
Index: solr/core/src/java/org/apache/solr/analysis/GermanStemFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/GermanStemFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/GermanStemFilterFactory.java	(working copy)
@@ -21,6 +21,7 @@
 
 import org.apache.lucene.analysis.de.GermanStemFilter;
 import org.apache.lucene.analysis.TokenStream;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 /** 
  * Factory for {@link GermanStemFilter}. 
@@ -34,7 +35,7 @@
  * &lt;/fieldType&gt;</pre> 
  *
  */
-public class GermanStemFilterFactory extends BaseTokenFilterFactory {
+public class GermanStemFilterFactory extends TokenFilterFactory {
   public GermanStemFilter create(TokenStream in) {
     return new GermanStemFilter(in);
   }
Index: solr/core/src/java/org/apache/solr/analysis/TokenOffsetPayloadTokenFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/TokenOffsetPayloadTokenFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/TokenOffsetPayloadTokenFilterFactory.java	(working copy)
@@ -21,6 +21,7 @@
 
 import org.apache.lucene.analysis.payloads.TokenOffsetPayloadTokenFilter;
 import org.apache.lucene.analysis.TokenStream;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 /** 
  * Factory for {@link TokenOffsetPayloadTokenFilter}.
@@ -33,7 +34,7 @@
  * &lt;/fieldType&gt;</pre>
  *
  */
-public class TokenOffsetPayloadTokenFilterFactory extends BaseTokenFilterFactory {
+public class TokenOffsetPayloadTokenFilterFactory extends TokenFilterFactory {
   public TokenOffsetPayloadTokenFilter create(TokenStream input) {
     return new TokenOffsetPayloadTokenFilter(input);
   }
Index: solr/core/src/java/org/apache/solr/analysis/PorterStemFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/PorterStemFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/PorterStemFilterFactory.java	(working copy)
@@ -19,6 +19,7 @@
 
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.en.PorterStemFilter;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 /**
  * Factory for {@link PorterStemFilter}.
@@ -32,7 +33,7 @@
  * &lt;/fieldType&gt;</pre>
  *
  */
-public class PorterStemFilterFactory extends BaseTokenFilterFactory {
+public class PorterStemFilterFactory extends TokenFilterFactory {
   public PorterStemFilter create(TokenStream input) {
     return new PorterStemFilter(input);
   }
Index: solr/core/src/java/org/apache/solr/analysis/TokenizerFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/TokenizerFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/TokenizerFactory.java	(working copy)
@@ -1,72 +0,0 @@
-/**
- * Licensed to the Apache Software Foundation (ASF) under one or more
- * contributor license agreements.  See the NOTICE file distributed with
- * this work for additional information regarding copyright ownership.
- * The ASF licenses this file to You under the Apache License, Version 2.0
- * (the "License"); you may not use this file except in compliance with
- * the License.  You may obtain a copy of the License at
- *
- *     http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package org.apache.solr.analysis;
-
-import java.io.*;
-import java.util.Map;
-import org.apache.lucene.analysis.*;
-import org.apache.lucene.util.Version;
-
-
-/**
- * A <code>TokenizerFactory</code> breaks up a stream of characters 
- * into tokens.
- *
- * <p>
- * TokenizerFactories are registered for <code>FieldType</code>s with the
- * <code>IndexSchema</code> through the <code>schema.xml</code> file.
- * </p>
- * <p>
- * Example <code>schema.xml</code> entry to register a TokenizerFactory 
- * implementation to tokenize fields of type "cool"
- * </p>
- * <pre>
- *  &lt;fieldtype name="cool" class="solr.TextField"&gt;
- *      &lt;analyzer&gt;
- *      &lt;tokenizer class="solr.StandardTokenizerFactory"/&gt;
- *      ...
- * </pre>
- * <p>
- * A single instance of any registered TokenizerFactory is created
- * via the default constructor and is reused for each FieldType.
- * </p>
- *
- */
-public interface TokenizerFactory {
-  /** <code>init</code> will be called just once, immediately after creation.
-   * <p>The args are user-level initialization parameters that
-   * may be specified when declaring a the factory in the
-   * schema.xml
-   */
-  public void init(Map<String,String> args);
-
-  public void setLuceneMatchVersion(Version luceneMatchVersion);
-  
-  /**
-   * Accessor method for reporting the args used to initialize this factory.
-   * <p>
-   * Implementations are <strong>strongly</strong> encouraged to return 
-   * the contents of the Map passed to to the init method
-   * </p>
-   */
-  public Map<String,String> getArgs();
-  
-  /** Creates a TokenStream of the specified input */
-  public Tokenizer create(Reader input);
-}
-
Index: solr/core/src/java/org/apache/solr/analysis/PatternReplaceCharFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/PatternReplaceCharFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/PatternReplaceCharFilterFactory.java	(working copy)
@@ -23,6 +23,8 @@
 
 import org.apache.lucene.analysis.CharStream;
 import org.apache.lucene.analysis.pattern.PatternReplaceCharFilter;
+import org.apache.lucene.analysis.util.CharFilterFactory;
+import org.apache.lucene.analysis.util.InitializationException;
 
 /**
  * Factory for {@link PatternReplaceCharFilter}. 
@@ -38,7 +40,7 @@
  *
  * @since Solr 3.1
  */
-public class PatternReplaceCharFilterFactory extends BaseCharFilterFactory {
+public class PatternReplaceCharFilterFactory extends CharFilterFactory {
   
   private Pattern p;
   private String replacement;
Index: solr/core/src/java/org/apache/solr/analysis/KeywordTokenizerFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/KeywordTokenizerFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/KeywordTokenizerFactory.java	(working copy)
@@ -18,6 +18,7 @@
 package org.apache.solr.analysis;
 
 import org.apache.lucene.analysis.core.KeywordTokenizer;
+import org.apache.lucene.analysis.util.TokenizerFactory;
 
 import java.io.Reader;
 
@@ -31,7 +32,7 @@
  * &lt;/fieldType&gt;</pre> 
  *
  */
-public class KeywordTokenizerFactory extends BaseTokenizerFactory {
+public class KeywordTokenizerFactory extends TokenizerFactory {
   public KeywordTokenizer create(Reader input) {
     return new KeywordTokenizer(input);
   }
Index: solr/core/src/java/org/apache/solr/analysis/ArabicStemFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/ArabicStemFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/ArabicStemFilterFactory.java	(working copy)
@@ -18,6 +18,7 @@
 
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.ar.ArabicStemFilter;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 
 /**
@@ -32,7 +33,7 @@
  * &lt;/fieldType&gt;</pre>
  *
  */
-public class ArabicStemFilterFactory extends BaseTokenFilterFactory{
+public class ArabicStemFilterFactory extends TokenFilterFactory {
 
 
   public ArabicStemFilter create(TokenStream input) {
Index: solr/core/src/java/org/apache/solr/analysis/JapaneseKatakanaStemFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/JapaneseKatakanaStemFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/JapaneseKatakanaStemFilterFactory.java	(working copy)
@@ -19,6 +19,8 @@
 
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.ja.JapaneseKatakanaStemFilter;
+import org.apache.lucene.analysis.util.InitializationException;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 import java.util.Map;
 
@@ -34,7 +36,7 @@
  * &lt;/fieldType&gt;
  * </pre>
  */
-public class JapaneseKatakanaStemFilterFactory extends BaseTokenFilterFactory {
+public class JapaneseKatakanaStemFilterFactory extends TokenFilterFactory {
   private static final String MINIMUM_LENGTH_PARAM = "minimumLength";
   private int minimumLength;
   
Index: solr/core/src/java/org/apache/solr/analysis/CapitalizationFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/CapitalizationFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/CapitalizationFilterFactory.java	(working copy)
@@ -20,6 +20,7 @@
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.miscellaneous.CapitalizationFilter;
 import org.apache.lucene.analysis.util.CharArraySet;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 import java.util.ArrayList;
 import java.util.Collection;
@@ -56,7 +57,7 @@
  *
  * @since solr 1.3
  */
-public class CapitalizationFilterFactory extends BaseTokenFilterFactory {
+public class CapitalizationFilterFactory extends TokenFilterFactory {
   public static final String KEEP = "keep";
   public static final String KEEP_IGNORE_CASE = "keepIgnoreCase";
   public static final String OK_PREFIX = "okPrefix";
Index: solr/core/src/java/org/apache/solr/analysis/RemoveDuplicatesTokenFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/RemoveDuplicatesTokenFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/RemoveDuplicatesTokenFilterFactory.java	(working copy)
@@ -19,6 +19,7 @@
 
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.miscellaneous.RemoveDuplicatesTokenFilter;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 /**
  * Factory for {@link RemoveDuplicatesTokenFilter}.
@@ -31,7 +32,7 @@
  * &lt;/fieldType&gt;</pre>
  *
  */
-public class RemoveDuplicatesTokenFilterFactory extends BaseTokenFilterFactory {
+public class RemoveDuplicatesTokenFilterFactory extends TokenFilterFactory {
   public RemoveDuplicatesTokenFilter create(TokenStream input) {
     return new RemoveDuplicatesTokenFilter(input);
   }
Index: solr/core/src/java/org/apache/solr/analysis/NumericPayloadTokenFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/NumericPayloadTokenFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/NumericPayloadTokenFilterFactory.java	(working copy)
@@ -21,6 +21,7 @@
 
 import org.apache.lucene.analysis.payloads.NumericPayloadTokenFilter;
 import org.apache.lucene.analysis.TokenStream;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 import java.util.Map;
 
 /** 
@@ -34,7 +35,7 @@
  * &lt;/fieldType&gt;</pre>
  *
  */
-public class NumericPayloadTokenFilterFactory extends BaseTokenFilterFactory {
+public class NumericPayloadTokenFilterFactory extends TokenFilterFactory {
   private float payload;
   private String typeMatch;
   @Override
Index: solr/core/src/java/org/apache/solr/analysis/KeepWordFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/KeepWordFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/KeepWordFilterFactory.java	(working copy)
@@ -17,11 +17,9 @@
 
 package org.apache.solr.analysis;
 
-import org.apache.lucene.analysis.util.ResourceLoader;
-import org.apache.lucene.analysis.util.ResourceLoaderAware;
+import org.apache.lucene.analysis.util.*;
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.miscellaneous.KeepWordFilter;
-import org.apache.lucene.analysis.util.CharArraySet;
 
 import java.util.Map;
 import java.util.Set;
@@ -38,7 +36,7 @@
  * &lt;/fieldType&gt;</pre> 
  *
  */
-public class KeepWordFilterFactory extends BaseTokenFilterFactory implements ResourceLoaderAware {
+public class KeepWordFilterFactory extends TokenFilterFactory implements ResourceLoaderAware {
 
   @Override
   public void init(Map<String,String> args) {
Index: solr/core/src/java/org/apache/solr/analysis/TypeAsPayloadTokenFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/TypeAsPayloadTokenFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/TypeAsPayloadTokenFilterFactory.java	(working copy)
@@ -21,6 +21,7 @@
 
 import org.apache.lucene.analysis.payloads.TypeAsPayloadTokenFilter;
 import org.apache.lucene.analysis.TokenStream;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 /** 
  * Factory for {@link TypeAsPayloadTokenFilter}.
@@ -33,7 +34,7 @@
  * &lt;/fieldType&gt;</pre> 
  *
  */
-public class TypeAsPayloadTokenFilterFactory extends BaseTokenFilterFactory {
+public class TypeAsPayloadTokenFilterFactory extends TokenFilterFactory {
   public TypeAsPayloadTokenFilter create(TokenStream input) {
     return new TypeAsPayloadTokenFilter(input);
   }
Index: solr/core/src/java/org/apache/solr/analysis/ClassicFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/ClassicFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/ClassicFilterFactory.java	(working copy)
@@ -19,6 +19,7 @@
 
 import org.apache.lucene.analysis.TokenFilter;
 import org.apache.lucene.analysis.TokenStream;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 import org.apache.lucene.analysis.standard.ClassicFilter;
 
 /**
@@ -33,7 +34,7 @@
  *
  *
  */
-public class ClassicFilterFactory extends BaseTokenFilterFactory {
+public class ClassicFilterFactory extends TokenFilterFactory {
   public TokenFilter create(TokenStream input) {
     return new ClassicFilter(input);
   }
Index: solr/core/src/java/org/apache/solr/analysis/IrishLowerCaseFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/IrishLowerCaseFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/IrishLowerCaseFilterFactory.java	(working copy)
@@ -19,6 +19,7 @@
 
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.ga.IrishLowerCaseFilter;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 /** 
  * Factory for {@link IrishLowerCaseFilter}. 
@@ -31,7 +32,7 @@
  * &lt;/fieldType&gt;</pre>
  *
  */
-public class IrishLowerCaseFilterFactory extends BaseTokenFilterFactory implements MultiTermAwareComponent {
+public class IrishLowerCaseFilterFactory extends TokenFilterFactory implements MultiTermAwareComponent {
 
   @Override
   public TokenStream create(TokenStream input) {
Index: solr/core/src/java/org/apache/solr/analysis/LetterTokenizerFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/LetterTokenizerFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/LetterTokenizerFactory.java	(working copy)
@@ -18,6 +18,7 @@
 package org.apache.solr.analysis;
 
 import org.apache.lucene.analysis.core.LetterTokenizer;
+import org.apache.lucene.analysis.util.TokenizerFactory;
 
 import java.io.Reader;
 import java.util.Map;
@@ -32,7 +33,7 @@
  * &lt;/fieldType&gt;</pre> 
  *
  */
-public class LetterTokenizerFactory extends BaseTokenizerFactory {
+public class LetterTokenizerFactory extends TokenizerFactory {
 
   @Override
   public void init(Map<String,String> args) {
Index: solr/core/src/java/org/apache/solr/analysis/LowerCaseFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/LowerCaseFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/LowerCaseFilterFactory.java	(working copy)
@@ -21,6 +21,7 @@
 
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.core.LowerCaseFilter;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 /**
  * Factory for {@link LowerCaseFilter}. 
@@ -33,7 +34,7 @@
  * &lt;/fieldType&gt;</pre> 
  *
  */
-public class LowerCaseFilterFactory extends BaseTokenFilterFactory implements MultiTermAwareComponent {
+public class LowerCaseFilterFactory extends TokenFilterFactory implements MultiTermAwareComponent {
   @Override
   public void init(Map<String,String> args) {
     super.init(args);
Index: solr/core/src/java/org/apache/solr/analysis/StandardTokenizerFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/StandardTokenizerFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/StandardTokenizerFactory.java	(working copy)
@@ -19,6 +19,7 @@
 
 import org.apache.lucene.analysis.standard.StandardAnalyzer;
 import org.apache.lucene.analysis.standard.StandardTokenizer;
+import org.apache.lucene.analysis.util.TokenizerFactory;
 
 import java.io.Reader;
 import java.util.Map;
@@ -34,7 +35,7 @@
  *
  */
 
-public class StandardTokenizerFactory extends BaseTokenizerFactory {
+public class StandardTokenizerFactory extends TokenizerFactory {
   
   private int maxTokenLength;
   
Index: solr/core/src/java/org/apache/solr/analysis/KeywordMarkerFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/KeywordMarkerFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/KeywordMarkerFilterFactory.java	(working copy)
@@ -3,10 +3,8 @@
 import java.io.IOException;
 
 import org.apache.lucene.analysis.miscellaneous.KeywordMarkerFilter;
-import org.apache.lucene.analysis.util.CharArraySet;
+import org.apache.lucene.analysis.util.*;
 import org.apache.lucene.analysis.TokenStream;
-import org.apache.lucene.analysis.util.ResourceLoader;
-import org.apache.lucene.analysis.util.ResourceLoaderAware;
 
 /**
  * Licensed to the Apache Software Foundation (ASF) under one or more
@@ -36,7 +34,7 @@
  * &lt;/fieldType&gt;</pre> 
  *
  */
-public class KeywordMarkerFilterFactory extends BaseTokenFilterFactory implements ResourceLoaderAware {
+public class KeywordMarkerFilterFactory extends TokenFilterFactory implements ResourceLoaderAware {
   public static final String PROTECTED_TOKENS = "protected";
   private CharArraySet protectedWords;
   private boolean ignoreCase;
Index: solr/core/src/java/org/apache/solr/analysis/LimitTokenCountFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/LimitTokenCountFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/LimitTokenCountFilterFactory.java	(working copy)
@@ -21,6 +21,7 @@
 
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.miscellaneous.LimitTokenCountFilter;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 /**
  * Factory for {@link LimitTokenCountFilter}. 
@@ -33,7 +34,7 @@
  * &lt;/fieldType&gt;</pre> 
  *
  */
-public class LimitTokenCountFilterFactory extends BaseTokenFilterFactory {
+public class LimitTokenCountFilterFactory extends TokenFilterFactory {
 
   int maxTokenCount;
 
Index: solr/core/src/java/org/apache/solr/analysis/ShingleFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/ShingleFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/ShingleFilterFactory.java	(working copy)
@@ -21,6 +21,8 @@
 
 import org.apache.lucene.analysis.shingle.ShingleFilter;
 import org.apache.lucene.analysis.TokenStream;
+import org.apache.lucene.analysis.util.InitializationException;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 import java.util.Map;
 
@@ -36,7 +38,7 @@
  * &lt;/fieldType&gt;</pre>
  *
  */
-public class ShingleFilterFactory extends BaseTokenFilterFactory {
+public class ShingleFilterFactory extends TokenFilterFactory {
   private int minShingleSize;
   private int maxShingleSize;
   private boolean outputUnigrams;
Index: solr/core/src/java/org/apache/solr/analysis/HungarianLightStemFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/HungarianLightStemFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/HungarianLightStemFilterFactory.java	(working copy)
@@ -19,6 +19,7 @@
 
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.hu.HungarianLightStemFilter;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 /** 
  * Factory for {@link HungarianLightStemFilter}. 
@@ -32,7 +33,7 @@
  * &lt;/fieldType&gt;</pre> 
  *
  */
-public class HungarianLightStemFilterFactory extends BaseTokenFilterFactory {
+public class HungarianLightStemFilterFactory extends TokenFilterFactory {
   public TokenStream create(TokenStream input) {
     return new HungarianLightStemFilter(input);
   }
Index: solr/core/src/java/org/apache/solr/analysis/TurkishLowerCaseFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/TurkishLowerCaseFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/TurkishLowerCaseFilterFactory.java	(working copy)
@@ -19,6 +19,7 @@
 
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.tr.TurkishLowerCaseFilter;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 /** 
  * Factory for {@link TurkishLowerCaseFilter}.
@@ -31,7 +32,7 @@
  * &lt;/fieldType&gt;</pre> 
  *
  */
-public class TurkishLowerCaseFilterFactory extends BaseTokenFilterFactory  implements MultiTermAwareComponent {
+public class TurkishLowerCaseFilterFactory extends TokenFilterFactory  implements MultiTermAwareComponent {
   public TokenStream create(TokenStream input) {
     return new TurkishLowerCaseFilter(input);
   }
Index: solr/core/src/java/org/apache/solr/analysis/JapanesePartOfSpeechStopFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/JapanesePartOfSpeechStopFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/JapanesePartOfSpeechStopFilterFactory.java	(working copy)
@@ -23,9 +23,7 @@
 
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.ja.JapanesePartOfSpeechStopFilter;
-import org.apache.lucene.analysis.util.CharArraySet;
-import org.apache.lucene.analysis.util.ResourceLoader;
-import org.apache.lucene.analysis.util.ResourceLoaderAware;
+import org.apache.lucene.analysis.util.*;
 
 /**
  * Factory for {@link org.apache.lucene.analysis.ja.JapanesePartOfSpeechStopFilter}.
@@ -40,7 +38,7 @@
  * &lt;/fieldType&gt;
  * </pre>
  */
-public class JapanesePartOfSpeechStopFilterFactory extends BaseTokenFilterFactory implements ResourceLoaderAware  {
+public class JapanesePartOfSpeechStopFilterFactory extends TokenFilterFactory implements ResourceLoaderAware  {
   private boolean enablePositionIncrements;
   private Set<String> stopTags;
 
Index: solr/core/src/java/org/apache/solr/analysis/GalicianStemFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/GalicianStemFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/GalicianStemFilterFactory.java	(working copy)
@@ -19,6 +19,7 @@
 
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.gl.GalicianStemFilter;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 /**
  * Factory for {@link GalicianStemFilter}. 
@@ -32,7 +33,7 @@
  * &lt;/fieldType&gt;</pre> 
  *
  */
-public class GalicianStemFilterFactory extends BaseTokenFilterFactory {
+public class GalicianStemFilterFactory extends TokenFilterFactory {
   public TokenStream create(TokenStream input) {
     return new GalicianStemFilter(input);
   }
Index: solr/core/src/java/org/apache/solr/analysis/ElisionFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/ElisionFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/ElisionFilterFactory.java	(working copy)
@@ -19,10 +19,8 @@
 
 package org.apache.solr.analysis;
 
-import org.apache.lucene.analysis.util.ResourceLoader;
-import org.apache.lucene.analysis.util.ResourceLoaderAware;
+import org.apache.lucene.analysis.util.*;
 import org.apache.lucene.analysis.fr.*;
-import org.apache.lucene.analysis.util.CharArraySet;
 
 import java.io.IOException;
 import org.apache.lucene.analysis.TokenStream;
@@ -40,7 +38,7 @@
  * &lt;/fieldType&gt;</pre>
  *
  */
-public class ElisionFilterFactory extends BaseTokenFilterFactory implements ResourceLoaderAware {
+public class ElisionFilterFactory extends TokenFilterFactory implements ResourceLoaderAware {
 
   private CharArraySet articles;
 
Index: solr/core/src/java/org/apache/solr/analysis/ReverseStringFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/ReverseStringFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/ReverseStringFilterFactory.java	(working copy)
@@ -19,6 +19,7 @@
 
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.reverse.ReverseStringFilter;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 /**
  * Factory for {@link ReverseStringFilter}.
@@ -33,7 +34,7 @@
  *
  * @since solr 1.4
  */
-public class ReverseStringFilterFactory extends BaseTokenFilterFactory {
+public class ReverseStringFilterFactory extends TokenFilterFactory {
   public ReverseStringFilter create(TokenStream in) {
     assureMatchVersion();
     return new ReverseStringFilter(luceneMatchVersion,in);
Index: solr/core/src/java/org/apache/solr/analysis/JapaneseReadingFormFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/JapaneseReadingFormFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/JapaneseReadingFormFilterFactory.java	(working copy)
@@ -19,6 +19,7 @@
 
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.ja.JapaneseReadingFormFilter;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 import java.util.Map;
 
@@ -34,7 +35,7 @@
  * &lt;/fieldType&gt;
  * </pre>
  */
-public class JapaneseReadingFormFilterFactory extends BaseTokenFilterFactory {
+public class JapaneseReadingFormFilterFactory extends TokenFilterFactory {
   private static final String ROMAJI_PARAM = "useRomaji";
   private boolean useRomaji;
   
Index: solr/core/src/java/org/apache/solr/analysis/RussianLightStemFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/RussianLightStemFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/RussianLightStemFilterFactory.java	(working copy)
@@ -19,6 +19,7 @@
 
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.ru.RussianLightStemFilter;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 /** 
  * Factory for {@link RussianLightStemFilter}.
@@ -32,7 +33,7 @@
  * &lt;/fieldType&gt;</pre>
  *
  */
-public class RussianLightStemFilterFactory extends BaseTokenFilterFactory {
+public class RussianLightStemFilterFactory extends TokenFilterFactory {
   public TokenStream create(TokenStream input) {
     return new RussianLightStemFilter(input);
   }
Index: solr/core/src/java/org/apache/solr/analysis/DictionaryCompoundWordTokenFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/DictionaryCompoundWordTokenFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/DictionaryCompoundWordTokenFilterFactory.java	(working copy)
@@ -19,9 +19,7 @@
 
 package org.apache.solr.analysis;
 import org.apache.lucene.analysis.compound.*;
-import org.apache.lucene.analysis.util.CharArraySet;
-import org.apache.lucene.analysis.util.ResourceLoaderAware;
-import org.apache.lucene.analysis.util.ResourceLoader;
+import org.apache.lucene.analysis.util.*;
 import org.apache.lucene.analysis.TokenStream;
 
 import java.util.Map;
@@ -39,7 +37,7 @@
  * &lt;/fieldType&gt;</pre>
  *
  */
-public class DictionaryCompoundWordTokenFilterFactory extends BaseTokenFilterFactory  implements ResourceLoaderAware {
+public class DictionaryCompoundWordTokenFilterFactory extends TokenFilterFactory  implements ResourceLoaderAware {
   private CharArraySet dictionary;
   private String dictFile;
   private int minWordSize;
Index: solr/core/src/java/org/apache/solr/analysis/CommonGramsQueryFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/CommonGramsQueryFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/CommonGramsQueryFilterFactory.java	(working copy)
@@ -23,9 +23,7 @@
 import org.apache.lucene.analysis.commongrams.CommonGramsFilter;
 import org.apache.lucene.analysis.commongrams.CommonGramsQueryFilter;
 import org.apache.lucene.analysis.core.StopAnalyzer;
-import org.apache.lucene.analysis.util.CharArraySet;
-import org.apache.lucene.analysis.util.ResourceLoader;
-import org.apache.lucene.analysis.util.ResourceLoaderAware;
+import org.apache.lucene.analysis.util.*;
 
 /**
  * Construct {@link CommonGramsQueryFilter}.
@@ -41,7 +39,7 @@
  * &lt;/fieldType&gt;</pre>
  *
  */
-public class CommonGramsQueryFilterFactory extends BaseTokenFilterFactory
+public class CommonGramsQueryFilterFactory extends TokenFilterFactory
     implements ResourceLoaderAware {
 
   @Override
Index: solr/core/src/java/org/apache/solr/analysis/LegacyHTMLStripCharFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/LegacyHTMLStripCharFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/LegacyHTMLStripCharFilterFactory.java	(working copy)
@@ -19,6 +19,7 @@
  */
 
 import org.apache.lucene.analysis.CharStream;
+import org.apache.lucene.analysis.util.CharFilterFactory;
 
 /**
  * Factory for {@link LegacyHTMLStripCharFilter}.
@@ -49,7 +50,7 @@
  * @deprecated use {@link HTMLStripCharFilterFactory}
  */
 @Deprecated
-public class LegacyHTMLStripCharFilterFactory extends BaseCharFilterFactory {
+public class LegacyHTMLStripCharFilterFactory extends CharFilterFactory {
 
   public LegacyHTMLStripCharFilter create(CharStream input) {
     return new LegacyHTMLStripCharFilter(input);
Index: solr/core/src/java/org/apache/solr/analysis/PhoneticFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/PhoneticFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/PhoneticFilterFactory.java	(working copy)
@@ -27,6 +27,8 @@
 import org.apache.commons.codec.language.*;
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.phonetic.PhoneticFilter;
+import org.apache.lucene.analysis.util.InitializationException;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 /**
  * Factory for {@link PhoneticFilter}.
@@ -55,7 +57,7 @@
  * 
  * @see PhoneticFilter
  */
-public class PhoneticFilterFactory extends BaseTokenFilterFactory 
+public class PhoneticFilterFactory extends TokenFilterFactory
 {
   public static final String ENCODER = "encoder";
   public static final String INJECT = "inject"; // boolean
Index: solr/core/src/java/org/apache/solr/analysis/NorwegianLightStemFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/NorwegianLightStemFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/NorwegianLightStemFilterFactory.java	(working copy)
@@ -19,6 +19,7 @@
 
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.no.NorwegianLightStemFilter;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 /** 
  * Factory for {@link NorwegianLightStemFilter}.
@@ -31,7 +32,7 @@
  *   &lt;/analyzer&gt;
  * &lt;/fieldType&gt;</pre>
  */
-public class NorwegianLightStemFilterFactory extends BaseTokenFilterFactory {
+public class NorwegianLightStemFilterFactory extends TokenFilterFactory {
   public TokenStream create(TokenStream input) {
     return new NorwegianLightStemFilter(input);
   }
Index: solr/core/src/java/org/apache/solr/analysis/WordDelimiterFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/WordDelimiterFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/WordDelimiterFilterFactory.java	(working copy)
@@ -20,10 +20,8 @@
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.miscellaneous.WordDelimiterFilter;
 import org.apache.lucene.analysis.miscellaneous.WordDelimiterIterator;
-import org.apache.lucene.analysis.util.CharArraySet;
+import org.apache.lucene.analysis.util.*;
 
-import org.apache.lucene.analysis.util.ResourceLoaderAware;
-import org.apache.lucene.analysis.util.ResourceLoader;
 import org.apache.solr.common.util.StrUtils;
 
 import java.util.ArrayList;
@@ -53,7 +51,7 @@
  * &lt;/fieldType&gt;</pre> 
  *
  */
-public class WordDelimiterFilterFactory extends BaseTokenFilterFactory implements ResourceLoaderAware {
+public class WordDelimiterFilterFactory extends TokenFilterFactory implements ResourceLoaderAware {
   public static final String PROTECTED_TOKENS = "protected";
   public static final String TYPES = "types";
   
Index: solr/core/src/java/org/apache/solr/analysis/DelimitedPayloadTokenFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/DelimitedPayloadTokenFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/DelimitedPayloadTokenFilterFactory.java	(working copy)
@@ -22,8 +22,10 @@
 import org.apache.lucene.analysis.payloads.FloatEncoder;
 import org.apache.lucene.analysis.payloads.IntegerEncoder;
 import org.apache.lucene.analysis.payloads.IdentityEncoder;
+import org.apache.lucene.analysis.util.InitializationException;
 import org.apache.lucene.analysis.util.ResourceLoader;
 import org.apache.lucene.analysis.util.ResourceLoaderAware;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 import java.util.Map;
 
@@ -41,7 +43,7 @@
  *
  * 
  */
-public class DelimitedPayloadTokenFilterFactory extends BaseTokenFilterFactory implements ResourceLoaderAware {
+public class DelimitedPayloadTokenFilterFactory extends TokenFilterFactory implements ResourceLoaderAware {
   public static final String ENCODER_ATTR = "encoder";
   public static final String DELIMITER_ATTR = "delimiter";
 
Index: solr/core/src/java/org/apache/solr/analysis/StemmerOverrideFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/StemmerOverrideFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/StemmerOverrideFilterFactory.java	(working copy)
@@ -22,10 +22,8 @@
 
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.miscellaneous.StemmerOverrideFilter;
-import org.apache.lucene.analysis.util.CharArrayMap;
-import org.apache.lucene.analysis.util.ResourceLoader;
+import org.apache.lucene.analysis.util.*;
 import org.apache.solr.common.util.StrUtils;
-import org.apache.lucene.analysis.util.ResourceLoaderAware;
 
 /**
  * Factory for {@link StemmerOverrideFilter}.
@@ -38,7 +36,7 @@
  * &lt;/fieldType&gt;</pre>
  *
  */
-public class StemmerOverrideFilterFactory extends BaseTokenFilterFactory implements ResourceLoaderAware {
+public class StemmerOverrideFilterFactory extends TokenFilterFactory implements ResourceLoaderAware {
   private CharArrayMap<String> dictionary = null;
   private boolean ignoreCase;
 
Index: solr/core/src/java/org/apache/solr/analysis/SnowballPorterFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/SnowballPorterFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/SnowballPorterFilterFactory.java	(working copy)
@@ -23,9 +23,7 @@
 import org.apache.lucene.analysis.TokenFilter;
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.snowball.SnowballFilter;
-import org.apache.lucene.analysis.util.CharArraySet;
-import org.apache.lucene.analysis.util.ResourceLoader;
-import org.apache.lucene.analysis.util.ResourceLoaderAware;
+import org.apache.lucene.analysis.util.*;
 import org.tartarus.snowball.SnowballProgram;
 
 /**
@@ -43,7 +41,7 @@
  * 
  *
  */
-public class SnowballPorterFilterFactory extends BaseTokenFilterFactory implements ResourceLoaderAware {
+public class SnowballPorterFilterFactory extends TokenFilterFactory implements ResourceLoaderAware {
   public static final String PROTECTED_TOKENS = "protected";
 
   private String language = "English";
Index: solr/core/src/java/org/apache/solr/analysis/ChineseFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/ChineseFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/ChineseFilterFactory.java	(working copy)
@@ -22,6 +22,7 @@
 
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.cn.ChineseFilter;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
 
@@ -30,7 +31,7 @@
  * @deprecated Use {@link StopFilterFactory} instead.
  */
 @Deprecated
-public class ChineseFilterFactory extends BaseTokenFilterFactory {
+public class ChineseFilterFactory extends TokenFilterFactory {
 
   private static final Logger log = LoggerFactory.getLogger(ChineseFilterFactory.class);
 
Index: solr/core/src/java/org/apache/solr/analysis/EdgeNGramTokenizerFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/EdgeNGramTokenizerFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/EdgeNGramTokenizerFactory.java	(working copy)
@@ -18,6 +18,7 @@
  */
 
 import org.apache.lucene.analysis.ngram.EdgeNGramTokenizer;
+import org.apache.lucene.analysis.util.TokenizerFactory;
 
 import java.io.Reader;
 import java.util.Map;
@@ -32,7 +33,7 @@
  * &lt;/fieldType&gt;</pre>
  *
  */
-public class EdgeNGramTokenizerFactory extends BaseTokenizerFactory {
+public class EdgeNGramTokenizerFactory extends TokenizerFactory {
     private int maxGramSize = 0;
 
     private int minGramSize = 0;
Index: solr/core/src/java/org/apache/solr/analysis/FinnishLightStemFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/FinnishLightStemFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/FinnishLightStemFilterFactory.java	(working copy)
@@ -19,6 +19,7 @@
 
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.fi.FinnishLightStemFilter;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 /** 
  * Factory for {@link FinnishLightStemFilter}.
@@ -32,7 +33,7 @@
  * &lt;/fieldType&gt;</pre> 
  *
  */
-public class FinnishLightStemFilterFactory extends BaseTokenFilterFactory {
+public class FinnishLightStemFilterFactory extends TokenFilterFactory {
   public TokenStream create(TokenStream input) {
     return new FinnishLightStemFilter(input);
   }
Index: solr/core/src/java/org/apache/solr/analysis/GermanNormalizationFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/GermanNormalizationFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/GermanNormalizationFilterFactory.java	(working copy)
@@ -19,6 +19,7 @@
 
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.de.GermanNormalizationFilter;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 /**
  * Factory for {@link GermanNormalizationFilter}.
@@ -31,7 +32,7 @@
  *   &lt;/analyzer&gt;
  * &lt;/fieldType&gt;</pre> 
  */
-public class GermanNormalizationFilterFactory extends BaseTokenFilterFactory implements MultiTermAwareComponent {
+public class GermanNormalizationFilterFactory extends TokenFilterFactory implements MultiTermAwareComponent {
 
   public TokenStream create(TokenStream input) {
     return new GermanNormalizationFilter(input);
Index: solr/core/src/java/org/apache/solr/analysis/SlowSynonymFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/SlowSynonymFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/SlowSynonymFilterFactory.java	(working copy)
@@ -19,9 +19,8 @@
 
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.tokenattributes.CharTermAttribute;
-import org.apache.lucene.analysis.util.ResourceLoader;
+import org.apache.lucene.analysis.util.*;
 import org.apache.solr.common.util.StrUtils;
-import org.apache.lucene.analysis.util.ResourceLoaderAware;
 
 import java.io.File;
 import java.io.IOException;
@@ -29,7 +28,6 @@
 import java.io.StringReader;
 import java.util.ArrayList;
 import java.util.List;
-import java.util.Map;
 
 /**
  * Factory for {@link SlowSynonymFilter} (only used with luceneMatchVersion < 3.4)
@@ -44,7 +42,7 @@
  * @deprecated (3.4) use {@link SynonymFilterFactory} instead. only for precise index backwards compatibility. this factory will be removed in Lucene 5.0
  */
 @Deprecated
-final class SlowSynonymFilterFactory extends BaseTokenFilterFactory implements ResourceLoaderAware {
+final class SlowSynonymFilterFactory extends TokenFilterFactory implements ResourceLoaderAware {
 
   public void inform(ResourceLoader loader) {
     String synonyms = args.get("synonyms");
Index: solr/core/src/java/org/apache/solr/analysis/SlowSynonymMap.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/SlowSynonymMap.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/SlowSynonymMap.java	(working copy)
@@ -19,6 +19,7 @@
 
 import org.apache.lucene.analysis.Token;
 import org.apache.lucene.analysis.util.CharArrayMap;
+import org.apache.lucene.analysis.util.InitializationException;
 import org.apache.lucene.util.Version;
 
 import java.util.*;
Index: solr/core/src/java/org/apache/solr/analysis/WhitespaceTokenizerFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/WhitespaceTokenizerFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/WhitespaceTokenizerFactory.java	(working copy)
@@ -18,6 +18,7 @@
 package org.apache.solr.analysis;
 
 import org.apache.lucene.analysis.core.WhitespaceTokenizer;
+import org.apache.lucene.analysis.util.TokenizerFactory;
 
 import java.io.Reader;
 import java.util.Map;
@@ -32,7 +33,7 @@
  * &lt;/fieldType&gt;</pre> 
  *
  */
-public class WhitespaceTokenizerFactory extends BaseTokenizerFactory {
+public class WhitespaceTokenizerFactory extends TokenizerFactory {
   @Override
   public void init(Map<String,String> args) {
     super.init(args);
Index: solr/core/src/java/org/apache/solr/analysis/KStemFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/KStemFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/KStemFilterFactory.java	(working copy)
@@ -20,11 +20,12 @@
 import org.apache.lucene.analysis.TokenFilter;
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.en.KStemFilter;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 /**
  * Factory for {@link KStemFilter}
  */
-public class KStemFilterFactory extends BaseTokenFilterFactory {
+public class KStemFilterFactory extends TokenFilterFactory {
 
   public TokenFilter create(TokenStream input) {
     return new KStemFilter(input);
Index: solr/core/src/java/org/apache/solr/analysis/HTMLStripCharFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/HTMLStripCharFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/HTMLStripCharFilterFactory.java	(working copy)
@@ -20,6 +20,7 @@
 
 import org.apache.lucene.analysis.CharStream;
 import org.apache.lucene.analysis.charfilter.HTMLStripCharFilter;
+import org.apache.lucene.analysis.util.CharFilterFactory;
 
 import java.util.HashSet;
 import java.util.Map;
@@ -38,7 +39,7 @@
  * &lt;/fieldType&gt;</pre>
  *
  */
- public class HTMLStripCharFilterFactory extends BaseCharFilterFactory {
+ public class HTMLStripCharFilterFactory extends CharFilterFactory {
   
   Set<String> escapedTags = null;
   Pattern TAG_NAME_PATTERN = Pattern.compile("[^\\s,]+");
Index: solr/core/src/java/org/apache/solr/analysis/CzechStemFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/CzechStemFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/CzechStemFilterFactory.java	(working copy)
@@ -19,6 +19,7 @@
 
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.cz.CzechStemFilter;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 /**
  *  Factory for {@link CzechStemFilter}.
@@ -31,7 +32,7 @@
  *   &lt;/analyzer&gt;
  * &lt;/fieldType&gt;</pre>
  */
-public class CzechStemFilterFactory extends BaseTokenFilterFactory {
+public class CzechStemFilterFactory extends TokenFilterFactory {
   public TokenStream create(TokenStream input) {
     return new CzechStemFilter(input);
   }
Index: solr/core/src/java/org/apache/solr/analysis/StopFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/StopFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/StopFilterFactory.java	(working copy)
@@ -17,12 +17,10 @@
 
 package org.apache.solr.analysis;
 
-import org.apache.lucene.analysis.util.ResourceLoader;
-import org.apache.lucene.analysis.util.ResourceLoaderAware;
+import org.apache.lucene.analysis.util.*;
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.core.StopAnalyzer;
 import org.apache.lucene.analysis.core.StopFilter;
-import org.apache.lucene.analysis.util.CharArraySet;
 
 import java.util.Map;
 import java.io.IOException;
@@ -39,7 +37,7 @@
  * &lt;/fieldType&gt;</pre>
  *
  */
-public class StopFilterFactory extends BaseTokenFilterFactory implements ResourceLoaderAware {
+public class StopFilterFactory extends TokenFilterFactory implements ResourceLoaderAware {
 
   @Override
   public void init(Map<String,String> args) {
Index: solr/core/src/java/org/apache/solr/analysis/GreekStemFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/GreekStemFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/GreekStemFilterFactory.java	(working copy)
@@ -19,6 +19,7 @@
 
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.el.GreekStemFilter;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 /** 
  * Factory for {@link GreekStemFilter}. 
@@ -32,7 +33,7 @@
  * &lt;/fieldType&gt;</pre>
  *
  */
-public class GreekStemFilterFactory extends BaseTokenFilterFactory {
+public class GreekStemFilterFactory extends TokenFilterFactory {
 
   public TokenStream create(TokenStream input) {
     return new GreekStemFilter(input);
Index: solr/core/src/java/org/apache/solr/analysis/ArabicLetterTokenizerFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/ArabicLetterTokenizerFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/ArabicLetterTokenizerFactory.java	(working copy)
@@ -17,6 +17,7 @@
  */
 
 import org.apache.lucene.analysis.ar.ArabicLetterTokenizer;
+import org.apache.lucene.analysis.util.TokenizerFactory;
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
 
@@ -29,7 +30,7 @@
  * @deprecated (3.1) Use StandardTokenizerFactory instead.
  **/
 @Deprecated
-public class ArabicLetterTokenizerFactory extends BaseTokenizerFactory{
+public class ArabicLetterTokenizerFactory extends TokenizerFactory {
 
   private static final Logger log = LoggerFactory.getLogger(ArabicLetterTokenizerFactory.class);
 
Index: solr/core/src/java/org/apache/solr/analysis/HyphenationCompoundWordTokenFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/HyphenationCompoundWordTokenFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/HyphenationCompoundWordTokenFilterFactory.java	(working copy)
@@ -22,10 +22,7 @@
 import org.apache.lucene.analysis.compound.CompoundWordTokenFilterBase;
 import org.apache.lucene.analysis.compound.HyphenationCompoundWordTokenFilter;
 import org.apache.lucene.analysis.compound.hyphenation.HyphenationTree;
-import org.apache.lucene.analysis.util.CharArraySet;
-import org.apache.solr.analysis.BaseTokenFilterFactory;
-import org.apache.lucene.analysis.util.ResourceLoader;
-import org.apache.lucene.analysis.util.ResourceLoaderAware;
+import org.apache.lucene.analysis.util.*;
 
 import java.util.Map;
 import java.io.InputStream;
@@ -58,7 +55,7 @@
  *
  * @see HyphenationCompoundWordTokenFilter
  */
-public class HyphenationCompoundWordTokenFilterFactory extends BaseTokenFilterFactory implements ResourceLoaderAware {
+public class HyphenationCompoundWordTokenFilterFactory extends TokenFilterFactory implements ResourceLoaderAware {
   private CharArraySet dictionary;
   private HyphenationTree hyphenator;
   private String dictFile;
Index: solr/core/src/java/org/apache/solr/analysis/ArabicNormalizationFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/ArabicNormalizationFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/ArabicNormalizationFilterFactory.java	(working copy)
@@ -18,6 +18,7 @@
 
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.ar.ArabicNormalizationFilter;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 
 /**
@@ -31,7 +32,7 @@
  * &lt;/fieldType&gt;</pre>
  *
  */
-public class ArabicNormalizationFilterFactory extends BaseTokenFilterFactory implements MultiTermAwareComponent {
+public class ArabicNormalizationFilterFactory extends TokenFilterFactory implements MultiTermAwareComponent {
 
   public ArabicNormalizationFilter create(TokenStream input) {
     return new ArabicNormalizationFilter(input);
Index: solr/core/src/java/org/apache/solr/analysis/TrieTokenizerFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/TrieTokenizerFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/TrieTokenizerFactory.java	(working copy)
@@ -19,6 +19,7 @@
 import org.apache.lucene.analysis.NumericTokenStream;
 import org.apache.lucene.analysis.tokenattributes.OffsetAttribute;
 import org.apache.lucene.analysis.Tokenizer;
+import org.apache.lucene.analysis.util.TokenizerFactory;
 import org.apache.solr.common.SolrException;
 import org.apache.solr.schema.DateField;
 import static org.apache.solr.schema.TrieField.TrieTypes;
@@ -38,7 +39,7 @@
  * @see org.apache.solr.schema.TrieField
  * @since solr 1.4
  */
-public class TrieTokenizerFactory extends BaseTokenizerFactory {
+public class TrieTokenizerFactory extends TokenizerFactory {
   protected final int precisionStep;
   protected final TrieTypes type;
 
Index: solr/core/src/java/org/apache/solr/analysis/CJKBigramFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/CJKBigramFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/CJKBigramFilterFactory.java	(working copy)
@@ -21,6 +21,7 @@
 
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.cjk.CJKBigramFilter;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 /** 
  * Factory for {@link CJKBigramFilter}.
@@ -36,7 +37,7 @@
  *   &lt;/analyzer&gt;
  * &lt;/fieldType&gt;</pre>
  */
-public class CJKBigramFilterFactory extends BaseTokenFilterFactory {
+public class CJKBigramFilterFactory extends TokenFilterFactory {
   int flags;
 
   @Override
Index: solr/core/src/java/org/apache/solr/analysis/NGramTokenizerFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/NGramTokenizerFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/NGramTokenizerFactory.java	(working copy)
@@ -19,6 +19,7 @@
 
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.ngram.NGramTokenizer;
+import org.apache.lucene.analysis.util.TokenizerFactory;
 
 import java.io.Reader;
 import java.util.Map;
@@ -33,7 +34,7 @@
  * &lt;/fieldType&gt;</pre> 
  *
  */
-public class NGramTokenizerFactory extends BaseTokenizerFactory {
+public class NGramTokenizerFactory extends TokenizerFactory {
     private int maxGramSize = 0;
     private int minGramSize = 0;
     
Index: solr/core/src/java/org/apache/solr/analysis/NorwegianMinimalStemFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/NorwegianMinimalStemFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/NorwegianMinimalStemFilterFactory.java	(working copy)
@@ -19,6 +19,7 @@
 
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.no.NorwegianMinimalStemFilter;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 /** 
  * Factory for {@link NorwegianMinimalStemFilter}.
@@ -31,7 +32,7 @@
  *   &lt;/analyzer&gt;
  * &lt;/fieldType&gt;</pre>
  */
-public class NorwegianMinimalStemFilterFactory extends BaseTokenFilterFactory {
+public class NorwegianMinimalStemFilterFactory extends TokenFilterFactory {
   public TokenStream create(TokenStream input) {
     return new NorwegianMinimalStemFilter(input);
   }
Index: solr/core/src/java/org/apache/solr/analysis/WikipediaTokenizerFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/WikipediaTokenizerFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/WikipediaTokenizerFactory.java	(working copy)
@@ -20,6 +20,7 @@
 import java.io.Reader;
 
 import org.apache.lucene.analysis.Tokenizer;
+import org.apache.lucene.analysis.util.TokenizerFactory;
 import org.apache.lucene.analysis.wikipedia.WikipediaTokenizer;
 
 /** 
@@ -32,7 +33,7 @@
  * &lt;/fieldType&gt;</pre> 
  *
  */
-public class WikipediaTokenizerFactory extends BaseTokenizerFactory {
+public class WikipediaTokenizerFactory extends TokenizerFactory {
   // TODO: add support for WikipediaTokenizer's advanced options.
   public Tokenizer create(Reader input) {
     return new WikipediaTokenizer(input);
Index: solr/core/src/java/org/apache/solr/analysis/BaseTokenizerFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/BaseTokenizerFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/BaseTokenizerFactory.java	(working copy)
@@ -1,27 +0,0 @@
-/**
- * Licensed to the Apache Software Foundation (ASF) under one or more
- * contributor license agreements.  See the NOTICE file distributed with
- * this work for additional information regarding copyright ownership.
- * The ASF licenses this file to You under the Apache License, Version 2.0
- * (the "License"); you may not use this file except in compliance with
- * the License.  You may obtain a copy of the License at
- *
- *     http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package org.apache.solr.analysis;
-
-/**
- * Simple abstract implementation that handles init arg processing.
- * 
- *
- */
-public abstract class BaseTokenizerFactory extends BaseTokenStreamFactory implements TokenizerFactory {
-
-}
Index: solr/core/src/java/org/apache/solr/analysis/PersianCharFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/PersianCharFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/PersianCharFilterFactory.java	(working copy)
@@ -19,6 +19,7 @@
 
 import org.apache.lucene.analysis.CharStream;
 import org.apache.lucene.analysis.fa.PersianCharFilter;
+import org.apache.lucene.analysis.util.CharFilterFactory;
 
 /**
  * Factory for {@link PersianCharFilter}.
@@ -31,7 +32,7 @@
  * &lt;/fieldType&gt;</pre>
  *
  */
-public class PersianCharFilterFactory extends BaseCharFilterFactory implements MultiTermAwareComponent {
+public class PersianCharFilterFactory extends CharFilterFactory implements MultiTermAwareComponent {
 
   @Override
   public CharStream create(CharStream input) {
Index: solr/core/src/java/org/apache/solr/analysis/BeiderMorseFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/BeiderMorseFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/BeiderMorseFilterFactory.java	(working copy)
@@ -27,6 +27,7 @@
 import org.apache.commons.codec.language.bm.RuleType;
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.phonetic.BeiderMorseFilter;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 /** 
  * Factory for {@link BeiderMorseFilter}.
@@ -42,7 +43,7 @@
  * &lt;/fieldType&gt;</pre>
  *
  */
-public class BeiderMorseFilterFactory extends BaseTokenFilterFactory {
+public class BeiderMorseFilterFactory extends TokenFilterFactory {
   private PhoneticEngine engine;
   private LanguageSet languageSet;
   
Index: solr/core/src/java/org/apache/solr/analysis/StandardFilterFactory.java
===================================================================
--- solr/core/src/java/org/apache/solr/analysis/StandardFilterFactory.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/analysis/StandardFilterFactory.java	(working copy)
@@ -21,6 +21,7 @@
 
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.standard.StandardFilter;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 /**
  * Factory for {@link StandardFilter}.
@@ -33,7 +34,7 @@
  * &lt;/fieldType&gt;</pre>
  *
  */
-public class StandardFilterFactory extends BaseTokenFilterFactory {
+public class StandardFilterFactory extends TokenFilterFactory {
   @Override
   public void init(Map<String,String> args) {
     super.init(args);
Index: solr/core/src/java/org/apache/solr/core/SolrResourceLoader.java
===================================================================
--- solr/core/src/java/org/apache/solr/core/SolrResourceLoader.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/core/SolrResourceLoader.java	(working copy)
@@ -30,7 +30,10 @@
 import java.util.*;
 import java.util.concurrent.ConcurrentHashMap;
 
+import org.apache.lucene.analysis.util.CharFilterFactory;
 import org.apache.lucene.analysis.util.ResourceLoaderAware;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
+import org.apache.lucene.analysis.util.TokenizerFactory;
 import org.apache.solr.common.ResourceLoader;
 import org.apache.solr.handler.admin.CoreAdminHandler;
 import org.apache.solr.handler.component.ShardHandlerFactory;
@@ -47,9 +50,6 @@
 import javax.naming.NamingException;
 import javax.naming.NoInitialContextException;
 
-import org.apache.solr.analysis.CharFilterFactory;
-import org.apache.solr.analysis.TokenFilterFactory;
-import org.apache.solr.analysis.TokenizerFactory;
 import org.apache.solr.util.FileUtils;
 import org.apache.solr.common.SolrException;
 import org.apache.solr.handler.component.SearchComponent;
Index: solr/core/src/java/org/apache/solr/schema/TrieField.java
===================================================================
--- solr/core/src/java/org/apache/solr/schema/TrieField.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/schema/TrieField.java	(working copy)
@@ -21,6 +21,8 @@
 import java.util.Locale;
 import java.util.Map;
 
+import org.apache.lucene.analysis.util.CharFilterFactory;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 import org.apache.lucene.document.DoubleField;
 import org.apache.lucene.document.FieldType;
 import org.apache.lucene.document.FieldType.NumericType;
@@ -39,7 +41,8 @@
 import org.apache.lucene.util.NumericUtils;
 import org.apache.lucene.util.mutable.MutableValueDate;
 import org.apache.lucene.util.mutable.MutableValueLong;
-import org.apache.solr.analysis.*;
+import org.apache.solr.analysis.TokenizerChain;
+import org.apache.solr.analysis.TrieTokenizerFactory;
 import org.apache.solr.common.SolrException;
 import org.apache.solr.response.TextResponseWriter;
 import org.apache.solr.search.QParser;
Index: solr/core/src/java/org/apache/solr/schema/FieldTypePluginLoader.java
===================================================================
--- solr/core/src/java/org/apache/solr/schema/FieldTypePluginLoader.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/schema/FieldTypePluginLoader.java	(working copy)
@@ -19,9 +19,14 @@
 
 import org.apache.lucene.analysis.Analyzer;
 import org.apache.lucene.analysis.core.KeywordAnalyzer;
+import org.apache.lucene.analysis.util.CharFilterFactory;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
+import org.apache.lucene.analysis.util.TokenizerFactory;
 import org.apache.lucene.util.Version;
-import org.apache.solr.analysis.*;
 import org.apache.lucene.analysis.util.ResourceLoader;
+import org.apache.solr.analysis.KeywordTokenizerFactory;
+import org.apache.solr.analysis.MultiTermAwareComponent;
+import org.apache.solr.analysis.TokenizerChain;
 import org.apache.solr.common.SolrException;
 import org.apache.solr.util.DOMUtil;
 import org.apache.solr.core.Config;
Index: solr/core/src/java/org/apache/solr/search/ExtendedDismaxQParserPlugin.java
===================================================================
--- solr/core/src/java/org/apache/solr/search/ExtendedDismaxQParserPlugin.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/search/ExtendedDismaxQParserPlugin.java	(working copy)
@@ -32,6 +32,7 @@
 import java.util.Set;
 
 import org.apache.lucene.analysis.Analyzer;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 import org.apache.lucene.queries.function.BoostedQuery;
 import org.apache.lucene.queries.function.FunctionQuery;
 import org.apache.lucene.queries.function.ValueSource;
@@ -40,6 +41,8 @@
 import org.apache.lucene.queryparser.classic.ParseException;
 import org.apache.lucene.queryparser.classic.QueryParser;
 import org.apache.lucene.search.*;
+import org.apache.solr.analysis.StopFilterFactory;
+import org.apache.solr.analysis.TokenizerChain;
 import org.apache.solr.search.SolrQueryParser.MagicFieldName;
 import org.apache.solr.common.params.DisMaxParams;
 import org.apache.solr.common.params.SolrParams;
@@ -47,7 +50,6 @@
 import org.apache.solr.request.SolrQueryRequest;
 import org.apache.solr.schema.FieldType;
 import org.apache.solr.util.SolrPluginUtils;
-import org.apache.solr.analysis.*;
 
 /**
  * An advanced multi-field query parser.
Index: solr/core/src/java/org/apache/solr/search/SolrQueryParser.java
===================================================================
--- solr/core/src/java/org/apache/solr/search/SolrQueryParser.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/search/SolrQueryParser.java	(working copy)
@@ -22,6 +22,7 @@
 import java.util.Map;
 import java.util.Map.Entry;
 
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 import org.apache.lucene.index.Term;
 import org.apache.lucene.queryparser.classic.ParseException;
 import org.apache.lucene.queryparser.classic.QueryParser;
@@ -32,7 +33,8 @@
 import org.apache.lucene.util.automaton.BasicOperations;
 import org.apache.lucene.util.automaton.SpecialOperations;
 import org.apache.lucene.analysis.Analyzer;
-import org.apache.solr.analysis.*;
+import org.apache.solr.analysis.ReversedWildcardFilterFactory;
+import org.apache.solr.analysis.TokenizerChain;
 import org.apache.solr.common.SolrException;
 import org.apache.solr.schema.FieldType;
 import org.apache.solr.schema.IndexSchema;
Index: solr/core/src/java/org/apache/solr/handler/admin/LukeRequestHandler.java
===================================================================
--- solr/core/src/java/org/apache/solr/handler/admin/LukeRequestHandler.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/handler/admin/LukeRequestHandler.java	(working copy)
@@ -23,6 +23,9 @@
 import java.util.*;
 
 import org.apache.lucene.analysis.Analyzer;
+import org.apache.lucene.analysis.util.CharFilterFactory;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
+import org.apache.lucene.analysis.util.TokenizerFactory;
 import org.apache.lucene.document.Document;
 import org.apache.lucene.document.Field;
 import org.apache.lucene.index.*;
@@ -33,10 +36,7 @@
 import org.apache.lucene.util.CharsRef;
 import org.apache.lucene.util.PriorityQueue;
 import org.apache.lucene.util.UnicodeUtil;
-import org.apache.solr.analysis.CharFilterFactory;
-import org.apache.solr.analysis.TokenFilterFactory;
 import org.apache.solr.analysis.TokenizerChain;
-import org.apache.solr.analysis.TokenizerFactory;
 import org.apache.solr.common.SolrException;
 import org.apache.solr.common.SolrException.ErrorCode;
 import org.apache.solr.common.luke.FieldFlag;
Index: solr/core/src/java/org/apache/solr/handler/AnalysisRequestHandlerBase.java
===================================================================
--- solr/core/src/java/org/apache/solr/handler/AnalysisRequestHandlerBase.java	(revision 1334951)
+++ solr/core/src/java/org/apache/solr/handler/AnalysisRequestHandlerBase.java	(working copy)
@@ -22,6 +22,9 @@
 import org.apache.lucene.analysis.CharStream;
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.tokenattributes.*;
+import org.apache.lucene.analysis.util.CharFilterFactory;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
+import org.apache.lucene.analysis.util.TokenizerFactory;
 import org.apache.lucene.util.BytesRef;
 import org.apache.lucene.index.Payload;
 import org.apache.lucene.util.Attribute;
@@ -30,10 +33,7 @@
 import org.apache.lucene.util.AttributeReflector;
 import org.apache.lucene.util.CharsRef;
 import org.apache.lucene.util.ArrayUtil;
-import org.apache.solr.analysis.CharFilterFactory;
-import org.apache.solr.analysis.TokenFilterFactory;
 import org.apache.solr.analysis.TokenizerChain;
-import org.apache.solr.analysis.TokenizerFactory;
 import org.apache.solr.common.util.NamedList;
 import org.apache.solr.common.util.SimpleOrderedMap;
 import org.apache.solr.common.SolrException;
Index: solr/contrib/clustering/src/java/org/apache/solr/handler/clustering/carrot2/SolrStopwordsCarrot2LexicalDataFactory.java
===================================================================
--- solr/contrib/clustering/src/java/org/apache/solr/handler/clustering/carrot2/SolrStopwordsCarrot2LexicalDataFactory.java	(revision 1334951)
+++ solr/contrib/clustering/src/java/org/apache/solr/handler/clustering/carrot2/SolrStopwordsCarrot2LexicalDataFactory.java	(working copy)
@@ -22,9 +22,9 @@
 
 import org.apache.lucene.analysis.Analyzer;
 import org.apache.lucene.analysis.util.CharArraySet;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 import org.apache.solr.analysis.CommonGramsFilterFactory;
 import org.apache.solr.analysis.StopFilterFactory;
-import org.apache.solr.analysis.TokenFilterFactory;
 import org.apache.solr.analysis.TokenizerChain;
 import org.apache.solr.schema.IndexSchema;
 import org.carrot2.core.LanguageCode;
Index: solr/contrib/analysis-extras/src/java/org/apache/solr/analysis/StempelPolishStemFilterFactory.java
===================================================================
--- solr/contrib/analysis-extras/src/java/org/apache/solr/analysis/StempelPolishStemFilterFactory.java	(revision 1334951)
+++ solr/contrib/analysis-extras/src/java/org/apache/solr/analysis/StempelPolishStemFilterFactory.java	(working copy)
@@ -26,12 +26,13 @@
 import org.apache.solr.common.SolrException;
 import org.apache.solr.common.SolrException.ErrorCode;
 import org.apache.lucene.analysis.util.ResourceLoaderAware;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 import org.egothor.stemmer.Trie;
 
 /**
  * Factory for {@link StempelFilter} using a Polish stemming table.
  */
-public class StempelPolishStemFilterFactory extends BaseTokenFilterFactory implements ResourceLoaderAware {
+public class StempelPolishStemFilterFactory extends TokenFilterFactory implements ResourceLoaderAware {
   private Trie stemmer = null;
   private static final String STEMTABLE = "org/apache/lucene/analysis/pl/stemmer_20000.tbl";
   
Index: solr/contrib/analysis-extras/src/java/org/apache/solr/analysis/SmartChineseWordTokenFilterFactory.java
===================================================================
--- solr/contrib/analysis-extras/src/java/org/apache/solr/analysis/SmartChineseWordTokenFilterFactory.java	(revision 1334951)
+++ solr/contrib/analysis-extras/src/java/org/apache/solr/analysis/SmartChineseWordTokenFilterFactory.java	(working copy)
@@ -20,6 +20,7 @@
 import org.apache.lucene.analysis.TokenFilter;
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.cn.smart.WordTokenFilter;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 /**
  * Factory for the SmartChineseAnalyzer {@link WordTokenFilter}
@@ -30,7 +31,7 @@
  * <code>words="org/apache/lucene/analysis/cn/smart/stopwords.txt"</code>
  * @lucene.experimental
  */
-public class SmartChineseWordTokenFilterFactory extends BaseTokenFilterFactory {
+public class SmartChineseWordTokenFilterFactory extends TokenFilterFactory {
   public TokenFilter create(TokenStream input) {
       return new WordTokenFilter(input);
   }
Index: solr/contrib/analysis-extras/src/java/org/apache/solr/analysis/ICUFoldingFilterFactory.java
===================================================================
--- solr/contrib/analysis-extras/src/java/org/apache/solr/analysis/ICUFoldingFilterFactory.java	(revision 1334951)
+++ solr/contrib/analysis-extras/src/java/org/apache/solr/analysis/ICUFoldingFilterFactory.java	(working copy)
@@ -2,6 +2,7 @@
 
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.icu.ICUFoldingFilter;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 /**
  * Licensed to the Apache Software Foundation (ASF) under one or more
@@ -21,7 +22,7 @@
  */
 
 /** Factory for {@link ICUFoldingFilter} */
-public class ICUFoldingFilterFactory extends BaseTokenFilterFactory implements MultiTermAwareComponent {
+public class ICUFoldingFilterFactory extends TokenFilterFactory implements MultiTermAwareComponent {
 
   @Override
   public TokenStream create(TokenStream input) {
Index: solr/contrib/analysis-extras/src/java/org/apache/solr/analysis/ICUNormalizer2FilterFactory.java
===================================================================
--- solr/contrib/analysis-extras/src/java/org/apache/solr/analysis/ICUNormalizer2FilterFactory.java	(revision 1334951)
+++ solr/contrib/analysis-extras/src/java/org/apache/solr/analysis/ICUNormalizer2FilterFactory.java	(working copy)
@@ -23,6 +23,7 @@
 import org.apache.lucene.analysis.icu.ICUNormalizer2Filter;
 import org.apache.solr.common.SolrException;
 import org.apache.solr.common.SolrException.ErrorCode;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 import com.ibm.icu.text.FilteredNormalizer2;
 import com.ibm.icu.text.Normalizer2;
@@ -44,7 +45,7 @@
  * @see Normalizer2
  * @see FilteredNormalizer2
  */
-public class ICUNormalizer2FilterFactory extends BaseTokenFilterFactory implements MultiTermAwareComponent {
+public class ICUNormalizer2FilterFactory extends TokenFilterFactory implements MultiTermAwareComponent {
   private Normalizer2 normalizer;
 
   // TODO: support custom normalization
Index: solr/contrib/analysis-extras/src/java/org/apache/solr/analysis/ICUTokenizerFactory.java
===================================================================
--- solr/contrib/analysis-extras/src/java/org/apache/solr/analysis/ICUTokenizerFactory.java	(revision 1334951)
+++ solr/contrib/analysis-extras/src/java/org/apache/solr/analysis/ICUTokenizerFactory.java	(working copy)
@@ -21,9 +21,10 @@
 
 import org.apache.lucene.analysis.Tokenizer;
 import org.apache.lucene.analysis.icu.segmentation.ICUTokenizer;
+import org.apache.lucene.analysis.util.TokenizerFactory;
 
 /** Factory for {@link ICUTokenizer} */
-public class ICUTokenizerFactory extends BaseTokenizerFactory {
+public class ICUTokenizerFactory extends TokenizerFactory {
   // TODO: add support for custom configs
   @Override
   public Tokenizer create(Reader input) {
Index: solr/contrib/analysis-extras/src/java/org/apache/solr/analysis/MorfologikFilterFactory.java
===================================================================
--- solr/contrib/analysis-extras/src/java/org/apache/solr/analysis/MorfologikFilterFactory.java	(revision 1334951)
+++ solr/contrib/analysis-extras/src/java/org/apache/solr/analysis/MorfologikFilterFactory.java	(working copy)
@@ -26,6 +26,7 @@
 
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.morfologik.MorfologikFilter;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 /**
  * Filter factory for {@link MorfologikFilter}.
@@ -44,7 +45,7 @@
  * 
  * @see <a href="http://morfologik.blogspot.com/">Morfologik web site</a>
  */
-public class MorfologikFilterFactory extends BaseTokenFilterFactory {
+public class MorfologikFilterFactory extends TokenFilterFactory {
   /** Dictionary. */
   private DICTIONARY dictionary = DICTIONARY.MORFOLOGIK;
   
Index: solr/contrib/analysis-extras/src/java/org/apache/solr/analysis/ICUTransformFilterFactory.java
===================================================================
--- solr/contrib/analysis-extras/src/java/org/apache/solr/analysis/ICUTransformFilterFactory.java	(revision 1334951)
+++ solr/contrib/analysis-extras/src/java/org/apache/solr/analysis/ICUTransformFilterFactory.java	(working copy)
@@ -21,9 +21,9 @@
 
 import org.apache.lucene.analysis.TokenStream;
 import org.apache.lucene.analysis.icu.ICUTransformFilter;
-import org.apache.solr.analysis.BaseTokenFilterFactory;
 import org.apache.solr.common.SolrException;
 import org.apache.solr.common.SolrException.ErrorCode;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 
 import com.ibm.icu.text.Transliterator;
 
@@ -37,7 +37,7 @@
  * </ul>
  * @see Transliterator
  */
-public class ICUTransformFilterFactory extends BaseTokenFilterFactory implements MultiTermAwareComponent {
+public class ICUTransformFilterFactory extends TokenFilterFactory implements MultiTermAwareComponent {
   private Transliterator transliterator;
   
   // TODO: add support for custom rules
Index: solr/contrib/analysis-extras/src/java/org/apache/solr/analysis/ICUCollationKeyFilterFactory.java
===================================================================
--- solr/contrib/analysis-extras/src/java/org/apache/solr/analysis/ICUCollationKeyFilterFactory.java	(revision 1334951)
+++ solr/contrib/analysis-extras/src/java/org/apache/solr/analysis/ICUCollationKeyFilterFactory.java	(working copy)
@@ -21,6 +21,7 @@
 
 import org.apache.commons.io.IOUtils;
 import org.apache.lucene.analysis.TokenStream;
+import org.apache.lucene.analysis.util.TokenFilterFactory;
 import org.apache.lucene.collation.ICUCollationKeyFilter;
 import org.apache.lucene.analysis.util.ResourceLoader;
 import org.apache.solr.common.SolrException;
@@ -70,7 +71,7 @@
  * @deprecated use {@link org.apache.solr.schema.ICUCollationField} instead.
  */
 @Deprecated
-public class ICUCollationKeyFilterFactory extends BaseTokenFilterFactory implements MultiTermAwareComponent,ResourceLoaderAware {
+public class ICUCollationKeyFilterFactory extends TokenFilterFactory implements MultiTermAwareComponent, ResourceLoaderAware {
   private Collator collator;
 
   public void inform(ResourceLoader loader) {
Index: solr/contrib/analysis-extras/src/java/org/apache/solr/analysis/SmartChineseSentenceTokenizerFactory.java
===================================================================
--- solr/contrib/analysis-extras/src/java/org/apache/solr/analysis/SmartChineseSentenceTokenizerFactory.java	(revision 1334951)
+++ solr/contrib/analysis-extras/src/java/org/apache/solr/analysis/SmartChineseSentenceTokenizerFactory.java	(working copy)
@@ -21,12 +21,13 @@
 
 import org.apache.lucene.analysis.Tokenizer;
 import org.apache.lucene.analysis.cn.smart.SentenceTokenizer;
+import org.apache.lucene.analysis.util.TokenizerFactory;
 
 /**
  * Factory for the SmartChineseAnalyzer {@link SentenceTokenizer}
  * @lucene.experimental
  */
-public class SmartChineseSentenceTokenizerFactory extends BaseTokenizerFactory {
+public class SmartChineseSentenceTokenizerFactory extends TokenizerFactory {
   public Tokenizer create(Reader input) {
     return new SentenceTokenizer(input);
   }
Index: solr/contrib/uima/src/java/org/apache/solr/uima/analysis/UIMAAnnotationsTokenizerFactory.java
===================================================================
--- solr/contrib/uima/src/java/org/apache/solr/uima/analysis/UIMAAnnotationsTokenizerFactory.java	(revision 1334951)
+++ solr/contrib/uima/src/java/org/apache/solr/uima/analysis/UIMAAnnotationsTokenizerFactory.java	(working copy)
@@ -18,16 +18,16 @@
  */
 
 import org.apache.lucene.analysis.Tokenizer;
+import org.apache.lucene.analysis.util.TokenizerFactory;
 import org.apache.lucene.analysis.uima.UIMAAnnotationsTokenizer;
-import org.apache.solr.analysis.BaseTokenizerFactory;
 
 import java.io.Reader;
 import java.util.Map;
 
 /**
- * Solr {@link org.apache.solr.analysis.TokenizerFactory} for {@link UIMAAnnotationsTokenizer}
+ * {@link org.apache.lucene.analysis.util.TokenizerFactory} for {@link UIMAAnnotationsTokenizer}
  */
-public class UIMAAnnotationsTokenizerFactory extends BaseTokenizerFactory {
+public class UIMAAnnotationsTokenizerFactory extends TokenizerFactory {
 
   private String descriptorPath;
   private String tokenType;
Index: solr/contrib/uima/src/java/org/apache/solr/uima/analysis/UIMATypeAwareAnnotationsTokenizerFactory.java
===================================================================
--- solr/contrib/uima/src/java/org/apache/solr/uima/analysis/UIMATypeAwareAnnotationsTokenizerFactory.java	(revision 1334951)
+++ solr/contrib/uima/src/java/org/apache/solr/uima/analysis/UIMATypeAwareAnnotationsTokenizerFactory.java	(working copy)
@@ -19,15 +19,15 @@
 
 import org.apache.lucene.analysis.Tokenizer;
 import org.apache.lucene.analysis.uima.UIMATypeAwareAnnotationsTokenizer;
-import org.apache.solr.analysis.BaseTokenizerFactory;
+import org.apache.lucene.analysis.util.TokenizerFactory;
 
 import java.io.Reader;
 import java.util.Map;
 
 /**
- * Solr {@link org.apache.solr.analysis.TokenizerFactory} for {@link UIMATypeAwareAnnotationsTokenizer}
+ * {@link org.apache.lucene.analysis.util.TokenizerFactory} for {@link UIMATypeAwareAnnotationsTokenizer}
  */
-public class UIMATypeAwareAnnotationsTokenizerFactory extends BaseTokenizerFactory {
+public class UIMATypeAwareAnnotationsTokenizerFactory extends TokenizerFactory {
 
   private String descriptorPath;
   private String tokenType;
Index: solr/test-framework/src/java/org/apache/solr/analysis/MockTokenizerFactory.java
===================================================================
--- solr/test-framework/src/java/org/apache/solr/analysis/MockTokenizerFactory.java	(revision 1334951)
+++ solr/test-framework/src/java/org/apache/solr/analysis/MockTokenizerFactory.java	(working copy)
@@ -22,12 +22,13 @@
 
 import org.apache.lucene.analysis.MockTokenizer;
 import org.apache.lucene.analysis.Tokenizer;
+import org.apache.lucene.analysis.util.TokenizerFactory;
 import org.apache.lucene.util.automaton.CharacterRunAutomaton;
 
 /**
  * Factory for {@link MockTokenizer} for testing purposes.
  */
-public class MockTokenizerFactory extends BaseTokenizerFactory {
+public class MockTokenizerFactory extends TokenizerFactory {
   CharacterRunAutomaton pattern;
   boolean enableChecks;
   
Index: lucene/analysis/common/src/java/org/apache/lucene/analysis/util/AbstractAnalysisFactory.java
===================================================================
--- lucene/analysis/common/src/java/org/apache/lucene/analysis/util/AbstractAnalysisFactory.java	(revision 0)
+++ lucene/analysis/common/src/java/org/apache/lucene/analysis/util/AbstractAnalysisFactory.java	(revision 0)
@@ -0,0 +1,168 @@
+package org.apache.lucene.analysis.util;
+
+/*
+ * Licensed to the Apache Software Foundation (ASF) under one or more
+ * contributor license agreements.  See the NOTICE file distributed with
+ * this work for additional information regarding copyright ownership.
+ * The ASF licenses this file to You under the Apache License, Version 2.0
+ * (the "License"); you may not use this file except in compliance with
+ * the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+import org.apache.lucene.analysis.core.StopFilter;
+import org.apache.lucene.util.IOUtils;
+import org.apache.lucene.util.Version;
+
+import java.io.IOException;
+import java.io.InputStream;
+import java.io.InputStreamReader;
+import java.io.Reader;
+import java.nio.charset.CharsetDecoder;
+import java.nio.charset.CodingErrorAction;
+import java.util.ArrayList;
+import java.util.Collections;
+import java.util.List;
+import java.util.Map;
+
+abstract class AbstractAnalysisFactory {
+
+  /** The init args */
+  protected Map<String,String> args;
+
+  /** the luceneVersion arg */
+  protected Version luceneMatchVersion = null;
+
+  public void init(Map<String,String> args) {
+    this.args = args;
+  }
+
+  public Map<String,String> getArgs() {
+    return args;
+  }
+
+   /** this method can be called in the {@link org.apache.lucene.analysis.util.TokenizerFactory#create(java.io.Reader)}
+   * or {@link org.apache.lucene.analysis.util.TokenFilterFactory#create(org.apache.lucene.analysis.TokenStream)} methods,
+   * to inform user, that for this factory a {@link #luceneMatchVersion} is required */
+  protected final void assureMatchVersion() {
+    if (luceneMatchVersion == null) {
+      throw new InitializationException("Configuration Error: Factory '" + this.getClass().getName() +
+        "' needs a 'luceneMatchVersion' parameter");
+    }
+  }
+
+  public void setLuceneMatchVersion(Version luceneMatchVersion) {
+    this.luceneMatchVersion = luceneMatchVersion;
+  }
+
+  public Version getLuceneMatchVersion() {
+    return this.luceneMatchVersion;
+  }
+
+  protected int getInt(String name) {
+    return getInt(name, -1, false);
+  }
+
+  protected int getInt(String name, int defaultVal) {
+    return getInt(name, defaultVal, true);
+  }
+
+  protected int getInt(String name, int defaultVal, boolean useDefault) {
+    String s = args.get(name);
+    if (s == null) {
+      if (useDefault) {
+        return defaultVal;
+      }
+      throw new InitializationException("Configuration Error: missing parameter '" + name + "'");
+    }
+    return Integer.parseInt(s);
+  }
+
+  protected boolean getBoolean(String name, boolean defaultVal) {
+    return getBoolean(name, defaultVal, true);
+  }
+
+  protected boolean getBoolean(String name, boolean defaultVal, boolean useDefault) {
+    String s = args.get(name);
+    if (s==null) {
+      if (useDefault) return defaultVal;
+      throw new InitializationException("Configuration Error: missing parameter '" + name + "'");
+    }
+    return Boolean.parseBoolean(s);
+  }
+
+  protected CharArraySet getWordSet(ResourceLoader loader,
+      String wordFiles, boolean ignoreCase) throws IOException {
+    assureMatchVersion();
+    List<String> files = splitFileNames(wordFiles);
+    CharArraySet words = null;
+    if (files.size() > 0) {
+      // default stopwords list has 35 or so words, but maybe don't make it that
+      // big to start
+      words = new CharArraySet(luceneMatchVersion,
+          files.size() * 10, ignoreCase);
+      for (String file : files) {
+        List<String> wlist = loader.getLines(file.trim());
+        words.addAll(StopFilter.makeStopSet(luceneMatchVersion, wlist,
+            ignoreCase));
+      }
+    }
+    return words;
+  }
+
+  /** same as {@link #getWordSet(ResourceLoader, String, boolean)},
+   * except the input is in snowball format. */
+  protected CharArraySet getSnowballWordSet(ResourceLoader loader,
+      String wordFiles, boolean ignoreCase) throws IOException {
+    assureMatchVersion();
+    List<String> files = splitFileNames(wordFiles);
+    CharArraySet words = null;
+    if (files.size() > 0) {
+      // default stopwords list has 35 or so words, but maybe don't make it that
+      // big to start
+      words = new CharArraySet(luceneMatchVersion,
+          files.size() * 10, ignoreCase);
+      for (String file : files) {
+        InputStream stream = null;
+        Reader reader = null;
+        try {
+          stream = loader.openResource(file.trim());
+          CharsetDecoder decoder = IOUtils.CHARSET_UTF_8.newDecoder()
+              .onMalformedInput(CodingErrorAction.REPORT)
+              .onUnmappableCharacter(CodingErrorAction.REPORT);
+          reader = new InputStreamReader(stream, decoder);
+          WordlistLoader.getSnowballWordSet(reader, words);
+        } finally {
+          IOUtils.closeWhileHandlingException(reader, stream);
+        }
+      }
+    }
+    return words;
+  }
+
+  /**
+   * Splits file names separated by comma character.
+   * File names can contain comma characters escaped by backslash '\'
+   *
+   * @param fileNames the string containing file names
+   * @return a list of file names with the escaping backslashed removed
+   */
+  protected List<String> splitFileNames(String fileNames) {
+    if (fileNames == null)
+      return Collections.<String>emptyList();
+
+    List<String> result = new ArrayList<String>();
+    for (String file : fileNames.split("(?<!\\\\),")) {
+      result.add(file.replaceAll("\\\\(?=,)", ""));
+    }
+
+    return result;
+  }
+}
Index: lucene/analysis/common/src/java/org/apache/lucene/analysis/util/TokenizerFactory.java
===================================================================
--- lucene/analysis/common/src/java/org/apache/lucene/analysis/util/TokenizerFactory.java	(revision 0)
+++ lucene/analysis/common/src/java/org/apache/lucene/analysis/util/TokenizerFactory.java	(revision 0)
@@ -0,0 +1,28 @@
+package org.apache.lucene.analysis.util;
+
+/*
+ * Licensed to the Apache Software Foundation (ASF) under one or more
+ * contributor license agreements.  See the NOTICE file distributed with
+ * this work for additional information regarding copyright ownership.
+ * The ASF licenses this file to You under the Apache License, Version 2.0
+ * (the "License"); you may not use this file except in compliance with
+ * the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+import org.apache.lucene.analysis.Tokenizer;
+
+import java.io.Reader;
+
+public abstract class TokenizerFactory extends AbstractAnalysisFactory {
+
+  /** Creates a TokenStream of the specified input */
+  public abstract Tokenizer create(Reader input);
+}
Index: lucene/analysis/common/src/java/org/apache/lucene/analysis/util/InitializationException.java
===================================================================
--- lucene/analysis/common/src/java/org/apache/lucene/analysis/util/InitializationException.java	(revision 0)
+++ lucene/analysis/common/src/java/org/apache/lucene/analysis/util/InitializationException.java	(revision 0)
@@ -0,0 +1,32 @@
+package org.apache.lucene.analysis.util;
+
+/*
+ * Licensed to the Apache Software Foundation (ASF) under one or more
+ * contributor license agreements.  See the NOTICE file distributed with
+ * this work for additional information regarding copyright ownership.
+ * The ASF licenses this file to You under the Apache License, Version 2.0
+ * (the "License"); you may not use this file except in compliance with
+ * the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+/**
+ * Exception representing an error occurring during the initialization of a Factory.
+ */
+public class InitializationException extends RuntimeException {
+
+  public InitializationException(String message) {
+    super(message);
+  }
+
+  public InitializationException(String message, Throwable cause) {
+    super(message, cause);
+  }
+}
Index: lucene/analysis/common/src/java/org/apache/lucene/analysis/util/CharFilterFactory.java
===================================================================
--- lucene/analysis/common/src/java/org/apache/lucene/analysis/util/CharFilterFactory.java	(revision 0)
+++ lucene/analysis/common/src/java/org/apache/lucene/analysis/util/CharFilterFactory.java	(revision 0)
@@ -0,0 +1,25 @@
+package org.apache.lucene.analysis.util;
+
+/*
+ * Licensed to the Apache Software Foundation (ASF) under one or more
+ * contributor license agreements.  See the NOTICE file distributed with
+ * this work for additional information regarding copyright ownership.
+ * The ASF licenses this file to You under the Apache License, Version 2.0
+ * (the "License"); you may not use this file except in compliance with
+ * the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+import org.apache.lucene.analysis.CharStream;
+
+public abstract class CharFilterFactory extends AbstractAnalysisFactory {
+
+  public abstract CharStream create(CharStream input);
+}
Index: lucene/analysis/common/src/java/org/apache/lucene/analysis/util/TokenFilterFactory.java
===================================================================
--- lucene/analysis/common/src/java/org/apache/lucene/analysis/util/TokenFilterFactory.java	(revision 0)
+++ lucene/analysis/common/src/java/org/apache/lucene/analysis/util/TokenFilterFactory.java	(revision 0)
@@ -0,0 +1,26 @@
+package org.apache.lucene.analysis.util;
+
+/*
+ * Licensed to the Apache Software Foundation (ASF) under one or more
+ * contributor license agreements.  See the NOTICE file distributed with
+ * this work for additional information regarding copyright ownership.
+ * The ASF licenses this file to You under the Apache License, Version 2.0
+ * (the "License"); you may not use this file except in compliance with
+ * the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+import org.apache.lucene.analysis.TokenStream;
+
+public abstract class TokenFilterFactory extends AbstractAnalysisFactory {
+
+  /** Transform the specified input TokenStream */
+  public abstract TokenStream create(TokenStream input);
+}
