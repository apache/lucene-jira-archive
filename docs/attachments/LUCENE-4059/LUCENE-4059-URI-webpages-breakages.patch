Index: lucene/build.xml
===================================================================
--- lucene/build.xml	(revision 1339080)
+++ lucene/build.xml	(working copy)
@@ -225,8 +225,13 @@
   </target>
   
   <target name="process-webpages" depends="resolve-pegdown">
-    <pathconvert pathsep="|" dirsep="/" property="buildfiles">
+    <pathconvert pathsep="|" property="buildfiles">
       <fileset dir="." includes="**/build.xml" excludes="build.xml,analysis/*,build/**,tools/**,backwards/**,site/**"/>
+      <mapper>
+        <scriptmapper language="javascript">
+          self.addMappedName((new java.io.File(source)).toURI());
+        </scriptmapper>
+      </mapper>
     </pathconvert>
     <!--
       The XSL input file is ignored completely, but XSL expects one to be given,
Index: lucene/CHANGES.txt
===================================================================
--- lucene/CHANGES.txt	(revision 1339080)
+++ lucene/CHANGES.txt	(working copy)
@@ -995,6 +995,10 @@
 * LUCENE-3286: Moved remainder of contrib/xml-query-parser to lucene/queryparser.
   Classes now found at org.apache.lucene.queryparser.xml.*
 
+* LUCENE-4059: Improve ANT task prepare-webpages (used by documentation
+  tasks) to correctly encode build file names as URIs for later processing by
+  XSL.  (Greg Bowyer, Uwe Schindler)
+
 ======================= Lucene 3.6.0 =======================
 
 Changes in backwards compatibility policy
