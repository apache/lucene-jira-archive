Index: lucene/core/src/java/org/apache/lucene/store/RAMInputStream.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- lucene/core/src/java/org/apache/lucene/store/RAMInputStream.java	(date 1450166455000)
+++ lucene/core/src/java/org/apache/lucene/store/RAMInputStream.java	(revision )
@@ -36,6 +36,8 @@
   private long bufferStart;
   private int bufferLength;
 
+  private boolean enforceEOF;
+
   public RAMInputStream(String name, RAMFile f) throws IOException {
     this(name, f, f.length);
   }
@@ -91,6 +93,7 @@
   }
 
   private final void switchCurrentBuffer(boolean enforceEOF) throws IOException {
+    this.enforceEOF = false;
     bufferStart = (long) BUFFER_SIZE * (long) currentBufferIndex;
     if (bufferStart > length || currentBufferIndex >= file.numBuffers()) {
       // end of file reached, no more buffers left
@@ -100,6 +103,7 @@
         // Force EOF if a read takes place at this position
         currentBufferIndex--;
         bufferPosition = BUFFER_SIZE;
+        this.enforceEOF = true;
       }
     } else {
       currentBuffer = file.getBuffer(currentBufferIndex);
@@ -120,7 +124,10 @@
       currentBufferIndex = (int) (pos / BUFFER_SIZE);
       switchCurrentBuffer(false);
     }
+    if (!enforceEOF) {
+      // do not overwrite bufferPosition if EOF should be thrown on the next read
-    bufferPosition = (int) (pos % BUFFER_SIZE);
+      bufferPosition = (int) (pos % BUFFER_SIZE);
+    }
   }
 
   @Override
