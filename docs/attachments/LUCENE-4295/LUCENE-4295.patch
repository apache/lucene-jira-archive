Index: dev-tools/scripts/smokeTestRelease.py
===================================================================
--- dev-tools/scripts/smokeTestRelease.py	(revision 1370367)
+++ dev-tools/scripts/smokeTestRelease.py	(working copy)
@@ -363,6 +363,10 @@
     raise RuntimeError('SHA1 digest mismatch for %s: expected %s but got %s' % (artifact, sha1Expected, sha1Actual))
 
 def getDirEntries(urlString):
+  if urlString.startswith('file:/') and not urlString.startswith('file://'):
+    # stupid bogus ant URI
+    urlString = "file:///" + urlString[6:]
+
   if urlString.startswith('file://'):
     path = urlString[7:]
     if path.endswith('/'):
@@ -1026,7 +1030,7 @@
 
 def main():
 
-  if len(sys.argv) != 4:
+  if len(sys.argv) < 4:
     print()
     print('Usage python -u %s BaseURL version tmpDir' % sys.argv[0])
     print()
@@ -1035,8 +1039,11 @@
   baseURL = sys.argv[1]
   version = sys.argv[2]
   tmpDir = os.path.abspath(sys.argv[3])
+  isSigned = True 
+  if len(sys.argv) == 5:
+    isSigned = (sys.argv[4] == "True")
 
-  smokeTest(baseURL, version, tmpDir, True)
+  smokeTest(baseURL, version, tmpDir, isSigned)
 
 def smokeTest(baseURL, version, tmpDir, isSigned):
 
@@ -1087,7 +1094,9 @@
 if __name__ == '__main__':
   try:
     main()
+    sys.exit(0)
   except:
     import traceback
     traceback.print_exc()
+    sys.exit(1)
   
Index: build.xml
===================================================================
--- build.xml	(revision 1370367)
+++ build.xml	(working copy)
@@ -184,4 +184,48 @@
       </subant>
     </sequential>
   </target>
+
+  <property name="python32.exe" value="python3.2" />
+  <property name="JAVA6_HOME" value="/usr/local/jdk1.6.0_27"/>
+  <property name="JAVA7_HOME" value="/usr/local/jdk1.7.0_01"/>
+  <property name="fakeRelease" value="lucene/build/fakeRelease"/>
+  <property name="fakeReleaseTmp" value="lucene/build/fakeReleaseTmp"/>
+  <property name="fakeReleaseVersion" value="5.0"/>
+
+  <target name="nightly-smoke" description="Builds an unsigned snapshot release and smoke tests it." depends="clean">
+   <sequential>
+     <subant target="prepare-release-no-sign" inheritall="false" failonerror="true">
+       <fileset dir="lucene" includes="build.xml" />
+       <fileset dir="solr" includes="build.xml" />
+       <property name="version" value="${fakeReleaseVersion}" />
+     </subant>
+     <delete dir="${fakeRelease}"/>
+     <delete dir="${fakeReleaseTmp}"/>
+     <mkdir dir="${fakeRelease}"/>
+     <copy todir="${fakeRelease}/lucene">
+       <fileset dir="lucene/dist"/>
+     </copy>
+     <copy todir="${fakeRelease}/lucene/changes">
+       <fileset dir="lucene/build/docs/changes"/>
+     </copy>
+     <get src="http://people.apache.org/keys/group/lucene.asc" 
+          dest="${fakeRelease}/lucene/KEYS"/>
+     <copy todir="${fakeRelease}/solr">
+       <fileset dir="solr/package"/>
+     </copy>
+     <copy file="${fakeRelease}/lucene/KEYS" todir="${fakeRelease}/solr"/>
+     <makeurl file="${fakeRelease}" validate="false" property="fakeRelease.uri"/>
+     <exec executable="${python32.exe}" failonerror="true">
+       <arg value="dev-tools/scripts/smokeTestRelease.py"/>
+       <arg value="${fakeRelease.uri}"/>
+       <arg value="${fakeReleaseVersion}"/>
+       <arg value="${fakeReleaseTmp}"/>
+       <arg value="false"/>
+       <env key="JAVA6_HOME" value="${JAVA6_HOME}"/>
+       <env key="JAVA7_HOME" value="${JAVA7_HOME}"/>
+     </exec>
+     <delete dir="${fakeRelease}"/>
+     <delete dir="${fakeReleaseTmp}"/>
+   </sequential>
+  </target>
 </project>
