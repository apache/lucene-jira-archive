Index: lucene/highlighter/src/java/org/apache/lucene/search/vectorhighlight/BaseFragmentsBuilder.java
===================================================================
--- lucene/highlighter/src/java/org/apache/lucene/search/vectorhighlight/BaseFragmentsBuilder.java	(revision 1691150)
+++ lucene/highlighter/src/java/org/apache/lucene/search/vectorhighlight/BaseFragmentsBuilder.java	(working copy)
@@ -177,12 +177,19 @@
     int srcIndex = 0;
     for( SubInfo subInfo : fragInfo.getSubInfos() ){
       for( Toffs to : subInfo.getTermsOffsets() ){
-        fragment
-          .append( encoder.encodeText( src.substring( srcIndex, to.getStartOffset() - modifiedStartOffset[0] ) ) )
-          .append( getPreTag( preTags, subInfo.getSeqnum() ) )
-          .append( encoder.encodeText( src.substring( to.getStartOffset() - modifiedStartOffset[0], to.getEndOffset() - modifiedStartOffset[0] ) ) )
-          .append( getPostTag( postTags, subInfo.getSeqnum() ) );
-        srcIndex = to.getEndOffset() - modifiedStartOffset[0];
+        /**
+        * Quick fix for incorrect offsets! See SOLR-4137 for more information
+        */
+        int startOffset = to.getStartOffset() - modifiedStartOffset[0] < 0 ? 0 : to.getStartOffset() - modifiedStartOffset[0];
+        int endOffset = to.getEndOffset() - modifiedStartOffset[0] > src.length()-1 ? src.length()-1 : to.getEndOffset() - modifiedStartOffset[0];
+        if (srcIndex < startOffset) {
+            fragment
+            .append(encoder.encodeText(src.substring(srcIndex, startOffset)))
+            .append( getPreTag( preTags, subInfo.getSeqnum() ) )
+            .append( encoder.encodeText( src.substring(startOffset, endOffset ) ) )
+            .append( getPostTag( postTags, subInfo.getSeqnum() ) );
+        }
+        srcIndex = endOffset;
       }
     }
     fragment.append( encoder.encodeText( src.substring( srcIndex ) ) );
