Index: modules/analysis/common/src/java/org/apache/lucene/analysis/en/PorterStemmer.java
===================================================================
--- modules/analysis/common/src/java/org/apache/lucene/analysis/en/PorterStemmer.java	(revision 1150089)
+++ modules/analysis/common/src/java/org/apache/lucene/analysis/en/PorterStemmer.java	(working copy)
@@ -211,9 +211,14 @@
     int o = k-l+1;
     if (o < k0)
       return false;
-    for (int i = 0; i < l; i++)
-      if (b[o+i] != s.charAt(i))
+    for (int i = 0; i < l; i++) {
+      final char ch = s.charAt(i);
+      /* LUCENE-3335: ch == 0 check added to prevent hotspot crash:
+       * no endings that are stripped contain this.
+       */
+      if (ch == 0 || b[o+i] != ch)
         return false;
+    }
     j = k-l;
     return true;
   }
