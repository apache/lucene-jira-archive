Index: lucene/src/test-framework/org/apache/lucene/util/LuceneTestCase.java
===================================================================
--- lucene/src/test-framework/org/apache/lucene/util/LuceneTestCase.java	(revision 1098373)
+++ lucene/src/test-framework/org/apache/lucene/util/LuceneTestCase.java	(working copy)
@@ -1060,10 +1060,11 @@
       return d;
     } catch (Exception e) {
       d = FSDirectory.open(file);
+    } finally {
+      if (lockFactory != null) {
+        d.setLockFactory(lockFactory);
+      }
     }
-    if (lockFactory != null) {
-      d.setLockFactory(lockFactory);
-    }
     return d;
   }
   
