Index: lucene/core/src/java/org/apache/lucene/index/FilterLeafReader.java
===================================================================
--- lucene/core/src/java/org/apache/lucene/index/FilterLeafReader.java	(revision 1679512)
+++ lucene/core/src/java/org/apache/lucene/index/FilterLeafReader.java	(working copy)
@@ -19,6 +19,7 @@
 
 import java.io.IOException;
 import java.util.Iterator;
+import java.util.Objects;
 
 import org.apache.lucene.search.CachingWrapperQuery;
 import org.apache.lucene.util.AttributeSource;
@@ -305,14 +306,67 @@
     in.registerParentReader(this);
   }
 
+  /**
+   * A CoreClosedListener wrapper that adjusts the core cache key that
+   * the wrapper is called with. This is useful if the core cache key
+   * of a reader is different from the key of the wrapped reader.
+   */
+  private static class CoreClosedListenerWrapper implements CoreClosedListener {
+
+    public static CoreClosedListener wrap(CoreClosedListener listener, Object thisCoreKey, Object inCoreKey) {
+      if (thisCoreKey == inCoreKey) {
+        // this reader has the same core cache key as its parent, nothing to do
+        return listener;
+      } else {
+        // we don't have the same cache key as the wrapped reader, we need to wrap
+        // the listener to call it with the correct cache key
+        return new CoreClosedListenerWrapper(listener, thisCoreKey, inCoreKey);
+      }
+    }
+
+    private final CoreClosedListener in;
+    private final Object thisCoreKey;
+    private final Object inCoreKey;
+
+    private CoreClosedListenerWrapper(CoreClosedListener in, Object thisCoreKey, Object inCoreKey) {
+      this.in = in;
+      this.thisCoreKey = thisCoreKey;
+      this.inCoreKey = inCoreKey;
+    }
+
+    @Override
+    public void onClose(Object ownerCoreCacheKey) throws IOException {
+      assert inCoreKey == ownerCoreCacheKey;
+      in.onClose(thisCoreKey);
+    }
+
+    // NOTE: equals/hashcore are important for removeCoreClosedListener to work
+    // correctly
+
+    @Override
+    public boolean equals(Object obj) {
+      if (obj == null || obj.getClass() != CoreClosedListenerWrapper.class) {
+        return false;
+      }
+      CoreClosedListenerWrapper that = (CoreClosedListenerWrapper) obj;
+      return in.equals(that.in) && thisCoreKey == that.thisCoreKey;
+    }
+
+    @Override
+    public int hashCode() {
+      return Objects.hash(getClass(), in, thisCoreKey);
+    }
+
+  }
+
   @Override
-  public void addCoreClosedListener(CoreClosedListener listener) {
-    in.addCoreClosedListener(listener);
+  public void addCoreClosedListener(final CoreClosedListener listener) {
+    in.addCoreClosedListener(CoreClosedListenerWrapper.wrap(listener, getCoreCacheKey(), in.getCoreCacheKey()));
   }
 
   @Override
   public void removeCoreClosedListener(CoreClosedListener listener) {
-    in.removeCoreClosedListener(listener);
+    in.removeCoreClosedListener(CoreClosedListenerWrapper.wrap(listener, getCoreCacheKey(), in.getCoreCacheKey()));
   }
 
   @Override
Index: lucene/core/src/java/org/apache/lucene/index/LeafReader.java
===================================================================
--- lucene/core/src/java/org/apache/lucene/index/LeafReader.java	(revision 1679512)
+++ lucene/core/src/java/org/apache/lucene/index/LeafReader.java	(working copy)
@@ -79,7 +79,9 @@
    */
   public static interface CoreClosedListener {
     /** Invoked when the shared core of the original {@code
-     *  SegmentReader} has closed. */
+     *  SegmentReader} has closed. The provided {@code
+     *  ownerCoreCacheKey} will be the same key as the one
+     *  returned by {@link LeafReader#getCoreCacheKey()}. */
     public void onClose(Object ownerCoreCacheKey) throws IOException;
   }
 
Index: lucene/core/src/test/org/apache/lucene/index/TestIndexReaderClose.java
===================================================================
--- lucene/core/src/test/org/apache/lucene/index/TestIndexReaderClose.java	(revision 1679512)
+++ lucene/core/src/test/org/apache/lucene/index/TestIndexReaderClose.java	(working copy)
@@ -94,7 +94,7 @@
     dir.close();
   }
 
-  public void testCoreListenerOnWrapper() throws IOException {
+  public void testCoreListenerOnSlowCompositeReaderWrapper() throws IOException {
     RandomIndexWriter w = new RandomIndexWriter(random(), newDirectory());
     final int numDocs = TestUtil.nextInt(random(), 1, 5);
     for (int i = 0; i < numDocs; ++i) {
@@ -114,7 +114,7 @@
     AtomicInteger counter = new AtomicInteger(numListeners);
     
     for (int i = 0; i < numListeners; ++i) {
-      CountCoreListener listener = new CountCoreListener(counter);
+      CountCoreListener listener = new CountCoreListener(counter, leafReader.getCoreCacheKey());
       listeners.add(listener);
       leafReader.addCoreClosedListener(listener);
     }
@@ -137,16 +137,69 @@
     w.w.getDirectory().close();
   }
 
+  public void testCoreListenerOnWrapperWithDifferentCacheKey() throws IOException {
+    RandomIndexWriter w = new RandomIndexWriter(random(), newDirectory());
+    final int numDocs = TestUtil.nextInt(random(), 1, 5);
+    for (int i = 0; i < numDocs; ++i) {
+      w.addDocument(new Document());
+      if (random().nextBoolean()) {
+        w.commit();
+      }
+    }
+    w.commit();
+    w.close();
+
+    final IndexReader reader = DirectoryReader.open(w.w.getDirectory());
+    // We explicitly define a different cache key
+    final Object coreCacheKey = new Object();
+    final LeafReader leafReader = new FilterLeafReader(SlowCompositeReaderWrapper.wrap(reader)) {
+      @Override
+      public Object getCoreCacheKey() {
+        return coreCacheKey;
+      }
+    };
+
+    final int numListeners = TestUtil.nextInt(random(), 1, 10);
+    final List<LeafReader.CoreClosedListener> listeners = new ArrayList<>();
+    AtomicInteger counter = new AtomicInteger(numListeners);
+    
+    for (int i = 0; i < numListeners; ++i) {
+      CountCoreListener listener = new CountCoreListener(counter, coreCacheKey);
+      listeners.add(listener);
+      leafReader.addCoreClosedListener(listener);
+    }
+    for (int i = 0; i < 100; ++i) {
+      leafReader.addCoreClosedListener(listeners.get(random().nextInt(listeners.size())));
+    }
+    final int removed = random().nextInt(numListeners);
+    Collections.shuffle(listeners, random());
+    for (int i = 0; i < removed; ++i) {
+      leafReader.removeCoreClosedListener(listeners.get(i));
+    }
+    assertEquals(numListeners, counter.get());
+    // make sure listeners are registered on the wrapped reader and that closing any of them has the same effect
+    if (random().nextBoolean()) {
+      reader.close();
+    } else {
+      leafReader.close();
+    }
+    assertEquals(removed, counter.get());
+    w.w.getDirectory().close();
+  }
+
   private static final class CountCoreListener implements LeafReader.CoreClosedListener {
 
     private final AtomicInteger count;
+    private final Object coreCacheKey;
 
-    public CountCoreListener(AtomicInteger count) {
+    public CountCoreListener(AtomicInteger count, Object coreCacheKey) {
       this.count = count;
+      this.coreCacheKey = coreCacheKey;
     }
 
     @Override
     public void onClose(Object coreCacheKey) {
+      assertSame(this.coreCacheKey, coreCacheKey);
       count.decrementAndGet();
     }
 
Index: lucene/test-framework/src/java/org/apache/lucene/index/AssertingLeafReader.java
===================================================================
--- lucene/test-framework/src/java/org/apache/lucene/index/AssertingLeafReader.java	(revision 1679512)
+++ lucene/test-framework/src/java/org/apache/lucene/index/AssertingLeafReader.java	(working copy)
@@ -47,6 +47,15 @@
     assert in.numDocs() <= in.maxDoc();
     assert in.numDeletedDocs() + in.numDocs() == in.maxDoc();
     assert !in.hasDeletions() || in.numDeletedDocs() > 0 && in.numDocs() < in.maxDoc();
+
+    addCoreClosedListener(new CoreClosedListener() {
+      @Override
+      public void onClose(Object ownerCoreCacheKey) throws IOException {
+        final Object expectedKey = getCoreCacheKey();
+        assert expectedKey == ownerCoreCacheKey
+            : "Core closed listener called on a different key " + expectedKey + " <> " + ownerCoreCacheKey;
+      }
+    });
   }
 
   @Override
