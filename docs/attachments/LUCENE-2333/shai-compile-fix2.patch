Index: build.xml
===================================================================
--- build.xml	(revision 925107)
+++ build.xml	(working copy)
@@ -674,6 +674,7 @@
     <attribute name="failonerror" default="true"/>
     <sequential>
       <subant target="@{target}" failonerror="@{failonerror}">
+        <property name="core.compiled" value="1"/>
         <fileset dir="."
                  includes="contrib/*/build.xml"
         />
@@ -681,7 +682,7 @@
     </sequential>
   </macrodef>
 
-  <target name="build-contrib"
+  <target name="build-contrib" depends="compile-test"
           description="Builds all contrib modules and their tests">
     <contrib-crawl target="build-artifacts-and-tests"/>
   </target>
Index: contrib/ant/build.xml
===================================================================
--- contrib/ant/build.xml	(revision 925107)
+++ contrib/ant/build.xml	(working copy)
@@ -33,11 +33,5 @@
                refid="additional.dependencies"
   />
 
-  <target name="compile-core" depends="common.compile-core">
-    <copy todir="${build.dir}/classes/java">
-      <fileset dir="src/java" includes="**/*.xml"/>
-    </copy>
-  </target>
-
   <import file="../contrib-build.xml"/>
 </project>
Index: contrib/contrib-build.xml
===================================================================
--- contrib/contrib-build.xml	(revision 925107)
+++ contrib/contrib-build.xml	(working copy)
@@ -27,20 +27,20 @@
   	
   <import file="../common-build.xml"/>
 
-  <property name="lucene.jar" location="${common.dir}/build/lucene-core-${version}.jar"/>
-  <available property="lucene.jar.present" type="file" file="${lucene.jar}"/>
-  <available property="lucene.tests.present" type="dir"
-             file="${common.dir}/build/classes/test" />
   <available property="contrib.has.tests" type="dir" file="src/test" />
   
-  <path id="classpath">
-   <pathelement path="${lucene.jar}"/>
+  <!-- if you extend the classpath refid in one contrib's build.xml (add JARs), use this as basis: -->
+  <path id="base.classpath">
+   <pathelement location="${common.dir}/build/classes/java"/>
    <pathelement path="${project.classpath}"/>
   </path>
-
+  
+  <!-- default classpath refid, can be overridden by contrib's build.xml (use the above base.classpath as basis): -->
+  <path id="classpath" refid="base.classpath"/>
+  
   <path id="test.classpath">
     <path refid="classpath"/>
-    <pathelement location="../../build/classes/test/"/>
+    <pathelement location="${common.dir}/build/classes/test"/>
     <path refid="junit-path"/>
     <pathelement location="${build.dir}/classes/java"/>
   </path>
@@ -52,16 +52,13 @@
     <pathelement path="${java.class.path}"/>
   </path>
 
-  <target name="build-lucene" unless="lucene.jar.present">
-    <ant dir="${common.dir}" target="jar-core" inheritAll="false"/>
-  </target>
-
-  <target name="build-lucene-tests" unless="lucene.tests.present">
+  <target name="build-lucene" unless="core.compiled">
     <ant dir="${common.dir}" target="compile-test" inheritAll="false"/>
+    <!-- set the property for this ant execution to speed up later tasks depending on this -->
+    <property name="core.compiled" value="1"/>
   </target>
-
   
-  <target name="init" depends="common.init,build-lucene,build-lucene-tests"/>
+  <target name="init" depends="common.init,build-lucene"/>
   <target name="compile-test" depends="init" if="contrib.has.tests">
     <antcall target="common.compile-test" inheritRefs="true" />
   </target>
Index: contrib/fast-vector-highlighter/build.xml
===================================================================
--- contrib/fast-vector-highlighter/build.xml	(revision 925107)
+++ contrib/fast-vector-highlighter/build.xml	(working copy)
@@ -29,9 +29,8 @@
   <available property="analyzers.jar.present" type="file" file="${analyzers.jar}"/>
 
   <path id="classpath">
-    <pathelement path="${lucene.jar}"/>
     <pathelement path="${analyzers.jar}"/>
-    <pathelement path="${project.classpath}"/>
+    <path refid="base.classpath"/>
   </path>
 
   <target name="compile-core" depends="build-analyzers, common.compile-core" />
Index: contrib/highlighter/build.xml
===================================================================
--- contrib/highlighter/build.xml	(revision 925107)
+++ contrib/highlighter/build.xml	(working copy)
@@ -32,10 +32,9 @@
   <available property="regex.jar.present" type="file" file="${regex.jar}"/>
 
   <path id="classpath">
-    <pathelement path="${lucene.jar}"/>
     <pathelement path="${memory.jar}"/>
     <pathelement path="${regex.jar}"/>
-    <pathelement path="${project.classpath}"/>
+    <path refid="base.classpath"/>
   </path>
 
   <target name="compile-core" depends="build-memory, build-regex, common.compile-core" />
Index: contrib/spatial/build.xml
===================================================================
--- contrib/spatial/build.xml	(revision 925107)
+++ contrib/spatial/build.xml	(working copy)
@@ -29,9 +29,8 @@
   <available property="memory.jar.present" type="file" file="${memory.jar}"/>
 
   <path id="classpath">
-    <pathelement path="${lucene.jar}"/>
     <pathelement path="${misc.jar}"/>
-    <pathelement path="${project.classpath}"/>
+    <path refid="base.classpath"/>
   </path>
 
   <target name="compile-core" depends="build-misc, common.compile-core" />
Index: contrib/spellchecker/build.xml
===================================================================
--- contrib/spellchecker/build.xml	(revision 925107)
+++ contrib/spellchecker/build.xml	(working copy)
@@ -24,6 +24,4 @@
   </description>
 
   <import file="../contrib-build.xml"/>
-  <target name="compile-test"
-          depends="build-lucene-tests,contrib-build.compile-test" />
 </project>
Index: contrib/xml-query-parser/build.xml
===================================================================
--- contrib/xml-query-parser/build.xml	(revision 925107)
+++ contrib/xml-query-parser/build.xml	(working copy)
@@ -25,6 +25,7 @@
 
   <import file="../contrib-build.xml"/>
 
+  <property name="lucene.jar" location="${common.dir}/build/lucene-core-${version}.jar"/>
   <property name="queries.jar" location="${common.dir}/build/contrib/queries/lucene-queries-${version}.jar"/>
   <property name="servlet.jar" location="${common.dir}/lib/servlet-api-2.4.jar"/>
   <available property="queries.jar.present" type="file" file="${queries.jar}"/>
@@ -32,16 +33,15 @@
 
 
   <path id="classpath">
-    <pathelement path="${lucene.jar}"/>
     <pathelement path="${queries.jar}"/>
-    <pathelement path="${project.classpath}"/>
+    <path refid="base.classpath"/>
   </path>
 
   <path id="web-classpath">
-    <pathelement path="${lucene.jar}"/>
     <pathelement path="${queries.jar}"/>
     <pathelement path="${servlet.jar}"/>
     <pathelement path="${build.dir}/${final.name}.jar"/>
+    <path refid="base.classpath"/>
   </path>
 
   <target name="compile-core" depends="build-queries, common.compile-core" />
@@ -59,6 +59,9 @@
   <target name="build-web-demo"  description="Compiles demo" if="servlet.jar.present">
 
     <echo>XML Parser compiling web demo</echo>
+
+    <ant dir="${common.dir}" target="jar-core" inheritAll="false"/>
+
     <compile
       srcdir="src/demo/java"
       destdir="${build.dir}/classes/webdemo">
