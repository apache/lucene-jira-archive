Index: lucene/src/test/org/apache/lucene/index/TestIndexWriter.java
===================================================================
--- lucene/src/test/org/apache/lucene/index/TestIndexWriter.java	(revision 1102655)
+++ lucene/src/test/org/apache/lucene/index/TestIndexWriter.java	(working copy)
@@ -2139,7 +2143,7 @@
       while(!finish) {
         try {
 
-          while(true) {
+          while(!finish) {
             if (w != null) {
               w.close();
               w = null;
@@ -2157,6 +2161,7 @@
               }
             }
             w.close();
+            w = null;
             _TestUtil.checkIndex(dir);
             IndexReader.open(dir, true).close();
 
